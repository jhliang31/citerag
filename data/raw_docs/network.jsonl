{"doc_id": "network", "page": 2, "text": "O “l 叠一垒五”许通心等教育本科日家级规划教材 G＼计岱帕网络经印教材系列 微课版（教学视频教学课件PPT) ..,\"',.“'I','\"'”  , _』 III I.. 」- l L _  ( ``.l  . OOi勹匕; 北京． BEUING"}
{"doc_id": "network", "page": 3, "text": "内容简介 本书自 1989 年首次出版以来，曾多次修订。在 2006 年本书通过了教育部的评审，被纳入普通商等教 育“十一五“国家级规划教材： 2008 年出版的第 5 版获得了教育部 2009 年精品教材称号。 2013 年出版的 第 6 版是“十二五“普通高等教育本科国家级规划教材。现在的第 8 版又在原有的基础上进行了一些修订。 全书分为 9 章，比较全面系统地介绍了计算机网络的发展和原理体系结构、物理层、数据链路层（包 括局域网）、网络层、运输层、应用层、网络安全、互联网上的音频／视频服务，以及无线网络和移动网络 等内容。各章均附有习题（附录 A 给出了部分习题的答案和提示）。全书课件放在电子工业出版社华信教 育资源网（ www.hxedu.com.cn ），供读者下载参考。 本书的特点是概念准确、论述严饰、内容新颖、图文并改，突出基本原理和基本概念的阐述，同时力 图反映计算机网络的一些最新发展。本书可供电气信息类和计算机类专业的大学本科生和研究生使用，对 从事计算机网络工作的工程技术人员也有参考价值。 未经许可，不得以任何方式复制或抄袭本书之部分或全部内容。 版权所有，侵权必究。 图书在版编目 (CIP) 数据 计算机网络／谢希仁编茗一8 版—北京：电子工业出版社， 202 1. 6 ISBN 978-7-121-41174-8  l ＠计 II. ＠谢．．． III. ＠计釭机网络一商等学校一教材 IV. (DTP393  中国版本图书馆 CrP 数据核字 (2021) 第 090476 号 责任编辑：郝志恒 牛晓丽 印 刷：保定市中画美凯印刷有限公司 装 订：保定市中画美凯印刷有限公司 出版发行：电子工业出版社 北京市海淀区万寿路 173 信箱 开 本： 787 X 1092 1/1 6 印张： 30.25 版 次： 1989 年 11 月第 1 版 2021 年 6 月第 8 版 印 次： 2021 年 6 月第 1 次印刷 印 数： 1~150000 册 定 价： 59.80 元 邮编： 100036 字数： 774 干字 凡所购买电子工业出版社图书有缺损问题，请向购买书店调换。若书店售缺，请与本社发行部联系， 联系及邮购电话： ( 010) 88254888, 88258888 。 质猩投诉请发邮件至 zlts@p he i .com.cn, 盗版侵权举报诮发邮件至 dbqq@phe i .com.cn 。 本书咨询联系方式：QQ 1098545482 。"}
{"doc_id": "network", "page": 4, "text": "前言 本教材第 6 版被纳入“十二五“普通，由等教育本科国家级规划教材。由于本教材所讲授 的是计算机网络蚊基本的原理，而这些基本原现是比较成熟和稳定的，因此，介绍基本原理 的部分相对稳定，不会有很大的变动。 现在使片」本教材的读者，在学习计算机网络课程前，基本上都已具有丰富的上网经验， 对互联网的应用已有了相当多的感性认识。在这样的基础上学习计邪机网络也可以采用另 一种办法，就是从最高层的应用层自顶向下讲到下面的链路层（例如教材[KUR0l7]) 。但 本教材第 1 版是在 1989 年出版的，当时围内尚无互联网的环境，大学生对互联网还是非 前陌生的。在这种悄况下，采用自底向上的方法讲述计党机限络的掠理，是一种较好的选 择。因此，第 8 版的教材仍保留原有框架，根据目前技术发展情况进行适当的修订，把计 算机网络垃主要的原理尽址讲述消楚。编者认为，只要能够学好各养的基本概念，就能够 领会计饵机网络的主要工作原理，为今后更深入地学习某些专题打下良好的基础。 第 8 版的教材有以下一些改动。 在第 4 郅简要介绍了软件定义网络 SDN 的概念。在涉及有关 lP 地址的问题时，则以目 前主流的无分类地址 CIDR 记法为上，少用分类地址。在路由选择协议中，更加详细地介绍 了最觅要的协议 BGP 。 在第 7 草“网络安全”方面，增加了公钥分配中的证书链以及运输层安全协议 TLS 等 内容． 互联网的发展之快出乎预料，砓大的变化就是智能手机已成为连接到互联网的奻主要的 用户设备，因此在第 9 章增加了有关智能手机传送数据时如何连接到互联网的内容，同时删 除了在蜂窝移动通信网中电话呼叫移动的用户的寻址过程。毕竞移动通信屈千另外一门课程， 在本教材中不可能进行过多的介绍。 此外， node 改用通用译名“节点“，不再使用标准译名“结点”。 所有各歆应参考的 RFC 文档和参考文献也都尽可能进行f史新。对千尔点内容适当地 增加了一些习题。关千网络实验和网络编程方而的问题，都有另外的教材专门讲述。 本教材的参考学时数为 70 学时左右。在课程学时数较少的情况下可以只学习前 6 章， 这样仍可获得有关互联网的砐基本的知识。 本教材后共有三个附录，附录 A 是部分习题解答（而不是详细解题步骤），附录 B 是英 文缩写词，附录 C 是参考文献与网址。 读者可访问电子工业出版社华信教育资源树 (www.hxedu.com.cn) 下载有关的参考内容。 编者非常感谢使用本教材的教师和同学，他们通过电子邮件向编者和出版社编铅提出了 很多宝贵意见，这里无法一一列出他们的姓名。但特别要感谢的是烟台理工学院韩明峰教授， 多年来他对本教材提出了大社建设性意见，并在百忙中仔细审阅了这次修订的多讫初稿；西 安航空学院T 国栋科工对第 9 竞 LTE 部分提出了非常具体的修改意见；本校工上林教授对 第 9 章的部分内容进行了认真的审阅。吴自珠副教授参与了本书的编写 T 作。还有不少读者 提出了希望增加一些内容的建议，但受篇幅所限，未能采纳这些建议。对此，编者均表示诚 . Ill."}
{"doc_id": "network", "page": 5, "text": "挚的谢意。计算机网络涉及的面很广，虽然已经过反复挑选，但还有不少新的发展未能添加 到教材中。限千编者水平，教材中难免还存在一些缺点和错误，殷切希望广大读者批评指正。 谢希仁 2020 年 9 月 于前解放军理工大学，南京 编者的电子邮件地址： x i ex i ren@ t s i n ghua.org .cn 欢迎指出教材中内容的不足和错误，但编者无法满足一些深入探讨和科研项目咨询的需求， 请予谅解。若需索取解题的详细步骤，请参考编者编著的《计算机网络释疑与习题解答》。 计算机网络（第 8 版）视频由桂林航天工业学院李志远教授讲解（扫描教材中的二维 码观看）。 计算机网络（第 7 版）视频由北京理工大学郑宏、宿红毅教授讲解（扫描封底二维码 观看）。 • IV•"}
{"doc_id": "network", "page": 6, "text": "目录 第 1 章概述．．．．．．．．．．．．．．．．．．．．．．．．．．．...................................................,.,......................................................... 1  I. I 计算机网络在信息时代中的作用．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． l 1. 2 互联网概述．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．.....................,........................ 3  1.2.1 网络的网络．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 3 1.2.2 互联网基础结构发展的三个阶段…．……………．…….....….......................................... 5  1.2.3 互联网的标准化工作．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 8 1.3互联网的组成．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 9 : :!:~ !:: ::~t:: ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::: :~  1. 4 计算机网络在我国的发展．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，.,.,...,.................................................... 17  1.5 ·~勹气扂::的定义 :::::::::::::::::::::::::::::::::::::::::::::::::::::::::  1.5.2 几种不同类别的计算机网络．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．............................................ 19  1. 6 计算机网络的性能．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．............................... 21  1.6.1 计算机网络的性能指标 21  1 6 2 计算机网络的非性能特心．．．．二二二：．．：：．…．．．．二：二二：:::::::::::::::::::::::::::::::::::::::;~ 1.7计算机网络体系结构 27  1 7 1 计算机网络体系结构的形成 , .. 27  1.7.2 协议与划分层次．．．．．．．．．．．．．．．．．．．．．．．．．．．···························................................................... 29  1.7.3 具有五层协议的体系结构 31  l.7.4 实体、协议、服务和服务五百：；、．：．：．．．：．．二：．．．．．：厂．．．．．：．：勹勹二：二二二二：：： 34 1.7.5 TCP/l P 的体系结构．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 36 言勺重要概念 ::  第 2 章物理层．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 42 2 .1物理层的基本概念．．．．．．．．.........................................................,...............................................42 2.2 数据通信的基础知识 43  22 1 数据通信系统的模型 , 43  2.2.2 有关信道的几个基本概念 44  2.2.34言道的极限容量…．．．．．……．二二二二二二二二二二二二：…．：／．．／．．．．二二二： 46 2.3 ~3~气扂：：扂 ' . ::  2.3.2 :4卡导弓 I 型传扮媒体．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．． 52 2 .4信道复用技术．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 56 2.4.1 频分复用、时分复用和统计时分复用．．…………....………………….… ..........................56 2.4.2 波分复用．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 59 2.4.3 码分复用．．．．．．．．．．．．．．．．．．．．．．．．．．．．．...........,.....................,.,.................................................... 60  • V •"}
{"doc_id": "network", "page": 7, "text": "2 .5数字传输系统．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 61 2.6 宽带接入技术．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．........................................,.......... 63  2.6.1 ADSL 技术．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．............ 63  2.6.2 光纤同轴混合网 (HFC 网）．．．．．．．．．．． ··············································•··························66 2.6.3 FTTx 技术．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，.,.,............................ 67  本序的重要概念．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．....... 69  习题．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．...............................................................,.,.,.,......... 70  第 3 章数据链路层， ······································································•······················································71 3.1 数据链路层的丿 L 个共同问题．．．．．．．．．．．．．．． .............. .............................................. 72  3.1.1 数据链路和帧，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 72 3.1.2 三个基本问题．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．．． ·········································································73 3.2 点对点协议 PPP...................................................................................................................... 78  3.2.1 PPP 协议的特点．．．．．．．．．．．．．．．，．，．． ······················································································78 3.2.2 PPP 协议的帧格式．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，.................... 80  3.2.3 PPP 协议的工作状态，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 82 3.3 使用广播信道的数据链路层 .. …............ .…………........... ..….......…… .........84  3.3.1 局域网的数据链路层．．．．．．．．．．．．．．．，．．．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． ··•······································84 3.3 .2 CSMA/CD 协议．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．............ 87  3.3 .3 使用集线器的星形拓扑 92  3.3 4 以太网的信道利用卒 ........: :............:....... .....::::::::::::::::::::::::::::::::::::::::::::;;  3.3.5 以太网的 MAC 层，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 95 3 .4扩展的以太网．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． ··········99 !:::~ ::::::；；之尸人太网 l:『 3.4.3 虚拟局域网．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． ····································································104 3.5 高速以太网．．．．．．．．．．．．．．．．．．．．．．····································································································· 106  3.5.1 IOOBASE-T 以太网．．．．．．．．．．．．．．．．．．．．．．．．， ·········································································'06 3.5.2 吉比特以太网，．．．．．．．．．．．．．．．．．．．．．．．．．．．．.............................................................................. 107  3.5.3 10 吉比特以太网 (!OGbE) 和更快的以太网 .....……...... ............…·….. 108  3.5.4 使用以太网进行宽带接入．． .......... ..................................................... 110  本竞的重要概念．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． Ill 习题．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 112 第 4 章网络层，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．................ 115  4.1 网络层的几个重要概念 115  41 1 网络层提供的两种服务 ll5  4.1.2 网络层的两个层面．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 117 42 4气勹｝：互连网络 儒 臣芦：与 MAC 地址 芦 4.2.4 地址解析协议 ARP................................................................................................... 133  • VI."}
{"doc_id": "network", "page": 8, "text": "4.2.5 IP 数据报的格式．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 136 4.3 IP 层转发分组的过程 140  4 3 1 基于终点的转发 ,:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;~~  4.3.2 最长前缀匹配 142  43 3 使用二叉线索查找转发表 . 144  4.4网际控制报文协议 ICMP...................................................................................................... 146  4 4 l ICMP 报文的种类 : .. ::::::::::::::::::::::::::::::::::::::::~;~  4.4.2 ICMP 的应用举例．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．...................... 148  4.5 IPv6........................................................................................................................................ 149  4.5.1 IPv6 的基本首部．．．．．．．．．．．............................................................................................. 150  4.5.2 IPv6 的地址，＇，．，，．．．．．．．．．．．＇，............................................................................................ 152  4.5.3 从 1Pv4 向 IPv6 过渡．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．............................................. 155  4.5.4 ICMPv6..................................................................................................................... 156  4.6 互联网的路由选择协议．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．.......................................................... 157  4.6.1 有关路由选择协议的几个基本概念．．．．．．．．…．．．．．．．．．．．．．．．…......….............…·… ............157 4.6.2 内部网关协议RJ P.................................................................................................... 159  4.6.3 内部网关协议 OSPF................................................................................................. 164  4 6 4 外部网关协议;;~~.::::: ::: : : : : : : ::::::::::::::::::::::: :::::::::::::::::::::::: :::::::::::: :: : : : : : : :::::::::::::::: ~ ;;  4.6..5 路由器的构成．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．................ 175  4.7 IP 多播．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．........................................................... 179  4.7.1 IP 多播的基本概念，.................................................................................................. 179  4.7.2 在局域网上进行硬件多播．．．．．．．．．．．．．．．．．．．．．．．．．．........................................................ 180  4.7.3 网际组管理协议 IGMP 和多播路由选择协议……．．．．“.......…………......……….....… ..181 4.8 虚拟专用网 VPN 和网络地址转换 NAT ……............…..…...,.,.........……….....,….....………… .185 4.8.1 虚拟专用网y·pN...................................................................................................... 185  4.8.2 网络地址转换，........................................................................................................... 188  4.9 多协议标签交换 MPLS........................................................................................................ 189  4 9 1 MPLS 的工作原理 , . , ::::::::::::::::::::::::::::::::::::::: ;;~  ::::~ ~~一气：书骂工s置与格式 骂 4.10 软件定义网络 SDN 简介．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．............................................. 194  本章的重要概念．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．今.................... 200  习题．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．． 202  第 5 章运输层．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．.................................................................... 21]  5 .1运输层协议概述 211  5 1.) 进程之间切通信 : ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;;;  5.1.2 运徐层的两个主要协议 213  5. l.3 运捡层的端口……．．．．．．:::：二二：： : ：／．：：／二二： :...: ：：：二二： :.: :...: : :: ：二二二： : : :::2 14  5.2 用户数据报协议 UDP.......................................................................................................... 215  5 2.I UDP 概述 ” : • 215  5.2.2 UDP 的首部格式．．．．．．．．．．．........................................................................................... 2 il 7  5.3 传输控制协议 TCP 概述 2l9  5 3 l TCP 最主要的特女 .:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;;;  . vu."}
{"doc_id": "network", "page": 9, "text": "5.3.2 TCP 的连接．．．．．．．．．．．．．．．，．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．．．．．．．..... 220  5 4 :l；靠严霖：［忑岱它覂 '.. . 百： 5.4.2 连续 ARQ协议 224  55 TCP 报文段的首部格式 : 225  5.6 TCP 可靠传输的实现，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 229 5.6.1 以宇节为单位的滑动窗口 229  5 6.2 超时重传时间的选择 ．．：厂厂．．，： : ：．．．．．．．．．．．二：：：：…．：．：．：．：．： : 二：:::…..:...: :. 233  5.6.3 选择确认 SACK........................................................................................................ 235  5.7 TCP 的流扯控制．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．............................................... 236  5.7] 利用滑动窗口实现流量控制．．．．． ···············•.............,.,,,,,,,,.........................,.,,,,,,,,,236 5.7.2 TCP 的传徐效率．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．.............. 237  5.8 TCP 的拥塞控制，．．．．．．．．．．．．．．．．．．．．．．．．．，．，．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．.... 238  ::: T拥c芒艺：；1;乞：!:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::~!~ 5.8.3 主动队列管理 AQM................................................................................................. 245  5.9 TCP 的运输连接管理 246  5 9 1 TCP 的连接建立 •• •••• 247  : : ：骂::：：::机．芦 言J重要概念 骂 第 6 章应用层．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．................................... 260  6.1 ？，气骂元概述 . :: :.. ..: .:::  汇 ｝：：：｝；名结构 : .. . :::  6.2 ;尸需，心 ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::~::  6.2.2 FTP 的基本工作原理 269  623 简单又件传送协议;;;;·:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;;~ 6.3 远程终端协议 TELNET....................................................................................................... 271  6 .4万维网 WWW....................................................................................................................... 272  641 万维网概述 • • 272  6.4.2 统一资源定位符 URL.............................................................................................. 274  6.4.3 超文本传送协议 HTTP............................................................................................ 276  6 4 4 万维网的文档 .....::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;~;  6.4.5 万维网的信息检索系统 288  6 4 6 博客和微博．................:..: :.::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;;~  6.4.7 社交网站．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．“． ...292 65 6电5二[1 邮：子邮件概述 ... , 驾 6.5.2 简单邮件传送协议 SMTP........................................................................................ 296  • vm •"}
{"doc_id": "network", "page": 10, "text": "6.5.3 电子邮件的信息格式．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．....................................,.......... 298  6.5.4 邮件读取协议 POP3 和 IMAP................................................................................. 298  6.5.5 基于万维网的电子邮件 300  6.5 6 通用互联网邮件扩充 MIME二二二二二：：．．．…．．：．：：：厂厂二二厂： …：二二： 300 6.6 动态主机配置协议 DHCP..........................................,......................................................... 304  6.7 简单网络管理协议 SNMP.................................................................................................... 306  67l 网络管理的基本概念 ,::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::;~~  6.7.2 管理信息结构 SMl................................................................................................... 308  673 管理信息库 MIB 31l  6.7.4 SNMP 的协议数据单元和报文．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 313 6,8 炽巩进f:2笠::笠需｝：程接口 ：比 6.8.2 几种常用的系统调用．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．......................................................... 318  6.9 P2P 应用．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．................................. 320  6.9. l 具有集中目录服务器的 P2P 工作方式．．：……．：：：…：．．：：：．：…．．：．．．二二二： ·. 320  6.9.2 具有全分布式结构的 P2P 文件共享程序 322  6.9.3 P2P 文件分发的分析．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．.............. 324  6.9.4 在 P2P 对等方中搜索对象．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．． 325 ;:的重要概念 . , 芦 第 7 章网络安全．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 334 7.1 网络安全问题概述 334  7l l 计算机网络面临的安全性威胁 , 334  7.1.2 安全的计算机网络 336  713 数据加密模型 337  7.2 勹气::钥密码体制 .. : 芦 7.2.2 公钥密码体制．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．··········................,....... 339  7 3,:1} 报丈鉴别 ,:, . 罚 7.3.2 实体鉴别， ··················································································································346 7 .4密钥分配．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 348 7.4.1 对称密钥的分配，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．｀ ｀＇，＇｀＇＇，昌 ',,.........',..,,..................................348 7.4.2 公钥的分配．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 350 7.5 气勹扂巨扂 ,, 驾 ;:: ：：：：：二：： ：名 7.6 系统安全：防火墙与入侵检测．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 364 7.6.1 防火墙．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 364 7.6.2 入侵检测系统．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．................................................... 365  卢；：：：：发展方向 , :::  •IX•"}
{"doc_id": "network", "page": 11, "text": "习题．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 368 第 8 章 互联网上的音频／视频服务．．．............................................................................................... 370  8.1 概述，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．................................................................. 370  8.2 流式存储音频／视频．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．，．，．，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 374 8.2.1 具有元文件的万维网服务器．．．．．．．．．．．．．．．．．．， ..................................................... 375  8.2.2 媒体服务器．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．···•·•·•·...................................................................... 375  8 3 ;2三芦／，已：协议 RTSP 骂 8.3.1 IP 电话概述．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 379 8.3.2 IP 电话所需要的几种应用协议． .........…………......................……… .........383  8.3.3 实时运输协议 RTP................................................................................................... 384  8.3.4 实时运扴控制协议 RTCP......................................................................................... 386  ::~:~芦起协议s·iP:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::． 骂 8 .4改进“尽最大努力交付＂的服务 390  8.4. 1 4吏互联网提供服务质量．．．．：．．．．：．：．．．．．．．．：：：．．：．．．．：：：：．：．：．：．呻．．…．． ．．二二：：．．．： : ·:.. 390  8.4.2 调度和管制机制．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． ····························•·•··········392 8.4.3 综合服务 ln t Serv 与资源预留协议 RSVP. …..…............崎.................…… ..................395 8.4.4 区分服务 D iftS erv.................................................................................................... 398  本章的重要概念，．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． ·········································400 习题．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． 401 第 9 章 无线网络和移动网络．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．哼 ·········································405 9.1 :.~局勹2骂的组成 ... ... . 二 9.1.2 802.11 局域网的物理层．．．．．．．．．．．．．．．．.......................................................................... 41 I  9.1.3 802.11 局域网的 MAC 层协议 412  9 l.4 802. l l 局域网的 MAC 帧．．． :.........: :........: : : : : :...: ...: : :........: : : : :...:.:.: ·. 4 1 8  9.2 无线个人区域网 WPAN....................................................................................................... 422  9 .3蜂窝移动通信网．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．......... 425  9.3.1 蜂窝无线通信技术的发展简介 ............…...........................… ....................425  9.3.2 LTE 网络与互联网的连接．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．“． ........................................432 94 『4气 IP移动 IP 的基本概念 ..: : .:. $  9.4.2 移动网络对高层协议的影响 440  9.5 移动通信的展望．．．． ................: : : : : : :.:.:..::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::~~~  言勺重要概念 . .. . ::}  附录 A 部分习题的解答．．．．．．．．．．．．．．．．．．．．．．.............................................................................................. 445  附录 B 英文缩写词．．．．．．．．．．．．．．．．．．．．．．．．．．．．．． ······························································································461 附录 C 参考文献与网址．．．．．．．．．．．．．．．．．．．．．．兰............................................................................................. 472  • X."}
{"doc_id": "network", "page": 12, "text": "第 1 章概述 视桢讲解 本章是全书的概要。在本添的开始，先介绍计算机网络在信息时代的作用。接着对互 联网进行概述，包括互联网基础结构发展的三个阶段以及今后的发展趋势。然后，讨论互联 网组成的边缘部分和核心部分。在简单介绍计算机网络仆我国的发展以及计笃机网络的类别 后，讨论计算机网络的性能指标。最后，论述整个课程都要用到的重要概念-计算机网络 的体系结构。 本章砓正＇反的内容是： (I)互联伈边缘部分和才～部分的作用，其中包含分组交换的概念。 (2) 计算机网络的性能指标。 (3) 计算机网络分层次的体系结构，包含协议和服务的概念。这部分内容比较抽象。在 没有了解具体的计算机网络之前，很难完全掌握这些很抽象的概念。但这些抽象的概念又能 够指导后续的学习，因此也必须先从这些概念学起。建议读者在学习到后续竞节时，经常再 复习一下本章中的基本概念。这对掌握好整个计算机网络的概念是有益的。 1.1 计算机网络在信息时代中的作用 我们知道， 21 世纪的一些重要特征就是数字化、网络化和信息化，它是一个以网络为 核心的信息时代。要实现信息化就必须依靠完善的网络，因为网络可以非常迅速地传递信息。 网络现在已经成为信息社会的命脉和发展知识经济的重要基础。网络对社会生活和经济发展 的很多方面已经产生了不可估搅的影响。 有三大类大家很熟悉的网络，即电信网络、有线电视网络和计算机网络。按照最初的 服务分工，电信网络向用户提供电话、电报及传真等服务；有线电视网络向用户传送各种电 视节目；计算机网络则使用户能够在计算机之间传送数据文件。这三种网络在信息化过程中 都起着十分重要的作用，但其中发展最快并起谘核心作用的则是计算机网络，而这正是本书 所要讨论的内容。 随着技术的发展，电信网络和有线电视网络都逐渐融入了现代计算机网络的技术，扩 大了原有的服务范围，而计算机网络也能够向用户提供电话通信、视频通信以及传送视频节 目的服务。从理论上讲，把上述三种网络融合成一种网络就能够提供所有的上述服务，这就 是很早以前就提出来的“三网融合”。然而事实并不如此简单，因为这涉及各方面的经济利 益和行政管辖权的问题。 20 世纪 90 年代以后，以 In terne t为代表的计算机网络得到了飞速的发展，已从最初的 仅供美国人使用的免费教育科研网络逐步发展成为供全球使用的商业网络（有偿使用），成 为全球最大的和最重要的计算机网络。可以毫不夸大地说， ln t emet是人类自印刷术发明以 来在存储和交换信息领域的最大变革。 Interne t的中文译名并不统一。现有的 In t erne t译名有两种： (1) 因特网，这个译名是全国科学技术名词审定委员会推荐的。虽然因特网这个译名较 . l."}
{"doc_id": "network", "page": 13, "text": "为准确，但却长期未得到推广。本书的前几版都采用因特网这个译名。 (2) 互联网，这是目前流行最广的、事实上的标准译名。现在我国的各种报刊杂志、政 府文件以及电视节目中都毫无例外地使用这个译名。 In terne t是由数量极大的各种计算机网 络互连起来的，采用互联网这个译名能够体现出 In t erne t最主要的特征。本书从第 7 版开始， 改用“互联网”作为 In terne t的译名。 也有些人愿意直接使用英文名词 In ternet,而不使用中文译名。这避免了译名的误解。 但编者认为，在中文教科书中，常用的重要名词应当使用中文的。当然，对国际通用的英文 缩写词，我们还是要尽量多使用。例如，直接使用更简洁的 “TCP\", 比使用冗长的中文译 名“传输控制协议“要方便得多。这样做也更加便于阅读外文技术资料。 曾有人把 In t erne t译为国际互联网。其实互联网本来就是覆盖全球的，因此“国际”二 字显然是多余的。 对于仅在局部范围互连起来的计算机网络，只能称之为互连网，而不是互联网 In ternet。 有时，我们往往使用更加简洁的方式表示互联网，这就是只用一个 “网”字。例如， “上网”就是表示使用某个电子设备连接到互联网，而不是连接到其他的网络上。还有如网 民、网吧、网银（网上银行）、网购（网上购物），等等。这里的“网”，一般都不是指电信 网或有线电视网，而是指当今世界上最大的计算机网络 In terne t－互联网。 那么，什么是互联网呢？很难用几句话说清楚。但我们可以从两个不同的方面来认识 互联网。这就是互联网的应用和互联网的工作原理。 绝大多数人认识互联网都是从接触互联网的应用开始的。现在很小的孩子就会上网玩 游戏、看网上视频，或和朋友在社交软件上聊天。人们经常利用互联网的社交电子邮件相互 通信（包括传送各种照片和视频文件），这就使得传统的邮政信函的业务扭大大减少。许多 商品现在都可以在互联网上购买，既方便又经济实惠，改变了必须去实体商店的传统购物方 式。在互联网上购买机票、火车票或预订酒店都非常方便，可以节省大蜇出行排队的时间。 过去各银行的大厅内往往拥挤不堪，但现在这种情况已经得到了明显的改善，因为原来人们 必须到银行进行的业务，基本上都可以改为在家中的网上银行进行操作。现在只要携带一个 接入到互联网的智能手机就可以非常方便地付款，而不必使用现金或刷卡支付。必须指出， 现在互联网的应用范围早已大大超过当初设计互联网时的几种简单的应用，并且各种意想不 到的新的应用总是不断地在出现。本书不可能详细地介绍互联网的各种应用，这需要有另一 本专门的书。 互联网之所以能够向用户提供许多服务，就是因为互联网具有两个重要基本特点，即 连通性和共享。 所谓连通性(connecti v ity),就是互联网使上网用户之间，不管相距多远（例如，相距数 千公里），都可以非常便捷、非常经济地（在很多情况下甚至是免费的）交换各种信息（数 据，以及各种音频、视频），好像这些用户终端都彼此直接连通一样。这与使用传统的电信 网络有着很大的区别。我们知道，传统的电信网向用户提供的最重要的服务就是人与人之间 的电话通信，因此电信网也具有连通性这个特点。但使用电信网的电话用户，往往要为此向 电信网的运营商缴纳相当昂贵的费用，特别是长距离的越洋通信。但应注意，互联网具有虚 拟的特点。例如，当你从互联网上收到一封电子邮件时，你可能无法准确知道对方是谁（朋 友还是骗子），也无法知道发信人的地点（在附近，还是在地球对面）。 所谓共享就是指资源共享。资源共享的含义是多方面的，可以是信息共享、软件共享， • 2."}
{"doc_id": "network", "page": 14, "text": "也可以是硬件共享。例如，互联网上有许多服务器（就是—种专用的计算机）存储了大址有 价值的电子文档（包括音频和视频文件），可供上网的用户很方便地读取或下载（无偿或有 偿）。由于网络的存在，这些资源好像就在用户身边一样，使用非常方便。 现在人们的生活、工作、学习和交往都已离不开互联网。设想一下，某一天我们所在 城市的互联网突然瘫痪不能工作了，会出现什么结果呢？这时，我们既不能上网查询有关的 资料，也无法使用微信或电子邮件与朋友及时交流信息，网上购物也将完全停顿。我们无法 购买机票或火车票，因为即使是在售票处工作的售票员，也无法通过互联网得知目前还有多 少余票可供出售。我们不能到银行存钱或取钱，无法交纳水电费和煤气费等。股市交易也将 停顿。在图书馆我们检索不到所需要的图书和资料。可见，人们的生活越依赖互联网，互联 网的可靠性也就越重要。现在互联网已经成为社会最为应要的基础设施之一。 现在常常可以看到一种新的提法，即“互联网＋＂。它的意思就是“互联网＋各个传统行 业”，因此可以利用信息通信技术和互联网平台来创造新的发展生态。实际上“互联网＋＂ 代表一种新的经济形态，其特点就是把互联网的创新成果深度融合十经济社会各领域之中， 这就大大地提升了实体经济的创新力和生产力。我们也必须看到互联网的各种应用对各行各 业的巨大冲击。例如，电子邮件迫使传统的电报业务退出市场，网络电话的普及使得传统的 长途电话（尤其是国际长途电话）的通信量急剧下降，对日用商品快捷方便的网购造成了不 少实体商店的停业，网约车的问世对出租车行业产生了巨大的冲击，网上支付的飞速发展使 得很多银行的营业厅变得冷冷消清。这些例子说明互联网应用已对整个社会的各领域产生了 很大的影响。 互联网也给人们带来了一些负面影响。有人肆意利用互联网传播计算机病毒，破坏互 联网上数据的正常传送和交换；有的犯罪分子甚至利用互联网窃取国家机密和盗窃银行或储 户的钱财；网上欺诈或在网上肆意散布谣言、不良信息和播放不健康的视频节目也时有发生； 有的青少年弃学而沉溺于网吧的网络游戏中：等等。 虽然如此，但互联网的负面影响毕竞还是次要的。随着对互联网管理的加强，我们可 以使互联网给社会带来正面积极的作用成为互联网的主流。 由千互联网已经成为世界上最大的计算机网络，因此下面我们先对互联网进行一下概 述，包括互联网的主要构件，这样就可以对计算机网络有一个最初步的了解。 1.2 互联网概述 1.2.1 网络的网络 起源千美国的互联网哼见已发展成为世界上最大的覆盖全球的计算机网络。 我们先给出关于网络、互连网、互联网（因特网）的一些圾基本的概念。 ＠注． 1994 年全国自然科学名词审定委员会公布的名词中，interconnecti on 是“互连“.interconnec tion ne twork 是“互连 网络',intemetwork i ng是“网际互连 ”[MINGCl94] 。但 1997 年 8 月全国科学技术名词审定委员会在其推荐名（一）中，将 internet, internetwork, interconnection ne t work 的译名均推荐为“且联网”，而在注释中说”又称互连网”，即“互联网”与“互连 网”这两个名词均可使用，但诺注意，“联”和＂迕＂井不是同义字。术语“互连”一定不能用“互联”代替．｀｀连接”也一定不 能用“联接”代替． • 3."}
{"doc_id": "network", "page": 15, "text": "请读者注意：为了方便，在本书中，“网络”往往就是＂计算机网络”的简称，而不是 表示电信网或有线电视网。 计算机网络（简称为网络）由若干节点(node 评和连接这些节点的链路(link) 组成。网络 中的节点可以是计算机、集线器、交换机或路由器等（在后续的两章我们将会介绍集线器、 交换机和路由器等设备的作用）。图 1-1 (a) 给出了一个具有四个节点和三条链路的网络。我 们看到，有三台计算机通过三条链路连接到一个集线器上。这是一个非常简单的计算机网络 （可简称为网络）。又如，在图 1-l(b) 中，有多个网络通过一些路由器相互连接起来，构成 了一个覆盖范围更大的计算机网络。这样的网络称为互连网(in t erne twork 或in terne t)。因此互 连网是“网络的网络 ”(network of ne tworks) 。用一朵云表示一个网络的好处，就是可以先不 考虑每一个网络中的细节，而是共中精力讨论与这个互连网有关的一些问题。 图例 计算机网络（网络） 兰已 0 计算机 集线器 路由器 网络 /:  (a)  互连网（网络的网络） ．．．．．，、、、 ~ •·•••••· 、、 、、 芷 、....... (b)  图 1-1 简单的网络(a) 和由网络构成的互连网（b) 请读者注意，当我们使用一朵云来表示网络时，可能会有两种不同的情况。一种情况 如图 1-1 (a) 所示，用云表示的网络已经包含了网络中的计算机。但有时为了讨论问题的方便 （例如，要讨论几个计算机之间如何进行通信），也可以把有关的计算机画在云的外面，如 图 1-2 所示。习惯上，与网络相连的计算机常称为主机(hos t)。在互连网中不可缺少的路由 器，是一种特殊的计算机（有中央处理器、存储器、操作系统等），但不能称为主机。 1 主机 - L  基 图 1-2 互连网与所连接的主机 这样，我们初步建立了下面的基本概念： 网络把许多计算机连接在一起，而互连网则把许多网络通过一些路由器连接在一起。 与网络相连的计算机常称为主机。 ＠注．根据[M !N GCl94] 第 112 页，名词 node 的标准译名是：节点 08.078, 结点 12.023 。相夼一下 12.023 这一节是计算 机网络，因此，在计符机网络领域， node 显然应当译为结点，而不是节点。但不知由千何种原因，在网络领城中，标准译名 “结点”一直未得到推广．考虑到与大多数中文资料中的 node 译名保持一致，木书从第 8 版起也采用“节点”这个非标准译名。 • 4."}
{"doc_id": "network", "page": 16, "text": "还有一点也必须注意：网络互连并不仅仅是把计算机简单地在物理上连接起来，因为 这样做并不能达到计算机之间能够相互交换信息的目的。我们还必须在计算机上安装许多使 计算机能够交换信息的软件才行。因此当我们谈到网络互连时，就隐含地表示在这些计算机 上已经安装了可正常工作的适当软件，在计算机之间可以通过网络交换信息。 现在仗用智能手机上网已非常普遍。由于智能手机包含中央处理器、存储器以及操作 系统，因此，从计算机网络的角度看，连接在计算机网络上的智能手机也相当于一个主机。 实际上，智能手机已远远不是个单一功能的设备，它既是电话机，同时也是计算机、照相机、 摄像机、电视机、导航仪等综合多种功能于一体的智能机器。同理，连接在计算机网络上的 智能电视机，也是计算机网络上的主机。 1.2.2 互联网基础结构发展的三个阶段 互联网的基础结构大体上经历了三个阶段的演进。但这三个阶段在时间划分上并非截 然分开而是有部分重叠的，这是因为网络的演进是逐步的，而并非在某个日期发生了突变。 第～阶段是从单个网络 ARPANET 向互连网发展的过程。 1969 年美国国防部创建的第 一个分组交换网 ARPANET 最初只是一个单个的分组交换网（并不是一个互连的网络）。所 有要连接在 ARPANET 上的主机都直接与就近的节点交换机相连。但到了 20 世纪 70 年代 中期，人们已认识到不可能仅使用一个单独的网络来满足所有的通信需求。千是 ARPA 开 始研究多种网络（如分组无线电网络）互连的技术，这就导致了互连网络的出现，成为现今 互联网(In t erne t)的雏形。 1983 年 TCP/I P 协议成为 ARPANET 上的标准协议，使得所有使用 TCP/IP协议的计算机都能利用互连网相互通信，因而人们就把 1983 年作为互联网的诞生时 间。 1990 年 ARPANET 正式宣布关闭，因为它的实验任务已经完成。 诮读者注意以下两个意思相差很大的名词in terne t和 In terne t [RFC 1208):  以小写字母 1 开始的i nterne t（互连网）是一个通用名词，它泛指由多个计算机网络互 连而成的计算机网络。在这些网络之间的通信协议（即通信规则）可以任意选择，不一定非 要使用 TCP/TP 协议。 以大写字母 I 开始的 In terne t（互联网，或因特网）则是一个专用名词，它指当前全球 最大的，开放的、由众多网络相互连接而成的特定互连网，它采用 TCP/IP 协议族作为通信 的规则，且其前身是美国的 ARPANET 。 可见，任总把几个计算机网络互连起来（不管采用什么协议），并能够相互通信，这样 构成的是一个互连网(i n terne t),而不是互联网(in terne t)。 第二阶段的特点是建成了三级结构的互联网。从 1985 年起，美国国家科学基金会 NSF (National Science Foundati on) 就围绕六个大型计算机中心建设计笃机网络，即国家科学基金 网 NSFNET 。它是一个三级计算机网络，分为主干网、地区网和校园网（或企业网）。这种 三级计算机网络覆盖了全美国主要的大学和研究所，并且成为互联网中的主要组成部分。 1991 年， NSF 和美国的其他政府机构开始认识到，互联网必将扩大其使用范围，不应仅限 于大学和研究机构。世界上的许多公司纷纷接入到互联网，网络上的通信揽急剧增大，使互 联网的容榄已满足不了需要。于是美国政府决定把互联网的主干网转交给私人公司来经营， 并开始对接入互联网的单位收费。 1992 年互联网上的主机超过 100 万台。 1993 年互联网主 干网的速率提高到 45 Mbit/s (T3 速率）。 • 5."}
{"doc_id": "network", "page": 17, "text": "为什么要使用这种三级结构呢？这是因为互联网必须能够让连接到互联网的所有用户 都可以相互通信。但是一个普通的校园网或企业网单靠本身力量并不可能做到这一点，因为 要实现如此多的连接需要巨大的投资。于是就出现了上面两层的地区网和主干网。地区网可 以完成本地区管辖范围内各校园网或企业网之间的相互通信，而主干网可以使不同地区之间 的用户相互通信。 第三阶段的特点是逐渐形成了全球范围的多层次 ISP 结构的互联网。从 1993 年开始， 由美国政府资助的 NSFNET 逐渐被若干个商用的互联网主干网替代，而政府机构不再负责 互联网的运营。这样就出现了一个新的名词：互联网服务提供者 ISP (Internet Service  Prov i der) 。在许多情况下，互联网服务提供者 ISP 就是一个进行商业活动的公司，因此 ISP 又常译为互联网服务提供商。例如，中国电信、中国联通和中国移动等公司都是我国最有名 的 ISP 。 互联网服务提供者 ISP 可以从互联网管理机构申请到很多 1P 地址（互联网上的主机都 必须有 IP 地址才能上网，这一概念我们将在第 4 章的 4.2.2 节详细讨论），同时拥有通信线 路（大 ISP 自已建造通信线路，小 ISP 则向电信公司租用通信线路）以及路由器等连网设备， 因此任何机构和个人只要向某个 ISP 交纳规定的费用，就可从该 ISP 获取所需 IP 地址的租 用权，并可通过该 ISP 接入互联网。所谓“上网”就是指“（通过某 ISP 获得的 IP 地址）接 入互联网”。 IP 地址的管理机构不会把单个的 IP 地址零星地分配给单个用户，而是把整块 的 IP 地址有偿租赁给经审查合格的 ISP 。由此可见，现在的互联网已不是某个单个组织所 拥有而是全世界无数大大小小的 ISP 所共同拥有的，这就是互联网也称为“网络的网络”的 原因。 根据提供服务的覆盖面积大小以及所拥有的 IP 地址数目的不同， ISP 也分为不同层次 的 ISP: 主干 ISP 、地区 ISP 和本地 ISP 。目前已经覆盖全球的互联网，其主干 ISP 只有十几 个，但本地 ISP 有好几十万个。 主干 ISP 由几个专门的公司创建和维护，服务面积最大（一般都能够稷盖国家范围）， 并且还拥有高速主干网（例如 10 Gb it/ s 或更高）。不同的网络运营商都有自己的主干 ISP 网 络，并且可以彼此互通。 地区 ISP 是一些较小的 lSP 。这些地区 ISP 通过一个或多个主干 ISP 连接起来。它们位 千等级中的第二层，数据率也低一些。 本地 ISP 给用户提供直接的服务（这些用户有时也称为端用户，强调是末端的用户）。 本地 TSP 可以连接到地区 ISP, 也可直接连接到主干 ISP 。绝大多数的用户都是连接到本地 ISP 的。本地 ISP 可以是一个仅仅提供互联网服务的公司，也可以是一个拥有网络并向自己 的雇员提供服务的企业，或者是一个运行自己的网络的非营利机构（如学院或大学）。 图 1-3 是具有三层 ISP 结构的互联网的概念示意图，但这种示意图并不表示各 ISP 的地 理位置关系。图中给出了主机 A 经过许多不同层次的 TSP 与主机 B 通信的示意图。 随着互联网上数据流量的急剧增长，人们开始研究如何更快地转发分组，以及如何更 加有效和更加经济地利用网络资源。千是，互联网交换点 IXP (Internet eXchan ge Poi n t)就应 运而生了。 • 6."}
{"doc_id": "network", "page": 18, "text": "产＿＿尸严/  大 举例：主机A 一本地 ISP-+ 地区 ISP 一主：「 ISP-+ 地区 ISP 一本地 ISP 一主机B 图 1-3 具有三层 ISP 结构的互联网的概念示意图 互联网交换点 IXP 的主要作用就是允许两个网络直接相连并交换分组，而不需要再通 过第三个网络来转发分组。例如，在图 1-3 中右方的两个地区 ISP 通过一个 IXP 连接起来了。 这样，主机 A 和主机 B 交换分组时，就不必再经过最上层的主干 ISP, 而是直接在两个地 区 ISP 之间用高速链路对等地交换分组。这样就使互联网上的数据流僵分布更加合理，同时 也减少了分组转发的迟延时间，降低了分组转发的费用。现在许多 IXP 在进行对等交换分 组时，都互相不收费。但本地 ISP 或地区 ISP 通过 IXP 向高层的 IXP 转发分组时，则需要 交纳一定的费用。 IXP 的结构非常复杂。典型的 TXP 由一个或多个网络交换机组成，许多 ISP 再连接到这些网络交换机的相关端口上。 IXP 常采用工作在数据链路层的网络交换机， 这些网络交换机都用局域网互连起来。 据 [W-PCH] 2020 年 8 月的统计，全球已经有 1064 个 IXP, 其中我国拥有 32 个（北京 6 个，上海 5 个，广州 4 个，香港 9 个，台湾 8 个）。现在世界上较大的 IXP 的峰值吞吐量都 在 Tbit/s 的量级。例如建造在德国的法兰克福的名为 DE-CIX 的 IXP, 是互联网在欧洲的枢 纽， 2020 年 8 月统计的峰值吞吐量就已达到 7.72 Tb it/s 。 这里特别要指出的是，当前互联网上最主要的流揽就是视频文件的传送。图 1-3 中左上 角所示的内容提供者(con tent prov i der) 是在互联网上向所有用户提供视频文件的公司。这种 公司和前面提到的 ISP 不同，因为他们并不向用户提供互联网的转接服务，而是提供视频内 容的服务。由于传送视频文件产生的流量非常大，为了提高数据传送的效率，这些公司都有 独立千互联网的专门网络（仅承载出入该公司的服务器的流位），并且能够和各级 ISP 以及 IXP 相连。这就使得互联网上的所有用户能够更加方便地观看网上的各种视频节目。现在许 多 ISP 已不仅向用户提供互联网的接入服务，而且还提供信息服务和一些增值服务。 互联网已经成为世界上规模最大和增长速度最快的计笃机网络，没有人能够准确说出 互联网究竞有多大。互联网的迅猛发展始千 20 世纪 90 年代。由欧洲原子核研究组织 CERN 开发的万维网 WWW (World Wide Web)被广泛使用在互联网上，大大方便了广大非网络专 业人员对网络的使用，成为互联网的这种指数级增长的主要驱动力。万维网的站点数目也急 剧增长。互联网上准确的通信量是很难估计的，但有文献介绍，互联网上的数据通信量每月 • 7."}
{"doc_id": "network", "page": 19, "text": "约增加 10% 。在 2005 年互联网的用户数超过了 10 亿，在 2010 年超过了 20 亿，在 2014 年 已接近 30 亿，截止到 2019 年 3 月底，互联网的用户数已超过了 43.8 亿。 1.2.3 互联网的标准化工作 互联网的标准化工作对互联网的发展起到了非常重要的作用。我们知道，标准化工作 的好坏对一种技术的发展有若很大的影响。缺乏国际标准将会使技术的发展处千比较混乱的 状态，而盲目自由竞争的结果很可能形成多种技术体制并存且互不兼容的状态（如过去形成 的彩电三大制式），给用户带来较大的不方便。但国际标准的制定又是一个非常复杂的问题， 这里既有很多技术问题，也有很多属于非技术问题，如不同厂商之间经济利益的争夺问题等。 标准制定的时机也很重要。标准制定得过早，由于技术还没有发展到成熟水乎，会使技术比 较陈旧的标准限制了产品的技术水平。其结果是以后不得不再次修订标准，造成浪费。反之， 若标准制定得太迟，也会使技术的发展无堂可循，造成产品的互不兼容，也不利千产品的推 广。 1992 年由于互联网不再归关国政府管辖，因此成立了一个国际性组织叫作互联网协会 (Internet Soc i e ty,简称为 !SOC) [W-ISOC],以便对互联网进行全面管理以及在世界范围内促 进其发展和使用。 TSOC 下面有一个技术组织叫作互联网体系结构委员会 IAB (Internet  Architecture BoardtD, 负责管理互联网有关协议的开发。 IAB 下面又设有两个工程部： (l) 互联网工程部 IETF (Internet Engineering Task Force)  IETF 是由许多工作组 WG (Wor灿 n g Group)组成的论坛(forum), 具体工作由互联网工程 指导小组 IESG (Internet Engineering Steering Group)管理。这些工作组划分为若干个领域 (area), 每个领域集中研究某一特定的短期和中期的工程问题，主要针对协议的开发和标准 化。 (2) 互联网研究部 !RTF (Internet Research Task Force)  [RTF 是由一些研究组 RG (Research Group)组成的论坛，具体工作由互联网研究指导小 组 IRSG (Internet Research Steering Group)管理。 IRTF 的任务是研究一些需要长期考虑的问 题，包括互联网的一些协议、应用、体系结构等。 互联网在制定其标准上很有特色，其中的一个很大的特点是面向公众。所有的互联网 标准都是以 RFC 的形式在互联网上发表的。 RFC (Request For Comment s) 的意思就是“请求 评论”。所有的 RFC 文档都可从互联网上免费下载[W-RFC],而且任何人都可以用电子邮件 随时发表对某个文档的意见或建议。这种开放方式对互联网的迅速发展影响很大。但应注意， 并非所有的 RFC 文档都是互联网标准。互联网标准的制定往往要花费漫长的时间，并且是 一件非常慎重的工作。只有很少部分的 RFC 文档最后才能变成互联网标准。 RFC 文档按发 表时间的先后编上序号（即 RFC xxxx, 这里的 xxxx 是阿拉伯数字）。一个 RFC 文档更新后 就使用一个新的编号，并在文档中指出原来老编号的阳RFC 文档已成为陈旧的或被更新，但 陈旧的 RFC 文档并不会被删除，而是永远保留着，供用户参考。现在 RFC 文档的数量增长 得很快，到 2020 年 8 月 RFC 的编号就已经达到 8881 了。 ＠注：砐初的 IAB 中的 A 衍经代表 Acti v ities （活动）。在一些旧的 RFC 中使用的是这个旧名词． • 8."}
{"doc_id": "network", "page": 20, "text": "制定互联网的正式标准要经过以下三个阶段： (I) 互联网草案(In terne t Dra ft)一互联网草案的有效期只有六个月。在这个阶段还不能 红是 RFC 文档。 (2) 建议标准(Pro p osed S tandard) 一一从这个阶段开始就成为 RFC 文档。 (3) 互联网标准(In terne t Standard)- 如果经过长期的检验，证明了某个建议标准可以 成为互联网标准时，就给它分配一个标准编号，记为 STDxx, 这里 STD 是 “Stan dard\" 的 英文缩写，而 “xx\" 是标准的编号（行时也写成 4 位数编号，如 STD0005) 。一个互联网 标准可以和多个 RFC 文档关联。 原先制定互联网标准的过程是：“建议标准”一“草案标准”一“互联网标准＂。由千 “草案标准”容易和成为RfC 文档之前的“互联网草案”混淆，从 201 l 年 10 月起取消了 “草案标准”这个阶段[RFC 6410] 。这样，现在制定互联网标准的过程简化为：“建议标准” 一“互联网标准”。在新的规定以前就已发布的草案标准，将按照以下原则进行处理：若已 达到互联网标准，就升级为互联网标准；对目前尚不够互联网标准条件的，则仍称为发布时 的旧名称“草案标准”。我们可以很方便地在网上查到有哪些 RFC 文档是互联网标准 [W­ RFCS] 。截止到 2019 年 11 月，互联网标准的奻大编号是 STD92 。可见要成为互联网标准还 是很不容易的。 除了建议标准和互联网标准这两种 RFC 文档，还有三种RfC 文档，即历史的、实验的 和提供信息的 RFC 文档。历史的 RFC 文档或者是被后来的规约所取代，或者是从未达到必 要的成熟等级因而始终未变成为互联网标准。实验的 RFC 文档表示其工作处千正在实验的 悄况，而不能够在任何实用的互联网服务中进行实现。提供信息的 RFC 文档包括与互联网 有关的一般的、历史的或指导的信息。 RFC 文档的数茄很大，为便千查找，最好利用索引文件 “RFC INDEX\" [W-RFCX] 。这 个索引文件一直在不断更新，它给出了迄今已发布的所有的 RFC 文档的标题、发表时间、 类别，以及这个 RFC 文档更新了哪个老的 RFC 文档，或者被在它以后发表的哪个 RFC 文 档更新了。这个文件按 RFC 编号的顺序是大编号在前而小编号在后，也就是把最新编号的 RFC 文档放在最前面，便于大家最先行到最新的 RFC 文档。 1.3 互联网的组成 互联网的拓扑结构虽然非常复杂，并且在地理上覆盖了全球，但从其 工作方式上看，可以划分为以下两大块： 视频讥解 (1) 边缘部分 由所有连接在互联网上的土机组成。这部分是用户直接使用的，用来进 行通信（传送数据、音频或视频）和资源共享。 (2) 核心部分 由大性网络和连接这些网络的路由器组成。这部分是为边缘部分提供服 务的（提供连通性和交换）。 图 1-4 给出了这两部分的示意图。下面分别讨论这两部分的作用和工作方式。 • 9."}
{"doc_id": "network", "page": 21, "text": "|  主机 ·································、 一 二···,. • • ·．一 己 网络路已； o 竺i .0 工 0 一』已。竺。已 l ··························一 I 互联网的边缘部分 1 二 文 巳 」 L一己 图 1.4 互联网的边缘部分与核心部分 1.3.1 互联网的边缘部分 处在互联网边缘的部分就是连接在互联网上的所有的主机。这些主机又称为端系统(end s y s tem),“ 端”就是“末端＂的意思（即互联网的末端）。端系统在功能上可能有很大的差 别，小的端系统可以是一台普通个人电脑（包括笔记本电脑或平板电脑）和具有上网功能的 智能手机，甚至是一个很小的网络摄像头（可监视当地的天气或交通情况，并在互联网上实 时发布），而大的端系统则可以是一台非常昂贵的大型计算机（这样的计笃机通常称为服务 器 server) 。端系统的拥有者可以是个人，也可以是单位（如学校、企业、政府机关等），当 然也可以是某个 ISP （即 ISP 不仅仅是向端系统提供服务，它也可以拥有一些端系统）。边 缘部分利用核心部分所提供的服务，使众多主机之间能够互相通信并交换或共享信息。值得 注意的是，现今大部分能够向网民提供信息检索、万维网浏览以及视频播放等功能的服务器， 都不再是一个孤立的服务器，而是屈千某个大型数据中心。例如，谷歌公司 (Goog le) 拥有上 百个数据中心，而其中的 15 个大型数据中心的每一个都拥有 10 万台以上的服务器。又如， 我国的百度公司在山西阳泉建造的数据中心拥有 16 万台服务器。 我们先要明确下面的概念。我们说：“主机 A 和主机 B 进行通信“，实际上是指：“运行 在主机 A 上的某个程序和运行在主机 B 上的另一个程序进行通信”。由于“进程”就是“运 行着的程序＂，因此这也就是指：“主机 A 的某个进程和主机 B 上的另一个进程进行通信”。 这种比较严密的说法通常可以简称为“计算机之间通信”。 在网络边缘的端系统之间的通信方式通常可划分为两大类：客户－服务器方式 (C/S 方 式）和对等方式 (P2P 方式) (!)。下面分别对这两种方式进行介绍。 1. 客户－服务器方式 这种方式在互联网上是最常用的，也是传统的方式。我们在上网发送电子邮件或在网 站上查找资料时，都使用客户－服务器方式（有时写为客户／服务器方式）。 当我们打电话时，电话机的振铃声使被叫用户知道现在有一个电话呼叫。计算机通信 的对象是应用层中的应用进程，显然不能用响铃的办法来通知所要找的对方的应用进程。然 (i)注： C/S 方式表示 C li en t/Server 方式，印 P 方式表示 Peer- t o-Peer 方式。有时还可看到另外一种叫作浏览器－服务器方式， 即 8/S 方式 (Browser/Server 方式），但这仍然是C/S 方式的一种特例． • 10 •"}
{"doc_id": "network", "page": 22, "text": "I  而采用客户－服务器方式可以使两个应用进程能够进行通信。 客户（cl i en t)和服务器 (server) 都是指通信中所涉及的两个应用进程。客户－服务器方式所 描述的是进程之间服务和被服务的关系。在图 1-5 中，主机 A 运行客户程序而主机 B 运行 服务器程序。在这种悄况下， A 是客户而 B 是服务器。客户 A 向服务器 B 发出请求服务， 而服务器 B 向客户 A 提供服务。这里垃主要的特征就是： 客户是服务请求方，服务器是服务提供方。 服务诘求方和服务提供方都要使川网络核心部分所提供的服务。 ··••••••••••··  运 h 客户程 I(· 令.. •••••• , ~五王I ··-.i.、气． x·A ~一·.、、 卢六：二广：？？务器程／f r 网络核心 取分器．；． ．｀、｀．＝己 I 一噜．．． 、·、---—,.. ······••.............  图 1.5 客户－l 服务器上作方式 在实际应用中，客户程｝f和服务器程序通常还具有以下一些七要特点。 客户程序： (I) 被用户调川后运行，仆通信时屯动向远地服务器发起迪信（请求服务）。囚此，客 户程序必须知道服务器程序的地址。 (2) 不盂要特殊的硬件和很复杂的橾作系统。 服务器程序： (l)足一种倒］用来捉供某种服务的程序，可同时处理多个远地或本地客户的讲求。 (2) 系统启动）百 [!I] 一肛不断地运行打，被动地等待并接受来自各地的吝户的通信诸求。 囚此，服务器程序不而要知追客户程序的地址。 (3) 一般盂要有强大的硬件和高级的操作系统支持。 客户勹服务器的通信关系建立后，通信可以是双向的，客户和服务器都可发送和接收 数据。 顺便耍说一下，上面所说的客户和服务器本来都指的是计算机进程（软件）。使用计算 机的人是计殍机的“用户 ”(user) 而不是“客户 ”(cl i en t)。但在许多国外文献中，经常也把 运行客户程序的机器称为 cl i en t（在这种情况下也可把 cl i en t译为“客户机”），把运行服务 器程序的机器也称为 server 。因此我们应当根据上下文来判断 cl i en t或 server 是指软件还是 硬件。在本书中，在表示机器时，我们也使川“客户端＂ （或“客户机”)或“服务器端” （或服务器）来表示“运行客户程序的机器”或“运行服务器程序的机器”。 2. 对等连接方式 对等连接（peer- to- peer, 简写为 P2P 。这里使用数字 2 是因为英文的 2 是two, 其读音 • 11 •"}
{"doc_id": "network", "page": 23, "text": "与to 同，因此英文的to 常写为数字 2) 是指两台主机在通信时，并不区分哪一个是服务请 求方和哪一个是服务提供方。只要两台主机都运行了对等连接软件 (P2P 软件），它们就可 以进行平等的对等连接通估。这时，双方都可以下载对方已经存储在硬盘中的共享文档。因 此这种－［作方式也称为 P2P 方式。在图 1-6 中，主机 C,D, E 和 F 都运行了 P2P 程序，因此 这几台主机都可进行对等逌估（如 C 和 D, E 和 F, 以及 C 和 F) 。实际上，对等连接方式 从本质上看仍然使用客户－服务器方式，只是对等连接中的每一台主机既是客户同时又是服 务器。例如主机 C, 当 C 请求 D 的服务时． C 是客户， D 是服务器。但如果 C 又同时向 F 提供服务，那么 C 又同时起若服务器的作用。 ·····••• •••••••  砂 P2P 程｝f＼~E1 网络边缘 c 尸步~-P2P程疗 ，转 乃七、 ,/I,, _,·,,、、`、 ,·, _, /, \\  ;,—/ ／，户＿、 I / ~ j一＇f？云； \\ / .,\" 网络核心 1 `二，；... 、,' •.• F ，夕，．＇， ．．｀、 一二 / ..  运 1) P2P 和1!. z- I D斗＿＿坠行 P2P 程J字 ．耸．．一一，．，． 、、、，，． `·`...,·· ...  、．.. 图 1-6 对笘连搂丁作方式 (P2P 方式） 对等连接工作方式可支持大汛对等用户（如 L 百万个）同时工作。关于这种工作方式 我们将在后面第 6 济的 6.9 廿进一步讨论。 1.3.2 互联网的核心部分 网络核心部分是互联网中最复杂的部分，因为网络中的核心部分要向网络边缘部分中 的大量主机提供连通性，使边缘部分中的任何一台主机都能够与其他中机通信。 在网络核心部分起特殊作用的是路由器（ rou ter), 它是一种专用计算机（但不叫作主 机）。路由器是实现分组交换(packe t switch i n g)的关键构件，其任务是转发收到的分组， 这是网络核心部分最觅要的功能．为了弄浩分组交换，下面先介绍电路交换的基本概念。 1. 电路交换的主要特奈 在电话问世后不久，人们就发现，要让所有的电话机都两两相连接是不现实的。图 l-7(a) 表示两部电话只需要用一对电线就能够互相连接起来。但若有 5 部电话要两两相连，则需要 10 对电线，如图 l-7(b) 所不。显然，若 N 部电话要两两相连，就需要 N(N - 1)/2对电线。当 电话机的数址很人时，这种连接方法需要的电线数址就太大了（与电话机的数量的平方成正 比）。千是人们认识到，要使得仓J: -·部电话能够很方便地和另一部电话进行通信，就应当使 用电话交换机将这些电话连接起米，如图 I- 7(c) 所示。每－部电话都连接到交换机上，而交 换机使用交换的方法，计屯话用户彼此之间可以很方便地通信。电话发明后的一百多年来， 电话交换机虽然经过多次史新换代，但父换的方式一直都是电路交换（c i rcu it sw it ch i n g)。 • 12 •"}
{"doc_id": "network", "page": 24, "text": "音 盒 (a) (b) (c)  (a) 两部电话fI 接相连 (b) 5 部屯话两两兀接相连 (c) 川交换机连搂许多部屯话 图 1-7 电话机的 4寸司连接方法 当电话机的数邱增多时，就要使用很多彼此连接起米的交换机来完成全网的交换任务。 用这样的方法，就构成了股盖全世界的电信网。 从通信资源的分配角度来看，交换（sw it ch i n g)就是按照某种方式动态地分配传输线路的 资源。在使用电路交换打电话之前，必须先拨号请求建立连接。当被叫用户听到交换机送来 的振铃音并摘机后，从主叫端到被叫端就建立f一条连接，也就是一条专用的物理通路。这 条连接保证了双方通话时所需的通信资源，而这些资源在双方通信时不会攸其他用户占用。 此后主叫和被叫双方就能互相通电话。通话完毕挂机后，交换机释放刚才使用的这条专用的 物理通路（即把刚才占用的所有通信资源归还给电信网）。这种必须经过“建立连接（占用 通信资源）一通话（一直占用通信资源）一释放连接（归还迎信资源）”勹个步骤的交换方 式称为电路交换。。如果用户在拨号呼叫时电估网的资源已不足以支持这次的呼叫，则主叫 用户会听到忙音，表示电估网不接受用户的呼叫，用户必须挂机，？忻寺一段时间后再重新拨 吁。 图 1-8 为电路交换的示意图。为简单起见，图中没有区分市话交换机和长途电话交换机。 应当注意的是，用户线是电话用户到所连接的市话交换机的连接线路，是用户独占的传送模 拟信号的专用线路，而交换机之间拥行大批话路的中继线（这些传输线路早已都数字化了） 则是许多用户共享的，正在通话的用户只占用f中继线里面的一个话路。电路交换的一个重 要特点就是在通话的全部时间内，通话的两个用户始终占用端到端的通信资源。 电信网 石心如一 交换机 交换机 交换机 交换机 用户线 lil 1-8 电路交换的用户始终占用端到端的通佑资源 当使用电路交换来传送计算机数据时，其线路的传输效率往往很低。这是因为计铭机 (j)注·电路交换蚊初指的是连桵屯话机的双绞线对在交换机 l ．．进行的父换（交换机{i人［．．的、步进的和程控的、祁等）． 后来随若技术的进步．采I-tl f多路复用技术．出现｛桢分多路、时分多路、时分多路等．这时 1旧铭交换的根念就扩展到在从绞线． 铜缆、光纤、无线媒体中多t什信号中的某一路（某个频韦．某个时吹、某个时中巧）和另 罚的交换． • 13."}
{"doc_id": "network", "page": 25, "text": "数据是突发式地出现在传输线路1:的，因此线路上兵正用来传送数据的时间往往不到 10% 甚兖 l% 。已被用户占用的通估线路资源在绝大部分时间里都是空闲的。例如，当用户阅读 终端屏怼上的信息或用键盘输入和编铅一份文件时，或计算机正在进行处理而结果尚未返回 时，飞员的通信线路资源并未被利川而足被白白浪费了。 2 分组交换的主要特点 分组交换则采用存储转发技术”。图 1-9 表示把一个报文划分为儿个分 组后内进行传送。迪常我们把要发送的整块数据称为一个报文(messa ge) 。 在发送报文之前，先把较长的报文划分为一个个吏小的等长数据段，例如， 视赖讲解 每个数据段为 1024 b it®。在每一个数据段前而，加上一些必要的控制信息组成的首部 (header) 后，就构成了一个分组(packe t) 分组又称为“包”，而分组的首部也可称为“包头”· 分组是在互联网中传送的数据单元。分组中的“首部”是非常重要的，正是由千分组的首部 包含了诸如目的地址和源地址等重要控制信息，每一个分组才能在互联网中独立地选择传输 路径，并被正确地交付到分组传输的终点。 报文 丿 IO100 1 1 1 0101 1()().............. ?OlO IOOl l IO 10001.  鸥（下ii.,.,;..',....,:.... `.“·  | 0部 1 枚据 IIr1 部 I 数斟仕叫 数据 ,,ttll 分组 分纤 l 图 1-9 以分组为基本 It．位（i今网络中化必 图 1-1 O(a) 强调可联网的核心部分丛巾许多网络和把它们互迕起来的路由器组成的，而 主机处在叮联网的边缘部分。在互联网核心部分的路巾器之间一般都川卧速链路相迕接，而 在网络边缘部分的主机接入到核心部分则通常以相对较低速率的链路相连接。 位干网络边缘部分的目．机和位 I·· 网络核心部分的路由器都是计符机，但它们的作用 却很不一样。主机是为用户进行信息处理的，并且可以和其他 F 机通过网络交换估息。路由 器则用来转发分组，即进行分组交换。路巾器收到一个分组，先暂时存储勹下，检查其首部， 查找转发表，按照首部中的 H 的地址，找到合适的桵门转发出去，把分组交给下一个路由器。 这样步一步地（打时会经过儿十个不问的路由器）以存储转发的方式，把分组交付蚊终的 目的上机。各路小器之间必须经常交换彼此掌握的路由信息，以使创建和动态维扩路由器中 ,,1) i I气{ffh tt'儿的似念砓初是J 19 6-1年 8)) 由巳 ':(Baran)(1: J.. lhl \";德 (Rand) 公司的＂论分布式逋伈＂的研究报告中提出 的 (,· 1962-1965 /l'f11). 义国 I I~ 肋郘也烘研究规划J,j DARPA 和英 1~11·1 京物理实验,;, NPL 1f~(1对新刑的计 1r.机迪仇网进行研究． 1966 lf 6 Jj, NPL 的戴4卡断 (Da, i cs)1、i次从出＇｀分组“(packCl) 这．名叫[DAVl86), 1969 介 12 月．艾 1由的分组交换网 ARPANET （芍 II,l 仪 (l 4 个i队）役入足行．从此．ii钉机网fl\\的及展就进入f ·个崭新的纪兀． 1973 年关1 日 I 叶衣物咒实验｀书． NPL 也开通 丿，分tII 父换试验网 现（1 人：京都公认 ARPANET 为分 rll 交换网之父．除关关两囚外，法国也（I' 1973 年）·f心J~分组交换网 CYCL.AD[S  2 计＇： （t：人 15 中， bIl K 示“比1.}” (l i 1“ IJ L 村只小． bi 1 方｝ ：f力 ”F• •• (1 许名估i兄卜·“比补”和…位～可以过i用．在使 川”位”仆．为，r，.位时．i,'/恨剔 I 下义仆别i区，是，进制的＂ （；；“心处f·进制的＂位”. Ihi L 总， b i l (I 农小信息拈（比特）或信息 仕输速书（比特／秒）时小能译为＂位”· • 14 •"}
{"doc_id": "network", "page": 26, "text": "的转发表，使得转发表能够在整个网络拓扑发生变化时及时更新。 主机 H2二H4 H, I 网络贬＇邵分二比 \"•1 主［户＄：＼勹 (a)  HI  －压 H3 l  一 1 (b)  (a) 核心部分中的路由器把许多网络互连起来 （ b) 核心部分中的网络可用一条链路表示 图 1-10 分组交换的示总图 当我们讨论互联网的核心部分中的路巾器转发分组的过程时，往往把单个的网络简化 成一条链路，而路由器成为核心部分的节点，如图 1-1 O(b) 所示。这种简化图看起来可以更 加突出重点，因为在转发分组时最重要的就是要知道路由器之间是怎样连接起来的。 现在假定图 1-lO(b) 中的主机 H1 向主机 H5 发送数据。主机凡先将分组逐个地发往与它 直接相连的路由器 A 。此时，除链路 H1-A 外，其他通信链路并不被目前通信的双方所占用。 需要注意的是，即使是链路 H1-A, 也只是当分组止在此链路上传送时才被占用。在各分组 传送之间的空闲时间，链路 H1-A 仍可为其他主机发送的分组使用。 路由器 A 把主机凡发来的分组放入缓存。假定从路由器 A 的转发表中查出应把该分组 转发到链路 A-C 。于是分组就传送到路由器 C 。当分组正在链路 A-C 传送时，该分组并不 占用网络其他部分的资源。 路由器 C 继续按上述方式查找转发表，假定查出应转发到路由器 E 。当分组到达路由 器 E 后，路由器 E 就最后把分组直接交给主机 H50 假定在某一个分组的传送过程中，链路 A-C 的通信量太大，那么路由器 A 可以把分组 沿另一个路由传送，即先转发到路由器 B, 再转发到路由器 E, 最后把分组送到主机 Hs• 在网络中可同时有多台主机进行通信，如主机 H2 也可以经过路由器 B 和 E 与主机 H6 通信。 这里要注意，路由器暂时存储的是一个个短分组，而不是整个的长报文。短分组是暂 存在路由器的存储器（即内存）中而不是存储在磁盘中的。这就保证了较高的交换速率。 在图中只画了一对主机凡和 H5 在进行通信。实际上，互联网可以容许非常多的主机同 时进行通信，而一台主机中的多个进程（即正在运行中的多道程序）也可以各自和不同主机 中的不同进程进行通信。 应当注意，分组交换在传送数据之前不必先占用一条端到端的通信资源。分组在哪段 链路上传送才占用那段链路的通信资源。分组到达一个路由器后，先暂时存储下来，查找转 发表，然后从另一条合适的链路转发出去。分组在传输时就这样逐段地断续占用通信资源， 而且还省去了建立连接和释放连接的开销，因而数据的传输效率更高。 互联网采取了专门的措施，保证了数据的传送具有非常高的可靠性（在第 5 竞 5 .4节介 绍运输层协议时要卷重讨论这个问题）。当网络中的某些节点或链路突然出故障时，在各路 • 15 •"}
{"doc_id": "network", "page": 27, "text": "由器中运行的路由选择协议（pro t ocol) 能够自动找到转发分组最合适的路径。这些将在第 4 章 45 节中详细讨论。 从以上所述可知，采用存储转发的分组交换，实质上是采用了在数据通信的过程中断 续（或动态）分配传输带宽的策略（关千带宽的进一步讨论见后面的 1.6.1 节）。这对传送突 发式的计笃机数据非常合适，使得通信线路的利用率大大提高了。 为了提高分组交换网的可靠性，互联网的核心部分常采用网状拓扑结构，使得当发生 网络拥塞或少数节点、链路出现故障时，路由器可灵活地改变转发路由而不致引起通信的中 断或全网的瘫痪。此外，通信网络的主干线路往往由一些高速链路构成，这样就可以较高的 数据率迅速地传送计罚机数据。 综上所述，分组交换的主要优点可归纳如表 1-1 所示。 表 1-1 分组交换的优点 电子工业 优点 所采用的手段 高效 在分组传输的过程中动态分化传输卅宽，对通伈链路逐段占 IIl 灵活 为每一个分组独汀地选扦奻合适的转发跺山 迅速 以分组作为传送羊位，个先建立连接就能向其他主机发送分组 可节 保证可靠性的网络协议 分布式多路由的分组交换网．使网络 4i很好的生存性 分组交换也带来一些新的问题。例如，分组在各路由器存储转发时需要排队，这就会 造成一定的时延。因此，必须尽她设法减少这种时延。此外，由于分组交换不像电路交换那 样通过建立连接来保证通信时所志的各种资源，因而无法确保通信时端到端所需的带宽。 分组交换带来的另一个问题是各分组必须携带的控制信息也造成了一定的开销 (overhead) 。整个分组交换网还需要专门的管理和控制机制。 应当指出，从本质上讲，这种断续分配传输带宽的存储转发原理并非是全新的概念。 自古代就有的邮政通信，就其本质来说也屈千存储转发方式。而在 20 世纪 40 年代，电报通 信也采用了基十存储转发原理的报文交换(messa ge switch i ng)。在报文交换中心，一份份电 报被接收下来，并穿成纸带。操作员以每份报文为单位，撕下纸带，根据报文的目的站地址， 拿到相应的发报机转发出去。这种报文交换的时延较长，从几分钟到几小时不等。现在报文 交换已不使川了。分组交换虽然也采用存储转发原理，但由千使用了计算机进行处理，因此 分组的转发非常迅速。例如， ARPANET 建网初期的经验表明，在正常的网络负荷下，当时 横跨美国东西海岸的端到端平均时延小十 O.l 秒。这样，分组交换虽然采用了某些古老的交 换原理，但实际上已变成了一种崭新的交换技术。 图 1-1 l 显示了电路交换、报文交换和分组交换的主要区别。图中的 A 和 D 分别是源点 和终点，而 B 和 C 是在 A 和 D 之间的中间节点。图的奻下方归纳了三种交换方式在数据传 送阶段的主婓特点： 电路交换一整个报文的比特流连续地从源点直达终点，好像在一个管道中传送。 报文交换一整个报文先传送到相邻节点，全部存储下来后查找转发表，转发到下一· 个节点。 分组交换一一单个分组（这只是整个报文的一部分）传送到相邻节点，存储下来后查 找转发表，转发到下一个节点。 • 16 •"}
{"doc_id": "network", "page": 28, "text": "电路交换 I-_  一立 建接迕 数据传送 连接释放 A B C D  数据传送 比特流卫达终点 的特点 |,.气, X -- 一 1 - > 包 报文交换 气 I 婴 亡 A 8 C D  报义报文报义 心心『 包 存储存储 转发转发 分组交换 A B C D  分组分组分组 ／、／尸 句 存储存储 转发转发 图 1-11 三种交换的比较。电路交换、报义交换、分组交换， P1~1为表小 4 个分组 从图 1-11 可看出，若要连续传送大似的数据，且其传送时间远人卜连接建立时间，则 电路交换的传输速率较快。报文交换和分组交换不需要预先分配传输带宽，在传送突发数据 时可提高整个网络的信道”)利用率。由于一个分组的长度往往远小十整个报义的长度，因此分 组交换比报文交换的时延小，同时也具有更好的灵活性。 在过去很长的时期，人们都有这样的概念：电路交换适合于话音通信，而分组交换则 适合千数据通信。然而随着蜂窝移动通信的发展，这种概念已经发生f根本的变化。从第四 代蜂窝移动通信网开始，无论是话音通信还是数据通信，都耍采用分组交换（见第 9 章 9.3 节有关蜂窝移动通信网的讨论）。 1.4 计算机网络在我国的发展 下面简单介绍一下计算机网络在我国的发展情况。 最早着手建设专用计算机广域网的是铁道部。铁道部在 1980 年即开始进行计算机联网 实验。 1989 年 11 月我国第一个公用分组交换网 CNPAC 建成运行。在 20 世纪 80 年代后期， 公安、银行、军队以及其他一些部门也相继建立了各自的专用计符机广域网。这对迅速传递 亟要的数据信息起着正要的作用。另一方面，从 20 旧纪 80 年代起，国内的许多单位相继安 装了大伍的局域网。局域网的价格便宜，其所有权和使用权都屈丁本单位，因此便千开发、 管理和维护。局域网的发展很快，对各行各业的管理现代化和办公自动化起到了积极的作用。 这里应当特别提到的是， 1994 年 4 月 20 日我国用 64 kb it/s 专线正式连入互联网。从此， 我国被国际上正式承认为接入互联网的国家。同年 5 月中国科学院尚能物理研究所设立了我 ＠注．佑逆(channel) 足指以传输媒体为基础的信号通跻（包括有线或无线屯线路）．其仵用比i1,输伯另． • 17 •"}
{"doc_id": "network", "page": 29, "text": "国的第一个万维网服务器。同年 9 月中国公用计算机互联网 CHINANET 正式启动。到目前 为止，我国陆续建造了基于互联网技术并能够和互联网叮连的多个全国范围的公用计算机网 络，其中规模最大的就是下面这五个： (I) 中国电信互联网 CHINANET （也就是原来的中囚公用计符机 LJ联网） (2) 中国联通互联网 UNINET (3) 中国移动互联网 CMNET (4) 中国教育和科研计算机网 CERNET (5) 中国科学技术网 CSTNET 2004 年 2 月，我国的第一个下一代互联网 CNGI 的主干网 CERNET2 试验网正式升通， 并提供服务。试验网以 2.5~10 Gbit/s 的速率连接北京、上海和广州三个 CERNET 核心节点， 并与国际下一代互联网相连接。这标志肴中国在互联网的发展过程中，已逐渐达到与国际先 进水平同步。 中国互联网络信息中心 CNNIC (China Network Information Cen ter) 每年两次公布我国互 联网的发展情况。读者可在其网站上杳到最新的和过去的历史文档 [W-CNNIC] 。 CNNIC 把 过去半年内使用过互联网的 6 周岁及以上的中国居民称为网民。根据 2020 年 4 月 CNNIC 发表的《中国互联网络发展状况统计报告》，截至 2020 年 3 月底，我国网民已达到 9.04 亿， 互联网普及率已达到 64.5% 。这个数值高于 2019 年 3 月公布的全世界互联网普及率 56.8%, 但与北美（普及率为 89 .4%)和欧洲（普及率为 86.8%) 相比，仍有不少差距。在我国网民 中，手机网民的规栈已达到 8.97 亿，占总体网民的比例超过 99.3% 。但农村网民只有 2.55 亿，占整体网民的 28.2% 。 现在微朋和网络视频的用户明显增多。移动互联网营销发展迅速，当前网民砐主要的 网络应用就是即时通信（例如微信）、搜索引擎（即在互联网上使用搜索引莘来查找所需的 信息）、网络音乐、网络新闻和博客等。此外，更多的经济活动已步入了互联网时代。网上 购物、网上支付和网上银行的使用率也迅速提升。到 2019 年底，我国的国际出口带宽已超 过 8.8 Tbit/s (1 Tbit/s = I 03 Gbit/s) 。 对我国互联网事业发展影响较大的人物和事件不少，限千篇幅，下面仅列举几个例子。 1996 年，张朝阳创立了中国第一家以风险投资资金建立的互联网公司－爱特信公司。 两年后，爱特信公司推出“搜狐”产品，并更名为搜狐公司 (Sobu) 。搜狐公司砐主要的产品 就是搜狐网站(Sohu.com), 是中国首家大型分类查询搜索引空。 1999 年，搜狐网站增加了新 闻及内容频道，成为一个综合门户网站。 1997 年，丁磊创立了网易公司 (Ne tEase), 推出了中国第一个中文全文搜索引擎。网易 公司开发的超大容量免费邮箱（如 163 和 l26 等），巾丁具有高效的杀毒和拦截垃圾邮件的 功能，安全性很好，已成为国内砓受欢迎的中文邮箱。网易网站现在也是全国出名的综合门 户网站。 1998 年，王志东创立新浪网站(S i na.com), 该网站现已成为全球最大的中文综合门户网 站。新浪的微博是全球使用最多的微博之一。 同年，马化腾、张志东创立了腾讯公司 (Tencen t)。 1999 年肥讯推出了用在个人电脑上 的即时通信软件 OICQ,后改名为QQ。QQ的功能不断更新，现在已成为一款集话音、短 信、文章、音乐、图片和视频千一体的网络沟通交流工具，成为几乎所有网民都在电脑中安 装的软件，腾讯也因此成为中国最大的互联网综合服务提供商之一。 • 18 •"}
{"doc_id": "network", "page": 30, "text": "2011 年，腾讯推出了专门供智能手机使用的即时通信软件“微信”（国外版的微信叫作 WeChat,在功能上有些差别）。这个软件是在张小龙（著名的电子邮件客户端软件 Foxma仆 的作者）领导下成功研发的。微信能够通过互联网快速发送话音短信、视频、图片和文字， 并且支持多人视频会议。由于微信能在各种不同操作系统的智能手机中运行，因此目前几乎 所有的智能手机用户都在使用微信。微信的功能也在不断更新。装有微信软件的智能手机， 已从简单的社交工具演变成一个具有支付能力的全能钱包。几乎所有使用智能手机的人，都 离不开微信。 2000 年，李彦宏和徐勇创建了百度网站(Ba i du.com), 现在已成为全球最大的中文搜索 引笠。自谷歌千 2010 年退出中国后，中国最大的搜索引擎无疑就是百度了。现在，百度网 站也可以用主题分类的方法进行查找，非常便于网民对各种信息的浏览。 1999 年，马云创建了阿里巴巴网站(Al i baba.com), 这是一个企业对企业的网上贸易市 场平台。 2003 年，马云创立了个人网上贸易市场平台一淘宝网 (Taobao.com) 。 2004 年， 阿里巴巴集团创立f第三方支付平台一支付宝 (Ali pa y.com), 为中国电子商务提供了简单、 安全、快速的在线支付手段。 上述的一些事件对互联网应用在我国的推广普及，起着非常积极的作用。 1.5 计算机网络的类别 1.5.l 计算机网络的定义 计算机网络的精确定义并未统一。 关于计算机网络的较好的定义是这样的 [PETE12]: 计算机网络主要是由一些通用的、 可编程的硬件互连而成的，而这些硬件并非专门用来实现某一特定目的（例如，传送数据或 视频信号）。这些可编程的硬件能够用来传送多种不同类型的数据，并能支持广泛的和日益 增长的应用。 根据这个定义： （ l) 计算机网络所连接的硬件，并不限于一般的计算机，而是包括了智 能手机或智能电视机； （2) 计算机网络并非专门用来传送数据，而是能够支持很多种应用 （包括今后可能出现的各种应用）。当然，没有数据的传送，这些应用是无法实现的。 请注意，上述的“可编程的硬件”表明这种硬件一定包含有中央处理器 CPU 。 我们知道，起初，计览机网络是用来传送数据的。但随茬网络技术的发展，计算机网 络的应用范围不断增大，不仅能够传送音频和视频文件，而目应用的范围已经远远超过一般 通信的范畴。 有时我们也能见到“计算机通信网”这一名词，但这个名词容易使人误认为这是一种 专门为了通信而设计的计算机网络。计算机网络显然应具有通信的功能，但这种通信功能并 非计算机网络最主要的功能。因此本书不使用“计算机通信网”这一名词。 1.5.2 几种不同类别的计算机网络 计符机网络有多种类别，下面进行简单的介绍。 1. 按照网络的作用范图进行分类 (I) 广域网 WAN (Wide Area Network) 广域网的作用范围通常为几十到几千公里， • 19 •"}
{"doc_id": "network", "page": 31, "text": "因而有时也称为远程网 (long haul ne twork) 。广域网是互联网的核心部分，其任务是长距离 （例如，跨越不同的国家）运送主机所发送的数据。连接广域网各节点交换机的链路一般都 是高速链路，具有较大的通信容噩。本书不专门讨论广域网。 (2) 城域网 MAN (Metropolitan Area Network) 城域网的作用范围一般是一个城市， 可跨越几个街区甚至整个城市，其作用距离约为 5 ~50 km 。城域网可以为一个或几个单位 所拥有，也可以是一种公用设施，用来将多个局域网进行丑迕。目前很多城域网采用的是以 太网技术，因此有时也常并入局域网的范围进行讨论。 (3) 局域网 LAN (Local Area Network) 局域网一般用微型计算机或工作站通过高速 通信线路相连（速率通常在 10 Mbit/s 以上），但地理上则局限在较小的范围（如 I km 左右）。 在局域网发展的初期，一个学校或工厂往往只拥有一个局域网，但现在局域网已非常广泛地 使用，学校或企业大都拥有许多个互连的局域网（这样的网络常称为校园网或企业网）。我 们将在第 3 章 3.3 至 3.5 节详细讨论局域网。 (4) 个人区域网 PAN (Personal Area Network) 个人区域网就是在个人工作的地方把 屈千个人使用的电子设备（如便携式电脑等）用无线技术连接起来的网络，因此也常称为无 线个人区域网 WPAN (Wireless PAN), 其范围很小，大约在 10 m 左右。我们将在第 9 首 9.2 节对这种网络进行简单的介绍。 顺便指出，若中央处理机之间的距离非常近（如仅 1 米的数榄级或更小些），则一般就 称之为多处理机系统而不称它为计符机网络。 2. 按照网络的使用者进行分类 (I)公用网(publ i c network) 这是指电信公司（国有或私有）出资建造的大型网络。 “公用”的意思就是所有愿意按电信公司的规定交纳费用的人都可以使用这种网络。因此公 用网也可称为公众网。 (2) 专用网(pri va t e network) 这是某个部门为满足本单位的特殊业务工作的需要而建 造的网络。这种网络不向本单位以外的人提供服务。例如，军队、铁路、银行、电力等系统 均有本系统的专用网。 公用网和专用网都可以传送多种业务。如传送的是计算机数据，则分别是公用计算机 网络和专用计算机网络。 3. 用来把用户接入到互联网的网络 这种网络就是接入网 AN (Access Network), 它又称为本地接入网或居民接入网。这是 一类比较特殊的计算机网络。我们在前面的 1.2.2 节已经介绍了用户必须通过本地 ISP 才能 接入到互联网。本地 ISP 可以使用多种接入网技术把用户的端系统连接到互联网。接入网实 际上就是本地 ISP 所拥有的网络，它既不是互联网的核心部分，也不是互联网的边缘部分。 接入网由某个端系统连接到本地 ISP 的第一个路由器（也称为边缘路由器）之间的一些物理 链路所组成。从覆盖的范围看，其长度在几百米到几公里之间。很多接入网还是属千局域网。 从作用上看，接入网只是起到让用户能够与互联网连接的“桥梁”作用。在互联网发展初期， 用户多用电话线拨号接入互联网，速率很低（每秒几千比特到几十于比特），因此那时并没 有使用接入网这个名词。直到最近，由于出现了多种宽带接入技术，宽带接入网才成为互联 网领域中的一个热门课题。我们将在第 2 竞 2.6 节讨论宽带接入技术。 • 20."}
{"doc_id": "network", "page": 32, "text": "1.6 计算机网络的性能 扫寸寸 计殍机网络的性能一般是指它的几个重要的性能指标。但除了这些重 要的性能指标，还有一些非性能特征（ non pe rfonnance charac teri s ti cs) 也对 计算机网络的性能有很大的影响。本节将讨论这两个方面的问题。 1.6.l 计算机网络的性能指标 性能指标从不同的方面来度昼计算机网络的性能。下面介绍常用的 7 个性能指标。 圈 视频讲俅 1. 速率 我们知道，计絊机发送的信号都是数字形式的。比特 C b it)来源于 bi nary d igit,意思是 一个“二进制数字“，因此一个比特就是二进制数字中的一个］或 0 。比特也是信息论中使 用的信息蛋的单位。网络技术中的速率指的是数据的传送速率，它也称为数据率(data rate)  或比特率(b it ra te) 。速率是计算机网络中最重要的一个性能指标。速率的单位是 b it/s （比特 每秒） （或 b/s, 有时也写为 b p s, 即 b it per second) 。当数据率较高时，就常常在 b it/s 的前 面加上一个字母。例如， k (kilo)= J03 =千， M (Mega)= 106 =兆， G (Giga) = J09 =吉， T (Tera)= I 012 =太， P (Peta)= l015 =拍， E (Exa) = 1018 =艾， Z (Zetta)= l021 =泽， Y (Yotta)  = l024= 护。这样， 4 x L010 bit/s 的数据率就记为 40 Gbit/s 。现在人们在谈到网络速率时， 常省略速率单位中）莎有的 b it/s, 而使用不太正确的说法，如 “40 G 的速率＂。另外要注悉的 是，当提到网络的速率时，往往指的是额定速率或标称速率，而并非网络实际上运行的速率。 2. 带宽 “带宽 ”(bandw i dt h) 有以下两种不同的意义： (I) 带宽本来是指某个信号具有的频带宽度。信号的带宽是指该信号所包含的各种不问 频率成分所占据的频率范围。例如，在传统的通信线路上传送的电话信号的标准带宽是 3.1 kHz （从 300 Hz 到 3 .4 kHz, 即话音的主要成分的频率范困）。这种意义的带宽的单位是赫 （或千赫、兆赫、吉赫等）。在过去很长的一段时间，通信的主干线路传送的是模拟信号 （即连续变化的信号）。因此，表示某信道允许通过的信号频带范围就称为该信道的带宽 （或通频带）。 (2) 在计算机网络中，带宽用来表示网络中某通道传送数据的能力，因此网络带宽表示 在单位时间内网络中的某信道所能通过的“最高数据率”。在本书中提到“带宽”时，主要 是指这个总思。这种意义的带宽的单位就是数据率的单位 b it/s, 是“比特每秒＂。 CD 汁 在计界机领城，数的计算使用二进制．因此习惯上，千＝ k =210= lO24 ，兆＝ M ＝ 22,），吉＝ G = 230, 太＝ T= 产，拍＝ P ＝ 250 ．艾＝ E = 2 (,0,洋－ z = 210, 尧＝ Y=2切。此外，计算机中的数据阰往往用字节 B 作为度拉的单位（ B 代表 b yte) 。通祁 I B = 8 b it.例如， 15 GB 数锯块的大小是 15 x zio x 8 b it,而不是 15 x 109 x 8 b it。但 10 Gb it/s 的速率则表示 10x 109 bit/s 。在计罚机领域中，所句的这些单位都使用大写字母，但在通信领域中，只有 “1000\" 使用小写 “k'', 其余的也都用大 写．诮注~.也介的书不这样严格区分，人介i k 既可表示 1000, 又可表示 1024, 闪此这时疫特别小心，不要弄错． • 21 •"}
{"doc_id": "network", "page": 33, "text": "什“带宽”的上述两种表述中，前者为频域称谓，而后者为时域称讷，其本质是相同 的。也就是说，一条通信链路的“带宽“越宽，其所能传输的“最高数据率”也越高。 3. 吞吐量 吞吐蛋（throughp u t)表示在单位时间内通过某个网络（或信递、接口）的实际数据矗。 在 1廿散更经常地用于对现实世界中的网络的一种测铅，以便知道实际上到底有多少数据狱能 够通过网络。显然，吞吐扭受网络带宽或网络额定速率的限制。例如，对于一个 l Gb it/s 的以 太网，就是说其额定速率是 I Gbit/s, 那么这个数值也是该以太网的吞吐伍的绝对上限值。 因此，对 I Gb it/s 的以太网，其实际的吞吐堂可能只有 100 Mb it/s, 甚至更低，并没有达到 其额定速率。请注意，有时吞吐榄还可用每秒传送的字节数或帧数来表示。 接入到互联网的主机的实际吞吐讯，取决于互联网的具体悄况。假定主机 A 和服务器 B 接入到互联网的链路速率分别是 100 Mb it/s 和 1 Gb it/ s 。如果互联网的各链路的容扯都足 够大，那么当 A 和 B 交换数据时，其吞吐量显然应当是 100 Mb it/s 。这是因为，尽管服务器 B 能够以超过 100 Mbit/s 的速率发送数据，但主机 A 最高只能以 100 Mb it/s 的速率接收数据。 现在假定有 100 个用户间时连接到服务器 B （例如，同时观看服务器 B 发送的视频节目）。 在这种情况下，服务器 B 连接到互联网的链路容掀被 100 个用户平分，每个用户乎均只能 分到 10 Mbit/s 的带宽。这时，主机 A 连接到服务器 B 的吞吐榄就只有 10 Mbit/s 了。 最粕糕的情况就是如果互联网的某处发生了严正的拥塞，则可能导致主机 A 暂时收不 到服务器发来的视频数据，因而使卞机 A 的吞吐批下降到零！主机 A 的用户或许会想，我 已经向运苞商的 ISP 交了速率为 100 Mbit/s 的宽带接入费用，怎么现在不能保证这个速率呢？ 其实你交的宽带费用，只是保证了从你家里到运营商 ISP 的某个路由器之间的数据传输速率。 再往后的速率就取决于整个互联网的流僵分布了，这是任何单个用户都无法控制的。了解这 一点，对理解互联网的吞吐罹是有帮助的。 4. 时延 时延（dela y或 la tenc y)是指数据（一个报文或分组，甚至比特）从网络（或链路）的一 端传送到另一端所需的时间。时延是个很重要的性能指标，它有时也称为延迟或迟延。 需要注意的是，网络中的时延是由以下几个不同的部分组成的： (I) 发送时延 发送时延（transm i ss i on dela y)是主机或路由器发送数据帧所需要的时间， 也就是从发送数据帧的第一个比特算起，到该帧的最后一个比特发送完毕所需的时间。因此 发送时延也叫作传输时延（我们尽扭不采用传输时延这个名词，因为它很容易和下面要讲到 的传播时延弄混）。发送时延的计算公式是： 发送时延＝ 数据帧长度(b it) 发送速率(b it/s) (1-1)  由此可见，对千一定的网络，发送时延并非固定不变，而是与发送的帧长（单位是比 特）成正比，与发送速率成反比。 (2) 传播时延 传播时延（propa gation delay)是电磁波在信道中传播一定的距离需要花 • 22 •"}
{"doc_id": "network", "page": 34, "text": "费的时间。传播时延的计赁公式是： 传捅时延＝ 信逍长度(m) 电磁波在信迫上的传播壅率(m/s) (1-2)  电磁波在自由空间的传播速率是光速，即 3.0 x 105 knvs 。电磁波在网络传输媒体中的 传播速率比在自由空间要略低一些：在铜线电缆中的传播速率约为 2.3 x I 05 km/s, 在光纤 中的传播速率约为 2.0 X 105 km/s 。例如， 1000 km 长的光纤线路产生的传播时延大约为 5 ms 。 以上两种时延有本质上的不同。但只要理解这两种时延发生的地方就不会把它们弄混。 发送时延发生在机器内部的发送器中（一般就是发生在网络适配器中，见第 3 草 3.3.1 节）， 与传输信道的长度（或信号传送的距离）没有任何关系。但传播时延则发生在机器外部的传 输信道媒体上，而与信号的发送速率无关。信号传送的距离越远，传播时延就越大。可以用 一个简单的比喻来说明。假定有 10 辆车按顺序从公路收费站入口出发到相距 50 公里的目的 地。再假定每一辆车过收费站要花费 6 秒，而车速是每小时 100 公里。现在可以算出这 10 辆车从收费站到目的地总共要花费的时间：发车时间共盘 60 秒（相当于网络中的发送时延）， 在公路上的行车时间衙要 30 分钟（相当千网络中的传播时延）。因此从第一辆车到收费站开 始计算，到鼓后一辆车到达目的地为止，总共花费的时间是二者之和，即 31 分钟。 下面还有两种时延也需要考虑，但比较容易理解。 (3) 处理时延 主机或路由器在收到分组时要花费一定的时间进行处理，例如分析分 组的首部、从分组中提取数据部分、进行差错检验或查找转发表等，这就产生了处理时延。 (4) 排队时延 分组在经过网络传输时，要经过许多路由器。但分组在进入路由器后 要先在输入队列中排队等待处理。在路由器确定了转发接口后，还要在输出队列中排队等待 转发。这就产生了排队时延。排队时延的长短往往取决千网络当时的通信量。当网络的通信 登很大时会发生队列溢出，使分组丢失，这相当于排队时延为无穷大。 这样，数据在网络中经历的总时延就是以上四种时延之和： 总时延＝发送时延＋传播时延＋处理时延＋排队时延 (1-3)  一般说来，小时延的网络要优千大时延的网络。在某些情况下，一个低速率、小时延 的网络很可能要优千 个高速率但大时延的网络。 图 1-12 画出了这几种时延所产生的地方，希望读者能够更好地分消这几种时延。 在这里产生发送时延（即传输时延） 在这里产生处理时延 和排队时延、~/ \\|, h，这里产生传播时延 I 二＞ n几广m平 ...  链路 节点 A 发送器 节点 B 图 1-12 几种时延产生的地方小·样 必须指出，在总时延中，究觅是哪一种时延占主导地位，必须具体分析。下面举个 例子。 • 23 •"}
{"doc_id": "network", "page": 35, "text": "现在我们暂时忽略处理时延和排队时延 3 。假定有一个长度为 100 MB 的数据块（这里 的 M 显然不是指对而是指 220 。 B 是字节， 1 字节＝ 8 比特）。在带宽为 I Mb it/ s 的信道上 （这里的 M 显然是 10勺连续发送（即发送速率为 I Mb it/s), 其发送时延是 I 00 x i2° x 8 + 106 = 838.9 s  现在把这个数据块用光纤传送到 1000 km 远的计算机。由于在 1000 km 的光纤上的传 播时延约为 5 ms, 因此在这种情况下，发送 100 MB 的数据块的总时延＝ 838.9 + 0.005 ~  838.9 s 。可见对于这种情况，发送时延决定了总时延的数值。 如果我们把发送速率提高到 100 倍，即提高到 100 Mbit/s, 那么总时延就变为 8.389 +  0.005 = 8.394 S, 缩小到原有数值的1/ 100 。 但是，并非在任何情况下，提高发送速率就能减小总时延。例如，要传送的数据仅有 1 个字节（如键盘上键入的一个字符，共 8 b it)。当发送速率为 I Mb it/s 时，发送时延是 8 + 106 = 8 X 10女 s = 8 µs  若传播时延仍为 5 ms, 则总时延为 5.008 ms 。在这种悄况下，传播时延决定了总时延。 如果我们把数据率提高到 1000 倍（即将数据的发送速率提高到 I Gb it/s), 不难算出，总时 延基本上仍是 5 ms, 并没有明显减小。这个例子告诉我们，不能笼统地认为：“数据的发送 速率越高，其传送的总时延就越小＂。这是因为数据传送的总时延是由公式(1-3) 右端的四项 时延组成的，不能仅考虑发送时延一项。 如果上述概念没有弄清楚，就很容易产生这样错误的概念：“在高速链路（或高带宽链 路）上，比特会传送得更快些“。但这是不对的。我们知道，汽车在路面质匮很好的高速公 路上可明显地提高行驶速率。然而对千高速网络链路，我们提高的仅仅是数据的发送速率而 不是比特在链路上的传播速率。荷载信息的电磁波在通信线路上的传播速率（这是光速的数 报级）取决千通信线路的介质材料，而与数据的发送速率并无关系。提高数据的发送速率只 是减小了数据的发送时延。还有一点也应当注意，就是数据的发送速率的单位是每秒发送多 少个比特，这是指在某个点或某个接口上的发送速率。而传播速率的单位是每秒传播多少公 里，是指在某一段传输线路上比特的传播速率。因此，通常所说的“光纤信道的传输速率高” 是指可以用很高的速率向光纤信道发送数据，而光纤信道的传播速率实际上还要比铜线的传 播速率略低一点。这是因为经过测量得知，光在光纤中的传播速率约为每秒 20.5 万公里， 它比电磁波在铜线（如 5 类线）中的传播速率（每秒 23.1 万公里）略低一些。 上述的重要概念诮读者务必弄消。 5. 时延带宽积 把以上讨论的网络性能的两个度址－~就得到另一个很有 用的度揽：传播时延带宽积，即 时延带宽积＝传播时延 x 带宽 (1-4)  ＠汴：当计弅机网络中的通仁， I初过人时．网络中的许多路由器的处理时延和排队时延将会人大增加，因曲处理时延和排队 时延有可能在总时延中占据主要成分．这时整个网络的性能就变及仁 • 24 •"}
{"doc_id": "network", "page": 36, "text": "我们可以用图 1-13 的示意图来表示时延带宽积。这是一个代表链路的圆柱形管道，管 道的长度是链路的传播时延（诸注意，现在以时间作为单位来表示链路长度），而管道的截 面积是链路的带宽。因此时延带宽积就表示这个管道的体积，表示这样的链路可容纳多少个 比特。例如，设某段链路的传播时延为 20 ms, 带宽为 10 Mb it/s, 算出 时延带宽积＝ 20 X 10-3 X 10 X 106 = 2 X 105 b 仆 这就表明，若发送端连续发送数据，则在发送的第一个比特即将到达终点时，发送端 就已经发送了 20 万个比特，而这 20 万个比特都正在链路上向前移动。因此，链路的时延带 宽积又称为以比特为单位的链路长度。 （传播）时延 带宽＼）二二二王．～ 二 困 1-13 链路像一条空心管道 不难看出，管道中的比特数表示从发送端发出但尚未到达接收端的比特数。对千一条 正在传送数据的链路，只有在代表链路的管道都充满比特时，链路才得到最充分的利用。 6. 往返时间 RTT 在计算机网络中，往返时间 RTT (Round-Trip Ti me) 也是一个重要的性能指标。这是因为 在许多情况下，互联网上的信息不仅仅单方向传输而是双向交互的。因此，我们有时很需要 知道双向交互一次所需的时间。例如， A 向 B 发送数据。如果数据长度是 100 MB, 发送速 率是 100 Mb it/s, 那么 数据长度 1oox220xs  发送时间＝ = ::::: 8.39 s  发送速率 IOOx 106  假定 B 正确收完 100 MB 的数据后，就立即向 A 发送确认。再假定 A 只有在收到 B 的 确认信息后，才能继续向 B 发送数据。显然，这就要等待一个往返时间 RTT （这里假定确 认信息很短，可忽略 B 发送确认的发送时延）。如果 RTT = 2s, 那么可以算出 A 向 B 发送 数据的有效数据率。 数据长度 IOOx220xs  有效数据率＝ = ::::: 80.?x 106b it/砰 80.?Mbit/s 发送时间＋RTT 8.39+2  比原来的数据率 100 Mb it/s 小不少。 在互联网中，往返时间还包括各中间节点的处理时延、排队时延以及转发数据时的发 送时延。当使用卫星通信时，往返时间 RTT 相对较长，是很重要的一个性能指标。 顺便指出，在计算机网络的文献中，也有把 RTT 称为往返时延（Round-Trip Time delay)  的，强调发送方至少要经过这样多的时间，才能知道自己所发送的数据是否被对方接收了。 还有的文献把带宽时延积定义为带宽与 RTT 的乘积。这样定义的数值就比前面(1-4) 式定义 的数值大了一倍。这样定义的带宽时延积表示，如果发送方以砐高发送速率连续发送数据， 而接收方一收到数据就立即发送对收到数据的确认，那么发送方在收到这个确认时，已经发 送出的数据她就是按这种定义的带宽时延积。 • 25 •"}
{"doc_id": "network", "page": 37, "text": "7. 利用率 利用率有信道利用率和网络利用率两种。信道利用率指出某信道有百分之儿的时间是 被利用的（有数据通过）。完全空闲的信道的利用率是零。网络利用率则是全网络的信道利 用率的加权平均俏。信逍利用率并非越高越好。这是因为，根据排队论的理论，当某信道的 利用率增大时，该估道引起的时延也就迅速增加。这和高速公路的情况有些相似。当高速公 路上的车流雄很大时，由千在公路上的某些地方会出现堵塞，因此行车所需的时间就会变长。 网络也有类似的情况。当网络的通信岱很少时，网络产生的时延并不大。但在网络通信垃不 断增大的悄况下，由千分组在网络节点（路由器或节点交换机）进行处理时需要排队等候， 因此网络引起的时延就会增大。如果令 D。表示网络空闲时的时延， D 表示网络当前的时延 （设现在的网络利用率为 U), 那么在适当的假定条件下，可以用下而的简单公式(1-5) 来表 示 D 与 D() 以及利用率 U 之间的关系： D D=-卫 1-U  (1-5)  这里 U 是网络利用率，数值在 0 到 1 之间。当网络利用率达到其容量的1/2 时，时延 就要加倍。特别值得注意的就是：当网络利用率接近最大伯 1 时，网络产生的时延就趋于无 穷大。因此我们必须有这样的概念：信道利用率或网络利用率过高就会产生非常大的时延。 图 1-14 给出了上述概念的示意图。因此，一些拥有较大主干网的 ISP 通常控制信道利用率 不超过 50% 。如果超过了就要准备扩容，增大线路的带宽。 时延 D 利用率 U 图 1-14 时延与利用率的关系 1.6.2 计算机网络的非性能特征 计贺机网络还有一些非性能特征也很重要。这些非性能特征与前面介绍的性能指标有 很大的关系。下面简单地加以介绍。 1. 费用 网络的价格（包括设计和实现的费用）总是必须考虑的，因为网络的性能与其价格密 切相关。一般说来，网络的速率越高，其价格也越高。 2. 质巠 网络的质扯取决千网络中所有构件的质蜇，以及这些构件是怎样组成网络的。网络的 质散影响到很多方面，如网络的可靠性、网络管理的简易性，以及网络的一些性能。但网络 的性能与网络的质址并不是一回事。例如，有些性能一般的网络，运行一段时间后就出现了 • 26 •"}
{"doc_id": "network", "page": 38, "text": "故院，变得无法冉继续「作，说明其质吼不好。心质址的网络往往价格也较高。 3. 标准化 网络的硬件和软件的设计既可以按照通用的国际标准，也可以逍循特定的切廿网络标 准。垃好采用国际标准的设计，这样可以得到更好的互橾作性，更易 r 升级换代和维修，也 吏容易得到技术上的支持。 4. 可靠性 可靠性与网络的从打t和性能都有密切关系。八速网络的可靠性不．定很无。但高速网 络要可依地运行，则往往史加困难，同时所篇的费用也会较高。 5. 可扩展性和可升级性 在构造网络时就应节芬虑到今后可能会孟要扩展（即规校扩大）和升级（即性能和版 本的提高）。网络的性能越好，其扩展费用往往也越高，难度也会相应浒加。 6. 易千管理和维护 网络如果没有良好的行理和维护，就很难达到和保持所设计的性能。 1.7 计算机网络体系结构 在计算机网络的基本概念中，分层次的体系结构（或架构）是垃枯本的。计符机网络 体系结构的抽象概念较多，在学习时耍多思考。这些概念对后面的学习很有帮助。 1.7.1 计钵机网络体系结构的形成 计算机网络是个非常复杂的系统。为了说明这一点，可以设想一种最简单的情况：连 接在网络上的两台计算机要互相传送文件。 显然，在这两台计邪机之间必须有一条传送数据的汕路。但这还远远不够。至少还有 以下几项工作需要去完成： (I) 发起迪信的计算机必须将数据通信的迪路激活(ac ti va te) 。所叫“激活”就是要发出 一些信令，保证要传送的计算机数据能在这条通路上正确发送和接收。 (2) 告诉网络如何识别接收数据的计算机。 (3) 发起通信的计算机必须查明对方计算机是否已开机，并且与网络连接正常。 (4) 发起迪信的计算机中的应川桯忭必须弄研楚，在对方计算机中的文件管埋程序是否 己做好接收文件和存储义件的准备工作。 (5) 若计饵机的文件格式不兼容，则至少其中一台计钵机应完成格式转换功能。 (6) 对出现的各种差错和意外事故，如数据传送错误、屯复或丢失，网络中某个节点交 换机出现故陷等，应当有可靠的措施保证对方计符机最终能够收到正确的文件。 还可以列举一些要做的其他工作。由此可见，相互迪信的两个计符机系统必须高度协 调工作才行，而这种“协调”是相当复杂的。为了设计这样复杂的计郓机网络，早在最初的 ARPANET 设计时即提出了分层的方法．“分层”可将庞大而复杂的问题，转化为若干较小 • 27 •"}
{"doc_id": "network", "page": 39, "text": "的局部问题而这些较小的局部问题就比较易千研究和处理。 1974 年，美国的 IBM 公司宣布了系统网络体系结构 SNA (System Network Arch itec ture) 。 这个著名的网络标准就是按照分层的方法制定的。现在用 IBM 大型机构建的专用网络仍在 使用 SNA 。不久后，其他一些公司也相继推出自己公司的具有不同名称的体系结构。 不同的网络体系结构出现后，使用同一个公司生产的各种设备都能够很容易地互连成 网。这种情况显然有利于一个公司垄断市场。但由千网络休系结构的不同，不同公司的设备 很难互相连通。 然而，全球经济的发展使得不同网络体系结构的用户迫切要求能够互相交换信息。为 了使不同体系结构的计算机网络都能互连，国际标准化组织 ISO 于 1977 年成立了专门机构 研究该问题。他们提出了一个试图使各种计殍机在世界范围内互连成网的标准柜架，即著名 的开放系统互连基本参考模型 OSI/ RM (Open Systems Interconnec tion Reference Model), 简 称为 OSI 。“开放”是指非独家垄断的。因此只要遵循 OSI 杯准，一个系统就可以和位千世 界上任何地力的、也遵循这同一标准的其他任何系统进行通信。这一点很像世界范围的有线 电话和邮政系统，这两个系统都是开放系统。”系统”是指召现实的系统中与互连有关的各 部分（我们知道，并不是一个系统中的所有部分都与互连有关。 OSI/RM 把与互连无关的部 分除外，而仅仅考虑与互连有关的那些部分）。所以 OSL/RM 是个抽象的概念。在 1983 年形 成了开放系统互连基本参考校型的止式文件，即著名的 ISO 7498 国际标准，也就是所谓的 七层协议的体系结构。 OSI 试图达到一种理想境界，即令球计算机网络都遵循这个统一标准，因而全球的计算 机将能够很方便地进行互连和交换数据。在 20 世纪 80 年代，许多大公司甚至一些国家的政 府机构纷纷表示支持 OSl 。当时看来似乎在不久的将来全世界一定会按照 OSI 制定的标准来 构造自己的计算机网络。然而到了 20 世纪 90 年代初期，虽然整套的 OSI 国际标准都已经 制定出来了，但由于基于 TCP/IP 的互联网已抢先在全球相当大的范围成功地运行了，而与 此同时却几乎找不到有什么厂家生产出符合 OSI 标准的商用产品。因此人们得出这样的结 论： OSI 只获得了一些理论研究的成果，但在市场化方面则事与愿违地失败了。现今规模最 大的、援盖全球的、基于 TCP/IP 的互联网并未使用 OSI 标准。 OSI 失败的原因可归纳为： (I) OSI 的专家们缺乏实际经验，他们在完成 0S1 标准时缺乏商业驱动力； (2) OSI 的协议实现起来过分复杂，而且运行效率很低； (3) OSI 标准的制定周期太长，因而使得按 OSI 标准生产的设备无法及时进入市场； (4) OSI 的层次划分不太合理，有些功能在多个层次中重复出现。 按照一般的概念，网络技术和设备只有符合有关的国际标准才能大范围地获得工程上 的应用。但现在悄况却反过来了。得到最广泛应用的不是法律上的国际标准 OSI ，而是非国 际标准 TCP/l P 。这样， TCP/IP 就常被称为是事实上的国际标准。从这种意义上说，能够占 领市场的就是标准。在过去制定标准的组织中往往以专家、学者为主。但现在许多公司都纷 纷加入各种标准化组织，使得技术标准具有浓厚的商业气息。一个新标准的出现，有时不一 定反映其技术水平是最先进的，而是往往有养一定的市场背景。 顺便说一下，虽然 OSI 标准在一开始由 ISO 来制定，但后来的许多标准都是 ISO 与原 • 28 •"}
{"doc_id": "network", "page": 40, "text": "来的国际电报电话咨询委员会 CCITT 喟联合制定的。从历史上来看， CCJTT 原来是从通信的 角度考虑一些标准的制定的，而 ISO 则关心信息的处理。但随着科学技术的发展，通信与 信息处理的界限变得比较模糊了。千是，通信与信息处理就都成为 CCTTT 与 TSO 所共同关 心的领域。 CCITT 的建议书 X.200 就是关于开放系统互连基本参考模型的，它和［面提到 的 ISO 7498 基本上是相同的． 1.7.2 协议与划分层次 在计算机网络中要做到有条不紊地交换数据，就必须遵守一些事先约 定好的规则。这些规则明确规定了所交换的数据的格式以及有关的同步问 j ]. j.J  圈 题。这里所说的同步不是狭义的（即同频或同频同相）而是广义的，即在 视桢讲炊 ～定的条件下应当发生什么事件（例如，应当发送一个应答信息），因而同步含有时序的意 思。这些为进行网络中的数据交换而建立的规则、标准或约定称为网络协议 (ne twork pro tocol) 。网络协议也可简称为协议。更进一步讲，网络协议主要由以下三个要素组成： (I) 语法，即数据与控制信息的结构或格式； (2) 语义，即盂要发出何种控制信息，完成何种动作以及做出何种响应； (3) 同步，即事件实现顺序的详细说明。 由此可见，网络协议是计算机网络不可缺少的组成部分。实际上，只要我们想让连接 在网络上的另一台计算机做点什么事情（例如，从网络上的某台主机下载文件），都需要有 协议。但是当我们经常在自己的个人电脑上进行文件存盘操作时，就不需要任何网络协议， 除非这个用来存储文件的磁盘是网络上的某个文件服务器的磁盘。 协议通常有两种不同的形式。一种是使用便于人来阅读和理解的文字描述。另一种是 使用让计符机能够理解的程序代码。这两种不同形式的协议都必须能够对网络上的信息交换 过程做出精确的解释。 ARPANET 的研制经验表明，对于非常复杂的计算机网络协议，其结构应该是层次式的． 我们可以举一个简单的例子来说明划分层次的概念。 现在假定我们在主机 l 和主机 2 之间通过一个通信网络传送文件。这是一项比较复杂 的工作，因为需要做不少的工作。 我们可以将要做的工作划分为三类。第一类工作与传送文件直接有关。例如，发送端 的文件传送应用程序应当确信接收端的文件管理程序己做好接收和存储文件的准备。若两台 主机所用的文件格式不一样，则至少其中的一台主机应完成文件格式的转换。这两项工作可 用一个文件传送模块来完成。这样，两台主机可将文件传送模块作为最高的一层（如图 1-15 所示）。在这两个模块之间的虚线表示两台主机系统交换文件和一些有关文件交换的命令。 ＠注：鉴千“有线电”和“无线电”的关系日益密切，国际电信联盟 ITU (lntemational Telecommunication Uni on) 已将国际 电报电话咨询委员会 CCJTT 和闱际无线电咨询委员会 CCIR 合并为电信标准化部门 TSS (Telecommunication Standardization  Sec tor). 从 1993 年 3 月 1 日起， CCITT 和 CCIR 不复存在，有关电信的标准就由国际电信联盟 ITU 的电信标准化部门颁布，并 在每个建议书的前面加上 ITU-T 这几个字，例如，原来的 CCITT X.25 现在就称为 ITU-T X.25 。为了节约经费，以后不再是每隔 四年就出版全套的建议书，而是只出版新通过的过议书或1 日建议书中有变化的部分。 CCITT 虽然不存在了，但过去 CCITT 所制 定的标准并未作废，凡未过时的标准我们在需要时都可继续引用． • 29 •"}
{"doc_id": "network", "page": 41, "text": "l:.Hl l UL2  文件传达校块 文件及文f'I 传送命令 义fHU送快块 迪｛，甘服务队块 勹逋｛；；；行关的报义 ，．．一一--..一一一一一一--一· 汕估服务校块 ＾＇一、网络～予＾ ～：一 网络r ,-l....'  拔 I I l;·1 逌估网络＾人桵 n 、J 夕／网络搂入校块 网络接入校块 图 1-1 S 划分层次举例 但是，我们并不想让文件传送模块完成全部工作的细节，这样会使文件传送模块过千 复杂。可以再设立一个通信服务校块，用来保证文件和文件传送命令可靠地在两个系统之间 交换。这就是我们婓做的第二类－L 作。也就是说，让位千上面的文件传送桢块利用下面的通 伈服务校块所捉供的服务。我们还可以看出，如果将位丁曰面的义件传这栈块换成电子邮件 校块，那么电了邮什桢块同样可以利用在它下面的通信服务模块所提供的可品通信的服务。 我们要做的第＝类工作可以是再构造一个网络桵入梑块，让这个模块负责做与网络接 口细节有关的工作，并向上层提供服务，使上面的通信服务校块能够完成可靠通信的任务。 从上述的简单例子可以更好地狸解分层能带来很多好处，如： (I)各层之间是独立的。某一层并不油要知逆它的下一层是如何实现的，而仅仅需要知 道该层通过层间的接口（即界向）所提供的服务。由千每一层只实现一种相对独立的功能， 因而可将一个难以处理的复杂问题分解为若干个较容易处理的更小一些的问题。这样，整个 问题的复杂程度就下降了。 (2) 灵活性好。当任何一层发生变化时（例如由二J-技术的变化），只要层间接口关系保 持不变，那么在这层以上或以下各层均不受影响。此外，对某一层提供的服务还可进行修改。 当不再衙要某层提供的服务时，甚至可以将这层取消。 (3) 结构上可分割开。各层都可以采用最合适的技术来实现。 (4) 易于实现和维护。这种结构使得实现和调试一个庞大而又复杂的系统变得更加容易， 因为整个系统已被分解为若干个相对独立的子系统。 (5) 能促进标准化工作。因为每一层的功能及其所提供的服务都已有了精确的说明。 分层时应注意使每一层的功能非常明确。若层数太少，就会使每一层的协议太复杂； 但层数太多又会在描述和综合各层功能的系统丁程任务时遇到较多的困难。通常各层所要完 成的功能主要有以下一些（可以只包括一种，也可以包括多种）： ＠差错控制 使相应层次对等方的通信更加可靠。 ＠流量控制 发送端的发送速率必须使接收端来得及接收，不要太快。 ＠分段和重装 发送端将要发送的数据块划分为更小的单位，在接收端将其还原。 ＠复用和分用 发送端几个高层会话复用一条低层的连接，在接收端再进行分用。 ＠连接建立和释放 交换数据前先建立一条逻辑连接，数据传送结束后释放连接。 分层当然也有一些缺点，例如，有些功能会在不同的层次中亟复出现，因而产生额外 开销。 计算机网络的各层及其协议的集合就是网络的体系结构(arch it ec tu re) 。换种说法，计算 机网络的体系结构就是这个计算机网络及其构件所应完成的功能的精确定义 [GREE82] 。需 • 30 •"}
{"doc_id": "network", "page": 42, "text": "要强调的是：这些功能究竟是用何种硬件或软件完成的，则是一个遵循这种体系结构的实现 (i mp lemen ta ti on) 的问题。体系结构的英文名词 arch it ecture 的原意是建筑学或建筑的设计和 风格。它和一个具体的建筑物的概念很不相同。例如，我们可以走进一个明代的建筑物中， 但却不能走进一个明代的建筑风格之中。同理，我们也不能把一个具体的计算机网络说成是 一个抽象的网络体系结构。总之，体系结构是抽象的，而实现则是具体的，是真正在运行的 计算机硬件和软件。 1.7.3 具有五层协议的体系结构 OSI 的七层协议体系结构（如图 l-16(a) 所示）的概念清楚，理论也较 完整，但它既复杂又不实用。 TCP/IP 体系结构则不同，它现在得到了非常 广泛的应用。 TCP/IP 是一个四层的体系结构（如图 I -16(b) 所示），它包含 视即讲解 应用层、运输层、网际层和链路层（网络接口层）。用网际层这个名字是强调本层解决不同 网络的互连问题。在互联网的标准文档[R.FC 1122, STD3] 中，体系结构中的底层叫作链路层， 但接着又说明了链路层就是媒体接入层。但也有把链路层称为网络接口层的 [COME06] 或子 网层的 [PETE12] 。从实质上讲， TCP/IP 只有最上面的三层，因为最下面的链路层并没有屈 千 TCP/IP 体系的具体协议。链路层所使用的各种局域网标准，并非由 IETF 而是山 IEEE 的 802 委员会下屈的各丁作组负责制定的。在讲授计算机网络原理时往往采取另外的办法，即 综合 OSI 和 TCP/IP 的优点，采用如图 1-16(c) 所示的五层协议的体系结构，这对阐述计符机 网络的原理是十分方便的。 ll ·JI  OSI 的休系结构 /  7 应用臣 6 ．表示层 5 会话怯 4 运输层 3 网络层 2 数踞链路层 I 物理层 /  /  (a)OSI 的七历协议 JJ/  JJJ  V  TCPIIP 的体系结构 ,, /  应用层 （各种应用层协议如 DNS, HTTP, SMTP 等） 运输层 (TCP 或 UDP) 网际层 lP 链路层（网络搂口层） （这一层并没行具体内容） ,,  ,,  /l L  (b) TCP/I P 的四压协议 五层协议的体系结构 / / /  ///  v  /'  5 应用层 4 运输层 3 网络层 2 数据链路炽 I 物理层 /  JJJJ  L/  (c) 讲述原理的五J式协议 困 1-16 计算机网络体系结构 现在结合互联网的情况，自上而下地、非常简婓地介绍一下各层的主驶功能。实际上， 只有认真学习完本书各敢的协议后才能真正弄清各层的作用。 (I) 应用层 (app l i ca ti on layer)  应用层是体系结构中的最高层。应用层的任务是通过应用进程间的交互来完成特定网 络应用。应用层协议定义的是应用进程间通信和交互的规则。这里的进程就是指上机中正在 运行的程序。对千不同的网络应用斋要有不同的应用层协议。互联网中的应用层协议很多， 如域名系统 ONS 、支持万维网应用的 HTTP 协议、支待电子邮件的 SMTP 协议，等等。找 们把应用层交互的数据单元称为报文(message) 。 • 31 •"}
{"doc_id": "network", "page": 43, "text": "(2) 运输层（transpo rt layer)  运输层的任务就是负责向两台主机中进程之间的通信提供通用的数据传输服务。应用 进程利用该服务传送应用层报文。所谓“通用的“，是指并不针对某个特定网络应用，而是 多种应用可以使用同一个运输层服务。由于一台主机可同时运行多个进程，因此运输层有复 用和分用的功能。复用就是多个应用层进程可同时使用下面运输层的服务，分用和复用相反， 是运输层把收到的信息分别交付上而应用层中的相应进程。 运输层主要使用以下两种协议： • 传输控制协议 TCP (Transmission Control Pro tocol}-—才是供面向连接的、可靠的数 据传输服务，其数据传输的单位是报文段(se g men t)。 • 用户数据报协议 UDP (User Datagram Pro tocol)--提供无连接的尽最大努力 (bes t­ e ffo rt)的数据传输服务（不保证数据传输的可靠性），其数据传输的单位是用户数 据报。 顺便指出，有人愿意把运输层称为传输层，理由是这一层使用的 TCP 协议就叫作传输 控制协议。从意思上看，传输和运输差别也不大。但 OSI 定义的第 4 层使用的是 Transpo rt, 而不是 Transmi ss i on 。这两个词的含义还是有些差别的。因此，使用运输层这个译名较为准确。 (3) 网络层 (ne t\\.vork layer)  网络层负贡为分组交换网上的不同主机提供通信服务。在发送数据时，网络层把运输 层产生的报文段或用户数据报封装成分组或包进行传送。在 TCP/IP 体系中，由于网络层使 用 IP 协议，因此分组也叫作 IP 数据报，或简称为数据报。本书把“分组”和“数据报”作 为同义词使用。 诮注意：不要将运输层的“用户数据报协议 UDP\" 和网络层的 “IP 数据报＂弄混。此 外，无论在哪一层传送的数据单元，都可笼统地用“分组”来表示。 网络层的具体任务有两个。第一个任务是通过一定的尊法，在互联网中的每一个路由 器上生成一个用来转发分组的转发表。第二个任务较为简单，就是每一个路由器在接收到一 个分组时，依据转发表中指明的路径把分组转发到下一个路由器。这样就可以使源主机运输 层所传下来的分组，能够通过合适的路由最终到达目的主机。 这里要强调指出，网络层中的“网络”二字，已不是我们通常谈到的具体网络，而是 在计莫机网络体系结构模型中的第 3 层的名称。 互联网是由大堡的异构(heterogeneous) 网络通过路由器（rou ter) 相互连接起来的。互联网 使用的网络层协议是无连接的网际协议 IP (Internet Pro tocol) 和许多种路由选择协议，因此互 联网的网络层也叫作网际层或 IP 层。在本书中．网络层、网际层和 IP 层都是问义语。 (4) 数据链路层(da ta link layer)  数据链路层常简称为链路层。我们知道，两台主机之间的数据传输，总是在一段一段 的链路上传送的，这就需要使用专门的链路层的协议。在两个相邻节点之间传送数据时，数 据链路层将网络层交下来的 IP 数据报组装成帧(fram i n g),在两个相邻节点间的链路上传 送帧（frame) 。每一帧包括数据和必要的控制信息（如同步信息、地址信息、差错控制等）。 在接收数据时，控制信息使接收端能够知道一个帧从哪个比特开始和到哪个比特结束。 这样，数据链路层在收到一个帧后，就可从中提取出数据部分，上交给网络层。 控制信息还使接收端能够检测到所收到的帧中有尤差错。如发现有差错，数据链路层 就简单地丢弃这个出了差错的帧，以免继续在网络中传送下去白白浪费网络资源。如果需要 • 32 •"}
{"doc_id": "network", "page": 44, "text": "改正数据在数据链路层传输时出现的差错（这就是说，数据链路层不仅要检错，而且要纠 错），那么就要采用可靠传输协议来纠正出现的差错。这种方法会使数据链路层的协议复杂 些。 (5) 物理层(phys i cal layer)  在物理层上所传数据的单位是比特。发送方发送 l （或 O) 时，接收方应当收到 1 （或 0) 而不是 0 （或 l) 。因此物理层要考虑用多大的电压代表 ”1 \"或 “O\", 以及接收方如何识 别出发送方所发送的比特。物理层还要确定连接电缆的插头应当有多少根引脚以及各引脚应 如何连接。当然，解释比特代表的意思，不是物理层的任务。诸注意，传递信息所利用的一 些物理传输媒体，如双绞线、同轴电缆、光缆、无线信道等，并不在物理层协议之内，而是 在物理层协议的下面。因此也有人把物理层下面的物理传输媒体当作第 0 层。 在互联网所使用的各种协议中，最重要的和最著名的就是 TCP 和 IP 两个协议。现在人 们经常提到的 TCP/lP 并不一定是单指 TCP 和JP 这两个具体的协议，而往往是表示互联网 所使用的整个 TCP/IP 协议族(p ro tocol su ite) 芞 图 1-17 说明的是应用进程的数据在各层之间的传递过程中所经历的变化。这里为简单 起见，假定两台主机通过一台路由器连接起来。 主机） 吓巨 伈．飞 囚 路山器 匡 21 「区］ 数据 甘:321 2  数据 I IOIOO …比特流··· 1 IO I OOt 1, U I I  电｛行号 物理传 或光信勺一飞小一尸输媒体 巨 荨— 匡 囚—卜 主机 2 I 叫 数据 忭t -j 2  | IO I OO …比特流．． I IO I OO|  晶犒一已一出讲 图 1-17 数枢在各层之间的传递过程 假定主机 l 的应用进程 AP1 向土机 2 的应用进程 AP2 传送数据。 AP1 先将其数据交给本 主机的第 5 层（应用层）。第 5 层加上必要的控制信息压就变成了下一层的数据单元。第 4 层（运输层）收到这个数据单元后，加上本层的控制信息 H-1,再交给第 3 层（网络层），成 为第 3 层的数据单元。依此类推。不过到了第 2 层（数据链路层）后，控制信息被分成两部 分，分别加到本层数据单元的首部 (H2) 和尾部 (T2): 而第 1 层（物理层）由千是比特流 的传送，所以不再加上控制信息。请注意，传送比特流时应从首部开始传送。 OSl 参考模型把对等层次之间传送的数据单位称为该层的协议数据单元 PDU (P ro t ocol Data Un it)。这个名词现已被许多非 OSI 标准采用。 当这一串的比特流离开主机 1 经网络的物理传输媒体传送到路由器时，就从路由器的 第 1 层依次上升到第 3 层。每一层都根据控制信息进行必要的操作，然后将控制信息剥去， G）注： i肖注意 su it e 这个叫的特殊if肯lsw i:1/,,j,耍读铅． • 33 •"}
{"doc_id": "network", "page": 45, "text": "将该层剩下的数据单元上交给更高的，层。当分组上升到了第 3 层网络层时，就根据首部中 的目的地址查找路由器中的转发表，找出转发分组的接口，然后往下传送到第 2 层，加上新 的首部和尾部后，再到最下面的第 1 层，然后在物理传输媒体上把钮一个比特发送出去。 当这一串的比特流离开路由器到达目的站主机 2 时，就从主机 2 的第 1 层按照上面讲 过的方式，依次上升到第 5 层。砓后，把应用进程 AP1 发送的数据交给目的站的应用进程 AP2•  可以用一个简单例子来比喻上述过程。有一封估从最高压向下传。每经过一层就包上 一个新的估封，写上必要的地址信息。包有多个信封的信件传送到目的站后，从第 1 层起， 每层拆开一个信封后就把信封中的信交给它的上一层。传到敬高层后，取出发信人所发的信 交给收信人。 虽然应用进程数据要经过如图 1-17 所示的复杂过程才能送到终点的应用进程，但这些 复杂过程对用户屏蔽掉了，以致应用进程 AP1 觉得好像是直接把数据交给了应用进程 AP2 。 同理，任何两个同样的层次（例如在两个系统的第 4 层）之间，也好像如同图 l-l7 中的水 平虚线所示的那样，把数据（即数据单元加上控制信息）通过水平捉线直接传递给对方。这 就是所谓的“对等层”(peer la y ers) 之间的通信。我们以前经常捉到的各层协议，实际上就 是在各个对等层之间传递数据时的各项规定。 在文献中也还可以见到术语“协议栈＂ (protocol s t ack) 。这是因为几个层次画在一起很 像一个栈(s tack) 的结构。 1.7.4 实体、协议、服务和服务访问点 当研究开放系统中的信息交换时，往往使用实体(en tity)这一较为抽象的名词表示任何可 发送或接收信息的硬件或软件进程。在许多悄况下，实体就是一个特定的软件模块。 协议是控制两个对等实体（或多个实体）进行通信的规则的集合。协议的语法方面的 规则定义了所交换的信息的格式，而协议的语义方面的规则就定义了发送者或接收者所要完 成的操作，例如，在何种条件下，数据必须重传或丢弃。 在协议的控制下，两个对等实体间的通信使得本层能够向上一层提供服务。要实现本 层协议，还需要使用下面一层所提供的服务。 一定要弄清楚，协议和服务在概念上是很不一样的。 首先，协议的实现保证了能够向上一层提供服务。使用本层服务的实体只能看见服务 而无法看见下面的协议。也就是说，下面的协议对上面的实体是透明的。 其次，协议是“水平的＂，即协议是控制对等实体之间通倍的规则。但服务是“垂直 的＂，即服务是由下层向上层通过层间接口提供的。另外，并非在一个层内完成的全部功能 都称为服务。只有那些能够被高一归实体“看得见”的功能才能称之为“服务”。上层使用 下层所提供的服务必须通过与下层交换一些命令，这些命令在 OSI 中称为服务原语。 在同一系统中相邻两层的实体进行交互（即交换信息）的地方，通常称为服务访问点 SAP (Service Access Po i n t)。服务访问点 SAP 是一个抽象的概念，它实际上就是一个逻辑接 口，有点像邮政信箱（可以把邮件放入估箱和从信箱中取走邮件），但这种层间接口和内个 设备之间的硬件接口（并行的或串钉的）并不一样。 OSI 把层与厌之间交换的数据的单位称 为服务数据单元 SDU (Service Data Un it),它可以与 PDU 不一样。例如，可以是多个 SDU 合成为一个 PDU, 也可以是一个 SDU 划分为几个 PDU 。 • 34 •"}
{"doc_id": "network", "page": 46, "text": "这样，在任何相邻两层之间的关系均可概括为图 1-18 所示的那样。这里要注意的是， 第 n 层的两个“实体(11)\" 之间通过“协议(n)\" 进行通信，而第 11 + I 层的两个“实体(n + l)\"  之间则通过另外的“协议(n + I)\" 进行通信（每一层都使用不同的协议）。第 n 层向上面的 第 n + 1 层所提供的服务实际上已包括了在它以下各层所提供的服务。第 n 层的实体对第 n +I 层的实体就相当于一个服务提供者。在服务提供者的上一层的实休又称为“服务用户”, 因为它使用下层服务提供者所提供的服务。 一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一一， 服务川户—一巳已三］ 郎（尸 l) 王已5亘i - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  第 11+1 层 r 第 II 压 服务提供者—寸 L二艺2一上 ··协以（II)· • _____ 1  - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -  图 1-18 相邻两层之间的关系 计算机网络的协议还有一个很堇要的特点，就是协议必须把所有不利的条件事先都估 计到，而不能假定一切都是正常的和非常理想的。例如，两个朋友在电话中约好，下午 3 时 在某公园门口碰头，并且约定“不见不散＂。这就是一个很不科学的协议，因为任何一方临 时有急事来不了而又无法通知对方时（如对方的电话或手机都无法接通），则另一方按照协 议就必须永远等待下去。因此，看一个计算机网络协议是否正确，不能只看在正常悄况下是 否正确，还必须非常仔细地检查协议能否应付任何一种出现概率极小的异常情况。 下面是一个有关网络协议的非常著名的例子。 【例 1-1 】占据东、西两个山顶的蓝军 1 和蓝军 2 与驻扎在山谷的白军作战。其力量对 比是：单独的蓝军 1 或蓝军 2 打不过臼军，但蓝军 1 和蓝军 2 协同作战则可战胜白军。现蓝 军 1 拟于次日正午向白军发起攻击。于是用计算机发送电文给蓝军 2 。但通信线路很不好， 电文出错或丢失的可能性较大（没有电话可使用）。因此要求收到电文的友军必须送回一个 确认电文。但此确认电文也可能出错或丢失。试问能否设计出一种协议使得蓝军 1 和蓝军 2 能够实现协同作战因而一定（即J OO ％而不是 99.999 …%)取得胜利？ 【解】蓝军 l 先发送： ＂拟于明日正午向白军发起攻击。诸协同作战和确认。” 假定蓝军 2 收到电文后发回了确认。 然而现在蓝军 1 和蓝军 2 都不敢下决心进攻。因为，蓝军 2 不知逆此确认电文对方是 否正确地收到了。如未正确收到，则蓝军 l 必定不敢贸然进攻。在此悄况下，自己单方面发 起进攻就肯定要失败。因此，必须等待监军］发送“对堕丛的确认“。 假定监军 2 收到了蓝军 1 发来的确认。但蓝军 1 同样关心自已发出的确认是否已被对 方正确地收到。因此还要等待蓝军 2 的“对确认的确认的确认＂。 这样无限循环下去，蓝军 1 和蓝军 2 都始终无法确定自己最后发出的电文对方是否已 经收到（如图 1-19 所示）。因此，在本例题给出的条件下，没有一种协议可以使蓝军］和蓝 军 2 能够 100 ％地确保胜利。 • 35 •"}
{"doc_id": "network", "page": 47, "text": "西边蓝军 东边蓝军 ＜弓明日正午向白军发起攻击 1 确认 户 仁4 对“确认＂的确认 1 对(“确认＂的确认）的确认 P 图 1-19 无限循环的协议 这个例子告诉我们，吞似非常简单的协议，设计起来要考虑的问题还是比较多的。 1.7.5 TCP/I P 的体系结构 前面已经说过， TCP/IP 的体系结构比较简单，它只有四层。图 1-20 给出了这种四层协 议表示方法的例子。 土机 A 主机 B ...一·一， ＼～边 图 1-20 TCP/l P 四层协议的表示方法举例 应当指出，技术的发展并不遵循严格的 OSI 分层概念。实际上现在的互联网使用的 TCP/IP 体系结构有时已经演变成为图 1-21 所示的那样，即某些应用程序可以直接使用 IP 层， 或直接使用最下面的链路层 [PETE12] 。虽然 TCP/lP 协议族得到了非常广泛的应用，但对 TCP/J P 体系结构的批评意见也有不少。例如，这个体系结构没有清晰地阐明区分开服务、 接口和协议之间的关系，而链路层并非真正的一个层次，而仅仅是强调了 IP 层需要这样一 个与网络的接口。这个体系结构没有把重要的物理层和链路层的内容包含进来。 l l  应用层 TCP I UDP  IP  链路层（网络接口层） 图 1-21 TCP/lP 体系结构的另一种表示方法 还有另一种方法用来表示 TCP/I P 协议族（如图 1-22 所示），它的特点是上下两头大而 中间小：应用层和网络接口层都有多种协议，而中间的 IP 层很小，上层的各种协议都向下 • 36 •"}
{"doc_id": "network", "page": 48, "text": "汇聚到一个 IP 协议中。这种很像沙漏计时器形状的 TCP/IP 协议族表明： IP 层可以支持多 种运输层协议（虽然这里只画出了最主要的两种），而不同的运输层协议上面又可以有多种 应用层协议（所谓的 eve ryth i n g over IP), 同时 IP 协议也可以在多种类型的网络上运行（所 谓的 IP over eve rything)。正因为如此，互联网才会发展到今天的这种全球规模。从图 1-22 不难看出 IP 协议在互联网中的核心作用。 应用层 ,HI 1 1' 1 •••  ．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．这三亡．．．．．．．．．．．．．玉二z················· 运输层 网际层 ························~····=i=······~=·  数据链路层 图 1-22 沙漏计时器形状的 TCP/IP 协议族示意 实际上，图 1-22 还反映出互联网的一个十分益要的设计理念，这就是网络的核心部分 越简单越好，把一切复杂的部分让网络的边缘部分去实现。 【例 1-2 】利用协议栈的概念，说明在互联网中常用的客户－服务器工作方式。 【解】图 1-23 中的主机 A 和主机 B 都各有自己的协议栈。主机 A 中的应用进程（即客 户进程）的位置在最高的应用层。这个客户进程向主机 B 应用层的服务器进程发出请求， 请求建立连接（图中的 O) 。然后，主机 B 中的服务器进程接受 A 的客户进程发来的请求 （图中的 O) 。所有这些通信，实际上都需要使用下面各层所提供的服务。但若仅仅考虑客 户进程和服务器进程的交互，则可把它们之间的交互看成是图 1-23 中的水平虚线所示的那 样。 运输层 网络层 I 数据链路层 0 发起连接建立请求 --------- --------一· 0 接受迕接建立请求 运输层 网络层 数据链路层 图 1-23 在应用层的客户进程和服务器进程的交互 图 l-24 画出了三台主机的协议栈。主机 C 的应用层中同时有两个服务器进程在通信。 服务器 1 在和主机 A 中的客户 l 通信，而服务器 2 在和主机 B 中的客户 2 通信。有的服务 器进程可以同时向几百个或更多的客户进程提供服务。 • 37 •"}
{"doc_id": "network", "page": 49, "text": "主机 A 卞机 C 主机 B 应用层 炖用层 运输压 运输层 运输层 网络层 网络层 网络臣 数据链路｝云 数据链路层 数据链路｝云 物珅层 物理层 物理层 图 1-24 主机 C 的两个服务器进程分别向 A 和 B 的客户进程捉供服务 本章的重要概念 • 计算机网络（可简称为网络）把许多计绊机连接在一起，而互连网则把许多网络连 接在一起，是网络的网络。 • 以小写字母！开始的interne t（互连网）是通用名词，它泛指由多个计算机网络互 连而成的网络。在这些网络之间的通信协议（即通信规则）可以是任意的。 • 以大写字母 I 开始的 In terne t（互联网）是专用名词，它指当前全球最大的、开放 的、由众多网络相互连接而成的特定计算机网络，并采用 TCP/IP 协议族作为通信 规则，且其前身是美国的 ARPANET 。 In ternet的推荐译名是“因特网”，但很少被 使用。 • 互联网现在采用存储转发的分组交换技术以及三层 ISP 结构。 . 互联网按工作方式可划分为边缘部分与核心部分。主机在网络的边缘部分，其作 用是进行信息处理。路由器在网络的核心部分，其作用是按存储转发方式进行分 组交换。 • 计笃机通信是计算机中的进程（即运行着的程序）之间的通信。计算机网络采用的 通信方式是客户－服务器方式和对等连接方式 (P2P 方式）。 • 客户和服务器都是指通信中所涉及的应用进程。客户是服务诸求方，服务器是服务 提供方。 • 按作用范围的不同，计罚机网络分为广域网 WAN 、城域网 MAN 、局域网 LAN 和 个人区域网 PAN 。 • 计算机网络砐常用的性能指标是：速率、带宽、吞吐揽、时延（发送时延、传播时 延、处理时延、排队时延）、时延带宽积、往返时间和信道（或网络）利用率。 • 网络协议即协议，是为进行网络中的数据交换而建立的规则。计算机网络的各层及 其协议的梊合，称为网络的体系结构。 • 五层协议的体系结构由应用层、运输层、网络层（或网际层）、数据链路层和物理 层组成。运输层最重要的协议是 TCP 和 UDP 协议，而网络层蛟重要的协议是 IP 协议。 • 38 •"}
{"doc_id": "network", "page": 50, "text": "习题 l-01 计算机网络可以向用户提供哪些服务？ 1-02 试简述分组交换的要点。 1-03 试从多个方面比较电路交换、报文交换和分组交换的主要优缺点。 1-04 为什么说互联网是自印刷术发明以来人类在存储和交换信息领域的最大变革？ 1-05 互联网基础结构的发展大致分为哪几个阶段？请指出这几个阶段最主婓的特点。 1-06 简述互联网标准制定的几个阶段。 1-07 小写和大写开头的英文名字in terne t和 Interne t在意思上有何重要区别？ 1-08 计算机网络都有哪些类别？各种类别的网络都有哪些特点？ 1-09 计算机网络中的主干网和本地接入网的主要区别是什么？ 1-10 试在下列条件下比较电路交换和分组交换。要传送的报文共 X (b it)。从源点到终点共 经过 K 段链路，每段链路的传播时延为 d (s), 数据率为 b (b it/s) 。在电路交换时电路 的建立时间为 s (s ）。在分组交换时，分组长度为p (b it),每个分组所必须添加的首部 都很短，对分组的发送时延的影响在本题中可以不考虑。此外，各节点的排队等待 时间也可忽略不计。间在怎样的条件下，分组交换的时延比电路交换的要小？ （提 示：画一下草图观察 K 段链路共有几个节点。） 1-11 在上题的分组交换网中，设报文长度和分组长度分别为 x 和(p +h) (b it),其中p为分 组的数据部分的长度，而 h 为每个分组所添加的首部长度，与p的大小无关。通信 的两端共经过 K 段链路。链路的数据率为 b (b it/s), 但传播时延和节点的排队时间均 可忽略不计。若打算使总的时延为最小，问分组的数据部分长度p应取为多大？ （提示：参考图 1-11 的分组交换部分，观察总的时延由哪几部分组成。） 1-12 互联网的两大组成部分（边缘部分与核心部分）的特点是什么？它们的工作方式各 有什么特点？ 1-13 客户－服务器方式与 P2P 对等通信方式的主要区别是什么？有没有相同的地方？ 1-14 计箕机网络有哪些常用的性能指标？ 1-15 假定网络的利用率达到了 90% 。试估算一下现在的网络时延是它的最小值的多少倍？ 1-16 计算机通信网有哪些非性能特征？非性能特征与性能指标有什么区别？ 1-17 收发两端之间的传输距离为 1000 kn1, 信号在媒体上的传播速率为 2 X J08 m/s 。试计 算以下两种情况的发送时延和传播时延： (1) 数据长度为 107 b it,数据发送速率为 100 kb it/s 。 (2) 数据长度为 103 b it，数据发送速率为 I Gb it/s 。 从以上计算结果可得出什么结论？ 1-18 假设信号在媒体上的传播速率为 2.3 X l08 m/s 。媒体长度／分别为： (1) 10 cm （网络接口卡） (2) 100 m （局域网） (3) 100 km （城域网） (4) 5000 km （广域网） 现在连续传送数据，数据率分别为 1 Mbit/s 和 10 Gb it/s 。试计算每一种情况下在媒体 • 39 •"}
{"doc_id": "network", "page": 51, "text": "中的比特数。（提示：媒体中的比特数实际上无法使用仪表测量。本题是假想我们能 够看见媒体中正在传播的比特，能够给媒体中的比特拍个快照。媒体中的比特数取决 千媒体的长度和数据率。） 1-19 长度为 100 字节的应用层数据交给运输层传送，需加上 20 字节的 TCP 首部。再交给 网络层传送，需加上 20 字节的 IP 首部。最后交给数据链路层的以太网传送，加上首 部和尾部共 18 字节。试求数据的传输效率。数据的传输效率是指发送的应用层数据 除以所发送的总数据（即应用数据加上各种首部和尾部的额外开销）。 若应用层数据长度为 1000 字节，数据的传输效率是多少？ 1-20 网络体系结构为什么要采用分层次的结构？试举出一些与分层体系结构的思想相似 的日常生活的例子。 1-21 协议与服务有何区别？有何关系？ 1-22 网络协议的三个要素是什么？各有什么含义？ 1-23 为什么一个网络协议必须把各种不利的悄况都考虑到？ 1-24 试述具有五层协议的网络体系结构的要点，包括各层的主要功能。 1-25 试举出日常生活中有关“透明”这一名词的例子。 1-26 试解释以下名词：协议栈、实体、对等层、协议数据单元、服务访问点、客户、服 务器、客户－服务器方式。 1-27 试解释 eve rythi n g over IP 和 IP over eve ryt h i ng的含义。 1-28 假定要在网络上传送 l.5 MB 的文件。设分组长度为 l KB, 往返时间 RTT = 80 ms 。 传送数据之前还盂要有建立 TCP 连接的时间，这时间是 2 x RTT = 160 ms 。试计算在 以下几种情况下接收方收完该文件的圾后一个比特所需的时间。 (I) 数据发送速率为 10 Mb it/s, 数据分组可以连续发送。 (2) 数据发送速率为 10 Mbit/s, 但每发送完一个分组后要等待一个 RTT 时间才能再 发送下一个分组。 (3) 数据发送速率极快，可以不考虑发送数据所需的时间。但规定在每一个 RTT 往返 时间内只能发送 20 个分组。 (4) 数据发送速率极快，可以不考虑发送数据所需的时间。但在第一个 RTT 往返时间 内只能发送一个分组，在第二个 RTT 内可发送两个分组，在第三个 RTT 内可发送四 个分组（即 23 - I = 22 = 4 个分组） （这种发送方式见教材第 5 章 TCP 的拥塞控制部 分）。 1-29 有一个点对点链路，长度为 50 km 。若数据在此链路上的传播速率为 2 X 108 mfS, 试 问链路的带宽应为多少才能使传播时延和发送 100 字节的分组的发送时延一样大？ 如果发送的是 512 字节长的分组，结果又应如何？ 1-30 有一个点对点链路，长度为 20000 km 。数据的发送速率是 I kbit/s, 要发送的数据有 100 b it。数据在此链路上的传播速率为 2 X J08 m/S 。假定我们可以看见在线路上传输 的比特，试画出我们看到的线路上的比特（画两张图，一张是在 100 b it刚刚发送完 时，另一张是再经过 0.05 s 后）。 1-31 条件同上题，但数据的发送速率改为 1 Mbit/s 。和上题的结果相比较，你可以得出什 么结论？ • 40 •"}
{"doc_id": "network", "page": 52, "text": "1-32 以 I Gbit/s 的速率发送数据。试问在以距离或时间为横坐标时，一个比特的宽度分别 是多少？ 1-33 我们在互联网上传送数据经常是从某个源点传送到某个终点，而并非传送过去又再 传送回来。那么为什么往返时间 RIT 是个很亟要的性能指标呢？ 1-34 主机 A 向主机 B 发送一个长度为 107 比特的报文，中间要经过两个节点交换机，即 一共经过三段链路。设每条链路的传输速率为 2 Mb it/s 。忽略所有的传播、处理和排 队时延。 (I) 如果采用报文交换，即整个报文不分段，每台节点交换机收到整个的报文后再转 发。问从主机 A 把报文传送到第一个节点交换机需要多少时间？从主机 A 把报文传 送到主机 B 需要多少时间？ (2) 如果采用分组交换。报文被划分为 1000 个等长的分组（这里忽略分组首部对本 题计算的影响），并连续发送。节点交换机能够边接收边发送。问从主机 A 把第一个 分组传送到第一个节点交换机需要多少时间？从主机 A 把第一个分组传送到主机 B 需要多少时间？从主机 A 把 1000 个分组传送到主机 B 需要多少时间？ (3) 就一般情况而言，比较用整个报文来传送和用划分多个分组来传送的优缺点。 1-35 主机 A 向主机 B 连续传送—个 600000 b it的文件。 A 和 B 之间有一条带宽为 I Mbit/s  的链路相连，距离为 5000 km, 在此链路上的传播速率为 2.5 X 108 m/s 。 链路上的比特数目的敬大值是多少？ 链路上每比特的宽度（以米来计箕）是多少？ 若想把链路上每比特的宽度变为 5000 km （即整条链路的长度），这时应把发送速率 调整到什么数值？ 1-36 主机 A 到主机 B 的路径上有三段链路，其速率分别为 2 Mbit/s, I Mbit/s 和 500 kb it/s 。现 在 A 向 B 发送一个大文件。试计算该文件传送的吞吐批。设文件长度为 10 MB, 而 网络上没有其他的流豐。试问该文件从 A 传送到 B 大约需要多少时间？为什么这里 只是计算大约的时间？ • 41 •"}
{"doc_id": "network", "page": 53, "text": "第 2 章物理层 本章首先讨论物理尼的埜本概念。然后介绍有关数据通估的重要概念，以及各种传输 媒体的主要特点，但传输媒体本身并不屈千物理层的池围。在讨论几种常用的信道复用技术 后，对数字化输系统进行简单介绍。最后再讨论几种常用的宽带接入技术。 对于已具备一些必要的通信牡础知识的读者，可以跳过本竞的许多部分的内容。 本总砐正要的内容是： (1) 物理臣的任务。 (2) 几种常用的信道复用技术。 (3) 几种常用的宽带接入技术，币点足 FTTx. 2.1 物理层的基本概念 首先要强调指出，物理层考虑的是怎样才能在连接各种计算机的传输媒体上传输数据 比特流，而不是指具体的传输媒体。大家知道，现有的计絊机网络中的硬件设备和传输媒体 的种类非常繁多，而通信手段也有许多不同方式。物理层的作用正是要尽可能地屏蔽掉这些 传输媒体和迎信手段的差异，仗物理层上面的数据链路层感觉不到这些差异，这样就可使数 据链路层只需要考虑如何完成本层的协议和服务，而不必考虑网络具体的传输媒体和通信手 段是什么。用千物理层的协议也常称为物理层规程(procedure) 。其实物理层规程就是物理层 协议。只是在“协议”这个名词出现之前人们就先使用了”规程”这一名词。 可以将物理层的主要任务描述为确定与传输媒体的接口有关的一些特性，即： (I)机械特性 指明接口所用接线器的形状和尺寸、引脚数目和排列、固定和锁定装 置等。平时常见的各种规格的接插件都有严格的标准化的规定。 (2) 电气特性 指明在接口电缆的各条线上出现的电压的范围。 (3) 功能特性 指明某条线」一出现的某一电平的电压的意义。 (4) 过程特性 指明对丁不同功能的各种可能事件的出现顺序。 人家知道，数据在计算机内部多采用并行传输方式。但数踞在通信线路（传输媒体） 上的传输方式一般都是串行传输（这是出十经济上的考虑），即逐个比特按照时间顺序传输。 因此物理层还要完成传输方式的转换。 具体的物理层协议种类较多。这是因为物理连接的方式很多（例如，可以是点对点的， 也可以采用多点连接或广播连接），而传输媒体的种类也非常之多（如架空明线、双绞线、 对称电缆、同轴电缆、光缆，以及各种波段的无线信道等）。因此在学习物理层时，应将重 点放在掌握基本概念上。 考虑到使用本教材的一部分读者可能没有学过“接口与通信”或有关数据通信的课程， 因此我们利用下而的 2.2 节简单地介绍一下有关现代通信的一些砓基本的知识和最重要的结 论（不给出证明）。已具有这部分知识的读者可略过这部分内容。 • 42 •"}
{"doc_id": "network", "page": 54, "text": "2.2 数据通信的基础知识 2.2. l 数据通信系统的模型 下面我们通过一个砓简单的例子来说明数据通信系统的模型。这个例子就是两台计算 机经过普通电话机的连线，再经过公用电话网进行通信。 如图 2-1 所示，一个数据通信系统可划分为三大部分，即源系统（或发送端、发送方）、 传输系统（或传输网络）和目的系统（或接收端、接收方）。 数据通信系统 输入汉字 数字比特流 模拟信号， 模拟信号 数字比特流 昴示汉字 悖二二产产丿二石已兰二与卢 源系统 ' 传输系统 : 目的系统 图 2-1 数据通信系统的模型 源系统一般包括以下两个部分： • 源点 (source) 源点设备产生要传输的数据，例如，从计算机的键盘输入汉字，计 算机产生输出的数字比特流。源点又称为源站或信源。 • 发送器 通常源点生成的数字比特流要通过发送器编码后才能够在传输系统中进行 传输。典型的发送器就是调制器。现在很多计算机使用内置的调制解调器（包含调 制器和解调器），用户在计算机外面看不见调制解调器。 目的系统一般也包括以下两个部分： • 接收器 接收传输系统传送过来的信号，并把它转换为能够被目的设备处理的信息。 典型的接收器就是解调器，它把来自传输线路上的模拟信号进行解调，提取出在发 送端置入的消息，还原出发送端产生的数字比特流。 • 终点 (des ti na ti on) 终点设备从接收器获取传送来的数字比特流，然后把估息输出 （例如，把汉字在计算机屏幕上显示出来）。终点又称为目的站或信宿。 在源系统和目的系统之间的传输系统可以是简单的传输线，也可以是连接在源系统和 目的系统之间的复杂网络系统。 图 2-1 所示的数据通信系统，也可以说是计算机网络。这里我们使用数据通信系统这个 名词，主要是为了从通信的角度来介绍数据通信系统中的一些要素，而有些数据通信系统的 要素在计算机网络中可能就不去讨论它们了。 下面我们先介绍一些常用术语。 通信的目的是传送消息(message) 。话音、文字、图像、视频等都是消息。数据(da t a) 是 运送消息的实体。根据 RFC4949 给出的定义，数据是使用特定方式表示的信息，通常是有 • 43 •"}
{"doc_id": "network", "page": 55, "text": "意义的符号序列。这种信息的表示可用计絊机或其他机器（或人）处狸或产生。信号(s ig nal) 则是数据的电气或电磁的表现。 根据信号中代表消息的参数的取俏方式不同，估号可分为以下两大类： (I) 模拟信号，或连续信号一—代表消息的参数的取们足连续的。例如在图 2-1 中，用 户家中的调制解调器到电话端扁之间的用户线上传送的就足橾拟化号。 (2) 数字信号，或离散信号一—代表消息的参数的取伯足离散的。例如在图 2-1 中，用 户家中的计算机到调制解调器之间或在屯话网中继线上仕送的就是数字信号。在使用时间域 （或简称为时域）的肢形表示数字信号时，代表不同岛散数伯的基本波形就称为码元©。在 使用二进制编码时，只有两种刁、同的砃元，一种代表 0 状念而另一种代表 1 状态． 下面我们介绍有关信逆的几个基本概念。 2.2.2 有关信道的几个基本概念 在许多情况下，我们要使用“信道(channel)\" 这一名词。信道和电路并 不等同。信道一般都是用来表示向某一个方向传送信息的媒体。因此，一条 回 通信电路往往包含一条发送信道和一条接收信道。 视栨讲鲜 从通信的双方信息交互的方式来看，可以有以下三种基本方式： {I) 单向通信 又称为单工通信，即只能有一个方向的通信而没有反方向的交互。无 线电广播或有线电广播以及电视广播就屈十这种类型。 (2) 双向交替通信 又称为半双工通信，即通信的双方都可以发送信息，但不能双方 同时发送（当然也就不能同时接收）。这种通信方式是一方发送另一方接收，过一段时间后 可以再反过来。 (3) 双向同时通信 又称为全双工通信，即通信的双方可以同时发送和接收信息。 单向通信只需要一条估道，而双向交替通信或双向同时通信则都衙要两条信道（每个 方向各一条）。显然，双向同时通信的传输效率砐础。 这里要提醒读者注意，有时人们也常用“单工”这个名词表示“双向交替通信＂。如常 说的“单工电台”并不是只能进行单向通信。正囚为如此， ITU-T 才不采用“单工”“半双 工”和“全双工”这些容易弄混的术语作为正式的名词。 来自信源的信号常称为基带信号（即基本频带信号）。像计算机输出的代表各种文字或 图像文件的数据信号都属于基带佑号。基带信号往往包含较多的低频分盘，甚至有直流分狱， 而许多信道并不能传输这种低频分卅或直流分扭。为了解决这一问题，就必须对基带信号进 行调制(modula ti on) 。 调制可分为两大类。 －类是仅仅对基带信号的波形进行变换，使它能够与信道特性相 适应。变换后的信弓仍然是基带信号。这类调制称为基带调制．由于这种基带调制是把数字 信号转换为另一种形式的数字信号，因此大家更愿总把这种过程称为编码 (cod i n g)。另一类 调制则需要使用载波（ca n-i er) 进行调制，把基带信号的频率范围搬移到较高的频段，并转换 为模拟信号，这样就能够更好地在桢拟信道中传输。经过载波调制后的信号称为带通信号 （即仅在一段频率范围内能够通过信道），而使用载波的调制称为带通调制。 ＠注： －个码元所携带的估息臣不是固定的，而是山调制方式和编砃方式决，过的． • 44 •"}
{"doc_id": "network", "page": 56, "text": "(I) 常用编码方式 常用编码方式如图 2-2 所示。 ,'`  .•  `  流制特岑七刁上“y 不 1 。 。 1 。 。 1 1 1  归零制 曼彻斯特 左分曼彻斯特 图 2-2 数字信号常用的编码方法 不归零制：正电平代表 I, 负电平代表 0 。 归零制：正脉冲代表 I, 负脉冲代表 0 。 曼彻斯特编码：位周期中心的向上跳变代表 O, 位周期中心的向下跳变代表 l 。但 也可反过来定义。 差分曼彻斯特编码：在每一位的中心处始终都有跳变。位开始边界有跳变代表 0, 而位开始边界没有跳变代表 1 。 从信号波形中可以看出，曼彻斯特(Manchester) 编码产生的信号频率比不归零制高。从 自同步能力来看，不归零制不能从信号波形本身中提取信号时钟频率（这叫作没有自同步能 力），而曼彻斯特编码具有自同步能力。 (2) 基本的带通调制方法 图 2-3 给出了最基本的调制力法。 . . .  .  枯带信号 。 。 调幅 调频 调相 图 2-3 最基本的三种调制方法 调幅（AM), 即载波的振幅随基带数字信号而变化。例如， 0 或 1 分别对应千无载 波或有载波输出。 调频(FM), 即载波的频率随基带数字信号而变化。例如， 0 或 1 分别对应于频率Ji 或凡 调相 (PM), 即载波的初始相位随基带数字信号而变化。例如， 0 或 1 分别对应千相 位 0 度或 180 度。 为了达到更高的信息传输速率，必须采用技术上更为复杂的多元制的振幅相位混合调 制方法。例如，正交振幅调制QAM (Quadrature Amplitude Modulati on) 。 有了上述的一些基本概念之后，我们再讨论信道的极限容量。 .  .  .  • 45 •"}
{"doc_id": "network", "page": 57, "text": "2.2.3  n-n  几十年来，通信领域的学者一肛在努力寻找提高数据传输速率的途径。 譬回 这个问题很复杂，因为任何实际的信逆都不处理想的，都不可能以任意高 回百奴守，．也 的速率进行传送。我们知道，数字通信的优占、就是：虽然估号在信道上传 视频讲衅 输时会不可避免地产生失直，但在接收端只要我们从失真的波形中能够识别出原来的信号， 那么这种失真对通信质址就可视为无影响。例如，图 2-4(a) 表示信号通过实际的信道传输后 虽然有失真，但在接收端还可识别并恢复出原来的码元。但图 2-4(b)就不同了，这时信号的 失真已很严蜇，在接收端无法识别码元是 1 还是 0 。码元传输的速率越高、信号传输的距离 越远、噪声干扰越大或传输媒体质垃越差，在接收端的波形的失真就越严重。 信道的极限容揽 工发送信号波形 JUl_  发送信号波形 实际的信道 （带宽受限、付噪声、干扰和失贞） 5  实际的俏迅 （带宽受限、有噪卢、 「扰和失贞） 5  )  (a) 付失具但可识别 ,,  ,  二 桵收信号波形 ,····,,..., : : : : 失兵大 ）－－＝无法识别 (b) 失从大．无法识别 图 2-4 数字估号通过实际的信道 接收信号波形 从概念上讲，限制码元在信道上的传输速率的因素有以下两个。 (I) 信道能够通过的频率范围 具体的信道所能通过的频率范围总是有限的。信号中的许多高频分量往往不能通过信 道。像图 2-4 所示的发送信号是一种典犁的矩形脉冲信号，它包含很丰富的高频分泣。如果 信号中的高频分帕在传输时受到衰减，那么在接收端收到的波形前沿和后沿就变得不那么陡 峭了，每一个码元所占的时间界限也不再是很明确的，而是前后都拖了“尾巴＂。这样，在 接收端收到的信号波形就失去了码元之间的消晰界限。这种现象叫作码间串扰。严重的码间 串扰使得本来分得很浩楚的一串码元变得模糊而无法识别。早在 1924 年，奈奎斯特(Nyq u is t) 就推导出了著名的奈氏准则。他给出了在假定的理想条件下，为了避免码间串扰，码元的传 输速率的上限值。奈氏准则的推导已超出本书的范围，这可在通信原理教科书中查阅到。这 里我们只需要知道奈氏准则的结论，这就是：在带宽为 W (Hz) 的低通信道中，若不考虑噪 声影响，则码元传输的最高速率是 2W （码元／秒）。传输速率超过此上限，就会出现严重的码 间串扰的问题，使接收端对码元的判决（即识别）成为不可能。例如，信道的带宽为 4000 Hz, 那么最高码元传输速率就是每秒 8000 个码元。 实际的信道都是有噪庐的，因此我们还必须知道信道的信噪比数值。 (2) 信噪比 噪声存在十所有的电子设备和通信信道中。由于噪户是随机产生的，它的瞬时值有时 会很大，因此噪声会使接收端对码元的判决产生错误（ l 误判为 0 或 0 误判为 1) 。但噪声的 影响是相对的。如果信号相对较强，那么噪声的影响就相对较小。因此，信噪比就很重要。 所谓信噪比就是信号的平均功率和噪声的平均功率之比，常记为 SIN。但通常大家都是使用 • 46 •"}
{"doc_id": "network", "page": 58, "text": "分贝 (dB) 作为度址单仿。即： 估噪比(dB) = 10 log10(S/N) (dB) (2-1)  例如，当 SIN= 10 时，信噪比为 10dB ，而当 SIN= 1000 时，信噪比为 30 dB 。 在 1948 年，信息论的创始人香农(Shannon) 推导出了茗名的香农公式。香农公式指出： 信道的极限信息传输速率 C 是 C = W lo g式 1 +SIN) (bit/ s) (2-2)  式中， W 为信道的带宽（以 Hz 为单位）， S 为信道内所传信号的平均功率， N 为信道内 部的高斯噪声功率。香农公式的推导可在通信原理教科书中找到。这里只给出其结果。 香农公式表明，信道的带宽或信道中的信噪比越大，信息的极限传输速率就越高。香 农公式指出了信息传输速率的上限。香农公式的意义在千：只要信息传输速率低于信逆的极 限信息传输速率，就一定存在某种办法来实现无差错的传输。不过，香衣没有告诉我们具体 的实现方法。这要由研究通信的专家去寻找。 从以上所讲的不难看出，对于频带宽度已确定的信道，如果信噪比也不能再提岛了， 并且码元传输速率也达到了上限值，那么还有什么办法提高信息的传输速率呢？这就是用编 码的方法让每一个码元携带更多比特的信息噩。我们可以用个简单的例子来说明这个问题。 假定我们的基带信号是： 10101100011011101 O···  如果直接传送，则每一个码元所携带的信息址是 I b it。现将信号中的每 3 个比特编为 一个组，即 101,011,000,110,111,010, …。 3 个比特共有 8 种不同的排列。我们可以用不同 的调制方法来表示这样的信号。例如，用 8 种不同的振幅、 8 种不同的频率或 8 种不同的相 位进行调制。假定我们采用相位调制，用相位<po 表示 000, (j) 1 表示 00 l, <p 2 表示 010, …,<p7 表 示 111 。这样，原来的 18 个码元的信号就转换为由 6 个新的码元（即由原来的每三个 b it构 成一个新的码元）组成的信号： 10101100011011101 O· • • = <ps <p3 <po <p6 <p1 <p2· • •  也就是说，若以同样的速率发送码元，则同样时间所传送的信息址就提高到了 3 倍。 设想把信号中的每 8 个比特编为一组，即原来的 8 个码元的信号转换为 1 个新的码元。这样， 数据传输速率可提高到 8 倍。但是我们要注意， 8 个比特共有 256 种不同的排列。也就是说， 在接收端必须能够从收到的有噪声干扰的信号中，准确地判断这是 256 种码元中的哪—个。 这种解码技术难度很大，并且还必须使信噪比达到相应的数值（有时甚至无法做到）。因此 不能简单地认为，为了提高数据传输速率，可以让每一个码元表示任意多个比特。 请注意，奈氏准则和香农公式的意义是不同的。奈氏准则激励工程人员不断探索更加 先进的编码技术，使每一个码元携带更多比特的信息贵。香农公式则告诫工程人员，在有噪 声的实际信道上，不论采用多么复杂的编码技术，都不可能突破公式（2-2) 给出的信息传输速 率的绝对极限。由此可看出香农公式的威要蔥义。 自从香衣公式发表后，各种新的信号处理和调制方法不断出现，其目的都是为了尽可 能地接近香农公式给出的传输速率极限。在实际信道上能够达到的信息传输速率要比香农公 • 47 •"}
{"doc_id": "network", "page": 59, "text": "式中的极限传输速率低不少。这是因为在实际信道中，伯号还要受到其他一些损伤，如各种 脉冲干扰和在传输中产生的失真等。这些因素在香农公式的推导过程中并未考虑。 2.3 物理层下面的传输媒体 传输媒体也称为传输介质或传输媒介，它就是数据传输系统中在发送器和接收器之间 的物理通路。传输媒体可分为两大类，即导引型传输媒体和非导引型传输媒体（这里的”导 引型”的英文就是guided, 也可译为“导向传输媒体”)。在导引型传输媒体中，电磁波被导 引沿着固体媒体（铜线或光纤）传播；而非导引型传输媒体就是指自由空间，在非导引型传 输媒体中电磁波的传输常称为无线传输。 00 2-5 是电信领域使用的电磁波的频谱。 平） I 1 低频 1 无线电 1 t攷沙女 1 红外线1}| \\\\| X 射线 l 九母 可见光紫外线 f (Hz) IO' 10''107 108 10'1 1010 JOII 1011 JQD 1014 1015 JQ16  同轴电缆 l 1 、· 海平 调幅 无线电无线电 波段 LF. MF. HF. VHF. UHF. SHF EHF THF  图 2-5 电信领域使用的电磁波的频谱 2.3. l 导引型传输媒体 1. 双绞线 光纤 双绞线也称为双扭线，是最古老但又是最常用的传输媒体。把两根互相绝缘的铜导线 并排放在一起，然后用规则的方法绞合(twi s t)起来就构成了双绞线。绞合可减少对相邻导线 的电磁干扰。使用双绞线最多的地方就是到处都有的电话系统。几乎所有的电话都用双绞线 连接到电话交换机。这段从用户电话机到交换机的双纹线称为用户线或用户环路(subscri ber loo p)。通常将一定数量的这种双绞线捆成电缆，在其外面包上护套。现在的以太网（主流 的计算机局域网）基本上也是使用各种类型的双绞线电缆进行连接的。 在电话系统中使用的双绞线，其通信距离一般为几公里。如果使用较粗的导线，则传 输距离也可以达到十几公里。距离太长时就要加放大器以便将衰减了的信号放大到合适的数 值（对于栈拟传输），或者加上中继器以便对失真了的数字信号进行整形（对丁数字传输）。 导线越粗，其通信距离就越远，但价格也越高。 当局域网问世后，人们就研究怎样把原来川于传送话音信号的双绞线用来传送计算机 网络中的离速数据。在传送高速数据的情况下，为了提高双绞线抗电磁干扰的能力以及减少 电缆内不同双绞线对之间的串扰，可以采用增加双绞线的绞合度以及增加电磁屏蔽的方法。 于是在市场上就陆续出现了多种不同类型的双绞线，可以使用在各种不同的情况。 无屏蔽双绞线 UTP (Unsh ielded Twisted Pa i r) （如图 2-6(a) 所示）的价格较便宜。当数据 • 48 •"}
{"doc_id": "network", "page": 60, "text": "的传送速率增高时，可以采用屏蔽双绞线 (Sh i elded Twisted Pa i r, 简称为 STP) 。如果是对 整条双绞线电缆进行屏蔽，则标记为．l(/UTP 。若 x 为 F (Fo i led), 则表明采用铝笛屏蔽层 （图 2-6(b)); 若 x 为 S (braid Screen), 则表明采用金屈编织层进行屏蔽（这种电缆的弹性较 好，便于弯曲，通常使用铜编织层）；若 x 为 SF, 则表明在铝销屏蔽层外面再加上金属编织 层进行屏蔽。更好的办法是给电缆中的每一对双绞线都加上铝滔屏蔽层（记为 FTP 或 U/FTP, U 表明对整条电缆不另增加屏蔽层）。如果在此基础上再对整条电缆添加屏蔽层， 则有 F/FTP （整条电缆再加上铝笛屏蔽层）或 S/F TP （整条电缆再加上金屈编织层进行屏 蔽）。所有的屏蔽双绞线都必须有接地线。图 2-6(c) 表示 5 类线具有比 3 类线更高的绞合度 (3 类线的绞合长度是 7.5~10 cm, 而 5 类线的绞合长度则是 0.6~0.85 cm) 。绞合度越高的 双绞线能够用越高的数据率传送数据。图 2-6(d) 所示的是三种 IOGBASE-T 电缆，在抗干扰能 力上， U/FTP 比 F/UTP 好，而 F/FTP 则是砐好的。 带绝缘层的铜线／ ／圣了 ～、 PVC 套层 (a) 无屏蔽双绞线 UTP 带绝缘层的铜线 、一 匾 PV C'套层铝笛屏蔽层、＼接地线 (b) 屏蔽双绞线 STP (F/UTP)  3 类线 二二干｀＇一 ～记” 5 类线 只芯勹已勹廷过公3 (c) 不同绞合度的从绞线 F/UTP U/FTP F/FTP  ｀叁产） 屏蔽层 屏蔽层 (d) 二种不同类型的 lOGBASE-T 电缆 图 2-6 几种不同的双绞线 1991 年，美国电子工业协会 EIA (Electronic Industries Assoc i a ti on) 和电信行业协会 TIA (Telecommunications Industries Associ a ti on) 联合发布了标准 EI AffIA-568, 其名称是“商用建 筑物电信布线标准 ”(Commerc i al Building Telecommunications Cabling S tandard) 。这个标准 规定了用于室内以及在建筑物之间传送数据的各种电缆的有关标准。有时，在标准的制定单 位前而还加上美国国家标准协会 ANSI (Ame1i can National Standards Ins titu te) 。为了适应技术 的发展，每隔数年就要更新一次标准。 2017 年颁布的新标准是 ANSI/ElA-568-D, 新的标准 还包括了连接局域网所用的光缆。在 5 类线间世后就不断研制出具有更高绞合度的双绞线。 现在簸新的 8 类线的带宽已达到 2000 MHz, 可用于 40 吉比特以太网的连接。表 2-1 给出了 常用的绞合线的类别、带宽和典和应用。 表 2-1 常用的绞合线的类别、带宽和典型应用 绞合线类别 带宽 线缆特点 典型应用 3 16 MHz 2 对 4 芯双绞线 校拟电话：传统以太网(J O Mbit/s)  5 100 MHz 与 3 类相比培加f绞合度 传输速率 100 Mb it/s （距宽 100 m)  5E （超 5 类） 125 MHz 与 5 类相比衰减更小 传输速卒 I Gb心（距岛 IOOm) 6 250 MHz 改善了出扰笘忤能．可使用屏蔽双绞线 传输逑率 IO Gb it/s （距离 35~55 m)  6A 500 MIi z 改善 1 串扰芍计能．可使用屏蔽双绞线 传输速率 10 Gb it/s （距离 100 m)  • 49 •"}
{"doc_id": "network", "page": 61, "text": "续表 7 绞合线类别 1 6002 I 必须使用屏蔽双绞？特点 8 2000 MHz I 必须使用屏蔽双绞线 典型应用 传输速轧超过 IOGb it/s, 许岛 IOOm 伈输速书 25 Gb it/s 或 40 Gb it/s, 距离 30m 无论是哪种类别的双绞线，衰减都随频率的升高而增大。使川更租的导线可以减小衰 减，但却增加了导线的重品和价格。信号应当有足够大的振幅，以便在噪卢干扰下能够在接 收端正确地被检测出来。双绞线的最高速率还与数字估号的编码方法有很大的关系。 2. 同轴电缆 同轴电缆由内导体铜质芯线（单股实心线或多股绞合线）、绝缘层、网状编织的外导体 屏蔽层（也可以是单股的）以及绝缘保护套层所组成（如图 2-7 所示）。由于外导体屏蔽层 的作用，同轴电缆具有很好的抗干扰特性，被广泛用十传输较高速率的数据。 盂求）；宁休 图 2-7 同轴电缆的结构 在局域网发展的初期曾广泛地使用同轴电缆作为传输媒体。但随若技术的进步，在局 域网领域基本上都采用双绞线作为传输媒体。目前同轴电缆主要用在有线电视网的居民小区 中。同轴电缆的带宽取决千电缆的质址。目前高质谥的同轴电缆的带宽已接近 I GHz 。 3. 光缆 从 20 世纪 70 年代到现在，通信和计算机都发展得非常快。据统计，计算机的运行速 度大约每 10 年提高 10 倍。在通信领域里，信息的传输速率则提离得更快，从 20 世纪 70 年 代的 56 kb it/s （使用铜线）提高到现在的数百 Gb it/s （使用光纤），并且这个速率还在继续 提尚。因此，光纤通信成为现代通信技术中的一个十分矗要的领域。 光纤通信就是利用光导纤维（以下简称为光纤）传递光脉冲来进行通信的。有光脉冲 相当于 1 ，而没有光脉冲相当于 0 。由千可见光的频率非常高，约为 108 MHz 的址级，因此 一个光纤通信系统的传输带宽远远大千目前其他各种传输媒体的带宽。 光纤是光纤通信的传输媒体。在发送端有光源，可以采用发光二极管或半导体激光器， 它们在电脉冲的作用下能产生出光脉冲。在接收端利用光电二极管做成光检测器，在检测到 光脉冲时可还原出电脉冲。 光纤通常由非常透明的石英玻璃拉成细丝，主要由纤芯和包层构成双层通信圆柱体。 纤芯很细，其直径只有 8~100 µm (1 µm = 10--<> m) 。光波正是通过纤芯进行传导的。包层 较纤芯有较低的折射率。当光线从高折射率的媒体射向低折射率的媒体时，其折射角将大于 入射角（如图 2-8 所示）。因此，如果入射角足够大，就会出现全反射，即光线碰到包层时 就会折射回纤芯。这个过程不断重复，光也就沿石光纤传输下去。 • 50 •"}
{"doc_id": "network", "page": 62, "text": "折射伯 包层（低折射；午的媒休） 纤芯（庙折射车的媒体） 包层（低折射率的媒体） 图 2-8 光线在光纤中的折射 图 2-9 画出了光波在纤芯中传输的示意图。现代的生产工艺可以制造出超低损耗的光纤， 即做到光线在纤芯中传输数公里而基本上没有什么衰耗。这一点乃是光纤通信得到飞速发展 的最关键因素。 已二二二二 图 2-9 光波在纤芯中的传输 图 2-9 中只画了一条光线。实际上，只要从纤芯中射到纤芯表面的光线的入射角大于某 个临界角度，就可产生全反射。因此，可以存在多条不同角度入射的光线在一条光纤中传输。 这种光纤就称为多模光纤（如图 2- l O(a) 所示）。光脉冲在多模光纤中传输时会逐渐展宽，造 成失页。因此多模光纤只适合于近距离传输。若光纤的直径减小到只有一个光的波长，则光 纤就像一根波导那样，可使光线一直向前传播，而不会产生多次反射。这样的光纤称为单模 光纤（如图 2-10 (b)所示）。单模光纤的纤芯很细，其直径只有几个微米，制造起来成本较高。 同时单模光纤的光源要使用昂贵的半导体激光器，而不能使用较便宜的发光二极管。但单模 光纤的衰耗较小，在 100 Gb it/s 的高速率下可传输 100 公里而不必采用中继器。 输入脉冲 输出脉冲 [!]-多／＿＿＿二二一二:-m (a) 丁~囚 丁I (b)  图 2-10 多模光纤(a) 和单模光纤(b)的比较 在光纤通信中常用的三个波段的中心分别位于 850 nm, 1300 nm 和 1550 nm{J)。后两种情 况的衰减都较小。 850 nm 波段的衰减较大，但在此波段的其他特性均较好。所有这三个波 ＠注：单位 nm 是“纳米＇．即 10-9 米。 13lOnm= 1.3l µm.  • 51 •"}
{"doc_id": "network", "page": 63, "text": "段都具有 25000~30000 GHz 的带宽，可见光纤的通信容益非常大。 由千光纤非常细，连包层一起的直径也不到 0.2 mm 。因此必须将光纤做成很结实的光 缆。一根光缆少则只有一根光纤，多则可包括数十至数百根光纤，再加上加强芯和填充物就 可以大大提高其机械强度。必要时还可放入远供电源线。最后加上包带层和外护套，就可以 使抗拉强度达到几公斤，完全可以满足工程施工的强度要求。图 2-11 为四芯光缆剖而的示 意图。 外护狂 远供电源线 光纤及其包层 坟允物 加强芯 图 2-11 四芯光缆剖面的示意图 光纤不仅具有通信容量非常大的优点，而且还具有其他的一些特点： (I) 传输损耗小，中继距离长，对远距离传输特别经济。 (2) 抗雷电和电磁千扰性能好。这在有大电流脉冲干扰的环境下尤为重要。 (3) 无串音干扰，保密性好，也不易被窃听或截取数据。 (4) 体积小，重扯轻。这在现有电缆节道已拥塞不堪的情况下特别有利。例如， I km 长 的 l000 对双绞线电缆约重 8000 k g,而同样长度但容量大得多的一对两芯光缆仅重 100 k g。 但要把两根光纤精确地连接起来，盆要使用专用设备。 由于生产工艺的进步，光纤的价格不断降低，因此现在已经非常广泛地应用在计算机 网络、电信网络和有线电视网络的主干网络中。光纤提供了很高的带宽，而且性价比很高， 在高速局域网中也使用得很多。例如， 2016 年问世的 OM5 光纤（宽带多模光纤）使用短波 分复用 SWDM (Short WDM), 可支持 40 Gbit/s 和 I 00 Gb it/s 的数据传输。 最后要提一下，在导引型传输媒体中，还有一种是架空明线（铜线或铁线）。这是在 20 世纪初就已大位使用的方法－在电线杆上架设的互相绝缘的明线。架空明线安装简单，但 通信质量差，受气候环境等影响较大。许多国家现在都已停止了铺设架空明线。目前在我国 的一些衣村和边远地区的通信仍使用架空明线。 丿2『／［勹弓｀｀：：：t/：：：：：几 • 52 •"}
{"doc_id": "network", "page": 64, "text": "个波段进行通信。紫外线和更高的波段目前还不能用千通信。图 2-5 的最下面一行还给出了 ITU 对波段取的正式名称。例如， LF 波段的波长是从 l km~10 km （对应于 30 kHz~300  kHz) 。 LF, MF 和 HF 的中文名字分别是低频、中频（300 kHz~3 MHz)和高频(3 MHz~30  MHz) 。更高的频段中的 V, U, S 和 E 分别对应千 Very, Ultra, Super 和 Extremel y,相应的频段 的中文名字分别是甚高频（30MHz~300 MHz) 、特高频（ 300 MHz~3 GHz) 、超高频(3 GHz~  30 GHz) 和极高频（30 GHz~300 GHz), 最高的一个频段中的 T 是 Tremendousl y,目前尚无标 准译名。在低频 LF 的下面其实还有几个更低的频段，如甚低频 VLF 、特低频 ULF 、超低频 SLF 和极低频 ELF 等，因不用千一般的通信，故未画在图中。 无线电微波通信在当前的数据通信中占有特殊重要的地位。微波的频率范围为 300 MHz~300 GHz （波长 Im~I mm), 但主要使用 2 GHz~40 GHz 的频率池伟l 。微汲在空间 主要是直线传播，由于地球表面是个曲面，因此其传播距离受到限制，一般只有 50 km 左 右。但若采用 100 m 高的天线塔，则传播距离可增大到 100 km 。微波会穿透电离层而进入 宇宙空间，因此它不像短波那样可以经电离层反射传播到地面上很远的地方 c 在使用微波频段的无线蜂窝通信系统中，有时基站向手机发送的信号被障碍物阻挡了 （如图 2-12 中的虚线所示），无法直接到达手机。但基站发出的信号可以经过多个障碍物的 数次反射到达手机，如图中所示的 O-e 和 O-0-0-O 这样的两条路径。多条路径的信号 叠加后一般都会产生很大的失真，这就是所谓的 多径效应，必须设法解决（见第 9 竞的 9.3.l 节）。 短波通信（即高频通信）主要靠电离层的 反射。但电离层的不稳定所产生的衰落现象， 以及电离层反射所产生的多径效应，使得短波 基站 信道的通信质琵较差。 当利用无线信道传送数字信号时，必须使 误码率（即比特错误率）不大于可容许的范 1围。 图 2-13 中的曲线是根据通信理论计算出的，我 们这里只需知道有关的三个基本概念。 (h 匪L 朴手 图 2-12 多径效应的影响 10-17 二, 256QAM  码朵 IIOO 崎-1J ] -j \\ \\ . `-, ` ` ' 8 M bi 出 率 10.... I  ` I  I  10-s-I ` ` I  ,  ,o~-I  I  I  I  ` ` 10-1 `  。 10 20 30 40  俏噪比(dB) 图 2-13 理想信道的误码率与信噪比、调制方式、数据率的关系 （本图取自 [KUR017] 图 7.3, 特此致谢） • 53 •"}
{"doc_id": "network", "page": 65, "text": "(I) 对千给定的调制方式和数振率，信噪比越大，误码率就越低。这个结论的得出是符 合直觉的。当我们在嘈杂的餐厅用餐时，同桌的人可能听不清你说的话。提高嗓门会使说话 的效果好些，但太大声说话也会影响周围顾客正常用餐。手机的悄况也相似。若提高手机的 发射功率，固然可以提高信噪比，但这必将缩短电池的使用时间。若增大电池的体积和甫址， 又会使手机携带不方便。过大的发射功率，还会干扰临近手机的正常通信，或影响人体健康。 可见，如何提高估噪比需要综合考虑。 (2) 对千同样的信噪比，具有更高数据率的调制技术的误码率也更高。例如，当信噪比 为 10 dB 时，若采用 I Mb it/ s 数据率的二进制相移键控 BPSK 调制技术，则误码率小千 10 飞 但若采用 4 Mb it/s 数据率的正交振幅调制 16 QAM, 则误码率为 IO-l ，已经无法使用了。又 如，当信噪比为 20 dB 时，若采用 4 Mb it/s 数据率的正交振福调制 16 QAM, 则误码率小于 I 0-7 。但若采用 I Mb it/s 数据率的二进制相移键控 BPSK, 则误码率变得非常小，从图中的 曲线已无法查到其数值。 (3) 如果移动用户在进行通信时还在不断改变自己的地理位置，就会引起无线信道特性 的改变，因而信噪比和误码率都会发生变化。因此，用户的移动设备的物理层应当有一定的 自适应能力，可以根据所处的环境特性选择最合适的调制和编码技术，以便在保证容许的误 码率的条件下，获得尽可能高的数据传输速率。 为实现远距离通信必须在一条微波通信信道的两个终端之间建立若干个中继站。中继 站把前一站送来的信男经过放大后再发送到下一站，这种通信方式称为“微波接力”。大多 数长途电话业务使用 4GHz~6GHz 的频率范围。 微波接力通信可传输电话、电报、图像、数据等信息。其主要特点是： (I) 微波波段频率很高，其频段范围也很宽，因此其通信信道的容散很大。 (2) 因为工业干扰和天电干扰的主要频谱成分比微波频率低得多，对微波通信的危害比 对短波和米波（即甚高频）通信小得多，因而微波传输质篮较高。 (3) 与相同容痲和长度的电缆载波通信比较，微波接力通信建设投资少，见效快，易千 跨越山区、江河。 当然，微波接力通信也存在如下的一些缺点： (I) 相邻站之间必须庖视（常称为视距 LOS (Line Of S ig h t)),不能有障碍物。有时一个 天线发射出的信号也会分成几条略有差别的路径到达接收天线，因而造成失真。 (2) 彶波的传播有时也会受到恶劣气候的影响。 (3) 与电缆通信系统比较，微波通信的隐蔽性和保密性较差。 (4) 对大量中继站的使用和维护要耗费较多的人力和物力。 常用的卫星通信方法是在地球站之间利用位于约 3 万 6 干公里高空的人造同步地球卫 星作为中继器的一种彶波接力通侣。对地静止通伈卫星就是在太空的无人值守的微波通估的 中继站。可见卫星通信的主要优缺点大体上应当和地而微波通信差不多。 卫星通信的最大特点是通信距离远，且通信费用与通估距离无关。同步地球卫星发射 出的电磁波能辐射到地球上的通信股盖区的跨度达 1 万 8 干多公里，面积约占全球的三分之 一。只要在地球赤道上空的同步轨道上，等距离地放置 3 颗相隔J 20 度的卫星，就能菲本上 实现全球的通信。 和微波接力通信相似，卫星通信的频带很宽，通信容扭很大，信号所受到的丁扰也较 小，通信比较稳定。为了避免产生下扰，卫星之间相隔如果不小千 2 度，那么整个赤道上空 • 54 •"}
{"doc_id": "network", "page": 66, "text": "只能放置 180 个同步卫星。好在人们发现可以在卫星上使用不同的频段来进行通信。因此总 的通信容址资源还是很大的。 卫星迎信的另一特点就是具有较大的传播时延。由千各地球站的天线仰角并不相问， 因此不管两个地球站之间的地面距离是多少（相隔一条街或相隔上万公里），从一个地球站 经卫星到另一地球站的传播时延均在 250~300 ms 之间。一般可取为 270 ms 。这和其他的通 信有较大差别（谘注意：这和曲个地球站之间的距离没有什么关系）。对比之下，地面微波 接力通信链路的传播时延一般取为 3.3 µs/km 。 诮注意，“卫星信道的传播时延较大”并不等于“用卫星信道传送数据的时延较大”。 这是因为传送数据的总时延除了传播时延，还有发送时延、处理时延和排队时延等部分。传 播时延在总时延中所占的比例有多大，取决千具体情况。但利用卫星信道进行交互式的网上 游戏显然是不合适的。 在十分偏远的地方，或在离大陆很远的海洋中，要进行通信就几乎完全要依赖于卫星 通信。卫星通信还非常适合于广播通信，因为它的覆盖面很广。但从安全方而考虑，卫星通 信系统的保密性则相对较差。 通信卫星本身和发射卫星的火箭造价都较高。受电源和元器件寿命的限制，同步卫星 的使用寿命一般为 10~15 年。卫星地球站的技术较复杂，价格还比较贵。这就使得卫星通 伯的费用较高。 除上述的同步卫星外，低轨道卫星通信系统（卫星高度在 2000 公里以下）已开始使用。 低轨道卫星相对于地球不是静止的，而是不停地围绕地球旋转。目前，大功率、大容世、低 轨道宽带卫星已开始在空间部署，并构成了空间高速链路。由于低轨道卫星离地球很近，因 此轻便的手持通信设备都能够利用卫星进行通信。这里值得一捉的就是美国太空探索技术公 司 SpaceX 在 2015 年 1 月提出的“星链 ”(S tarli nk) 计划。这个计划是要把约1.2 万颗通佑 卫星发射到轨道，并从 2020 年开始工作。在 2019 年 5 月 23 日，“猎鹰 9\" 运载火箭已成功 将“星链“首批 60 颗卫兄送入轨道。 2016 年J I 月 2 日，中国航天科技集团公司官布将在 2020 年建成“鸿雁卫星星座通信系统”。 2018 年 12 月 29 日，“鸿雁“星座首发星，在我国 酒泉卫星发射中心由长征二号丁运载火箭发射成功，并进入预定轨迫，标志若＂鸿雁“星座 的建设全而启动。 从 20 世纪 90 年代起，无线移动通信和互联网一样，得到了飞速的发展。与此同时， 使用无线信道的计算机局域网也获得了越来越广泛的应用。我们知道，要使用某一段无线电 频谱进行通信，通常必须得到本国政府有关无线电频谱管理机构的许可证。但是，也有一些 无线电频段是可以自由使用的（只要不干扰他人在这个频段中的通信），这正好满足计算机 无线局域网的需求。图 2-14 给出了美国的 lSM 频段，现在的无线局域网就使用其中的 2 .4 GHz 和 5.8 GHz 频段。 ISM 是 Indus t r i al, Scientifi c, and Medi cal （工业、科学与医药）的缩写， 即所谓的“工、科、医频段＂。各国的 lSM 标准有可能略有差别。 83MHz­ J .. ..  26MHz-Il  带频 125  MHz  频率 902 928 2.4  MHz MHz GHz  2.4835  GHz  5.725  GHz  5.850  GHz  图 2-14 无线局域网使用的 ISM 频段 • 55 •"}
{"doc_id": "network", "page": 67, "text": "红外通信、激光通信也使用非导引型媒体，可用于近距离的笔记本电脑相互传送数据。 2.4 信道复用技术 2.4.1 频分复用、时分复用和统计时分复用 复用 (multip lex i n g)是通信技术中的基本概念。计算机网络中的信道广泛地使用各种复用 技术。下面对信道复用技术进行简单的介绍。 图 2-15(a) 表示 A1, B1 和 C1 分别使用一个单独的信道与 A2, B2 和 C2 进行通信，总共需要 3 个信道。但如果在发送端使用一个复用器，就可以用一个共享信道传送原来的 3 路信号。 在接收端使用分用器，把合起来传输的信息分别送到相应的终点。图 2-15(b) 是复用的示意 图。当然，复用要付出一定代价（共享信道由于带宽较大因而费用也较高，再加上复用器和 分用器）。但如果复用的信道数蜇较大，那么在经济上还是合绊的。 0· . ·@ . @· ·@  *  @* *@  {a) 使用单独的信道 (.+·+*)  共享信道 (b) 利用复用技术使用共享信道 图 2-15 复用的示意图 最基本的复用就是频分复用 FDM (F re q uency Division Multip lex i n g)和时分复用 TDM (T.1me Division Multip lex i n g)。频分复用的概念是这样的。例如，有 N 路信句要在一个信道 中传送。可以使用调制的方法，把各路信号分别搬移到适当的频率位置，使彼此不产生干扰， 如图 2-16(a) 所示。各路信号就在自己所分配到的信道中传送。可见频分复用的各路信号在 同样的时间占用不同的带宽资源（请注意，这里的“带宽”是频率带宽而不是数据的发送速 率）。而时分复用则是将时间划分为一段段等长的时分复用帧（即 TDM 帧）。每一路信号在 每一个 TDM 帧中占用固定序号的时隙。为简单起见，在图 2-16(b) 中只画出了 4 路信号 A, B, C 和 D 。每一路信号所占用的时隙周期性地出现（其周期就是 TDM 帧的长度）。因此 TOM 信号也称为等时(isochronous) 信号。可以看出，时分复用的所有用户是在不同的时间占 用同样的频带宽度。这两种复用方法的优点是技术比较成熟，但缺点是不够灵活。时分复用 则更有利于数字信号的传输。 使用 FDM 或 TOM 的复用技术，可以让多个用户（可以处在不同地点）共享信道资源。 例如在图 2- l 6(a) 中的频分信道，可让 N 个用户各使用一个频带，或让更多的用户轮流使用 这 N 个频带。这种方式称为频分多址接入 FDMA (Frequency Division Multiple Access), 简称 为频分多址。在图 2-l6(b) 中的时分信道，则可让 4 个用户各使用一个时隙，或让更多的用 户轮流使用这 4 个时隙。这种方式称为时分多址接入 TOMA (Time Division Multiple Access),  • 56 •"}
{"doc_id": "network", "page": 68, "text": "简称为时分多址。请注意： FDMA 或 TDMA 中的 “MA\" 表明“多址＂，意思是强调这种复 用信道可以让多个用户（可以在不同地点）接入进来。而 “FD\" 或 “TD\" 则表示所使用的 复用技术是＂频分复用”或“时分复用＂。但术语 FDM 或 TDM 则说明是在频域还是在时域 进行复用，而并不强调复用的信道是用千多个用户还是一个用户。 频率 频率 (a)  周期性出现 4 个时隙 4 个时隙 , 4 个时隙 ;  I- TOM 帧-I- TOM 帧-1-TOM 帧-1 (b)  图 2-16 频分复用 (a) 和时分复用（b) 时间 时间 在使用频分复用时，若每个用户占用的带宽不变，则当复用的用户数增加时，复用后 的信道的总带宽就跟着变宽。例如，传统的电话通信中每个标准话路的带宽是 4 kHz （即通 信用的 3.1 kHz 加上两边的保护频带），那么若有 1000 个用户进行频分复用，则复用后的总 带宽就是 4 MHz 。但在使用时分复用时，每个时分复用帧的长度是不变的，始终是 125 µs 。 若有 1000 个用户进行时分复用，则每一个用户分配到的时隙宽度就是 125 µs 的干分之一， 即 0.125 µs, 时隙宽度变得非常窄。我们应注意到，时隙宽度非常窄的脉冲信号所占的频谱 范围也是非常宽的。 在进行通信时，复用器(mul tip lexer) 总是和分用器(demul tip lexer) 成对地使用。在复用器 和分用器之间是用户共享的高速信道。分用器的作用正好和复用器的相反，它把高速信道传 送过来的数据进行分用，分别送交到相应的用户。 当使用时分复用系统传送计算机数据时，由于计算机数据的突发性质，一个用户对已 经分配到的子信道的利用率一般是不高的。当用户在某一段时间暂时无数据传输时（例如用 户正在键盘上输入数据或正在浏览屏幕上的信息），那就只能让已经分配到手的子信道空闲 着，而其他用户也无法使用这个暂时空闲的线路资源。图 2-17 说明了这一概念。这里假定 有 4 个用户 A, B, C 和 D 进行时分复用。复用器按 A-B 一 C 一 D 的顺序依次对用户的时隙进 行扫描，然后构成一个个时分复用帧。图中共画出了 4 个时分复用帧，每个时分复用帧有 4 个时隙。请注意，在时分复用帧中，每一个用户所分配到的时隙长度缩短了，在本例中，只 有原来的 1/4 。可以看出，当某用户暂时无数据发送时，在时分复用帧中分配给该用户的时 隙只能处于空闲状态，其他用户即使一直有数据要发送，也不能使用这些空闲的时隙。这就 导致复用后的信道利用率不高。 • 57 •"}
{"doc_id": "network", "page": 69, "text": "A | a | | a 1  上 BCD b b- c c  I d |  时分复用巨面，，百同．，问口，团 I ; 1  #I #2 #3 #4  ～～＜＞、乙 4 个时分复用帧 图 2-17 时分复用可能会造成线路资源的浪费 统计时分复用 STDM (Statistic TDM) 是一种改进的时分复用，它能明显地提高信道的利 用率。集中器（concen tr a t or) 常使用这种统计时分复用。图 2-18 是统计时分复用的原理图。一 个使用统计时分复用的集中器连接 4 个低速用户，然后将其数据栠中起来通过高速线路发送 到一个远地计算机。 统计时分复用 A 亡 8 | b, b |  | c, c |  ［工 仁 c 集中器 D 上 ~ d 11 a  I I I #I. #2 /13  ~I/  3 个 STDM 帧 图 2-18 统计时分复用的工作原理 统计时分复用使用 STDM 帧来传送复用的数据。但舒一个 STDM 帧中的时隙数小于连 接在渠中器上的用户数。各用户有了数据就随时发往集中器的输入缓存，然后集中器按顺序 依次扫描输入缓存，把缓存中的输入数据放入 STDM 帧中。对没有数据的缓存就跳过去。 当一个帧的数据放满了，就发送出去。可以看出， STDM 帧不是固定分配时隙，而是按需 动态地分配时隙。因此，统计时分复用可以提高线路的利用率。我们还可看出，在输出线路 上，某一个用户所占用的时隙并不是周期性地出现的。因此，统计时分复用又称为异步时分 复用，而普通的时分复用称为同步时分复用。这里应注总的是，虽然统计时分复用的输出线 路上的数据率小于各输入线路数据率的总和，但从平均的角度来看，这二者是平衡的。假定 所有的用户都不间断地向集中器发送数据，那么集中器肯定无法应付，它内部设置的缓存都 将溢出，所以集中器能够正常工作的前提是假定各用户都是间歇地J．作的。 由于 STDM 帧中的时隙并不是固定地分配给某个用户的，因此在每个时隙中还必须有 用户的地址信息，这是统计时分复川必须有的和不可避免的一些开销。图 2-18 中输出线路 上每个时隙之前的短时隙（白色）就用千放入这样的地址信息。使用统计时分复用的集中器 也叫作智能复用器，它能提供对整个报文的存储转发能力（但大多数复川器一次只能存储一 个字符或一个比特），通过排队方式使各用户更合理地共享信道。此外，许多集中器还可能 具有路由选择、数据压缩、前向纠错等功能。 最后要强调一下， TDM 帧和 STDM 帧都是在物理层传送的比特流中所划分的帧。这种 • 58 •"}
{"doc_id": "network", "page": 70, "text": "“帧”和我们以后要讨论的数据链路层的＂帧”是完全不同的概念，不可弄混。 2.4.2 波分复用 波分复用 WDM (Wavelength Division Multip lex i n g)就是光的频分复用。光纤技术的应用 使得数据的传输速率空前提高。现在人们借用传统的载波电话的频分复用的概念，就能做到 使用一根光纤来同时传输多个频率很接近的光载波信号。这样就可使光纤的传输能力成倍地 提高。由丁光载波的频率很高，因此习惯上用波长而不用频率来表示所使用的光载波。这样 就产生了波分复用这～名词。最初，人们只能在一根光纤上复用两路光载波信号。这种复用 方式称为波分复用 WDM 。随着技术的发展，在一根光纤上复用的光载波信号的路数越来越 多。现在已能做到在一根光纤上复用几十路或更多路数的光载波信号。千是就使用了密集波 分复用 DWDM (Dense Wavelength Division Multip lex i n g)这一名词。例如，每一路的数据率 是 40 Gbit/s, 使用 DWDM 后，如果在一根光纤上复用 64 路，就能够获得 2 .5 6 Tbit/s 的数 据率。图 2-19 给出了波分复用的概念。 光调制器 光解调器 耸 1 1  120km  图 2-19 波分复用的概念 图 2-19 表示 8 路传输速率均为 2.5 Gb it/s 的光载波（其波长均为 1310 run), 经光的调 制后，分别将波长变换到 1550~1557 nm, 每个光载波相隔 1,un （这里只是为了说明问题的 方便。实际上，对十密集波分复用，光载波的间隔一般是 0.8 nm 或1. 6 nm) 。这 8 个波长很 接近的光载波经过光复用器（波分复用的复用器又称为合波器）后，就在一根光纤中传输。 因此，在一根光纤上数据传输的总速率就达到了 8 x 2.5 Gbit/s = 20 Gb it/s 。但光信号传输了 一段距离后就会衰减，因此必须对衰减了的光信号进行放大才能继续传输。现在已经有了很 好的掺饵光纤放大器 EDFA (Erbium Doped Fiber Amplifier) 。它是一种光放大器，不需要像 以前那样复杂，先把光信号转换成电信号，经过电放大器放大后，再转换成为光信号。 EDFA 不需要进行光电转换而直接对光信号进行放大，并且在 1550 nm 波长附近有 35 nm  （即 4.2 THz) 频带范围提供较均匀的、砐高可达 40~50dB 的增益。两个光纤放大器之间的 光缆线路长度可达 120 km, 而光复用器和光分用器（波分复用的分用器又称为分波器）之 间的无光电转换的距离可达 600 km （只衙放入 4 个 EDFA 光纤放大器）。 在地下铺设光缆是耗资很大的工程。因此人们总是在一根光缆中放入尽可能多的光纤 （例如，放入 100 根以上的光纤），然后对每一根光纤使用密栠波分复用技术。因此，对于 具有 100 根速率为 2.5 Gb it/ s 光纤的光缆，采用 16 倍的密集波分复用，得到一根光缆的总数 据率为 I 00 x 40 Gb it/s 或 4 Tb it/ s 。这里的 T 为 1012, 中文名词是“太＂，即“兆兆“。 现在光纤通信的容量和传输距离还在不断增长。例如，一条从美国弗吉尼亚州横跨大 • 59 •"}
{"doc_id": "network", "page": 71, "text": "`  l m  S 寸三一区 S兀＝ 0 m ，臧 I (2-3)  例如，向朵 S 为 (-1 -1 -I +l +1 -I +1 +I), 同时设向量 T 为 (-1 -I +I -I +I +I +l -1),  这相当于 T 站的码片序列为 00101110 。将向量 S 和 T 的各分揽值代入(2-3) 式就可看出这两 个码片序列是正交的。不仅如此，向世 S 和各站码片反码的向世的内积也是 0 。另外一点也 很重要，即任何一个码片向证和该码片向量自己的规格化内积都是 I: ＠注： GSM (Global System for Mob i le) 即全球移动通信系统，是欧洲和我国现在广泛使用的移动通信体制． • 60 •"}
{"doc_id": "network", "page": 72, "text": "l m l”'l m  S•S=...'.... 1: S戊＝一区 S,2= —区（士 l)2= m i=1 m,=1 rn ;=l  (2-4)  而一个码片向量和该码片反码的向债的规格化内积值是－l 。这从（2-4) 式可以很清楚地 看出，因为求和的各项都变成了－ l 。 现在假定在一个 CDMA 系统中有很多站都在相互通信，每一个站所发送的是数据比特 和本站的码片序列的乘积，因而是本站的码片序列（相当千发送比特 l) 和该码片序列的二 进制反码（相当于发送比特 0) 的组合序列，或什么也不发送（相当千没有数据发送）。我 们还假定所有的站所发送的码片序列都是同步的，即所有的码片序列都在同一个时刻开始。 利用全球定位系统 GPS 就不难做到这点。 现假定有一个 X 站要接收 S 站发送的数据。 X 站就必须知道 S 站所特有的码片序列。 X 站使用它得到的码片向蜇 S 与接收到的未知信号进行求内积的运算。 X 站接收到的信号是 各个站发送的码片序列之和。根据上而的公式（2-3) 和（2-4), 再根据叠加原理（假定各种信号 经过信道到达接收端是叠加的关系），那么求内积得到的结果是：所有其他站的信号都被过 滤掉（其内积的相关项都是 O), 而只剩下 S 站发送的信号。当 S 站发送比特 1 时，在 X 站 计算内积的结果是＋ l, 当 S 站发送比特 0 时，内积的结果是－ l 。 图 2-20 是 CDMA 的工作原理。设 S 站要发送的数据是 I I 0 三个码元。再设 CDMA 将 每一个码元扩展为 8 个码片，而 S 站选择的码片序列为（－ I -1 -1 +l +l -1 +1 +I) 。 S 站发送 的扩频信号为 SX 。我们应当注意到， S 站发送的扩频信号 Sx 中，只包含互为反码的两种码 片序列。 T 站选择的码片序列为(-1 -I +I -I +I +l +I -1), T 站也发送 I I 0 三个码元，而 T 站的扩频信号为 Tx 。因所有的站都使用相同的频率，因此每一个站都能够收到所有的站发 送的扩频信号。对千我们的例子，所有的站收到的都是叠加的信号 S, + T,.  气待发送的数据码元 1 '”：码丿一I I L—二＿ S 站发送的伯号 匕－f－u-1_~ ，一 1·1 I 书 I +I -I •I 寸，·一1-1 ·1·1-1•1•1;•1 今 1 令 I •I I •I -1-1;  ...嘈..量··························· 接收端 :  罕飞，霍元站 I L_~  图 2-20 CDMA 的工作原理 当接收站打算收 S 站发送的信号时，就用 S 站的码片序列与收到的信号求规格化内积。 这相当于分别计算 S• S, 和 S• T, 。显然， S• Sx 就是 S 站发送的数据比特，因为在计算规格 化内积时，按(2-3) 式相加的各项，或者都是＋ l, 或者都是－ I; 而 S• Tx 一定是零，因为相加 的 8 项中的＋ l 和－ l 各占一半，因此总和一定是零。 2.5 数字传输系统 在早期电话网中，从市话局到用户电话机的用户线采用最廉价的双绞线电缆，而长途 干线采用的是频分复用 FDM 的模拟传输方式。由千数字通信与模拟通信相比，无论是传输 质榄上还是经济上都有明显的优势，目前，长途干线大都采用时分复用 PCM 的数字传输方 式。因此，现在的模拟线路就基本上只剩下从用户电话机到市话交换机之间的这一段几公里 • 61 •"}
{"doc_id": "network", "page": 73, "text": "长的用户线。 现代电信网早已个只有话音这一种业务了，还包括视频、阳像和各种数据业务。困此 袖要一种能承载来自其他各种业务网络数据的传输网络。在数字化的同时，光纤开始成为长 途干线最主要的传输媒体。光纤的高带宽适用于承载今天的高速率数据业务（比如视频会议） 和大最复用的低速率业务（比如话音）。基千这个原因，当前光纤和要求高带宽传输的技术 还在共同发展。早期的数字传输系统存仵若许多缺点，其中最主要的是以下两个： (1) 速率标准不统一。由千历史的原因，多路复用的速率体系有两个互不兼容的国际标 准，北美和日本的 Tl 速率 (1.544 Mbit/s) 和欧洲的 El 速率 (2.048 Mbit/s) 。但是再往上的 复用，日本又使用了第三种不兼容的标准。这样，国际范围的基千光纤的高速数据传输就很 难实现。 (2) 不是同步传输。在过去相当长的时间，为了节约经费，各国的数字网主要采用准同 步方式。在准同步系统中，各支路信号的时钟频率有一定的偏差，给时分复用和分用带来许 多麻烦。当数据传输的速率很高时，收发双方的时钟同步就成为很大的问题。 为了解决上述问题，美国在 1988 年首先推出了一个数字传输标准，叫作同步光纤网 SONET (Synchronous Optical Network) 。整个同步网络的各级时钟都来自一个非常精确的主 时钟（通常采用昂贵的绝原子钟，具精度优于土 lxl0-11) 。 SONET 为光纤传输系统定义了同 步传输的线路速率等级结构，其传输速率以 5 1. 840 Mb it/s 为基础＇＇，大约对应千 T3/E3 的 传输速率，此速率对电信号称为第 1 级同步传送信号(Sy nchronous Transpo11 S ignal), 即 STS-1: 对光信号则称为第 1 级光载波(Opti cal Carri er), 即 OC-1 。现已定义了从 5 L.840 Mbit/s （即 OC-1) 一直到 39813.120 Mb it/s （即 OC-768/STS- 768) 的标准。 ITU-T 以美国标准 SONET 为基础，制定出国际标准同步数字系列 SDH (Synchronous  Digital Hi erarch y),即 l988 年通过的 G.707~G.709 等二个建议书。到 1992 年又增加了十几 个建议书。一般可认为 SDH 与 SONET 是同义词，但其主要不同点是： SDH 的基本速率为 155.520 Mb it/s, 称为第 1 级同步传递模块（Sy nchronous Transfer Module), 即 STM-1, 相当 千 SONET 体系中的 OC-3 速率。表 2-2 为 SONET 和 SDH 的比较。为方便起见，在谈到 SONET/SDH 的常用速率时，往往不使用速率的精确数仙而是使用表中第二列给出的近似值 作为简称。 表 2-2 SONET 的 OC 级／STS 级与 SDH 的 STM 级的对应关系 线路速率 线路速率 SONET ITU-T 相当的话路数 (MbiVs) 的近似值 符号 符号 （每个话路 64 kbiVs)  51.840 OC-1/STS-I 810  155.520 155 Mbi1/s OC:-3/STS-3 STM-1 2430  622.080 622 Mbit/s OC-12/STS-12 STM-4 9720  1244.160 OC-24iSTS-24 STM-8 19440  （i)注 SONET 规定， SONET 每秒传送 8000 帧（和 PCM 的采杆速午·样）。每个 STS-1 帧长为 810 字节，因此 STS-1 的数踞平为 8000 x 810 x 8 ~ 51840000 b it/s 。为j，使）身＆尔，通常将一个 STS-1 帧而成 9 行 90 列的字i＼排列．在这种排列中们母 个字节对应的数枫件是 64 kb it/s, 一个 STS-11 的帧长就是 STS-1 的帧长的 n 倍，也同样是知秒传送 8000 帧，因此 STS-11 的数 从（率就是 STS-1 的数据率的叶趴 • 62 •"}
{"doc_id": "network", "page": 74, "text": "续表 线路速率 线路速率 SONET ITU-T 相当的话路数 (MbiVs) 的近似值 符号 符号 （每个话路 64 kbiVs)  2488.320 2.5 Gbilfs OC-48/STS-48 STM-16 38880  4976.640 OC-96/STS-96 STM-32 77760  9953.280 10 Gbitfs OC-I 92/STS-192 STM-64 155520  39813.120 40 Gb,11s OC-768/STS-768 STM-256 622080  现在可以在网上查到 OC-1920/STM-640 （对应千 100 Gbit/s) 和 OC-3840/STM-1234 （对应千 200 Gbit/s) 的记法，但未见到更多有关应用的报道。 SDH/SONET 定义了标准光信号，规定了波长为 1310 nm 和 1550 nm 的激光源。在物理 层定义了帧结构。 SDH 的帧结构是以 STM-1 为基础的，更高的等级是用 N 个 STM-1 复用 组成 STM-N, 如 4 个 STM-1 构成 STM-4, 16 个 STM-1 构成 STM-16 。 SDH/SONET 标准的制定，使北美、日本和欧洲这三个地区三种不同的数字传输体制在 STM-1 等级上获得了统—。各国都同意将这一速率以及在此基础上的更高的数字传输速率 作为国际标准。这是第一次真正实现了数字传输体制上的世界性标准。现在 SDH/SONET 标 准已成为公认的新一代理想的传输网体制，因而对世界电信网络的发展具有重大的意义。 SDH 标准也适合于微波和卫星传输的技术体制。 2.6 宽带接入技术 在第 l 璋中已讲过，用户要连接到互联网，必须先连接到某个 ISP, 以便获得上网所盂 的 IP 地址。在互联网的发展初期，用户都是利用电话的用户线通过调制解调器连接到 ISP 的，经过多年的努力，从电话的用户线接入到互联网的速率最高只能达到 56 kb it/s 。为了提 高用户的上网速率，近年来已经有多种宽带技术进入用户的家庭。然而目前“宽带“尚无统 一的定义。很早以前，有人认为只要接入到互联网的速率远大于 56 kb it/s 就是宽带。后来美 国联邦通信委员会 FCC 认为只要双向速率之和超过 200 kb it/s 就是宽带。以后，宽带的标准 也不断提高。 2015 年 1 月，美国联邦通信委员会 FCC 又对接入网的＂宽带”进行了重新定 义，将原定的宽带下行速率调整至 25 Mbit/s, 原定的宽带上行速率调整至 3 Mbit/s 。 从宽带接入的媒体来看，可以划分为两大类。一类是有线宽带桵入，而另一类是无线 宽带接入。由于无线宽带接入比较复杂，我们将在第 9 聋中讨论这个问题。下面我们只限于 讨论有线宽带接入。 2.6.J ADSL 技术 非对称数字用户线 ADSL (Asymmetric Digital Subscr iber Li ne) 技术是用数字技术对现有 模拟电话的用户线进行改造，使它能够承载宽带数字业务。虽然标准模拟电话信号的频带被 限制在 300~3400 Hz 的范围内（这是电话局的交换机设置的标准话路频带），但用户线本身 实际可通过的信号频率却超过 I MHz 。 ADSL 技术把 0~4 kHz 低端频谱留给传统电话使用， 而把原来没有被利用的高端频谱留给用户上网使用。 ADSL 的 ITU 的标准是 G.992.l （或称 G.dm t,表示它使用 DMT 技术，见后面的介绍）。由千用户当时上网主要是从互联网下载各 种文档，而向互联网发送的信息量一般都不太大，因此 ADSL 的下行（从 ISP 到用户）带 • 63 •"}
{"doc_id": "network", "page": 75, "text": "宽都远远大于上行（从用户到 ISP) 带宽。＂非对称“这个名词就是这样得出的。 ADSL 的传输距离取决千数据率和用户线的线径（用户线越细，伉号传输时的衰减就越 大）。例如， 0.5 mm 线径的用户线，传输速率为1. 5~2.0 Mbit/s 时可传送 5 .5 km; 但当传输 速率提高到 6.1 Mb it/s 时，传输距离就缩短为 3.7 km 。如果把用户线的线径减小到 0 .4 mm,  那么在 6.1 Mbit/s 的传输速率下就只能传送 2.7 km 。此外， ADSL 所能得到的最高数据传输 速率还与实际的用户线上的信噪比密切相关。 ADSL 在用户线（铜线）的两端各安装一个 ADSL 调制解调器。这种调制解调器的实现 方案有许多种。我国采用的方案是离散多音调 DMT (D iscrete Mu lti -Tone) 调制技术。这里 的“多音调”就是“多载波”或“多子信逍＂的意思。 DMT 调制技术采用频分复用的方法， 把 40 kHz 以上一直到 1.1MHz 的高端频谱划分为许多子估道，其中 25 个子信道用于上行信 道，而 249 个子信道用于下行信道，并使用不同的载波（即不同的音调）进行数字调制。这 种做法相当于在一对用户线上使用许多小的调制解调器并行地传送数据。由于用户线的具体 条件往往相差很大（距离、线径、受到相邻用户线的干扰程度等都不同），因此 ADSL 采用 自适应调制技术使用户线能够传送尽可能高的数据率。当 ADSL 启动时，用户线两端的 ADSL 调制解调器就测试可用的频率、各了信道受到的干扰悄况，以及在每一段频率上测试 信号的传输质揽。这样就使 ADSL 能够选择合适的调制方案以获得尽可能高的数据率。可 见 ADSL 不能保证固定的数据率。对于质泣很差的用户线甚至无法开通 ADSL 。因此电信局 需要定期检查用户线的质品，以保证能够提供向用户承诺的最高的 ADSL 数据率。图 2-21 显示的是 DMT 技术的频谱分布。 ADSL 的数字业务 频谱',;充电话上哎竺 下行亿必 频率(k.Hz} 0 4 ~40 ~138 ~1100  困 2-21 DMT 技术的频谱分布 基于 ADSL 的接入网由以下三大部分组成：数字用户线接入复用器 DSLAM (D SL Access Multip lexer) 、用户线和用户家中的一些设施（见图 2-22) 。数字用户线接入复用器包 括许多 ADSL 调制解调器。 ADSL 调制解调器又称为接入端接单元 ATU (Access Termination  Unit)。由千 ADSL 调制解调器必须成对使用，因此把在电话端局（或远端站）和用户家中 所用的 ADSL 调制解调器分别记为 ATU-C CC 代表端局(Cent ral Offi c.e)) 和 ATU-R (R 代表 远端(Remote)) 。用户电话通过电话分离器(S p l itter) 和 ATU-R 连在一起，经用户线到端局， 并再次经过一个电话分离器把电话连到本地电话交换机。电话分离器是无源的，它利用低通 滤波器将电话信号与数字信号分开。将电话分离器做成无源的是为了在停电时不影响传统电 话的使用。一个 DSLAM 可支持多达 500~1000 个用户。若按每户 6 Mbit/s 计算，则具有 1000 个端口的 DSLAM （这就需要用 1000 个 ATU-C) 应有高达 6 Gb it/s 的转发能力。由千 ATU-C 要使用数字信号处理技术，因此 DSLAM 的价格较高。 • 64 •"}
{"doc_id": "network", "page": 76, "text": "至 ISP 基于 ADSL 的接入网 \\ 虹l或：勹一 品 区域宽带网 ~~—  ~ DSLAM --j 至本地电话局.....................  图 2-22 基千 ADSL 的接入网的组成 ADSL 最大的好处就是可以利用现有电话网中的用户线（铜线），而不需要重新布线。 有许多老的建筑，电话线都早已存在。但若重新铺设光纤，往往会对原有建筑产生一些损坏。 从尽觉少损坏原有建筑考虑，使用 ADSL 进行宽带接入就非常合适了。到 2006 年 3 月为止， 全世界的 ADSL 用户已超过l.5亿户。 最后我们要指出， ADSL 借助千在用户线两端安装的 ADSL 调制解调器（即 ATU-R 和 ATU-C) 对数字信号进行了调制，使得调制后的数字信号的频谱适合在原来的用户线上传输。 用户线本身并没有发生变化，但给用户的感觉是：加上 ADSL 调制解调器的用户线好像能 够直接把用户计算机产生的数字信号传送到远方的 ISP 。正因为这样，原来的用户线加上两 端的调制解调器就变成了可以传送数字信号的数字用户线 DSL 。 ADSL 技术也在发展。现在 ITU-T 已颁布了更高速率的 ADSL 标准，即 G 系列标准， 例如 ADSL2 (G.992.3 和 G.992 .4)和 ADSL2+ (G.992.5), 它们都称为第二代 ADSL, 目前 已开始被许多 ISP 采用和投入运营。第二代 ADSL 改进的地方主要是： (1) 通过提高调制效率得到了更高的数据率。例如， ADSL2 要求至少应支持下行 8 Mbit/s 、上行 800 kb it/s 的速率。而 ADSL2＋则将频谱范围从1.1 MHz 扩展至 2.2 MHz （相应 的子信道数目也增多了），下行速率可达 16 Mbit/s （最大传输速率可达 25 Mbit/s), 而上行 速率可达 800 kb it/s 。 (2) 采用了无缝速率自适应技术 SRA (Seamless Rate Adapta ti on), 可在运营中不中断通 信和不产生误码的情况下，根据线路的实时状况，自适应地调整数据率。 (3) 改善了线路质量评测和故障定位功能，这对提高网络的运行维护水乎具有非常重要 的意义。 这里我们要强调一下， ADSL 并不适合千企业。这是因为企业往往需要使用上行信道发 送大量数据给许多用户。为了满足企业的需要， ADSL 技术有几种变型。例如，对称 DSL, 即 SDSL (Symmetric DSL), 它把带宽平均分配到下行和上行两个方向，很适合千企业使用， 每个方向的速率分别为 384 kb it/ s 或1. 5 Mb it/s, 距离分别为 5.5 km 或 3 km 。还有一种使用 一对线或两对线的对称 DSL 叫作 HDSL (High speed DSL), 用来取代 Tl 线路的高速数字用 户线，数据速率可达 768 kbit/s 或1. 5 Mbit/s, 距离为 2.7~3.6 km 。 还有一种比 ADSL 更快的、用于短距离传送 (300~1800 m) 的 VDSL (Very high speed  DSL), 即甚高速数字用户线，也很值得注意。这也就是 ADSL 的快速版本。 VDSL 的下行 速率达 50~55 Mbit/s, 上行速率是1. 5~2.5 Mb it/s 。 2011 年 ITU-T 颁布了更高速率的 VDSL2 （即第二代的 VDSL) 的标准 G.993.2 。 VDSL2 能够提供的上行和下行速率都能够达到J OO Mb it/s 。用这样的速率能够非常流畅地观看视频节目。 • 65 •"}
{"doc_id": "network", "page": 77, "text": "以上这些不同的高速 DSL 都可记为 xDSL 。 近年来，高速 DSL 技术的发展又有了新的突破。 2011 年 ITU-T 成立了 G. fast项目组。 这个项目组致力于短距离超高速接入新标准的制定，目标是使用单对直径为 0.5 lll111 的铜线 在 100 m 距离提供 900 Mbit/s 的接入速率，而 200 m 距离的速率为 600 Mbit/s, 300 m 距离 的速率为 300 Mbit/ s 。我国的华为公司积极参加了此标准的制定工作，是该标准的主要技术 贡献者之一。在龙国柱博士的领导下，华为公司于 2Ol2 年首先研制成功 Gig a DSL 样机， 使用时分双工 TDD (Time Division Dup lex) 和 OFDM 技术，有效地降低了辐射干扰和设备功 耗，实现了超高速的 DSL 接入。现在新的建议标准 G.mgfas t已被提出（这里的 mg表示几 个吉比特 Multi -G ig ab it的高速接入），其目标是在近期商用化。 目前在欧洲，这种超高速 DSL 的接入方式很受欢迎。这是因为在欧洲，具有历史意义 的古老建筑非常多，而各国政府都已制定了很严格的保护文物的法律。在受保护的古老建筑 的墙上钻洞铺设光缆，在法律上是被严格禁止的（即使是在朝街面的阳台上放置空调室外机 也是不允许的）。但这些国家的电话普及率很高，进入这些建筑的电话线都早已铺设好了。 因此，利用现有电话线来实现高速接入，在欧洲就特别具有现实意义。 在我国，情况有些不同。在建设新的高楼时，就已经把各种电缆的管线位置预留好了。 因此，高楼中的用户可以根据自己的需要选择合适的接入方式（不一定非要采用 xDSL 技 术）。因此上述这种超高速的 DSL 接入方式在国内使用得还较少。 2.6.2 光纤同轴混合网 (HFC 网） 光纤同轴混合网 (HFC 网， HFC 是 Hy bri d Fiber Coax 的缩写）是在目前覆盖面很广的 有线电视网的基础上开发的一种居民宽带接入网，除可传送电视节目外，还能提供电话、数 据和其他宽带交互型业务。砓早的有线电视网是树形拓扑结构的同轴电缆网络，它采用模 拟技术的频分复用对电视节目进行单向广播传输。但以后有线屯视网进行了改造，变成 了现在的光纤同轴混合网 (HFC 网）。 为了提高传输的可靠性和电视信号的质豐， HFC 网把原有线电视网中的同轴电缆主干 部分改换为光纤（如图 2-23 所示）。光纤从头端连接到光纤节点(fi ber node) 。在光纤节点光 信号被转换为电信号，然后通过同轴电缆传送到每个用户家庭。从头端到用户家庭所怖的放大 器数目也就减少到仅 4~5 个。连接到一个光纤节点的典型用户数是 500 左右，但不超过 2000 。 光纤节点 ^虐，＂··, / • , t 同轴电缆 } }' } 乙 夕，； /} /} /; /}  $))))  /· 、`/ ' •  光纤 同轴电缆 图 2-23 HFC 网的结构图 光纤节点与头端的典型距离为 25 km, 而从光纤节点到其用户的距离则不超过 2~3 km 。 原来的有线电视网的最高传输频率是 450 MHz, 并且仅用千电视信号的下行传输。但 现在的 HFC 网具有双向传输功能，而且扩展了传输频带。根据有线电视频率配置标准 GBrr • 66 •"}
{"doc_id": "network", "page": 78, "text": "17786-1999, 目前我国的 HFC 网的频带划分如图 2-24 所示。 下行信道 卫 I 调频广播、模拟和数字电视、数据业务 1 频率(MHz) 5 65 87 1000  图 2-24 我国的 HFC 网的频带划分 要使现有的模拟电视机能够接收数字电视信号，需要把一个叫作机顶盒(se t-top box) 的 设备连接在同轴电缆和用户的电视机之间。但为了使用户能够利用 HFC 网接入到互联网， 以及在上行信道中传送交互数字电视所衙的一些信息，我们还需要增加一个为 HFC 网使用 的调制解调器，它又称为电缆调制解调器（cable modem) 。电缆调制解调器可以做成一个单 独的设备（类似于 ADSL 的调制解调器），也可以做成内置式的，安装在电视机的机顶盒里 面。用户只要把自己的计算机连接到电缆调制解调器，就可方便地上网了。 美国的有线电视实验室 Cable Labs 制定的电缆调制解调器规约 DOCSIS(Data Over Cable  Service Interface Spec ifica ti ons) 的第一个版本 DOCSIS 1. 0, 已在 1998 年 3 月被 lTU-T 批准为 国际标准。后来又有了 2001 年的 DOCSIS 2.0 和 2006 年的 DOCSIS 3.0 等新的标准。 电缆调制解调器不需要成对使用，而只需安装在用户端。电缆调制解调器比 ADSL 使 用的调制解调器复杂得多，因为它必须解决共享信道中可能出现的冲突问题。在使用 ADSL 调制解调器时，用户计算机所连接的电话用户线是该用户专用的，因此在用户线上所能达到 的最高数据率是确定的，与其他 ADSL 用户是否在上网无关。但在使用 HFC 的电缆调制解 调器时，在同轴电缆这一段用户所享用的最高数据率是不确定的，因为某个用户所能享用的 数据率取决于这段电缆上现在有多少个用户正在传送数据。有线电视运营商往往宜传通过电 缆调制解调器上网可以达到比 ADSL 更高的数据率（例如达到 10 Mbit/s 甚至 30 Mbit/s),  但只有在很少几个用户上网时才可能会是这样的。然而若出现大位用户（例如几百个）同时 上网，那么每个用户实际的上网速率可能会低到令人难以忍受的程度。 2.6.3 FTTx 技术 由千互联网上已经有了大位的视频信息资源，因此近年来宽带上网的普及率增长得很 快。但是为了更快地下载视频文件，以及更加流畅地欣赏网上的各种高清视频节目，尽快地 对用户的上网速率进行升级就成为 ISP 的直要任务。从技术上讲，光纤到户 FTTH(Fi ber To  The Home)应当是最好的选择，这也是广大网民最终所向往的。所诮光纤到户，就是把光纤 一直铺设到用户家庭。只有在光纤进入用户的家门后，才把光信号转换为电信号。这样做就 可以使用户获得最高的上网速率。 现在还有多种宽带光纤接入方式，称为 FTTx, 表示 F i ber To The... 。这里字母 x 可代 表不同的光纤接入地点。实际上，光电进行转换的地方，可以在用户家中（这时 x 就是 H), 也可以向外延伸到离用户家门口有一定距离的地方。例如，光纤到路边 FTTC (C 表示 Curb) 、光纤到小区 FTTZ (Z 表示 Zone) 、光纤到大楼 FTTB CB 表示 Bu i ld i ng)、光纤到楼 层 FTTF (F 表示 Floor) 、光纤到办公室 FTTO (O 表示 O ffi ce) 、光纤到桌面 FTTD (D 表 示 Desk), 等等。截至 2019 年 12 月，我国光纤接入 FTTWO 的用户，已占互联网宽带接入 用户总数的 92.9%, 说明光纤接入已在我们互联网宽带接入中占绝对优势。 其实，信号在陆地上长距离的传输，现在基本上都已经实现了光纤化。在前面所介绍 • 67 •"}
{"doc_id": "network", "page": 79, "text": "的 ADSL 和 HFC 宽带接入方式中，用千远距离的传输媒体也早都使用了光缆，只是到了临 近用户家庭的地方，才转为铜缆（电话的用户线和同轴电缆）。我们知道，一个家庭用户远 远用不了一根光纤的通信容楹。为了有效地利用光纤资源，在光纤干线和广大用户之间，还 俙要铺设一段中间的转换装置即光配线网 ODN (Optical Distribution Netw ork), 使得数十个 家庭用户能够共享一根光纤干线。图 2-25 是现在广泛使用的无源光配线网的示意图。＂无源” 表明在光配线网中无须配备电源，因此基本上不用维护，其长期运营成本和管理成本都很低。 无源光配线网常称为无源光网络 PON (Passive Optical Network) 。 光网络单元 下行 头端 ＼、、 光分路器 旦卫 5、 上行 头端 ~ ◄  竺二 l:N 局端 光配线网 (ODN) 用户端 图 2-25 尤源光配线网的组成 在图 2-25 中，光线路终端 OLT (Optical Line Term i nal) 是连接到光纤干线的终端设备。 OLT 把收到的下行数据发往无源的 l:N 光分路器(splitter), 然后用广播方式向所有用户端的 光网络单元 ONU (Optical Network Unit)发送。典型的光分路器使用分路比是 1:32, 有时也 可以使用多级的光分路器。每个 ONU 根据特有的标识只接收发送给自己的数据，然后转换 为电信号发往用户家中。每一个 ONU 到用户家中的距离可根据具体情况来设置， OLT 则给 各 ONU 分配适当的光功率。如果 ONU 在用户家中，那就是光纤到户 FTTH 了。 当 ONU 发送上行数据时，先把电信号转换为光信号，光分路器把各 ONU 发来的上行 数据汇总后，以 TOMA 方式发往 OLT, 而发送时间和长度都由 OLT 集中控制，以便有序地 共享光纤主干。 光配线网采用波分复用，上行和下行分别使用不同的波长。 无源光网络 PON 的种类很多，但最流行的有以下两种，各有其优缺点。 一种是以太网无源光网络 EPON (Ethernet PON), 已在 2004 年 6 月形成了 lEEE 的标准 802.3ah, 较新的版本是 802.3ah-2008 。 EPON 在链路层使用以太网协议，利用 PON 的拓扑 结构实现了以太网的接入。 EPON 的优点是：与现有以太网的兼容性好，并且成本低，扩展 性强，管理方便。在第 3 章 3.5 .4节还要讨论这个问题。 另一种是吉比特无源光网络 GPON (Gigabit PON), 其标准是 ITU 在 2003 年 1 月批准的 • 68 •"}
{"doc_id": "network", "page": 80, "text": "ITU-T G.984 。之后更新多次，目前最新的是 2Ol0 年的 G.984.7 。 GPON 采用通用封装方法 GEM (Generic Encapsulation Met hod), 可承载多业务，对各种业务类型都能够提供服务质揽 保证，总体性能比 EPON 好。 GPON 虽成本稍高，但仍是很有潜力的宽带光纤接入技术。 采用光纤接入时，究竞把光网络单元 ONU 放在什么地方，应通过详细的预算对比才能 确定。从总的趋势来看，光网络单元 ONU 越来越靠近用户的家庭，因此就有了“光进铜退” 的说法。 需要注意的是，目前有些网络运营商所宣传的“光纤到户“，往往并非真正的 FTTH, 而是 FTTx, 对居民来说就是 FTTB 或 FTTF 。有的运营商把这种接入方式叫作“光纤宽带” 或“光纤加局域网”，这样可能较为准确。 本章的重要概念 • 物理层的主要任务就是确定与传输媒体的接口有关的一些特性，如机械特性、电气 特性、功能特性和过程特性。 • 一个数据通信系统可划分为三大部分，即源系统、传输系统和目的系统。源系 统包括源点（或源站、信源）和发送器，目的系统包括接收器和终点（或目的 站、信宿）。 • 通信的目的是传送消息。话音、文字、图像、视频等都是消息。数据是运送消息的 实体。信号则是数据的电气或电磁的表现。 • 根据信号中代表消息的参数的取值方式不同，信号可分为模拟信号（或连续信号） 和数字信号（或离散信号）。代表数字信号不同离散数值的基本波形称为码元。 • 根据双方信息交互的方式，通信可以划分为单向通信（或单工通信）、双向交替通 信（或半双工通信）和双向同时通信（或全双工通估）。 • 来自信源的信号叫作基带信号。信号要在信道上传输就要经过调制。调制有基带调 制和带通调制之分。最菲本的带通调制方法有调幅、调频和调相。还有更复杂的调 制方法，如正交振幅调制。 • 要提高数据在信道上的传输速率，可以使用更好的传输媒体，或使用先进的调制技 术。但数据传输速率不可能被任总地提高。 • 传输媒体可分为两大类，即导引型传输媒体（双绞线、同轴电缆或光纤）和非导引 型传输媒体（无线、红外或大气激光）。 • 常用的信道复用技术有频分复用、时分复用、统计时分复用、码分复用和波分复用 （光的频分复用）。 • 最初在数字传输系统中使用的传输标准是脉冲编码调制 PCM 。现在高速的数字传 输系统使用同步光纤网 SONET （美国标准）或同步数字系列 SDH （国际标准）。 • 用户到互联网的宽带接入方法有非对称数字用户线 ADSL （用数字技术对现有的模 拟电话用户线进行改造）、光纤同轴混合网 HFC （在有线电视网的基础上开发的） 和 FTTx (即光纤到...…)。 • 为了有效地利用光纤资源，在光纤干线和用户之间广泛使用无源光网络 PON 。无 源光网络无须配备电源，其长期运营成本和管理成本都很低。最流行的无源光网络 是以太网无源光网络 EPON 和吉比特无源光网络 GPON 。 • 69 •"}
{"doc_id": "network", "page": 81, "text": "习题 2-01 物理层要解决哪些问题？物理层的主要特点是什么？ 2-02 规程与协议有什么区别？ 2-03 试给出数据通信系统的模型并说明其主要组成构件的作用。 2-04 试解释以下名词：数据、信号、模拟数据、模拟信号、基带信号、带通信号、数字数 据、数字信号、码元、单工通信、半双工通信、全双工通信、串行传输、并行传输。 2-05 物理层的接口有哪几个方面的特性？各包含些什么内容？ 2-06 数据在信道中的传输速率受哪些因素的限制？信噪比能否任意提高？香农公式在数 据通信中的意义是什么？”比特／秒”和“码元／秒“有何区别？ 2-07 假定某信道受奈氏准则限制的最高码元速率为 20000 码元／秒。如果采用振幅调制， 把码元的振幅划分为 16 个不同等级来传送，那么可以获得多高的数据率（ b it/s) ?  2-08 假定要用 3 kHz 带宽的电话信道传送 64 kbit/s 的数据（无差错传输），试问这个信道 应具有多高的信噪比（分别用比值和分贝来表示） ？这个结果说明什么问题？ 2-09 用香农公式计算一下，假定信道带宽为 3100 Hz, 最大信息传输速率为 35 kb it/s, 那 么若想使最大信息传输速率增加 60%, 问信噪比 SIN 应增大到多少倍？如果在刚才 计算出的基础上将信噪比 SIN 再增大到 10 倍，问最大信息传输速率能否再增加 20%? 2-10 常用的传输媒体有哪几种？各有何特点？ 2-l1 假定有一种双绞线的衰减是 0.7 dB/k m （在 I kHz 时），若容许有 20 dB 的衰减，试问 使用这种双绞线的链路的工作距离有多长？如果要使这种双绞线的工作距离增大到 100 公里，问应当使衰减降低到多少？ 2-12 试计算工作在 1200~1400 nm 之间以及工作在 1400~1600 nm 之间的光波的频带宽 度。假定光在光纤中的传播速率为 2 X J08 m/S 。 2-13 为什么要使用信道复用技术？常用的信道复用技术有哪些？ 2-14 试写出下列英文缩写的全称，并进行简单的解释。 FDM, FDMA, TOM, TOMA, STDM, WDM, DWDM, CDMA, SONET,  SDH, STM-L OC-48 。 2-15 码分多址 CDMA 为什么可以使所有用户在同样的时间使用同样的频带进行通信而不 会互相干扰？这种复用方法有何优缺点？ 2-16 共有四个站进行码分多址 CDMA 通信。四个站的码片序列为： A: (-1 -I -I +l +I -1 +l +l) B: (-1 -I +1-1 +l +l +I -1)  C: (-1 +I -I +I +l +I -1 -1) D: (-1 +l -1 -I -I -1 +l -1)  现收到这样的码片序列： (- I +I -3 +I -1 -3 +I +I) 。问哪个站发送数据了？发送数据 的站发送的是 1 还是 O? 2-17 试比较 ADSL, HFC 以及 FTTx 接入技术的优缺点。 2-18 在 ADSL 技术中，为什么在不到 I MHz 的带宽中却可以使传送速率高达每秒几个兆 比特？ 2-19 什么是 EPON 和 GPON? • 70 •"}
{"doc_id": "network", "page": 82, "text": "第 3 章数据链路层 数据链路层屈于计算机网络的低层。数据链路层使用的信道主要有以下两种类型： (l) 点对点信道。这种信道使用一对一的点对点通信方式。 (2) 广播信道。这种信道使用一对多的广播通信方式，因此过程比较复杂。广播信道上 连接的主机很多，因此必须使用专用的共享信道协议来协调这些主机的数据发送。 局域网虽然是个网络，但我们并不把局域网放在网络层中讨论。这是因为在网络层要 讨论的问题是多个网络互连的问题，是讨论分组怎样从一个网络，通过路由器，转发到另一 个网络。在本竞中我们研究的是在同一个局域网中，分组怎样从一台主机传送到另一台主机， 但并不经过路由器转发。从整个的互联网来看，局域网仍属于数据链路层的范围。 本章首先介绍点对点信道和在这种信迨上最常用的点对点协议 PPP 。然后再用较大的篇 幅讨论共享信道的局域网和有关的协议。关千无线局域网的讨论将在第 9 章中进行。 本章最重要的内容是： (1) 数据链路层的点对点信道和广播信道的特点，以及这两种信道所使用的协议 (PPP 协议以及 CSMA/CD 协议）的特点。 (2) 数据链路层的三个基本问题：封装成帧、透明传输和差错检测。 (3) 以太网 MAC 层的硬件地址。 (4) 适配器、转发器、集线器、网桥、以太网交换机的作用以及使用场合。 下面看一下两台主机通过互联网进行通信时数据链路层（简称为链路层）所处的地位 （如图 3-1 所示）。 路由器 R i 路由器 Rl 占三产已二三已勹了一二气2 、 H1  (a) 主机 H ，向 H2 发送数据 (b) 从层次上看数据的流动 图 3-1 数据链路层的地位 H2  图 3-l(a)表示用户主机凡通过电话线上网，中间经过三个路由器 (R i，民和 R3) 连接 到远程主机 H2 。所经过的网络可以是多种的，如电话网、局域网和广域网。当主机凡向 • 71 •"}
{"doc_id": "network", "page": 83, "text": "比发送数据时，从协议的层次上石，数据的流动如图 3-l(b) 所示。主机凡和 H2 都有完整的 五层协议栈，但路由器在转发分组时使用的协议栈只有下面的三层气数据进入路由器后要 先从物理层上到网络层，在转发表中找到下一跳的地址后，再下到物理层转发出去。因此， 数据从主机儿传送到主机 H2 需要在路径中的各节点的协议栈向上和向下流动多次，如图中 的浅灰色箭头所示。 然而当我们专门研究数据链路层的问题时，在许多情况下我们可以只关心在协议栈中 水平方向的各数据链路层。于是，当主机 H1 向主机 H2 发送数据时，我们可以想象数据就是 在数据链路层从左向右沿水平方向传送，如图 3-2 中从左到右的粗箭头所示，即通过以下这 样的链路： 凡的链路层一凡的链路层一民的链路层一凡的链路层一比的链路层 H, H2  图 3-2 只考虑数据在数据链路层的流动 图 3-2 指出，从数据链路层来看，凡到 H2 的通信可以看成由四段不同的链路层通信组 成，即： H1-R1, R 尸凡， R2 一 R3 和 R3-H2 。这四段不同的链路层可能采用不同的数据链 路层协议。 3.1 数据链路层的几个共同问题 本节重点讨论使用点对点信道的数据链路层的一些基本问题。其中的某些概念对广播 信道也是适用的。 3.1. J 数据链路和帧 我们在这里要明确一下，“链路”和“数据链路”并不是一回事。 所谓链路(l i nk) 就是从一个节点到相邻节点的一段物理线路（有线或无 线），而中间没有任何其他的交换节点。在进行数据通信时，两台计符机之 扫 ·l仁 l 噩 视频讲解 间的通信路径往往要经过许多段这样的链路。可见链路只是一条路径的组成部分。 数据链路(da ta l i nk) 则是另一个概念。这是因为当需要在一条线路上传送数据时，除了 必须有一条物理线路外，还必须有一些必要的通信协议来控制这些数据的传输（这将在后面 几节讨论）。若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。现在最常用 ＠注·，出路山器之间在父换路由伯息 1甘．根踞所使用的路由选佯协议的小同，也有可能需要使用运输层协议．见卜－平的 4.5 节． • 72."}
{"doc_id": "network", "page": 84, "text": "的方法是使用网络适配器（既有硬件，也包括软件）来实现这些协议。一般的适配器都包括 了数据链路层和物理层这两层的功能。 也有人采用另外的术语。这就是把链路分为物理链路和逻辑链路。物理链路就是上面 所说的链路，而逻辑链路就是上面的数据链路，是物理链路加上必要的通信协议。 早期的数据通信协议曾叫作通信规程(procedure) 。因此在数据链路层，规程和协议是同 义语。 下面再介绍点对点信道的数据链路层的协议数据单元一帧。 数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据 取出并上交给网络层。在互联网中，网络层协议数据单元就是 IP 数据报（或简称为数据报、 分组或包）。 为了把主要精力放在点对点信道的数据链路层协议上，可以采用如图 3-3(a) 所示的三层 模型。在这种三层模型中，不管在哪一段链路上的通信（主机和路由器之间或两个路由器之 间），我们都看成是节点和节点的通信（如图中的节点 A 和节点 B), 而每个节点只有下三 层 网络层、数据链路层和物理层。 节点 A 网络层 物理层 节点 B 链路上传送的是电信号或光信号 II___._... II 一 11.III 节点 A 数据链路层 1 言送 链路 (a) 三层的简化模型 链路上传送的是帧 巳 链路 节点 B 接卢巨 J  (b) 只考虑数据链跺层 图 3-3 使用点对点信道的数据链路层 点对点信道的数据链路层在进行通信时的主要步骤如下： (I) 节点 A 的数据链路层把网络层交下来的 IP 数据报添加首部和尾部封装成帧。 (2) 节点 A 把封装好的帧发送给节点 B 的数据链路层。 (3) 若节点 B 的数据链路层收到的帧无差错，则从收到的帧中提取出 1P 数据报交给上 面的网络层；否则丢弃这个帧。 数据链路层不必考虑物理层如何实现比特传输的细节。我们甚至还可以更简单地设想 好像是沿着两个数据链路层之间的水平方向把帧直接发送到对方，如 00 3-3(b)所示。 3.1.2 三个基本问题 数据链路层协议有许多种，但有三个基本问题则是共同的。这三个基本 问题是：封装成帧｀透明传输和差错检测。下而分别讨论这三个基本问题。 打一扫 圈 视独讲解 • 73 •"}
{"doc_id": "network", "page": 85, "text": "1. 封装成帧 封装成帧(fram i n g)就是在一段数据的前后分别添加首部和尾部，这样就构成了一个帧。 接收端在收到物理层上交的比特流后，就能根据首部和尾部的标记，从收到的比特流中识别 帧的开始和结束。图 3-4 表示用帧首部和帧尾部封装成帧的一般概念。我们知道，分组交换 的一个重要概念就是：所有在互联网上传送的数据都以分组（即 TP 数据报）为传送单位。 网络层的 IP 数据报传送到数据链路层就成为帧的数据部分。在帧的数据部分的前面和后面 分别添加上首部和尾部，构成了一个完整的帧。这样的帧就是数据链路层的数据传送单元。 一个帧的帧长等于帧的数据部分长度加上帧首部和帧尾部的长度。首部和尾部的一个重要作 用就是进行帧定界（即确定帧的界限）。此外，首部和尾部还包括许多必要的控制信息。在 发送帧时，是从帧首部开始发送的。各种数据链路层协议都对帧首部和帧尾部的格式有明确 的规定。显然，为了提高帧的传输效率，应当使帧的数据部分长度尽可能地大千首部和尾部 的长度。但是，每一种链路层协议都规定了所能传送的帧的数据部分长度上限-最大传送 单元 MTU (Max i mum Transfer Un it)。图 3-4 给出了帧的首部和尾部的位置，以及帧的数据部 分与 MTU 的关系。 帧开始 发送 l  一石白部 1 帧的数谣部分 1 帧尾部 I 幻 MTU |  数据链跺层的帧长 IP 数据报 束结 1 帧 ..  从这里开始发送 图 3-4 用帧首部和帧尾部封装成帧 当数据是由可打印的 ASCII 码组成的文本文件时，帧定界可以使用特殊的帧定界符。 我们知道， ASCII 码是 7 位编码，一共可组合成 128 个不同的 ASCII 码，其中可打印的有 95 个（I) ，而不可打印的控制字符有 33 个。图 3-5 的例子可说明帧定界的概念。控制字符 SOH (Start Of Header) 放在一帧的最前面，表示帧的首部开始。另一个控制字符 EOT (End Of  Transmi ss i on) 表示帧的结束。诸注总， SOH 和 EOT 都是控制字符的名称。它们的十六进制 编码分别是 01 （二进制是 00000001) 和 04 （二进制是 00000100) 。 SOH （或 EOT) 并不是 S, 0, H （或 E, 0, T) 三个字符。此外，为了强调帧定界符的作用，与帧定界符无关的控制 信息在图 3-5 中都省略了。 丁巳 装在帧中的数据部分 帧 符归白帧 发这在前 图 3-5 用控制字符进行帧定界的方法举例 ＠注： “r,T打印的字符”就怂”可以从键盘 I·输入仇字符＂ （因而也是 III 打印出的）．我们仗用的标准键盘有 47 个挝可输入 94 个宁符（包括使用 Sh ift键），加」．空格键，一共可输入 95 个可打印字符． • 74 •"}
{"doc_id": "network", "page": 86, "text": "当数据在传输中出现差错时，帧定界符的作用更加明显。假定发送端在尚未发送完一 个帧时突然出故陓，中断了发送。但随后很快又恢复正常，千是重新从头开始发送刚才未发 送完的帧。由于使用了帧定界符，接收端就知道前面收到的数据是个不完整的帧（只有首部 开始符 SOH 而没有传输结束符 EOT), 必须丢弃。而后面收到的数据有明确的帧定界符 (SOH 和 EOT),因此这是一个完整的帧，应当收下。 2. 透明传输 由千帧的开始和结束的标记使用专门指明的控制字符，因此，所传输的数据中的任何 8 比 特的组合一定不允许和用作帧定界的控制字符的比特编码—样，否则就会出现帧定界的错误。 当传送的帧是用文本文件组成的帧时（文本文件中的字符都是从键盘上输入的），其数 据部分显然不会出现像 SOH 或 EOT 这样的帧定界控制字符。可见不管从键盘上输入什么字 符都可以放在这样的帧中传输过去，因此这样的传输就是透明传输。 但当数据部分是非 ASCII 码的文本文件时（如二进制代码的计算机程序或图像等），情 况就不同了。如果数据中的某个字节的二进制代码恰好和 SOH 或 EOT 这种控制字符一样 （如图 3-6 所示），数据链路层就会错误地”找到帧的边界”，把部分帧收下（误认为是个完 整的帧），而把剩下的那部分数据丢弃（这部分找不到帧定界控制字符 SOH) 。 出现了 “EOT\" 完整的帧 数据部分 SOH EOT EOT  f 发送在前误认为是一个帧 被接收端当作无效帧而丢弃 图 3-6 数据部分恰好出现与 EOT 一样的代码 像图 3-6 所示的帧的传输显然就不是“透明传输＂，因为当遇到数据中碰巧出现字符 \"EOT\" 时就传不过去了。数据中的 “EOT\" 将被接收端错误地解释为“传输结束＂的控制 字符，而在其后面的数据因找不到 “SOH\" 被接收端当作无效帧而丢弃。但实际上在数据中 出现的字符 “EOT\" 并非控制字符而仅仅是二进制数据 00000100 。 前面提到的＂透明”是一个很益要的术语。它表示：某一个实际存在的事物看起来却 好像不存在一样（例如，你看不见在你前面有块 100 ％透明的玻璃的存在）。”在数据链路层 透明传送数据”表示无论什么样的比特组合的数据，都能够按照原样没有差错地通过这个数 据链路层。因此，对所传送的数据来说，这些数据就“看不见“数据链路层有什么妨碍数据 传输的东西。或者说，数据链路层对这些数据来说是透明的。 为了解决透明传输问题，就必须设法使数据中可能出现的控制字符 “SOH\" 和 “EOT\" 在接收端不被解释为控制字符。具体的方法是：发送端的数据链路层在数据中出现控制字符 “SOH” 或 “EOT\" 的前面插入一个转义字符 “ESC\" （其十六进制编码是 IB, 二进制是 00011011) 。而在接收端的数据链路层在把数据送往网络层之前删除这个插入的转义字符。这 种方法称为字节填充（byte stuffi n g)或字符填充（charac ter s tuffin g)。如果转义字符也出现在数据 当中，那么解决方法仍然是在转义字符的前面插入一个转义字符。因此，当接收端收到连续 的两个转义字符时，就删除其中前面的一个。图 3-7 表示用字节填充法解决透明传输的问题。 • 75 •"}
{"doc_id": "network", "page": 87, "text": "符旺上已帧 已, : :  字甘埴芫 :.  尸发送 在前 原始数据 曰一曰 ; :、、,'·、 字节珑砑C. ; 字甘填充＼， -  经过宁节填允后发送的数据 帧结束符 臼曰·. 、,.. 亨节埴允 卢 曰 图 3-7 用字节填充法解决透明传输的问题 3. 差错检测 现实的通信链路都不会是理想的。这就是说，比特在传输过程中可能会产生差错： l 可 能会变成 O, 而 O 也可能变成 1 。这就叫作比特差错。比特差错是传输差错中的一种。本小节 所说的＂差错“，如无特殊说明，就是指“比特差错＂。在一段时间内，传输错误的比特占所 传输比特总数的比率称为误码率 BER (Bit Error Rate) 。例如，误码率为 10-“ 时，表示乎均每 传送 1010 个比特就会出现一个比特的差错。误码率与信噪比有很大的关系。如果设法提高信 噪比，就可以使误码率减小。实际的通信链路并非是理想的，它不可能使误码率下降到零。 因此，为了保证数据传输的可靠性，在计算机网络传输数据时，必须采用各种差错检测措施。 目前在数据链路层广泛使用了循环冗余检验 CRC (Cyclic Redundanc y Check) 的检错技术。 下面我们通过一个简单的例子来说明循环冗余检验的原理。 在发送端，先把数据划分为组，假定每组 K 个比特。现假定待传送的数据 M = 101001  (k = 6) 。 CRC 运笃就是在数据 M 的后而添加供差错检测用的 n 位冗余码，然后构成一个 帧发送出去，一共发送(k + n)位。在所要发送的数据后面增加 n 位的冗余码，虽然增大了数 据传输的开销，但却可以进行差错检测。当传输可能出现差错时，付出这种代价往往是很值 得的。 这 n 位冗余码可用以下方法得出。用二进制的模 2 运算°进行 2n 乘 M 的运算，这相当 于在 M 后面添加 n 个 0 。得到的 (k + n) 位的数除以收发双方事先商定的长度为(n + I) 价的除 数 P, 得出商是Q而余数是 R (n 付，比 P 少一位）。关千除数 P 下面还要介绍。在图 3-8 所示的例子中， M = 101001 （即 k=6) 。假定除数 P = 1101 （即 n=3) 。经模 2 除法运算后 的结果是：商Q = 110101 （这个桶并没有什么用处），而余数 R = 001 。这个余数 R 就作为 冗余码拼接在数据 M 的后面发送出去。这种为了进行检错而添加的冗余码常称为帧检验序 列 PCS (Frame Check Se quence) 。因此加上 FCS 后发送的帧是 101001001 （即 211M + FCS),  共有 (k+n)位。 顺便说一下，循环冗余检验 CRC 和帧检验序列 FCS 并不是同一个概念。 CRC 是一种 检错方法，而 FCS 是添加在数据后面的冗余码，在检错方法上可以选用 CRC, 但也可不选 用 CRC 。 ＠注：用校 2 运们进行加法时不进位，例如， 1111-'- 1010=0101 。减法和加法一祥．按加法规则计队 • 76 •"}
{"doc_id": "network", "page": 88, "text": "110101 一Q值i) P （除数）一 1101 fioiooiooo一 2nM （，除数） 1101:::::  图 3-8 1110 ; ; ; ;  1101 ; ; ; ;  ; : :  0111:::  0000:::  1110 ; ;  1101 i:  0110:  竺· 1100  1101  001 一 R （余数），作为 FCS 说明循环冗余检验原理的例子 在接收端把接收到的数据以帧为单位进行 CRC 检验：把收到的每一个帧都除以同样的 除数 P （模 2 运算），然后检查得到的余数 R 。 如果在传输过程中无差错，那么经过 CRC 检验后得出的余数 R 肯定是 0 （读者可以自 已验算一下。被除数现在是 101001001, 而除数是 P= 1101, 看余数 R 是否为 0) 。 但如果出现误码，那么余数 R 仍等千零的概率是非常非常小的（这可以通过不太复杂 的概率计算得出，例如，可参考[TANEll)) 。 总之，在接收端对收到的每一·帧经过 CRC 检验后，有以下两种悄况： (I) 若得出的余数 R=O, 则判定这个帧没有差错，就接受（acce pt)。 (2) 若余数 R # O, 则判定这个帧有差错（但无法确定究竟是哪一位或哪几位出现了差 错），就丢弃。 一种较方便的方法是用多项式来表示循环冗余检验过程。在上面的例子中，用多项式 P(X) = x3 + x2 + I 表示上面的除数 P = I 101 （最高位对应于f，最低位对应于炒）。多项式 P(X)称为生成多项式。现在广泛使用的生成多项式 P(X)有以下几种： CRC-I6=X 红炉＋ X2+ I  CRC-CCITT = x16 +x2 + x5 + 1  CRC-32 ＝炉＋炉＋炉＋ x22 ＋沪＋炉＋炉＋炉＋炉＋X7＋炉＋X+ X- +X+ I  在数据链路层，发送端帧检验序列 FCS 的生成和接收端的 CRC 检验都是用硬件完成的， 处理很迅速，因此并不会延误数据的传输。 从以上的讨论不难看出，如果我们在传送数据时不以帧为单位来传送，那么就无法加 入冗余码以进行差错检验。因此，如果要在数据链路层进行差错检验，就必须把数据划分为 帧，每一帧都加上冗余码，一帧接一帧地传送，然后在接收方逐帧进行差错检验。 最后再强调一下，在数据链路层若仅仅使用循环冗余检验 CRC 差错检测技术，则只能 做到对帧的无差错接受，即：“凡是接收端数据链路层接受的帧，我们都能以非常接近于 1 的概率认为这些帧在传输过程中没有产生差错＂。接收端丢弃的帧虽然曾收到了，但砓终还 是因为有差错被丢弃，即没有被接受。以上所述的可以近似地表述为（通常都是这样认为）： “凡是接收端数据链路层接受的帧均无差错”。 请注意，我们现在并没有要求数据链路层向网络层提供“可靠传输＂的服务。所谓 “可靠传输”就是：数据链路层的发送端发送什么，在接收端就收到什么。传输差错可分为 • 77."}
{"doc_id": "network", "page": 89, "text": "两大类：一类就是前面所说的最基本的比特差错，而另一类传输差错则更复杂些，这就是收 到的帧并没有出现比特经错，但却出现了帧丢失、帧重复或帧失序。例如，发送方连续传送 三个帧[# I ]-(#2]-[#3] 。假定接收端收到的每一个帧都没有比特差错，但却出现下面的几种 悄况： 帧丢失：收到［＃ I ]-[#3) （丢失 (#2]) 。 帧重复：收到[# I ]-[#2)-(#2]-[#3] （收到两个 [#2]) 。 帧失序：收到 [#l]-(#3]-[#2) （后发送的帧反而先到达了接收端，这与一般数据链路层的 传输概念不一样）。 以上三种情况都属于“出现传输差错＂，但都不是这些帧里有“比特差错＂。帧丢失很 容易理解。但出现帧里复和帧失序的情况则较为复杂，对这些问题我们现在不展开讨论。在 学完第 5 竞的 5.4 节后，我们就会知道在什么情况下接收端可能会出现帧重复或帧失序。 总之，我们应当明确，“无比特差错”与“无传输差错”并不是同样的概念。在数据链 路层使用 CRC 检验，能够实现无比特差错的传输，但这还不是可靠传输。 我们知道，过去 OSI 的观点是：必须让数据链路层向上提供可靠传输。因此在 CRC 检 错的基础上，增加了帧编号、确认和重传机制。收到正确的帧就要向发送端发送确认。发送 端在一定的期限内若没有收到对方的确认，就认为出现了差错，因而就进行重传，直到收到 对方的确认为止。这种方法在历史士兽经起到很好的作用。但现在的通信线路的质量已经大 大提高了，巾通信链路质揽不好引起差错的概率已经大大降低。因此，现在互联网就采取了 区别对待的方法： 对于通信质量良好的有线传输链路，数据链路层协议不使用确认和业传机制，即不要 求数据链路层向上提供可靠传输的服务。如果在数据链路层传输数据时出现了差错并且需要 进行改正，那么改正差错的任务就由上层协议（例如，运输层的 TCP 协议）来完成。 对十通信质矗较差的无线传输链路，数据链路层协议使用确认和重传机制，数据链路 层向上提供可靠传输的服务（见第 9 意）。 实践证明，这样做可以提高通信效率。 可靠传输协议将在第 5 音中讨论。本益介绍的数据链路层协议都不是可靠传输的协议。 3.2 点对点协议 PPP 在通信线路质扭较差的年代，在数据链路层使用可靠传输协议笘经是一种好办法。因 此，能实现可靠传输的高级数据链路控制 HDLC (High-level Data Link Control) 就成为当时比 较流行的数据链路层协议。但现在 HDLC 已很少使用了。对千点对点的链路，简单得多的 点对点协议 PPP (Point-to-Po int Pro tocol) 则是目前使用得最广泛的数据链路层协议。 3.2 .1 PPP 协议的特点 我们知道，互联网用户通常都要迕桵到某个 ISP 才能接入到互联网。 PPP 协议就是用户 计赁机和 ISP 进行通伈时所使用的数据链路层协议（如图 3-9 所示）。 • 78 •"}
{"doc_id": "network", "page": 90, "text": "已从互联网管理机构 申请到一批 IP 地址 用 至互联网 户 ISP  -PPP 协议 ,  图 3-9 用户到 ISP 的链路使用 PPP 协议 PPP 协议是 IETF 在 1992 年制定的。经过 1993 年和 1994 年的修订，现在的 PPP 协议 在 1994 年就已成为互联网的正式标准 [RFC 1661, STD5 I] 。 1. PPP 协议应满足的需求 IETF 认为，在设计 PPP 协议时必须考虑以下多方面的需求[RFC 1547]:  (1) 简单 IETF 在设计互联网体系结构时把其中最复杂的部分放在 TCP 协议中，而 网际协议 IP 则相对比较简单，它提供的是不可靠的数据报服务。在这种情况下，数据链路 层没有必要提供比 IP 协议更多的功能。因此，对数据链路层的帧，不祔要纠错，不需要序 号，也不需要流量控制。 IETF 把“简单”作为首要的需求。 简单的设计还可使协议在实现时不容易出错，从而使不同厂商在协议的不同实现上的 互操作性提高了。我们知道，协议标准化的一个主要目的就是提高协议的互操作性。 总之，这种数据链路层的协议非常简单：接收方每收到一个帧，就进行 CRC 检验。如 CRC 检验正确，就收下这个帧；反之，就丢弃这个帧，其他什么也不做。 (2) 封装成帧 PPP 协议必须规定特殊的字符作为帧定界符（即标志一个帧的开始和 结束的字符），以便使接收端从收到的比特流中能准确地找出帧的开始和结束位置。 (3) 透明性 PPP 协议必须保证数据传输的透明性。这就是说，如果数据中碰巧出现 了和帧定界符一样的比特组合时，就要采取有效的措施来解决这个问题（见 3.2.2 节）。 (4) 多种网络层协议 PPP 协议必须能够在同一条物理链路上同时支持多种网络层协 议（如 IP 和 IPX 等）的运行。当点对点链路所连接的是局域网或路由器时， PPP 协议必须 同时支持在链路所连接的局域网或路由器上运行的各种网络层协议。 (5) 多种类型链路 除了要支持多种网络层的协议外， PPP 还必须能够在多种类型的 链路上运行。例如，串行的（一次只发送一个比特）或并行的（一次并行地发送多个比特）， 同步的或异步的，低速的或高速的，电的或光的，交换的（动态的）或非交换的（静态的） 点对点链路。 这里特别要提到的是在 1999 年公布的在以太网上运行的 PPP, 即 PPP over Etherne t,简 称为 PPPoE [RFC 2516], 这是 PPP 协议能够适应多种类型链路的一个典型例子。 PPPoE 是 为宽带上网的主机使用的链路层协议。这个协议把 PPP 帧再封装在以太网帧中（当然还要 增加一些能够识别各用户的功能）。宽带上网时由于数据传输速率较高，因此可以让多个连 接在以太网上的用户共享一条到 ISP 的宽带链路。现在，即使只有一个用户利用 ADSL 进 行宽带上网（并不和其他人共享到 TSP 的宽带链路），也是使用 PPPoE 协议，见后面的 3.5 .4 节的讨论。 • 79 •"}
{"doc_id": "network", "page": 91, "text": "(6) 差错检测（ e n-or detection) PPP 协议必须能够对接收端收到的帧进行检测，并立 即丢弃有差错的帧。若在数据链路层不进行差错检测，那么已出现差错的无用帧就还要在网 络中继续向前转发，因而会白白浪费许多的网络资源。 (7) 检测连接状态 PPP 协议必须具有一种机制能够及时（不超过几分钟）自动检测 出链路是否处于正常工作状态。当出现故障的链路隔了一段时间后又直新恢复正常工作时， 就特别需要有这种及时检测功能。 (8) 最大传送单元 PPP 协议必须对每一种类型的点对点链路设置最大传送单元 MTU 的标准默认值＇＇。这样做是为了促进各种实现之间的互操作件。如果高层协议发送的 分组过长并超过 MTU 的数侦， PPP 就要丢弃这样的帧，并返回芹错。需要强调的是， MTU 是数据链路层的帧可以载荷的数据部分的最大长度，而不是帧的总长度。 (9) 网络层地址协商 PPP 协议必须提供一种机制使通信的两个网络层（例如，两个 IP 层）的实体能够通过协商知道或能够配置彼此的网络层地址。协商的符法应尽可能简单， 并且能够在所有的估况下得出协商结果。这对拨号迕核的链路特别巫要，因为如果仅仅在链 路层建立了连接而不知道对方网络层地址，则还不能够保证网络层可以传送分组。 (10) 数据压缩协商 PPP 协议必须提供一种方法来协商使用数据压缩算法。但 PPP 协议并不要求将数据压缩笃法进行标准化。 在 TCP/IP 协议族中，可靠传输由运输层的 TCP 协议负责，因此数据链路层的 PPP 协 议不需要进行纠错，不盂要设置序号，也不需要进行流她控制。 PPP 协议不支持多点线路 （即一个主站轮流和链路士的多个从站进行通信），而只支持点对点的链路迡信。此外， PPP 协议只支持全双工链路。 2. PPP 协议的组成 PPP 协议有三个组成部分： (I) 个将 IP 数据报封装到串行链路的方法。 PPP 既支持异步链路（无奇偶检验的 8 比 特数据），也支持面向比特的同步链路。 IP 数据报在 PPP 帧中就是其信息部分。这个信息部 分的长度受最大传送单元 MTU 的限制。 (2) 一个用来建立、配翌和测试数据链路连接的链路控制协议 LCP (L ink Control  Pro tocol) 。通亿的双方可协硕一些选坝。在 RFC 1661 中定义了 11 种类型的 LCP 分组。 (3) 一套网络控制协议 NCP (Network Control Pro t ocol)(2' 具中的每一个协议支持不同的 网络层协议，如 IP 、 OSI 的网络层、 DECnet和 A pp lcTalk 等。 3.2.2 PPP 协议的帧格式 1 各字段的意义 PPP 的帧格式如图 3-10 所示。 PPP 帧的首部和尾部分别为四个字段和两个字段。 首部的第一个字段和尾部的第二个字段都是标志字段 F (Flag),规定为 Ox7E （符号 “Ox\" 表示它后而的字符是用十六进制表示的。十六进制的 7E 的二进制表示是 OllllllO) 。标志 ＠注： MTU 的默认值是 1500 字节，在 RFC 1661 小， MTU 叫作垃大接收巾元 MRU (Max imum Receive Unit),  ＠汴： TCP 的早期版木也叫作 NCP，但它和这用所讨论的 NCP 没付关系。 • 80 •"}
{"doc_id": "network", "page": 92, "text": "字段表示一个帧的开始或结束。因此标志字段就是 PPP 帧的定界符。连续两帧之间只需要 用一个标志字段。如果出现连续两个标志字段，就表示这是一个空帧，应当丢弃。 首部中的地址字段 A 规定为 OxFF （即 11111111), 控制字段 C 规定为 Ox03 （即 00000011) 。最初曾考虑以后再对这两个字段的值进行其他定义，但至今也没有给出。可见 这两个字段实际上并没有携带 PPP 帧的信息。 可变长度 TP 数据报 艾 I 合 I ~3 I 协议 字节 1 2 不超过 1500 字节 2  PPP 帧 图 3-10 PPP 帧的格式 PPP 首部的第四个字段是 2 字节的协议字段。当协议字段为 Ox0021 时， PPP 帧的信息 字段就是 lP 数据报。若为 OxC02l, 则信息字段是 PPP 链路控制协议 LCP 的数据，而 Ox8021 表示这是网络层的控制数据。 信息字段的长度是可变的，不超过 1500 字节。 尾部中的第一个字段 (2 字节）是使用 CRC 的帧检验序列 FCS 。 2. 字节填充 当信息字段中出现和标志字段」样的比特(Ox7E) 组合时，就必须采取一些措施使这种形 式上和标志字段一样的比特组合不出现在信息字段中。 当 PPP 使用异步传输时，它把转义符定义为 Ox70 （即 01111101), 并使用字节填充， RFC 1662 规定了如下所述的填充方法： (l) 把信息字段中出现的每一个 Ox7E 字节转变成为 2 字节序列(Ox70, Ox5E) 。 (2) 若信息字段中出现一个 Ox7D 的字节（即出现了和转义字符一样的比特组合），则 把 Ox7D 转变成为 2 字节序列(Ox7D, Ox5D) 。 (3) 若信息字段中出现 ASCII 码的控制字符（即数值小千 Ox20 的字符），则在该字符前 面要加入一个 Ox7D 字节，同时将该字符的编码加以改变。例如，出现 Ox03 （在控制字符中 是“传输结束 “ETX) 就要把它转变为 2 字节序列 (Ox7D, Ox23) 。 由千在发送端进行了字节填充，因此在链路上传送的信息字节数就超过了原来的信息 字节数。但接收端在收到数据后再进行与发送端字节填充相反的变换，就可以正确地恢复出 原来的信息。 3. 零比特填充 PPP 协议用在 SONET/SDH 链路时，使用同步传输（一连串的比特连续传送）而不是异 步传输（逐个字符地传送）。在这种情况下， PPP 协议采用零比特埴充方法来实现透明传输。 零比特填充的具体做法是：在发送端，先扫描整个信息字段（通常用硬件实现，但也 可用软件实现，只是会慢些）。只要发现有 5 个连续 1, 则立即填入一个 0 。因此经过这种零 比特填充后的数据，就可以保证在信息字段中不会出现 6 个连续 1 。接收端在收到一个帧时， • 81 •"}
{"doc_id": "network", "page": 93, "text": "先找到标志字段 F 以确定一个帧的边界，接着再用硬件对其中的比特流进行扫描。每当 发现 5 个连续 1 时，就把这 5 个连续 1 后的一个 0 删除，以还原成原来的信息比特流（如 图 3-11 所示）。这样就保证了透明传输：在所传送的数据比特流中可以传送任意组合的比特 流， 而不会引起对帧边界的错误判断。 信息字段中出现了和 标志字段 F 完全一样 的 8 比特组合 发送端在 5 个连续 1 之后 填入 0 比特再发送出去 在接收端把 5 个连续 1 之后的 0 比特删除 01001111110001010  、y' 会被误认为是标志字段 F 010011111010001010  0  发送端填入 0 比特 010011111010001010  。 接收端删除填入的 0 比特 图 3-11 零比特的填充与删除 3.2.3 PPP 协议的工作状态 上一节我们通过 PPP 帧的格式讨论了 PPP 帧是怎样组成的。但 PPP 链 路一开始是怎样被初始化的？当用户拨号接入 ISP 后，就建立了一条从用户 个人电脑到 ISP 的物理连接。这时，用户个人电脑向 ISP 发送一系列的链路 扫·扫 褫 视频讲蛁 控制协议 LCP 分组（封装成多个 PPP 帧），以便建立 LCP 连接。这些分组及其响应选择了 将要使用的一些 PPP 参数。接着还要进行网络层配置，网络控制协议 NCP 给新接入的用户 个人电脑分配一个临时的 IP 地址。这样，用户个人电脑就成为互联网上的一个有 IP 地址的 主机了。 当用户通信完毕时， NCP 释放网络层连接，收回原来分配出去的 [P 地址。接着， LCP 释放数据链路层连接。最后释放的是物理层的连接。 上述过程可用如图 3-12 所示的状态图来描述。 PPP 链路的起始和终止状态永远是图 3-12 中的＂链路静止 ”(Li nk Dead) 状态，这时在 用户个人电脑和 ISP 的路由器之间并不存在物理层的连接。 • 82 •  LCP 链路 终止 链路故陌或 关闭请求 鉴别失败 设备之间无链路 I  物理链路 I  LCP 链路 功或无须鉴别 l  置协商 已鉴别的 LCP 链路 I  已将别的 LCP 链路 和 NCP 链路 图 3-12 PPP 协议的状态图"}
{"doc_id": "network", "page": 94, "text": "当用户个人电脑通过调制解调器呼叫路由器时（通常是在屏菇七用鼠标点击一个连接 按钮），路由器就能够检测到调制解调器发出的载波信号。在双方建立了物理层连接后， PPP 就进入“链路建立 “(Li咄 Est abl i sh) 状态，其目的是建立链路层的 LCP 连接。 这时 LCP 开始协商一些配置选项，即发送 LCP 的配置请求帧(Con figure-Re q ues t)。这是 个 PPP 帧，其协议字段置为 LCP 对应的代码，而信息字段包含特定的配置请求。链路的另 一端可以发送以下几种响应中的一种： (I) 配置确认帧（ Con fig ure-Ack): 所有选项都接受。 (2) 配置否认帧（ Con fig ure-Nak): 所有选项都理解但不能接受。 (3) 配置拒绝帧（ Configu re-Rej ec t):选项有的无法识别或不能接受，需要协商。 LCP 配置选项包括链路上的最大帧长、所使用的鉴别协议(Au t hen ti ca ti on Pro tocol) 的规 约（如果有的话），以及不使用 PPP 帧中的地址和控制字段（因为这两个字段的值是固定的， 没有任何信息贵，可以在 PPP 帧的首部中省略这两个字节）。 协商结束后双方就建立了 LCP 链路，接若就进入＂鉴别 ”(Aut hen ti ca t e) 状态。在这一 状态，只允许传送 LCP 协议的分组、鉴别协议的分组以及监测链路质报的分组。若使用口 令鉴别协议 PAP (Password Authentication Pro tocol), 则需要发起通信的一方发送身份标识符 和口令。系统可允许用户重试若干次。如果需要有更好的安全性，则可使用更加复杂的口令 握手鉴别协议 CHAP (Challen ge-Handshake Authentication Pro tocol) 。若鉴别身份失败，则转 到“链路终止 ”(L i nk Term i na te) 状态。若鉴别成功，则进入“网络层协议 ”(Network-Lay er Pro tocol) 状态。 在“网络层协议”状态， PPP 链路两端的网络控制协议 NCP 根据网络层的不同协议互 相交换网络层特定的网络控制分组。这个步骤是很重要的，因为现在的路由器都能够同时支 持多种网络层协议。总之， PPP 协议两端的网络层可以运行不同的网络层协议，但仍然可使 用同一个 PPP 协议进行通信。 如果在 PPP 链路上运行的是 IP 协议，则对 PPP 链路的每一端配置 IP 协议模块（如分 配 IP 地址）时就要使用 NCP 中支持 IP 的协议一IP 控制协议 IPCP (IP Control Pro t ocol) 。 IPCP 分组也封装成 PPP 帧（其中的协议字段为 Ox8021) 在 PPP 链路上传送。在低速链路上 运行时，双方还可以协商使用压缩的 TCP 和 IP 首部，以减少在链路上发送的比特数。 当网络层配置完毕后，链路就进入可进行数据通信的＂链路打开 “(Li nk Open) 状态。链 路的两个 PPP 端点可以彼此向对方发送分组。两个 PPP 端点还可发送回送请求 LCP 分组 (Echo-Req ues t)和回送回答 LCP 分组(Echo-Rep l y),以检查链路的状态。 数据传输结束后，可以由链路的一端发出终止请求 LCP 分组(Term i na te-Re q ues t)请求终 止链路连接，在收到对方发来的终止确认 LCP 分组(Termi nate-Ack) 后，转到＂链路终止” 状态。如果链路出现故陷，也会从“链路打开”状态转到“链路终止”状态。当调制解调器 的载波停止后，则回到“链路静止”状态。 图 3-12 右方的灰色方框给出了对 PPP 协议的几个状态的说明。从设备之间无链路开始， 到先建立物理链路，再建立链路控制协议 LCP 链路。经过鉴别后再建立网络控制协议 NCP 链路，然后才能交换数据。由此可见， PPP 协议已不是纯粹的数据链路层的协议，它还包含 了物理层和网络层的内容。 • 83 •"}
{"doc_id": "network", "page": 95, "text": "3.3 使用广播信道的数据链路层 广播估道可以进行一对多的通信。下面要讨论的局域网使用的就是广播信道。局域网 是在 20 世纪 70 年代末发展起来的。局域网技术在计算机网络中占有非常重要的地位。 J I 寸J 褫 视频i lf帖 3.3.1 局域网的数据链路层 局域网最上要的特点是：网络为一个单位所拥有，且地理范围和站点 数目均有限。在局域网刚刚出现时，局域网比广域网具有较高的数据率、 较低的时延和较小的误码率。但陡若光纤技术在广域网中普遍使用，现在 广域网也具有很高的数据率和很低的误码率。 局域网具有如下的一些优点： (I) 具有广插功能，从一个站点可很方便地访问全网。局域网上的主机可共享连接在局 域网上的各种硬件和软件资源。 (2) 便十系统的扩展和逐渐地演变，各设备的位置可灵活调整和改变。 (3) 提高了系统的可靠性(rel i ab 山ty)、可用性 (ava i lab i l ity)和生存性 (surv ivab i l ity)。 局域网可按网络拓扑进行分类。图 3-13(a) 是星形网。由千集线器(hub) 的出现和双绞 线大罹用于局域网中，星形以太网以及多级星形结构的以太网获得了非常广泛的应用。图 3- I 3(b) 是环形网，图 3- J 3(C) 为总线网，各站直接连在总线上。总线两端的匹配电阻吸收在 总线上传播的电磁波信号的能扭，避免在总线上产生有害的电磁波反射。总线网以传统以太 网最为著名，但以太网后来又溃变成［星形网。经过四十多年的发展，以太网的速率已大大 捉高。现在砐常用的以太网的速率是 I Gbit/s （家庭或中小企业）、 10 Gb it/ s （数据中心）和 100 Gbit/s （长距离传输），且其速率仍在继续提高。现在以太网已成为了局域网的同义词， 因此本竞从本节开始都是讨论以太网技术。 ` `  |  ::J  尸 I  亡＿二」.  J 1H  阻电吓 11- (b) 环形网 图 3-13 局域网的拓扑 局域网可使用多种传输媒体。双绞线最便宜，原来只用于低速 (I~2 Mb it/s) 基带局域 网。现在从 10 Mb it/s 至 10 Gb it/s 的局域网都可使用双绞线。双绞线已成为局域网中的主流 传输媒体。当数据率更高时，往往需要使用光纤作为传输媒体。 必须指出，局域网工作的层次跨越了数据链路层和物理层。由于局域网技术中有关数 据链路层的内容比较丰富，因此我们就把局域网的内容放在数据链路层这一堂中讨论。但这 并不表示局域网仅仅和数据链路层有关。 共享信道要若重考虑的一个问题就是如何使众多用户能够合理而方便地共享通信媒体 资源。这在技术上有两种方法： (I) 静态划分信道，如fl．第 2 节的 2 .4节中已经介绍过的频分复用、时分复用、波分复 (a) 星形网 (c) 总线网 • 84 •"}
{"doc_id": "network", "page": 96, "text": "用和码分复用等。用户只要分配到了信道就不会和其他用户发生冲突。但这种划分信道的方 法代价较高，不适合千局域网使用。 (2) 动态媒体接入控制，它又称为多点接入(multip le access), 其特点是佑道并非在用户 通信时固定分配给用户。这里又分为以下两类： • 随机接入 随机接入的特点是所有的用户可随机地发送信息。但如果恰巧有两个 或更多的用户在同一时刻发送信息，那么在共享媒体上就要产生碰撞（即发生了冲 突），使得这些用户的发送都失败。因此，必须有解决碰撞的网络协议。 • 受控接入 受控接入的特点是用户不能随机地发送信息而必须服从一定的控制。 这类的典型代表有分散控制的令牌环局域网和块中控制的多点线路探询(poiling), 或称为轮询。 属于随机接入的以太网将被重点讨论。受控接入则由千目前在局域网中使用得较少， 本书不再讨论。 由于以太网的数据率已演进到每秒吉比特甚至高达 400 吉比特，因此通常就用“传统 以太网”来表示砐早流行的 10 Mbit/s 速率的以太网。为了讨论原理，下而我们就从传统以 太网开始。 1 以太网的两个主要标准 以太网是美国施乐(Xerox) 公司的 Palo Al to 研究中心（简称为 PARC) 于 1975 年研制成 功的。那时，以太网是一种基带总线局域网，当时的数据率为 2_94 Mb it/s 。以太网用无源电 缆作为总线来传送数据帧，并以曾经在历史上表示传播电磁波的以太 (Et her) 来命名。 1976 年 7 月， Metcal fe和 Bogg s 发表他们的以太网里程碑论文 [METC76] 。 1980 年 9 月， DEC 公 司、英特尔(ln tel) 公司和施乐公司联合提出了 10 Mb it/s 以太网规约的第一个版本 DIX Vl  (DIX 是这三个公司名称的缩写）。 1982 年又修改为第二版规约（实际上也就是最后的版 本），即 DIX Ethernet V2, 成为世界上第一个局域网产品的规约。 在此基础上， IEEE 802 委员会飞1 的 802.3 工作组于 1983 年制定了第一个 IEEE 的以太网 标准 IEEE 802.3[W- JE EE802.3], 数据率为 LO Mb it/s 。 802.3 局域网对以太网标准中的帧格式 做了很小的一点更动，但允许基于这两种标准的硬件实现可以在同一个局域网上互操作。以 太网的两个标准 DIX Ethernet V2 与 IEEE 的 802.3 标准只有很小的差别，因此很多人也常把 8023 局域网简称为“以太网”（本书也经常不严格区分它们，虽然严格说来，“以太网”应 当是指符合 DIX Ethernet V2 标准的局域网）。 出于有关厂商彴商业上的激烈竞争， IEEE 802 委员会当初未能形成一个统一的、“最佳 的“局域网标准，而是被迫制定了几个不同的局域网标准，如 802 .4令牌总线网、 802 .5令 牌环网等。为了使数据链路层能更好地适应多种局域网标准， IEEE 802 委员会就把局域网 的数据链路层拆成两个子层，即逻辑链路控制 LLC (Logical Link Control) 子层和媒体接入控 制 MAC (Medium Access Con trol) 子层。与接入到传输媒体有关的内容都放在 MAC 子层，而 ＠注 IEEE 802 委员会 [W-IEEE802) 是专门制定局坡网和城域网标准的机构．截至 2020 年 7 月．其下屈仍在活动的工作 组只有 5 个，即： 802.1 －庙臣岛域网协议工作组： 802.3－以太网工作组： 802.1 I 一无线局域网工作组． 802.15 一无线个 人区域网工作组： 802.19-无线共存工作组．其余的都已经暂时或亢全停止了活动． • 85 •"}
{"doc_id": "network", "page": 97, "text": "LLC 子层则与传输媒体无关，不管采用何种传输媒体和 MAC 子层的局域网对 LLC 子层来 说都是透明的（如图 3-14 所示）。 逻铅链路控制 媒体接入控制 网络层 网络层 站点 1 站点 2 图 3-14 局域网对 LLC 子层是透明的 数据链路层 然而到了 20 世纪 90 年代后，激烈竞争的局域网市场逐渐明朗。以太网在局域网市场 中已取得了垄断地位，并且几乎成为了局域网的代名词。这里不必叙述后来陆续出现的多种 以太网标准的详细过程。目前使用最多的局域网只剩下 DIX Ethernet V2 （简称为以太网）， 而不是 IEEE 802 委员会制定的几种局域网。 IEEE 802 委员会制定的逻辑链路控制子层 LLC （即 IEEE 802.2 标准）的作用已经消失了，很多厂商生产的适配器上就仅装有 MAC 协议而 没有 LLC 协议。本章在介绍以太网时就不再考虑 LLC 子层。这样对以太网工作原理的讨论 会更加简洁。 2. 适配器的作用 首先我们从一般的概念上讨论一下计算机是怎样连接到局域网上的。 计算机与外界局域网的连接是通过适配器(adapter) 。适配器本来是在主机箱内插入的一 块网络接口板（或者是在笔记本电脑中插入一块 PCMClA 卡一个人计算机存储器卡接口 适配器）。这种接口板又称为网络接口卡 NlC (Network Interface Card) 或简称为“网卡”。由 千现在计算机主板上都已经嵌入了这种适配器，不再使用单独的网卡了，因此本书使用适配 器这个更准确的术语。在这种通信适配器上面装有处理器和存储器（包括 RAM 和 ROM) 。 适配器和局域网之间的通信是通过电缆或双绞线以串行传输方式进行的，而适配器和计算机 之间的通信则是通过计算机主板上的 VO 总线以并行传输方式进行的。因此，适配器的一个 泣要功能就是要进行数据串行传输和并行传输的转换。由千网络上的数据率和计算机总线上 的数据率并不相同，因此在适配器中必须装有对数据进行缓存的存储芯片。在主板上插入适 配器时，还必须把管理该适配器的设备驱动程序安装在计算机的操作系统中。这个驱动程序 以后就会告诉适配器，应当从存储器的什么位置上把多长的数据块发送到局域网，或者应当 在存储器的什么位置上把局域网传送过来的数据块存储下来。适配器还要能够实现以太网协 议。 诮注意，虽然我们把适配器的内容放在数据链路层中讲授，但适配器所实现的功能却 包含了数据链路层及物理层这两个层次的功能。现在的芯片的集成度都很高，以致很难把一 个适配器的功能严格按照层次的关系精确划分开。 适配器在接收和发送各种帧时，不使用计算机的 CPU 。这时计算机中的 CPU 可以处理 其他任务。当适配器收到有差错的帧时，就把这个帧直接丢弃而不必通知计算机。当适配器 收到正确的帧时，它就使用中断来通知该计算机，并交付协议栈中的网络层。当计算机要发 送 IP 数据报时，就由协议栈把 IP 数据报向下交给适配器，组装成帧后发送到局域网。图 3-15 表示适配器的作用。我们特别要注意，计算机的硬件地址（在本章的 3.3 .5节讨论）就在适 • 86 •"}
{"doc_id": "network", "page": 98, "text": "配器的 ROM 中，而计算机的软件地址一—JP 地址（在第 4 章 4.2.3 节讨论），则在计算机的 存储器中。 卫 竺 I  生成发送的数据 把帧发送到局域网 处理收到的数据 从局域网接收帧 图 3-15 计算机通过适配器和局域网进行通信 3.3.2 CSMA/CD 协议 最早的以太网是将许多计算机都连接到一根总线上。当初认为这种连 接方法既简单又可靠，因为在那个时代普遍认为：“有源器件不可靠，而无 源的电缆线才是最可靠的＂ O 视频讲解 总线的特点是：当一台计算机发送数据时，总线上的所有计算机都能检测到这个数据。 这种就是广播通信方式。但我们并不总是要在局域网上进行一对多的广播通信。为了在总线 上实现一对一的通信，可以使每一台计算机的适配器都拥有一个与其他适配器都不同的地址。 在发送数据帧时，在帧的首部写明接收站的地址。现在的电子技术可以很容易做到：仅当数 据帧中的目的地址与适配器 ROM 中存放的硬件地址一致时，该适配器才能接收这个数据帧。 适配器对不是发送给自己的数据帧就丢弃。这样，具有广播特性的总线上就实现了一对一的 通信。 人们也常把局域网上的计算机称为“主机”“工作站”“站点”或“站”。在本书中，这 几个名词都可以当成是同义词。 为了通信的简便，以太网采取了以下两种措施： 第 ，采用较为灵活的无连接的工作方式，即不必先建立连接就可以直接发送数据。 适配器对发送的数据帧不进行编号，也不要求对方发回确认。这样做可以使以太网工作起来 非常简单，而局域网信道的质扯很好，因通信质扭不好产生差错的概率是很小的。因此，以 太网提供的服务是尽最大努力的交付，即不可靠的交付。当目的站收到有差错的数据帧时 （例如，用 CRC 查出有差错），就把帧丢弃，其他什么也不做。对有差错帧是否需要重传则 由高层来决定。例如，如果高层使用 TCP 协议，那么 TCP 就会发现丢失了一些数据。于是 经过一定的时间后， TCP 就把这些数据重新传递给以太网进行重传。但以太网并不知道这 是重传帧，而是当作新的数据帧来发送。 我们知道，总线上只要有一台计算机在发送数据，总线的传输资源就被占用。因此， 在同一时间只能允许一台计算机发送数据，否则各计算机之间就会互相干扰，使得所发送数 据被破坏。因此，如何协调总线上各计算机的工作就是以太网要解决的一个重要间题。以太 网采用最简单的随机接入，但有很好的协议用来减少冲突发生的概率。这好比有一屋子的人 在开讨论会，没有会议主持人控制发言。想发言的随时可发言，不需要举手示意。但我们还 必须有个协议来协调大家的发言。这就是：如果你听见有人在发言，那么你就必须等别人讲 完了才能发启（台则就千扰了别人的发言）。但有时碰巧两个或更多的人问时发言了，那么 一旦发现冲突，大家都必须立即停止发言，等听到没有人发言了你再发言。以太网采用的协 • 87 •"}
{"doc_id": "network", "page": 99, "text": "调方法和上面的办法非常像，它使用的协议是 CSMA/CD, 意思是载波监听多点接入／碰撞 检测（Ca1Ti er Sense Multiple Access with Collision Det ecti on) 。 第二，以太网发送的数据都使用曼彻斯特(Manchester) 编码的信号。我们在第 2 章的 2.2.2 节中已经简单地介绍过曼彻斯特编码了。我们知道，二进制基带数字信号通常就是高、 低电压交替出现的信号。使用这种信号的最大问题就是当出现一长串连续的 1 或连续的 0 时， 接收端就无法从收到的比特流中提取位同步（即比特同步）信号。如图 3-16 所示，曼彻斯 特编码的编码方法是把每一个码元再分成两个相等的间隔。码元］是前一个间隔为低电压而 后一个间隔为高电压。码元 0 则正好相反，从高电压变到低电压（也可采用相反的约定，即 1 是“前高后低”而 0 是“前低后高”)。这样就保证了在每一个比特的正中间出现一次电压 的转换，而接收端就利用这种电压的转换很方便地把位同步信号提取出来。但是从曼彻斯特 编码的波形图也不难看出其缺点，这就是它所占的频带宽度比原始的基带信号增加了一倍 （因为每秒传送的码元数加倍了）。 比特流 1 。 o ; 。 1 。 ; o : 1 i 1 ; 1  曼彻斯特 差分曼彻斯特 I I l I I ,., I I  图 3-16 曼彻斯特编码 下面介绍 CSMNCD 协议的要点。 “多点接入”就是说明这是总线型网络，许多计算机以多点接入的方式连接在一根总 线上。协议的实质是“载波监听”和＂碰撞检测”。 “载波监听”也就是“边发送边监听”。这里必须指出，在通信领域，在大多数情况下， Carr i er 的标准译名是＂载波”。但对千以太网，总线上根本没有什么“载波＂。其实英语 Carr i er 有多种意思，如“承运器”“传导管”或“运载工具”等。因此在以太网中，把 Carr i er 译为“载体”或“媒体”可能更加准确些。考虑到“载波”这个译名已经在我国广 泛流行了好几十年，本书也就继续使用这个不准确的译名。我们知道，载波监听就是不管在 想要发送数据之前，还是在发送数据之中，每个站都必须不停地检测信道。在发送前检测信 道，是为了避免冲突。如果检测出已经有其他站在发送，则本站就暂时不要发送数据。在发 送中检测信道，是为了及时发现如果有其他站也在发送，就立即中断本站的发送。这就称为 碰撞检测。 “碰撞检测”是适配器边发送数据边检测信道上的信号电压的变化悄况。当两个或几 个站同时在总线上发送数据时，总线上的信号电压变化幅度将会增大（互相叠加）。当适配 器检测到的信号电压变化幅度超过一定的门限值时，就认为总线上至少有两个站同时在发送 数据，表明产生了碰撞。所谓“碰撒”就是发生了冲突。因此“碰撞检测”也称为“冲突检 测＂。这时，总线上传输的信号产生了严重的失真，无法从中恢复出有用的信息来。因此， 任何一个让在发送数据的站，一旦发现总线上出现了碰撞，其适配器就要立即停止发送，免 得继续进行无效的发送，白白浪费网络资源，然后等待一段随机时间后再次发送。 既然每～个站在发送数据之前已经监听到信道为“空闲＂，那么为什么还会出现数据在 总线上的碰撞呢？这是因为屯磁波在总线上总是以有限的速率传播的。这和我们开讨论会时 • 88 •"}
{"doc_id": "network", "page": 100, "text": "相似。一听见会场安静，我们就立即发言，但偶尔也会发生几个人同时抢着发言而产生冲突 的情况。图 3-17 所示的例子可以说明这种情况。设图中的局域网两端的站 A 和 B 相距 1 肛n, 用同轴电缆相连。电磁波在 I km 电缆的传播时延约为 5 µs （这个数字应当记住）。因此， A 向 B 发出的数据，在约 5 µs 后才能传送到 B 。换言之， B 若在 A 发送的数据到达 B 之前发 送自己的帧（因为这时 B 的载波监听检测不到 A 所发送的信息），则必然要在某个时间和 A 发送的帧发生碰撞。碰撞的结果是两个帧都变得无用。在局域网的分析中，常把总线上的单 程端到端传播时延记为了。发送数据的站希望尽早知道是否发生了碰撞。那么， A 发送数据 后，最迟要经过多长时间才能知道自己发送的数据和其他站发送的数据有没有发生碰撞？从 图 3-17 不难看出，这个时间最多是两倍的总线端到端的传播时延(2 分，或总线的端到端往返 传播时延。由千局域网上任意两个站之间的传播时延有长有短，因此局域网必须按最坏情况 设计，即取总线两端的两个站之间的传播时延（这两个站之间的距离最大）为端到端传播时 延。 , 呵 ｀；据曰王曰曰曰 卜 曰曰 无心盂 `:i囚三三 王三三毛］ 巨 I= t -0  B 检测到信道空闲 发送数据 /=t  B 检浏到发生碰撞 停止发送 图 3-17 传播时延对载波监听的影响 显然，在使用 CSMA/CD 协议时，一个站不可能同时进行发送和接收（但必须边发送 边监听信道）。因此使用 CSMA/CD 协议的以太网不可能进行全双工通信而只能进行双向交 替通信（半双工通信）。 下面是图 3-17 中的一些重要的时刻。 在t= 0 时， A 发送数据。 B 检测到信逆为空闲。 在t =,- o 时（这里 r>o> O), A 发送的数据还没有到达 B 时，由于 B 检测到信道是 空闲的，因此 B 发送数据。 经过时间 012 后，即在t = r - ol 2 时， A 发送的数据和 B 发送的数据发生了碰撞，但 这时 A 和 B 都不知道发生了碰撞。 在t = T 时， B 检测到发生了碰撞，于是停止发送数据。 在t = 2 r- o 时， A 也检测到发生了碰撞，因而也停止发送数据。 A 和 B 发送数据均失败，它们都要推迟一段时间再重新发送。 • 89 •"}
{"doc_id": "network", "page": 101, "text": "由此可见，每一个站在自已发送数据之后的一小段时间内，存在着遭遇碰撞的可能性。 这一小段时间是不确定的，它取决于另一个发送数据的站到本站的距离。因此，以太网不能 保证在检测到信道空闲后的某一时间内，一定能够把自己的数据帧成功地发送出去（因为存 什产生碰梳的可能）。以太网的这一特点称为发送的不确定性。如果希望在以太网上发生碰 撞的机会很小，必须使整个以太网的平均通信掀远小于以太网的最高数据率。 从图 3-17 可看出，最先发送数据帧的 A 站，在发送数据帧后至多经过时间 2r就可知道 所发送的数据帧是否遭受了碰撞。这就是 6 一 0 的情况。因此以太网的端到端往返时间 2 南： 为争用期 (con ten ti on per i od), 它是一个很篮要的参数。争用期又称为碰撞窗口 (col li s i on wi ndow) 。这是因为一个站在发送完数据后，只有通过争用期的“考验＂，即经过争用期这 段时间还没有检测到碰撞，才能肯定这次发送不会发生碰撞。这时，就可以放心把这一帧数 据顺利发送完毕。 以太网使用截断二进制指数退避(truncated binary exponential backo ft)算法来确定碰撞后 鱼传的时机。截断二进制指数退避算法并不复杂。这种算法让发生碰撞的站在停止发送数据 后，不是等待信道变为空闲后就立即再发送数据，而是退避一个随机的时间。这点很容易理 解，因为几个发生碰撞的站将会同时检测到信道变成了空闲。如果大家都同时重传，必然接 连发生碰撞。如果采用退避符法，生成了最小退避时间的站将最先获发送权。以后其余的站 的退避时间到了，但发送数据之前监听到信道忙，就不会马上发送数据了。 为了尽可能减小重传时再次发生冲突的概率，退避锌法有如下具体的规定： (I) 基本退避时间为争用期 2r, 具体的争用期时间是 5 1. 2 µs 。对千 10 Mb it/s 以太网， 在争用期内可发送 512 比特，即 64 字节。也可以说争用期是 512 比特时间。 1 比特时间就 是发送 1 比特所面的时间。所以这种时间单位与数据率密切相关。为了方便，也可以直接使 用比特作为争用期的单位。争用期是 512 比特，即争用期是发送 512 比特所需的时间。 (2) 从离散的整数集合[0,1, … ,(2k -I)] 中随机取出一个数，记为 r 。重传应推后的时间就 是／倍的争用期。上曲的参数 K 按下而的公式(3-1) 计算： k=M i n ［重传次数， 10) (3-1)  可见当重传次数不超过 IO 时，参数 K 等于重传次数：但当矗传次数超过 IO 时， k 就不 再增大而一肛等于 l0 。 (3) 当重传达 16 次仍不能成功时（这表明同时打绊发送数据的站太多，以致连续发生 冲突），则丢弃该帧，并向高层报告。 例如，在第 1 次祖传时， k = I,随机数 r 从整数 {O, l} 中选一个数。因此重传的站可选 择的重传推迟时间是 0 或 2r，在这两个时间中随机选择一个。 若再发生碰撞，则在第 2 次重传时， k = 2, 随机数 r 就从整数 {O, I, 2, 3} 中选一个数。 因此重传推迟的时间是在 0,2r,4r 和 6T 这 4 个时间中随机地选取一个。 同样，若冉发生碰撞，则重传时 k = 3, 随机数 r 就从整数 {O, I, 2, 3, 4, 5, 6, 7} 中选一个 数。依此类推。 若迕续多次发生冲突，就表明可能钉较多的站参与争用信道。但使用上述退避算法可 使重传需要推迟的平均时间随觅传次数而增大（这也称为动态退避），因而减小发生碰撞的 概率，有利｀卜整个系统的稳定。 找们还应注意到，适配器每发送一个新的帧，就要执行一次 CSMA/CD 算法。适配器 • 90 •"}
{"doc_id": "network", "page": 102, "text": "对过去发生过的碰撞并无记忆功能。因此，当好几个适配器正在执行指数退避算法时，很可 能有某一个适配器发送的新帧能够碰巧立即成功地插入到信道中，得到了发送权，而已经推 迟好几次发送的站，有可能很不巧，还要继续执行退避算法，继续等待． 现在考虑一种情况。某个站发送［一个很短的帧，但在发送完毕之前并没有检测出碰 撞。假定这个帧在继续向前传播到达目的站之前和别的站发送的帧发生了碰撞，因而目的站 将收到有差错的帧（当然会把它丢弃）。可是发送站却不知道这个帧发生了碰撞，因而不会 重传这个帧。这种情况显然是我们所不希望的。为了避免发生这种情况，以太网规定了一个 最短帧长 64 字节，即 512 比特。如果要发送的数据非常少，那么必须加入一些填充字节， 使帧长不小于 64 字节。对于J O Mb it/s 以太网，发送 512 比特的时间衙要 5 1. 2 µs, 也就是 上面提到的争用期。 由此可见，以太网在发送数据时，如果在争用期（共发送了 64 字节）没有发生碰撞， 那么后续发送的数据就一定不会发生冲突。换句话说，如果发生碰撞，就一定是在发送的前 64 字节之内。由于一检测到冲突就立即中止发送，这时已经发送出去的数据一定小于 64 字 节，因此凡长度小千 64 字节的帧都是由千冲突而异常中止的无效帧。只要收到了这种无效 帧，就应当立即将其丢弃。 前而已经讲过，信号在以太网上传播 I km 大约需要 5 µs 。以太网上最大的端到端时延 必须小千争用期的一半（即 25.6 µs), 这相当千以太网的最大端到端长度约为 5 km 。实际上 的以太网覆盖范围远远没有这样大。因此，实用的以太网都能在争用期 5 1. 2 µs 内检测到可 能发生的碰撞。以太网的争用期确定为 51.2 µs, 不仅考虑到以太网的端到端时延，而且还 包括其他的许多因素，如存在的转发器所增加的时延，以及下面要讲到的强化碰撞的干扰信 号的持续时间等。 下面介绍强化碰撞的概念。这就是当发送数据的站一旦发现发生了碰撞时，除立即停 止发送数据外，还要再继续发送 32 比特或 48 比特的人为干扰信号(j amm i n g s ignal), 以便让 所有用户都知道现在已经发生了碰撞（如图 3-18 所示）。对于 IO Mb it/s 以太网，发送 32 （或 48) 比特只需要 3.2 （或 4.8) µs 。 丿 图 3-18 人为干扰估号的加入 从图 3-18 可以看出， A 站从发送数据开始到发现碰撞并停止发送的时间间隔是 TB 。 A 站得知碰撞已经发生时所发送的强化碰撞的干扰信号的持续时间是TJ。图中的 B 站在得知 发生碰撞后，也要发送人为千扰信号，但为简单起见，图 3-18 没有画出 B 站所发送的入为 干扰信号。发生碰撞使 A 浪费时间 TB ＋乃。可是整个信道被占用的时间还要增加一个单程 端到端的传播时延 r。囚此总线被占用的时间是 Ta+ TJ +r。 • 91 •"}
{"doc_id": "network", "page": 103, "text": "以太网还规定了帧间最小间隔为 9.6 µs, 相当千 96 比特时间。这样做是为了使刚刚收 到数据帧的站的接收缓存来得及消理，做好接收下一帧的准备。 根据以上所讨论的，可以把 CSM 幻CD 协议的要点归纳如下： (\\)准备发送：适配器从网络层获得一个分组，加上以太网的首部和尾部（见后面的 3 .4 .3 节），组成以太网帧，放入适配器的缓存中。但在发送之前，必须先检测信道。 (2) 检测信道：若检测到信道忙，则继续不停地检测，一直等待信道转为空闲。此时若 在 96 比特时间内信道保持空闲（保证了帧间最小间隔），就发送这个帧。 (3) 在发送过程中仍不停地检测信道，即网络适配器要边发送边监听。这里只有两种可 能性： ＠发送成功：如果在争用期内一直未检测到碰撞，就认为发送成功（如果接收方收到 了有差错的帧，就丢弃它，后续的工作由高层来处理）。发送完毕后，其他什么也不做。然 后回到 (I) 。 ＠发送失败：在争用期内检测到碰撞。这时立即停止发送数据，并按规定发送人为干 扰信号。适配器接着就执行指数退避算法，等待 r 倍 512 比特时间后，返回到步骤（2), 继 续检测信道。但若重传达 16 次仍不能成功，则停止重传而向上报错。 以太网每发送完一帧，一定要把已发送的帧暂时保留一下。如果在争用期内检测出发 生了碰撞，那么还要在推迟一段时间后再把这个暂时保留的帧重传一次。 3.3.3 使用集线器的星形拓扑 传统以太网最初使用粗同轴电缆，后来演进到使用比较便宜的细同轴电缆，最后发展 为使用更便宜和更灵活的双绞线。这种以太网采用星形拓扑，在星形的中心则增加了一种可 靠性非常高的设备，叫作集线器(hub), 如图 3-19 所示。双绞线以太网总是和续线器配合使 用的。每个站需要用两对无屏蔽双绞线（放在一根电缆内），分别用于发送和接收。双绞线 的两端使用RJ-45 插头。由千集线器使用了大规模集成电路芯片，因此媒线器的可靠性就大 大提高了。 1990 年 IEEE 制定出星形以太网 IOBASE-T 的标准 802.3 i。 ”10\" 代表 IO Mbit/s  的数据率， BASE 表示连接线上的信号是基带信号， T 代表双绞线。实践证明，这比使用具 有大量机械接头的无源电缆要可靠得多。由于使用双绞线电缆的以太网价格便宜和使用方便， 因此粗缆和细缆以太网现在都已成为历史，并已从市场上消失了。 I- I 站点 一 1 I －』 两对双绞线 图 3-19 使用梨线器的双绞线以太网 但 IOBASE-T 以太网的通信距离稍短，每个站到集线器的距离不超过 100 m 。这种性价 比很高的 lOBASE-T 双绞线以太网的出现，是局域网发展史上的一个非常重要的里程碑，从 此以太网的拓扑就从总线型变为更加方便的星形网络，而以太网也就在局域网中占据了统治 地位。 • 92."}
{"doc_id": "network", "page": 104, "text": "使双绞线能够传送高速数据的主要措施是把双绞线的绞合度做得非常精确。这样不仅 可使特性阻抗均匀以减少失真，而且大大减少了电磁波辐射和无线电频率的干扰。在多对双 绞线的电缆中，还要使用更加复杂的绞合方法。 集线器的一些特点如下： (1) 从表面上看，使用集线器的局域网在物理上是一个星形网，但由千梨线器使用电子 器件来模拟实际电缆线的工作，因此整个系统仍像—个传统以太网那样运行。也就是说，使 用集线器的以太网在逻辑上仍是一个总线网，各站共享逻辑上的总线，使用的还是 CSMA/CD 协议（更具体些说，是各站中的适配器执行 CSMNCD 协议）。网络中的各站必 须竞争对传输媒体的控制，并且在同一时刻至多只允许一个站发送数据。 (2) 一个集线器有许多端口©,例如， 8 至 16 个，每个端口通过 RJ -45 插头（与电话机 使用的插头阳－ 11 相似，但略大一些）用两对双绞线与一台计算机上的适配器相连（这种插 座可连接 4 对双绞线，实际上只用 2 对，即发送和接收各使用一对双绞线）。因此，一个集 线器很像一个多端口的转发器。 (3) 集线器工作在物理层，它的每个端口仅仅简单地转发比特－~收到］就转发 l ，收 到 0 就转发 O, 不进行碰撞检测。若两个端口同时有信号输入（即发生碰撞），那么所有的 端口都将收不到正确的帧。图 3-20 是具有三个端口的集线器的示意图。 图 3-20 具有三个端口的集线器 (4) 集线器采用了专门的芯片，进行自适应串音回波抵消。这样就可使端口转发出去的 较强信号不致对该端口接收到的较弱信号产生干扰（这种干扰即近端串音）。每个比特在转 发之前还要进行再生整形并泣新定时。 梊线器本身必须非常可靠。现在的堆叠式(s tackable)集线器由 4~8 个集线器堆叠起来使 用。集线器一般都有少藉的容错能力和网络管理功能。例如，假定在以太网中有一个适配器 出了故障，不停地发送以太网帧。这时，集线器可以检测到这个问题，在内部断开与出故障 的适配器的连线，使整个以太网仍然能够正常工作。模块化的机箱式智能集线器有很高的可 靠性。它全部的网络功能都以模块方式实现。各模块均可进行热插拔，出故降时不断电即可 更换或增加新模块。集线器上的指示灯还可显示网络上的故障情况，给网络的管理带来了很 大的方便。 IEEE 802 .3标准还可使用光纤作为传输媒体，相应的标准是 IOBASE-F 系列， F 代表光 ＠注 保线器的瑞口（port)就是集线器和外接计算机的～个硬件接口(in t erface). 在运输层要经常使用软件端口(port).它和 集线器的硬件端口是两个不间的概念。本书以前曾把其线器的硬件端口称为接口，是为了避免和运输层的端口弄混。考虑到大多 数文献使用的是port,因此现在改用译名“端口”· • 93 •"}
{"doc_id": "network", "page": 105, "text": "纤。它主要用作集线器之间的远程连接。 3.3 .4 以太网的信道利用率 下面我们讨论一下以太网的信道利用率。 假定一个 10 Mbit/s 以太网同时有 10 个站在工作，那么每一个站所能 发送数据的平均速率似乎应当是总数据率的 1/10 （即 !Mbit/s) 。其实不然， 碑吓 因为多个站在以太网上同时工作就可能会发生碰撞。当发生碰撞时，信道资源实际上是被浪 费了。因此，当扣除碰撞所造成的信道损失后，以太网总的信道利用率并不能达到 100% 。 图 3-21 的例子是以太网的信道被占用的情况。一个站在发送帧时出现了碰撞。经过一 个争用期 2r后（嗦占以太网单程端到端传播时延），可能又出现了碰撞。这样经过若干个争 用期后，一个站就发送成功了。假定发送帧孟要的时间是 To 。它等于帧长（b it)除以发送速率 才 I ·-ti  (10 Mbit/s) 。 发生碰撞 卜一—一占用信迨时间 ；争用期！争用期 ,  ,.. ：争用期 `  2r  发送一帧所衙的平均时间 图 3-21 以太网的信道被占用的情况 我们应当注意到，成功发送一个帧需要占用信道的时间是 To+ r, 比这个帧的发送时间 要多一个单程端到端时延t。这是因为当一个站发送完最后一个比特时，这个比特还要在以 太网上传播。在最极端的情况下，发送站在传输媒体的一端，而比特在媒体上传输到另一端 所需的时间是 r。因此，必须在经过时间 T。+ T后以太网的媒体才宪全进入空闲状态，才能 允许其他站发送数据。 从图 3-21 可看出，要提高以太网的信道利用率，就必须减小 r与 To 之比。在以太网中 定义了参数 a, 它是以太网单程端到端时延 T与帧的发送时间 T。之比： T_To = a (3-2)  当 a---+O 时，表示只要一发生碰撞，就立即可以检测出来，并立即停止发送，因而信道 资源被浪费的时间非常非常少。反之，参数 a 越大，表明争用期所占的比例越大，这就使得 每发生一次碰撞就浪费了不少的信道资源，使得信道利用率明显降低。因此，以太网的参数 a 的值应当尽可能小些。从(3-2) 式可看出，这就要求(3-2) 式分子泭］数伯要小些，而分母 T。 的数值要大些。这就是说，当数据率一定时，以太网的连线的长度受到限制（否则 T的数值 会太大），同时以太网的帧长不能太短（否则 To 的值会太小，使 a 值太大）。 现仕考虑一种理想化的情况。假定以太网上的各站发送数据都不会产生碰撞（这显然 已经不是 CSMA/CD, 而是需要使用一种特殊的调度方法），并且能够非常有效地利用网络 的传输资源，即总线一且空闲就有某一个站立即发送数据。这样，发送一帧占用线路的时间 是 To+ r，而帧本身的发送时间是 T。。于是我们可计算出极限信道利用率 Smax 为： • 94 •"}
{"doc_id": "network", "page": 106, "text": "T sma, =—二＝—（3-3) 飞＋ r l+a  (3-3) 式的意义是：虽然实际的以太网不可能有这样高的极限信道利用率，但(3-3) 式指 出了只有当参数 a 远小于 1 才能得到尽可能高的极限信道利用率。反之，若参数 a 远大于 l （即每发生一次碰撞，就要浪费相对较多的传输数据的时间），则极限信道利用率就远小于 l,而这时实际的信道利用率就更小了。据统计，当以太网的利用率达到 30％时就已经处于 亟载的悄况。很多的网络容兄被网上的碰撞消耗掉了。 3.3.5 以太网的 MAC 层 1. MAC 层的硬件地址 在局域网中，硬件地址又称为物理地址或 MAC 地址（因为这种地址用 在 MAC 帧中）。 视频讲解 大家知道，在所有计算机系统的设计中，标识系统(identifi cati on sy s tem)(i)都是一个核心 问题。在标识系统中，地址就是识别某个系统的一个非常重要的标识符。在讨论地址问题 时，很多人常常引用著名文献 (SHOC78) 给出的如下定义： “名字指出我们所要寻找的那个资源，地址指出那个资源在何处，路由告诉我们如何 到达该处。” 这个非形式的定义固然很简单，但有时却不够准确。严格地讲，名字应当与系统的所 在地无关。这就像我们每一个人的名字一样，不随我们所处的地点而改变。为此 IEEE 802  标准为局域网规定了一种 48 位的全球地址（一般都简称为“地址＂），这就是局域网上的每 一台计算机中固化在适配器的 ROM 中的地址。因此，请特别注意下面两点： (I) 假定连接在局域网上的一台计算机的适配器坏了而我们更换了一个新的适配器，那 么这台计郓机的局域网的“地址”也就改变了，虽然这台计算机的地理位置一点也没有变化， 所接入的局域网也没有任何改变。 (2) 假定我们把位于南京的某局域网上的一台笔记本电脑携带到北京，并连接在北京的 某局域网上。虽然这台电脑的地理位置改变了，但只要电脑中的适配器不变，那么该电脑在 北京的局域网中的“地址”仍然和它在南京的局域网中的“地址”一样。 由此可见，局域网上的某台主机的“地址”并不指明这台主机位于什么地方。因此， 严格地讲，局域网的“地址“应当是每一个站的“名字”或标识符[PERLOO] 。不过，计算 机的名字通常都是比较适合人记忆的不太长的字符串，而这种 48 位二进制的“地址”却很 不像一般计算机的名字。但现在人们还是习惯于把这种 48 位的“名字”称为“地址”。本书 也采用这种习惯用法，尽管这种说法并不严格。 清注意，如果连接在局域网上的主机或路由器安装有多个适配器，那么这样的主机或 路由器就有多个“地址＂。实际上，这种 48 位“地址”应当是某个接口的标识符。 CD ii ·名词idc111 ifi ca1 i on 原来的标准译名是“标识”fMINGCI94], 2004 年出版的《现代汉谄规范叫典》给出“标识”的 议音是 “b i aozh i（读齐足＂忐＂），并且说明．现在规范词形写作“标志”。现在教育部国豕语言文字［作委员会发布“第一批异 形词整理-«...规定今后不冉使用“标识”而应当用“标志兀但［MINGCI94] 又将flag译为“标志”．这祥，名identifi ca ti on 和伽g 均译为“标忐”就会引起况乱。 1 ,1;1 此，本书采取这样的做法：作为动词用时，我们使J:f1”标志”．但作为名词（如用时，我们用 ”标识”(idcn1 i fi ca ti on) 和“标 L、\"(fi a g)。悄读者汴惹． • 95 •"}
{"doc_id": "network", "page": 107, "text": "在制定局域网的地址标准时，首先遇到的问题就是应当用多少位来表示一个网络的地 址字段。为了减少不必要的开销，地址字段的长度应当尽可能地短些。起初人们觉得用两个 字节（共 16 位）表示地址就够了，因为这一共可表示 6 万多个地址。但是，巾于局域网的 迅速发展，而处在不同地点的局域网之间又经常需要交换信息，这就希望在各地的局域网中 的站具有互不相同的物理地址。为了使用户在买到适配器并把机器连到局域网后马上就能工 作，而不需要等待网络管理员给他先分配一个地址， IEEE 802 标准规定 MAC 地址字段可采 用 6 字节（ 48 位）或 2 字节 (16 位）这两种中的一种。 6 字节地址字段对局部范围内使用 的局域网的确是太长了，但是由于 6 字节的地址字段可使全世界所有的局域网适配器都具有 不相同的地址，因此现在的局域网适配器实际上使用的都是 6 字节 MAC 地址。 现在 IEEE 的注册管理机构 RA (Registration Autho rity)是局域网全球地址的法定管理机 构 [W-IEEERA] ，它负责分配地址字段的 6 个字节中的前三个字节（即高位 24 位）。世界上 凡要生产局域网适配器的厂家都必须向 IEEE 购买由这三个字节构成的这个号（即地址块）， 这个号的正式名称是组织唯一标识符 OUI (Organizationally Unique Iden tifi er), 通常也叫作公 司标识符（comp an y_id) [RFC 7042] 。但应注意， 24 位的 OUI 不能够单独用来标志一个公司， 因为一个公司可能购买了几个 OUl ，也可能有几个小公司合起来购买一个 OUl 。例如，华 为公司购买了多个 OUl ，其中的一个是 A8-E5-44气地址字段中的后三个字节（即低位 24 位）则是由厂家自行指派，称为扩展标识符(ex t ended i den tifi er), 只要保证生产出的适配器 没有重复地址即可。可见购买了一个 OUI, 就可以生成出 2“ 个不同的 6 字节 (48 位） MAC 地址，这种地址又称为 EUI-48, 这里 EUl 表示扩展的唯一标识符(Extended Un ique  Iden tifi er) 。 EUI-48 的使用范围并不局限千局域网的硬件地址，而是可以用千软件接口。在 生产适配器时，这种 6 字节的 MAC 地址已被固化在适配器的 ROM 中。因此， MAC 地址 也叫作硬件地址（hardware address) 或物理地址气可见 “MAC 地址“实际上就是适配器地址 或适配器标识符 EUI-48 。当这种适配器嵌入到某台计算机（或手机）后，适配器上的标识 符 EUl-48 就成为这台计算机（或手机）的 MAC 地址了。 IEEE 规定地址字段的第一字节的最低有效位为 VG 位。 I/G 表示 Ind i vi dual/Group。当 1/G 位为 0 时，地址字段表示一个单个站地址。当I/G 位为 1 时表示组地址，用来进行多播 （以前曾译为组播）。需要指出，有的书把上述砐低有效位写为“第一位”，但“第一”的定 义是含糊不清的。这是因为在地址记法中有两种标准：第一种记法是把每一字节的最低位 （即最低有效位）写在蔽左边（第一位）。 IEEE 802.3 标准就采用这种记法。例如，十进制 数］ 1 的二进制表示是 1011, 最高位写在最左边。但若使用 IEEE 802.3 标准的记法，就应当 记为 110 1,把最低位写在最左边。当我们阅读 802.3 标准的有关文档时，面要特别注意。第 二种记法是把每一字节的最高位（即最高有效位）写在最左边（这也叫第一位）。在发送数 O 注．这里的 A8-E5-44 是十六进制数字在局域网地址中的一种标准记法．每 4 个－．进制数字用一个十六进制数宁杖示， 曲每两个十六进制数宁与它后面的两个十六进制数字之间用连字符隔开．另- ·f中记法是在 Ox 后而写 1-..一迕串的 1- 六进制数字， 如 OxA8E544. ＠汴地址白平而地址(flat address)和层次地址(h i erarch i cal address) 两大类．平面地址也叫作非层次地址，就是在分配地址 时桉/11贞抒号一个个地挨if分配．层次地卅坠将整个地址再划分为几个部分，而每部分按一足的规律分配g·码。像我们的电话g·码 就是 种压次号码．电俏网中的交换机按照闪家勺．一区号一局号一用户号的顺序可以准确地找到用户的屯记。但J为城网（打 6 字节 的地址是 种平血地址。适配器根捩全部的 48 位地址决定接收或丢弃所收到的 MAC 帧． • 96."}
{"doc_id": "network", "page": 108, "text": "据时，两种记法都是按照字节的顺序发送，但每一个字节中先发送哪一位则不同：第一种记 法先发送最低位，但第二种记法则先发送最高位。 IEEE 还考虑到可能有人并不愿意向 IEEE 的 RA 购买 OUI 。为此， lEEE 把地址字段第 一字节的最低第二位规定为 G/L位，表示 Globa l/Local 。当 G/L 位为 0 时是全球管理（保证 在全球没有相同的地址），厂商向 lEEE 购买的 OUI 都屈于全球管理。当地址字段的 G/L 位 为 1 时是本地管理，这时用户可任意分配网络上的地址。采用 2 字节地址字段时全都是本地 管理。但应当指出，以太网几乎不理会这个 G/L 位。 这样，在全球管理时，对每一个站的地址可用 46 位的二进制数字来表示（最低位和最 低第二位均为 0 时）。剩下的 46 位组成的地址空间可以有 246 个地址，已经超过 70 万亿个， 可保证世界上的每一个适配器都可有一个唯一的地址。当然，非无限大的地址空间总有用完 的时候。但据测算，至少在近期还不需要考虑 MAC 地址耗尽的问题。 当路由器通过适配器连接到局域网时，适配器上的硬件地址就用来标志路由器的某个 接口。路由器如果同时连接到两个网络上，那么它就衙要两个适配器和两个硬件地址。 我们知道适配器有过滤功能。当适配器从网络上每收到一个 MAC 帧就先用硬件检查 MAC 帧中的目的地址。如果是发往本站的帧则收下，然后再进行其他的处理。否则就将此 帧丢弃，不再进行其他的处理。这样做就不浪费主机的处理机和内存资源了。这里“发往本 站的帧“包括以下三种帧： (1) 单播(un i cas t)帧（一对一），即收到的帧的 MAC 地址与本站的 MAC 地址相同。 (2) 广播（broadcas t)帧（一对全体），即发送给本局域网上所有站点的帧（全 l 地址）。 (3) 多播（mul ti cas t)帧（—对多），即发送给本局域网上一部分站点的帧。 所有的适配器都至少应当能够识别前两种帧，即能够识别单播和广播地址。有的适配 器可用编程方法识别多播地址。当操作系统启动时，它就把适配器初始化，使适配器能够识 别某些多播地址。显然，只有目的地址才能使用广播地址和多播地址。 以太网适配器还可设置为一种特殊的工作方式，即混杂方式(promi scuous mode) 。工作 在混杂方式的适配器只要“听到“有帧在以太网上传输就都悄悄地接收下来，而不管这些帧 发往哪个站。请注意，这样做实际上是＂窃听“其他站点的通信而并不中断其他站点的通信。 网络上的黑客(hacker 或 cracker) 常利用这种方法非法获取网上用户的口令。因此，以太网上 的用户不愿意网络上有工作在混杂方式的适配器。 但混杂方式有时却非常有用。例如，网络维护和管理人员盂要用这种方式来监视和分 析以太网上的流量，以便找出提高网络性能的具体措施。有一种很有用的网络工具叫作嗅探 器 (Sn iffer) 就使用了设置为混杂方式的网络适配器。此外，这种嗅探器还可帮助学习网络的 人员更好地理解各种网络协议的工作原理。因此，混杂方式就像一把双刃剑，是利是弊要看 你怎样使用它。 2.MAC 帧的格式 常用的以太网 MAC 帧格式有两种标准，一种是 DIX Ethernet V2 标准（即以太网 V2 标 准），另一种是 IEEE 的 802.3 标准。这里只介绍使用得最多的以太网 V2 的 MAC 帧格式 （如图 3-22 所示）。图中假定网络层使用的是 TP 协议。实际上使用其他的协议也是可以的。 • 97."}
{"doc_id": "network", "page": 109, "text": "RR 数据报 字节 6 6 2 46~1500  目的地址 1 源地址 1 类型 IP 层 勾 MAC 层 l··············································~ ~·············································i···- 以太网 MAC 帧 物理层 一、～ －．｀．一．～ • -  7 字节 气｀｀·，、 -.,,L字节 二 1010101010I~  前同步码 ，伪持 图 3-22 以太网 V2 的 MAC 帧格式 以太网 V2 的 MAC 帧较为简单，由五个字段组成。前两个字段分别为 6 字节长的目的 地址和源地址字段。第三个字段是 2 字节的类型字段，用来标志上一层使用的是什么协议， 以便把收到的 MAC 帧的数据上交给上一层的这个协议。例如，当类型字段的值是 Ox0800 时，就表示上层使用的是 IP 数据报。第四个字段是数据字段，其长度在 46 到 1500 字节之 间 (46 字节是这样得出的：最小长度 64 字节减去 18 字节的首部和尾部就得出数据字段的 最小长度）。最后一个字段是 4 字节的帧检验序列 FCS （使用 CRC 检验）。当传输媒体的误 码率为 1xlO一8 时， MAC 子层可使未检测到的差错小于J X 10-14 。 FCS 检验的范围就是整个 的 MAC 帧，从目的地址开始到 FCS 为止的这五个字段，但不包括物理层插入的 8 字节的 前同步码和帧开始定界符。 这里我们要指出，在以太网 V2 的 MAC 帧格式中，其首部并没有一个帧长度（或数据 长度）字段。那么， MAC 子层又怎样知道从接收到的以太网帧中取出多少字节的数据交付 上一层协议呢？我们在前面讲述图 3-16 的曼彻斯特编码时已经讲过，这种曼彻斯特编码的 一个重要特点就是：在曼彻斯特编码的每一个码元（不管码元是 1 或 0) 的正中间一定有一 次电压的转换（从高到低或从低到高）。当发送方把一个以太网帧发送完毕后，就不再发送 其他码元了（既不发送 1 ，也不发送 0) 。因此，发送方网络适配器的接口上的电压也就不再 变化了。这样，接收方就可以很容易地找到以太网帧的结束位置。在这个位置往前数 4 字节 CFCS 字段长度是 4 字节），就能确定数据字段的结束位置。 当数据字段的长度小千 46 字节时， MAC 子层就会在数据字段的后面加入一个整数字 节的填充字段，以保证以太网的 MAC 帧长不小于 64 字节。我们应当注意到， MAC 帧的首 部并没有指出在数据字段中是否有填充字段。接收端的 MAC 子层在剥去 MAC 帧的首部和 尾部后，就把剩下的部分交给上面的 IP 层。那么 IP 层怎样知道这里有没有填充字段呢？大 家知道， IP 协议的首部有一个“总长度”字段。如果 IP 数据报的“总长度“超过或等千 46 字节，那么肯定就没有填充字段。反之，如果”总长度“小千 46 字节，那么就很容易把填 充字段计算出。例如，若 IP 数据报的总长度为 42 字节，埴充字段就应当是 4 字节。当 MAC 帧把 46 字节的数据上交给 lP 层后， IP 层就把其中砓后 4 字节的填充字段丢弃。 从图 3-22 可看出，在传输媒体上实际传送的要比 MAC 帧还多 8 个字节。这是因为当 一个站在刚开始接收 MAC 帧时，由于适配器的时钟尚未与到达的比特流达成同步，因此 MAC I剧的砓前面的若干位就无法接收，结果使整个的 MAC 成为无用的帧。为了接收端迅 速实现位同步，从 MAC 子层向下传到物理层时还要在帧的前面插入 8 个字节（由硬件生 发送 • 98 •"}
{"doc_id": "network", "page": 110, "text": "成），它由两个字段构成。第—个字段是 7 个字节的前同步码 (I 和 0 交替码），它的作用是 使接收端的适配器在接收 MAC 帧时能够迅速调整其时钟频率，使它和发送端的时钟同步， 也就是“实现位同步”（位同步就是比特同步的意思）。第二个字段是帧开始定界符，定义为 10101011 。它的前六位的作用和前同步码一样，最后的两个连续的 l 就是告诉接收端适配器： \"MAC 帧的信息马上就要来了，请适配器注意接收。 ”MAC 帧的 FCS 字段的检验范围不包 括前同步码和帧开始定界符。顺便指出，在使用 SONET/SDH 进行同步传输时则不需要用前 同步码，因为在同步传输时收发双方的位同步总是一直保持着的。 还需注意，在以太网上传送数据时是以帧为单位传送的。以太网在传送帧时，各帧之 间还必须有一定的间隙。因此，接收端只要找到帧开始定界符，其后面的连续到达的比特流 就都屈于同一个 MAC 帧。可见以太网不需要使用帧结束定界符，也不需要使用字节插入来 保证透明传输。 IEEE 802 .3标准规定凡出现下列情况之一的即为无效的 MAC 帧： (I) 帧的长度不是整数个字节： (2) 用收到的帧检验序列 FCS 查出有差错； (3) 收到的帧的 MAC 客户数据字段的长度不在 46~1500 字节之间。考虑到 MAC 帧首 部和尾部的长度共有 18 字节，可以得出有效的 MAC 帧长度为 64~1518 字节之间。 对于检查出的无效 MAC 帧就简单地丢弃。以太网不负责重传丢弃的帧。 最后要提一下， IEEE 802.3 标准规定的 MAC 帧格式与上面所讲的以太网 V2MAC 帧格 式的区别就是以下三点。 第一， IEEE 802.3 规定的 MAC 帧的第三个字段是“长度／类型”。由于以太网有效帧的 最大长度是 1518 字节。因此当这个字段值大千 Ox0600 时（相当于十进制的 1536), 这个字 段就表示“类型”。这样的帧格式就和以太网 V2 MAC 帧格式宪全一样。只有当这个字段值 小于 Ox0600 时才表示“长度”，即 MAC 帧的数据部分长度。显然，在这种情况下，若数据 字段的长度与实际的长度字段的值不一致，则该帧为无效的 MAC 帧。实际上，前面我们已 经讲过，由千以太网采用了曼彻斯特编码，长度字段本来并无实际意义。 第二，当“长度／类型”字段值小千 Ox0600 时，数据字段必须装入上面的逻辑链路控制 LLC 子层的 LLC 帧。 第三在 802.3 标准的文档中， MAC 帧的帧格式包括了 8 字节的前同步码和帧开始定 界符。有些教科书也是这样引用的。不过这并不影响我们对以太网工作原理的理解。 由于现在广泛使用的局域网只有以太网，因此 LLC 帧已经失去了原来的意义（见本章 3.3.1 节第 1 小节”以太网的两个主要标准”)。现在市场上流行的都是以太网 V2 的 MAC 帧， 但大家也常常把它称为 IEEE 802.3 标准的 MAC 帧。 3.4 扩展的以太网 在许多情况下，我们希望把以太网的覆盖范围扩展。本节先讨论在物理层把以太网扩 展，然后讨论在数据链路层把以太网扩展。这种扩展的以太网在网络层看来 订打 仍然是一个网络。 3.4.1 在物理层扩展以太网 以太网上的主机之间的距离不能太远（例如， lOBASE-T 以太网的两台 噩 视频讲蛁 • 99 •"}
{"doc_id": "network", "page": 111, "text": "主机之间的距离不超过 200 m), 否则主机发送的信号经过铜线的传输就会衰减到使 CSMA/CD 协议无法正常工作。在过去广泛使用粗缆或细缆以太网时，常使用工作在物理层 的转发器来扩展以太网的地理覆盖范围。那时，两个网段可用一个转发器连接起来。 IEEE 802.3 标准还规定，任意两个站之间砐多可以经过三个电缆网段。但随着双绞线以太网成为 以太网的主流类型，扩展以太网的覆盖范围已很少使用转发器了。 现在，扩展主机和集线器之间的距离的一种简单方法就是使用光纤（通常是一对光纤） 和一对光纤调制解调器，如图 3-23 所示。 l  三．＂4 光纤 调制解调器 光纤 以太网集线器 寸～调制解调器 图 3-23 主机使用光纤和一对光纤调制解调器连接到集线器 光纤调制解调器的作用就是进行电信号和光信号的转换。由千光纤带来的时延很小， 并且带宽很宽，因此使用这种方法可以很容易地使主机和几公里以外的集线器相连接。 如果使用多个栠线器，就可以连接成覆盖更大范围的多级星形结构的以太网。例如， 一个学院的三个系各有一个 IOBASE-T 以太网（如图 3-24(a) 所示），可通过一个主干集线器 把各系的以太网连接起来，成为一个更大的以太网（如图 3-24(b) 所示）。 三个独立的碰掩域 一个更大的碰掩域 (a) 三个独立的以太网 (b) 一个扩展的以太网 图 3-24 用多个集线器连成更大的以太网 这样做可以有以下两个好处。第一，使这个学院不同系的以太网上的计算机能够进行 跨系的通信。第二，扩大（以太网援盖的地理范围。例如，在一个系的 IOBASE-T 以太网中， 主机与集线器的最大距离是 100 m, 因而两台主机之间的最大距离是 200 lll 。但在通过主干 集线器相连接后，不同系的主机之间的距离就可扩展f，因为集线器之间的距离可以是 lOOm （使用双绞线）或更远（如使用光纤）。 但这种多级结构的媒线器以太网也带来了一些缺点。 (l)如图 3-24(a) 所示的例子，在三个系的以太网互连起来之前，每一个系的 lOBASE-T 以太网是一个独立的碰撞域（coll i s i on domai n, 又称为冲突域），即在任一时刻，在每一个碰 撞域中只能有一个站在发送数据。每一个系的以太网的最大吞吐量是 IO Mb it/s, 因此三个 系总的最大吞吐址是 30 Mb it/s 。在三个系的以太网通过集线器互连起来后就把三个碰撞域 变成一个碰撞域（范围扩大到三个系），如图 3-24(b) 所示，而这时的最大吞吐址仍然是一个 系的吞吐扭 10 Mbit/s 。这就是说，当某个系的两个站在通信时所传送的数据会通过所有的 媒线器进行转发，使得其他系的内部在这时都不能通信（一发送数据就会碰撞）。 • 100 •"}
{"doc_id": "network", "page": 112, "text": "(2) 如果不同的系使用不同的以太网技术（如数据率不同），那么就不可能用集线器将 它们互连起来。如果在图 3-24 中，一个系使用J O Mb it/s 的适配器，而另外两个系使用 10/100 Mb it/s 的适配器，那么用集线器连接起来后，大家都只能工作在 10 Mb it/s 的速率。 集线器基本上是个多端口（也称为接口）的转发器，它并不能把帧进行缓存。 3.4.2 在数据链路层扩展以太网 扫一扫 扩展以太网更常用的方法是在数据链路层进行的。最初人们使用的是 .  网桥(bri dge) 。网桥对收到的帧根据其 MAC 帧的目的地址进行转发和过滤。 当网桥收到一个帧时，并不是向所有的端口转发此帧，而是根据此帧的目 视频讲解 的 MAC 地址，查找网桥中的地址表，然后确定将该帧转发到哪一个端口，或者是把它丢弃 （即过滤）。 1990 年问世的交换式集线器(sw itch i ng hub), 很快就淘汰了网桥。交换式集线器常称为 以太网交换机(switch) 或第二层交换机(L2 switch), 强调这种交换机工作在数据链路层。 “交换机”并无准确的定义和明确的概念。著名网络专家 Perlman 认为：“交换机”应 当是一个市场名词，而交换机的出现的确使数据的转发更加快速了 [PERLOO] 。本书也使用 这个广泛被接受的名词一以太网交换机。下面简单地介绍以太网交换机的特点。 1. 以太网交换机的特点 以太网交换机实质上就是一个多端口的网桥，通常都有十几个或更多的端口，和工作 在物理层的转发器、集线器有很大的差别。以太网交换机的每个端口都直接与一个单台主机 或另一个以太网交换机相连，并且一般都工作在全双工方式。以太网交换机还具有并行性， 即能同时连通多对端口，使多对主机能同时通信（而网桥只能一次分析和转发一个帧）。相 互通信的主机都独占传输媒体，无碰撞地传输数据。换句话说，每一个端口和连接到端口的 主机构成了一个碰撞域，具有 N 个端口的以太网交换机的碰撞域共有 N 个。 以太网交换机的端口还有存储器，能在输出端口繁忙时把到来的帧进行缓存。因此， 如果连接在以太网交换机上的两台主机，同时向另一台主机发送帧，那么当这台主机的端口 繁忙时，发送帧的这两台主机的端口会把收到的帧暂存一下，以后再发送出去。 以太网交换机是—种即插即用设备，其内部的帧交换表（又称为地址表）是通过自学 习算法自动地逐渐建立起来的。实际上，这种交换表就是一个内容可寻址存储器 CAM (Content Addressable Memory)。以太网交换机由于使用了专用的交换结构芯片，用硬件转发 收到的帧，其转发速率要比使用软件转发的网桥快很多。 以太网交换机的性能远远超过普通的集线器，而且价格也不贵，这就使工作在物理层 的集线器逐渐地退出了市场。 对千传统的 10 Mb it/s 的共享式以太网，若共有 10 个用户，则每个用户占有的平均带 宽只有 I Mb it/s 。若使用以太网交换机来连接这些主机，虽然在每个端口到主机的带宽还是 10 Mbit/s, 但由千一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因 此对千拥有 10 个端口的交换机的总容量则为 100 Mb it/s 。这汗是交换机的最大优点。 从共享总线以太网转到交换式以太网时，所有接入设备的软件和硬件、适配器等都不 需要做任何改动。 以太网交换机一般都具有多种速率的端口，例如，可以具有 lO Mbit/s, I 00 Mbit/s 和 1 Gbit/s  的端口的各种组合，这就大大方便了各种不同情况的用户。 • 101 •"}
{"doc_id": "network", "page": 113, "text": "虽然许多以太网交换机对收到的帧采用存储转发方式进行转发，但也有一些交换机采 用直通（cu t-t hrou g h) 的交换方式。直通交换不必把整个数据帧先缓存后再进行处理，而是在 接收数据帧的同时就立即按数据帧的目的 MAC 地址决定该帧的转发端口，因而提高了帧的 转发速度。如果在这种交换机的内部采用基于硬件的交叉矩阵，交换时延就非常小。直通交 换的一个缺点是它不检查差错就直接将帧转发出去，因此有可能也将一些无效帧转发给其他 的站。在某些情况下，仍需要采用基千软件的存储转发方式进行交换，例如当需要进行线路 速率匹配、协议转换或差错检测时。现在有的厂商己生产出能支持两种交换方式的以太网交 换机。以太网交换机的发展与建筑物结构化布线系统的普及应用密切相关。在结构化布线系 统中，广泛地使用了以太网交换机。 2. 以太网交换机的自学习功能 我们用一个简单例子来说明以太网交换机是怎样进行自学习的。 假定在图 3-25 中的以太网交换机有 4 个端口，各连接一台计算机，其 MAC 地址分别 是 A, B, C 和 D 。交换表最重要的就是两个项目：目的 MAC 地址和转发端口。在一开始，以 太网交换机里面的交换表是空的（如图 3-25(a) 所示）。 以太网交换机 (a) 交换表一开始是空的 A 从端口 1 发送一帧给 B B 从端口 3 发送一帧给 A 以太网交换机 (b) 交换了两帧后的交换表 图 3-25 以太网交换机中的交换表 假定 A 先向 B 发送一帧，从端口 1 进入到交换机。交换机收到帧后，先查找交换表。 现在表中没有 B 的地址。于是，交换机把此帧的源地址 A 和端口 1 写入交换表中，并向除 端口 1 以外的所有端口广播这个帧（从端口 1 收到的帧显然不应再从端口 1 转发出去）。 广播发送可以保证让 B 收到这个帧，而 C 和 D 在收到帧后，因目的地址不匹配将丢弃 此帧。这一过程也称为过滤。 由千在交换表中写入了项目（A, I), 因此以后不管从哪个端口收到帧，只要其目的地址 是 A, 就把收到的帧从端口 1 转发出去送交 A 。这样做的依据是：既然 A 发送的帧是从端 口 1 进入交换机的，那么从端口 1 转发出的帧肯定到达 A 。 接下来假定 B 通过端口 3 向 A 发送一帧。交换机查找交换表，发现交换表中的 MAC 地址有 A, 表明凡是发给 A 的帧（即目的地址为 A 的帧）都应从端口 1 转发。显然，现在 应直接把收到的帧从端口 1 转发给 A, 而没有必要再广播收到的帧。交换表这时用源地址 B 写入一个项目 (B, 3), 表明今后如有发送给 B 的帧，应从端口 3 转发。 经过一段时间后，只要主机 C 和 D 也向其他主机发送帧，以太网交换机中的交换表就 会把转发到 C 或 D 应当经过的端口号 (2 或 4) 写入交换表中。这样，交换表中的项目就逐 渐增多了，以后再转发帧时就可以直接从交换表中找到转发的端口，而不必使用发送广播帧 • 102 •"}
{"doc_id": "network", "page": 114, "text": "的方法了。 考虑到有时可能要在交换机的端口更换主机，或者主机要更换其网络适配器，这就需 要及时更改交换表中的项目。为此，当交换表中写入一个项目时就记下当时的时间，只要超 过预先设定的时间（例如 300 秒），该项目就自动被删除。用这样的方法保证交换表中的数 据都符合当前网络的实际状况。这就是说，图 3-25 中的交换表实际上是有三列，即 MAC 地址、端口和写入时间。 以太网交换机的这种自学习方法使得以太网交换机能够即插即用，不必人工进行配置， 因此非常方便。 但有时为了增加网络的可靠性，在使用以太网交换机组网时，往往会增加一些冗余的 链路。在这种情况下，自学习的过程就可能导致以太网帧在网络的某个环路中无限制地兜圈 子。我们用图 3-26 的简单例子来说明这个问题。 在图 3-26 中，假定一开始土机 A 通过端口交换机＃ l 向主机 B 发送一帧 0 。 由于交换表目前是空的，因此交换机＃ l 收到帧 0 后就向本交换机的所有其他端口进行 广播发送。我们现在观察其中一个帧的走向： 离开交换机＃ 1 端口 3 的帧 e 到达交换机＃2 端口],然后向交换机＃2 所有其他端口广播 发送 广播发送的帧中有一个帧0 到达交换机＃2 端口 2; 交换机＃2 端口 2 把这个帧（帧 0) 发送到交换机＃ I 端口 4, 接着又向交换机＃ 1 所有其 他端口广播发送帧； 广播发送的帧中有一个帧0 到达交换机＃ l 端口 3; 上述过程就这样无限制地循环兜圈子 (e-0-0-0) 。显然，这就白白消耗了网络 资源。 以太网 以太网 交换机＃ 1 交换机＃2 CA二因平已一 IB  ，一1 JD  ．一1 图 3-26 在两个交换机之间兜圈子的帧 为了解决这种兜圈子问题， lEEE 的 802.ID 标准制定了一个生成树协议 STP (Spanning  Tree Pro tocol) 。其要点就是不改变网络的实际拓扑，但在逻辑上则切断某些链路，使得从一 台主机到所有其他主机的路径是无环路的树状结构，从而消除了兜圈子现象。 3. 从总线以太网到星形以太网 大家知道，传统的电话网是星形结构，其中心就是电话交换机。那么在 20 世纪 70 年 代中期出现的局域网，为什么不采用这种星形结构呢？这是因为在当时的技术条件下，还很 难用廉价的方法制造出高可靠性的以太网交换机。所以那时的以太网就采用无源的总线结构。 这种总线式以太网一问世就受到广大用户的欢迎，并获得了很快的发展。 然而随着以太网上站点数目的增多，使得总线结构以太网的可靠性下降。与此同时， 大规模集成电路以及专用芯片的发展，使得星形结构的以太网交换机可以做得既便宜又可靠。 在这种情况下，采用以太网交换机的星形结构就成为以太网的首选拓扑，而传统的总线以太 • 103 •"}
{"doc_id": "network", "page": 115, "text": "网也很快从市场上消失了。 总线以太网使用 CSM A/CD 协议，以半双工方式工作。但以太网交换机不使用共享总 线，没有碰撞问题，因此不使用 CSMA/CD 协议，而是以全双工方式工作。既然连以太网的 重要协议 CSMA/CD 都不使用了（相关的“争用期”也没有了），为什么还叫作以太网呢？ 原因就是它的帧结构未改变，仍然采用以太网的帧结构。 3.4.3 虚拟局域网 以太网交换机的间世，加速了以太网的普及应用。一个以太网交换机 可以非常方便地连接几十台计算机，构成一个星形以太网。 扫一扫 醋 但是，当一个以太网包含的计算机太多时，往往会带来两个缺点。 视频讲解 首先，一个以太网是一个广播域。在以太网上经常会出现大社的广播帧。在交换机的 交换表的建立过程中要使用许多广播帧。我们经常使用的 ARP 和 DHCP 协议（这将在后面 两章中讲到），也都要在以太网中传送很多的广播帧。在一个主机数批很大的以太网上传播 广播帧，必然会消耗很多的网络资源。如果网络的配置出了些差错，就有可能发生广播帧在 网络中无限制地兜圈子（如图 3-26 所示那样），形成了“广播风暴“，使整个的网络瘫痪。 其次，一个单位的以太网往往为好几个下属部门所共享。但有些部门的信息是需要保 密的（例如，财务部门或人事部门）。许多部门共享一个局域网对信息安全不利。 如果使每一个小部门各拥有自己的较小的局域网，那么这不但可使局域网的广播域范 即缩小，同时也提高了局域网的安全性。在以太网交换机出现后，我们可以很方便灵活地建 立虚拟局域网 VLAN (Virtual LAN) 。这样就把一个较大的局域网，分割成为一些较小的局 域网，而每一个局域网是一个较小的广播域。 在 IEEE 802.l Q标准中，对虚拟局域网 VLAN 是这样定义的： 捉拟局域网 YLAN 是由一些局域网网段构成的与物理位置无关的逻辑组，而这些网段 具有某些共同的需求。每一个 YLAN 的帧都有一个明确的标识符，指明发送这个帧的计算 机属千哪一个 VLAN 。 虚拟局域网其实只是局域网给用户提供的一种服务，而并不是一种新型局域网。 1988 年 IEEE 批准了 802.3ac 标准，这个标准定义了以太网的帧格式的扩展，以便支持虚 拟局域网。虚拟局域网协议允许在以太网的帧格式中插入一个 4 字节的标识符（如图 3-27 所示），称为 VLAN 标签（tag),用来指明发送该帧的计算机屈千哪一个虚拟局域网。插入 VLAN 标签的帧称为 802.l Q帧。 802.I Q帧 字节 6 6 4 2  监阳目的地址 1 源地址忙－AN标签1 类型 46~1500 4  数据 l42」 100勹芷芒。 OOO I4 位 1 标签2二 • 2 字节 ,· 2 字节 .  图 3-27 插入 VLAN 标签后变成了 802.I Q帧 VLAN 标签字段的长度是 4 字节，插入在以太网 MAC 帧的源地址字段和类型字段之间。 VLAN 标签的前两个字节总是设置为 Ox8100 （即二进制的 10000001 00000000), 称为 IEEE • 104 •"}
{"doc_id": "network", "page": 116, "text": "802. JQ标签类型。 VLAN 标签的后两个字节中，前面 4 位实际上并没有什么作用，这里不 讨论，后面的 l2 位是该虚拟局域网 VLAN 标识符 YID (YLAN ID), 它唯一地标志了 802.l Q帧屈于哪一个 VLAN 。 12 位的 YID 可识别 4096 个不同的 VLAN 。插入 VLAN 标签 后， 802.I Q帧最后的帧检验序列 FCS 必须重新计绊。 当数据链路层检测到 MAC 帧的源地址字段后面的两个字节的值是 Ox8100 时，就知道 现在插入了 4 字节的 VLAN 标签。由于用于 VLAN 的以太网帧的首部增加了 4 个字节，因 此以太网的最大帧长从原来的 1518 字节(1 500 字节的数据加上 18 字节的首部和尾部）变 为 1522 字节。 这样的 802.I Q帧在什么地方使用呢？我们可以用图 3-28 给出的简单例子来说明。交换 机＃ l 连接了 7 台计算机，组成了一个局域网（一个广播域）。现在把局域网划分为两个虚拟 局域网 YLAN-10 和 VLAN-20 。这里的 IO 和 20 是虚拟局域网的编号，由交换机管理人员设 定。这个编号就是图 3-27 中的 VlD 字段的值。 标准的 以太网帧 . 交换机＃ I I 汇聚链路． 交换机＃2 ····~  接入链跻7子干片＼＼／界气·＼ 插犬标记 '』·I ·～片、 A·一尸～ 1 至兰兰兰／：玉之兰扫王的802.I Q帧｛ ＝已＝釭 ＼、心．．～9~．一－·一，叉－巴'') \\.I... -~/  VLAN-10 VLAN-20 VLAN-10 VLAN-20  图 3-28 利用以太网交换机构成虚拟局域网 现在我们有了两个较小的广播域。每台计算机都是通过接入链路(access l i nk) 连接到以 太网交换机的。管理人员划分虚拟局域网的方法有多种。例如，按交换机的端口划分，或按 MAC 地址划分。每台主机并不知道自己的 VID 值（但交换机必须知道这些信息）。这些主 机通过接入链路发送到交换机的帧都是标准的以太网帧． 在一个用多个交换机连接起来的较大的局域网中，可以灵活地划分虚拟局域网，不受 地理位笠的限制。一个虚拟局域网的范围可以跨越不同的交换机。当然，所使用的交换机必 须要能够识别和处理虚拟局域网。在图 3-28 中，在另外一层楼的交换机＃2 连接了 5 台计算 机，并与交换机＃ 1 相连接。交换机＃2 中的两台计算机加入到 VLAN-10, 而另外 3 台加入到 VLAN-20 。这两个虚拟局域网虽然都跨越了两个交换机，但都各自是一个广播域。 连接两个交换机端口之间的链路称为汇聚链路(trunk l i nk) 或干线链路。 现在假定 A 向 B 发送帧。由于交换机＃ 1 能够根据帧首部的目的 MAC 地址，识别 B 屈 千本交换机管理的 VLAN-10, 因此就像在普通以太网中那样直接进行帧的转发，不需要使 用 VLAN 标签。这是最简单的情况。 现在假定 A 向 E 发送帧。交换机＃ 1 查到 E 并没有连接到本交换机，因此必须从汇聚链 路把帧转发到交换机＃2, 但在转发之前，要插入 VLAN 标签。不插入 VLAN 标签，交换机 #2 就不知道应把帧转发给哪一个 VLAN 。因此在汇聚链路传送的帧是 802.I Q帧。交换机＃2 在向 E 转发帧之前，要拿走已插入的 VLAN 标签，因此 E 收到的帧就是 A 发送的标准以太 网帧，而不是 802.l Q帧。图 3-28 说明了这种情况。 如果 A 向 C 发送帧，情况又怎样呢？这种情况就复杂些了，因为这是在不同网络之间 的通信。虽然 A 和 C 都连接到同一个交换机，但它们已经处在不同的网络中 CVLAN-10 和 • 105 •"}
{"doc_id": "network", "page": 117, "text": "VLAN-20) 。这问题是互连网络中的通信问题，已经超过了个染数据链路层的范即。这要由 屈千上面的网络层中的路山器来解决。 不过有的交换机中嵌入了一个川专用芯片构成的转发模块，用来在不同的 VLAN 之间 转发帧。这样就可以不必再使用另外的路由器，而就在交换机中实现了第 3 层的转发功能 （由于使用硬件转发，转发帧的速率捉高了，比使用路由器要快）。这种转发功能被称为第 3 层交换，而这种交换机常称为 L3/L2 交换机。 有了这种第 3 层交换机，连接到个同交换机的 A 和 F, 都能不需要经过另外的路由器 而相互通信。更详细的转发过程这里就不继续讨论了。 3.5 高速以太网 随莽电子技术的发展，以太网的速率也不断提升。从传统的 10 Mbit/s 以太网一直发展 到现在常用的速率为 l Gb it/s 的吉比特以太网，甚至更快的以太网。下面简单介绍几种高速 以太网技术。 3.5. l lOOBASE-T 以太网 IOOBASE-T 是在双绞线上传送 100 Mbit/s 基带信号的星形拓扑以太网，仍使用 IEEE 802 .3的 CSMA/CD 协议，它又称为快速以太网(Fast Etherne t)。用户只要使用 100 Mbit/s 的适配 器和 100 Mbit/s 的菜线器或交换机，就可很方便地由 IOBASE-T 以太网直接升级到 100 Mbit/s,  而不必改变网络的拓扑结构。所有在 IOBASE-T 上的应用软件和网络软件都可保待不变。 IOOBASE-T 的适配器有很强的自适应性，能够自动识别 10 Mb it/s 和 100 Mbit/s 。 1995 年 IEEE 已把 lOOBASE-T 快速以太网定为正式标准<I EEE 802.3u), 是对现行的 IEEE 802.3 标 准的补充。 IOOBASE-T 可使用以太网交换机提供很好的服务质菌，可在全双工方式下工作而无冲 突发生。因此， CSM A/CD 协议对全双工方式工作的快速以太网是不起作用的（但在半双工 方式工作时则一定要使用 CSMA/CD 协议）。快速以太网使用的 MAC 帧格式仍然是 IEEE 802.3 标准规定的帧格式。 然而 IEEE 802.3u 的标准未包括对同轴电缆的支持。这意味着想从细缆以太网升级到快 速以太网的用户必须重新布线。因此，现在 I 0/1 00 Mbit/s 以太网都使用无屏蔽双绞线布线。 100 Mb it/s 以太网的新标准改动了原 10 Mb it/ s 以太网的某些规定。我们知道，以太网有 一个重要的参数 a, 它必须保持为很小的数值。在 3.3 .4节将给出了参数 a 的公式(3-2): a=- (3-2)  飞 这里 T 是以太网单程端到端时延， T。是帧的发送时间。我们知道， T。是帧长与发送速率 之比，可见为了保待参数 a 不变，可以使 T 与发送速率的乘积不变。在帧长一定的条件下， 若数据率提高到 10 倍，可把网络电缆长度（因而使 T) 减小到原有数值的十分之一。 在 100 Mb it/s 的以太网中采用的方法是保持最短帧长不变，对千铜缆 100 Mbit/s 以太网， 一个网段的最大长度是 100 m, 其最短帧长仍为 64 字节，即 512 比特。因此 100 Mbit/s 以 太网的争用期是 5 l2µs ，帧间最小间隔现在是 0.96 µs, 都是 10 Mbit/s 以太网的 1/10 。 • l 06 •"}
{"doc_id": "network", "page": 118, "text": "表 3-1 是 100 Mbit/s 以太网的新标准规定的三种不同的物理层标准。 表 3-1 100 Mbi Us 以太网的物理层标准 名称 媒体 网段母大长度 特点 IOOBASE-TX 铜缆 IOOm 两对 UTP5 类线或屏蔽双绞线 STP IOOBASE-T4 铜缕 IOOm 4 对 UTP3 类线或 5 类线 IOOBASE-FX 光缆 2000m 两根光纤．发送和接收各用一根 在标准中把上述的 IOOBASE-TX 和 lOOBASE-FX 合在一起称为 IOOBASE-X 。 IOOBASE-T4 使用 4 对 UTP 3 类线或 5 类线时，使用 3 对线同时传送数据（每一对线以 331 Mb it/s 的速率传送数据），用 1 对线作为碰撞检测的接收信道。 3.5.2 吉比特以太网 IEEE 在 1997 年通过了吉比特以太网的标准 802.32, 并在 1998 年成为正式标准。几年 来，吉比特以太网迅速占领了市场，成为以太网的主流产品。 吉比特以太网的标准 IEEE 802.32 有以下几个特点： (l) 允许在 I Gb it/s 下以全双工和半双工两种方式工作。 (2) 使用 IEEE 802.3 协议规定的帧格式。 (3) 在半双工方式下使用 CSMA/CD 协议，而在全双工方式不使用 CSMA/CD 协议。 (4) 与 IOBASE-T 和J OOBASE-T 技术向后兼容。 吉比特以太网可用作现有网络的主干网，也可在高带宽（高速率）的应用场合中（如 医疗图像或 CAD 的图形等）用来连接计算机和服务器。 吉比特以太网的物理层使用曲种成熟的技术：一种来自现有的以太网，另一种则是美 国国家标准协会 ANSI 制定的光纤通道 FC (Fibre Channel) 。采用成熟技术就能大大缩短吉比 特以太网标准的开发时间。 表 3-2 是吉比特以太网的物理层的标准。 表 3-2 吉比特以太网物理层标准 名称 媒体 网段碌大长度 特点 IOOOBASE-SX 光缆 550 m 多模光纤 (50 和 62.5 pm)  IOOOBASE-LX 光级 5000 m 单模光纤 (10 µm) 多模光纤（ 50 和 62.5 µm)  IOOOBASE-CX 铜缆 25 m 使用 2 付屏蔽双绞线电缆 STP IOOOBASE-T 铜缆 100 111 使用 4 对 UTP5 类线 现在 IOOOBASE-X （包括表 3-2 中的前三项）的标准是 IEEE 802.3z, 而 IOOOBASE-T 的标准是 IEEE 802.3ab 。 吉比特以太网工作在半双工方式时，就必须进行碰撞检测。由于数据率提岛了，因此 只有减小砐大电缆长度或增大帧的最小长度，才能使参数 a 保持为较小的数值。若将吉比特 以太网最大电缆长度减小到 10 m, 那么网络的实际价值就大大减小。而若将最短帧长提高 到 640 字节，则在发送短数据时开销又太大。因此，吉比特以太网仍然保持一个网段的最大 长度为 100 m, 但采用了＂载波延伸 ”(carr i er ex tens i on) 的办法，使最短帧长仍为 64 字节 • 107 •"}
{"doc_id": "network", "page": 119, "text": "（这样可以保持兼容性），同时将争用期增大为 512 字节。凡发送的 MAC 帧长不足 512 字 节时，就用一些特殊字符埴充在帧的后曲，使 MAC 帧的发送长度增大到 512 字节，这对有 效载荷 1 并无影响。接收端在收到以太网的 MAC 帧后，要把所填充的特殊字符删除后才 向高层交付。当原来仅 64 字节长的矫帧填充到 512 字节时，所埴充的 448 字节就造成了很 大的开销。 为此，吉比特以太网还增加了一种功能称为分组突发(packet burs ti n g)。这就是当很多短 帧要发送时，第一个短帧要采用上面所说的载波延伸的方法进行填充。但随后的一些短帧则 可一个接一个地发送，它们之间只布留有必要的帧间最小间隔即可。这样就形成一串分组的 突发，直到达到 1500 字节或稍多一些为止。当吉比特以太网工作在全双工方式时（即通信 双方可同时进行发送和接收数据），不使用载波延伸和分组突发。 吉比特以太网交换机可以直接与多个图形工作站相连，也可用作百兆以太网的主干网， 与百兆比特或吉比特交换机相连，然后再和大型服务器迕桵在一起。图 3-29 是吉比特以太 网的一种配置举例。 中央服务器 一 I Gb it/s 链路 I 1  一t一t一 I• 一1 I I I. I  二＝＝ ＝兰 图 3-29 吉比特以太网的配置洋例 3.5.3 10 吉比特以太网（ lOGbE) 和更快的以太网 IOGbE 并非把吉比特以太网的速率简单地提高到 10 倍，因为还有许多技术上的问题要 解决。下面是 IOGbE 的主要特点。顺便指出， 10 吉比特就是 10 x 109 比特，有人愿意称之 为“万兆比特＂。虽然“万”是中国的一种常用的计柲单位，但这与国际上通用的表示方法 不一致，因此本书不予采用。 IOGbE 的帧格式与 IO Mbit/s, I 00 Mb it/s 和 I Gbit/s 以太网的帧格式完全相同，并保留 了 802.3 标准规定的以太网最小帧长和最大帧长。这就使用户在将其已有的以太网进行升级 时，仍能和较低速率的以太网很方便地通信。 IOGbE 只工作在全双工方式，因此不存在争用问题，当然也不使用 CSMA/CD 协议。 这就使得 IOGbE 的传输距离大大提高了（因为不再受必须进行碰撞检测的限制）。 ＠注有效载荷(pay load) 是个很常用的名词，它长小（1: ，个分组中．去掉首部和尾部（如果打尾部的话）的控制字段后， 剩下的布/Tl的数据部分。显然在小同从次中，行效载荷所代 1之的内容足不一样的。例如，数枫链路层·一个帧的有效载荷，就包 含（网络层 lP 数据报的 IP 竹部和数据部分．而从网络从.£.,只有 IP 数据报中的数踞部分． A足网络层 IP 数据报的有效载荷． 如果 IP 数据报中的数据是运输臣的 TCP 报文段，那么从运输）丢石．其有效载荷只是运输扂 TCP 报文段中的数据部分（要把 TCP(内首部去除）。 • 108 •"}
{"doc_id": "network", "page": 120, "text": "表 3-3 是 IOGbE 的物理层标准。 表 3-3 10GbE 的物理层标准 名称 媒体 网段碌大长度 特点 JOGBASE,-SR 光缆 300m 多桢光纤 c 0.85.l1111)  IOGBASE-LR 光缆 10km '1，f莫光纤 (I 3 µ111>  IOGRASE-ER 光缆 40km ,全t栈光纤(1. 5 (1111)  IOGBASE-CX4 铜绞 15111 使用 4 付从芯同纳 1 1!究 (1w111ax) IOGBASE-T 铜缨 100m 使用 4 对 6A 类 UTP IJ.纹线 表 3-3 中的前二项的标准是 IEEE 802.3ae, 在 2002 年 6 月完成。第四项的标准足 IEEE 802.3ak, 完成于 2004 年。报后一项的标准是 IEEE 802.3an, 完成卜 2006 年。 以太网的技术发展得很快。在 lOGbE 之后又制定了 40GbE/100GbE （即 40 者比特以人 网和J OO 吉比特以太网）的标准 IEEE 802.3ba-2010 和 802.3bm-2015 。表 3-4 足 40GbE 和 IOOGbE 的物理层名称及传输距离，其中有两项带＊号的是 802.3bm 提出的。 表 3-4 40GbE/1 OOGbE 的物理层标准 物理层 40GbE 100GbE  在背板上传输个．少超过 Im 40GBASE-KR4  在铜缆上传输．在少超过 7m 40GBASE-CR4 I OOGIJASE-CR I 0  在多橾光纤上传输．全少 100m 40GBASE-SR4 IOOGBASE-SR 10. • IOOGB/\\SE-SR4  在单侯光纤 l．传输至少 10km 40GBASE-LR4 IOOGBASE-l. R4  在单侯光纤上传输至少 40km *40GBASE-ER4 IOOGBASE-ER4  需要指出的是， 40GbE/ JO OGbE 以太网只工作在全双工的传输方式（因而不使川 CSM A/CD 协议），并且仍然保持f以太网的帧格式以及 802.3 标准规定的以人网垃小和砓大 帧长。 IOOGbE 在使用单模光纤传输时，仍然可以达到 40 km 的传输距离，，但这伽要汲分复 用（使用 4 个波长复用一根光纤，每一个波长的有效传输速率是 25 Gb it/s) 。 由千大型数据中心迫切需耍非常高速的数据传送，在 2017 年 12 月，史高速率的以太 网标准颁布了，这就是 IEEE 802.3bs 标准，共有两种速率，即 200GbE （速率为 200 Gbit/s)  和 400GbE （速率为 400 Gb it/s), 全部用光纤传输（单模和多模）。根据仕输力式的不同， 传输距离从 100 m 至 10 km 不等。今后还会有史快的以太网问世。 现在以太网的工作范围已经从局域网（校园网、企业网）扩大到城域网和 1' 域网，从 而实现了端到端的以太网传输。这种工作方式的好处是： (1) 以太网是一种经过实践证明的成熟技术，无论是互联网服务提供者 ISP 还足端用户 都很愿总使用以太网。当然对 [SP 来说，使用以太网还需要在更人的范 11风的试验。 (2) 以太网的互橾作性也很好，不同厂商生产的以太网都能可靠地进 1 j仕橾作。 (3) 在广域网中使用以太网时，其价格大约只有同步光纤网 SONET 的五分之－。以太 网还能够适应多种传输媒体，如铜缆、双绞线以及各种光缆。这就使贝竹不回传输媒体的用 户在进行通信时小必重新布线。 (4) 端到端的以太网连接使帧的格式全都是以太网的格式，而不需攷冉进 1 」 11 块的格式转 换，这就简化了橾作和管理。 以太网从 10 Mb it/s 到 10 Gb it/s 甚至到 400 Gb it/s 的演进，证明f以太网是： • I 09 •"}
{"doc_id": "network", "page": 121, "text": "(I) 可扩展的（速率从 10 Mbit/s 到 400 Gbit/s) 。 (2) 灵活的（多种媒体、全／半双工、共享／交换）。 (3) 易千安装的。 (4) 稳健性好的。 3.5.4 使用以太网进行宽带接入 现在人们也在使用以太网进行宽带接入互联网。为此， IEEE 在 2001 年初成立了 802.3EFM 工作组，专门研究高速以太网的宽带接入技术问题。 以太网接入的一个重要特点是它可以提供双向的宽带通信，并且可以根据用户对带宽 的需求灵活地进彴带宽升级（例如，把 10 兆的以太网交换机更新为吉比特的以太网交换机）。 当城域网和广域网都采用吉比特以太网或 10 吉比特以太网时，采用以太网接入可以实现端 到端的以太网传输，中间不需要再进行帧格式的转换。这就提高了数据的传输效率且降低了 传输的成木。 然而以太网的帧格式标准中，在地址字段部分并没有用户名字段，也没有让用户键入 密码米鉴别用户身份的过程。如果网络运营商要利月」以人网接入到．仕联网，就必须解决这个 问题。 I 是有人就想法子把数据链路层的两个成功的协议结合起来，即把 PPP 协议中的 PPP 帧再封装到以太网中来传输。这就是 1999 年公布的 PPPoE (PPP over Etherne t),悠思是“在 以太网 I运行 PPP\" [RFC 2516] 。现在的光纤宽带接入 FTTx 都要使用 PPPoE 的方式进行接 入。 例如，如果使用光纤到大楼 FTTB 的方案，就在旬个大楼的楼口安装一个光网络单元 ONU （其作用和以太网交换机芬不多），然后根据用户所小请的带宽，用 5 类线（请注，意， 到这个地力，传输媒体已经变为铜线了）接到用户家中。如果大楼里上网的用户很多，那么 还可以在匈一个楼层再安装一个 100 Mb it/s 的以太网交换机。各大楼的以太网交换机通过光 缆汀接到光汇桵点（光汇接点一般通过城域网连接到互联网的主干网）。 使用这种方式接入到互联网时，在用户家中不再需要使用任何调制解调器，只要一个 RJ -45 的插门即可。用户把自己的个人电脑通过 5 类网线连接到墙上的 RJ-45 插口中，然后 在 PPPoE 弹出的窗口中键入在网络运营商处购买的用户名（就是一串数字）和密码（严格 说就足口令），就可以进行宽带上网了。请注意，使用这种以太网宽带桵入时，从用户豖中 的个人屯脑到户外的第一个以太网交换机的带宽是能够得到保证的。因为这个带宽是用户独 占的，没有和其他用户共享。但这个以太网交换机到上一级的父换机的带宽，是许多用户共 享的。因此，如果过多的用户同时上网，则有可能使每一个用户实际上享受到的带宽减少。 这时，网络运营倘就应当及时进行扩容，以保证用户的利益才、受损伤。 顺便指出，当用户利用 ADSL （非对称数字用户线）进行宽带卜网时，从川户个人电脑 到豕中的 ADSL 调制解调器之间，也是使用 RJ -45 和 5 类线（即以太网使用的网线）进行连 Q) it: iill伈网的数宁化是从主干网丿f始的，蚊后剩下的一段校拟线路是川户线，闪此这段用户线常称丿J丛通估线路数字 化过程小的＇．从1,7 分足，I'.＂。 IEEE 802.3EFM 中的 “EFM.. 表小 “E1hcmc1 in the 几rs t M i le'', 总思是从出）习如 1始 n-.“ 第一关甩 采川以人网”，也就足说， EFM 表示“采用以太网接入“· • 110 •"}
{"doc_id": "network", "page": 122, "text": "接的，并且也是使用 PPPoE 弹出的窗口进行拨号连接的。但是用户个人电脑发送的以太网 帧到了家里的 ADSL 调制解调器后，就转换成为 ADSL 使用的 PPP 帧。盂要注意的是，在 用户家中墙上是通过电话使用的 RJ -11 插口，用普通的电话线传送 PPP 帧。这已经和以太 网没有头系了。所以这种上网方式不能称为以太网上网，而是利用电话线宽带接入到互联网。 本章的重要概念 • 链路是从一个节点到相邻节点的一段物理线路，数据链路则是在链路的尪础上增加 了一些必要的硬件（如网络适配器）和软件（如协议的实现）。 • 数据链路层使用的信道主要有点对点信道和广播信道两种。 • 数据链路层传送的协议数据单元是帧。数据链路层的三个基本问题是：封装成帧、 透明传输和差错检测。 • 循环冗余检验 CRC 是一种检错方法，而帧检验序列 FCS 是添加在数据后面的兀余码。 • 点对点协议 PPP 是数据链路层使用最多的一种协议，它的特点是：简单；只检测 差错，而不是纠正差错；不使用序号，也不进行流址控制；可同时支持多种网络层 协议。 • PPPoE 是为宽带上网的主机使用的链路层协议。 • 局域网的优点是：具有广播功能，从一个站点可很方便地访问全网：便千系统的扩 展和逐渐演变；提高了系统的可靠性、可用性和生存性。 • 共享通信媒体资源的方法有二：一是静态划分信道（各种复用技术），二是动态媒 体接入控制，又称为多点接入（随机接入或受控接入）。 • IEEE 802 委员会曾把局域网的数据链路层拆成两个子层，即逻铝链路控制 (LLC) 子层（与传输媒体儿关）和媒体接入控制 (MAC) 子层（与传输媒体有关）。但现 在 LLC 子层已成为历史。 • 计算机与外界局域网的通信要通过网络适配器，它又称为网络接口卡或网 I：：：。计算 机的硬件地址就在适配器的 ROM 中。 • 以太网采用无连接的工作方式，对发送的数据帧不进行编号，也不要求对力发回确 认。目的站收到有光错帧就把它丢弃，其他什么也不做。 • 以太网采用的协议是具有冲突检测的载波监听多点接入 CSMA/CD 。协议的要点是： 发送前先监听，边发送边监听，一旦发现总线上出现了碰撞，就立即停止发送。然 后按照退避算法等待一段随机时间后再次发送。因此．每一个站在自已发送数据之 后的一小段时间内，存在若遭遇碰撞的可能性。以太网上各站点都平等地争用以太 网信道。 • 传统的总线以太网基本上都是使用栠线器的双绞线以太网。这种以太网在物理上是 星形网，但在逻辑上则是总线网。集线器 T仆作在物理层，它的每个端口仅仅简单地 转发比特，不进行碰撞检测。 • 以太网的硬件地址，即 MAC 地址实际上就是适配器地址或适配器标识符，与主机 所在的地点无关。源地址和目的地址都是 48 位长。 • 以太网的适配器有过滤功能，它只接收单播帧、广播帧或多播帧。 • 使用桨线器可以在物理层扩展以太网（扩展后的以太网仍然是一个网络）。 • 交换式集线器常称为以太网交换机或第二层交换机（工作在数据链路层）。它就是 • 11 l •"}
{"doc_id": "network", "page": 123, "text": "个多端 I1 的网桥， r而每个端口都直接与某台单主机或另一个集线器相连，且工作 在全双 L 力式。以太网交换机能同时连通许多对端口，使匈一对相互通信的主机都 能像独占通伈媒体那样，无碰捅地传输数据。 . 凸速以人网有 100 Mb it/s 的快速以太网、吉比特以太网和 IO Gbit/s 的 10 吉比特以 太网户砐心还发展到 400 吉比特以人网。在宽带接入技术中，也常使用商速以太网 进 1-J桵入。 习题 3-01 故拟链路（即逻辑链路）与链路（即物理链路）有何区别？ “链路接通了”与“数 剒链路俀逌j/\"的权别何在？ 3-02 奻拒链路）昙中的链路控制包括哪些功能？试讨论数据链路层做成可靠的链路层有哪 此优点和缺点。 3-03 网络适配器的作用是什么？网络适配器工作在哪一层？ 3-04 奻拟链路层的一．个基本问题（封装成帧、透明传输和兑错检测）为什么都必须加以 韶决？ 3-05 如果在故据链路层不进行封装成帧，会发生什么问题？ 3-06 PPP 协议的：：：「要特点是什么？为什么 PPP 不使用帧的编写？ PPP 适用千什么情况？ 为什么 PPP 协议不能使数据链路层实现可靠传输？ 3-07 牧发送的数踞为 llOIOIIOII 。采用 CRC 的生成多项式是 P(X) = X + X + I 。试求应 ．你加在奻据后曲的余数。 名耍友送的数据在传输过程中最后一个 1 变成了 O, 即变成了 1101011010, 问接收端 能否及现？ 若收发送的数批在传输过程中最后两个 1 都变成了 O, 即变成了 1 I O I O 11 000, 问接收 端能否发现？ 采川 CRC 检验丿石，数据链路层的传输是否就变成了可靠的传输？ 3-08 婓发送的数摒为 101110 。采用 CRC 的生成多项式是 P(X) = X3 + I 。试求应添加在数 捉丿5 曲的余数。 3-09 个 PPP 帧的数据部分（用十六进制写出）是 7D 5E FE 27 7D 5D 7D 5D 65 7D 5E 。 试 I·, 们如1·的数朊是什么（用十六进制写出） ?  3-10 PPP 协议使川同步传输技术传送比特串 0110 111 I I I 111 I 00 。试问纾过零比特填充后变 成怎样的比特串？名接收端收到的 PPP 帧的数据部分是 000 I I 1 0 I I I 1 IO 11 11 IO 110,  试问删除发送端加入的冬比特后会变成怎样的比特串？ 3-1) 试分别讨论以下各种情况在什么条件下是透明传输，在什么条件下不是透明传输。 （提小：悄弄清什么是“透明传输“，然后考虑能否满足其条件。） (1) 将迫的屯话迪信。 (2) I I联网捉供的电子邮件服务。 3-12 PPP 协议的 1 一作状态有哪几种？当用户要使用 PPP 协议和 ISP 建立连接进行通信时， 出收建汀哪儿种连接？每一种连接解决什么问题？ 3-13 )11) 域网的卞要特点是什么？为什么局域网采用广播通信方式曲广域网不采用呢？ 3-14 花川的忖域网的网络拓扑有哪些种类？现在最流行的是哪种结构？为什么早期的以 • 112 •"}
{"doc_id": "network", "page": 124, "text": "太网选择总线拓扑结构而不使用星形拓扑结构，但现在却改为使用星形拓扑结构呢？ 3-15 什么叫作传统以太网？以太网有哪两个主要标准？ 3-16 数据率为 10 Mb it/s 的以太网在物理媒体上的码元传输速率（即码元／秒）是多少？ 3-17 为什么 LLC 子层的标准己制定出来了但现在却很少使用？ 3-18 试说明 IOBASE-T 中的 “10\" \"BASE\" 和 “T\" 所代表的意思。 3-J9 以太网使用的 CSMA/CD 协议是以争用方式桵入到共享信逆的，这与传统的时分复 用 TDM 相比有何优缺点？ 3-20 假定 I km 长的 CSMA/CD 网络的数据率为 I Gb it/s 。设信号在网络上的传播速率为 200000 km/s 。求能够使用此协议的最短帧长。 3-21 什么叫作比特时间？使用这种时间单位有什么好处？ 100 比特时间是多少微秒？ 3-22 假定在使用 CSMA/CD 协议的 10 Mb it/s 以太网中某个站在发送数据时检测到碰撞， 执行退避算法时选择了随机数 r = 100 。试问这个站需婓等待多长时间后才能再次发 送数据？如果是 100 Mb it/s 的以太网呢？ 3-23 公式 (3-3) 表示，以太网的极限信道利用率与连接在以太网上的站点数无关。能否由 此推论出：以太网的利用率也与连接在以太网士的站点数无关？请说明你的理由。 3-24 假定站点 A 和 B 在同一个 10 Mbit/s 以太网网段上。这两个站点之间的传播时延为 225 比特时间。现假定 A 开始发送一1侦并且在 A 发送结束之前 B 也发送一帧。如 果 A 发送的是以太网所容许的最短的帧，那么 A 在检测到和 B 发生碰撞之前能否把 自己的数据发送完毕？换言之，如果 A 在发送完毕之前并没有检测到碰撞，那么能 否肯定 A 所发送的帧不会和 B 发送的帧发生碰撞？ （提示：在计算时应当考虑到每 一个以太网帧在发送到信道上时，在 MAC 帧前面还要增加若干字节的前同步码和帧 定界符。） 3-25 上题中的站点 A 和 B 在 I = 0 时同时发送了数据帧。当 I = 225 比特时间， A 和 B 同 时检测到发生了碰撞，并且在t = 225 + 48 = 273 比特时间完成了干扰信号的传输。 A 和 B 在 CSMA/CD 算法中选择不同的 r 值退避。假定 A 和 B 选择的随机数分别是 rA =O 和 r8 = I 。试间 A 和 B 各在什么时间开始亟传其数据帧？ A 巫传的数据帧在什么 时间到达 B? A 重传的数据会不会和 B 重传的数据再次发生碰撞？ B 会不会在预定的 重传时间停止发送数据？ 3-26 以太网上只有两个站，它们同时发送数据，产生了碰撞。于是按截断二进制指数退 避算法进行重传。重传次数记为i, i= 1,2,3,... 。试计算第 1 次重传失败的概率、第 2 次重传失败的概率、第 3 次重传失败的概率，以及一个站成功发送数据之前的平均 重传次数 I 。 3-27 有 10 个站连接到以太网上。试计算以下三种情况下每一个站所能得到的带宽。 (I) 10 个站都连接到一个 LO Mbit/s 以太网集线器： (2) 10 个站都连接到一个 100 Mb it/ s 以太网集线器； (3) 10 个站都连接到一个 10 Mbit/s 以太网交换机。 3-28 IO Mb it/s 以太网升级到 100 Mbit/s 、 I Gb it/s 和 10 Gb it/s 时，都需要解决哪些技术问 题？为什么以太网能够在发展的过程中淘汰掉自己的竞争对手，并使自己的应用范 围从局域网一直扩展到城域网和广域网？ 3-29 以太网交换机有何特点？用它怎样组成虚拟局域网？ • 113 •"}
{"doc_id": "network", "page": 125, "text": "3-30 在图 3-30 中，某学院的以太网交换机有二个端口分别和学院三个系的以太网相连， 另外三个端口分别和电子邮件服务器、万维网服务器以及一个连接互联网的路由器 相连。图中的 A, B 和 C 都是 100 Mb it/s 以太网父换机。假定所有的链路的速率都是 100 Mbit/s, 并且图中的 9 台主机中的任何一个都可以和任何一个服务器或主机通信。 试计算这 9 台主机和两个服务器产生的总的吞吐量的最大值。为什么？ 万维网＿ 服务器＝ 电了邮件竺 服务器＿ 图 3-30 习题 3-30 的图 3-31 假定图 3-30 中的所有链路的速率仍然为 100 Mbit/s, 但三个系的以太网交换机都换成 为 100 Mbit/s 的媒线器。试计符这 9 台主机和两个服务器产生的总的吞吐她的最大值。 为什么？ 3-32 假定图 3-30 中的所有链路的速率仍然为 100 Mb it/s, 但所有的以太网交换机都换成为 JOO Mbit/s 的集线器。试计算这 9 台主机和两个服务器产生的总的吞吐矗的最大值。 为什么？ 3-33 在图 3-31 中，以太网交换机有 6 个端口，分别接到 5 台主机和一个路由器。 ,_J,E .  图 3-31 习题 3-33 的图 在下面表中的“动作“一栏中，表示先后发送了 4 个小贞。假定在开始时，以太网交换 机的交换表是空的。试把该表中其他的栏目都填写完。 动作 交换表的状态 向哪些端口转发帧 说明 A 发送帧给 D D 发送帧给 A E 发送帧给 A A 发送帧给 E • 114 •"}
{"doc_id": "network", "page": 126, "text": "第 4 章网络层 本棠讨论网络互连问题。在介绍网络层提供的两种服务和两个层面后，就进入木革的 核心内容一网际协议 IP, 这是本书的一个重点内容。只有深入地掌握了协议 IP 的主婓内 容，才能理解互联网是怎样工作的。本竞还要讨论网际控制报文协议 ICMP 、几种常用的路 巾选择协议、 1Pv6 的主要特点、 IP 多播的概念等。在讨论虚拟专用网 VPN 和网络地址转换 NAT 后，砐后简单介绍多协议标签交换 MPLS 和软件定义网络 SDN 的基本概念。 本草最重要的内容是： (I) 庙拟杠连网络和两种服务、两个层面的概念。 (2) IP 地址与 MAC 地址的关系。 (3) 传统分类的 IP 地址和无分类域间路由选择 CIDR （后者是重点）。 (4) 路巾选择协议的工作原理。 4.1 网络层的几个重要概念 4.1.1 网络层提供的两种服务 在计算机网络领域，网络层应该向运输层提供怎样的服务(“面向连接”还是“无连 接”)竹引起了长期的争论。争论焦点的实质就是：在计算机通信中，可靠交付应当由谁来 负页？是网络还是端系统？ 有些人认为应当借助于电信网的成功经验，让网络负贡可靠交付。大家知道，传统电 伈网的主要＼IV 务是提供电话服务。电信网使用昂贵的程控交换机（其软件也非常复杂），用 面向连接的通信方式，使电估网络能够向用户（实际上就足电话机）提供可靠传输的服务。 因此他们认为，计算机网络也应模仿打电话所使用的面向连桵的通信方式。当两台计贺机进 行通信时，也应当先建立连接（但在分组交换中是建立一条虚电路 YC (Yi11ual Circuit)\"),  以预留双方通亿所盂的一切网络资源。然后双方就沿肴已建立的虚电路发送分组。这样的分 组的首部不布耍填写完整的目的主机地址，而只盂要填写这条虚电路的编号（一个个大的整 数），因曲减少了分组的开销。这种通信力式如果再使用可靠传输的网络协议，就可使所发 送的分组无差错按序到达终点，当然也不丢失、不乎复。在通信结束后要释放建立的虚电路。 图 4-1 (a) 是网络提供虚电路服务的示意图。主机 H1 和 H2 之间交换的分组都必须在事先建立 的虚电路上传送。 但互联网的先驱者却提出一种崭新的网络设计思路。他们认为，电估网提供的端到端 可靠传输的服务对传统的电话业务无疑是很合适的，因为那时电信网的终端（电话机）非常 Q) i.:I; 虚电路！之示这只是条逻仇上的连接．分组都沿片这妖逻紨连接（好像是一条物理连接）按照仵储转发｝i式传这， 面并不是真正建立了一条物开迕搂．访汴慈．电路交换的电话通伯是先建、，f了一条贞正的连搂。因此分组交换的虚迕接和电路交 换的连接只是类似而已．片个儿全样． • 115 •"}
{"doc_id": "network", "page": 127, "text": "简单，没有智能，更没有差错处理能力。因此电信网必须负责把用户电话机话筒产生的话音 信号可靠地传送到对方的电话机，使其耳机发出的声音符合话音质堡的技术规范要求。但计 算机网络的端系统是有智能的计算机。计算机有很强的养错处理能力（这点和传统的电话机 有本质上的差别）。因此，互联网在设计上就采用了和电信网完全不同的思路。 互联网采用的设计思路是这样的：网络层要设计得尽量简单，向其上层只提供简单灵 活的无连接的、尽最大努力交付的数据报服务°。这里的“数据报 ”(data gram) 是互联网 的设计者最初使用的名词，其头数据报（或 lP 数据报）就是我们经常使用的“分组”。在本 书中， IP 数据报和 IP 分组是同义词，可以混用。 网络在发送分组时不需要先建立连接。每一个分组（也就是 lP 数据报）独立发送，与 其前后的分组无关（不进行编号）。网络层不提供服务质量的承诺。也就是说，所传送的分 组可能出错、丢失、重复和失序（即不按序到达终点），当然也不保证分组交付的时限。由 于传输网络不提供端到端的可靠传输服务，这就使网络中的路由器比较简单，且价格低廉 （与电信网的交换机相比较）。如果主机（即端系统）进程之间需要进行可靠的通信，那么 就由主机中的运输层负贡（包括差错处理、流址控制等）。采用这种设计思路的好处是：网 络造价大大降低，运行方式灵活，能够适应多种应用。互联网能够发展到今日的规模，充分 证明了当初采用这种设计思路的正确性。 图 4-l(b) 给出了网络提供数据报服务的示意图。主机 H1 向 H2 发送的分组各自独立地查 找路由器中的转发表，逐跳传送到目的主机。在分组传送的过程中有丢失的可能。 Hl / \\\\\\H  (a) 虚电路服务（所有的数据都在此虚电路上传送） IP 数捉报 H~气 (b) 数据报服务（数批传这的路径足个确定的） 附 4-1 网络层提供的两种服务 OSI 体系的义持者曾极力主张在网络层使用可靠传输的虚电路服务，也曾推出过网络层 虚电路服务的滂名标准一ITU-T 的 X.25 建议书。但现在 X.25 早已成为历史文献了。 表 4-1 归纳了虚电路服务与数据报服务的主要区别。 (i)注：尽奻大努力交付(bes t efTon del i ve ry)寸＇，然 4浓示路山器 nJ以任意工ft.分组，但这种交付方式实质上就是不可靠交付． 顺便提·下．文献中也常使用“尽力而为＂的详名。这个计名固然较为简沾．但似不够准确． • I I 6 •"}
{"doc_id": "network", "page": 128, "text": "表 4-1 虚电路服务与数据报服务的对比 对比的方面 虚电路服务 数据报服务 思路 可铭迪们应吁山网络来保诽 ＂T 俅通信J、炉',1由用）＇，上机来保证 迕搂的处立 必须介 个盂·块 终点地址 仅在迕倓建,',:阶段使用．符个分组使川短的虚电路号 杆个分组邵打终点的完整地J~:.即 IP 地址 分组的转发 屈丁 lwJ -条店电路的分组均按照同寸各巾进行转发 待个分纤 l 独立介找转发｝之进行转发 •I,1节点出故悼 R·J· rfi 4 ！业过出故团的i汇山的虚电路均不能工作 出故阱i的 rJ.,'i可能会丿．、夫分组， ·些路由可能 会发 'L 变化 分组的顺忭 总是按发达顺忭到达终点 到达终屯的糕i，个定技发送的顺l i' 哨到端的左错处跸 可以由网络负说也可以巾 HJ广 1 ..L机负价 UI}nr, i 1j l fJl Ji  和流拭控制 4.1.2 网络层的两个层面 在上面 4. 1.1节中，我们已经讲过，不同网络中的两个主机之间的通信，要经过若干个 路由器转发分组来完成，分组查找路由器中的转发表，从指明的按口转发到下 个路由器。 但转发表是怎样得出的呢？是从路由表导出的，而路山表又是由互联网中许多的路由器，按 照共同选定的路由选择协议，通过许多次的相互交换路由信息而产生的。由此可见，在路由 器之间传送的信息有以下两大类： 第一类是转发源主机和目的主机之间所传送的数据，把源中机所发送的分组，像接力 赛跑那样从一个路由器转发到下一个路山器，最后把分组传送到目的主机。 第二类则是传送路由信息，是根据路由选择协议所使用的路由算法，彼此不断地交换 路由信息分组，目的是为了在路由器中创建路山表，并由此导出为转发分组而用的转发表。 这一类信息的传送是为第一类数据的传送服务的。 用图 4-2 的方法来描述，也就是把网络层抽象地划分为数据层面（或转发层面）和控制 层面。这里所说的“层面（p lane)\" 和体系结构中的“层次(l a yer)\" 很相似，都是抽象的概念。 此处的plane 目前国内尚无标准译名，也可以译为“面”。曾有人译为“平面”，但本书不采 用这个译名，因为这容易联想到是几何学中的平面（其实与这种平面并无关联）。名词“层 面”是目前文献中通用的抽象术语。在一个路由器实体中，显然尤法看见这种抽象的层面。 路由选择一一 一己一一 一 控制历面 符让．........七 数据层面 转发表．．．►幸 聿幸圭 幸 \\ ` ! i !  一、户~\\ 阳 4-2 网络）云的数据层面和拧制层面 这两个层面的机制相差很大。在数据层面中，每一个路由器根据本路由器生成的转发 表，把收到的分组，从查找到的对应接口转发出去。为了加快转发的速率，现在的路由器通 常都采用硬件进行转发，转发一个分组的时间为纳秒 (10-9 秒）数址级。但在控制层面中的 • 117 •"}
{"doc_id": "network", "page": 129, "text": "情况则不同。一个路由器不可能独自创建出路由表。路巾器必须和相邻的路由器经常交换路 由信息，然后才能创建出本路由器的路由表。根据路由选择协议所用的路由算法计算路由要 使用软件，这就慢多了，一般是秒的数矗级。从以上所述不难石出，数据层而的问题比较单 纯，因为路由器在转发分组时，是独立地根据本路由器的转发表转发分组的，但控制层面就 比较复杂，因为路由器耍创建路由表，就必须依靠许多路由器协同动作。不同的路由选择协 议定义了不同的协同动作方式。路由器的生产厂家在制造路由器时，已经在路由器内部嵌入 了路由选择的通信模块，使得路由器之间能够按照路由选择符法进行相互之间的通估。 从互联网诞生之日起，路由器就是按照图 4-2 所示的模式工作的。本教材过去的几个版 本在讲解路由器的结构时，虽然没有使用控制层面和数躯层面的概念，但已经把路由器划分 为路由选择和分组转发两大部分。其实这两部分的位置就分别处在图 4-2 所示的控制层面和 数据层面之中。现在介绍网络层中控制层面和数据层面的概念，是因为最近在网络界提出的 软件定义网络 SDN (Software Defined Net work)', 正在对这两个层山的结构进行了亟大的改 变。 00 4-3 就是 SDN 提出的这两个层而的构成。 i 远；程控制 1 ＿＿亡一., I ~  二二～►｀－［／／：勹 ＼尸j ` ／／二－ I- 图 4-3 软件瓦义网络 SON 中的控制仄面和数据耘 IIti 我们注意到，在传统的互联网中，每一个路由器中，既有转发农义有路由选择软件，因 此在图 4-2 中所画的虚线长方形方框也强调了这个特点、。也就是说，每个路巾器中，既有数 据层面也有控制层面。但在图 4-3 所不的 SDN 结构中，所有的路由器都变简单了。路由器 中的路巾选择软件都不存在了，因此路由器之间不再相互交换路由信息。在网络的控制层面 有一个在逻辑上集中的远程控制器（但在物理上可以巾不同地点的多个服务器组成）。远程 控制器掌据各主机和整个网络的状态，能够为每一个分组计符出砐住的路由，然后在每一个 路由器中生成其正确的转发表。路由器的工作很单纯，即收到分组，查找转发表，转发分组。 这样，网络又变成为集中控制的。本米互联网是分散控制的，为什么现在又提出集中 控制呢？其实，软件定义网络 SDN 的提出，并非现在要把貉个互联网都改造为如图 4-3 所 示的集中控制模式，这是不现实的。然而在某些具体条件卜，特别是像世些大型的专用数据 中心之间的广域网，若使用 SDN 模式来建造，就可以使网络运行的效率提高，同时还可以 获得更好的经济效益。因此，建议读者关注这一新动向。在本书 4.10 节将简要介绍 SDN 。 下面我们仍然按照传统互联网的机制，陆续介绍屈于数据层而的协议JP, 然后再讨论 ＠注，和前义献 1 ．．出现的名词 SDN 淌尤公认的权威定义。而 SDN 的美文＇为法也还介另外一种，即 So 佃arc Dclincd  Network i ng,按照这种＇呀法，中文的许名似应为＇、软件定义的连网”，即灾出强 Ui f连网的力式。打虑到日前中文的文献资料都 是使用“软件定义网络＂，故本书也采用这扦的详名． • 118 •"}
{"doc_id": "network", "page": 130, "text": "属于控制层面的各种路由选择协议。 4.2 网际协议 IP 网际协议 IP (Internet Pro t ocol) 是 TCP/IP 体系中两个最主要的协议之一 [STEV94] [COME06][FOROLO], 也是显重要的互联网标准协议之一[RFC 79 l, STD5] 。网际协议 IP 又 称为 Kahn-Cerf协议，因为这个呕要协议正是 Robert Kahn 和 Vi n t Cerf二人共同研发的。这 两位学者｛J， 2004 年获得图灵奖（其地位相当于计算机科学领域的“诺贝尔奖”)。严格来说， 这里所讲的 IP 其实是 IP 的第 4 个版本，记为 lPv4 。但在讲述协议 IP 的各种原理时，常省 略 IP 后面的版本号。在后面的 4.5 节我们再介绍较新的版本 IPv6 （版本 l ~3 和版本 5 都未 曾使用过。顺便指出，所谓的 IPv9 只不过是某些人故意的炒作而已，不值一提）。 与协议 TP 配套仗用的还有亡个协议： • 地址解析协议 ARP (Address Resolution Protocol)  • 网际控制报文协议 ICMP (Internet Control Message Protocol)  • 网际组管理协议 IGMP (Internet Group Management Protocol)  本来还有一个协议叫作逆地址解析协议 RARP (Reverse Address Resolution Pro t ocol), 是和协议 ARP 配合使用的，但现在已被淘汰不使用了。 图 4-4 画出了这三个协议和网际协议 IP 的关 系。在这一层中， ARP 画在最下面＇，因为 IP 经 常要使用这个协议。 ICMP 和 IGMP 画在这一层的 上部，囚为它们要使用协议 lP 。这三个协议将在 后面陆续介绍。巾千网际协议 IP 是用来仗互连起 来的许多计算机网络能够进行通信的，因此 TCP/IP 体系中的网络层常常被称为网际层(i n ternet la y er), 或 IP 层。使用“网际层”这个名词的好处 应川丘 各种应川层协议 (f-lTTP. FTP, SMTP 等） 运输层 TCP, UDP  I 匡匡 网络层 （网际层） I  IP  巨 网络接口层 与各种网络接门 物理硬件 :........................................... :  图 4-4 网际协议 IP 及其配套协议 是强调了这是由很多网络构成的且连网络。目前比较普遍使用“网络层”这个名词。 在讨论网际协议 IP 之前，必须了解什么是虚拟互连网络。 4.2.1 虚拟互连网络 我们知道，如果要在全世界范围内把数以白万计的网络都互连起来，并 且能够互相通信，那么这样的任务一定非常复杂。其中会遇到许多需要解决 的问题，如： 们一打 视频讲解 (i)注 缸i联网 1，J浦中． ARP 陂列入链路层协议 [RFC 1122, STD3), 闪此付些教和书就把 ARP 放在链路层中介绍 [COME06) (STEV94) [KURO I 7] 。但足 ARP 并不知迨自己是处在协议栈的哪，肛从程序调用的关系行 ARP 实际上处仕链路 队和网络层之间 [KOZI05], 但个少拧名教材都是把 AR I'放在网络队中讲授的[TANEII) [PETE12) [FOROIO) [STALIO ］。从教学的 观点行，如果从协议的底以门卜.tt k 讲投，那么（i学习链跺层时就讲解 ARP 的工作原理．因涉及到 IP 地址的转换，似不易理解。 编名的意见比，既然协议 ARP 实际上处J·链跺臣和网络贮之间．从教学法的角度考虑，对千自底层） r 始讲的教材，放在网络层 讲述似较为力使。实协」＿．，『耍的怂柲沾 ARP 的工作匝理．不必过J二纠缠 ARP 究竟属十哪．比。 • 119 •"}
{"doc_id": "network", "page": 131, "text": "• 不同的寻址方案： • 不问的最大分组长度 • 不同的网络接入机制： • 不同的超时控制； • 不同的九错恢复力法： • 不同的状态报告方法： • 不同的路由选择技术： • 不同的用户接入控制； • 不同的服务（而向连接服务和九连接服务）； • 不同的管理与控制方式；等等。 能不能让大家都使用相同的网络，这样可使网络互连变得比较简单。答案是不行的． 因为用户的伽求是多种多样的，没有一种单一的网络能够适应所有用户的需求。另外，网络 技术足不断发展的，网络的制造）豖也要经常推出新的网络，在竞争中求生存。因此客观讲 在巾场上总是有很多种不同性能、个同网络协议的网络，供刁、同的用户选用。 从一般的概念米讲，将网络互相连接起来要使用一些中间设备。根据中间设备所在的 层次，可以有以下四种不同的中间设备： (I) 物理层使用的中间设备叫作转发器(re p ea t er) 。 (2) 数踞链路层使川的中间设备叫作网桥或桥接器(br i dge), 以及交换机(sw it ch) 。 (3) 网络层使用的中间设备叫作路由器(rou ter) 了。 (4) 在网络层以上使用的中间设备叫作网关(ga teway)。用网关连接两个不兼容的系统衙 要在高层进行协议的转换。 当中间设备是转发器或网桥时，这仅仅是把一个网络扩大了，而从网络层的角度看， 这仍然是一个网络，一般并个称之为网络互连。网关巾千比较复杂，目前使用得较少。因此 现在我们讨论网络可连时，都是指川路由器进行网络互连和路巾选择。路由器其实就是一台 专用计符机，用来在互联网中进行路由选择。由千历史的原因，许多有关 TCP/1 P 的文献曾 经把网络层使用的路由器称为网关（本书有时也这样用），对此请读者加以注意。 图 4-5(a) 表示有许多计算机网络通过一些路由器进行互连。由千参加百连的计贺机网络 都使用相同的网际协议 IP (Internet Pro tocol), 因此可以把互连以后的计算机网络看成为如 图 4-5(b) 所示的一个虚拟互连网络(i n t erne t)。所谓虚拟互连网络也就是逻辑互连网络，它的 总思就是互连起来的各种物理网络的异构性本来是客观存在的，但是我们利用协议 IP 就可 以使这些件能各异的网络在网络层上看起来好像是一个统一的网络。这种使用协议 IP 的虚 拟互连网络可简称为 LP 网 (lP 网是庙拟的，但平常不必每次都强调“虚拟”二字）。使用 IP 网的好处是：当 IP 网上的上机进行通信时，就好像｛＇～个单个网络上通信一样，它们看 不见互连的各网络的具体异构细节（如具体的编址方案、路由选择协议，等等）。如果在这 种稷盖全球的 IP 网的上层使用 TCP 协议，那么就是现{+的互联网 (In terne t)。 ＠汁 还句一种网析和路 111 常的社合物桥路器(brou t ~r), 它足兼付网桥和跺由器的功能的产品。文协」:,严格的网桥或严 格的路由器产品足牧少见的 个过桥路器名词JIJ得个忤心． 1力注意 rou ter 的读汗足trauter]. • 120 •"}
{"doc_id": "network", "page": 132, "text": "|  一 1 |  一 1 (a) 实际的互连网络 I  一 I  一 1 I 一， 千 ／二 — 虚拟的 LP 网 )  （互联网） \\  产|\\ 1 I • I  一 1 :I I 一， 一 1 (b) 虚拟的 IHP 网 图 4-5 IP 网的概念 当很多异构网络通过路由器互连起来时，如果所有的网络都使用相同的协议 IP, 那么 在网络层讨论问题就显得很方便。现在用一个例子来说明。 在图 4-6 所示的互联网中的源主机凡要把—个 IP 数据报发送给目的主机 H2 。根据第 1 章中讲过的分组交换的存储转发概念，主机凡先要查找自己的转发表，看目的主机 H2 是否 就在本网络上。如是，则不需要经过任何路由器而是直接交付，任务就完成了。如不是，则 必须把 IP 数据报发送给某个路由器（图中的 R 心民在查找了自己的转发表后，知道应当 把数据报转发给 R2 进行间接交付。这样一直转发下去，最后由路由器民知道自己是和 H2 连接在同一个网络上，不需要再使用别的路由器转发了，于是就把数据报直接交付目的主机 H2 。总之，分组从源节点 A 发送到目的节点 B, 若中间必须经过一个或几个路由器（这表 示 A 和 B 不在同一个网络上），则是间接交付。但若不需要经过路由器（这表示 A 和 B 在 同一个网络上），则是直接交付。 RI Ri  俨」闺互贬 R1~ • R 、 +II I 1 、 I I I _  L - !  -艺工 «  邑～牙5 `— R.  <L  主机 H2 图中的协议栈中的数字 l~5 分别表示物理层、数据链路层、网络层、运输层和应用层 图 4-6 分组在互联网中的传送 • 121 •"}
{"doc_id": "network", "page": 133, "text": "在图中画出了源主机、目的主机以及各路由器的协议栈。我们注意到，主机的协议栈 共有五层，但路由器的协议栈只有下三层。图中还画出了数据在各协议栈中流动的方向（用 黑色租线表示）。我们还可注意到，在凡和民之间使用了卫星链路，曲 R5 所连接的是个无 线局域网（民和主机 H2 都在同一个局域网中）。在 R 准肛心之间的三个网络则可以是忏总类 型的网络。总之，这里强调的是：互联网可以由多种异构网络互连组成。 有时可以把问题简化。我们可以想象 IP 数据报就在网络层中传送，传输路径可省略路 巾器之间的网络以及连接在这些网络上的许多无关上机。图 4-7 表不了这样的传输路径。 跳跳跳跳跳跳 源主机 H,- 凡一一一凡一一- R3 一一一凡一一-Rs--:--- 比门的 I，机 ＼：：己，妇/二//, l i．上；（t 图 4-7 沥心机 H1 向目的中机 H2 发送分组 在互联网的词汇中，分组在传送途中的每一次转发都称为一“跳（ho p)“。也有人把 hop 译为跃点。路由器 {I转发分组时也＇，常常使用“下一跳 (nex t ho p)\"的说法。例如，凡的下一 跳足 R2, 曲凡的卜一跳是 Rs 。对 1二本例，凡向 H2 发送分组面要经过 6 跳。我们还注意到， 匈一跳内端的曲个节点都必定直桵连接在同一个网络上。例如，fl.图 4-7 中从凡到 R3 的一 跳，具两端的两个节点凡和 R3 都是连接在同一个网络上的。在上而所举的例子中，前 5 跳 都是间接交付，只有最后一跳是直桵交付。 4.2.2 IP 地址 在 TCP/IP 体系中， lP 地址是一个奻从本的概念。 -·个连接仆互联网上的设备，如果没 有 IP 地址，就无法和网上的具他设备进行通信。因此应节凸先学好有关 IP 地卅的内容。 1. IP 地址及其表示方法 整个的互联网就是一个单一的、抽象的网络。 lP 地址就是给连接到互联网」·的每一台 中机（或路巾器）的每一个接口，分配一个在全世界范阳内是唯一的 32 位的标识符。 IP 地 址的结构使我们可以在互联网卜很方便地进行寻址。 IP 地址现在由互联网名字和数字分配 机构 ICANN (I nternet Corporation for Assigned Names and Numbers)进行分配 I) 。 对主机或路山器来说， IP 地址都是 32 位的二进制代砃。为了提高可读性，我们常常把 32 位的 IP 地址中的每隔 8 位插入 个空格（但在机器中并没有这样的空格）。为（便千人 们书写和记忆，？作用具等效的十进制数字表示，并且在每段数字之间加上－个小数点。这就 叫作点分十进制记法(do tted decimal no ta ti on) 。图 4-8 是一个 IP 地址表示力认的例子。显然， 把 IP 地址用 4 段十进制数字来表尔足个很好的方法。 d）汴： IP 地址喽校级巾访分忙． I．i联网i}令码分配机构 IANA 把人块 IP 地址按地区先分配给全球 h 个估，息中心。中国互联 网信息中心 CNNIC 内向Jt中的亚太网络信息中心 APNIC (Asia Pac ，几 c Network lnformacion Center）巾i,＇／地址．我同的 ISP 则必须 向 CNNIC 巾诘地J 1!:. 11> 地J 1I都怂打f产租J.lj的． • 122 •"}
{"doc_id": "network", "page": 134, "text": "机器中存放的 LP 地址是连续的－．进制代码一 I IOOOOOOOOOOOIOIIOOOOOOllOOOlllII I  母隔 8 位插入 4 个空恪能够提仙可读性 一 100000000000101 I 00000011 00011111  匕一~___ '`—f--丿`—r·一｀一－－－丿 把 8 位的兰进制数转换为（进制数 一 128 11 3 31  \\\\ ///  采川 4 段十进制数字的点分 1 进制记法 一一一一- ·128.II .3.31  图 4-8 采用点分卜进制记法能够提高可议性 前面所讲的给每个主机（或路由器）的接口分配一个 IP 地址，其含义就是这个 IP 地址 不但标志了这个主机（或路由器），而且还标志f此接口所连接的网络。因此， 32 位的 IP 地址采用两级结构，巾两个字段组成。第一个字段是网络号，它标志上机（或路巾器）所连 接到的网络。 一个网络号在整个互联网范围内必须是唯一的。第二个字段是主机号，它标志 该土机（对路由器来说，就足标志该路由器）。-.个主机号在所连接的网络（即前面的网络 号所指明的网络）中必须怂唯一的。由此可见， 一个 IP 地址在整个互联网范围内是唯一的． 因此， IP 地址可以记为： IP 地址 = { ＜网络号＞，＜主机',;>} (4-1)  式 (4-1) 中的符号”::=”表示“定义为“。 IP 地址中包含网络号就表明，不连网的主机就 没有 IP 地址。一定要记住， IP 地址指明了连接到某个网络上的一个主机（或路由器）。为 简单起见，当不涉及路由器时，后面我们都以主机为例米介绍 IP 地址。 图 4-9 表示 IP 地址中的网络号和上机号的位宜。具体的规定是： IP 地址中的前 n 位是 主机所连接的网络号，而 IP 地址中后面的(32 - 11) 位是主机号。现在的问题是，当我们看到 一个 IP 地址时，怎样知逍它的网络号的位数 n 是多少？下面我们就来讨论这个问题。 32 位 IP 地址 1 网络号 t机号 l  |＇，位 (32- II) 位--j 004-9 IP 地址中的网络 S和主机号字段 2. 分类的 IP 地址 在互联网发展早期采川的是分类的 IP 地址，也就是在图 4-9 中的 n 是 固定的几个数之一。分类的方法如图 4-IO(a) 所示。分类的方法非常简单。 这里 A 类 (n = 8) 、 B 类 (11 = 16) 和 C 类 (11 = 24) 地址都是单播地址 视如“ （一对一通信），是最常川的。 D 类足多播地址（一对多通信，我们将在 4.7 节讨论 IP 多播）， 而 E 类是保留地址。 32 位的J P 地址空间共有 232 （即 4294967296, 接近 43 亿）个地址。 A 类地址空间共有 2“ 个地址，占整个 IP 地址空间的 50% 。 B 类地址空间共有 2“ 个地址，占整个 IP 地址空间 的 25% 。整个 C 类地址空间共有 2“ 个地址，占整个 IP 地址的 12.5% 。 D 类和 E 类地址各 占整个 IP 地址的 6.25% 。图 4-10 (b)给出了各类地址占 IP 地址总数的比例。 从图 4- l O(a) 可以看出，如果给出一个二进制数表示的 IP 单播地址，那么就可以很容易 知逆是哪类地址，并且也能石出这个二进制数表示的网络号和主机号。 例如，给出一个 IP 地址 I 0000000 0000 111 0 00 I 000 11 00000 I l l 。对比一下图 4-IO(a), 不难看出，这是一个 B 类地址，前 16 位是网络勺，后 16 位是主机号。 • 123 •"}
{"doc_id": "network", "page": 135, "text": "A 类地址回2壁号 f- 8 位 32 位 K 机乃 24 位 B 类地hl. I10 ; 网络廿 l l十几另 ——-」 1-16 位 !--1611-I C 类地址 1I IO ; 网络号 1 上机勺· |  I 24 位 I- 8 位一| D 类地J 1+ |I I IO t播地j」 |  F 类地址伈言 保宙为今后处用 (a)  图 4-10 分类的 IP 地h1(a) 以及各类地址所占的比例(b) (b)  A 类地址的网络号字段占 1 个字节，只付 7 位可供使用（该字段的第一位已固定为 0) 。 们如 1忑．总，第．．网络号为个 0 的 IP 地J·11 有特殊的用途，它表示“本网络＇＇：第勹，网络号 为 127 （即 01111111) 保悄作为本地软件环回测试(loo pback t es t)本主机的进程之间的迪信之 用。若日机发送一个目的地址为环回地址（例如 127.0.0.1) 的 IP 数据报，则本主机中的协 议软件就处理数据报中的数据．而小会把数拟报发送到任何网络。因此 A 类地址J I［指派的 网络牙足 126 个（即 27 - 2) 。 A 类地址的 l·：机号占 3 个字节。fl I 个 0 和全 l 的． E 机号一般不指派。全 0 的主机号表示 该 IP 地址足“本 E 机”所连接到的单个网络地址（例如，若卞机的 IP 地址为 5.6.7.8, 则该 F 机所在的网络的网络号是 5, 而该网络的网络地址就是 5.0.0.0) 。全 l 表示“所有的＇＇，因 此个 1 的午机劳字段表示该网络上的所（门：： ~l. 闪此每一个 A 类网络中的砐大主机数是 224 -2, l!ll 16777214.  B 类地址的网络号字段有 2 个字趴囚此 B 类地址可指派的网络数为 214, 即 16384 。 B 类地址的每一个网络上的垃人寸卞机数从 216 - 2. 即 65534 。这里俙要减 2 是因为要扣除全 0 和个 I 的主机砂。 C 类地址有 3 个字'I'i的网络号字段。囚此 C 类地址可指派的网络总数是 221' 即 2097152 。每－·个 C 类地址的垃大主机数足 28-2 ．即 254 。 本书的前几个版本曾捉到． B 类地卅中的网络地址 128.0.0.0 和 C 类地址中的网络地址 192.0.0.0 都是规定不指派的。但现仆这两个网络地址都已经 II ［以指派了 [RFC 6890] 。 长 4-2 给出j，一般不指派的特殊 IP 地址，这此地址只能在特定的悄况下使用。 表 4-2 一般不指派的特殊 IP 地址 网络号 主机号 源地址使用 目的地址使用 代表的意思 。 。 可以 个 UJ ＂本网络 1 的本t机（见 6.6 节 DHCP 协议） 。 X 可以 个可 在本网络上i舟L I:}为 X 的 I：机 个 1 全 1 不 11 f 11J以 只在木网络I:.进行广播（各跺由跺均 4；转友） l' 个 1 不 nr of I ．人 付1(“i1廿为 Y 的网络上的所付主机进iJ广播 127 11: 个 0 或全 1 的 I f何数 可以 ,J I.J. 用 1 ．人地软件环回测试 这里婓指出，山于近作米已经广泛使用无分类 IP 地址进行路由选择， A 类、 B 类和 C • 124 •"}
{"doc_id": "network", "page": 136, "text": "类这种分类地址已成为历史 [RFC 1812] 。由千很多文献和资料现在都仍然引用传统的分类的 IP 地址，因此我们对分类的 IP 地址还要进行简单的叙述。 把 IP 地址划分为 A 类、 B 类、 C 类三个类别，当初是这样考虑的：各种网络的差异很 大，有的网络拥有很多主机，而有的网络上的主机则很少。把 IP 地址划分为 A 类、 B 类和 C 类是为了更好地满足不同用户的需求。 这种分类的 IP 地址由千网络号的位数是固定的，因此管理简单、使用方便、转发分组 迅速，完全可以满足当时互联网在美国的科研需求。后来，为f更加灵活地使用 IP 地址， 出现了划分子网的方法，在 IP 地址的主机号中，插入一个子网号，把两级的 IP 地址变为三 级的 IP 地址。但是，谁也没有预料到，互联网在 20 世纪 90 年代突然迅速地发展起来了。 互联网从美国专用的科研实验网演变到世界范围开放的商用网！互联网用户的猛增，使得 IP 地址的数揽面临枯竭的危险。这时，人们才注意到原来分类的 IP 地址在设计上确实有很 不合理的地方。例如，一个 A 类网络地址块的主机号数目超过了 1677 万个！当初头国的很 多大学都可以分配到一个 A 类网络地址块。一个大学怎么会需要这样多的 IP 地址？但在互 联网出现早期，人们就是认为 IP 地址是用不完的，不需要精打细算地分配。又如，一个 C 类网络地址块可指派的主机号只有 254 个。但不少单位需要有 300 个以上的 IP 地址，那么 干脆申请一个 B 类网络地址块（可以指派的主机号有 65534 个），宁可多要些 IP 地址，把 多余的地址保留以后慢慢用。这样就浪费了不少的地址资源。即使后来采用了划分子网的方 法，也无法解决 IP 地址枯竭的问题 于是，在 20 世纪 90 年代，当发现 IP 地址在不久后将会枯竭时，一种新的无分类编址 方法就问世了。这种方法虽然也无法解决 IP 地址枯竭的问题，但可以推迟 IP 地址用尽的日 子。下一节就介绍现在已普遍采用的这种编址方法。 3. 无分类编址 CIDR tt~ ·t I  这种编址方法的全名是无分类域间路由选择 CIDR (Classless Inter-Domain  Routing, CIDR 的读音是 “s i der\") [RFC 4632], 其要点有以下三个。 圈 (1) 网络前缀 心吓 CJDR 把图 4-9 中的网络号改称为“网络前缀＂ （ network-pre fi x) （或简称为“前缀＂）， 用来指明网络，剩下的后面部分仍然是主机号，用来指明主机。在有些文献中也把主机乌守 段称为后缀(su ffi x) 。 ClDR 的记法是： IP 地址．．＝ ｛＜网络前缀＞，＜主机号＞｝ (4-2)  图 4-11 说明了 CIDR 的网络前缀和主机号的位置。看起来，这和图 4-9 也没有什么不 同，只是把“网络号“换成为“网络前缀＂。其实不然。这里最大的区别就是网络前缀的位 数 n 不是固定的数，而是可以在 0~32 之间选取任意的值。 32 位 IP 地址 I 网络前缀 I------ ,1 位 主机号 l  (32- n) 位一一气 图 4-11 CIDR 表示的 IP 地址 CIDR 使用＂斜线记法 ”(slash no ta ti on), 或称为 CIDR 记法，即在JP 地址后面加上斜 • 125 •"}
{"doc_id": "network", "page": 137, "text": "线”!”，斜线后面是网络前缀所占的位数。例如， CIDR 表示的一个 IP 地址 128.14.35.7/20, 二进制 IP 地址的前 20 付是网络前缀（相当千原来的网络号），剩下后面 12 位是主机号。 (2) 地址块 CIDR 把网络前缀都相同的所有连续的 IP 地址组成一个 “CIDR 地址块＂。一个 CIDR 地址块包含的 lP 地址数目，取决千网络前缀的位数。我们只要知道 CIDR 地址块中的任何 个地址，就可以知道这个地址块的起始地址（即最小地址）和最大地址，以及地址块中的 地址数。例如，已知 IP 地址 128.14.35.7/20 是某 CIDR 地址块中的一个地址，现在把它写成 二进制表示形式，其中的前 20 位是网络前缀（用粗体和下划线表示出），而前缀后面的 12 位是主机号： 128.14.35.7/20 = ~0011 00000111  可以很方便地得出这个地址所在的地址块中的砐小地址和最大地址： 品小地址 1 128.14 32 0  录大地址 128.14.47.255  10000000 00001110 00100000 00000000  10000000 00001110 0010111111111111  这个地址块的 IP 地址共有 212 个，扣除主机号为全 0 和全 l 的地址（酘小地址和砐大地 址）后，可指派的地址数是 212 - 2 个。我们常使用地址块中的最小地址和网络前缀的位数 指明一个地址块（不必每次都减 2 算出可指派的地址数，这样做太麻烦）。显然，上面导出 的最小地扯并不是该地址块 128.14.32.0/2 0 的网络地址。 也可以用二进制代砃简要地表示此地址块： 10000000 00001110 0010* 。这里的星号＊代 表了主机号才段的所有的 0 。星号前的一进制代码的个数，就是网络前缀的位数。 什不需要指明网络地址时，也可把这样的地址块简称为 “/20 地址块“。 诮读者注意： 128.14.32. 7 是 IP 地址，但未指明网络前缀长度，因此不知道网络地址是什么。 I 28. l4.32.7/20 也是 IP 地址，但同时指明了网络前缀为 20 位，由此可导出网络地址。 128.14.32.0/20 是包含多个 IP 地址的地址块或网络前缀，或更简单些，就称为前缀，同 时也是这个地址块中主机号为全 0 的地址。谓注意，上面地址块中 4 段十进制数字最后的 O 有时可以省略，即简写为 128.14.32/20 。 我们不能仅用 128.14.32.0 来指明一个网络地址，因为无法知道网络前缀是多少。例如 128.14.32.0/19 或 128.14.32.0/21, 也都是有效的网络地址。 128.14.32.0 也可能是一个可以指 派的 IP 地址（如果网络前缀的位数不超过 18) 。 早期使用分类的 lP 地址时， A 类网络的前缀是 8 位， B 类网络的前缀是 16 位，而 C 类 网络的前缀是 24 位，都是固定值，因此不需要重复指明其网络前缀。例如在使用分类地址 时，一看 15.3 .4.5就知道是个 A 类地址，其网络地址为 15.0.0.0 。但在使用 CIDR 记法时， 15.3 .4 .5/30 则是一个很小的地址块 15 .3.4.4/30 中的、不屈于任何类别的一个 IP 地址。 总之，无分类编址 CIDR 具有很多优点，但一定要记住，采用 CIDR 后，仅从斜线左边 的 IP 地址已尤法知道其网络地址了。在这一点上，原来的分类地址还是比 较方使的。 (3) 地址掩码 CIDR 使用斜线记法可以让我们知道网络前缀的数值。但是计算机看不 见斜线记法，而是使用二进制来进行各种计算时就必须使用 32 位的地址掩 视知吓 • 126 •"}
{"doc_id": "network", "page": 138, "text": "码 (address mask) 能够从JP 地址迅速算出网络地址。 地址掩码（常简称为掩码）由一连串 1 和接着的一连串 0 组成，而 l 的个数就是网络 前缀的长度。地址掩码又称为子网掩码兜在 CIDR 记法中，斜线后面的数字就是地址掩码 中 1 的个数。例如， /20 地址块的地址掩码是： 111111 I 1 1111111 I I 11 I 0000 00000000 (20 个 连续的 1 和接着的 12 个连续的 0) 。这个掩码用 CIDR 记法表示就是 255.255.240.0/20 。 对于早期使用的分类 IP 地址，其地址掩码是固定的，常常不用专门指出。例如： A 类网络，地址掩码为 255.0.0.0 或 255.0.0.0/8 。 B 类网络，地址掩码为 255.255.0.0 或 255.255.0.0/1 6 。 C 类网络，地址掩码为 255.255.255.0 或 255.255.255.0/24 。 把二进制的 IP 地址和地址掩码进行按位 AND 运算，即可得出网络地址。图 4-12 说明 了 AND 运算的过程。 AND 运算就是逻辑乘法运算，其规则是： 1 AND l = I. l ANDO= O,  。 ANDO= 0 。点分 I 进制的 lP 地址是 128.14.35.7/20, 前缀长度是 20 （见图中的灰色背娱）。 请注意，从，i炽分十进制的 IP 地址并不容易看出其网络地址。要使用二进制地址来运觉。在 本例中把二进制 lP 地址的前 20 位保留不变，剩下的 12 位全写为 o, 即可得出网络地址。 之进制 IP 地计 地计掩码 按位 AND运算 网络地址 128. 14. 35. 7  10000000 00001110 00100011 00000111  111111111111111111110000 00000000  10000000 00001110 00100000 00000000  128. 14. 32. 0 /20  前缀 20 位一 招 4-12 从 IP 地址算出网络地址 从上面的运算结果可以知道， IP 地址 128.14.35.7/20 所在的网络地址是 128.14.32.0/20 。 表 4-3 给出了最常用的 CIDR 地址块。表中的 K 表示 2l0 即 1024 。网络前缀长度在 13 到 27 之间是最常用的。在“包含的地址数”中把全 1 和全 0 的主机号都计算在内了。 表 4-3 常用的 CIDR 地址块 网络前缀长度 点分十进制 包含的地址数 相当千包含分类的网络数 /13 255.248.0.0 512 K 8 个 B 类或 2048 个 C 类 /14 255.252 0.0 256 K 4 个 B 类或 1024 个 C 类 /15 255.254 0 0 128 K 2 个 B 类或 512 个 C 类 /16 255 255 0 0 64 K 1 个 B 类或 256 个 C 类 /17 255 255.128.0 32 K 128 个 C 类 /18 255.255.192.0 16K 64 个 C 类 119 255 255 224.0 8K 32 个 C 类 120 255.255 240.0 4K 16 个 C 类 /21 255.255.248.0 2K 8 个 C 类 /22 255.255.252.0 IK 4 个 C 类 /23 255.255.254 0 512 2 个 C 类 ＠注．千网 (subne t或 subne t work) 是很常用的个名词．某个网络的一部分就可以称为其j不凡 个网络对招个互联网来 说，就可以看成是一个子网。在本书中．＂ f网”和“网络“常常披认为是同义词．经常混用。 • 127 •"}
{"doc_id": "network", "page": 139, "text": "续表 网络前缀长度 点分十进制 包含的地址数 相当千包含分类的网络数 /24 255.255 255.0 256 1 个 C 类 /25 255.255.255.128 128 1/2 个 C 类 126 255.255.255 192 64 1/4 个 C 类 /27 255.255.255 224 32 1/8 个 C 类 CIDR 地址中还有三个特殊地址块，即： (I) 前缀 n = 32, 即 32 付 lP 地址都是前缀，没有主机号。这其实就是一个 IP 地址。这 个特殊地址用干主机路由（见 4.3.2 节）。 (2) 前缀 11 = 3 1,这个地址块中只有两个 lP 地址，其主机号分别为 0 和 l 。这个地址块 用」点对点链路（见后而的第 4 小节）。 (3) 前缀 n=O 同时 IP 地址也是介 0, 即 0.0.0.0/0 。这用千默认路由（见 4.3.2 节）。 从表 4-3 可吞出，每一个 CIDR 地址块中的地址数一定是 2 的整数次需。除最后几行外， ClDR 地址块都包含了多个 C 类地址（是一个 C 类地址的 2“ 倍， n 是整数），因此在文献中 有时称 CIDR 编址为“构造超网”。 使用 CIDR 的一个好处就是可以更加有效地分配 IP 地址空间，可根据客户的荷要分配 适当人小的 CIDR 地址块。然而在使用分类地址时，向一个部门分配 IP 地址，就只能以／8, /16 或／24 为单位来分配。这显然是很不灵活的。 个大的 CIDR 地址块中往往包含很多小地址块，所以在路由器的转发表中就利用较大 的一个 CIDR 地址块来代替许多较小的地址块。这种方法称为路由聚合(rou t e aggregati on),  它使得转发表中只用一个项目就可以表示原来传统分类地址的很多个（例如上于个）路由项 目，因而大大压缩了转发表所占的空间，减少了查找转发表所需的时间。 阳 4-13 给出的是 CIDR 地址块灵活分配的例子。假定某 ISP 已拥有地址块 206.0.64.0/18 （相当于有 64 个 C 类网络）。现在某大学需要 800 个 IP 地址。 ISP 可以给该人学分配一个 地址块 206.0.68.0/2 2, 它包括 1024 （即 2IO ）个 IP 地址，相当千 4 个连续的 C 类／24 地址块， 山该 ISP 拥有的地址空间的 1/16 。这个大学可灵活地对本校各系继续分配地址块，而各系还 可再划分本系各教研室的小地址块. CIDR 的地址块的地址范围有时不易看消，这是因为网 络前缀和主机号的界限不是恰好出现在整数字节处。但只要写出地址的二进制表示，弄浩网 络前缀的位数，就能够知道地址块的范鹰 图 4-13 表示这个 ISP 共拥有 64 个 C 类网络。如果不采用 CIDR 技术，则在与该 ISP 的 路由器交换路由信息的每一个路由器的转发表中，就需要有 64 行，每一行指出了到哪一个 网络的下一跳。但采用地址聚合后，在转发表中只盆要用一行来指出到 206.0.64.0/1 8 地址 块的卜－跳。这个大学共有 4 个系。在 ISP 内的路由器的转发表中，也仅需用 206.0.68.0/22 这一个项目，就能把外部发送到这个大学各系的所有分组，都转发到大学的路由器。这个路 由器好比是大学的收发室。凡寄给大学任何一个系的邮件，邮递员都不必送到人学的各个系， 而是把这些邮件块中投递到大学的收发室，然后由大学的收发室再进行下一步的分发。这样 就加快f邮递员的投递工作（相当于缩短了转发表的查找时间）。 从图 4-13 的表格中可看出，网络前缀越短的地址块所包含的地址数就越多。 • 128 •"}
{"doc_id": "network", "page": 140, "text": "～了Y一、 个尸、 飞． 广互联网 i· . {,'  夕＇ ＿、～丈 一系 二 系 巾．位 地址块 二进制表不的地址块 相当于C 类网络数 ISP 206.0 64 0 /1 8 110011100000000001 • 64  大学 206.0.68.0/22 I IOOl 110 00000000010001 * 4  ·系 206.0.68.0/23 11001110 000000000100010• 2  ～_刀,;;S 206.0.70.0/24 11001110 00000000 01000110 • I  ＝系 206.071.0/25 I 10011100000000(>01000111 o• 1/2  四系 206.0.71.128/25 II 001110 000000000I000111 I 嘈 1/2  图 4-13 CIOR 地址块划分举例 4. IP 地址的特点 lP 地址具有以下一些重要特点。 表中早号念是利嘴 用的简写力式，表 示呈号后而的＿进 制十机勺都省略［ (I) 每一个 IP 地址都由网络前缀和主机号呐部分组成。从这个意义上说， IP 地址是一 种分等级的地址结构。分两个等级的好处是：第 ， lP 地址管理机构在分配 IP 地址时只分 配网络前缀（第一级），而剩下的主机号（第尸级）则由得到该网络前缀的单位自行分配。 这样就方便了 IP 地址的管理；第二，路由器根据目的主机所连接的网络前缀（即地址块） 来转发分组（而不考虑目的主机号），这样就可以使轧发表中的项目数大幅度减少．从曲减 少转发表所占的存储空间，缩短查找转发表的时间。 (2) 实际上 IP 地址是标志一台主机（或路山器）和～条链路的接口。当一台中机同时迕 接到两个网络上时，该主机就必须同时具有两个相应的 IP 地址，其网络前缀必须是不同的。 这种主机称为多归属主机(mul ti homed hos t)。由丁一个路由器全少应当连接到两个网络，囚 此一个路由器至少应当有两个不同的 IP 地址。这好比一个建筑正好处在北京路和上询路的 交叉口上，那么这个建筑就可以拥有两个门牌号码。例如，北京路 4 号和上海路 37 号。 (3) 按照互联网的观点，一个网络（或了网）是指具有相同网络前缀的主机的众合． l;,SI 此，用转发器或交换机连接起来的若干个局域网仍为一个网络，因为这些局域网都具有同样 的网络前缀。具有不同网络前缀的局域网必须使川路巾器进行互连。 (4) 在 IP 地址中，所有分配到网络前缀的网络（不管是范围很小的局域网，还是可能悛 盖很大地理范围的广域网）都是平等的。所谓平等，是指互联网同等对待每一个 1P 地址。 图 4-14 画出了三个局域网 (LAN1, LAN2 和 LAN3) 通过三个路巾器 (R J，凡和 R3) 万 连构成的一个互连网络 C 其中局域网 LAN2 是由两个网段迪过以太网交换机互连的。图中的 小圆圆表示需要有一个 IP 地址。这是为了强调， IP 地址是标志一个主机连接在网络上的接 口。如果我们把某条连接线断开，那么相应的 IP 地址也就不存在了。但通常为了方使，这 • 129 •"}
{"doc_id": "network", "page": 141, "text": "样的小圆圈可以不必画出。 ···············:····、··••.. LAN1.. ·······1_l.. ·.`、`` 叩 1 令己尸 LAN3  .. ···•• l;·\" 、·· ·.  1.1.1 .16/29  / ～～二I , -—、 : l.1.1.1 7  ;,  ` ，、 、、 、、、 __  ·1 、J.1.1 8 `·  ｀、、、 网络地址 们也址 LAN2 /....,、I II总二二1}3llII-:ll丿 ; 1 1 己，，．＇， ；，＝三尹＇． ＿＿已路由器 云歹以太网交换机 `、、·········· .. •·  图 4-14 盂要 IP 地址的地方用小圆圆表示 我们应当注意到： • 在同一个局域网上的主机或路由器的 lP 地址中的网络前缀必须是同样的，即必须 具有同样的网络号。 • 图中的网络地址（用粗体字加下画线表示）里面的主机号必定是全 0 。例如， LAN1 的网络地址l. l. 1. 0/29 = Q_QQ_Q_QQ_Q_l__-OO_l OOOOOOOl 00000000 ，在二进制表示的 IP 地址中，前 29 位有下画线的数字是网络前缀，最后 3 位为止机号，是全 0 。 . 图 4-14 中的所有设备都有自己的 MAC 地址（都未瞧出）。请注意，图中以太网交 换机连线上画出的小圆圈，是主机或路由器的 lP 地址，并不是以太网交换机的 IP 地址。以太网交换机是链路层设备，只有 MAC 地址。 • 用以太网交换机（它只在链路层 T．作）连接的几个网段合起来仍然是一个局域网， 只使用同样的网络前缀，例如 LAN2. • 路由器总是具有两个或两个以上的 IP 地址。即路由器每个接口的 IP 地址的网络前 缀都不同。 • 当两个路由器直接相连时（例如通过一条租用线路），在连线两端的接口处，可以 分配也可以不分配 IP 地址。如分配[ IP 地址，则这一段连线就构成了一种只包含 一段线路的特殊“网络”（如图中的 N,, N2 和 N3) 。之所以叫作“网络“，是因为 它有 lP 地址。这种网络仅盂两个 IP 地址，因此这里就使用了/31 地址块。这种地 址块专门为点对点链路的两端使用 [RFC 3021), 主机号（只有 1 位）可以是 0 或 l 。 但为了节省 IP 地址资源，对于点对点链路构成的特殊“网络＂，现在也常常不分配 lP 地址。通常把这样的特殊网络叫作无编号网络(unnumbered ne twork) 或匿名网络 (anonymous ne twork)[COME06] 。 4.2.3 IP 地址与 MAC 地址 在学习 lP 地址时，很益要的一点就是要弄懂生机的 IP 地址与 MAC 地 址的区别。在局域网中，由于 MAC 地址已固化在网卡上的 ROM 中，因此 常常将 MAC 地址称为硬件地址或物理地址。在本书中，物理地址、硬件地 • 130 •  打_,打 视频讲解"}
{"doc_id": "network", "page": 142, "text": "址和 MAC 地址常常作为同义词出现。物理地址的反义词就是庙拟地址、软件地址或逻辑地 址， IP 地址就屈千这类地址。 图 4-15 说明了这两种地址的区别。从层次的角度看， MAC 地址是数据链路层使用的地 址，而 lP 地址是网络层和以上各层使用的地址，是一种逻辑地址（称 IP 地址为逻辑地址是 因为气lP 地址是用软件实现的）。 1 甘部 1 应用层数据 1  [f>地址 l -~TCP 报文~ 沪 ! :靡胪心LP 数据报 ,; ．．．．….:-:-::::.:晕．．．．噜．．．噜．．．噜．．． 互数据链路层 MAC 帧 使用 MAC 地址 ^  图 4-15 lP 地址与 MAC 地址的区别 在发送数据时，数据从高层下到低层，然后才到通信链路上传输。使用 lP 地址的 IP 数 据报一旦交给数据链路层，就被封装成 MAC 帧。 MAC 帧在传送时使用的源地址和目的地 址都是 MAC 地址，这两个 MAC 地址都写在 MAC 帧的首部中。 连接在通信链路上的设备（主机或路由器）在收到 MAC 帧时，根据 MAC 帧首部中的 MAC 地址决定收下或丢弃。只有在剥去 MAC 帧的首部和尾部后把 MAC 层的数据上交给 网络层后，网络层才能在 IP 数据报的首部中找到源 IP 地址和目的 IP 地址。 总之， lP 地址放在 lP 数据报的首部，而 MAC 地址则放在 MAC 帧的首部。在网络层 和网络层以上使用的是 IP 地址，而数据链路层及以下使用的是 MAC 地址。在图 4-15 中， 当 IP 数据报插入到数据链路层的 MAC 帧以后，整个的 IP 数据报就成为 MAC 帧的数据， 因而在数据链路层看不见数据报的 lP 地址。 图 4-16(a) 画的是三个局域网用两个路由器凡和 R2 互连起来。现在主机凡要和主机 H2 通信。这两台主机的 IP 地址分别是团和 IP2, 而它们的 MAC 地址分别为 MAC1 和 MAC扣 通信的路径是： H1 一经过凡转发一再经过凡转发一 H2 。路由器 R1 因同时连接到两个局域 网上，因此它有两个 MAC 地址，即 MAC3 和 MAC4 。同理，路由器民也有两个 MAC 地址 MAC5 和 MAC妒 图 4-16 (b)特别强调了 1P 地址与 MAC 地址所使用的位置的不同。表 4-4归纳了这种区 别。 表 4-4 图 4-16(b) 中不同层次、不同区间的源地址和目的地址 在网络层 在数据链路层 写入 IP 数据报首部的地址 写入 MAC 帧首部的地址 源地址 目的地址 源地址 目的地址 从 H1 j lj R1 I I) 1 IP2 MAC1 MAC3  从 R ，到 R1 IP1 IP2 MAC• MACs  从 R2 到 H1 IP, IP1 MAC• MAC2  • 131 •"}
{"doc_id": "network", "page": 143, "text": "主机 H, 肆L H:  路山器 R1 路巾器 R: IP2 I  ：：：：卢，，，云 下三域网 MAC3 户圈.lMAC4切域网MAC《户＝勹 MAC,, 切拔1叫 一 1 M二工 (a) 网络配罚 l:,NL I I~  ．，八 \"I 到 1P, 由器 R1 亡勹勹产＞．路由器 R2 广一一一一作5勹IP.- - - - - - - - lPl2 L 的店拟 I/联网 压 三 MAC 帧 MAC 帧 (b) 小同从次、不屈化间的源地址和日的地址 图 4-16 从不回层次上看 IP 地址和 MAC 地址 这里要强调指出以下几点： 三 MAC 帕 (I) 在 IP 层抽象的互联网上只能看到 IP 数据报。虽然J P 数据报耍经过路山器 R ，和 R2 的两次转发，但在它的首部中的源地址和目的地址始终分别足 IP1 和 IP2 。图中的数据报上 写的“从 IP1 到 IP2\" 就表示前者是源地址而后者是目的地址。数据报中间经过的两个路由 器的 IP 地址并不出现在 IP 数据报的首郘中。 (2) 虽然在 IP 数据报首部有源站 IP 地址，但路由器只根据目的站的 IP 地址进行转发。 (3) 在局域网的链路层，只能看见 MAC 帧。 IP 数据报攸封装竹· MAC 帧中。 MAC 帧 在不同网络上传送时，其 MAC 11信丿1 首部中的源地址和 11 的地址婓发牛变化，如图 4- l 6(b) 所 示。开始在 H1 到凡间传送时， MAC 帧凶部中写的是从 MAC 地计 MAC1 发送到 MAC 地址 MAC3, 路巾器凡收到此 MAC 帧后，在数拟链路层，要剥去原来的 MAC 帧的首部和 Fi部 在转发时，在数据链路层，要重新添加上 MAC 帧的首部和尾部。这时首邹中的源地扯和 11 的地址分别变成为 MAC4 和 MAC5 。路由器贮收到此帧后，冉次史换 MAC I~月的首部和尾 部，首部中的源地址和目的地址分别变成为 MAC6 和 MAC2 。 MAC 帧的们f|i的这种变化， 在上面的 IP 层上是看不见的。 (4) 尽管互连在一起的网络的 MAC 地址体系各不相回，但 IP 层抽象的互联网却屏蔽了 下层这些很复杂的细节。只要我们在网络层上讨论问题，就能够使用统一的、抽象的 IP 地 址研究主机和主机或路由器之间的通信。 以上这些概念是计算机网络的粘韵所在，对这些重耍概念务必仔细思考和掌握。 细心的读者会发现，还有两个正耍问题没有解决： (I) 主机或路由器怎样知道应当在 MAC 帧的首部埴入什么杆的 MAC 地址？ (2) 路由器中的转发表是怎样得出的？ • 132 •"}
{"doc_id": "network", "page": 144, "text": "第一个问题就是下一节所要讲的内容，而第二个问题将在后面的 4.5 节详细讨论。 4.2.4 地址解析协议 ARP 在实际应用中，我们经常会遇到这样的问题：已经知道了一个机器 （主机或路由器）的 IP 地址，需要找出其相应的 MAC 地址。地址解析协 议 ARP [RFC 826, STD37] 就是用来解决这样的问题的。图 4-17 说明了协议 ARP 的作用。 伐须讲解 荨三 IP  I ARP 请求或回答分组 1 发送 仁以太网t1部数据 1FCS |  ARP 分组封装在以太网中 层 L 络网 MAC 地址 图 4-17 协议 ARP 的作用 还有一个旧的协议叫作逆地址解析协议 RARP, 它的作用是使只知道自己 MAC 地址的 主机能够通过协议 RARP 找出其 IP 地址。现在的协议 DHCP （见第 6 竞的 6.6 节）已经包 含了协议 RARP 的功能。因此本书不再介绍协议 RARP 。 下面就介绍协议 ARP 的要点。 我们知道，网络层使用的是 IP 地址，但在实际网络的链路士传送数据帧时，敬终还是 必须使用链路层的 MAC 地址。 IP 地址和下面链路层的 MAC 地址之间由千格式不同而不存 在简单的映射关系（例如， IP 地址有 32 位，而链路层的 MAC 地址是 48 位）。此外，在一 个网络上可能经常会有新的主机加入进来，或撤走一些主机。更换网络适配器也会使主机的 MAC 地址改变（请注意，主机的 MAC 地址实际上就是其网络适配器的 MAC 地址）。地址 解析协议 ARP 解决这个问题的方法是在主机的 ARP 高速缓存中存放一个从 IP 地址到 MAC 地址的映射表，并且这个映射表还经常动态更新（新增或超时删除）。 每一台主机都设有一个 ARP 高速缓存(ARP cache), 里面存有本局域网上的各主机和路 由器的 IP 地址到 MAC 地址的映射表，这些都是该主机目前知道的一些 MAC 地址。那么主 机怎样知道这些 MAC 地址呢？我们可以通过下面的例子来说明。 当主机 A 要向本局域网上的某台主机 B 发送 IP 数据报时，就先在其 ARP 高速缓存中 查看有无主机 B 的 IP 地址。如有，就在 ARP 高速缓存中查出其对应的 MAC 地址，再把这 个 MAC 地址写入 MAC 帧，然后通过局域网把该 MAC 帧发往此 MAC 地址。 也有可能查不到主机 B 的 IP 地址。这可能是主机 B 才入网，也可能是主机 A 刚刚加电， 其高速缓存还是空的。在这种情况下，主机 A 就自动运行 ARP, 然后按以下步骤找出主机 B 的 MAC 地址。 (1) ARP 进程在本局域网上广播发送一个 ARP 请求分组（具体格式可参阅［COME06] 的 第 23 章）。图 4-18(a) 是主机 A 广播发送 ARP 诮求分组的示意图。 ARP 请求分组的主要内 容是：“我的 IP 地址是 209.0.0.5, MAC 地址是 00-00-CO- I 5-AD- l 8 。我想知道 lP 地址为 209.0.0.6 的主机的 MAC 地址。” (2) 在本局域网上的所有主机上运行的 ARP 进程都收到此 ARP 请求分组。 • 133 •"}
{"doc_id": "network", "page": 145, "text": "(3) 主机 B 的 IP 地址与 ARP 请求分组中要查询的 lP 地址一致，就收下这个 ARP 请求 分组，并向主机 A 发送 ARP 响应分组，同时在这个 ARP 响应分组中写入自己的 MAC 地址。 由千其余所有主机的 IP 地址都与 ARP 请求分组中要查询的JP 地址不一致，因此都不理睬这 个 ARP 清求分组，如图 4-18(b) 所示。 ARP 响应分组的主要内容是：“我的 1P 地址是 209.0.0.6, 我的 MAC 地址是 08-00-28-00-EE-OA 。“请注意：虽然 ARP 请求分组是广播发送的，但 ARP 响应分组是普通的单播，即从一个源地址发送到一个目的地址。 我的 IP 地址是 209.0.0.5, MAC地址是 00-00-C0-15-AD-I 8 。 我想知道主机 209.0.0.6 的 MAC地址。 三 一了． f 209.o.o.s  X j A I  一 1 一 1 '  00-00-C0-15-AD- I 8  己已 ＿＼。已＼ B | z I  一 1 一 1 i一 l (a) 主机 A 广播发送 ARP 诮求分组 l11- x  厂－ A —\\2090061  B 1 z |  一一二J -_二J 08-00-28 勿 00-EE-OA (b) 主机 B 向 A 发送 ARP 响肘分组 图 4-18 地址解析协议 ARP 的工作原理 (4) 主机 A 收到主机 B 的 ARP 响应分组后，就在其 ARP 高速缓存中写入主机 B 的 IP 地址到 MAC 地址的映射。 当主机 A 向 B 发送数据报时，很可能以后不久主机 B 还要向 A 发送数据报，因而主机 B 也可能要向 A 发送 ARP 请求分组。为了减少网络士的通信批，主机 A 在发送其 ARP 诮 求分组时，就把自己的 IP 地址到 MAC 地址的映射写入 ARP 请求分组。当主机 B 收到 A 的 ARP 诸求分组时，就把主机 A 的这一地址映射写入主机 B 自己的 ARP 高速缓存中。以后 主机 B 向 A 发送数据报时就很方便了。 可见 ARP 高速缓存非常有用。如果不使用 ARP 高速缓存，那么任何一台主机只要进行 一次通信，就必须在网络上用广播方式发送 ARP 请求分组，这就会使网络上的通信址大大 增加。 ARP 把已经得到的地址映射保存在高速缓存中，这样就使得该主机下次再和具有同 样目的地址的主机通信时，可以直接从高速缓存中找到所需的 MAC 地址而不必再用广播方 式发送 ARP 请求分组。 ARP 对保存在高速缓存中的每一个映射地址项目都设置生存时间（例如， 10~20 分 钟）。凡超过生存时间的项目就从高速缓存中删除掉。设置这种地址映射项目的生存时间是 很重要的。设想有一种情况：主机 A 和 B 通信。 A 的 ARP 高速缓存里保存有 B 的 MAC 地 址，但 B 的网络适配器突然坏了， B 立即更换了一块，因此 B 的 MAC 地址就改变了。假 • 134 •"}
{"doc_id": "network", "page": 146, "text": "定 A 还要和 B 继续通信。 A 在其 ARP 高速缓存中查找到 B 原先的 MAC 地址，并使用该 MAC 地址向 B 发送数据帧。但 B 原先的 MAC 地址已经失效了，因此 A 无法找到主机 B 。 但是过了一段不长的生存时间， A 的 ARP 高速缓存中已经删除了 B 原先的 MAC 地址，千 是 A 篮新广播发送 ARP 诸求分组，又找到了 B 。 诮注意， ARP 用于解决同一个局域网上的主机或路由器的 IP 地址和 MAC 地址的映射 间题。如果所要找的主机和源主机不在同一个局域网上，例如，在前面的图 4-16 中，主机 儿就无法解析出另一个局域网上主机比的 MAC 地址（实际上主机凡也不需要知道远程主 机比的 MAC 地址）。主机凡发送给比的 lP 数据报首先需要通过与主机 H) 连接在同一个 局域网上的路巾器 R) 来转发，因此主机凡必须知道路由器凡的 IP 地址。于是 H) 使用 ARP 把路由器凡的 IP 地址 lP3 解析为 MAC 地址 MAC3, 然后把 IP 数据报传送到路由器 R)o 以后，凡从转发表知道应把 IP 数据报转发到路由器 R2, 再使用 ARP 解析出民的 MAC 地 址 MAC5 ，把 IP 数据报转发到路由器 R2 。路由器 R2 用同样方法解析出目的主机比的 MAC 地址 MAC2, 使 IP 数据报最终交付主机 H沪 从 lP 地址到 MAC 地址的解析是自动进行的，主机的用户对这种地址解析过程是不知 道的。只要主机或路由器要和本网络上的另一个已知 IP 地址的主机或路由器进行通信，协 议 ARP 就会自动地把这个 IP 地址解析为链路层所需要的 MAC 地址，然后插入到 MAC 帧 中。 下面我们归纳出使用 ARP 的四种典型情况（如图 4-19 所示）。 HI I  ，一1 R1  H3 I  r 一1 R2  NI ＿｀已凡 一乏已 N3  H2 I  一1 吵 图 4-19 使用 ARP 的四种典型情况 比 1 一 1 '  (1) 发送方是主机（如 H1 ），要把 1P 数据报发送到同一个网络上的另一台主机（如 H2) 。 这时凡发送 ARP 谓求分组（在网络 N1 上广播），找到目的主机比的 MAC 地址。 (2) 发送方是主机（如凡），要把 1P 数据报发送到另一个网络上的一台主机（如 H3 或 比）。这时凡发送 ARP 诮求分组（在网络 N1 上广播），找到凡上的一个路由器 R 的 MAC 地址。剩下的工作由路由器凡来完成。凡要做的事情是下面的(3) 或 (4) 。 (3) 发送方是路由器（如 R,), 要把J P 数据报转发到与凡连接在同一个网络 N2 土的主 机（如 H3) 。这时民发送 ARP 诸求分组（在 N2 上广播），找到目的主机比的 MAC 地址。 (4) 发送方是路由器（如 R1 ），要把 IP 数据报转发到网络 N3 上的一台主机（如 H4) 。 比与凡不是连接在同一个网络上的。这时凡发送 ARP 诸求分组（在 N2 上广播），找到连 接在 N2 上的一个路由器 R2 的 MAC 地址。剩下的工作由这个路由器 R2 来完成。 在许多情况下需要多次使用 ARP, 但这只是以上几种情况的反复使用而已。 有的读者可能会产生这样的间题：既然在网络链路上传送的帧最终是按照 MAC 地址找 到目的主机的，那么为什么我们还要使用两种地址（ IP 地址和 MAC 地址），而不直接使用 MAC 地址进行通信？只用一个 MAC 地址进行通信似乎可以免除使用 ARP 。 这个问题必须弄清楚。 由于全世界存在着各式各样的网络，它们使用不同的 MAC 地址。要使这些异构网络 • 135 •"}
{"doc_id": "network", "page": 147, "text": "能够互相通信就必须进行非常复杂的 MAC 地址转换工作，因此由用户或用户主机来完成 这项工作几乎是不可能的事。即使是对分布在全世界的以太网 MAC 地址进行寻址，也是 极其困难的。然而 IP 编址把这个复杂问题解决了。连接到互联网的主机只需各自拥有一 个 IP 地址，它们之间的通信就像连接在同一个网络上那样简单方便，即使必须多次调用 ARP 来找到 MAC 地址，但这个过程都是由计算机软件自动进行的，对用户来说是看不见的。 因此，在虚拟的 lP 网络上用 IP 地址进行通信给广大的计算机用户带来了很大的方便。 4.2.5 IP 数据报的格式 IP 数据报的格式说明协议 IP 都具有什么功能。在协议J P 的标准中， 描述首部格式的宽度是 32 位（即 4 字节）。图 4-20 是 IP 数据报的完整格式 [RFC 791, STD5] 。 付 一 4 -1- 4 一卜— 8 16  版本 1 首部长度1 区分服务 总长度 标识 标志 1 片偏移 生存时间 | 协议 首部检验和 源地址 U 的地卅 ; 可选字段（长度可变） | 填充 数 据 部 分 ii部 1 数据部分 发送在前 IP 数据报 图 4-20 IP 数据报的格式 视频讲解 I  从图 4-20 可看出，一个 IP 数据报由首部和数据两部分组成。首部的前一部分长度是固 定的，共 20 字节，是所有 IP 数据报必须贝有的。在首部的固定部分的后面是一些可选字段， 其长度是可变的。下面介绍首部各字段的总义。 1. IP 数据报首部的固定部分中的各字段 (I) 版本 占 4 位，指协议 IP 的版本。通信双方使用的协议 IP 的版本必须一致。这 里讨论的协议 IP 版本号为 4 （即 1Pv4) 。关于 1Pv6 （即版本 6 的协议 lP), 我们将在后面的 4.5 节讨论。 (2) 首部长度 占 4 位，可表示的最大十进制数值是 l5 。诸注意，首部长度字段所表 示数的单位是 32 位字长（ l 个 32 位字长是 4 字节）。因为 IP 首部的固定部分是 20 字节， 因此首部长度字段的最小值是 5 （即二进制表示的首部长度是 0101) 。而当首部长度字段为 最大值 1111 时（即十进制的 I 5), 就表明首部长度达到最大值一— 15 个 32 位字长，即 60 字节。当 IP 分组的首部长度不是 4 字节的整数倍时，必须利用酘后的填充字段加以填充。 因此 IP 数据报的数据部分永远在 4 字节的整数倍时开始，这样在实现协议 IP 时较为方便。 首部长度限制为 60 字节的缺点是有时可能不够用，但这样做是希望用户尽批减少开销。最 常用的首部长度是 20 字节，不使用任何可选字段。 • 136 •"}
{"doc_id": "network", "page": 148, "text": "(3) 区分服务 占 8 位，用来获得更好的服务。这个字段在旧标准中叫作服务类型， 但实际卜一叮没有被使用过。 1998 年 IETF 把这个字段改名为区分服务 OS (Diff erentiated  Serv i ces) 。只有{t使用 1又分服务时，这个字段才起作用（见 8 .4.4节）。在一般的悄况下都不 使川这个字段[RFC 2474, RFC 3168, RFC 3260] 。 (4) 总长度 总长度指首部和数据之和的长度，单位为字节。总长度字段为 16 位， 因此数据报的最大长度为2' 6 - I = 65535 字节。 然而实际上传送这样长的数据报在现实中 是极少遇到的。 找们知道 {I IP)县下面的旬一种数据链路层协议都规定了一个数据帧中的数据字段的 最大长度，这称为最大传送单元 MTU (Maximum Transfer Un it)。当一个 IP 数据报封装成链 路层的初讨，此数据报的总长度（即首部加上数据部分）一定不能超过下面的数据链路层所 规定的 MTU 伯。例如，最祁用的以太网就规定其 MTU 值是 1500 字节。若所传送的数据报 长度超过数据链路层的 MTU 值，就必须把过长的数据报进行分片处理。 虽然使川尽可能长的 IP 数据报会使传输效率得到提高（这样每一个 IP 数据报中首部长 度占数据报总长度的比例就会小此），但数据报短些也有好处。 IP 数据报越短，路山器转发 的速度就越快。为此，协议 IP 规定在互联网中所有的主机和路由器必须能够接受长度不 超过 576 字节的数躯报。这足假注上层交下米的数据长度有 512 字节（合理的长度），加上 最长的 IP 首部 60 rf节，再加 I·. 4 宁节的富余散，就得到 576 字节。当主机需要发送长度超 过 576 牛节的数据报时，应当先了解－下，目的主机能否接受所要发送的数据报长度。否则， 就要进行分片。 仆进行分片时（见后血的＂片偏移”字段），数据报首部中的“总长度”字段是指分片 后的每一个分片的首部长度与该分片的数据长度的总和。 (5) 标识(i den t币 ca ti on) 占 16 位。 IP 软件在存储器中维持一个计数器，每产生一个 数据拟，计数器就加 I, 并将此值赋给标识牛段。但这个“标识”并不是斤号，因为 IP 是 无迕接服分数拱报不存在按疗接收的问题。当数据报由千长度超过网络的 MTU 而必须分 片时，这个标识字段的值就被复制到所有的数据报片的标识字段中。相同的标识字段的值使 分片后的各数厮报片圾后能止确地平装成为原来的数据报。 (6) 标志(fl a g) 占 3 位，但目前只有两位有意义。 • 标志字段中的最低位记为 MF (More Fra g men t)。 MF= I 即表示后面”还有分片” 的数捆报。 MF=O 表示这已是若干数据报片中的最后一个。 • 标忐字段中间的一位记为 OF (Don't Fra g men t),意思是“不能分片”。只有当 DF =  0 时才允许分片。 (7)片偏移 占 13 位。片偏移指出：较长的分组在分片后，某片在原分组中的相对 付置，也就是说，相对于用户数据字段的起点，该片从何处开始。片偏移以 8 个字节为偏移 单位。这就是说，除砓后个数据报片外，其他每个分片的长度一定是 8 字节 (64 位）的 整数倍。 下面举一个例子。 【例 4-1 】 一个数据报的总长度为 3820 字节，其数据部分为 3800 字节长（使用固定 首部），孟要分片为长度不超过 1420 字节的数拟报片。因固定首部长度为 20 字节，因此每 个数据报片的数据部分长度不能超过］ 400 字寸1 几千是分为 3 个数据报片，其数据部分的长 度分别为 1400, 1400 和 1000 字节。原始数据报首部衱复制为各数据报片的首部，但必须修 • 137 •"}
{"doc_id": "network", "page": 149, "text": "改有关字段的值。图 4-21 给出分片后得出的结果（诮注意片偏移的数值）。 数据部分共 3800 字节 需要分片的数据报 1 厂尸},,II i i i 夕，一』 ',  字节 0 ,','' ,',1400  ｀巨平 28丿［片偏移： 0／8 0  ', ',  数据乙巨巨荨 字节 0 数据报片 l 片偏移＝ 0/8 = 0  1400  1 尸厂勹 2799 2800 3799  数据报片 2 数据报片 3 片偏移＝ 1400/8 = 175 片偏移＝ 2800/8 = 350  图 4-21 数据报的分片举例 表 4-5 是本例中数据报首部与分片有关的字段中的数值，其中标识字段的值是任意给定 的 (12345) 。具有相同标识的数据报片在目的站就可无误地护装成原来的数据报。 表 4-5 IP 数据报首部中与分片有关的字段中的数值 总长度 标识 MF DF 片偏移 原始数据报 3820 12345 。 。 。 数据报片 1 1420 12345 I 。 。 数据报片 2 1420 12345 I 。 175  数据报片 3 1020 12345 。 。 350  现在假定数据报片 2 经过某个网络时还需要再进行分片，即划分为数据报片 2-1 （携带 数据 800 字节）和数据报片 2-2 （携带数据 600 字节）。那么这两个数据报片的总长度、标 识、 MF 、 DF 和片偏移分别为： 820, 12345, 1,0, 175: 620, 12345, 1,0,275 。 (8) 生存时间 占 8 位，生存时间字段常用的英文缩写是 TTL (Time To Li ve), 表明 这是数据报在网络中的寿命。由发出数据报的源点设置这个字段。其目的是防止无法交付的 数据报无限制地在互联网中兜阳子（例如从路由器凡转发到 R2, 再转发到 R3, 然后又转发 到 R1 ），因而白白消耗网络资源。最初的设计以秒作为 TTL 值的单位。每经过一个路由器 时，就把 TTL 减去数据报在路由器所消耗掉的一段时间。若数据报在路由器消耗的时间小 千 1 秒，就把 TTL 值减 l 。当 TTL 值减为零时，就丢弃这个数据报。 然而随着技术的进步，路由器处理数据报所需的时间不断在缩短，一般都远远小千 1 秒，后来就把 TTL 字段的功能改为“跳数限制”（但名称不变）。路由器在每次转发数据报 之前就把 TTL 值减 1 。若 TTL 值减小到零，就丢弃这个数据报，不再转发。因此，现在 TTL 的单位不再是秒，而是跳数。 TTL 的意义是指明数据报在互联网中至多可经过多少个 路由器。显然，数据报能在互联网中经过的路由器的最大数值是 255 。若把 TTL 的初始值 设置为 I, 就表示这个数据报只能在本局域网中传送。因为这个数据报一传送到局域网上的 某个路由器，在被转发之前 TTL 值就减小到零，所以会被这个路由器丢弃。 (9) 协议 占 8 位，协议字段指出此数据报携带的数据使用何种协议，以便使目的主 机的 IP 层知道应将数据部分上交给哪个协议进行处理。 • 138 •"}
{"doc_id": "network", "page": 150, "text": "常用的一些协议和相应的协议字段值如卜 [W-IANA] I:  协议名 ICMP IGMP IP2 TCP EGP IGP UDP lPv6 ESP All ICMP-1Pv6 OSPF  协议字段值 2 4 6 8 9  17 41 50 5 1 58 89  (10) 首部检验和 占 16 位。这个字段只检验数据报的首部，但不包括数据部分。这 是因为数据报每经过～个路山器，路山器都要亚新计算一下首部检验和（一些字段，如生存 时间、标志、片偏移等都可能发生变化）。不检验数据部分可减少计邪的工作泣。为了进一 步减少计算检验和的工作忧， IP 首部的检验和不采用复杂的 CRC 检验码而采用下面的简单 计绊方法：在发送方，先把 lP 数据报首部划分为许多 16 位字的序列，井把检验和字段置零。 用反码算术运算习把所有 16 位字相加后，将得到的和的反码写入检验和字段。接收方收到 数据报后，把订部的所有 16 位字再使用反码絊术运算相加一次。将得到的和取反码，即得 出接收方检验和的计釭结果。若首部未发生任何变化，则此结果必为 O, 于是就保留这个数 据报：否则即认为出差错，并将此数据报丢弃。图 4-22 说明[ lP 数据报首部检验和的计算 过程。 数据报ri部 发送端 字 1 1 16 位 1 字 2 1 16 位 1 检验和 I 全 0 |  .r,, 1 l; ｛廿 1 忮收i岱 j, 1 | l6 位 1 t. 2 | 1 6.仅 1 伈验和 1 16 位 1  字 II I 16 位 1 反码i.~术 l 16 位 1  运仅求和 取反码』 IP 敌据挹 检俭和 数据部分个参与检验和的计仔 敌斟部分 反码环术 1 16 位 1  运釭求和 取反码 l 结果 1 16 位 1  u  扑结果为 0. 则保 W: 否则，丢弃该数拟报 图 4-22 IP 数据报首部检验和的计符过程 (11) 源地址 (12) 目的地址 占 32 位。发送 IP 数据报的t机的J P 地址。 占 32 位。接收 IP 数据报的主机的 IP 地址。 O 注：队来如协议字段值这tY 的改伉都是由儿联网赋号管埋机构JANA 负贞指屈，井公布(j_ {j关的 RFC 文门中的． IANA 山义 1 巾政府建立，片妳 II Jon Pos1el 负贞节理. tlJ J-Jon Pos1el J· 1998 年去出．同时也由于互联网的商业化和国协化，许多国家 矿11111 个新的、私灯的、作忭利的 1日际公，j1 一 互联网名称与数字地址分配机构 ICANN [W-ICANN] 取代 IANA ．但后来 ICANN Ji没有取代 IANA. 而足保m r IANA. 井且和 IANA 进 h （分 I: ．囚此现 (1 执出现了 IA I\\ MICANN 或 ICANN/I ANA 这 祥的习认．这两个机构郘负贞 IP 地址和～些重耍今攻的许理．现(f.(1 关 h联网的，R 吐＄数已经小(「 RFC 文档公布[RFC 3232),  曲改为在网址 www. i nna.org上仅询（I:线的数据片、 从 2016 年起，片始进行 IANA 的许理权赴步向 ICANN 转移的 E 作． ＠让·这里的 IP« 示特殊的 IP 数据报一 IP 牧拟报再封妆到 IP 奻据报中< IP Encapsulation wi1hin LP).  ＠注：内个以进行进割反仍求和的运钉很简小 它的规则从从低位到为位心列进行计r,. 0 和 0 相加是 o. 0 和 1 相加 足J. I 和 1 相加足 0 们耍产生．个进位 1 ，加钊卜 夕1J.若垃压伈扑1 加后产生进位，则蚊后得到的纠果要在最低位加 I• 请注意， 反码 (one's com p lcmcn1) 和补码(1wo's com p lcmc111) 足不祥的． • 139 •"}
{"doc_id": "network", "page": 151, "text": "2. IP 数据报首部的可变部分 IP 数据报首部的可变部分就足一个选项宁段 c 选项字段用来支持排错、测橄以及安全 等措施，内容很才京。此宁段的长度可变，从 1 字节到 40 字节不等，取决寸所选择的项 目。某些选项项 1-I 只油婓 1 字节，它只包括 1 字节的选项代砃。而有些选项盂要多个了节， 这些选项一个个拼接起来，中间不面婓有分隔符，蚁后用全 0 的填充字段补齐为 4 字节的 整数倍。 增加首部的可变部分是为了增加 IP 数据报的功能，但这同时也仗得 IP 数据报的首部长 度成为可变的。这就增加了每一个路山器处理数据报的开销。实际士这些选项很少被使用。 很多路由器都不考虑 TP 首部的选项才段，因此新的 IP 版本 1Pv6 就把 IP 数据报的首部长度 做成固定的了。这里就不讨论这些选项的细节了。有兴趣的读者可参阅 RFC 791 。 4.3 IP 层转发分组的过程 4.3.1 基千终点的转发 找们 1r 图 4-7 中已经描述了分组在互联网中逐跳转发的概念。分组在互 联网上传送和转发是从于分组首部中的目的地址的，因此这种转发方式称为 f I ·fl  基于终点的转发。 视频讲斛 因此，分组每到达一个路由器，路由器就根据分组中的终点（目的地址）查找转发表， 然后就得知下一跳应当到哪一个路由器。 但是，路山器中的轧发表却不是按目的 IP 地址来直接查出下－跳路由器的。这是因为 互联网中的中机数门实在太人了。如果用目的地址直接杳找转发表，那么这种结构的转发表 就会非常庞大，使得查找过桯非常之慢。这样的转发表也就没有实用价值了。因此必须想办 法压缩轧发表的大小。 我们知道， 32 位的 IP 地址是由两级纠成的。前一部分是前缀，表示网络，后一部分表 示主机。所以可以把奋找目的主机的方法变通 下，即不是自接查找目的主机，而是先查找 目的网络（网络前缀），在找到了目的网络之后，就把分组在这个网络士直按交付目的主机。 由于互联网上的网络数远远小于生机数，这样就可以大大压缩转发表的大小，加速分组在路 由器中的转发。这就是基于终点的转发过程。 读者可能还会想到一个问题，就足分组首部中没有地方可以用来指明”下一跳路由器 的 IP 地址＂，那么待转发的分组又怎样能够找到下一跳路由器呢？ 当路巾器收到一个待转及的分组，在从转发表得出 7:;- －跳路由器的 IP 地址后，不是把 这个地址埴入分组首部，而足送交数据链路层的网络接口软件。网络接口软件负责把下一跳 路由器的 IP 地址转换成 MAC 地址（必须使用 ARP), 并将此 MAC 地址放在链路层的 MAC 帧的首部，然后利月］这个 MAC 地址传送到下－跳路由器的链路层，再取出 MAC 帧 的数据部分，父给网络层。由此可见，当发送一连串的分组时，上述的这种查找转发表、调 用 ARP 解析出 MAC 地址、把 MAC 地址＇弓入 MAC 帧的首部等过程，都是必须做的（当然 都是由机器自动完成的）。 那么，能不能什转发表中刁、使用 IP 地址而直接使用 MAC 地址呢？不行。我们一定要 弄清楚，使用抽象的 IP 地打I:, 本来就是为了隐蔽各种底层网络的复杂性而使于分析和研究 问题，这样就不可避免地要付出些代价，例如在选择路由时多了一些开销。但反过来，如果 • 140 •"}
{"doc_id": "network", "page": 152, "text": "在转发表中直接使用 MAC 地址，那就会带来更多的麻烦，甚至无法找到对方的机器。 下面用具体例子来说明分组的转发过程。 【例 4-2 】 图 4-23 中有三个子网通过两个路由器互连在一起。主机凡发送出一个分组， 其目的地址是 128. l. 2. I 32 。现在源主机是 H1 而目的主机是 H2 。试讨论分组怎样从源主机传 送到目的主机。 ····•••••••••• \"..,' .,,.  子网前缀沁···,i281 2 194  128. 1. 2.1',!2戊6.. .. .·  ：：、三．．．．... 凡的部分转发表 昙孚＼？ N ',,. ..i、、、 l28 I L, I L,Y 上 '·,.. •••••••.... `N2 子网前缀 3,' 、',' 子网，前缀 二．、｀． :',  l28 1 3 －尸王三l281 2 128/26 128 1:3 64/26 丁＇｀ ＝比，＇＇， 图 4-23 源主机凡向目的地址 H2 发送分组 【解】 主机凡首先必须确定；目的主机是否连接在本网络上？如果是，那么问题很简 单，就直接交付，根本不需要利用路由器：如果不是，就间接交付，把分组发送给连接在本 网络上的路由器，以后要做的事情都由这个路由器来处理。 主机凡先把要发送的分组的目的地址和本网络凡的子网掩码按位进行 AND 运算，得 出运算结果。如果运算结果等于本网络 N1 的前缀，就表明目的主机连接在本网络上；否则， 就必须把分组发送到路由器 Rl ，由路由器 R1 完成后续的任务。 由千采用了 CIDR 记法，转发表中给出的都是网络前缀，而没有明显给出子网掩码。其 实只要细心观察斜线后面的数字，就可知道相应的子网掩码。例如，／26 的子网掩码就是点 分十进制的 255.255.255.192 。现在，要发送的分组的目的地址是 128. 1. 2.132, 本网络的掩码 是 26 个 1, 后面有 6 个 0 。如图 4-24(a) 所示，按位 AND 运算的结果是 128. 1. 2.128, 不等于 本网络凡的前缀。这说明目的主机没有连接在本网络上。源主机凡必须把分组发送给路由 器 R,, 让路由器凡根据其转发表来处理这个分组。 (a)  (b)  128. 1. 2. 132  目的主机 IP 地址 10000000 000000010000001010000100  128.1.2.192/26 的掩码 11111111 111l1111 11111111 11000000  按位 AND 运算 10000000 00000001 00000010 10000000  得出结果 128 . 1 . 2 . 128 /26  目的主机 IP 地址 128.1.2.128(26 的掩码 按位 ANO 运红 得出结果 128. 1. 2. 132  10000000 000000010000001010000100  illl111L11111J _l_L11111111 11000000  10000000 000000010000001010000000  128. 1. 2. 128 /26  图 4-24 目的地址和本网络的子网掩码按位进行 AND 运算 • 141 •"}
{"doc_id": "network", "page": 153, "text": "路由器凡的部分转发表已在图 4-23 右上方给出了。转发表中第 1 列就是“前缀匹配“, 这是因为查找转发表的过程就是寻找前缀匹配的过程。 现在先检查路由器凡的转发表中的第 1 行。 源主机 H) 要发送的分组的目的地址是 128. 1. 2.132 。本网络 128.1 .2 .192/26 的前缀有 26 位，因此本网络的掩码是 26 个 1 ，后面是 6 个 0 。目的地址和子网掩码按位 AND 运算的结 果是 128. 1. 2.128/26 （见图 4-24(a)) 。很明显， AND 运算结果与转发表第 1 行的前缀不匹配。 接着检查路由器凡的转发表中的第 2 行。运算结果是 128. 1. 2.128/26, 如图 4-24 (b)所示。 这个结果和转发表第 2 行的前缀相匹配。因此按照转发表第 2 行指出的，在网络 N2 上进行 分组的直接交付（通过路由器 R) 的接口 1) 。这时路由器凡调用 ARP, 解析出目的主机 H2 的 MAC 地址，再封装成链路层的帧，直接交付连接在本网络 N2 上的目的主机 H~ 如果按照同样的方法，检查路由器凡的转发表中的第 3 行，不难得出不匹配的结果。 从以上例子可看出，查找转发表的过程就是逐行寻找前缀匹配的过程。我们再看下一 个例子。 扫一扫 4.3.2 最长前缀匹配 ［例 4-3 】假定在图 4-25 的例子中，路由器民收到一个目的地址为 128. 1. 24.l 的分组，请给出分组的转发接口。请注意，公司 B 包含三个子 网，但这些网络前缀并没有出现在路由器 R 的转发表中。这是因为公司 B 采用了路由聚合，把三个子网的所有地址聚合为一个网络前缀 128.1.24.0/22 。 颖 视频讲解 达 1 到凶要 120  组 8 分 1 Ri}了～} 前缀匹配 下一跳 扂扂：二 I 盓，盓？ 图 4-25 分组交给路由器民进行转发 【解】 我们把进入路由器 R 的分组的目的地址分别和路由器民的转发表第 1 行、第 2 行子网掩码进行按位 AND 运算。运笃结梊都是＂匹配＂ （建议读者自行验算一下）。那么， 哪一个结果是正确的呢？现在就来分析这个问题。 网络前缀 128.1.24.0/2 2 可以划分为 4 个更小的/24 前缀（图 4-26) 。其中的一个前缀 128.1.24.0/24 分配给公司 A, 另外 3 个前缀分配给公司 B 。公司 B 把得到的 3 个前缀聚 合成一个更大的前缀 128.1.24.0/2 2, 作为路由器民的转发表中的一个项目。请注意，这 个前缀和原来的前缀在形式上是一样的，但实际的区别是很大的：在图 4-26 左边的网络 前缀中包含地址 128. 1. 24.L 但公司 B 的聚合后的网络前缀则不包含这个地址。因此在本例 中，即分组应当从接口 1 转发到公司 A 。 那么为什么地址 128.1.24.1 不在公司 B 的聚合前缀 128.1.24.0/22 中，但匹配运算的结 果却是匹配呢？这是因为在转发表中的项目 128.1.24.0/22 并未说明是由哪几个子网聚合 而成的。 • 142 •"}
{"doc_id": "network", "page": 154, "text": "地址 128. 1. 24.] 在其中 公司 A 网络前：于气：＼监尽盓广士沪 24 雯司 B 地址 128~.l 在其中 形式上相同／／／／；；址 ~1.24.1 不在其中 图 4-26 公司 A 和 B 分到的前缀 十分明显，进入路由器凡的分组的目的地址 128.1.24.1 处于公司 A 拥有的地址范围中， 而不在公司 B 的地址范围内。分组应当通过接口 1 转发到公司 A 。 为了减少路由器 R) 中的项目数，公司 B 采用了地址聚合，把三个地址块聚合为一个地 址块 128.1.24.0/22 。这个聚合后得出的前缀和图中左边所示的前缀在形式上是一样的。这样 就导致图 4-26 所示的出现和两个网络前缀都匹配的现象。 我们可以注意到，现在公司 B 三个地址块得出的聚合地址块是 128. l. 24.0/22, 但如果公 司 B 只分到两个地址块 128.1.25.0/24 和 128. l. 26.0/24, 那么其聚合地址块仍然是 128. 1. 24.0/22 。如果把公司 A 和公司 B 的地址块都聚合起来，得出的聚合地址块还是 128. 1. 24.0/22 。这样的地址聚合可以发生在路由器 R2 中。 因此，在采用 CIDR 编址时，如果一个分组在转发表中可以找到多个匹配的前缀，那么 就应当选择前缀最长的一个作为匹配的前缀。这个原则称为最长前缀匹配 (lon ges t prefix  match) 。网络前缀越长，其地址块就越小，因而路由就越具体(more sp ec ifi c) 。为了更加迅速 地查找转发表，可以按照前缀的长短，把前缀最长的排在第 1 行，然后按前缀长短的顺序往 下排列。用这种方法从第 1 行前缀最长的开始查找，只要检查到匹配的，就不必再继续往下 查找，可以立即结束查找。 实际的转发表有时还可能增加两种特殊的路由，就是主机路由和默认路由。 主机路由 (hos t rou te) 又叫作特定主机路由，这是对特定目的主机的 IP 地址专门指明的 一个路由。采用特定主机路由可使网络管理人员更方便地控制网络和测试网络，同时也可在 需要考虑某种安全问题时采用这种特定主机路由。在对网络的连接或转发表进行排错时，指 明到某一台主机的特殊路由就十分有用。假定这个特定主机的点分十进制 IP 地址是 a.b.c.d, 那么在转发表中对应千主机路由的网络前缀就是 a.b.c. d/32 。我们知道，／32 表示的子网掩码 是 32 个 1 。实际的网络不可能使用 32 位的前缀，因为没有主机号的 IP 地址是没有实际意 义的。但这个特殊的前缀却可以用在转发表中。不难看出， 32 个 l 的子网掩码和 IP 地址 a.b.c.d 按位进行 AND 运算后，得出的结朱必定是 a.b.c.d, 也就是说，找到了匹配。这时就 把收到的分组转发到转发表所指出的下一跳。主机路由在转发表中都放在最前面。 还有一种特殊路由是默认路由 (de fa ul t rou te) 。这就是不管分组的最终目的网络在哪里， 都由指定的路由器 R 来处理。这在网络只有很少的对外连接时非常有用。在实际的转发表 中，用一个特殊前缀 0.0.0.0/0 来表示默认路由。这个前缀的掩码是全 0 (/0 表示网络前缀是 0 位，因此掩码是 32 个 0) 。用全 0 的掩码和任何目的地址进行按位 AND 运算，结果一定 是全 O, 即必然是和转发表中的 0.0.0.0/0 相匹配的。这时就按照转发表的指示，把分组送交 下一跳路由器 R 来处理（即间接交付）。 综上所述，可归纳出分组转发算法如下（假定转发表按照前缀的长短排列，把前缀长 的放在前面）： • 143 •"}
{"doc_id": "network", "page": 155, "text": "(l)从收到的分组的首部提取目的主机的 IP 地址 D （即目的地址）。 (2) 若查找到有特定主机路由（目的地址为 D), 就按照这条路由的下一跳转发分组； 否则从转发表中下一行（也就是前缀最长的一行）开始检查，执行(3) 。 (3) 把这一行的子网掩码与目的地址 D 按位进行 AND 运算。 若运算结果与本行的前缀匹配，则查找结束，按照“下一跳”所指出的进行处理（或 直接交付本网络上的目的主机，或通过指定接口发送到下－跳路由器）。 否则，若转发表还有下一行，则对下一行进行检查，重新执行(3) 。 否则，执行(4) 。 (4) 若转发表中有一个默认路由，则按照指明的接口，把分组传送到指明的默认路由器； 否则，报告转发分组出错。 可以用一个简单的比喻来说明杳找转发表和转发分组的过程。例如，从家门口开车到 机场，但没有地胆，不知逍应当走哪条路线。好在每一个道路岔口都有一个警察可以询间。 因此，每到一个岔口（相当千到了一个路由器），就问：“到机场应当朝哪个方向走？”（相 当于查找转发表）。该警察并不告诉你去机场的详细路径。他仅仅指出到机场途经的下一个 符察位置的方向。其回答可能是：“向左转方向走。“你左转到了下一个岔口，再询问警察， 回答可能是：“直行。”这样，每到一个岔口，就询问下一步走的方向。这样，在没有地图的 情况下，我们最终也可以到达目的地一机场。 顺便指出，在过去使用分类地址时，不存在最长前缀匹配的问题。在转发表中，不会 出现目的地址和转发表中的两行或两行以上的网络地址匹配的悄况。 4.3.3 使用二叉线索查找转发表 使用 CIDR 后，由于不知道目的网络的前缀，使转发表的查找过程变得更加复杂了。 当转发表的项目数很大时，怎样设法缩短转发表的查找时间就成为一个非常重要的间题。 例如，连接路由器的线路的速率为J O Gbit/s, 而分组的平均长度为 2000 b it,那么路由器 就应当平均每秒钟能够处理 500 万个分组（常记为 5 M pp s) 。或者说，路由器处理一个分 组的平均时间只有 200 ns (I ns = I 0-9 s) 。因此，查找每一个路由所需的时间是非常短的。 可见在转发表中必须使用很好的数据结构和先进的快速查找算法，这一直是人们积极研究 的热门课题。 对无分类编址的转发表的最简单的查找算法就是对所有可能的前缀进行循环查找，从 最长的前缀开始查找。例如，给定一个目的地址。对每一个可能的网络前缀，进行目的地址 和子网掩码的按位 AND 运算，得出一个网络前缀，然后逐行查找转发表中的网络前缀。所 找到的最长匹配就对应于要查找的路由。 这种最简单的算法的明显缺点就是查找的次数太多。最坏的悄况是转发表中没有这个 路由。在这种情况下，算法仍要进行 32 次（第 1 次用 32 位的前缀查找转发表中所有的行， 第 2 次用 31 位的前缀查找所有的行，这样一直查找下去）。 为了进行更加有效的查找，通常是把无分类编址的转发表存放在一种层次的数据结构 中，然后自上而下地按层次进行查找。这里最常用的就是二叉线索(b i na ry tri e)饥它是一种 ＠注：线索（tri c) 来自 re t rieval （检索）．读计与“try\"相问。 • 144 •"}
{"doc_id": "network", "page": 156, "text": "特殊结构的树。 lP 地址中从左到右的比特值决定了从根节点逐层向下层延伸的路径，而二 叉线索中的各个路径就代表转发表中存放的各个地址。 图 4-27 用～个例千来说明二叉线索的结构。图中给出了 5 个 IP 地址。为了简化二义线 索的结构，可以先找出对应千每一个 IP 地址的唯一前缀(un iq ue pre fi x) 。所谓唯一前缀就是 在表中所有的 lP 地址中，该前缀是唯一的。这样就可以用这些唯一前缀来构造二叉线索。 在进行查找时，只要能够和唯一前缀相匹配就行了。 32 位的 lP 地址 唯－前缀 0 I 000 I IO 00000000 00000000 00000000 0 I 00  0 IO IO I IO 00000000 00000000 00000000 0 IO I  0 I I 0000 I 00000000 00000000 00000000 011  IO I I 0000 000000 IO 00000000 00000000 IO I I 0  10111011 00001010 00000000 00000000 10111  图 4-27 用 5 个前缀构成的二叉线索 从二叉线索的根节点自顶向下的深度最多有 32 层，衍一层对应千 IP 地址中的一位。一 个 lP 地址存入二叉线索的规则很简单：先检合 IP 地址左边的第 位，如为 O, 则第一层的 节点就在根节点的左下方；如为 l ，则在右下方。然后再检查地址的第二位，构造出第二层 的节点。依此类推，直到唯一前缀的最后一位。由于唯一前缀一般都小于 32 位，因此用唯 －前缀构造的二义线索的深度往往不到 32 层。图中较粗的折线就是前缀 0101 在这个二叉线 索中的路1夺。二叉线索中的小圆即是中间节点，而在路径终点的小方框是叶节点（也叫作外 部节点）。每个叶节氓代表一个唯一前缀。节点之间的连线旁边的数字表示这条边在唯一前 缀中对应的比特是 0 或 l 。 假定有一个 IP 地址是 I 0011 0 11 01111010 00000000 00000000, 油要查找该地址是否在 此二义线索中。我们从最左边查起。很容易发现，查到第三个字符（即前缀 10 后面的 O) 时，在二叉线索中就找小到匹配的，说明这个地址不在这个二叉线索中。 以上只是给出了二叉线索这种数据结构的用法，而并没有说明”与唯一前缀匹配”和 ”与网络前缀匹配＂的关系。显然，要将二叉线索用千转发表中，还必须使二叉线索中的每 ～个叶节点包含所对应的网络前缀和千网掩码。当搜索到＋·个叶节点时，就必须将寻找匹配 的目的地址和该叶节点的子网掩码进行按位 AND 运算，石结果是否与对应的网络前缀相匹 配。若匹配，就按下一跳的接口转发该分组。否则，就丢弃该分组。 总之，＝义线索只足提供了－种可以快速在转发表中找到匹配的叶节点的机制。但这 是否和网络前缀匹配，还要和子网掩码进行一次逻辑 AND 运算。 为了提高二义线索的查找速度，广泛使用了各种压缩技术。例如，在图 4-27 中的最后 两个地址，具最前面的 4 位都是 101 I 。因此，只要一个地址的前 4 位是 !Oll, 就可以跳过 前面 4 位（即压缩了 4 个层次）而直接从第 5 位开始比较。这样就可以减少查找的时间。当 然，制作经过压缩的二叉线索需要更多的计算，但由千每一次查找转发表时都可以提高查找 速度，因此这样做还是值得的。 • 145 •"}
{"doc_id": "network", "page": 157, "text": "4.4 网际控制报文协议 ICMP 为了更有效地转发 IP 数据报和提高交付成功的机会，在网际层使用了网际控制报文协 议 ICMP (Internet Control Message Protocol) [RFC 792, STD5] 。 ICMP 允许主机或路由器报 告差错悄况和提供有关异常情况的报告。 ICMP 是互联网的标准协议。但 ICMP 不是高层协 议（看起来好像是高层协议，因为 TCMP 报文装在 IP 数据报中，作为其中的数据部分），而 是 IP 层的协议。 TCMP 报文作为 IP 层数据报的数据，加上数据报的首部，组成夕IP 数据报发 送出去。J CMP 报文格式如图 4-28 所示。 位 0 8 16  前 4 个字节 足统的格式 类型 1 代码 l '检验和 （这 4 个字节取决千 ICMP 报文的类型） ICMP 的数据部分（长度取决于类型） J CMP 报文 首部 1 数据部分 IP 数据报 图 4-28 ICMP 报文的格式 4.4.l ICMP 报文的种类 ICMP 报文有两种，即 ICMP 差错报告报文和 lCMP 询间报文。 ICMP 报文的前 4 字节是统一的格式，共有三个字段：类型、代码和检 验和。接着的 4 字节的内容与 lCMP 的类型有关。最后面是数据字段，其 长度取决于 ICMP 的类型。表 4-6 给出了几种常用的 ICMP 报文类型。 表 4-6 几种常用的 ICMP 报文类型 扫 4 扫 置回取哿 视频讲｀？ ICMP 报文种类 类型的值 ICMP 报文的类型 3 终点不可达 II 时间超过 垃错报告报文 12 参数问题 5 改变路山 (Redi rec t) 8 或 0 回达(Echo) ii'I 求或回送回答 询问报文 13 或 14 时间戳(Ti mesta mp)访求或时间戳回答 ICMP 标准在不断更新。已不再使用的 ICMP 报文有：“信息请求与回答报文”“地址掩 码请求与回答报文”“路由器诸求与通告报文”以及“源点抑制报文 ”[RFC 6633] 。 ICMP 报文的代码字段用于进一步区分某种类型中的几种不同情况。检验和字段用来检 验整个 ICMP 报文。我们应当还记得， IP 数据报首部的检验和并不检验 IP 数据报的内容， 因此不能保证经过传输的 ICMP 报文不产生差错。 表 4-6 给出的 lCMP 差错报告报文共有四种，即： (I) 终点不可达 当路由器或主机不能交付数据报时就向源点发送终点不可达报文。 • 146 •"}
{"doc_id": "network", "page": 158, "text": "(2) 时间超过 当路由器收到生存时间为零的数据报时，除丢弃该数据报外，还要向 源点发送时间超过报文。当终点在预先规定的时间内不能收到一个数据报的全部数据报片时， 就把已收到的数据报片都丢弃，并向源点发送时间超过报文。 (3) 参数问题 当路由器或目的主机收到的数据报的首部中有的字段的伯不正确时， 就丢弃该数据报，并向源点发送参数问题报文。 (4) 改变路由（重定向） 路由器把改变路由报文发送给主机，让主机知道下次应将 数据报发送给另外的路由器（也就是说，找到了更好的路由）。 下面对改变路由报文进行简短的解释。我们知道，在互联网的主机中也要有一个转发 表。当主机要发送数据报时，首先查找主机自己的转发表，看应当从哪一个接口把数据报发 送出去。在互联网中主机的数拯远大于路由器的数量，出于效率的考虑，这些主机不和连接 在网络上的路由器定期交换路由信息。在主机刚开始工作时，一般都在转发表中设置一个默 认路由器的 IP 地址。不管数据报要发送到哪个目的地址，都一律先把数据报传送给这个默 认路由器，而这个默认路由器知道到每一个目的网络的最佳路由（通过和其他路由器交换路 由信息）。如果默认路由器发现主机发往某个目的地址的数据报的最佳路巾应当经过网络上 的另一个路由器 R, 就用改变路由报文把这情况告诉主机。于是，该主机就在其转发表中增 加一个项目：到某某目的地址应经过路由器 R （而不是默认路由器）。 所有的 ICMP 差错报告报文中的数据字段都具有同样的格式（如图 4-29 所示）。把收到 的需要进行差错报告的 IP 数据报的首部和数据字段的前 8 个字节提取出来，作为 ICMP 报 文的数据字段。再加上相应的 ICMP 差错报告报文的前 8 个字节，就构成了 ICMP 差错报告 报文。提取收到的数据报的数据字段前 8 个字节是为了得到运输层的端口号（对于 TCP 和 UDP) 以及运输层报文的发送序号（对于 TCP) 。这些信息对源点通知高层协议是有用的 （端口的作用将在 5. 1.3节中介绍）。整个 ICMP 报文作为 IP 数据报的数据字段发送给源点。 lP 数据报的数据字段 泽％ I JCMP 差错报告报文 ICMP 差错报告报文 装入 [CMP 报文的 IP 数据报 IP 数据报 '  图 4-29 ICMP 差错报告报文的数据字段的内容 下面是不应发送 ICMP 差错报告报文的几种情况： • 对 ICMP 差错报告报文，不再发送 TCMP 差错报告报文。 • 对第一个分片的数据报片的所有后续数据报片，都不发送 ICMP 差错报告报文。 • 对具有多播地址的数据报，都不发送 ICMP 差错报告报文。 • 对具有特殊地址（如 127.0.0.0 或 0.0.0.0) 的数据报，不发送 ICMP 差错报告报文。 常用的 ICMP 询问报文有两种，即： (l) 回送请求或回送回答 ICMP 回送请求报文是由主机或路由器向一个特定的目的 • 147 •"}
{"doc_id": "network", "page": 159, "text": "主机发出的询问。收到此报文的主机必须给源主机或路由器发这 ICMP 回送回答报文。这 种询问报文用来测试目的站是合可达以及了解其有关状态。 (2) 时间戳请求或时间戳回答 在 ICMP 时间戳诮求报文发出后，就能够收到对方响 应的JCMP 时间戳回答报文。利用在报义中记录的时间戳（如报文的发送时间和接收时间）， 发送方很容易计算出当前网络的往返时延。 4.4.2 lCMP 的应用举例 ICMP 的一个重要应用就是分组网间探测 PING (Packe t ln terNe t Grop er), 用来测试两台 主机之间的连通性。 PING 使用了 ICMP 回送诮求与回送回答报文。 PlNG 是应用层直接使 用网络层JCMP 的一个例子。它没有通过运输层的 TCP 或 UDP 。 Wi ndows 操作系统的用户可在接入互联网后转入 MS DOS （点击“开始“，点击“运 行＂，再键入 “cmd”) 。看见屏船上的捉示符后，就键入“pi ng hos t name\" （这里的 hos tn ame 是要测试连通性的主机名或它的 lP 地址），按回车键后就可看到结果。 图 4-30 给出了从南京的一台 PC 到新浪网的邮件服务器 ma i Ls i na.com.cn 的连通性的测 试结果。 PC 一连发出 4 个 ICMP 回送请求报文。如果邮件服务器 ma il. s i na.com.cn 正常工作 而且响应这个 ICMP 回送请求报文（有的中机为了防止恶总攻市就不理睬外界发送过来的这 种报文），那么它就发回 ICMP 回送回答报文。由千往返的 TCMP 报文上都有时间戳，因此 很容易得出往返时间。鼓后显示出的是统计结果：发送到哪个机器 (IP 地址）．发送的、收 到的和丢失的分组数（但不给出分组丢失的原因），以及往返时间的最小值、最大值和平均 值。从得到的结果可以看出，第三个测试分组丢失了。 I,..',  P i ngi ng n ctil.:;i nd.COR.cn (202.108.43.230) H it h 32 b yt es o f da t d:  Repl y f ron 202.108 .4 3.230: b yt es 二 32 ti ne ;368 1'l s TTL;242  Repl y f 1•ofll 202.108.43.230: b yt e ：：一 32 t i me -374 fTls TTL 二 242 Requc:; t t i 111ed ou t.  Repl y f 1·on 202.108.43.230: b yt e ：：二 32 ti ne~374 1'l s TTL;242  P i ng s t dt i:;t i c ::f or 202.1 。 8.43.230: Pdcke t:; :Sen t。 4, Rece i ved - 3. Lo:; t之 1 (25z lo$$),  App1•oxi nc1t e 1•ound t 1•ip tif!l es i n flli ll i -:;econd:::  Hi n i num 二 368ns 廖t1dx ifl'I Ul'l ; 374 fTls. Ave i- age ; 372n::  图 4-30 用 PING 剌试主机的连通性 另一个非常有用的应用是tracerou te （这是 UNIX 操作系统中的命令），用米跟踪一个分 组从源点到终点的路径。在 Wi ndows 橾作系统中这个命令足trace rt。下面简单介绍这个命 令的工作原理。 tracerou te 从源主机向目的上机发送一连串的 IP 数据报，数据报中封装的是无法交付的 UDP 用户数据报 lI 。第一个数据报 P1 的生存时间 TTL 设置为 1 。当 P1 到达路往上的第一个 ＠注：无法交付的 UDP 用户数据报使川j. I| }上的必 LI4｝ （见下烈 5.2.2 甘）， • 148 •"}
{"doc_id": "network", "page": 160, "text": "路由器 R1 时，路由器凡先收下它，接若把 TTL 的值减 l 。由千 TTL 等于零了，因此 R 就 把 P1 丢弃，并向源主机发送一个 ICMP 时间超过差错报告报文。 源主机接着发送第二个数据报 P2 ，并把 TTL 设盎为 2 。贮先到达路由器 R1, R1 收下后 把 TTL 减 1 再转发给路由器 R2 。民收到 P2 时 TTL 为 l ，但减 l 后 TTL 变为零了。凡就丢 弃 P2, 并向源主机发送一个 ICMP 时间超过差错报告报文。这样一直继续下去。当最后一 个数据报刚刚到达目的主机时，数据报的 TTL 是 1 。主机不转发数据报，也不把 TTL 值减 1 。但因 IP 数据报中封装的是无法交付的运输层的 UDP 用户数据报，因此目的主机要向源 主机发送 ICMP 终点不可达差错报告报文（见 5.2.2 节）。 这样，源主机达到了自己的目的，因为这些路由器和最后目的主机发来的 ICMP 报文正 好给出了源主机想知道的路由信息一一到达目的主机所经过的路由器的 IP 地址，以及到达 其中的每一个路由器的往返时间。图 4-31 是从南京的一个 PC 向新浪网的邮件服务器 mail. s ina.com.cn 发出trace rt命令后所获得的结果。图中每一行有三个时间出现，是因为对 应千每一个 TTL 值，源主机要发送三次同样的 IP 数据报。 我们还应注意到，从原则上讲， lP 数据报经过的路由器越多，所花费的时间也会越长。 但从图 4-31 可看出，有时正好相反。这是因为互联网的拥塞程度随时都在变化，也很难预 料到。因此，完全有这杆的可能：经过更多的路由器反而花费更短的时间。 C: 寸ocunen t s and Se tti n g s '\\X XR>t ,-ace,· t r,«il .s i na.coA.cn  Tr <1c i ny rou t e t o ri~il.~i n 1t .coA.cn (202.108.43.2]0)  over « Pl<l>ti nun o f 30 ho ))~:  1 24 ns  2 23 n~  3 23 \"'\"  4 24 ns  s 22 ns  6 28 n5  SOSS3e1 cnnnnn 08?421 500622  33133  ?89812  111  24 ms 23 \"'~ 222.%.1 ?2 .1  24 ns 22 ns 22 1. 23 1. 204.129  22 ms 23 \"'\"'22 1. 23 1. 206.9  23 门＄ 24 ns 202.9?.2?.3?  23 l'l S 24 ns 202.97 .41. 226  28 ns 28 n,; 202.97.35.25  SO n3 51 \"'~ 202.97.36.86  311 \"'\" 310 ns 219.158.32.1  305 ms 305 OIS 219.158.13.17  164 ms 165 n~ 202.96.12.154  320 \"'s 2988 ns 61.135.118.50  322 ns 320 ns ft、 eena il 43-230. ~ i na. con 1202. 108. 43. 2 30 I  T..ace con p le t e.  佟I 4-31 用trace11 命令狄得［I 的上机的路由信息 4.5 1Pv6  协议 IP 是互联网的核心协议。现什使用的协议 IP （即 IPv4) 是在 20 世纪 70 年代末期 设计的。互联网经过几 1 年的飞速发展，右一 2011 年 2 月 3 日， IANA 开始停止向地区互联 网注册机构 RIR 分配 1Pv4 地址，因为 1Pv4 地址已经全部耗尽了。不久，各地区互联网地址 分配机构也相继宣布地址耗尽。我国在 2014 年至 2015 年也逐步停止了向新用户和应用分配 1Pv4 地址，同时全面开始商用部署 1Pv6 。 解决 IP 地址耗尽的根本措施就是采用具有更大地址空间的新版本的 IP, 即 IPv6 。经过 多年的研究和试验， 2017 年 7 月终于发布了 1Pv6 的正式标准[RFC 8200, STD86] 。 • 149 •"}
{"doc_id": "network", "page": 161, "text": "4.5.1 1Pv6 的基本首部 IPv6 仍支持无连接的传送，但将协议数据单元 POU 称为分组(packe t),而不是 IPv4 的 数据报 (da tagram) 。为方便起见，本书仍采用数据报这一名词 ([KUR017] 和 [TANEll] 也是 这样做的）。实际上，在本书中一直把分组和数据报看成是同义词。 1Pv6 所引进的主要变化如下： (1) 更大的地址空间。 lPv6 把地址从 1Pv4 的 32 位增大到 4 倍，即增大到 128 位，使地 址空间增大了 296 倍。这样大的地址空间在可预见的将来是不会用完的。 (2) 扩展的地址层次结构。 IPv6 由于地址空间很大，因此可以划分为更多的层次。 (3) 灵活的首部格式。 1Pv6 数据报的首部和 1Pv4 的并不兼容。 IPv6 定义了许多可选的 扩展首部，不仅可提供比 1Pv4 史多的功能，而且还可提高路由器的处理效率，这是因为路 由器对扩展首部不进行处理（除逐跳扩展首部外）． (4) 改进的选项。[Pv6 允许数据报包含有选项的控制信息，因而可以包含一些新的选项。 但 IPv6 的首部长度是固定的，其选项放在有效载荷中。我们知道， IPv4 所规定的选项是固 定不变的，其选项放在首部的可变部分。 (5) 允许协议继续扩充。这一点很重要，因为技术总是在不断地发展的（如网络硬件的 更新），而新的应用也还会出现。但我们知道'[Pv4 的功能是固定不变的。 (6) 支持即插即用（即自动配置）。因此 1Pv6 不衙要使用 DHCP 。 (7) 支持资源的预分配。 1Pv6 支持实时视像等要求保证一定的带宽和时延的应用。 (8) IPv6 首部改为 8 字节对齐（即首部长度必须是 8 字节的整数倍）。原来的 1Pv4 首部 是 4 字节对齐。 1Pv6 数据报由两大部分组成，即基本首部(base header) 和后面的有效载荷（payload) 。有 效载荷也称为净负荷。有效载荷允许有零个或多个扩展首部(extens i on header), 再后面是数 据部分（如图 4-32 所示）。但请注意，所有的扩展首部并不屈于 IPv6 数据报的基本首部。 [Pv6 数据报 发二二石石； 有 效 载 荷 40 字节： 不超过 65535 字节 I $已|… I 嘉以 1 数据部分 选项 00 4-32 具有多个可选扩展首部的 1Pv6 数据报的一般形式 与 IPv4 相比， IPv6 对首部中的某些字段进行了如下的更改： • 取消了首部长度字段，因为它的首部长度是固定的 (40 字节）。 • 取消了服务类型字段，因为优先级和流标号字段实现了服务类型字段的功能。 • 取消了总长度字段，改用有效载荷长度字段。 • 取消了标识、标志和片偏移字段，因为这些功能已包含在分片扩展首部中。 • 把 TTL 字段改称为跳数限制字段，但作用是一样的（名称与作用更加一致）。 • 取消了协议字段，改用下一个首部字段。 • 取消了检验和字段，这样就加快了路由器处理数据报的速度。我们知道，在数据链 • 150 •"}
{"doc_id": "network", "page": 162, "text": "路层对检测出有差错的帧就丢弃。在运输层，当使用 UDP 时，若检测出有差错的 用户数据报就丢弃。当使用 TCP 时，对检测出有差错的报文段就重传，直到正确 传送到目的进程为止。因此在网络层的差错检测可以精简掉。 • 取消了选项字段，而用扩展首部来实现选项功能。 由于把首部中不必要的功能取消了，使得!Pv6 首部的字段数减少到只有 8 个（虽然首 部长度增大了一倍）。 下面解释 1Pv6 基本首部中各字段的作用（参见图 4-33) 。 位 0 4 12  —1 版本 1 通信乐类 1Pv6 的 基本首部 (40 8)  有效载荷长度 16 24  流标勺 下二－个首部 1 跳数限制 目的地址 (128 位） 1Pv6 的 有效载荷 首部长度 首部长度 数据部分 3 l  扩展首部 1 扩展首部 2 图 4-33 1Pv6 基本首部和有效载荷（这里画出了两个扩展首部作为例子） (1) 版本 (vers i on) 占 4 位。它指明了协议的版本，对 1Pv6 该字段是 6 。 (2) 通信量类(tra ffi c class) 占 8 位。这是为了区分不同的 IPv6 数据报的类别或优先 级，和 IPv4 的区分服务字段的作用相似。目前正在进行不同的通信址类性能的实验。 (3) 流标号(fl ow label) 占 20 位。 1Pv6 的一个新的机制是支待资源预分配，并且允 许路由器把每一个数据报与一个给定的资源分配相联系。 1Pv6 提出流(flow) 的抽象概念。所 谓“流”就是互联网络上从特定源点到特定终点（单播或多播）的一系列数据报（如实时音 频或视频传输），而在这个“流”所经过的路径上的路由器都保证指明的服务质量。所有屈 千同一个流的数据报都具有同样的流标号。因此，流标号对实时音频／视频数据的传送特别 有用。对千传统的电子邮件或非实时数据，流标号则没有用处，把它置为 0 即可。关于流标 号的规约可参考建议标准[RFC 6437] 。 (4) 有效载荷长度(pa yload length) 占 16 位。它指明 IPv6 数据报除基本首部以外的字 节数（所有扩展首部都算在有效载荷之内）。这个字段的最大值是 64 KB (65535 字节）。 (5) 下一个首部(nex t header) 占 8 位。它相当千 1Pv4 的协议字段或可选字段。 • 当 IPv6 数据报没有扩展首部时，下一个首部字段的作用和 1Pv4 的协议字段一样， 它的值指出了基本首部后面的数据应交付 IP 层上面的哪一个高层协议（例如： 6  或 17 分别表示应交付运输层 TCP 或 UDP) 。 • 当出现扩展首部时，下一个首部字段的值就标识后面第一个扩展首部的类型。 • 151 •"}
{"doc_id": "network", "page": 163, "text": "(6) 跳数限制(ho p limit) 占 8 位。用来防止数据报在网络中无限期地存在。和 1Pv4 的生存时间字段相似。源点在每个数据报发出时即设定某个跳数限制（最大为 255 跳）。每 个路由器在转发数据报时，要先把跳数限制字段中的伯减 l 。当跳数限制的值为零时，就要 把这个数据报丢弃。 (7) 源地址 占 128 位。是数拟报的发送端的 IP 地址。 (8) 目的地址 占 128 付。是数据报的接收端的 IP 地址。 下面我们简单介绍一下fPv6 的扩展首部。 在 RFC 8200 中定义了以下六种扩展首部： （1)逐跳选项； （ 2) 路由选择： （ 3) 分片： (4)  鉴别； （ 5) 封装安令有效载荷： （6) 目的站选项。 每一个扩展首部都由若干个字段组成，它们的长度也各不同。但所有扩展首部的第一 个字段都是 8 位的“下一个首部”字段。此字段的值指出了在该扩展首部后面的扩展首部是 什么。当使用多个扩展首部时，应按以上的儿）丘顺片出现。商层门部总是放在砐后面． 大家知道， IPv4 的数据报若仕其首部中使用了选项，则什数据报转发路径中的每一个 路由器，都必须检查首部中的所有选项，石是否与本路山器相人。这必然要花费相当的时间。 JPv6 把原来 1Pv4 首部中选项的功能都放在扩展首部中。 1Pv6 数据报若使用了扩展首部，则 其基本首部的“下一个首部”字段会指出，仕“有效载仙”字段中使用了何种扩展首部。而 所有扩展首部的第一个字段都是“下～个首部”，用来指出在后面还有何种扩展首部。这就 使得路由器能够迅速判断待转发的 1Pv6 数据报有无需要本路由器处理的选项。 4.5.2 1Pv6 的地址 一般来讲，一个 IPv6 数据报的目的地址可以是以卜三种基本类型地址 之一： (I) 单播（un i cas t) 单播就是传统的点对点通信。 视躲讲梢 (2) 多播（mul ti cas t) 多播是一点对多点的通信，数据报发送到一组计算机中的每一个。 1Pv6 没有采用广播的术语，而是将「播行作多播的一个特例。 (3) 任播（an ycas t) 这是 IPv6 增加的一种类型。任播的终点是一组计箕机，但数据报 只交付其中的一个，通常是按照路由符法得出的距离最近的一个。 IPv6 把实现 1Pv6 的主机和路巾器均称为节点。由于一个节点可能会使用多条链路与其 他的一些节点相连，因此一个节点可能有多个与链路相连的接口。这样， 1Pv6 给节点的每 一个接口（请注意，不是给某个节点）指派一个 1Pv6 地址。一个具有多个接口的节点可以 有多个单播地址，而其中任何一个地址都可当作到达该节点的目的地址。不过有时为了方便， 若不会引起误解，也常说某个节点的 IPv6 地址，而把某个接口省略掉。 在fPv6 中，每个地址占 128 位，地址空间大千 3 .4 x1038 。如果整个地球表面（包括陆 地和水面）都覆盖卷计算机，那么 1Pv6 允许每平方米拥有 7x 1023 个J P 地址。如果地址分配 速率是每微秒分配 100 万个地址，则衙要 10“ 年的时间才能将所有可能的地址分配完毕。 可见在想象到的将来， IPv6 的地址空间是不可能用完的。 为了体会一下 1Pv6 的地址有多人，可以看一下目前已经分配出去的最大的地址块。法 国电信 France Telecom 和德国电信 Deu t sche Telekom 各分配到一个/1 9 地址块，相当于各有 35 X 1012 个地址，远远大千全部的 IPv4 地址(fPv4 地址还不到 4.3 X 109 个）。 巨大的地址范围还必须使维护互联网的人易于阅读和操纵这些地址。 IPv4 所用的点分 十进制记法现在也不够方便了。例如，一个用点分十进制记法的 128 位的地址为： • I 52 •"}
{"doc_id": "network", "page": 164, "text": "104.230.140.100.255.255.255.255.0.0.17.128.150.10.255.255  为了使地址再稍简洁些， !Pv6 仗用冒号十六进制记法 (colon hexadecimal nota ti on, 简写 为 colon hex), 它把每个 16 位的值用十六进制值表示，各值之间用冒号分隔。例如，如果前 伽所给的点分十进制数记法的值改为冒号十六进制记法，就变成了： 68E6:8C64:FFFF:FFFF:0:1180:960A:FFFF  在十六进制记法中，允许把数字前面的 0 省略。上面就把 0000 中的前三个 0 省略了。 冒号十六进制记法还包含两个技术使它尤其有用。首先，冒号十六进制记法可以允许 零压缩(zero comp ress i on), 即一连串连续的零可以为一对冒号所取代，例如： FFOS:0:0:0:0:0:0:B3  可压缩为： FF05::B3  为了保证笭几缩有 个不含涅的解释，规定在任一地址中只能使用一次零压缩。该技 术对已建议的分配策略特别有用，伪为会有许多地卅包含较长连续的零串。 其次，冒号十六进制记法可结合使用点分十进制记法的后缀。我们下面会看到这种结 合在 1Pv4 向 IPv6 的转换阶段特别有用。例如，下面的串是一个合法的冒号十六进制记法： 0:0:0:0:0:0:128.10.2.1  诮注惹、，在这种记法中，冒号所分隔的每个值是两个字节 (16 位）的值，但点分十进 制每个部分的伯是一个字节 (8 位）的值。再使用各压缩即可得出： ::128.10.2.1  下而再给出几个使用零压缩的例了。 1080:0:0:0:8:800:200C:417A 计~7'.l 1080: :8:800:200C:417A  FFOl:0:0:0:0:0:0:101 （多播地址） 记为 FFOl: : 101  0:0:0:0:0:0:0:1 （环回地址） 记为 : : 1  0:0:0:0:0:0:0:0 （未指明地址） 记为 ..  CIDR 的斜线表示法仍然可用。例如， 60 位的前缀 12ABOOOOOOOOCD3 （十六进制表 示的 15 个字符，每个字符代表 4 位二进制数字）可记为： 12AB:0000:0000:CD30:0000:0000:0000:0000/60  或 12AB: :CD30:0:0:0:0/60  或 12AB:0:0:CD30: :/60  但不允许记为： 12AB:0:0:CD3/60 （不能把 16 位地址 CD30 块中的最后的 0 省略） 或 12AB: :CD30/60 （这表示 12AB:0:0:0:0:0:0:CD30/60) 或 12AB: :CD3/60 （这表示 12AB:0:0:0:0:0:0:0CD3/60) 但是， IPv6 取消了子网掩码。 斜线的意思和 1Pv4 的悄况相似。例如， • 153 •"}
{"doc_id": "network", "page": 165, "text": "CIDR 记法的 2001:0DB8:0:CD30:123:4567:89AB:CDEF/60, 表示 lPv6 的地址是： 2001:0DB8:0:CD30:123:4567:89AB:CDEF 而其子网号是： 2001:0DB8:0:CD30: :/60  IPv6 的地址分类如表 4-7 所示 [RFC 4291] 。 表 4-7 1Pv6 的常用地址分类 地址类型 地址块前缀 前缀的 CIDR 记法 未指明地址 00…0 (128 位） ::/128  坏回地址 00··· I (128 位） :: 1/128  多播地址 11111111 FF00::/8  本地站点单播地址 1111111011 FEC0::/1 0  木地链路单播地址 1111111010 FE80::/I O  全球平播地址 见图 4.34 对表 4-7 所列举的几种常用地址简单解释如下。 未指明地址 这是 16 字节的全 0 地址，可缩写为两个冒号”: :“。这个地址不能用 作目的地址，而只能将某台主机当作源地址使用，条件是这台主机还没有配置到一个标准的 IP 地址。这类地址仅此一个。 环回地址 1Pv6 的环回地址是 0:0:0:0:0:0:0: 1,可缩写为： ： 1 。它的作用和 IPv4 的环回地址一样。这类地址也是仅此一个。 多播地址 功能和 1Pv4 的一样。这类地址占 1Pv6 地址总数的 1/256 。 本地站点单播地址(c ite-local unicast address) 有些单位的内部网络使用 TCP/lP 协议， 但并没有连接到互联网上。连接在这样的内部网络上的主机都可以使用这种本地站点地址进 行通信，但不能和互联网上的其他主机通信。这类地址占 1Pv6 地址总数的 1 /1 024, 其用途 和和 IPv4 的专用地址是一样的。 本地链路单播地址（ l i nk-local unicast address) 这种地卅是在单一链路土使用的。当一 个节点启用 1Pv6 时就自动生成本地链路地址（谘注意，这个节点现在并没有连接在某个网 络上）。当而要把分组发往单一链路的设备而不希望该分组被转发到此链路范围以外的地方 时，就可以使用这种特殊地址。这类地址占 1Pv6 地址总数的 1/1024 。 全球单播地址 1Pv6 的这一类单播地址是使用得最多的一类。曾提出过多种方案来进 一步划分这 128 位的单播地址。根据 2006 年发布的草案标准 RFC 4291 的建议， IPv6 单播 地址的划分方法非常灵活，可以是如图 4-34 所示的任何一种。这就是说，可把整个的 128 位都作为一个节点的地址。也可用 n 位作为子网前缀，用剩下的(128-n)位作为接口标识符 （相当千 IPv4 的主机号）。当然也可以划分为三级，用 n 位作为全球路由选择前缀，用 m 位作为子网前缀，而用剩下的(128-n-m) 位作为接口标识符。 节，厅．地J1I: (128 bit)  了网前缀 (11b it) I }妾门标识符 (128- n) bit  全球路「h 选择前组 (II bit) I 子网标识符 (111 bit) I 搂门标识符(128-n-m) bit  00 4-34 1Pv6 的单播地址的几种划分方法 • 154 •"}
{"doc_id": "network", "page": 166, "text": "4.5.3 从 IPv4 向J Pv6 过渡 由千现在整个可联网的规怢太大，因此，”规定一个日期，从这一天起 所有的路由器一律都改用 1Pv6\", 显然是不可行的。这样，向 1Pv6 过渡只 能采用逐步演进的办法，同时，还必须使新安装的 1Pv6 系统能够向后兼容。 ti寸 1 牲穸总` 回ttf回 视粒讲赔 这就是说， 1Pv6 系统必须能够接收和转发 1Pv4 分组，并且能够为 IPv4 分组选择路巾。 下面介绍两种向 !Pv6 过渡的策略，即使用双协议栈和使用隧递技术 [RFC 2473, 2529,  3056,4038,4213] 。 1 双协议栈 双协议栈(dual s t ack) 是指在完全过渡到 1Pv6 之前，使一部分主机（或路由器）同时装 有 IPv4 和 1Pv6 这两种协议栈。因此双协议栈生机（或路由器）既能够和 IPv6 的系统通信， 又能够和 1Pv4 的系统通信。双协议栈的主机（或路由器）记为 IPv6/1Pv4, 表明它同时具有 IPv6 地址和fPv4 地址（如图 4-35 所示）。 应 lI] 层 运输层 1Pv4 1Pv6  社路层和以下 I  到 1Pv4 系统 到叭6 系统 图 4-35 使用双协议栈进行从 IPv4 到 1Pv6 的过渡 双协议栈的主机在和 1Pv6 主机通信时采用 1Pv6 地址，而和 IPv4 主机通信时则采用 IPv4 地址。但双协议栈主机怎样知道目的主机是采用哪一种地址呢？它是使用域名系统 DNS 来查询的。若 DNS 返回的是 IPv4 地址，则双协议栈的源主机就使用 1Pv4 地址。但当 DNS 返回的是 IPv6 地址，源主机就使用 IPv6 地址。 双协议栈需要付出的代价太大，因为要安装上两套协议。因此在过渡时期，最好采用 下面的隧道技术。 2 隧道技术 向 IPv6 过渡的另一种方法是隧道技术(tunnel i ng)。图 4-36 给出了隧道技术的工作原理。 这种方法的要点就是在 IPv6 数据报要进入 1Pv4 网络时，把 IPv6 数据报封装成为 lPv4 数据 报。现在整个的 lPv6 数据报变成了 1Pv4 数据报的数据部分。这样的 IPv4 数据报从路由器 B 经过路由器 C 和 D, 传送到 E, 而原来的 IPv6 数据报就好像在[Pv4 网络的隧道中传输， 什么都没有变化。当 1Pv4 数据报离开 1Pv4 网络中的隧道时，再把数据部分（即原来的 IPv6 数据报）交给主机的 1Pv6 协议栈。图中的一条粗线表示在 1Pv4 网络中好像有一个从 B 到 E 的 “IPv6 隧道”，路由器 B 是隧道的入口而 E 是出口。请注意，在隧道中传送的数据报的源 地址是 B 而目的地址是 E. • 155 •"}
{"doc_id": "network", "page": 167, "text": "1Pv4 网络 1Pv6  A I  _::J  ,_____  流标号： X  源地址： A  目的地址： F  双协议栈 1Pv6/1Pv4  双协议栈 丿 1Pv6/1Pv4 、、`· 、· 、｀ 、.. `' ，、 气;,  ．，，气 IPv4 数据报 ·' ..,  •• :-1Pv4 网络 1Pv6 数据报 '  数据部分 ',、、',`、 'l-C j  仗才据数4 `. p  1Pv6  F I  一一二」 吵 - ...  流标号： X  源地址： A  目的地址： F  数据部分 LPv6 数据报 图 4-36 使用隧道技术进行从 1Pv4 到 1Pv6 的过渡 要使双协议栈的主机知道 1Pv4 数据报里面封装的数据是一个 LPv6 数据报，就必须把 TPv4 首部的协议字段的值设四为 41 (41 表示数据报的数据部分是 1Pv6 数据报）。 4.5.4 ICMPv6  和 1Pv4 一样， 1Pv6 也不保证数据报的可靠父付，因为互联网中的路由器可能会丢弃数 据报。因此 IPv6 也需要使用 ICMP 来反馈一些差铅信息。新的版本称为 ICMPv6, 它比 ICMPv4 要复杂得多。地址解析协议 ARP 和网际组管理协议 IGMP 的功能都已被合并到 ICM氏6 中（如图 4-37 所示）。 ICMP IGMP  1Pv4  ARP  版本 4 中的网络层 JCMPv6  lP`  版本 6 中的网络层 困 4-37 新旧版本中的网络层的比较 ICMPv6 是面向报文的协议，它利用报文来报告差错，获取信息，探测邻站或管理多播 通信。 ICMPv6 还增加了几个定义报文功能及含义的其他协议。在对 ICMPv6 报文进行归类 时，不同的文献和 RFC 文档使用了不同的策略，有的把其中的一些报文定义为 ICMPv6 报 文，而把另一些报文定义为邻站发现 ND (Ne ig hbor-D i scovery)报文或多播听众交付 MLD (Multicast Listener Deli ve ry)报文。其实所有这些报文都应当是 ICMPv6 报文，只是功能和作 用不同而已。因此我们把这些报文都列入 ICMPv6 的不同类别。使用这种分类方法的原因是 所有这些报文都具有相同的格式，并且所有报文类型都由 ICMPv6 协议处理。其实，像 ND 和 MLD 这样的协议都是运行在 ICMPv6 协议之下的。基千这样的考虑，可把 ICMPv6 报文 分类，如图 4-38 所示。诸注意，邻站发现报文和组成员关系报文分别是在 ND 协议和 MLD 协议的控制下进行发送和接收的。 • 156 •"}
{"doc_id": "network", "page": 168, "text": "组成员关系报文 I I  ND 协议 MLD 协议 图 4-38 ICMPv6 报文的分类 关十 ICMPv6 的进一步讨论可参阅 (FOROIO], 这里从略． 4.6 互联网的路由选择协议 本节将讨论几种常用的路由选择协议，也就是要讨论转发表中的路山是怎样得出的。 按照 4. l. 2 节所述的观点，路由选择协议屈千网络层控制层面的内容。不过本节仍然按传统 的思路进行讨论，也就是说，路由选择协议规定了互联网中有关的路由器应如何相互交换信 息并生成出路由表。 4.6.1 有关路由选择协议的几个基本概念 1 理想的路由算法 路由选择协议的核心就是路由算法，即需要何种算法来获得路由表中的各项目。一个 理想的路由算法应具有如下的一些特点 [BELL86): (I) 算法必须是正确的和完整的。这里，“正确＂的含义是：沿若各路由表所指引的路 由，分组一定能够最终到达目的网络和目的主机。 (2) 算法在计算上应简单。路由选择的计算不应使网络通信垃增加太多的额外开销。 (3) 算法应能适应通信量和网络拓扑的变化，这就是说，要有自适应性。当网络中的通 信扭发生变化时，算法能自适应地改变路由以均衡各链路的负载。当某个或某些节点、链路 发生故障不能工作，或者修理好了再投入运行时，算法也能及时地改变路由。有时称这种自 适应性为＂稳健性 ”(robustness) 。 1 (4) 算法应具有稳定性。在网络通信量和网络拓扑相对稳定的情况下，路由算法应收敛 于一个可以接受的解，而不应使得出的路由不停地变化。 (5) 算法应是公平的。路由选择算法应对所有用户（除对少数优先级尚的用户）都是平 等的。例如，若仅仅使某—对用户的端到端时延为最小，但却不考虑其他的广大用户，这就 明显地不符合公平性的要求。 (6) 算法应是最佳的。路由选择算法应当能够找出最好的路由，使得分组平均时延最小 而网络的吞吐扭最大。虽然我们希望得到“最佳＂的算法，但这并不总是最重要的。对千某 些网络，网络的可靠性有时要比最小的分组平均时延或最大吞吐址更加重要。因此，所谓 “最佳“只能是相对于某一种特定要求下得出的较为合理的选择而已。 一个实际的路由选择算法，应尽可能接近千理想的算法。在不同的应用条件下，对以 ＠注： robus tness 一词在自动控制界的标准译名是＂仵棒性”，但在[MINGCl94) 则译为＂粕健性”· • 157 •"}
{"doc_id": "network", "page": 169, "text": "卜提出的 6 个）j血也可付不同的侧重。 应、\",指出，路由选样是个非常复朵的问题，因为它足网络中的所（i节点共同协调工作 的钻火。其次，跺巾选抒的坏埮往往是不断变化的，血这种变化有时无认廿先知道，例如， 网络中出（某些故II平。此外，升网络发生拥塞时，就特别盂议｛ l能缓f甘这种拥塞的路山选择 策略，但恰好在这种条件下，很难从网络中的各节点获得所盂的路由选择信息。 倘若从路小邪认能否随网络的迪信愤或拓扑们还应地进行调整变化米划分，则只有内 大类，即静态路由选择策略勹动态路由选择策略。挣态路山选择也叫作非自适应路由选择， 具特．，坟足简单和丿「销较小，但不能及时适应网络状态的变化。对［很简 1y1．的小网络，完全可 以采川挣态路 rh 选择，川人！．．配置知．条路由。动态路山选抒也叫作自适应路由选择，其特 ＇，从是能奴好地适应网络状态的变化，但实现起米较为复杂，开销也比较大．囚此，动态路由 选抒适川千较复朵的大网络。 2 分层次的路由选择协议 I,．．联网采川的路由选抒协议主要是自适应的（即动态的）、分布式路由选择协议。由千 以下两个原因，,,:联网采川分）公次的路山选择协议： (I) 互联网的规模非祁人．。如果让所们的路巾器知道所付的网络应怎样到达，则这种路 由农将 l~ 常大，处理起来也太花时间。曲所有这些路由器之间交换路由信息所面的带宽就会 使,,:联网的通亿链路饱和。 (2) 许多单位小愿总外界（解自己单位网络的布局细节和本部门所采川的路 rh 选择协议 （这屈千本部 1、」内部的事悄），但同时还希望连接到凡联网 I·.• 为此，可以把整个互联网划分为许多较小的自治系统(au t onomous sys t em), 一般都记为 AS 。自治系统 AS 是在单一技术管理卜的许多网络、 IP 地址以及路由器，而这些路山器使用 一种 (I 治系统内部的路由选择协议和共同的度量。符一个 AS 对从他 AS 及现出的是一个单一 的和一致的路由选择策略[RFC 4271] 。这样，互联网就把路由选抒协议划分为两大类，即： (I) 内部网关协议 IGP (Interior Gateway Protocol) 即在个自治系统内部使川的路由 选择协议，而这与在互联网中的其他自治系统选川什么路巾选择协议无关。目前这类路由选 择协议使用得最多的是 RIP 和 OSPF 协议 (IS-IS 协议也很流行，但不介绍（）。 (2) 外部网关协议 EGP (External Gateway Protocol) 若源主机和 1-1 的主机处在不同的 自治系统中（这曲个自治系统可能仗川个问的内部网关协议），那么在不同自治系统 AS 之 间的路山选择，就盂要使用外部网关协议 EGP 。目前使用垃多的外部网关协议是 BGP 的版 本 4 (BGP-4) 。 I,I 治系统之间的路由选择也叫作域间路由选择（i n terdoma i n rou ti n g),而在自治系统内部 的路巾选择叫作域内路由选择(intradoma i n rou ti n g)。 佟I 4-39 是两个自治系统互连在起的示意图。每个自治系统自己决定在本自治系统内 部运们哪一个内部路由选择协议（例如，可以是 RIP, 也可以处 OSPF) 。但每个自治系统都 有个或多个路由器（图中的路由器 R1 和 R2) 除运行本系统的内部路山选择协议外，还要 运行自治系统间的路由选择协议 CBGP-4) 。 • 158 •"}
{"doc_id": "network", "page": 170, "text": "自治系统 A R lIl 外部网关协议 L （例如， BGP-4) 、 §2 一一 用内部网关协议） 自治系统 B \\ （例如， OSPF) ＼、一一一 图 4-39 自治系统和内部网关协议、外部网关协议 这里我们要指出两点： (l) 互联网的早期 RFC 文档中未使用“路由器”而是使用“网关”这一名词。但是在 后来的 RFC 文档中又改用“路由器”这一名词，因此有的书把原来的 lGP 和 EGP 分别改为 IRP （内部路由器协议）和 ERP （外部路由器协议）。为了方便读者查阅 RFC 文档，本书仍 使用 RFC 原先使用的名字 IGP 和 EGP 。 (2) RFC 采用的名词 IGP 和 EGP 是协议类别的名称。但 RFC 在使用名词 EGP 时出现了 一点混乱，因为最早的一个外部网关协议的协议名字正好也是 EGP [RFC 827] 。后来发现该 RFC 提出的 EGP 有不少缺点，就设计了一种更好的外部网关协议，叫作边界网关协议 BGP (Border Gateway Pro tocol), 用来取代旧的 RFC 827 外部网关协议 EGP 。实际上，旧协议 EGP 和新协议 BGP 都屈于外部网关协议 EGP 这一类别。因此在遇到名词 EGP 时，应弄清 它是指旧协议 EGP （即 RFC 827) 还是指外部网关协议 EGP 这个类别。 总之，使用分层次的路由选择方法，可将互联网的路由选择协议划分为： • 内部网关协议 IGP: 具体的协议有多种，如 RlP 和 OSPF 等。 • 外部网关协议 EGP: 目前使用的协议是 BGP-4 。 对千比较大的自治系统，还可将所有的网络再进行一次划分。例如，可以构筑一个链 路速率较高的主干网和许多速率较低的区域网。每个区域网通过路由器连接到主干网。当在 一个仅域内找不到目的站时，就通过路由器经过主干网到达另一个区域网，或者通过边界路 由器到别的自治系统中去查找。下面对这两类协议分别进行介绍。 4.6.2 内部网关协议 RIP 1. 协议 RIP 的工作原理 RIP (Routing lnfonnation Pro t ocol) 是内部网关协议 IGP 中最先得到广泛 扫．扫 使用的协议[RFC 1058], 它的中文译名是路由信息协议。 RIP 是一种分布式 视频讲解 的基于距离向量的路由选择协议，是互联网的标准协议，其最大优点就是简单。 RIP 协议要求网络中的知一个路由器都要维护从它自己到其他每一个目的网络的距离记 录（因此，这是一组距离，即“距离向缢＂）。协议 RIP 将“距离“定义如下： 从一路由器到自接连接的网络的距离定义为 1 。从一主机到非直接连接的网络的距离定 义为所经过的路由器数加 1 。”加 l \"是因为到达目的网络后就进行直接交付（不孟要再经过 路由器），而到直接连接的网络的距离已经定义为 l 。 协议 RlP 的＂距离”'也称为“跳数”。)o p count),并且每经过一个网络，跳数就加 1 。 RJ P 认为好的路巾就是它通过的网络数目少，即“距离短\"。 RIP 允许一条路径砓多只能包含 15 个网络。因此＂距离”等于 16 时即相当千不可达。可见 RIP 只适用于小型互联网。 @ tl 这小的\"J/1 ，离“实协 l ．．指的足“如氓离＂．但为力便起见i Ht'fi略最短＇ ．宁． • 159 •"}
{"doc_id": "network", "page": 171, "text": "例如在前面的图 4-7 中，主机凡经过 5 个路由器连接到另·个主机 H2, 中间经过了 6 个网络或经过 6 跳。或者说，凡到 H2 的距离是 6 。在图中并没有曲出网络。在讨论路由选 扦问题时，在主机和路由器之间或在路由器之间的网络，往往都用一条线段来表示。需要注 总的是，到直接连接的网络的距离也可定义为 0 。但这两种不同的定义对实现协议阳P 并无 影响，因为这对选择最佳路由的过程其实是一样的。 RIP 不能在两个网络之间同时使用多条路由。 RlP 选择一条具有砐少网络数的路由（即 砓短路由），哪怕还存在另一条高速（低时延）但网络数较多的路由。 本节讨论的 R1P 协议和下一节要讨论的 OSPF 协议，都是分布式路由选择协议。它们的 共同特点就是每一个路由器都要不断地和其他一些路巾器父换路由信息。我们一定要弄清以 下三个要点，即和哪些路由器交换信息？交换什么信息？在什么时候交换信息？ 协议 RIP 的特点是： (I) 仅和相邻路由器交换信息。如果两个路由器之间的通信不需要经过另一个路由器， 那么这两个路由器就是相邻的。协议 RIP 规定，不相邻的路由器不交换信息。 (2) 路由器交换的信息是当前本路由器所知道的全部信息，即自己现在的路由表。也就 是说，交换的信息是：“我到本自治系统中所有网络的（最短）距离，以及到每个网络应经 过的下一跳路由器”。 (3) 按固定的时间间隔交换路由信息，例如，每隔 30 秒。然后路由器根据收到的路由 信息更新路由表。当网络拓扑发生变化时，路由器也及时向相邻路由器通告拓扑变化后的路 由信息。网络中的主机虽然也运行协议 RIP, 但只被动地接收路由器发米的路由信息。 这里要强调一点：路由器在刚刚开始工作时，它的路由表是空的。然后路由器就得出 到直接相连的几个网络的距离（这些距离定义为 1) 。接若，每一个路由器也只和数目非常 有限的相邻路由器交换并更新路由信息。但经过若干次的更新后，所有的路由器最终都会知 道到达本自治系统中任何一个网络的最短距离和下一跳路由器的地址。 石起来协议 RIP 有些奇怪，因为“我的路由表中的信息要依赖十你的，面你的信息又 依赖千我的。”然而事实证明，通过这样的方式一一“我告诉别人 些信息，而别人又告诉 我一些信息。我再把我知道的更新后的信息告诉别人，别人也这样把史新后的信息再告诉 我”，最后在自治系统中所有的节点都得到了正确的路由选择信息。在一般悄况下，协议 RTP 可以收敛，并且过程也较快。＂收敛”就是在自治系统中所有的节点都得到正确的路由 选择信息的过程。 路由表中最主要的信息就是：到某个网络的距离（即最短距离），以及应经过的下一跳 地址。路由表更新的原则是找出到每个目的网络的最短距离。这种更新算法又称为距离向量 算法。下面就是协议 RIP 使用的距离向扫算法。 2. 距离向量算法 对每一个相邻路由器发送过来的 RlP 报文，执行以下步骤： (I) 对地址为 X 的相邻路由器发来的 RIP 报文，先修改此报文中的所有项目：把“下一 跳”字段中的地址都改为 X, 并把所有的＂距离”字段的值加 1 （见后面的解释 l) 。每一个 项目都有二个关键数据，即：到目的网络 Net,距离是 d, 下一跳路由器是 X 。 (2) 对修改后的 RTP 报文中的每一个项目，进行以下步骤： 若原来的路由表中没有目的网络 Net,则把该项目添加到路由表中（见解释 2) 。 否则（即在路由表中有目的网络 Net,这时就再查看 F 一跳路由器地址）。 • 160 •"}
{"doc_id": "network", "page": 172, "text": "若下一跳路由器地址是 X ，则把收到的项目替换原路由表中的项目（见解释 3) 。 否则（即这个项目是：到目的网络 Net,但下一跳路由器不是 X) 。 若收到的项目中的距离 d 小于路由表中的距离，则进行更新（见解释 4), 否则什么也不做（见解释 5) 。 (3) 若 3 分钟还没有收到相邻路由器的更新路由表，则把此相邻路由器记为不可达的路 由器，即把距离置为 16 （距离为 16 表示不可达）。 (4) 返回。 上而给出的距离向量算法的基础就是 Bellman-Ford 算法（或 Ford-Fulkerson 算法）。这 种算法的要点是这样的： 设 X 是节点 A 到 B 的最短路径上的一个节点。若把路径 A-B 拆成两段路径 A一 X 和 X-B ，则每一段路径 A-X 和 X 一 B 也都分别是节点 A 到 X 和节点 X 到 B 的最短路径。 下面是对上述距离向蜇算法的五点解释。 解释 I :这样做是为了便千进行本路由表的更新。假设从位于地址 X 的相邻路由器发来 的 RIP 报文的某一个项目是： “Net 2, 3, Y\", 总思是“我经过路由器 Y 到网络 Net2 的距离是 3\", 那么本路由器就可推断出：“我经过 X 到网络 Net2 的距离应为 3+1=4” 。于是，本路 由器就把收到的 RIP 报文的这一个项目修改为 “Net2, 4, X\", 作为下一步和路由表中原有项 目进行比较时使用（只有比较后才能知道是否需要更新）。读者可注意到，收到的项目中的 Y 对本路由器是没有用的，因为 Y 不是本路由器的下一跳路由器地址。 解释 2: 表明这是新的目的网络，应当加入到路由表中。例如，本路由表中没有到目的 网络 Net2 的路山，那么在路由表中就要加入新的项目 “Net2, 4. X” 。 解释 3: 为什么要替换呢？因为这是最新的消息，要以最新的消息为准。到目的网络的 距离有可能增大或减小，但也可能没有改变。例如，不管原来路由表中的项目是 “Net2, 3,  X\" 还是 “Net2, 5, X\", 都要更新为现在的 “Net2, 4, X”。 解释 4: 例如，若路由表中已有项目 “Net2, 5, P\", 就要更新为 “Net 2, 4, X” 。因为到网 络 Net2的距赵原来是 5, 现在减到 4, 更短了。 解释 5: 若距离更大了，显然不应更新。若距离不变，更新后得不到好处，因此也不更新。 【例 4-4 】已知路由器 R6 有表 4-8(a) 所示的路由表。现在收到相邻路由器凡发来的路 由更新信息，如表 4-8(b) 所示。试史新路由器凡的路由表。 表 4-8(a) 路由器氏的路由表 目的网络 距离 Net2  Nct3  、`- 下一跳路由器 凡 4 R;  表 4-8(b) 凡发来的路由更新信息 目的网络 距离 下一跳路由器 Nell 3 R,  Nc12 4 R:  Ne13 I H接交付 • I 6 I •"}
{"doc_id": "network", "page": 173, "text": "［解】 如同路由器一样，找们个需要知道该网络的拓扑。 先把表 4-8(b) 中的距离都加 l ，并把下一跳路由器都改为凡，得出表 4-8(c) 。 表 4-8(c) 修改后的表 4-8(b) 目的网络 距离 下一跳路由器 Nell 4 R,  Net2 5 R•  Nc13 2 R,  把这个表的每一行和表 4-8(a) 进行比较。 第一行在表 4-8(a) 中没有，闪此要把这一行添加到表 4-8(a) 中。 第二行的 Net2 在表 4-8(a) 中有，且下一跳路由器也是 R4 。囚此要更新（距离增大了）。 第三行的 Net3 在表 4-8(a) 中有，但下一跳路由器不同。干是就要比较距离。新的路由 信息的距离是 2, 小于原来表中的 4, 因此要更新。 这样，得出更新后的 R6 的路由表如表 4-8(d) 所示。 表 4-8(d) 路由器氏更新后的路由表 目的网络 距离 下一跳路由器 NC11 4 R,  Net2 5 R.  NCl3 2 RJ  ... ... ...  协议 RIP 让一个自治系统中的所有路由器都和自己的相邻路由器定期交换路由信息， 并不断更新其路由表，使得从每一个路由器到每一个目的网络的路由都是最短的（即跳数最 少）。这里还应注意：虽然所有的路由器最终都拥有了整个自治系统的全局路由估息，但由 千母一个路由器的位置不同，它们的路由表当然也应当是不同的。 现在较新的 RIP 版本是 1998 年 11 月公布的 RlP2 [RFC 2453, STD57], 新版本协议本 身并无多大变化，但性能上有些改进。 RIP2 可以支持九分类域间路由选择 CIDR 。此外， RIP2 还提供简单的鉴别过程支持多插。 图 4-40 表明 RIP 报文作为运输层用户数据报 UDP 的数据部分进行传送（使用 UDP 的 端口 520 。端口的意义见 5.2.2 节）。 首部 路山部分 勹晶 I ＄眢—— RlP 报:-二——| l 尸二｀：心P 川／数札，报———1 图 4-40 RIP2 的报文用 UDP 用户数机报传送 RlP 报义由首部和路由部分组成。在路由部分要填入自治系统号 ASN (Au tonomous  • 162 •"}
{"doc_id": "network", "page": 174, "text": "System Number)', 这是考虑使 RIP 有可能收到本自治系统以外的路由选择信息。还要指出 目的网络地址（包括网络的子网掩码）、下一跳路由器地址以及到此网络的距离。一个 RIP 报文最多可包括 25 个路由。如超过，必须再用一个 RIP 报文来传送。 3. 坏消息传播得慢 RTP 存在的～个问题是当网络出现故障时，要经过比较长的时间才能将此信息传送到所 有的路由器。我们可以用图 4-41 的简单例子来说明。设三个网络通过两个路由器互连起来， 并且都已建寸了各自的路由表。图中路由器交换的信息只给出了我们感兴趣的一行内容。路 由器 R, 中的 “Nett, I, 直接”表示”到网 Net l 的距离是 I, 直接交付＂。路由器 R2 中的 \"Ne t l,2, R1\" 表示”到网 Nett的距离是 2, 下一跳经过 R,“。 正常情况 沁 I. 16, 直围＝ ¢:::,I Nc11.2. R, I  I Net l 、 3,R2 l~  <=I Net I. 4, R1 I I NCl l ` 5, R2 l 一 I Net I. 16. Rd=:> 弓 Ne t I, 16, R,l  图 4-41 协议 RIP 的缺点：坏泊息传播得慢 现在假定路由器凡到网 Net 1 的链路出了故障， R1 无法到达网 Net!。千是路由器凡把 到网 Netl的距离改为 16, 表示不可达，因而在凡的路由表中的相应项目变为 “Net l, 16,  直接＂。但是，很可能要经过 30 秒钟后凡才把更新信息发送给 R2 。然而 R2 可能已经先把 自己的路由表发送给了 Rl ，其中有 “Net I, 2, R1\" 这一项。 凡收到 R2 的更新报文后，误认为可纾过凡到达网 Net!,千是把收到的路由信息 \"Ne t!, 2, R1\" 修改为： “Net l, 3, R2\", 表明“我到网 Net I 的距离是 3, 下一跳经过 R2\", 并 把更新后的信息发送给 R狂 同理，凡接右又更新自己的路由表为 “Net l, 4, R 广，以为“我到网 Ne t l 距离是 4, 下 一跳经过 R 广＇。 这样的更新一直继续下去，直到 R1 和 R2 到网 Net 1 的距离都增大到 16 时，凡和 R2 才 知道原来网 Net 1 是不可达的。协议 RIP 的这一特点叫作：好消息传播得快，而坏消息传播 得慢。网络出故障的传播时间往往较长（例如数分钟）。这是 RIP 的一个主要缺点。 但如果一个路由器发现了更短的路由，那么这种更新信息就传播得很快。 ＠注： I1 治系统 l; ASN I氛米规定为一个 16 小·1 的句砃（垃大的另码丛 65535 l. 1h IANA 分化，儿休伯巧码指派范闱相当 复杂．可从网曰？出 [W-ASN] 。现（f已经把 ASN 扩展到 32 位[RFC 6793] 。白 2007 年 1 月起． 32 位 l'i治系统月 ASN 在令球 1 i联 网开始分斤！和使用。为（便千书寸，在 32 位 ASN 中使川两段点分 1 进制记认，把 65535 (J:第 1 段中记为 1 ．例如， ASN 131074  可以记为 ASN 2 .4。 • 163 •"}
{"doc_id": "network", "page": 175, "text": "为了使坏消息传播得更快些，可以采取多种措施。例如，让路由器记录收到某特定路 由信息的接口，而不让同一路由信息再通过此接口向反方向传送。 总之，协议 RlP 最大的优点就是实现简单，开销较小。但协议 RlP 的缺点也较多。首 先， RIP 限制了网络的规模，它能使用的最大距离为 15 (16 表示不可达）。其次，路由器之 间交换的路由信息是路由器中的完整路由表，因而随沽网络规模的扩大，开销也就增加。最 后，“坏消息传播得慢＂，使更新过程的收敛时间过长。因此，对千规模较大的网络就应当使 用下一节所述的 OSPF 协议。然而目前在规模较小的网络中，使用协议 RlP 的仍占多数。 4.6.3 内部网关协议 OSPF 1. 协议 OSPF 的基本特点 这个协议的名字是开放最短路径优先 OSPF (Open Shortest Path Fi rst)。 扫一扫 蕾 它是为克服 RlP 的缺点在 1989 年开发出来的。 OSPF 的原理很简单，但实 视知讲解 现起来却较复杂。”开放”表明 OSPF 协议不是受某一家厂曲控制，而是公开发表的。＂蛊短 路径优先”是因为使用了 Dij ks t ra 提出的最短路径算法 SPF 。现在使用的协议 OSPF 是第 二个版本 OSPFv2 [RFC 2328, STD54] 。关于 OSPF 可参阅专茗 [MOY98], [l-I UIT95] 。 请注意： OSPF 只是一个协议的名字，它并不表示其他的路由选择协议不是“最短路径 优先＂。实际上，所有的在自治系统内部使用的路由选择协议（包括协议 RIP) 都是要寻找 一条酘短的路径。 OSPF 最主要的特征就是使用链路状态协议(l i nk state p ro tocol), 而不是像 RlP 那样的距 离向蜇协议。协议 OSPF 的特点是： (I) 向本自治系统中所有路由器发送信息。这里使用的方法是洪泛法(fl ood i n g),这就是 路由器通过所有输出端口向所有相邻的路由器发送伯息。而每一个相邻路由器又再将此信息 发往具所有的相邻路由器（但不再发送给刚刚发来信息的那个路由器）。这样，砓终整个区 域中所有的路由器都得到了这个信息的一个副本。更具体的做法后面还要讨论。我们应注意， 协议 RIP 是仅仅向自己相邻的几个路由器发送信息。 (2) 发送的信息就是与本路由器相邻的所有路由器的链路状态，但这只是路由器所知道 的部分信息。所谓“链路状态”就是说明本路由器都和哪些路由器相邻“，以及该链路的 ＂度量 ”(metr i c) 。 OSPF 将这个＂度拉“用来表示费用、距离、时延、带宽，等等。这些都 由网络管理人员来决定，因此较为灵活。有时为了方便就称这个度沁为“代价”。我们应注 意，对千协议 RIP, 发送的信息是：”到所有网络的距离和下一跳路由器”· (3) 当链路状态发生变化或每隔一段时间（如 30 分钟），路山器向所有路由器用洪泛法 发送链路状态信息。 从上述的前两点可以看出， OSPF 和 RIP 的工作原理相差较大。 由于各路由器之间频繁地交换链路状态信息，因此所有的路巾器最终都能建立一个链 路状态数据库(link-s ta te da tabase), 这个数据库实际上就是全网的拓扑结构图。这个拓扑结 构图在全网范围内是一致的（这称为链路状态数据库的同步）。因此，每一个路由器都知道 ＠汴：在前面我们已经说过，在讨论路由器之间是如何交换路由旧息时．砓好将路由陪之间的网络简化为一条链路． OSPF 的＂链路状态”中的＂链跺“实际 1-就是指“和这两个路由器都付接 LI 的网络 ”b • 164 •"}
{"doc_id": "network", "page": 176, "text": "全网共有多少个路由器，以及哪些路由器是相连的，其代价是多少，等等。每一个路由器使 用链路状态数据库中的数据，构造出自己的路由表（例如，使用 Dij ks t ra 的最短路径路由絊 法）。我们注意到，协议 RTP 的每一个路由器虽然知道到所有的网络的距离以及下一跳路由 器，但却不知道全网的拓扑结构（只有到了下一跳路由器，才能知道再下一跳应当怎样走）。 OSPF 的链路状态数据库能较快地进行更新，使各个路由器能及时更新其路山表。 OSPF 的更新过程收敛得快是其重要优点。 为了使 OSPF 能够用于规模很大的网络， OSPF 将一个自治系统再划分为若干个更小的 范围，叫作区域(area) 。图 4-42 就表示一个自治系统划分为四个区域。每一个区域都有一个 32 位的区域标识符（用点分十进制形式表示）。当然，一个区域也不能太大，在一个区域内 的路由器最好不超过 200 个。 划分区域的好处就是把利用洪泛法交换链路状态信息的范围局限十每一个区域而不是 整个的自治系统，这就减少了整个网络上的通信植。在一个区域内部的路由器只知道本区域 的完整网络拓扑，而不知道其他区域的网络拓扑的情况。为了使每一个区域能够和本区域以 外的区域进行通信， OSPF 使用层次结构的区域划分。右上层的区域叫作主干区域(backbone area) 。主干区域的标识符规定为 0.0.0.0 。主十区域的作用是用来连通其他在下层的区域。从 其他区域来的信息都由区域边界路由器(area border rou t er) 进行概括。在图 4-4 2 中，路由器 R3，民和民都是区域边界路由器，而显然，每一个区域至少应当有一个区域边界路由器。 在主干区域内的路由器叫作主干路由器(backbone rou ter), 如 R3, 凡， R5 ，凡和 R7 。一个主干 路由器可以同时是区域边界路由器，如 R3, 凡和 R7 。在主干区域内还要有一个路由器专门 和本自治系统外的其他自治系统交换路由信息。这样的路由器叫作自治系统边界路由器（如 图 4-42 中的凡）。 令．．其他自治系统 自治系统 AS 图 4-42 OSPF 划分为两种个同的区域 采用分层次划分区域的方法虽然使交换信息的种类增多了，同时也使 OSPF 协议更加复 杂了。但这样做却能使每一个区域内部交换路由信息的通信量大大减小，因而使 OSPF 协议 能够用于规模很大的自治系统中。这里，我们再一次地看到划分层次在网络设计中的重要性。 除了以上的几个基本特点外， OSPF 还具有下列的一些特点： (I) OSPF 允许管理员给每条路由指派不同的代价。例如，离带宽的卫星链路对于非实 时的业务可设置为较低的代价，但对千时延敏感的业务就可设置为非常高的代价。因此， OSPF 对千不同类型的业务可计算出不同的路由。链路的代价可以是 1 至 65535 中的任何一 个无位纲的数，因此十分灵活。商用的网络在使用 OSPF 时，通常根据链路带宽来计算链路 • 165 •"}
{"doc_id": "network", "page": 177, "text": "的代价。这种灵活性是 RIP 所没有的。 (2) 如果到同一个目的网络有多条相同代价的路径，那么可以将通估她分配给这几条路 径。这叫作多路径间的负载均衡(load balanc i n g)。在代价相同的多条路径上分配通信豐是通 信扴「程中的简单形式。 R1P 只能找出到某个网络的一条路径。 (3) 所有在 OSPF 路由器之间交换的分组（例如，链路状态更新分组）都具有鉴别的功 能，因而保证了仅在可信赖的路由器之间交换链路状态1；汇息。 (4) OSPF 支持可变长度的千网划分和尤分类的编址 CIDR 。 (5) 由于网络中的链路状态可能经常发生变化，因此 OSPF 让每一个链路状态都带上一 个 32 位的序号，序号越人状态就越新。 OSPF 规定，链路状态序号增长的速率不得超过每 5 秒钟 1 次。这样，全部序号空间在 600 年内不会产生正复号。 2. OSPF 的五种分组类型 OSPF 共有以下五种分组类型： (I) 类型 l ，问候(Hello) 分组，用来发现和维持邻站的可达性。 (2) 类型 2, 数据库描述(Da t abasc Desc ripti on) 分组，向邻站给出自己的链路状态数据库 中的所有链路状态项目的摘要信息。 (3) 类型 3 ，链路状态请求(L i nk State Req ues t)分组，向对方诮求发送某些链路状态项目 的详细信息。 (4) 类型 4, 链路状态更新(L i nk State Up da te) 分组，用洪泛法对全网更新链路状态。这 种分组是最复杂的，也是 OSPF 协议最核心的部分。路由器使用这种分组将其链路状态通知 给邻站。链路状态更新分组共有五种不同的链路状态 [RFC 2328), 这里从略。 (5) 类型 5 ，链路状态确认(L i nk State Ack.nowledg men t)分组，对链路史新分组的确认。 OSPF 分组是作为 IP 数据报的数据部分来传送的（如图 4-43 所示）。 OSPF 不用 UDP 而 是直接用 IP 数据报传送（其 IP 数据报首部的协议字段们为 89) 。 OSPF 构成的数据报很短。 这样做可减少路由信息的通信矗。数据报很短的另一好处是可以不必将长的数据报分片传送。 分片传送的数据报只要丢失一个，就无法组装成原来的数祸报，而整个数据报就必须平传。 OSPF 分纠凸部 1 类型 1 个．类型 5 的 OSPF 分组 IP 数趴报计，叫 OSP 尸｝组 IP 数据报 图 4-43 OSPF 分组用 IP 数斟报传送 OSPF 规定，知两个相邻路由器每隔 10 秒钟要交换一次问候分组。这样就能确知哪些 邻站是可达的。对相邻路由器来说，“可达”是最基本的要求，囚为只有可达邻站的链路状 态信息才有入链路状态数据库（路由表就是根据链路状态故据库计算出米的）。在正常情况 下，网络中传送的绝大多数 OSPF 分组都是问候分组。若有 40 秒钟没有收到某个相邻路由 器发来的问候分组，则可认为该相邻路巾器是不可达的，J立立即修改链路状态数据府，并重 新计算路由表。 其他的四种分组都是用来进行链路状态数据库的同步。所诮同步就是指不同路由器的 • 166 •"}
{"doc_id": "network", "page": 178, "text": "链路状态数据库的内容是一样的。两个同步的路由器叫作“完全邻接的\"(full y adj acen t)路 由器。不是究全邻接的路由器表明它们虽然在物理上是相邻的，但其链路状态数据库并没有 达到一致。 当一个路由器刚升始工作时，它只能通过问候分组得知它有哪些相邻的路由器在工作， 以及将数据发往相邻路由器所伽的”代价＂。如果所有的路由器都把自己的本地链路状态估 息对全网进行广播，那么各路由器只要将这些链路状态信息综合起来就可得出链路状态数据 库。但这样做开销太大，因此 OSPF 采用下面的办法。 OSPF 让每一个路由器用数据库描述分组和相邻路由器父换本数据痄中已有的链路状态 摘要信息。摘要信息土要就是指出有哪些路山器的链路状态估息（以及其｝一、f号）已经与入了 数据库。经过与相邻路由器交换数据库描述分组后，路由器就使用链路状态请求分组，向对 方请求发送自己所缺少的某些链路状态项目的详细信息。通过一系列的这种分组交换，全网 同步的链路数据库就建立了。 祚网络运行的过程中，只要一个路由器的链路状态发生变化，该路由器就要使用链路 状态更新分组，用洪泛法向全网更新链路状态。 OSPF 使用的是可靠的洪泛法，其婓点如 图 4-44 所示。设路巾器 R 用洪泛法发出链路状态更新分组。图中用一些小的箭头表示更新 分组。第一次先发给相邻的三个路由器。这三个路由器将收到的分组再进行转发时，要将其 上游路由器除外。可靠的洪泛法是在收到更新分组后要发送确认（收到重复的更新分组只需 要发送 次确认）。图中的空心箭头表示确认分组。 t  ”了～ ，一 I  t3  飞匕 l厂－＼＼气丿 ACK报义已勹／尸 t R~  二户 图 4-44 用可靠的洪泛法发送更新分组 为了确保链路状态数据库与全网的状态保持一致， OSPF 还规定每隔一段时间，如 30 分钟，要刷新一次数据库中的链路状态。 由于一个路由器的链路状态只涉及与相邻路由器的连通状态，因而与整个互联网的规 模并无直接关系。因此当互联网规模很大时， OSPF 协议耍比距离向泣协议 RIP 好得多。由 于 OSPF 没有“坏消息传播得慢＂的问题，据统计，其响应网络变化的时间小千 100 ms 。 若 N 个路由器连接在一个以太网上，则每个路由器要向其他(N - 1) 个路由器发送链路 状态信息，因而共有 N(N-1) 个链路状态要在这个以太网上传送。 OSPF 协议对这种多点接 • 167 •"}
{"doc_id": "network", "page": 179, "text": "入的局域网采用了指定的路由器(des ig na ted rou ter) 的方法，使广播的信息量大大减少。指定 的路由器代表该局域网上所有的链路向连按到该网络上的各路由器发送状态信息。 4.6.4 外部网关协议 BGP 1. 协议 BGP 的主要特点 在外部网关协议（或边界网关协议） BGP 中，现在使用的是第 4 个版 本 BGP-4 （常简写为 BGP) 。虽然最近陆续发布了不少 BGP-4 的更新文档， 视频讲觯 但目前 BGP-4 仍然是草案标准 [RFC 4271] 。协议 BGP 对互联网非常亟要。我们知道，前面 两节所介绍的路巾选择协议 RIP 和 OSPF, 都只能在一个自治系统 AS 内部工作。因此，若 没有协议 BGP, 那么分布在全世界数以万计的 AS 都将是一个个没有联系的孤岛。正是由千 有了 BGP 这种黏合剂，才使得这么多的 AS 孤岛能够连接成一个完整的互联网。从这个意 义上考虑，协议 BGP 应当是所有路巾选抒协议中最为项要的一个。 找们首先应当弄清，在不同自治系统 AS 之间的路由选择为什么不能使用前面讨论过的 内部网关协议，如 RIP 或 OSPF? 我们知道，内部网关协议（如 RIP 或 OSPF) 主要是设法使数据报在一个 AS 中尽可能 有效地从源站传送到目的站。在一个 AS 内部也不需要考虑其他方面的策略。然而 BGP 使 用的环境却不同。这主要是因为以下的内个原因： 第一，互联网的规模太大，使得自治系统 AS 之间路由选择非常困难。连接在互联网主 干网上的路由器，必须对任何有效的 lP 地址都能在转发表中找到匹配的网络前缀。目前在 互联网的主干网路由器中，一个转发表的项目数甚至可达到 50 万个网络前缀。如果使用链 路状态协议，则每一个路由器必须维待一个很大的链路状态数据库。对于这样大的主干网用 Dij ks t ra 算法计3t最短路径时花费的时间也太长。另外，由于自治系统 AS 各自运行自己选 定的内部路由选择协议，并使用本 AS 指明的路径度量，因此，当一条路径通过几个不同 AS 时，要想对这样的路径计算出有意义的代价是不太可能的。例如，对某 AS 来说，代价 为 1000 可能表示一条比较长的路由。但对另一 AS, 代价为 1000 却可能表示不可接受的坏 路由。因此，对于自治系统 AS 之间的路巾选择，要用“代价”作为度扭来寻找最佳路由也 是很不现实的。比较合理的做法是在自治系统之间交换”可达性”信息（即“可到达”或 “不可到达”)。例如，告诉相邻路由器：“到达网络前缀 N 可经过自治系统 ASX” 。 第二，自治系统 AS 之间的路由选择必须考虑有关策略。由千相互连接的网络的性能相 差很大，根据蛟短距离（即最少跳数）找出来的路径，可能并不合适。也有的路径的使用代 价很高或很不安全。还有一种情况，如自治系统 AS1 要发送数据报给自治系统 AS2, 本来最 好是经过自治系统 AS3 。但 AS3 不愿意让这些数据报通过本自治系统的网络，即使 AS1 愿意 付一定的费用。但另一方面，自治系统 AS3 l愿意让某些相邻自治系统的数据报通过自己的 网络，特别是对那些付了服务费的某些自治系统更是如此。因此，自治系统之间的路由选择 协议应当允许使用多种路由选择策略。这些策略包括政治、安全或经济方面的考虑。例如， 我国国内的站点在互相传送数据报时不应经过国外兜圈子，特别是，不要经过某些对我国的 安全有威胁的国家。这些策略都是由网络管理人员对每一个路由器进行设置的，但这些策略 并不是自治系统之间的路由选择协议本身。还可举出一些策略的例子，如： ＂仅在到达下列 这些地址时才经过 AS己 “ASx 和 ASy相比时应优先通过 ASx\", 等等。显然，使用这些策 • 168 •"}
{"doc_id": "network", "page": 180, "text": "略是为了找出较好的路由而不是砐佳路由。 由千上述情况，边界网关协议 BGP 只能是力求选择出一条能够到达目的网络前缀且比 较好的路由（不能兜圈子），而并非要计算出一条最佳路由。这里所说的 BGP 路由，是指经 过哪些自治系统 AS 可以到达目的网络前缀。当然，这选择出的比较好的路由，也有时不严 格地称为最佳路由。 BGP 采用了路径向量(pa th vec tor) 路由选择协议，它与距离向量协议 （如 RIP) 和链路状态协议（如 OSPF) 都有很大的区别。 2. BGP 路由 在一个自治系统 AS 中有两种不同功能的路由器，即边界路由器（或边界网关）和内部 路由器。一个 AS 至少要有一个边界路由器和相邻 AS 的边界路山器直接相连。在讨论协议 BGP 时，应特别注意边界路由器的作用。正是由于有了边界路由器， AS 之间才能利用协议 BGP 交换可达性路由信息。 当两个边界路由器（例如图 4-45(a) 中的 R1 和 R2) 进行通信时，必须先建立 TCP 连接 （端口号为 179, TCP 连接将在第 5 菜中学习），这种 TCP 连接又称为半永久性连接（即双 方交换完信息后仍然保持着连接状态）。像 R) 和 R2 之间的这种连接称为 eBGP 连接，但通 常就简称为 eBGP, e 表示外部 ex ternal 。现在，边界路由器凡可通过 eBGP 向对等端凡发 送 BGP 路由 “X, AS1, R 广，意思是“从凡经 AS1 可到达 X” 。这样，通过 eBGP 连接， AS2 中的边界路由器 R2 就知道了到达 AS1 中的前缀 X 的 BGP 路由。 BGP 路山 R3 0 —  一＼ /  AS1  ，飞丽 l、 ～—～一二 边界路由器 卢 (a)  BGP 路由 O 「 V ACO  R  A鸟一 (b) 斤-IBGP 8了一一气X人 \\  图 4-45 AS 之间的 eBGP 连接(a)和 AS 内部的心GP 连接（b) 但是，仅有边界路由器 R2 知道”到 AS1 的前缀 X 的 BGP 路由“是远远不够的。边界 路由器 R2 应当把获得的 BGP 路由，再转发给 AS 内部的其他路由器。为此，协议 BGP 规 定，在 AS 内部，两个路由器之间还需要建立iBGP （也就是心GP 连接， 1 表示内部 internal), iBGP 也使用 TCP 连接传送 BGP 报文。图 4-45(b) 中表示边界路由器 R2 在三个 i BGP 连接上，向 AS2 内部的其他三个路由器转发自己收到的 BGP 路由。至此， AS2 内的所 有路由器都知道了这条 BGP 路由信息。由此可见，协议 BGP 并非仅运行在 AS 之间，而且 也要运行在 AS 的内部。 协议 BGP 规定，在一个 AS 内部所有的心GP 必须是全连通的。即使两个路由器之间没 • 169 •"}
{"doc_id": "network", "page": 181, "text": "有物理连接，但它们之间仍然有i BGP 连接（如图 4-46 所示）。 AS iBGP AS iBGP  二.,.. －＼三实线是跺山器之间的物.fll'迕桉 虚线是跻由器之间的i BGP 连桵 图 4-46 {t: AS 内路巾器之间的物则迕桵与i BGP 连接 这里要说明一下。图 4-45(a) 中的边界路巾器 R1 通告给边界路由器凡的 BGP 路由可能 有很多条（在图中只画出了一条）。但 R2 根据本 AS 管理员所规足的策略，可以拒绝某些路 巾（收到这种路由后即删除掉），而在i BGP 连接上仅转发符合规定策略的 BGP 路由。 我们还盂要指出，虽然 cBGP 和心GP 的最后一个宁母 P 是代表“协议(Pro t ocol)\", 但 eBGP 和i BGP 并不是两个不同的协议。根据 RFC 4271, eBGP 是在不同 AS 的两个对等端 之间的 BGP 连接，而i BGP 是同一 AS 的两个对等端之间的 BGP 连接。在这两种不同连接 上传送的 BGP 报文，都边循同样的协议 BGP, 使用同样的报文格式和具有同样的属性类型。 啡 的不同点就是在发送 BGP 路由通告时的规则有所不同。这就是，从 eBGP 对等端收到 的 BGP 路由，可通过i BGP 告诉同 AS 内的对等端。反过来也是可以的，即从iBGP 对等 端收到的 BGP 路由，可通过 eBGP 告诉在不同 AS 的对等端。但是，从i BGP 对等端收到 BGP 路由，不能转告给同一个 AS 内不同心GP 的对等端。 图 4-47 形象地说明了 eBGP 和i BGP 的作用。图中画出了四个自治系统 AS, 每一个 AS 都必须运行木 AS 选择的内部网关协议 IGP, 例如 OSPF 或 RIP 。而协议 BGP 是在iB GP 连接和 eBGP 连接之上运行的。 ,.. ••• • • • • ••• • ••••• BGP 协议 ....... ••••••••••• .. :  e亨茫 C，气接 c？气桵 1二立口1二立工ll卫三ll二立工 八一门 lGP 协议 I | lGP 协议 1 | IGP 协议 I I I IGP 协议 AS1 AS2 AS3 AS4 视躲讲蛁 图 4-47 协议 BGP 11: i BGP 和 eBGP 之上运行 后而我们经常要讲到 BGP 路由，因此下面介绍一下 BGP 路由的一般格式。前面例子中 的 BGP 路由正是按照这种格式书写的。 BGP 路由＝“前缀， BGP 屈性”=“前缀， AS-PATH, NEXT-HOP\"  前缀的意思很明确，就是通告的 BGP 路由终点（子网前缀）。 BGP 属性有好几种类型但最重要两个就是这里列出的 AS-PATH 和 NEXT-HOP. AS-PATH （自治系统路径）是通告的 BGP 路由所经过的自治系统。 BGP 路由每经过一 个 AS, 就将其自治系统号 ASN 加入到 AS-PATH 中（本节在举例中没有使用具体的 ASN 数字号码，而是用 AS1, AS2 等符号来表示不同的 AS) 。从这里可以清楚地看出， “BGP 路由“ 必须指出通过哪些自治系统 AS, 但不指出路由中途要通过哪些路由器。 NEXT-HOP （下一跳）是通告的 BGP 路由起点。 细心的读者会发现，路由问题并未都解决完。例如，在图 4-48 中 AS2 内的路由器凡在 收到 BGP 路由 “X, AS1, R1\" 后，知逆了“从民出发就能到达 AS1 中的前缀 X\"。但路由器 • 170 •"}
{"doc_id": "network", "page": 182, "text": "凡应当怎样构造自己的转发表呢？这需要经过两次递归查找。 x  BGP 路由 BGP 路由 R3 的起点 的终点 二一一飞三2-= l ASl t  IBGP 一，雪厂＝了歹芒3\\ 边界路由器 图 4-48 BGP 路由的起点、经过的 AS 和终点 首先，凡要把这条 BGP 路由的起点进行转换。原来的 BGP 路由是 “R1 一 X\", 路由的 起点凡并不在 AS2 中。 AS2 中的路由器都不能识别 R1 。因此现在凡要把 BGP 路由的起点 改为凡的对等端 R2, 把 BGP 路由变为 “R2一 R1-X” 。由于 R2 位千 A斗中，因此 A岛里面 的所有路由器都能把分组转发到 R2, 然后就能再经过 R,, 最后到达前缀 X 。 其次，凡要利用内部网关协议，找到从凡到凡的最佳路由中的下一跳。在本例中， 查出下一跳是 R3 。于是凡在转发表中增加了到达前缀 X 的卜一跳是 R3 这一项目。 x匹配 l 下了 I 轧发表中有下跳 R) 表：：级 X 可达． 用类似的方法，路由器 R3 也在自己的转发表中增加了到达前缀 X 的项目。 前tBx匹配 1 下广 I 转及表中 11下一跳 R 浅：：缀 X 可达。 这样，路由器凡只要收到要到达前缀 X 的分组，都按照凡一R3-R2-R1 一 X 的路径， 最后到达前缀 X 。 总之，每一个路由器收到一条新的 BGP 路由通告后，必须经过上述步骤，才能在自己 的转发表中，增加到达终点的“下一跳＂的相应项目。 在实际的转发表中，“前缀匹配”项目都用 CIDR 记法表示。由于路由器有两个以上的 接口，因此“下一跳”项目用进入该路由器的接口的 IP 地址来表示。在讲解协议 BGP 的原 理时，我们就用更简洁的符号来表示。 3. 三种不同的自治系统 AS 在互联网中自治系统 AS 的数扭非常之多，其连接图也是相当复杂的。但归纳起来，可 以把 AS 划分为图 4-49 中所示的三大类，即末梢 AS (stub AS) 、穿越 AS (transit AS) 和对等 AS (peering AS) 。 二\\S （免费）－ ／尸 木梢 AS_~ 木梢 AS--~ 多归属 AS -~少，末梢 AS 图 4-49 儿种不同类型的 AS • 171 •"}
{"doc_id": "network", "page": 183, "text": "术梢 AS 是比较小的 AS （如图中的 AS4, ASs 和 AS6), 其特点是这些 AS 或者把分组发 送给其自接连接的 AS, 或者从其直接连接的 AS 搂收分组，但不会把米自其他 AS 的分组 再转发到另一个 AS 。末梢 AS 必须向所连接的 AS 付费才能发送或接收分组。图中链路旁 边的人民币符勺¥表示需婓对转发分组付费。 末梢 AS 也可以同时连桵到两个或两个以上的 AS （如图 4 -4 9 中的 AS5) 。这种末梢 AS 就称为多归属 AS (multihomed AS) 。多归屈 AS 可以增加连接的可靠性，因为若有一条连接 出现故陷，那么还有另一条连接可用。作为末梢 AS 的 ASs 不能把 AS3 发送过来的分组转发 到 AS2 。同理， AS5 也不能把 AS2 发送过来的分组转发到 AS3 。这就是说，末梢 AS 不是穿 越 AS, 它不允许分组穿越自己的自治系统。末梢 AS5 也不能把 (AS5 一 AS2-AS4) 这样的 BGP 路由信息通告给 AS3 。如果 AS3 打分组要转发给 AS4, 可以通过对等 AS2 转发，但不能 通过末梢 ASs• 如图 4-4 9 所示的穿越 AS1 往往是拥介很好的商速通信干线的主干 AS, 其任务就是为其 他的 AS 有偿转发分组。通常都会布很多的 AS 连接到穿越 AS 上。 对等 AS （如 00 4-49 中的 AS2 禾II AS3) 是经过事先协商的两个 AS, 彼此之间的发送或 接收分组都不收费，这样人争，豕转发分组都比较方便。 这里我们要强调一下， BGP 路巾必须避免兜圈子的出现。现观看图 4-49 所示的几个自 治系统 AS 。 AS沪J AS1 迪告可到达 AS6 的 BGP 路由中的屈性 AS-PATH 是 [AS3 AS6]• AS1  在收到的 BGP 路由的屈性 AS-PATH 中的最前面，添加上自己的 AS, 通报给 AS2: [AS,  AS3 AS6] 。 AS2 收到 BGP 路山后，向 AS3 通报 BGP 路由属性 AS-PATH 是［AS2 AS1 AS3 AS小 当 AS3 收到 BGP 路由后，检查屈性 AS-PATH 序列中已经有了自己的 AS3, 如果 AS3 接受这 个路山，并添加上本 AS 勺，则将在屈性 AS-PATH 中出现两个 AS3 （见有灰色底纹的两个 AS3): [AS3 AS2 AS1 AS3 AS6] 。这就构成了一个兜阉子的 BGP 路由，因此 AS3 应立即删除 此 BGP 路由，因曲避免了兜刚子路由的出现。诮记住，在屈性 AS-PATH 中不允许出现相同 的 AS 。 AS3 还可向 AS2 通报可到达 AS6 的另一条 BGP 路由，其 AS-PATH 是 [AS3 AS6] 。因此 AS2 知逍有两条 BGP 路 Ell 可到达 AS6, 其 AS-PATH 是 [AS2 AS1 AS3 AS6] 和 [AS2 AS3 AS小 4. BGP 的路由选择 假如从一个 AS 到另外 个 AS 中的前缀 X 只有一条 BGP 路由，那么就不存在选择 BGP 路山的问题，闪为这时 BGP 路山足唯一的。 但如果到前缀 X 有两条或更多的 BGP 路由可供选择，那么就应当根据以下的原则，按 照这里给出的先后顺序，选择一条较好的 BGP 路巾． • 本地偏好 LOCAL-PREF (LOCAL PREFerence)值极高的路由要首先选择。 在 BGP 路由中的屈件里面有一个选项叫作本地偏好，在屈性中记为 LOCAL-PREF 。本 地偏好也就是本地优先，“本地”的意思是指，从本 AS 开始的、到同一个前缀的不问 BGP 路由中，挑选畸个较好的（即偏好伯砐高的）路由。这可由路由器管理员或网络管理员根据 政治上或经济上的策略来设罚。 例如在图 4-50 中， AS1 分别用商速和低速链路连接到 AS2 和 AS3, 并从这两个 AS 获悉， 可通过 AS2 或 AS3 到达 AS4 。但 AS1 认为，若有分组要从 AS1 转发到 AS4, 应优先选择路由 器 R1 离开 ASl 。十是就把从 R1 离开 AS1 的 BGP 路由的屈性 LOCAL-PREF 值设为 300, 而 • 172 •"}
{"doc_id": "network", "page": 184, "text": "把从凡离开 AS1 的 BGP 路由的 LOCAL-PREF 伯设为 200 。这一信息通过i BGP 通告 AS1 内 部的所有路由器。这样，凡是有分组要转发到 AS4, 都优先选择从凡离开 AS10 AS1  、 LOCAL。二主二从 R) 到 AS2 的 BGP 路由 R1~AS2'1  、---、 IBGP; { ` AS4 丿 ...气．一｀ ｀｀＇／～会、 \\  图 4-50 LOCAL-PREF 俏较高的路巾优先 但是，即使所有的通信贵都通过这条高速链路，使得链路负荷过甫，协议 BGP 也无法 把一些负载调熬到负载较轻的那条低速链路上。 如果从几条 BGP 路由中找不出本地偏好值最高的路由，则执行下一条。 • 选择具有 AS 跳数最少的路由。 现观察图 4-51 的例千。从 AS1 到 AS5 共有两条 BGP 路山，即 AS1-AS2 一 AS3-ASs 和 AS1 一 AS4-ASs 。根据选择具有 AS 跳数最少的原则，我们应选择只通过 1 个 AS 的 BGP 路 由，即 AS 尸 AS4-ASs 。但是没有想到，分组在 AS4 中反而要经过更多次数的转发（或许 AS4 是个很大的 AS), 可能要花费史长的时间。可见选择经过 AS 数扯最少的路由 AS1- AS4 一 ASs 未必更好。这个例子再次说明了协议 BGP 无法选择出最佳路由。 I 经过 2 个 ASI 二/竺;—-A立＼＼ 乏夕～－～尸尸，～竺／ ＼～－之竺二一 优先选扦经过 1 个 AS 的 BGP路由 图 4-51 根据经过 AS 跳数的多少选择 BGP 路由 • 使用热土豆路由选择算法。 如果按前两种方法都无法选择蛟好的路由，那么就在要进入 BGP 路由的 AS, 执行热土 豆路由选择算法。例如在图 4-52 中，从 AS1 出发，共有两条 BGP 路由可到达 AS3: BGP 路由 l ：从 R3 离开 AS1, 然后进入 AS2 ，再到 AS30 BGP 路由 2 ：从凡离开 AS1, 然后进入 AS2, 再到 AS30 R  图 4-52 热土 u 路由选择犹法的应用举例 (00 中的连桵都足物理连接） 假定这两条 BGP 路由的本地偏好相同，同时所经过的 AS 个数也相同。在这种情况下， • 173 •"}
{"doc_id": "network", "page": 185, "text": "AS1 中的每一个路由器，就应采用热土豆路由选择算法。这种犹法把分组比喻为烫手的热土 豆，要尽快地转发出去。对干图 4-52 的例子，就是要使分组尽快离开 AS1, 而不考虑从哪 个路山器离开 AS1 。或者说，要让分组纾过最少的转发次数离开本 AS 。这时要使用内部网 关协议（如协议 OSPF 或 RIP) 。对于不问的路由器，得出的选择结果是不同的。 例如，对f- AS1 中的路山器 R1, 若要使转发的分组尽快离开 ASl ，应选择凡作为其下 一跳，因此应选抒 BGP 路山 2 。这样，凡的转发路径应当足： R 尸凡一 BGP 路由 2 。 回理，对千 R2 ，若要使转发的分组尽快离丿F AS1, 应选择民作为其下一跳，因此应选 择 BGP 路由 1 。这样， R2 的转发路径应当是： R2 一 R3 一 BGP 路由 1 。 • 选择路由器 BGP 标识符的数侦垃小的路由。 当以上几种力法都无法找出最好的 BGP 路巾时，就可使用 BGP 标识符来选择路由。在 BGP 进行交互的报文中，共首部有一 4 字节的字段，叫作 BGP 标识符，记为 BGP ID 。这 个字段被赋予一个无符号整数作为运行 BGP 的路由器的唯一标识符。具有多个接口的路由 器有多个 IP 地址。 BGPID 就使用该路巾器的 IP 地址中数值最大的一个。 5. BGP 的四种报文 在协议 BGP 刚运行时， BGP 连接的对等端要相互交换整个的 BGP 路由表。但以后只 需要在 BGP 路山发生变化时，才更新有变化的部分。这样做对节省网络带宽和减少路由器 的处理开销方面都有好处。 在 RFC4271 中规定了 BGP-4 的四种报文： (I) OPEN （打开）报文，用来与 BGP 连接对等端建立关系。 (2) UPDATE （更新）报文，用来通告某一路由的信息，以及列出要撤销的路由。 (3) KEEPA LJ VE （保活）报文，用来周期性地证实与对等端的连通性。 (4) NOTIFICATION （通知）报文，用来发送检测到的差错。 OPEN 报文足两个路由器之间建立了 TCP 连接后接浩就必须发送的报文。 OPEN 报文 的作用是相互识别对方，协商－些协议参数（如计时器的时间）。收到 OPEN 报文的路由器， 就发问 KEEPALIVE 报文表示接受建立 BGP 连接。 UPDATE 报文是 BGP 协议的核心，用来撤销它以前曾经通知过的路由，或宜布增加新 的路由。撤销路由可以一次撤销许多条，但增加新路由时，每个更新报文只能增加一条。 虽然 BGP 连接的两端建立了 TCP 连接，传输报文是可靠的，但 TCP 上层的 BGP 是否 始终正常工作还儿法确知。在对等端之间定期传送 BGP 路由表是不可取的，因为 BGP 路由 表往往过千庞大，这样做会使网络的汕信扯过大。因此协议 BGP 采用的方法是让 BGP 连接 的两个对等端之间，周期性地交换 KEEPALIVE 报文，以表示协议工作正常。 KEEPALNE 报文只包含 BGP 报文的通川订部 (l9 字节长），闪此不会在网络上产生多少开销。 拇个路由器都有一个保持时间计时器(Hold Ti mer) 。路巾器每收到一个 BGP 报文，这个 计时器就矗置砍，继续从 0 开始计时。如果在商定的保持时间内没有收到对等端发来的任 何种 BGP 报文，就认为对方已经不能［作了。发送 KEEPALIVE 报文的时间间隔取为双 方 1 i先倘定的保持时间 (Hold Ti me) 的 1/3 。例如，在 BGP 连接建立阶段，双方商定保持时间 为 180 秒，那么 KEEPALIVE 报文就每隔 60 秒发送一一次。如果两个对等端选择的保持时间 个致，就选择故值较小的个作为彼此使用的保持时间。保持时间也可选择为 0 。在这种 估况卜就永远不发送 KEEPALIVE 报文，农明这条 BGP 连接总是正常工作的． BGP 可以很容易地解决距离向址路由选择算法中的“坏消息传播得t~\"这一问题。当某 • 174 •"}
{"doc_id": "network", "page": 186, "text": "个路由器或链路出故障时，可以从不止一个邻站获得路由估息，因此很容易选择出新的路由。 在 ASN 升级到 4 字节后，号码 ASN 的范围从 0 ~65535 扩大到了 0 ~4294967295 。这 样就在互联网中存在两种不同的 BGP 报文。旧 BGP 报文使用 2 字节 ASN, 而新 BGP 报文 使用 4 字节的 ASN, 这时 BGP 路由中的路径属性记为 AS4-PATH 。使用新的和旧的 BGP 报 文的路由器若要进行通信，必须解决如何正确识别其 ASN 的问题 [RFC 6793] 。 BGP 报文是作为 TCP 报文的数据部分来传送的（如图 4-53 所示）。四种类型的 BGP 报 文具有同样的首部。 BGP 报文首部I B QP 报文主体部分 TCP 首部 1 且GP 报文 IP 首部 I TCP 报文 图 4-53 BGP 报文用 TCP 报文传送 在讨论完路由选择之后，我们再来介绍路由器的构成。 4.6.5 路由器的构成 1. 路由器的结构 路由器是一种具有多个输入端口和多个输出端口的专用计算机，其任 f I ·扫 务是转发分组。从路由器某个输入端口收到的分组，按照分组要去的目的 视频讲解 地（即目的网络），把该分组从路由器的某个合适的输出端口转发给下一跳路由器。下一跳 路由器也按照这种方法处理分组，直到该分组到达终点为止。路由器的转发分组正是网络层 的主要工作。图 4-54 给出了一种典型的路由器的构成框图。 路由选择处理机 路由选择、管理 i二尸 控制片面（软件） 分组转发 据层曲（硬件） l  交换结构 图 4-54 典型的路由器的结构（图中的数字 1 ~3 表示相应肛次的构件） 从图 4-54 可以春出，整个的路由器结构可划分为两大部分：路由选择部分和分组转发 部分。 路由选择部分也叫作控制部分，或控制层面，其核心构件是路由选择处理机。路由选 择处理机的任务是根据所选定的路由选择协议构造出路由表，同时经常或定期地和相邻路由 • 175 •"}
{"doc_id": "network", "page": 187, "text": "器交换路由信息而不断地更新和维护路巾表。 分组转发部分是本节所要讨论的问题，也就是数据层面，它由三部分组成：交换结构、 一组输入端口和一组输出端口（请注总：这里的端口就是硬件接口）。小型路由器的端口只 有几个。但某些 ISP 使用的边缘路由器的高速 IO Gb it/s 端 11, 则可以有多达几百个之多。 下面分别讨论每一部分的组成。例如，Jun ip er （眙问网络）公司的边缘路由器 MX2020 的 10 Gbit/s 端口就有 960 个。路巾器整个的系统容扯为 80 Tb it/s 。 交换结构(sw itch i n g fa br i c) 又称为交换组织，它的作用就是根据转发表(forward i n g table)  对分组进行处理，将某个输入端口进入的分组从一个合适的输出端目转发出去。交换结构本 身就是一种网络，但这种网络完全包含在路由器之中，因此交换结构可石成是“在路由器中 的网络”。 诸注总“转发”和“路由选择“是有区别的。在互联网中，“转发”就是路由器根据转 发表把收到的 IP 数据报从路由器合适的端口转发出去。＂轧发”仅仅涉及一个路由器。但 “路由选择”则涉及很多路由器，路由表则是许多路由器协回 T．作的结果。这些路由器按照 复杂的路由算法，得出整个网络的拓扑变化情况，囚血能够动态地改变所选择的路由，并由 此构造出整个的路由表。路由表 般仅包含从目的网络到卜一跳（用 1P 地址表示）的映射， 而转发表是从路由表得出的。转发表必须包含无成转发功能所必需的信息。这就是说，在转 发表的每 行必须包含从要到达的 H 的网络到输出端门和朵些 MAC 地址信息（如下～跳的 以太网地址）的映射。将转发表和路由表用不同的数据结构实现会带来 些好处，这是因为 在转发分组时，转发衣的结构应当使查找过程最优化，但路巾表则油要对网络拓扑变化的计 算最优化。路由表总是用软件实现的，但转发表则可用特殊的硬件来实现。请读者注意，在 讨论路由选择的原理时，往往不去区分转发表和路由表的区别，而可以笼统地都使用路由表 这一名词。 在图 4-54 中，路由器的输入和输出端口卑而都各有一个方框，用方框中的 I, 2 和 3 分 别代表物理层、数据链路层和网络层的处理模块。物理层进行比特的校收。数据链路层则按 照链路层协议接收传送分组的帧。什把帧的首部和尾部剥去后，分组就被送入网络层的处理 模块。若接收到的分组是路由器之间交换路由信息的分组（如 RlP 或 OSPF 分组等），则把 这种分组送交路 rh 器的路由选择部分中的路山选择处理机。名桵收到的是数据分组，则按照 分组首部中的目的地址查找转发表，根猁彴出的结果，分组就经过交换结构到达合适的输出 端口。－个路由器的输入端门和输出端口就做在路由器的线路接口卡上。 输入端口中的查找和转发功能在路山祸的交换功能中是最正耍的。为了使交换功能分 散化，往往把复制的车U 发表放仵匈一个输入端口中（如 00 4-54 中的虚线箭头所示）。路由选 择处理机负贞对各转发表的副本进行更新。这些副本常称为“影子副本 ”(shadow co py)。分 散化交换可以避免在路 1:IJ器中的某一，r炽上出现瓶颈。 以十介绍的查找转发表和轧发分组的概念虽然并不复杂，但在具体的实现中还会遇到 不少困难。问题就在于路由器必须以很高的速率转发分组。最理想的情况足输入端口的处理 速率能够跟上线路把分组传送到路巾器的速率。这种速率称为线速 (l i ne s p eed 或 w i re s p eed) 。 可以粗略地估算一卜。设线路是 OC-48 链路，即 2.5 Gbit/s 。若分组长度为 256 字节，那么 线速就应当达到每秒能够处理 100 万以上的分组。现在常用 M pp s （百万分组每秒）为单位 来说明一个路由器对收到的分组的处理速率有多高。在路由器的设计中，怎样提高查找转发 表的逑率是一个十分重要的研究课题。 • 176 •"}
{"doc_id": "network", "page": 188, "text": "当一个分组正在查找转发表时，后面又紧跟着从这个输入端口收到另一个分组。这个 后到的分组就必须在队列中排队等待，因而产生了一定的时延。图 4-55 给出了在输入端口 的队列中排队的分组的示意图。 输入端门的处理 从线跻接收分组 网络层处JIJl 分组排队 Jilil] 任表和转发 交换结构 图 4-55 输入端口对线路上收到的分组的处理 我们再来观察在输出端口上的情况（如图 4-56 所示）。输出端口从交换结构接收分组， 然后把它们发送到路由器外面的线路」＿。在网络层的处理模块中设有一个缓存区，实际上它 就是一个队列。当交换结构传送过来的分组的速率超过输出链路的发送速率时，来不及发送 的分组就必须暂时存放在这个队列中。数据链路层处理模块把分组加上链路层的首部和尾部， 交给物理层后发送到外部线路。 输出端口的处押 交换结构 网络层处理 分组排队 JJIIII]  缓存管理 向线路发这分组 00 4-56 输出端口把交换结构传送过米的分组发送到线路上 从以上的讨论可以看出，分组在路巾器的输入端口和输出端口都可能会在队列中排队 等候处理。若分组处理的速率赶不士分组进入队列的速率，则队列的存储空间最终必定减少 到零，这就使后面再进入队列的分组由千没有存储空间而只能被丢弃。以前我们提到过的分 组丢失就是发生在路由器中的输入或输出队列产生溢出的时候。当然，设备或线路出故障也 可能使分组丢失。 2. 交换结构 交换结构是路由器的关键构件[KUR017] 。正是这个交换结构把分组从一个输入端口转 移到某个合适的输出端口。实现这样的交换有多种方法，图 4-57 给出了二种常用的交换方 法。输入端口是 A,B 和 C, 输出端口是 X,Y 和 Z 。下面简单介绍它们的特点。 最早使用的路由器就是利用普通的计算机，用计算机的 CPU 作为路由器的路由选择处 理机。路由器的输入和输出端口的功能和传统的操作系统中的1/0 设备一样。当路由器的某 个输入端口收到一个分组时，就用中断方式通知路由选择处理机。然后分组就从输入端口复 制到存储器中。路由器处理机从分组首部提取目的地址，查找路由表，再将分组复制到合适 的输出端口的缓存中。若存储器的带宽（读或写）为每秒 M 个分组，那么路由器的交换速 率（即分组从输入端口传送到输出端口的速率） ～定小于 M/2 。这是因为存储器对分组的读 • 177 •"}
{"doc_id": "network", "page": 189, "text": "和写需要花费的时间是同一个数霜级。 (a) 通过存储器 (b) 通过总线 ［［连网络 七－ (c) 通过互迕网络 图 4-57 三种常用的交换方法 许多现代的路由器也通过存储器进行交换，图 4-57(a) 的示意图表示分组通过存储器进 行交换。与早期的路由器的区别就是，目的地址的查找和分组在存储器中的缓存都是在输入 端口中进行的。思科(C isco) 公司的 Cat al y s t 8500 系列交换机（有的公司把路由器也称为交换 机）就采用了共享存储器的方法． 图 4-57(b) 是通过总线进行交换的示总图。采用这种方式时，数据报从输入端口通过共 享总线直接传送到合适的输出端口，而个需要路由选择处理机的干预。但是，中千总线是共 享的，因此在同一时间只能有一个分组在总线上传送。当分组到达输入端口时若发现总线忙 （因为总线正在传送另一个分组），则被阻塞而不能通过交换结构，并在输入端口排队等待。 因为每一个要转发的分组都要通过这一条总线，因此路由器的转发带宽就受总线速率的限制。 现代的技术已经可以将总线的带宽提高到能够满足小型企业网的需求。例如，思科公司的 6500 路由器用来交换分组的背板总线速率已达到 32 Gbit/s 。 图 4-57(c) 画的是通过纵横交换结构(crossbar switch fa br i c) 进行交换。这种交换机构常称 为互连网络(in terconnec ti on ne twork), 它有 2N 条总线，可以使 N 个输入端口和 N 个输出端 口相连接，这取决于相应的交叉节点是使水平总线和垂直总线接通还是断开。当输入端口收 到一个分组时，就将它发送到与该输入端口相连的水平总线上。若通向所要转发的输出端口 的垂直总线是空闲的，则在这个节点将垂直总线与水平总线接通，然后把该分组转发到这个 输出端口。例如，一个分组到达输入端口 A, 应转发到输出端口 Y 。这时交换结构的控制器 就把总线 A 和 Y 的交叉节点闭合，因此分组就从输入喘口 A 传送到了输出端口 Y 。诸注意， 如果与此同时还有一个分组要从输入端口 B 转发到输出端口 Z, 那么也可同时进行，因为 A 一 Y 和 B-Z 的转发是使用不同的总线的转发。和前讷种交换机制不同，这种纵横交换结构 是一种无阻塞的交换结构，其特点是分组可以转发到任何一个输出端口，只要这个输出端口 没有被别的分组占用。如果这个输出端口（即对应的垂直总线）已被占用（有另一个分组正 • 178 •"}
{"doc_id": "network", "page": 190, "text": "在转发到同一个输出端口），那么后到达的分组就必须在输入端口排队等待。采用这种交换 方式的路由器例子如思科公司的 12000 系列交换路由器，其互连网络的速率达 60 Gbit/s 。 4.7 IP 多播 4.7.1 TP 多播的基本概念 1988 年 S teve Deeri n g首次在其博士学位论文中提出 IP 多播的概念。 1992 年 3 月 IETF 在互联网范围首次试验 IETF 会议声音的多播，当时有 20 个网点可同时听到会议的声音。 IP 多播是需要在互联网上增加更多的智能才能提供的一种服务。现在 IP 多播 (mul ti cas t,以 前曾译为组播）已成为互联网的一个热门课题。这是由于有许多的应用需要由一个源点发送 到许多个终点，即一对多的通信。例如，实时信息的交付（如新闻、股市行情等）、软件更 新、交互式会议等。随着互联网的用户数目的急剧增加，以及多媒体通信的开展，有更多的 业务需要多播来支持。 与单播相比，在一对多的通信中，多播可大大节约网络资源。图 4-58(a) 是视频服务器 用单播方式向 90 台主机传送同样的视频节目。为此，需要发送 90 个单播，即同一个视频分 组要发送 90 个副本。图 4-58(b) 是视频服务器用多播方式向屈于同一个多播组的 90 个成员 传送节目。这时，视频服务器只需把视频分组当作多播数据报来发送，并且只需发送一次。 路由器民在转发分组时，需要把收到的分组复制成 3 个副本，分别向 R2, R3 和凡各转发 l 个副本。当分组到达目的局域网时，由于局域网具有硬件多播功能，因此不需要复制分组， 在局域网上的多播组成员都能收到这个视频分组。 视频服务器 M ·t,pa  i二，发送 90 次单播 ｀个 阔 1 30赢 I 一＝三＝兰二三＝兰 －－二l 共有 90 个t机接收视频节目 (a) 单播 视频服务器 M 巴 发送 1 次多播 勹｀－多播组成员共有 90 个 (b) 多播 阳 4-58 单播与多播的比较 当多播组的主机数很大时（如成于上万个），采用多播方式就可明显地减轻网络中各种 资源的消耗。在互联网范围的多播要靠路由器来实现，这些路由器必须增加一些能够识别多 播数据报的软件。能够运行多播协议的路由器称为多播路由器(mul ti cas t rou ter) 。多播路由器 当然也可以转发普通的单播 IP 数据报。 为了适应交互式音频和视频信息的多播，从 1992 年起，在互联网上开始试验虚拟的多 播主干网 MBONE (Multicast Backbone On the InterNEt)。 MBONE 可把分组传播给地点分散 但屈于一个组的许多台主机。现在多播主干网已经有了相当大的规模。 • 179 •"}
{"doc_id": "network", "page": 191, "text": "在互联网上进行多播就叫仵 IP 多播。 IP 多播所传送的分组盂婓使用多播 IP 地址。 我们知道，在互联网中旬一台主机必须有一个全球啡 的 lP 地址。如果某台主机现在 想接收某个特定多播组的分组，那么怎样才能使这个多播数据报传送到这台主机？ 显然，这个多播数据报的目的地址一定不能写入这台上机的 IP 地址。这是因为在同一 时间可能有成于七万台主机加入到同一个多播组。多播数据报不可能在其首部写入这样多的 主机的 LP 地址。在多播数据报的目的地址写入的是多捅组的标识符，然后设法让加入到这 个多播组的主机的 IP 地址与多播组的标识符关联起来。 其实多播组的标识符就是 IP 地址中的 D 类地址。 D 类 IP 地址的前四位是 1110, 因此 D 类地址范围是 224.0.0.0 到 239.255.255.255 。我们就用匈一个 D 类地址标志一个多播组。 这样， D 类地址共可标志 228 个多捅组，也就是说，在同一时间可以允许有超过 2.6 亿的多 播组在互联网上运行。多播数据报也是“尽最大努力交付＂，不保证·一定能够交付多播组内 的所有成员。因此，多播数据报和一般的 1P 数据报的区别就是它使用 D 类 IP 地址作为目的 地址，并且首部中的协议字段伯是 2, 表明使用网际组管理协议 IGMP 。 显然，多播地址只能用千目的地址，面不能用千源地址。此外，对多播数据报不产生 ICMP 差错报文。因此，若在 PTNG 命令后面键入多播地址，将永远不会收到响应。 IP 多播可以分为两种。一种是只在本局域网．卜进行硬件多播，另一种则是在互联网的 范围进行多播。前一种虽然比较简单，但很重要，因为现在大部分主机都是通过局域网接入 到互联网的。在互联网上进行多播的最后阶段，还是要把多播数据报在局域网上用硬件多播 交付多播组的所有成员（如图 4-58(b) 所示）。下面就先讨论这种硬件多播。 4.7.2 在局域网上进行硬件多播 互联网号码指派管理局 !ANA 拥有的以太网地址块的高 24 位为 00-00-5E, 因此 TCP/LP 协议使用的以太网地址块的范围是从 00-00-5E-OO-OO-OO 到 00-00-5E-FF-FF-FF 。在第 3 菜 3.3.5 节已讲过，以太网 MAC 地址字段中的第 1 字节的砐低位为 1 时即为多播地址，这种 多播地址数占J ANA 分配到的地址数的一半。但 lANA 只拿出 223 个地址，即 01-00-5E-OO- 00-00 到 0 l-00-5E-7F-FF-FF 的地址作为以太网多播地址。或者说，在 48 位的多播地址中， 前 25 位都固定不变，只有后 23 彴可用作多播。但 D 类 lP 地址可供分配的有 28 位。这 28 位中只有后 23 位才映射以太网多播地址中的后 23 位，因此是多对一的映射关系（如图 4-59 所示），即 28 位中的前 5 位不能用来构成以太网多播地址。例如， IP 多播地址 224.128.64.32 （即 E0-80-40-20) 和另一个 IP 多播地址 224.0.64.32 （即 E0-00-40-20) 转换成 以太网的多播地址都是 01-00-5 E-00-40-2 0 。因此收到多播数据报的主机，还要在 IP 层利用 IP 数据报首部的 IP 地址进行过滤，把不是本主机要接收的数据报丢弃。 这 5 位不使用＼ :, C,  芦尸巨三乏艺 表示多播 ooooo'00;l| 。心。10000 。 I01 心111E10 匝 厂前25 彴固定不变——一匕一）已 23 位米自 D 类 IP 地址 48 ｛立t人士， I｀4 从~t1I: 28 位 6- 24 3- 招 4-59 D 类 IP 地址与以人网多播地址的映射关系 • 180 •"}
{"doc_id": "network", "page": 192, "text": "下面就讨论进行 IP 多播所需要的协议。 4.7.3 网际组管理协议 IGMP 和多播路由选择协议 1. IP 多播需要两种协议 图 4-60 是在互联网上传送多播数据报的例子。图中标有 lP 地址的四台 主机都参加了一个多播组，其组地址是 226.15.37.123 。显然，多播数据报 视频讲解 应当传送到路巾器 R1 ，凡和 R3, 而不应当传送到路由器凡，因为与凡连接的局域网上现在 没有这个多播组的成员。但这些路由器又怎样知道多播组的成员信息呢？这就要利用一个协 议，叫作网际组管理协议 IGMP (Internet Group Management Protocol).  128.56.24.34  1 参加多播组 产 226.15.37.123 ~MP  135277452 凡~ 130.12.i4.5~  参加多播组 I I 参加多播组 2261537123 气~MP R 、 广飞伍夕El I I R lGM夕，产三 2261537l23 三／～～一、二了丿勹G\\`142；忙霓 '  三二 图 4-60 IGMP 使多播路由祸知道多播组成员信息 图 4-60 强调了 lGMP 的本地使用范围。请注意， IGMP 并非在互联网范围内对所有多 播组成员进行管理的协议。 IGMP 不知道 IP 多播组包含的成员数，也不知道这些成员都分 布在哪些网络上。 lGMP 协议是让连接在本地局域网上的多播路由器知道本局域网上是否有 主机（严格讲，是主机上的某个进程）参加或退出了某个多播组。 显然，仅有 IGMP 协议是不能完成多播任务的。连接在局域网上的多播路由器还必须 和互联网上的其他多播路由器协同工作，以便把多播数据报用最小代价传送给所有的组成员。 这就盆要使用多播路由选择协议。 然而多播路由选择协议要比单播路由选择协议复杂得多。我们可以通过一个简单的例 子来说明。我们假定图 4-61 中有两个多播组。多播组 M1 的成员有主机 A,B 和 c, 而多播 组队的成员有主机 D,E 和 F 。这些主机分布在三个网络上 (N1,N2 和 N立 风凡了广＝＝上＞／，俨黔赞古｀ G上一／三／、＝已，＇；、、｀＝ = DI,..,.  、··............、、、呵一，＇、．．．．、一..... •  ...挚·令············ 图 4-61 用来说明多播路由选择的例子 路由器 R 不应当向网络 N3 转发多播组队的分组，因为网络 N3 上没有多播组 M1 的成 员。但是每一台主机可以随时加入或离开一个多播组。例如，如果土机 G 现在加入了多播 • 181 •"}
{"doc_id": "network", "page": 193, "text": "组 Ml ，那么从这时起，路由器 R 就必须也向网络 N3 转发多播组 M1 的分组。这就是说，多 播转发必须动态地适应多播组成员的变化（这时网络拓扑并未发生变化）。请注意，单播路 巾选择通常彴网络拓扑发生变化时才需要更新路由。 肖看一种悄况。主机 E 和 F 都是多播组 M2 的成员。当 E 向 F 发送多播数据报时，路由 器 R 把这个多播数据报转发到网络 N} 。但当 F 向 E 发送多播数据报时，路由器 R 则把多播 数据报转发到网络 N2 。如果路巾器 R 收到来自主机 A 的多播数据报 (A 不是多播组 M2 的 成员，但也可向多播组发送多播数据报），那么路由器 R 就应当把多播数据报转发到凡和 N3 。由此可见，多播路由器在转发多播数据报时，不能仅仅根据多播数据报中的目的地址， 而是还要考虑这个多播数据报从什么地方来和要到什么地方去。 还有一种悄况。主机 G 没有参加任何多播组，但 G 却可向任何多播组发送多播数据报。 例如， G 可向多播组 M) 或 M2 发送多播数据报。主机 G 所在的局域网上可以没有任何多播 组的成员。显然，多播数据报所经过的许多网络，也不一定非要有多播组成员。总之，多播 数据报可以由没有加入多播组的主机发出，也可以通过没有组成员接入的网络。 正因为如此， IP 多播就成为比较复杂的问题。下面介绍这两种协议的要点。 2 网际组管理协议 IGMP IGMP 已有了三个版本。 1989 年公布的 RFC 1112 (IGMPv 1) 早已成为了互联网的标准 协议 (STD 5) 。 2002 年 10 月公布的建议标准 IGMPv3 是最新的[RFC 3376] 。 和网际控制报文协议 ICMP 相似， IGMP 使用 IP 数据报传递其报文（即 IGMP 报文加 上JP 首部构成 IP 数据报），但它也向 IP 提供服务。因此，我们不把 IGMP 看成是一个单独 的协议，而是属于整个网际协议 IP 的一个组成部分。 从概念上讲， IGMP 的工作可分为两个阶段。 第一阶段：当某台主机加入新的多播组时，该主机应向多播组的多播地址发送一个 IGMP 报文，声明自己要成为该组的成员。本地的多播路由器收到 IGMP 报文后，还要利用 多播路由选择协议把这种组成员关系转发给互联网上的其他多播路由器。 第二阶段：组成员关系是动态的。本地多播路由器要周期性地探询本地局域网上的主 机，以便知道这些主机是否还继续是组的成员。只要有一台主机对某个组响应，那么多播路 由器就认为这个组是活跃的。但一个组在经过几次的探询后仍然没有一台主机响应，多播路 由器就认为本网络上的主机已经都离开了这个组，因此也就不再把这个组的成员关系转发给 其他的多播路由器。 IGMP 设计得很仔细，避免了多播控制信息给网络增加大批的开销。 IGMP 采用的一些 具体措施如下： (I) 在主机和多播路由器之间的所有通信都使用 IP 多播。只要有可能，携带 IGMP 报 文的数据报都用硬件多播来传送。因此在支持硬件多播的网络上，没有参加 IP 多播的主机 不会收到 IGMP 报文。 (2) 多播路由器在探询组成员关系时，只需要对所有的组发送一个诮求信息的询问报文， 而不需要对每一个组发送一个询问报文（虽然也允许对一个特定组发送询问报文）。默认的 询问速率是每 125 秒发送一次（通信惜并不太大）。 (3) 当同一个网络上连接有几个多播路由器时，它们能够迅速和有效地选择其中的一个 来探询主机的成员关系。因此，网络上多个多播路由器并不会引起 IGMP 通信扭的增大。 • 182 •"}
{"doc_id": "network", "page": 194, "text": "(4) 在 IGMP 的询问报文中有一个数值 N, 它指明一个砓长响应时间（默认值为 10 秒）。 当收到询问时，主机在 0 到 N 之间随机选择发送响应所需经过的时延。因此，若一台主机 同时参加了几个多播组，则主机对每一个多播组选择不同的随机数。对应于最小时延的响应 最先发送。 (5) 同一个组内的每一台主机都要监听响应，只要有本组的具他主机先发送了响应，自 己就可以不再发送响应了。这样就抑制了不必要的通信妞。 多播路由器并不需要保留组成员关系的准确记录，因为向局域网上的组成员转发数据 报是使用硬件多播。多播路由器只需要知道网络上是否至少还有一台主机是本组成员即可。 实际上，对询问报文每一个组只需有一台主机发送响应。 如果一台主机上有多个进程都加入了某个多播组，那么这台主机对发给这个多播组的 每个多播数据报只接收—个副本，然后给主机中的每一个进程发送一个本地复制的副本。 最后我们还要强调指出，多播数据报的发送者和接收者都不知道（也无法找出）一个 多播组的成员有多少，以及这些成员是哪些主机。互联网中的路由器和主机都不知道哪个应 用进程将要向哪个多播组发送多播数据报，因为任何应用进程都可以在任何时候向任何一个 多播组发送多播数据报，而这个应用进程并不需要加入这个多播组。 IGMP 的报文格式可参阅有关文档 [RFC 3376), 这里从略。 3. 多播路由选择协议 虽然在 TCP/IP 中 IP 多播协议已成为建议标准，但多播路由选择协议（用来在多播路由 器之间传播路由信息）则尚未标准化。 在多播过程中—个多播组中的成员是动态变化的。例如在收听网上某个广播节目时， 随时会有主机加入或离开这个多播组。多播路由选择实际上就是要找出以源主机为根节点的 多播转发树。在多播转发树上，每一个多播路由器向树的叶节点方向转发收到的多播数据报， 但在多播转发树上的路由器不会收到重复的多播数据报（即多播数据报不应在互联网中兜圈 子）。不难看出，对不同的多播组对应千不同的多播转发树。同一个多播组，对不同的源点 也会有不同的多播转发树。 已有了多种实用的多播路由选择协议，它们在转发多播数据报时使用了以下的三种方法： (I) 洪泛与剪除。这种方法适合千较小的多播组，而所有的组成员接入的局域网也是相 邻接的。一开始，路由器转发多播数据报使用洪泛的方法（这就是广播）。为了避免兜圆子， 采用了叫作反向路径广播 RPB (Reverse Path Broadcas ti n g)的策略。 RPB 的要点是：每一个 路由器在收到一个多播数据报时，先检查数据报是否是从源点经最短路径传送来的。进行这 种检查很容易，只要从本路由器寻找到源点的最短路径上（之所以叫作反向路径，因为在计 算最短路径时是把源点当作终点的）的第一个路由器是否就是刚才把多播数据报送来的路由 器。若是，就向所有其他方向转发刚才收到的多播数据报（但进入的方向除外），否则就丢 弃而不转发。如果本路由器有好几个相邻路巾器都处在到源点的最短路径上（也就是说，存 在几条同样长度的最短路径），那么只能选择一条最短路径，选择的准则就是看这几条最短 路径中的相邻路由器谁的 IP 地址最小。图 4-62 的例子说明了这一概念。 • 183 •"}
{"doc_id": "network", "page": 195, "text": "I i原点 一 1 ．配尸 轧发多播数报报 R, ．贮X 收到后即丢弃 R2 夕一立 R J R k'.?,X 一.. 肘除没有 R6 乡 夕 ~  .......  ～凡41 成员的树枝 蛔．．．．．．十、、．三 图 4-62 反向路径广播 RPB 和剪除 为简单起见，在图 4-62 中的网络用路由器之间的链路米表示。我们假定各路巾器之间 的距离都是 1 。路由器 RI 收到源点发来的多播数据报后，向 R2 和 R) 转发。凡发现 R1 就在 自已到源点的垃短路径上，因此向 R3 和凡转发收到的数据报。 R3 发现 R2 不在自己到源点 的垃短路径上，因此丢弃 R2 发来的数据报。其他路由器也这样转发。 R7 到源点有两条最短 路径： R1 一凡一 R2 一 R1 一源点； R1-Rs一 R3-R1 一源点。我们再假定凡的 IP 地址比 R5 的 IP 地址小，所以我们只使用前一条奻短路径。因此 R1 只转发儿传过来的数据报，曲丢弃 民传过来的数据报。最后就得出了用来转发多播数据报的多播转发树（图中用粗线表示）， 以后就按这个多播转发树来转发多播数据报。这样就避免了多播数据报兜圆子，同时每一个 路由器也不会接收重复的多播数据报． 如果在多播转发树上的某个路由器发现它的下游树枝（即叶节点方向）已没有该多播 组的成员，就应把它和下游的树枝一起剪除。例如，在图 4-62 中痔线椭圆表示剪除的部分。 当某个树枝有新增加的组成员时，可以fl~ 接入到多播转发树I.:.. (2) 隧道技术(tu nnel i n g)。隧道技术适用千多播组的位咒在地理上很分散的悄况。例如 在图 4-63 中，网凡和网 N2 都支持多播。现在 N) 中的主机向 N2 中的｀些主机进行多播。 但路由器 R) 和 R2 之间的网络井不支持多播，因而 R) 和 R2 不能按多播地址转发数据报。为 此，路由器凡就对多播数据报进行再次封装，即再加上普通数据报首部，使之成为向单一 目的站发送的单播(un i cas t)数据报，然后通过＂隧道”(tunnel) 从凡发送到 R1• 、（支::· ·,~'. - 'J勹言 隧道中迪行的 羊播 IP 奻拟报 _ N1 和N2 中的＿ 多播数据报 图 4-63 隧迫技术在多播中的应用 单播数据报到达路由器凡后，再山路由器 R2 剥去其首部，使它又恢复成原来的多播数 据报，继续向多个目的站转发。这一点和英吉利海峡隧道运送汽车的情况相似。英吉利海峡 隧道不允许汽车在隧道中行驶。但是，可以把汽乍放置在隧逍中行驶的屯气火车上来通过隧 道。过了隧道后，汽车又可以继续在公路上行驶。这种使川隧道技术传送数据报义叫作 IP • 184 •"}
{"doc_id": "network", "page": 196, "text": "中的 IP (IP- i n-IP) 。 (3) 基千核心的发现技术。这种方法对千多播组的大小在较大范围内变化时都适合。这 种方法是对每一个多播组 G 指定一个核心（core) 路由器，给出它的 lP 单播地址。核心路由器 按照前面讲过的方法创建出对应于多播组 G 的转发树。如果有一个路由器凡向这个核心路 由器发送数据报，那么它在途中经过的每一个路由器都要检查其内容。当数据报到达参加了 多播组 G 的路由器凡时，凡就处理这个数据报。如果凡发出的是一个多播数据报，其目 的地址是 G 的组地址， R2 就向多播组 G 的成员转发这个多播数据报。如果凡发出的数据 报是一个请求加入多播组 G 的数据报， R2 就把这个信息加到它的路由中，并用隧道技术向 凡转发每一个多播数据报的一个副本。这样，参加到多播组 G 的路由器就从核心向外增多 了，扩大了多播转发树的覆盖范围。 目前还没有在熬个互联网范困使用的多播路由选择协议。下面是一些建议使用的多播 路由选择协议。 距离向量多播路由选择协议 DVMRP (Distance Vector Multicast Routing Protocol) 是在互 联网上使用的第一个多播路由选择协议 [RFC 1075] 。由千在 UNIX 系统中实现 RIP 的程序叫 作 rou ted, 所以在 rou ted 的前面加表示多播的字母 m, 叫作 mrout ed, 它使用 DVM阳》在路 由器之间传播路由信息。 基千核心的转发树 CBT (Core Based Tree) [RFC 2189, 2201] 。这个协议使用核心路由器 作为转发树的根节点。～个大的自治系统 AS 可划分为几个区域，每一个区域选择—个核心 路由器（也叫作中心路由器 cen t er rou ter, 或汇聚点路由器 rendezvous rou ter) 。 开放最短通路优先的多播扩展 MOSPF (Multicast extensions to OSPF) [RFC 1585] 。这个 协议是单播路由选择协议 OSPF 的扩充，使用于一个机构内。 MOSPF 使用多播链路状态路 由选择创建出基于源点的多播转发树。 协议无关多播－稀疏方式 PIM-SM (Protocol Independent Multicast-Sparse Mode) [RFC  7761, STD83] 。这是唯一成为互联网标准的一个协议，它使用和 CBT 同样的方法构成多播 转发树。采用“协议无关”这个名词是强调：虽然在建立多播转发树时是使用单播数据报来 和远程路由器联系的，但这并不要求使用特定的单播路由选择协议 e 这个协议适用千组成员 的分布非常分散的估况。 协议无关多播－密集方式 PIM-DM (Protocol Independent Multicast-Dense Mode) [RFC  3973] 。这个协议适用于组成员的分布非常集中的情况，例如组成员都在一个机构之内。 PIM-OM 不使用核心路由器，而是使用洪泛方式转发数据报。 4.8 虚拟专用网 VPN 和网络地址转换 NAT 4.8.1 虚拟专用网 VPN 由千 TP 地址的紧缺，一个机构能够申请到的 IP 地址数往往远小千本机构所拥有的主机 数。考虑到且联网并不很安全，一个机构内也并不需要把所有的主机接入到外部的互联网。 实际上，在许多情况下，很多主机主要还是和本机构内的其他主机进行通信（例如，在大型 淌场或宾馆中，有很多用于营业和管理的计算机。显然这些计算机并不都需要和互联网相 连）。假定在一个机构内部的计算机通信也是采用 TCP/I P 协议，那么从原则上讲，对于这些 • 185 •"}
{"doc_id": "network", "page": 197, "text": "仅在机构内部使用的计殍机就可以由本机构自行分配其 IP 地址。这就是说，让这些计算机 使用仅在本机构有效的 IP 地址（这种地址称为本地地址），而不需要向互联网的管理机构申 请全球唯一的 IP 地址（这种地址称为全球地址）。这样就可以大大节约宝贵的全球 IP 地址 资源。 但是，如果任意选择一些 IP 地址作为本机构内部使用的本地地址，那么在某种情况下 可能会引起一些麻烦。例如，有时机构内部的某台主机需要和互联网连接，那么这种仅在内 部使用的本地地址就有可能和互联网中某个 IP 地址重合，这样就会出现地址的二义性问题。 为了解决这一问题， RFC 1918 指明了一些专用地址(pr i va te address) 。这些地址只能用 于一个机构的内部通信，而不能用千和互联网上的主机通信。换言之，专用地址只能用作本 地地址而不能用作全球地址。在互联网中的所有路由器，对目的地址是专用地址的数据报一 律不进行转发。 2013 年 4 月， RFC 6890 全面地给出了所有特殊用途的 1Pv4 和 1Pv6 地址， 但三个 1Pv4 专用地址块的指派并无变化，即 (I) 10.0.0.0/8, 即从 10.0.0.0 到 I 0.255.255.255 。 (2) 172.16.0.0/1 2, 即从 172.16.0.0 到 172.31.255.255 。 (3) 192.168.0.0/1 6, 即从 192.168.0.0 到 192 .1 68.255.255 。 上面的三个地址块分别相当千原来的一个 A 类网络、 16 个连续的 B 类网络和 256 个连 续的 C 类网络。 A 类地址本来早已用完了，而上面的地址 10.0.0.0 本来是分配给 ARPANET 的。由于 ARPANET 已经关闭停止运行了，因此这个地址就用作专用地址。 采用这样的专用 IP 地址的互连网络称为专用互联网或本地互联网，或更简单些，就叫 作专用网。显然，全世界可能有很多的专用互连网络具有相同的 IP 地址，但这并不会引起 麻烦，因为这些专用地址仅在本机构内部使用。专用 IP 地址也叫作可重用地址(reusable address) 。 有时一个很大的机构的许多部门分布的范围很广（例如，在世界各地），这些部门经常 要互相交换信息。这可以有两种方法。（I) 租用电信公司的通信线路为本机构专用。这种方 法虽然简单方便，但线路的租金太高，一般难千承受。（2) 利用公用的互联网作为本机构各 专用网之间的通信载体，这样的专用网又称为虚拟专用网 VPN (Virtual Private Network) 。 这里之所以称为“专用网”是因为这种网络是为本机构的主机用千机构内部的通信， 而不是用千和网络外非本机构的主机通信。如果专用网不同网点之间的通信必须经过公用的 互联网，但又有保密的要求，那么所有通过互联网传送的数据都必须加密。加密需要采用的 协议将在 7.6.1 节讨论。＂虚拟”表示“好像是“，但实际上并不是，因为现在并没有页止使 用通信专线，而 VPN 只是在效果上和真正的专用网一样。一个机构要构建自己的 VPN 就必 须为它的每一个场所购买专门的硬件和软件，并进行配置，使每一个场所的 VPN 系统都知 道其他场所的地址。 图 4-64 以两个场所为例说明如何使用 IP 隧道技术实现虚拟专用网。 假定某个机构在两个相隔较远的场所建立了专用网 A 和 B, 其网络地址分别为专用地 址 10. 1. 0.0 和 10.2.0.0 。现在这两个场所衙要通过公用的互联网构成一个 VPN 。 显然，每一个场所至少要有一个路由器具有合法的全球 IP 地址，如图 4-64(a) 中的路由 器民和 R2 。这两个路巾器和互联网的接口地址必须是合法的全球 IP 地址。路由器凡和 R2 在专用网内部网络的接口地址则是专用网的本地地址。 • 186 •"}
{"doc_id": "network", "page": 198, "text": "加密的从 X 到 Y 的内部数据报 源地址： 125.1.2.3 目的地址： 194 .4 .5.6 外部数据报的数据部分 数据报首部 外部总据报 1 场所 A 一1----...  卢／ 场所 B I _,  R2 厂勹 斗~ 10.2.0.0 \";-三 '-~'~-2.0.3  一 1 (a) 使用隧追技术 1 场所 A 虚拟专用网 VPN ·一1 场所 B I  一 1 X--....,RI  兰、 10. 1. 0.0 干 10.1.0.J ~  =  __  R2 ~ y  ~ 10.2.0.0 ?--三 、 \"-~ l~.2.0.3  一1 (b) 构成虚拟专用网 图 4-64 用隧道技术头现虚拟专用网 在每一个场所 A 或 B 内部的通信址都不经过互联网。但如果场所 A 的主机 X 要和另一 个场所 B 的主机 Y 通信，那么就必须经过路由器 R1 和 R2 。主机 X 向主机 Y 发送的 IP 数据 报的源地址是 10. 1. 0. 1,而目的地址是 10.2.0.3 。这个数据报先作为本机构的内部数据报从 X 发送到与互联网连接的路由器 R1 。路由器 RI 收到内部数据报后，发现其目的网络必须通过 互联网才能到达，就把整个的内部数据报进行加密（这样就保证了内部数据报的安全），然 后重新加上数据报的首部，封装成为在互联网上发送的外部数据报，其源地址是路由器 R1 的全球地址 125. 1. 2.3, 而目的地址是路由器凡的全球地址 194 .4 .5.6 。路由器 R2 收到数据报 后将其数据部分取出进行解密，恢复出原来的内部数据报（目的地址是 10.2.0.3), 交付主机 Y 。可见，虽然 X 向 Y 发送的数据报通过了公用的互联网，但在效果上就好像是在本部门 的专用网上传送一样。如果主机 Y 要向 X 发送数据报，那么所进行的步骤也是类似的。 请注意，数据报从凡传送到 R2 可能要经过互联网中的很多个网络和路由器。但从逻辑 上看，在凡到 R2 之间好像是一条直通的点对点链路，图 4-64(a) 中的＂隧道”就是这个意思。 如图 4-64(b) 所示的、由场所 A 和 B 的内部网络所构成的虚拟专用网 VPN 又称为内联 网(i n trane t或in trnne t VPN, 即内联网 VPN), 表示场所 A 和 B 都屈于同一个机构。 有时一个机构的 VPN 需要有某些外部机构（通常就是合作伙伴）参加进来。这样的 VPN 就称为外联网（ ex tranet或 ex t rane t VPN, 即外联网 VPN) 。 诮注意，内联网和外联网都采用了互联网技术，即都是基千 TCP/IP 协议的。 还有一种类型的 VPN, 就是远程接入 VPN (remo te access VPN) 。我们知道，有的公司 可能并没有分布在不同场所的部门，但却有很多流动员工在外地丁作。公司需要和他们保持 联系，有时还可能一起开电话会议或视频会议。远程接入 VPN 可以满足这种需求。在外地 工作的员工通过拨号接入互联网，而驻留在员工个人电脑中的 VPN 软件可以在员工的个人 电脑和公司的主机之间建立 VPN 隧道，因而外地员工与公司通信的内容也是保密的，员工 • 187 •"}
{"doc_id": "network", "page": 199, "text": "们感到好像就是使用公司内部的本地网络。 关千 VPN 隧道的保密问题，在后面的 7.5.1 节还有进一步的论述。 4.8.2 网络地址转换 下面讨论另一种情况，就是在专用网内部的一些主机本来已经分配到 了本地 IP 地址（即仅在本专用网内使用的专用地址），但现在又想和互联网 上的主机通信（并不需要加密），那么应当采取什么措施呢？ 视频讲角？ 砐简单的办法就是设法再申请一些全球 IP 地址。但这在很多情况下是不容易做到的。 目前使用得最多的方法是采用网络地址转换。 网络地址转换 NAT (Netw ork Address Transla ti on) 方法是在 1994 年提出的。这种方法盓 要在专用网连接到互联网的路由器上安装 NAT 软件。装有 NAT 软件的路由器叫作 NAT 路 由器，它至少有一个有效的外部全球 IP 地址。这样，所有使用本地地址的主机在和外界通 信时，都要在 NAT 路由器上将其本地地址转换成全球 IP 地址，才能和互联网连接。 图 4-65 给出了 NAT 路由器的工作原理。在图中，专用网 I 92.168.0.0 内所有主机的 IP 地址都是本地 IP 地址 I 92. I 68.x.x 。 NAT 路由器至少要有一个全球JP 地址，才能和互联网相 连。什木例中， NAT 路由器的全球 IP 地址是 172.38.1.5 （当然， NAT 路由器可以有多个全 球 IP 地址）。 N  专用网地址 192.168.0.3  专用网 I 92.168.0.0/16  192.168.0.3  A~  。 l- I  一1 I 92.161\\.0.4  阳 4-65 NAT 路由器的工作原理 NAT 路由器收到从专用网内部的主机 A 发往互联网上主机 B 的 IP 数据报 0: 源地址 S == 192.168.0.3, 而目的地址 D = 213.18.2 .4。 NAT 路由器通过内部的 NAT 转换表，把专用网 的 IP 地址 192.168.0.3, 转换为全球 IP 地址 172.38. 1. 5 后，改写到数据报的首部中作为新的 源地址，然后把新的数据报 0 转发出去。主机 B 收到 IP 数据报 0 后，发回应答C), B 发送 的 lP 数据报的源地址就是自己的地址： S = 213.18.2 .4,目的地址就是刚才收到的数据报的 源地址，因此现在 D = 172.38.1.5 。请注意， B 并不知逆 A 的专用地址 192.168.0.3 。实际上， 即使知道了，也不能使用，因为互联网上的路由器不能转发目的地址是任何专用地址的 IP 数据报。当 NAT 路由器收到 B 发来的 IP 数据报 0 时，还要进行一次 IP 地址的转换。通过 NAT 转换表，把收到的 IP 数据报使用的目的地址 D = 172.38.1.5 转换为专用网内部的目的 地址 D == 192.168.0.3 （即主机 A 真正的本地 IP 地址），变成了数据报 0, 然后发送到 A 。 由此可见，当 NAT 路由器具有 n 个全球 IP 地址时，专用网内最多可以同时有 n 台主机 接入到百联网。这样就可以使专用网内较多数散的主机，轮流使用 NAT 路由器有限数妞的 • 188 •"}
{"doc_id": "network", "page": 200, "text": "全球 IP 地址。 显然，通过 NAT 路由器的通信必须由专用网内的主机发起。设想如果有专用网上外面 的主机要发起通信，当 IP 数据报到达 NAT 路由器时， NAT 路由器就不知道应当把目的 TP 地址转换成专用网内的哪一个本地 IP 地址。这就表明，专用网内部的主机不能直接充当服 务器用。 为了更加有效地利用 NAT 路由器上的全球 IP 地址，现在常用的 NAT 转换表把运输层 的端口号也利用上。这样，就可以使多个拥有本地地址的主机，共用 NAT 路由器上的一·个 全球 IP 地址，因而可以同时和互联网上的不同主机进行通信[COME06] 。 由千运输层的端口号将在下一竞 5. 1.3节讨论，因此，建议在学完运输层的有关内容后， 再学习下面的内容。但从系统性方面考虑，把下面的这部分内容放在本竞中介绍较为合适。 使用端口号的 NAT 也叫作网络地址与端口号转换 NAPT (N etwork Address and Port  Transla ti on), 而不使用端口号的 NAT 就叫作传统的 NAT (trad 山onal NAT) 。但在许多文献中 并没有这样区分，而是不加区分地都使用 NAT 这个更加简洁的缩写词。表 4-9 说明了 NAPT 的地址转换机制。 表 4-9 NAPT 地址转换表举例 方向 字段 原先的 IP 地址和端口号 转换后的 IP 地址和端口号 从专用网发往 B联网 游 IP 地址：TCP 源端口 I 92.168 0.3:30000 172.38.1.5:40001  从专用网发往h联网 源 IP 地址．TCP 源端口 192.168.0.4:30000 172.38 l. 5·40002  从互联网发往专用网 目的 IP 地址 TCP 日的端口 172.38.1.5:4000 I 192 168.0 3:30000  从且联网发往专用网 目的 IP 地址 TCP Fl 的端口 172.38.1.5:40002 I <J2.168.0.4:30000  从表 4-9 可以君出，在专用网内主机 192.168.0.3 向互联网发送 IP 数据报，具 TCP 端门 号选择为 30000 。 NAPT 把源 1P 地址和 TCP 端口号都进行转换（如果使用 UDP, 则对 UDP 的端口号进行转换。原理是一样的）。另一台主机 192.168.0 .4也选择了同样的 TCP 端口号 30000 。这纯属巧合（端口号仅在本主机中才有意义）。现在 NAPT 把专用网内不同的源 IP 地址都转换为同样的全球 IP 地址。但对源主机所采用的 TCP 端口号（不管相同或不同）， 则转换为不同的新的端口号。因此，当 NAPT 路由器收到从互联网发来的应答时，就可以 从 IP 数据报的数据部分找出运输层的端口号，然后根据不同的目的端口号，从 NAPT 转换 表中找到正确的目的主机。 应当指出，从层次的角度看， NAPT 的机制有些特殊。普通路由器在转发 IP 数据报时， 对于源 IP 地址或目的 IP 地址都是不改变的。但 NAT 路由器在转发 IP 数据报时，一定要更 换其 IP 地址（转换源 IP 地址或目的 IP 地址）。其次，普通路由器在转发分组时是工作在网 络层的。但 NAPT 路由器还要查看和转换运输层的端口号．而这本来应当属干运输层的范 畴。也正因为这样， NAPT 曾遭受了一些人的批评，认为 NAPT 的操作没有严格按照层次的 关系。但不管怎样， NAT （包括 NAPT) 已成为互联网的一个重要构件[RFC 3022] 。 4.9 多协议标签交换 MPLS IETF 千 l997 年成立了 MPLS 工作组，为的是开发出一种新的协议。这种新的协议就是 多协议标签交换 MPLS (MultiProtocol Label Switch i n g)。“多协议”表示在 MPLS 的上层可以 • 189 •"}
{"doc_id": "network", "page": 201, "text": "采用多种协议。 IETF 还综合了许多公司的类似技术，如思科公司的标签交换(Tag Switching),  以及 lp s i lon 公司的 IP 交换（IP Sw itch i ng)等。 2001 年 1 月 MPLS 终于成为互联网的建议标准 [RFC 3031, 3032] 。 MPLS 利用面向连接技术，使每个分组携带一个叫作标签(label)(I)的小整数（这叫作打 上标签）。当分组到达交换机（即标签交换路由器）时，交换机读取分组的标签，并用标签 们来检索分组转发表。这样就比查找路由表来转发分组要快得多。 人们经常把 MPLS 与异步传递方式 ATM (Asynchronous Trans fer Mode)联系起来，这仅 仅是困为它们都采用了面向连接的工作方式。以前很多人都曾认为网络的发展方向是以 ATM 为核心的宽带综合业务数字 8-ISDN 。然而价格低廉得多的高速 IP 路由器仍然占领了 市场，最终导致 ATM 技术和 8-ISDN 未能够成为网络的发展方向。 MPLS 并没有取代 IP, 而是作为一种 IP 增强技术，被广泛地应用在互联网中。 MPLS 具有以下三个方面的特点： （ l) 支待面向连接的服务质械。 (2) 支持流量工程， 均衡网络负载。（3) 有效地支持虚拟专用网 VPN 。 下而讨论 MPLS 的基本工作原理。 4.9.1 MPLS 的工作原理 1. 基本工作过程 在传统的 IP 网络中，分组每到达一个路由器，都必须查找转发表，并 按照“最长前缀匹配＂的原则找到下一跳的 IP 地址（请注意，前缀的长度 视频讲解 是不确定的）。当网络很大时，查找含有大盘项目的转发表要花费很多的时间。在出现突发 性的通信队时，往往还会使缓存溢出，这就会引起分组丢失、传输时延增大和服务质揽下降。 MPLS 的一个重要特点就是在 MPLS 域的入口处，给每一个 IP 数据报打上固定长度 ”标签“，然后对打上标签的 IP 数据报用硬件进行转发，这就使得 IP 数据报转发的过程大 大地加快了气采用硬件技术对打上标签的 IP 数据报进行转发就称为标签交换。“交换”也 表示在转发时不再上升到第三层查找转发表，而是根据标签在第二层（链路层）用硬件进行 转发。 MPLS 可使用多种链路层协议，如 PPP 、以太网、 ATM 以及帧中继等。图 4-66 是 MPLS 协议的基本原理的示意图。 MPLS 域(MPLS domai n) 是指该域中有许多彼此相邻的路由器，并且所有的路由器都是 支持 MPLS 技术的标签交换路由器 LSR (Label Switching Router) 。 LSR 同时具有标签交换和 路由选择这两种功能，标签交换功能是为了快速转发，但在这之前 LSR 需要使用路由选择 功能构造转发表。 ＠汁： label 的标准译名本来是“标号 ”[MINGC J 94], 但此计名木被普心接受。本书悴采用译名“标记＇，．现在改用多数文 献中的译名“标签＇． ＠注．｛1 的公 n·J愿意用“第三层父换”表示“第三层的路由选择功能加上第二层的交换功能”。但这样的术由不够明确， 因而编者小上张使用这．术南。 • 190 •"}
{"doc_id": "network", "page": 202, "text": "-1 二 , ,  ,'MPLS  、 、 、 MPLS 、、、 入门节点 、、 出 II 节点 ---－－：一二－－－－－－－ ＝阳通 IP 分组 亡玉打上标签的分组 一一许通路由器 gg标签交换路由器 LSR 图 4-66 MPLS 协议的从本原理 图 4-66 中给出了 MPLS 的基本工作过程，解释如下： (I) MPLS 域中的各 LSR 使用专门的标签分配协议 LOP (Label Distribution Pro t ocol) 交换 报文，并找出和特定标签相对应的路径，即标签交换路径 LSP (Label Switched Pa t h) 。例如 在图中的路径 A--B-C 一 D 。各 LSR 根据这些路径构造出转发表。这个过程和路巾器构造 自己的路由表相似[RFC 3031), 限千篇幅，这里不讨论转发表构造的详细步骤。但应注意的 是， MPLS 是 r1ri向连接的，因为在标签交换路径 LSP 上的第一个 LSR 就根据 IP 数据报的初 始标签确定了整个的标签交换路径，就像一条虚连接一样。 (2) 当一个 IP 数据报进入到 MPLS 域时， MPLS 入口节点(i ngress node) 就给它打上标签 （后面我们就会知道，这实际上是插入一个 MPLS 首部），井按照转发表把它转发给下一个 LSR 。以后的所打 LSR 都按照标签进行转发。 给 IP 数据报打标签的过程叫作分类(class ifi c的 on) 。严格的第三层（网络层）分类只使用 了 IP 首部中的字段，如源 IP 地址和 H 的 IP 地址等。大多数运营商实现了第四层（运输层） 分类（除了要检杏 lP 首部外，运输层还要检查 TCP 或 UDP 首部中的协议端口号），而有些运 背商则实现了第五层（应用层）分类（吏进一步地检查数据报的内部并若虑其有效载荷）。 (3) 由千在令网内统一分配全局标签数值是非常困难的，囚此一个标签仅仅在两个标签 交换路由器 LSR 之间才有意义。分组每经过一个 LSR, LSR 就要做两件事：一处转发，－． 是更换新的标签，即把入标签更换成为出标签。这就叫作标签对换（label swappi n g)'。做这 两件事所需的数据都已沾楚地写在轧发表中。例如，图 4-66 中的标签交换路由器 B 从入桵 门 0 收到一个入标签为 3 的 IP 数据报，查找f如下的转发表： | 入尸 I 入？签 1 出尸 1 - I  标签交换路由器 B 就知道应当把该 IP 数据报从出接口 1 转发出去，同时把标签对换为 1 。 当 IP 数据报进入下一个 LSR 时，这时的入标签就是刚才得到的出标签。因此，标签交 换路由器 C 接打在转发该 IP 数据报时，又把入标签 1 对换为出标签 2 。 (!)汴：这里使川 [RFC 3031] 中的怀准词汀 ＇＇付换”和“交换＂的意思相近，但“对换”更强诮两个标笭 1，相对换（把入 标笭更换为出标签）．从然 MPLS 中的 LS 是表示“标笭交换＂，但标签交换路由沿 LSR 实现的功能从“标签对换＇，． • 191 •"}
{"doc_id": "network", "page": 203, "text": "(4) 当 IP 数据报离开 MPLS 域时， MPLS 出口节点(e gress node) 就把 MPLS 的标签去除， 把 IP 数据报交付非 MPLS 的主机或路由器，以后就按照普通的转发方法进行转发。 上述的这种“由入口 LSR 确定进入 MPLS 域以后的转发路径”称为显式路由选择 (exp I icit rou ti n g),它和互联网中通常使用的“每一个路由器逐跳进行路由选择“有省很大的 区别。 下面再讨论 MPLS 中的几个重要概念。 2 转发等价类 FEC MPLS 有个很正要的概念就是转发等价类 FEC (Forward ing Equivalence Class) 。所谓 ＂轧发等价类”就是路由器按照同样方式对待的 IP 数据报的负合。这里”按照同样方式对 待”表示从间杆核口转发到同样的下一跳地址，并且具有同样服务类别和同样丢弃优先级等。 FEC 的例子是： (I) 目的 IP 地址与某一个特定 IP 地址的前缀匹配的 IP 数据报（这就相当于普通的 IP 路由器）； (2) 所有源地址与目的地址都相同的 IP 数据报； (3) 具有某种服务质侦而求的J P 数据报。 总之，划分 FEC 的方法不受什么限制，这都由网络管理员来控制，因此非常灵活。入 口节点并不是给母一个 IP 数据报指派一个不同的标签，而是将属于同样 FEC 的 IP 数据报 都指派同样的标签。 FEC 和标签是一一对应的关系。 图 4-67 给出一个把 FEC 用于负载均衡的例子。图 4-67(a) 的主机凡和 H2 分别向比和 H~ 发送大整数据。路由器 A 和 C 是数据传输必须经过的。但传统的路由选择协议只能选择 最短路径 A-B-C, 这就可能导致这段最短路径过载。 H1-、 A^c／卓比 H2./'-已－－上只马H. (a) 传统路由选择协以使垃短路径A一B 一C过载 (b) 利用 FEC 使逋信垃较为均衡 树 4-67 FEC 用千负载均衡 图 4-67(b) 表示在 MPLS 的情况下，入口节点 A 可设置两种 FEC:“ 源地址为凡而目的 地址为 H3\" 和“源地址为 H2 而目的地址为比“，把前一种 FEC 的路径设置为 H1 一 A 一 B­ C 一 H3 ，而后一种的路径设置为 H2 一 A......D......E-C 一 H4 。这样可使网络的负载较为均衡。网 络忤理员采用自定义的 FEC 就可以更好地管理网络的资源。这种均衡网络负载的做法也称 为流昼工程 TE (Traffic Engi neer i n g）｀或通信量工程。 O 汴：，点早： ［程是对网络 I·的通伯冲进行测块、建校和控制，使网络运行的性能得到垃优化． • 192 •"}
{"doc_id": "network", "page": 204, "text": "4.9.2 MPLS 首部的位置与格式 MPLS 并不要求下层的网络都使用面向连接的技术。因此一对 MPLS 路由器之间的物理 连接，既可以由一个专用电路组成，如 OC-48 线路，也可以使用像以太网这样的网络。但 是这些网络并不提供打标签的手段，而 IPv4 数据报首部也没有多余的位置存放 MPLS 标签。 这就衙要使用一种封装技术：在把 IP 数据报封装成以太网帧之前，先要插入 个 MPLS 首 部。从层次的角度看， MPLS 首部就处在第二层和第三层之间（如图 4-68 所示）。在把加上 MPLS 首部的 IP 数据报封装成以太网帧时，以太网的类型字段在单播的估况下设置为 884716 （下标 16 表示这是十六进制的数字），而在多播的情况下为 884816 。这样，接收方可 以用帧的类型来判决这个帧是携带了 MPLS 标签还是一个常规的 IP 数据报。 网络层 MPLS 首部 尸一插入 数据链路层 图 4-68 MPLS 首部的位置 图 4-69 给出了 MPLS 首部的格式。可见“给 lP 数据报打上标签“其实就是在以人网的 帧首部和 IP 数据报的首部之间插入一个 4 字节的 MPLS 首部。具体的标签就在“标签伯” 这个字段中。 位 20 3 I  I~-尸E 笞气一 年区1 空气性I:222L I  以太网帧1 帧首部 1MPLS 节部I IP 首部 1 IP 数 据 部 分 1 帧／七部 1 发送在前 I-IP 数据报 l  图 4-69 MPLS 首部的格式 MPLS 首部共包括以下四个字段： (l) 标签值 占 20 位。由于一个 MPLS 标签占 20 位，因此从理论上讲，在设饥 MPLS 时可以使用标签的所有 20 位，因而可以同时容纳高达 220 个流（即 1048576 个流）。 但是，实际上几乎没有哪个 MPLS 实例会使用很大数目的流，因为通常需要管理员人工忤 理和设置每条交换路径。 (2) 试验 占 3 位，目前保留用千试验。 (3) S 占 1 位， S (S tack) 表示栈，在有“标签栈”时使用。 (4) 生存时间 TTL 占 8 位，用来防止 MPLS 分组在 MPLS 域中兜捆子。 4.9.3 新一代的 MPLS MPLS 问世后就在互联网中得到了大量的部署。虽然 MPLS 能够更快地转发分组，但其 有关的控制协议（如 LDP) 却比较复杂，其扩展性差，运行维护也较困难。协议 LDP 也无 法做到基于时延或带宽等要求的流僵调度。为了根据需要灵活地选择流壅的转发路径，就还 需要再使用资源预留协议 RSVP （见 8 .4 .3 节）。但 RSVP 的信令非常复杂，每个节点都要维 护一个庞大的链路信息数据库。此外， RSVP 不支持等价多路径路由选择 ECMP (Equal-Cost  Multipath Routi ng),而只会选择一条最优路径进行转发。 • 193 •"}
{"doc_id": "network", "page": 205, "text": "为了解决上述问题，一种保留了 MPLS 的主要特点，但更加简单的新的源路由选择协 议出现了。这就是段路由选择协议(Se g ment Routi ng),简称为 SR 。但不少人都使用“段路 由协议”这样更加简单的名称。在 SR 中，＂段 (segment)\"就是标签，也就是转发指令的一 种标识符。 SR 的工作原理仍然是基千标签交换的，不过现在不需要使用协议 LDP, 因此简 化了设备运行的协议数朵。 SR 由源节点为发送的报文指定路径，并将路径转换成有序的段 列表(Se gment Li s t),即 MPLS 标签栈，它被封装在分组首部。网络中的其他节点就执行首 部中的指令（即标签）进行转发。 整个网络设有控制器，也就是 SDN 控制器（见 4.10 节）。控制器收集并掌握全网的拓 扑信息和链路状态信息，计算出分组应传送的整个路径。控制器负贡给分组分配 SR 标签， 这些标签指明了分组从源点到终点的路径。当分组到达某个网络节点时，节点就根据分组携 带的标签转发到下一个节点。 现在 SR 还向 IPv6 演进，这就是 SRv6 。它直接利用 IPv6 字段作为标签寻址。而前面介 绍的在 MPLS 基础上的 SR 则称为 SR-MPLS 。 4.10 软件定义网络 SON 简介 SDN 的概念最初由斯坦福大学 N. McKeown 于 2009 年首先提出。当时还只是在学术界 进行探讨的一种新的网络体系结构。但随后几年发展很快，不少企业相继采用。其中最成功 的案例就是谷歌建千 2010~2012 年的数据中心网络 B4 。几年来网络 B4 运行的结果证明， 基十 SDN 的专用广域网确实可以大大提高网络带宽利用率，网络运行更加稳定，管理更加 高效简化，运行费用也明显降低了。目前， SDN 已经引起人们的密切关注。 在本济开始的 4. 1. 2 节，我们初步介绍了网络层数据层而和控制层面的基本概念。现在 有关 SDN 的资料已相当丰富。限千篇幅，下面我们只能对 SDN 进行简单的介绍。 我们知道，在 SDN 中，数据层面中的交换机是由控制层面进行控制的，图 4-70 表明这 种控制是通过协议 Op enFlow 来实现的。协议 O p enFlow 是一个得到高度认可的标准，在讨 论 SDN 时往往与 Op enfl ow 一起讨论。因此，有人会误认为 SDN 就是 Op enF! ow 。其实这 二者有着很大的区别。 SDN 不是协议，更不是一种产品。 SDN 是一个体系结构，是一种设 计、构建和管理网络的新方法或新概念，其要点就是把网络的控制层面和数据层面分离，而 让控制层面利用软件来控制数据层面中的许多设备。可以把协议 Op enF! ow 看成是在 SDN 体系结构中控制层面和数据层面之间的通信接口，它使得控制层面的控制器可以对数据层面 中的物理设备或虚拟设备，进行直接访问和操纵。这种控制在逻辑上是集中式的，是基千流 的控制。 AP1 AP2  控制层面（网络操作系统） 协议 Op enFlow 数据层面 图 4-70 协议 OpenFlow 足控制层面和数据层面的接口 协议 Op cnFlow 1.0 是 2009 年底发表的最早的版本，之后每年都进行更新，经过 12 次 • 194 •"}
{"doc_id": "network", "page": 206, "text": "更新，到 2015 年 3 月发布了版本1. 5. l (283 页），但目前较为成熟的是1.3 版本。 OpenFlow 的技术规范由开放网络基金会 ONF (Open Netwoking Foundati on) 负责制定。这是一个非营利 性的产业联盟，其任务是致力千 SDN 的发展和标准化。但请注意， SDN 并未规定必须使用 Openfl ow, 只不过是大部分 SDN 的产品采用了 OpenFlow 作为其控制层面与数据层面的接 口。 传统意义上的数据层面的任务就是根据转发表来转发分组。可以再把“转发“细分一 下。实际上这里有两个步骤。第一个步骤是＂匹配＂，即查找转发表中的网络前缀，进行最 长前缀匹配。第二个步骤是“动作“，即把分组从指明的接口转发出去。这种“匹配＋动 作”的转发方式在 SDN 中得到了扩充，增加了新的内容，变成了广义的转发。这种广义的 转发使得“匹配＋动作“有了新的内容。 在 SDN 的广义转发中，＂匹配“能够对不同层次（链路层、网络层、运输层）的首部 中的字段进行匹配，而“动作”则不仅是转发分组，而且可以把具有同样目的地址的分组从 不同的接口转发出去（为了负载均衡）。还可以重写 IP 首部（如同在 NAT 路由器中的地址 转换），或者可以人为地阻挡或丢弃一些分组（如同在防火墙中一样，见 7.7.1 节）。请注意， 这里为了讨论问题的方便，在讨论 SDN 的问题时，不管在哪一层传送的数据单元，都称为 分组。 这样，在 SDN 的广义转发中，这种完成“匹配＋动作”的设备，就不应当称为路由 器了，而是叫作“分组交换机”或 “Op e nflow 交换机”，或更简单些就称为“交换机”。这 种交换机并不局限在网络层工作（例如，可使用 L2/L3 交换机）。在 SDN 中，取代传统转发 表的是“流表”(flow t able) 。因此，流表就是＂匹配＋动作”的转发表。 图 4-71 强调了一个重要概念： Op enFlow 交换机中的流表是由远程控制器来管理的，而 远程控制器通过一个安全信道（见 7.6.2 节），使用 OpenFlow 协议来管理 Op e nflow 交换机 中的流表。这样， OpenFlow 就有了双重意义。一方面， Op enFlow 是 SDN 远程控制器与网 络设备之间的通信协议；另一方面， OpenFlow 又是网络交换功能的逻辑结构的规约。我们 还应注意到，尽管网络设备可以由不同厂商来生产，同时也可以使用在不同类型的网络中， 但从 SDN 远程控制器吞到的，则是统一的逻辑交换功能。 网 I, ；乙言竹区些呾竺竺立 :  OpenFlow 交换机 SDN 远程 控制器 图 4- 7 I Openfl ow 协议与 OpenFlow 交换机 我们在 4.5.1 节介绍 1Pv6 首部的流标号时，曾初步地提到“流”的概念。在 Op e nflow 的各种文档中都没有“流”的定义。其实从 OpenFlow 交换机的角度来看，一个流就是穿过 网络的一种分组序列，而在此序列中的分组都共享分组首部某些字段的值。例如，某个流可 以是具有相同源 IP 地址和目的 1P 地址的所有分组。 图 4-72 给出了 Ope nf low 1.0 版本的流表和分组的首部匹配字段（这是最简单的～个版 本，便于用来讲解工作原理） ［ KUR017] 。每个 Op enflow 交换机必须有一个或一个以上的 流表。每一个流表可以包括很多行，即多个流表项(flow en try),它包括三个字段，即首部字 • 195 •"}
{"doc_id": "network", "page": 207, "text": "段值（又称为匹配字段）、计数器和动作。下面解释这三个字段的总思。 流表｛飞丿丿丿勹 罕芦 1 入端口1 源地址1:$:lI类型 lID1;：；级 1 源地址 1 目的；；叶甘J·i义 I服务类型l 寸邸：『：«？; 链路层 网络坛 ，－—还输层一 图 4-72 Openf low 1. 0 版本的流表和分组的首部匹配字段 首部字段值：这是一组字段，用来使入分组(i ncomi n g p acke t)的对应首部与之相匹配， 因此又称为匹配字段。匹配不上的分组就被丢弃，或发送到远程控制器做更多的处理。图 4-72 所示的匹配字段有 11 个项目涉及三个层次的首部。这就是说， Open fl ow 的匹配抽象 与我们以前讲过的分层的原则明显不同。有 OpenFlow 交换机中，既可以处理链路层的帧， 也可以处理网络层的 IP 分组和运输层的报文。 计数器：这是一组计数器，可包括已经与该表项匹配的分组数散，以及从该表项上次 更新到现在经历的时间。 动作：这是一组动作，例如，当分组匹配某个流表项时把分组转发到指明的端口，或 丢弃该分组，或把分组进行复制后再从多个端口转发出去，或重写分组的首部字段（第二、 三和四层的首部字段）。 为了更好地理解流表的匹配与动作，我们讨论下面几个例子[KUR017] 。图 4-73 给出的 简单网络有 6 台主机 CH1~H6), 其 1P 地址标注在主机旁边，还有 3 台分组交换机（ S1 ~  S3) 。每台交换机有 4 个端口（即接口，编号为 1 至 4) 。还有 1 台 Op enfl ow 控制器来控制 这些分组交换机的＂匹配＋动作”。 Op cnrlow 控制器 IO O3 3 00: __ : 2 2 00:  10.1.0.1  ~| -1  图 4刁3 Op enFlow\" 匹配＋动仵“网络 简单转发的例子 我们设定的转发规则是：来自 H5 或 H6 发行 H3 或凡的分织．都先从 S3 转发到 Sl ，然 后再从 S1 转发到 S2, 但不通过 SJ到 S2 的链路。根据这个转发规则，可以得出交换机 S3 的 流表项是： • 196 •"}
{"doc_id": "network", "page": 208, "text": "匹配 IP 源地址＝ 10.3.•.•: IP 目的地址＝ 10.2.•.• 动作 转发(3) 这里使用了通配符＊。例如，地址 10 .3.*.*,表明这样的地址将匹配前 16 位为 10.3 的任何地 址。”转发 (3)\" 表明分组转发出去端口是交换机编号为 3 的端口。 交换机 S1 的流表项（这里和后面都省略了计数器字段）是： 匹配 入端口＝ I: LP 源地址＝ 10.3 拿拿： IP 目的地址＝ 10.2.•.• 动作 转发(4) 和 S3 的流表项相比，这里多了＂入端口＝ l\" 。表明”匹配”仅限于从编号 l 的端口进入交 换机 S1 的分组。 交换机 S2 的流表项是： 匹配 IP 源地址＝ 10.3.*.*: IP 目的地址＝ 10.2.0 .3 IP 源地址＝ 10 .3.•.•, LP 目的地址＝ 10.2.0.4 负载均衡的例子 动作 转发(3) 转发(4) 在图 4-73 中，为了均衡链路 S2-S1 和链路 S3-S1 的通信量，我们规定：凡是从 H3 发往主 机 I 0. 1.*＊的分组，其转发路径应为 S2-S1 。但凡是从比发往主机 IO.I ．＊．＊的分组，其转发 路径应为 S2 一 S3 一 S1 。显然，采用基千 IP 目的地址的转发方法，是不能实现这种负载的均 衡的。但在本例中，只要在交换机 S2 的流表项中设置好合适的匹配项目即可。 交换机 S2 的流表项是： 匹配 入端 U =3: IP 日的地址＝ 10. 1.•.• 入端 LI =4: IP 日的地址＝ 10. 1.•.• 防火墙的例子 动作 转发(2) 转发(I) 假定我们在交换机 S2 中设置了防火墙，此防火墙的作用是仅仅接收来自与交换机 S3 相 连的主机所发送的分组（不管是从哪一个端口进来的）。根据这样的规定可得出下列内容。 交换机 S2 的流表项是： 匹配 IP 源地址＝ 10 .3.•.•: IP 目的地址＝ 10.2.0.3 IP 源地址＝ 10 .3.•.•: IP R 的地址＝ 10.2.0 .4 动作 转发(3) 转发(4) 虽然上面举出的例子非常简单，但已经可以看出这种广义转发的多样性和灵活性。广 义转发的优点是显而易见的。 • 197 •"}
{"doc_id": "network", "page": 209, "text": "下面通过图 4-74 简单介绍一下 SDN 的控制层面[KREN15] [KUR017] 。 网络控制应用程序 APIAPI 向向七南J,r  三 .,+:'.~  ••  A  ~}j  ＇，＇户＇：． 日 面}面 丁—[j I 勹 路由选择 ••• 接入控制 负载均衡 图 4-74 SDN 体系结构的构件 从图 4-74 可以反映出 SDN 体系结构的四个关键特征： 基于流的转发。 SDN 控制的交换机分布在数据层面中，而分组的转发可以基于网络层、 运输层和链路层协议数据单元中的首部字段值进行。这和传统的路由器仅仅根据 IP 分组的 目的地址进行转发，有着很大的区别。 SDN 的转发规则都精确规定在交换机中的流表中。 所有交换机中的流表项，都是由 SDN 控制器进行计算、管理和安装的。 数据层面与控制层面分离。在许多英语文献中常使用 “decouple\" 一词，相应的中文就 是“去耦＂。在传统的转发设备路由器中，其数据层面与控制层面都处在同一个设备中，因 此二者耦合得非常紧密。但在 SDN 中，则把这两个层面去耦合，使二者不在同一个设备中。 这点在图 4-73 中看得很清楚。数据层面有许多相对简单但快速的网络交换机。这些交换机 在其流表中执行“匹配＋动作”的规则。而控制层面则由若干服务器和相应的软件组成， 这些服务器和软件决定并管理这些交换机中的流表。 位千数据层面交换机之外的网络控制功能。 SDN 中的控制层面是用软件实现的，而且 软件是处在不同的机器上，并且可能还远离这些网络交换机。从图 4-74 可以看出， SDN 控 制层面包含两个构件，一个是 SDN 控制器（也就是网络橾作系统），另一个由若干个网络控 制应用程序组成。 SDN 控制器维护准确的网络状态信息（例如，远程链路、交换机和主机 的状态），把这些信息提供给运行在控制层面的各种控制应用程序，以及提供一些方法，使 得这些应用程序能够对底层的许多网络设备进行监视、编程和控制。衙要注意的是，在图 4-73 的 SDN 控制器中只画了一个服务器，但这只是强调在逻辑上是集中控制的。实际上， 在控制层面中总是使用多个分散的服务器协调地工作，以便实现可扩展性和高可用性。 可编程的网络。通过在控制层面的～些网络控制应用程序，使整个网络成为可编程的。 这些应用程序相当千 SDN 控制层面中的“大脑 ”,SDN 控制器使用这些应用程序，在这些 网络设备中指明和控制数据层面。例如，路由选择网络控制应用程序能够确定在源点和终点 之间的端到端路径（这需要执行某种算法，也需要使用由 SDN 控制器维护的节点状态和链 路状态信息）。网络应用程序还可以进行接入控制，即决定哪些分组在进入某个交换机时就 必须被阻挡住。此外，网络应用程序在转发分组时还可以执行负载均衡的措施。 从以上的简单例子可以看出， SDN 把网络的许多功能都分散开了。数据层面的交换机、 SDN 控制器以及许多网络控制应用程序，这些都可以是分开的实体，并且可以由不同的厂 • 198 •"}
{"doc_id": "network", "page": 210, "text": "商和机构来提供。这就和传统网络截然不同。在传统网络中，路由器或交换机是由单独的厂 商提供的，其控制层面和数据层面以及协议的实现，都是垂直集成在一个机器里面的。目前 出现的这种变化，有点像当初计算机的溃变。早期的大型计算机，从硬件到软件以及应用程 序，都是由一个单独的厂家生产完成的。但后来演变到现在的个人电脑，其硬件机身、操作 系统以及上层的应用程序，可以由多个厂家分别生产和提供，这样的系统就变得更加开放， 其功能也更加丰富了。 SDN 也可能有这样的发展结果。 图 4-74 还给出了 SDN 控制器和下面数据层面的受控设备的通信接口，即南向 API ，以 及 SDN 控制器和上面网络控制应用程序的接口，即北向 API 。 SDN 控制器是最复杂的，它还可以划分为如图 4-75 所示的三个层次。 ·························D······························ 北向 API 到网络控制 与网络控制应用程序的通信 气骂层巨尸喜翌产］ 巨 芦网络范詈霍管理 s』N 亨看了控制器 与数据层面中受控设备的通信 通信层 巨三5曰..巨5王］ ··························~····························!南向 API 图 4-75 SDN 控制器的三个层次 最下面的一层是通信层，其任务是完成 SDN 控制器与受控的网络设备之间的通信。显 然，要完成这样的通信，我们必须有一个协议，用来在 SDN 控制器与这些设备之间传送信 息。此外，这些设备还必须能够向 SDN 控制器传送在本地观察到的事件（例如，用一个报 文指示某条链路正常工作或出了故障断开了，或指示某个设备刚刚接入到网络中，或者某种 信号突然出现可以表示某个设备已加电并可以工作）。这样就可保证 SDN 控制器掌握了网络 状态的最新视图。在通信层的协议有前面已经提到过的 OpenFlow, 以及后面在第 6 章应用 层要学习的协议 SNMP, 等等。通信层与数据层面的接口叫作南向 API 接口。现有用 SDN 控制器概念制作的商品基本上（当然不是全部）都是采用协议 Op enFlow 。 在中间的一层是网络范围的状态管理层。 SDN 控制层面若要做出任何最终的控制决定 （例如，在所有的交换机中配置流表以便进行端到端的转发，或实现负载均衡，或实现某种 特殊的防火墙能力），就需要让控制器掌握全网的主机、链路、交换机，以及其他受 SDN 控 制的设备。交换机的流表中包含有计数器，而网络应用程序衙要使用这些计数器的值。因此， 这些计数器的值对网络应用程序来说也必须是可用的。由千控制层面的最终目的是确定各种 被控设备的流表，因此控制器还需要维护这些流表的副本。所有上述这些信息构成由 SDN 控制器维护的网络范围状态。 最上面一层是到网络控制应用程序层的接口。 SDN 控制器与网络控制应用程序的交互 都要通过北接口。这个 API 接口允许网络控制应用程序对状态管理层里面的网络状态和流 表进行读写操作。网络控制应用程序事先已进行了注册。当状态变化的事件出现时，网络控 • 199 •"}
{"doc_id": "network", "page": 211, "text": "制应用程序把得到的网络事件进行通告，并采取相应的动作，例如，计算新的最低开销的路 径。这一层可以提供不同类型的 API 。例如， REST 风格的 API 目前使用得较多。图中的 REST (REpresentational State Trans fer) 即表述性状态传递，是一种针对网络应用的设计和开 发方法(W-REST]. 00 中的 In ten t是对要进行的操作的一种抽象描述[W-INTENT], 可用它在 组件之间传递数据。 目前已经出现了一些开放源代码控制器，或简称为开源控制器(Open Source Controller),  最有代表性的就是 OpenDay l igh t和 ONOS 。这里就不再进行讨论了。 本章的重要概念 • TCP/IP 体系中的网络层向上只提供简单灵活的、无连接的、尽最大努力交付的数 据报服务。网络层不提供服务质量的承诺，不保证分组交付的时限，所传送的分组 可能出错、丢失、重复和失序。进桯之间通信的可靠性由运输层负责。 • IP 网是虚拟的，因为从网络层上看， IP 网就是一个统一的、抽象的网络（实际上 是异构的）。 IP 层抽象的互联网屏蔽了下层网络很复杂的细节，使我们能够使用统 一的、抽象的 IP 地址处理主机之间的通信问题。 • 互联网上交付主机的方式有两种：在本网络上的直接交付（不经过路由器）和到其 他网络的间接交付（经过至少一个路由器，但最后一次一定是直接交付）。 • 一个JP地址在整个互联网范围内是唯一的。早期使用的是分类的 IP 地址，包括 A 类、 B 类和 C 类地址（单播地址），以及 D 类地址（多播地址）。 E 类地址未使用。 • 分类的 IP 地址由网络号字段（指明网络）和主机号字段（指明主机）组成。网络 号字段最前面的类别位指明 IP 地址的类别。 • 目前已广泛使用无分类域间路由选择 CJDR 记法把 IP 地址后面加上斜线”/\",斜 线后是前缀的位数。前缀（或网络前缀）指明网络，后缀指明主机。前缀相同的连 续的 IP 地址构成 “CIDR 地址块”。 • CIDR 的 32 位地址掩码（或子网掩码）由一串 1 和一串 0 组成，其中 1 的个数是 前缀的长度。只要把 IP 地址和地址掩码按位进行 AND 运算，即可得出网络地址。 • IP 地址是一种分等级的地址结构。 IP 地址管理机构在分配 IP 地址时只分配网络前 缀（网络号），而主机号则由得到该网络前缀的单位自行分配。路由器仅根据目的 主机所连接的网络前缀（网络号）来转发分组。 • IP 地址标志一台主机（或路由器）和一条链路的接口。多归屈主机同时连接到两 个或更多的网络上。这样的主机同时具有两个或更多的 IP 地址，其网络前缀必须 是不同的。由千一个路由器至少应当连接到两个网络，因此一个路由器至少应当有 两个不同的 IP 地址。 • 按照互联网的观点，用转发器或网桥连接起来的若干个局域网仍为一个网络。所有 分配到网络前缀的网络（不管是范即很小的局域网，还是可能稷盖很大地理范围的 广域网）都是平等的． • MAC 地址（即硬件地址或物理地址）是数据链路层和物理层使用的地址，而 IP 地 址是网络层和以上各层使用的地址，是一种逻辑地址（用软件实现的），在数据链 路层看不见数据报的 IP 地址。 • IP 数据报分为首部和数据两部分。首部的前一部分是固定长度，共 20 字节，是所 • 200 •"}
{"doc_id": "network", "page": 212, "text": "有 1P 数据报必须具有的（源地址、目的地址、总长度等觉要字段都在固定首部中）。 一些长度可变的可选字段放在固定首部的后面。 • IP 首部中的生存时间字段给出了fP 数据报在互联网中所能经过的砓大路由器数， 可防止 IP 数据报在互联网中无限制地兜圈子。 • 地址解析协议 ARP 把 IP 地址解析为 MAC 地址，它解决同一个局域网上的主机或路 由器的 lP 地址和 MAC 地址的映射问题。 ARP 的高速缓存可以大大减少网络上的通信 量。 • 在互联网中，我们无法仅根据 MAC 地址寻找到在某个网络上的某台主机。因此， 从 lP 地址到 MAC 地址的解析是非常必要的。 • 路由聚合（把许多前缀相同的地址用一个来代替）有利于减少路由表中的项目，减 少路由器之间的路由选择信息的交换，从而提高了整个互联网的性能。 • “转发”和“路由选择“是不同的概念。”转发”是单个路由器的动作。“路由选择“ 是许多路由器共同协作的过程，这些路巾器相互交换信息，目的是生成路由表，再 从路由表导出转发表。若采用自适应路由选择算法，则当网络拓扑变化时，路由表 和转发表都能够自动更新。在许多情况下，可以不考虑转发表和路由表的区别，而 都使用路由表这一名词。 • 自治系统 (AS) 就是在单一的技术管理下的一组路由器。一个自治系统对其他自治系 统表现出的是一个单一的和一致的路由选择策略。 • 路由选择协议有两大类：内部网关协议（或自治系统内部的路由选择协议），如 RIP 和 OSPF: 外部网关协议（或自治系统之间的路由选择协议），如 BGP-4 。 • RIP 是分布式的基千距离向横的路由选择协议，只适用千小型互联网。 RIP 按固定 的时间间隔与相邻路由器交换信息。交换的信息是自己当前的路由表，即到达本自 治系统中所有网络的（最短）距离，以及到每个网络应经过的下一跳路由器。 • OSPF 是分布式的链路状态协议，适用于大型互联网。 OSPF 只在链路状态发生变 化时，才向本自治系统中的所有路由器，用洪泛法发送与本路由器相邻的所有路由 器的链路状态信息。＂链路状态”指明本路由器都和哪些路由器相邻，以及该链路 的＂度量”。”度敝”可表示费用、距离、时延、带宽等，可统称为“代价＂。所有 的路由器最终都能建立一个全网的拓扑结构图。 • 协议 BGP-4 简称为 BGP, 是一种路径向量路由选择协议，用千在不同自治系统 AS 之间的路由选择。 BGP 力求在 AS 之间，找出一条能够到达目的网络前缀且较 好的路由（不是最佳路由，但不能兜圈子）。各种 BGP 报文是在 AS 之间的 BGP 连接（即 eBGP) 和 AS 内部的 BGP 连接（即iBGP) 上传送的。 BGP 路由指出， 从哪个路由器，经过哪些 AS, 就可以到达哪个网络前缀。 • 网际控制报文协议 ICMP 是 IP 层的协议。J CMP 报文作为 IP 数据报的数据，加上 首部后组成 IP 数摒报发送出去。使用 ICMP 并非为了实现可靠传输。 ICMP 允许 主机或路由器报告差错情况和提供有关异常情况的报告。 ICMP 报文的种类有两种， 即 ICMP 差错报告报文和 ICMP 询问报义。 • ICMP 的一个重要应用就是分组网间探测 PING, 用来测试两台主机之间的连通性。 PING 使用了 ICMP 回送谘求与回送回答报文。 • 要解决 IP 地址耗尽的问题，蛟根本的办法就是采用具有更大地址空间的新版本的 • 201 •"}
{"doc_id": "network", "page": 213, "text": "协议 IP, 即 1Pv6 。 • IPv6 所带来的主要变化是： （ I) 更大的地址空间（采用 128 位的地址）： （ 2) 灵活的 首部格式； （ 3) 改进的选项； （4) 支持即插即用； （ 5) 支持资源的预分配； (6) JPv6  首部改为 8 字节对齐。 • 1Pv6 数据报在基本首部的后面允许有零个或多个扩展首部，再后面是数据。所有 的扩展首部和数据合起来叫作数据报的有效载荷或净负荷。 • IPv6 数据报的目的地址可以是以下三种基本类型地址之一：单播、多播和任播。 • 1Pv6 的地址使用旨号十六进制记法。 • 向 IPv6 过渡只能采用逐步演进的办法，必须使新安装的 1Pv6 系统能够向后兼容。 向 IPv6 过渡可以使用双协议栈或使用隧道技术。 • 与单播相比，在一对多的通信中， IP 多播可大大节约网络资源。 IP 多播使用 D 类 IP 地址。 IP 多播需要使用网际组管理协议 IGMP 和多播路由选择协议。 • 虚拟专用网 VPN 利用公用的互联网作为本机构各专用网之间的通信载体。 VPN 内 部使用互联网的专用地址。一个 VPN 至少要有一个路由器具有合法的全球 IP 地址， 这样才能和本系统的另一个 VPN 通过互联网进行通信。所有通过互联网传送的数 据都必须加密。 • 使用网络地址转换 NAT 技术，可以在专用网络内部使用专用 lP 地址，而仅在连接 到互联网的路由器使用全球 IP 地址。这样就大大节约了宝贵的[P地址。 • MPLS 的特点： （ I) 支持面向连接的服务质榄； （2) 支持流量工程，均衡网络负载： (3) 有效地支持虚拟专用网 VPN 。 • MPLS 在入口节点给每一个 IP 数据报打上固定长度的“标签＂，然后根据标签在第 二层（链路层）用硬件进行转发（在标签交换路由器中进行标签对换），因而转发 速率大大加快。 • 软件定义网络 SDN 并不是要改变网络的功能，而是一种新的体系结构，其要点是： (I) 基于流的转发； （2) 数据层面与控制层而分离； （3) 控制层面用软件实现，并且 是逻辑上的集中式控制； （4) 可编程的网络。 • SON 控制器有以下三个层次： （ I) 通信层，大多采用协议 Openfl ow, 与数据层面 的接口叫作南向接口。 (2) 状态管理层。（3) 到网络控制应用程序层的接口（北向 接口）。 习题 4-01 网络层向上提供的服务有哪两种？试比较其优缺点。 4-02 网络互连有何实际意义？进行网络互连时，有哪些共同的问题需要解决？ 4-03 作为中间设备，转发器、网桥、路由器和网关有何区别？ 4-04 试简单说明下列协议的作用： IP,ARP 和 ICMP 。 4-05 IP 地址如何表示？ 4-06 IP 地址的主要特点是什么？ 4-07 试说明 IP 地址与 MAC 地址的区别。为什么要使用这两种不同的地址？ 4-08 IP 地址方案与我国的电话号码体制的主要不同点是什么？ • 202 •"}
{"doc_id": "network", "page": 214, "text": "4-09 IP 数据报中的首部检验和并不检验数据报中的数据。这样做的最大好处是什么？坏 处是什么？ 4-IO 当某个路由器发现一 IP 数据报的检验和有差错时，为什么采取丢弃的办法而不是要 求源站市传此数据报？计算首部检验和为什么不采用 CRC 检验码？ 4-11 设 IP 数据报使川固定首部，其各字段的具体数侦如 00 4-76 所示（除 IP 地址外，均 为十进制形式及示）。试用二进制运符方法计算应当写入到首部检验和字段中的数值 （用二进制形式表示）。 4 | 5 I 。 28  I o I 。 4 I 17 首部检验和（待i ”U 后写入） 10.12.14.5  12.6.7.9  图 4•76 习题 4.11 的图 4-12 亟新计符上题，但使用十六进制运算方法（每 16 位二进制数字转换为 4 个十六进制 数字，再按卜六进制加法规则计符）。比较这两种方法。 4-13 什么是奻大传送单元 MTU? 它和 IP 数拊报首部中的哪个字段有关系？ 4-14 在互联网中将 IP 数据报分片传送的数据报在蚊后的目的主机进行组装。还可以有另 一种做法，即数据报分片通过一个网络就进行一次组装。试比较这两种方法的优劣． 4-15 一个 3200 位长的 TCP 报文传到 IP 层，加上 160 位的首部后成为数据报。下而的互 联网山两个局域网通过路由器连接起来，但第二个局域网所能传送的蚊长数扼帧中 的数据部分只付 1200 位，因此数据报在路由器必须进行分片。试问第二个局域网向 其上层度传送多少比特的数捆（这里的“数据“当然指的是局域网看见的数据） ?  4-16 (I) 试胖杆为什么 ARP 高速缓存每存入一个项目就要设饮 10~20 分钟的超时计时器。 这个时间设罚得太大或太小会出现什么问题？ (2) 举出个少两种不斋婓发送 ARP 请求分组的悄况（即不需要诏求将某个目的 IP 地 址斛析为相应的 MAC 地址）． 4-17 上机 A 发送 IP 数据报给主机 B, 途中经过了 5 个路由器。试问在 rP 数据报的发送过 4-18  程中总共使用f儿次 ARP? 设某路山器建立了如下转发表： 讥缀匹配 飞一祧 192.4.153.0/26 R3  128.96.39.0/25 接口 mO 128.96.39.128/25 接口 ml 128.96.40.0 /25 R2  192.4.153.0/26 R3  * （默认） R  现共收到 5 个分组，其目的地址分别为： {I) 128.96.39.10  • 203 •"}
{"doc_id": "network", "page": 215, "text": "(2) 128.96.40.12  (3) 128.96.40.151  (4) 192.4.153.17  (5) 192.4.153. 90  试分别计算其下一跳。 4-19 某中位分配到一个地J1l ：块 129.250/1 6 。该羊位有 4000 台机器，平均分布在 16 个不同 的地点。试给每个地点分配一个地址块，井饵出每个地址块中 IP 地址的最小伯和 最大伯。 4-20 一个数据报长度为 4000 字节（同定首部长度）。现在经过－个网络传送，但此网络 能够传送的垃大数据长度为 1500 字节。试问应当划分为几个短些的数据报片？各数 据报片的数拟字段长度、片偏移字段和 MF 标志应为何数值？ 4-21 写出互联网的 IP 层开找跺由的贷法。 4-22 有如下的 4 个/24 地址块，试进行蚊大可能的聚合。 212.56.132.0/24  212.56.133.0/24  212.56.134.0/24  212.56.135.0 /2 4  4-23 有两个 CIDR 地址块 208.128/11 和 208.130.28/22 。是否有哪一个地址块包含了另一个 的地址？如果付，谓指出，并说明理由。 4-24 已知路由器凡的转发表如表 4-10 所示。 表 4-10 习题 4-24 中路由器凡的转发表 前缀匹配 下一跳地址 路由器接口 140.5.12.64126 180.15.2.5 m2  130.5.8/24 190.16.6.2 ml  110.71/16 ... mo  180.15 16 ... m2  190 16/16 ... ml  欢认 I 10.71.4.5 mO  试圃出各网络和必要的路巾器的连接拓扑，标注出必要的 IP 地址和接 0 。对不能确 定的情况应当指明。 4-25 一个自治系统分配到的 IP 地址块为 30.138.118/23, 片包含有 5 个局域网，其连接图 如图 4-77 所小，每个屈域网上的上机数分别标注在图 4-77 上。试给出每一个局域网 的地址块（包括前缀）。 .  • 204 •  LAN2 91 个「．机 I  了 LAN1 150 个七机 I  了 LANI  LAN4 3 个主机 30.138.tt 8/2 3.  1乙 LAN` 15 个主机 丁厂－ .................. ···········.....................................................一一一．．．．．． 图 4-77 习题 4-25 的图"}
{"doc_id": "network", "page": 216, "text": "4-26 一个大公司有一个总部和三个下属部门。公司分配到的网络前缀是 192. 77.33/24 。公 司的网络布局如图 4-78 所示。总部共有 5 个局域网，其中的 LAN1~LAN4 都连接到 路由器 R1 上，凡再通过 LANs 与路由器凡相连。凡和远地的三个部门的局域网 LAN6~LA凡通过广域网相连。每一个）LJ域网旁边标明的数字是局域网上的主机数。 试给每一个局域网分配一个合适的网络前缀。 .、,•·············································································································· .·.,···-··-·•. I 92. 77.33/24 o ••  :. 50 ·、了 LANl ; R3,········· \\  IO :LAN~2`\\:l, 4 ~ R2 二，、二：： 28 LAN了－LAN，5－二言了一 ..',、· LA.N·`.` 竺尸::LAN众 25,··········., • • · · ·' ...................,................................. ················............................  图 4-78 习题 4-26 的图 4-27 以下地址中的哪一个和 86.32/12 匹配？诮说明理由。 (1) 86.33.224.123: (2) 86.79.65.216: (3) 86.58. I I 9.74: (4) 86.68.206.154 。 4-28 以下的地址前缀中的哪一个地址与 2.5 2.90.140 匹配？请说明理由。 (l) 0/4; (2) 32/4; (3) 4/6: (4) 80/4 。 4-29 下面的前缀中的哪一个和地址 152.7.77.159 及 152.31 .4 7.252 都匹配？请说明理由。 (I) 152.40/13: (2) 153.40/9: (3)152.64/1 2: (4) 152.0/1 I 。 4-30 与下列掩码相对应的网络前缀各有多少位？ (I) 192.0.0.0: (2) 240.0.0.0; (3) 255.224.0.0: (4) 255.255.255.252 。 4-31 已知地址块中的一个地址是 140.120.84.24/20 。试求这个地址块中的最小地址和最大 地址。地址掩码是什么？地址块中共有多少个地址？相当千多少个 C 类地址？ 4-32 已知地址块中的一个地址是 I 90.87.140.202/29 。觅新计尊上题。 4-33 某单位分配到一个地址块 136.23.12.64/2 6 。现在需要进一步划分为 4 个一样大的子 网。试问： (I)每个于网的网络前缀有多长？ (2) 每一个子网中有多少个地址？ (3) 每一个子网的地址块是什么？ (4) 每一个子网可分配给主机使用的最小地址和最大地址是什么？ 4-34 IGP 和 EGP 这两类协议的主要区别是什么？ 4-35 试简述 RIP, OSPF 和 BGP 路由选择协议的主要特点。 4-36 RIP 使用 UDP, OSPF 使用 TP, 而 BGP 使用 TCP 。这样做有何优点？为什么 RIP 周 期性地和邻站交换路由信息而 BGP 却不这样做？ 4-37 假定网络中的路由器 B 的路由表有如下的项目（这三列分别表示“目的网络”“距离” 和“下一跳路由器”): N1 7 A  N2 2 C  6 8 F  N8 4 E  N9 4 F  • 205 •"}
{"doc_id": "network", "page": 217, "text": "现在 B 收到从 C 发来的路由信息（这两列分别表示“目的网络”和＂距离”): 2 J 68  NN  4843  N9 5  试求出路山器 B 更新后的路由表（详细说明每一个步骤）。 4-38 网络如图 4-79 所示。假定 AS1 和 AS4 运行程序 RIP, AS2 和 AS3 运行程序 OSPF 。 AS 之间运行程序 eBGP 和i BGP 。目前先假定在 AS2 和 AS4 之间没有物理连接（图中的 虚线表示这个假定）。 Rb：兰气 ＾之二之n,  搂IJ I  图 4-79 习题 4-38 的图 (I) 路山器 R3c 使用哪一个协议知逍前缀 X (X 在 AS4 中） ?  (2) 路由器 R3a 使用哪～个协议知逍前缀 X? (3) 路由器 R i c 使用哪一个协议知追前缀 X? (4) 路由器 Rld 使用哪一个协议知逆前缀 X? 4-39 网络同上题。路由器 R,d 知逆前缀 X ，并将前缀 X 马入转发表。 (I) 试问路由器 R1d 应当从接口 1 还是接口 2 转发分组呢？请简述理由。 (2) 现假定 AS2 和 AS4 之间有物理连接，即图中的虚线变成了实线。假定路由器 Ri d 知追到达前缀 X 可以经过 AS2, 但也可以经过 AS3 。试问路由器 R1d 应当从接口 1 还是按门 2 转发分组呢？清简述理由。 (3) 现假定有另一个 AS5 处在 AS2 和 AS4 之间（图中的虚线之间未画出 AS5) 。假定 路由器 R1d 知道到达前缀 X 可以经过路巾 [AS2 AS5 AS4), 但也可以经过路由 [AS3 AS4] 。试问路由器 Rld 应当从接口 1 还是接口 2 转发分组呢？请简述理由。 4-40 IGMP 协议的要点是什么？隧逍技术在多播中是怎样使用的？ 4-41 什么是 VPN? VPN 有什么特点和优缺点？ VPN 有几种类别？ 4-42 什么是 NAT? NAPT 有哪些特点？ NAT 的优点和缺点有哪些？ 4-43 试把下列 1Pv4 地址从二进制记法转换为点分十进制记法。 (I) I 000000 I 0000 I O I I 0000 IO I I 111 01111  (2) 11000001 10000011 00011011 11111111  (3) 11100111110110111000101101101111  (4) 1111 I 00 I I 00110 I I 11111011 00001111  4-44 假设一段地址的首地址为 146.102.29.0, 末地址为 146.102.32.255, 求这个地址段的 • 206 •"}
{"doc_id": "network", "page": 218, "text": "地址数。 4-45 已知一／27 网络中有一个地址是 167.199.170.82, 问这个网络的网络掩码、网络前缀 长度和网络后缀长度是多少？ 4-46 已知条件同上题，试求这个地址块的地址数、首地址以及末地址各是多少？ 4-47 某单位分配到一个地址块 14.24.74.0/24 。该单位需要用到三个子网，对这三个子地址 块的具体要求是：子网 N1 需要 120 个地址，子网沁需要 60 个地址，子网 N3 需要 10 个地址。请给出地址块的分配方案。 4-48 如图 4-80 所示，网络 145 .1 3.0.0/16 划分为四个子网 N1, N2, N3 和 N4 。这四个子网与 路由器 R 连接的接口分别是 mO, ml, m2 和 m3 。路由器 R 的第五个接口 m4 连接到互 联网。 网络 145. 13.0.0/16  ••. •··_-_._._-_·················_·_·_·_··_~·-·_·_······································.、·` \\  .... ···································.、·、、 , 4 145130 1',)45 13 64 1. 、 m4 u/  工 ...:  ii＝已，＇； ; ·、 145.13.192.1 /  .. -、、.. 气、．； N3 145.13.128.0/1 8 、···、. ;  `' ,'  I... i i  一，： ;  :._ 145.13.128.1  ..'  合＇： ....,  ，．命，,  、·---····----··········· '-.、、-•· 、.、.、..、、.-·· ---······-·· ',  ·············································································/  、·.、 图 4-80 习题 4-48 的图 (1) 试给出路由器 R 的路由表。 (2) 路由器 R 收到一个分组，其目的地址是 145.13.160.78 。试给出这个分组是怎样被 转发的。 4-49 收到一个分组，其目的地址 D = 1 1.l .2 .5。要查找的转发表中有这样三项： 路由 1 到达网络 11.0.0.0/8 路由 2 到达网络 1 l.1.0.0/16  路由 3 到达网络 1 1. 1.2.0/24  试问在转发这个分组时应当选择哪一个路由？ 4-50 同上题。假定路由 1 的目的网络 11.0.0.0/8 中有一台主机 H, 其 IP 地址是 1 1.1. 2.3 。 当我们发送一个分组给主机 H 时，根据最长前缀匹配准则，土面的这个转发表却把 这个分组转发到路由 3 的目的网络 11.1.2.0/24 。是砓长前缀匹配准则有时会出错吗？ 4-51 已知一 CIDR 地址块为 200.56.168.0/21 。 (1) 试用二进制形式表示这个地址块。 (2) 这个 CIDR 地址块包括有多少个 C 类地址块？ 4-52 建议的 IPv6 协议没有首部检验和。这样做的优缺点是什么？ 4-53 在 1Pv4 首部中有一个“协议”字段，但在 1Pv6 的固定首部中却没有。这是为什么？ • 207 •"}
{"doc_id": "network", "page": 219, "text": "4-54 当使用 IPv6 时，协议 ARP 是否需要改变？如果需要改变，那么应当进行概念性的改 变还是技术性的改变？ 4-55 1Pv6 只允许在源点进行分片。这样做有什么好处？ 4-56 设每隔 l 微微秒就分配出 100 万个 IPv6 地址。试计算大约要用多少年才能将 1Pv6 地 址空间全部用光。可以和宇宙的年龄（大约有 100 亿年）进行比较。 4-57 试把以下的 TPv6 地址用零压缩方法写成简洁形式： (I) 0000:0000:0F53 :6382:AB00:67D8: 8B27:7332  (2) 0000:0000:0000:0000:0000:0000 :004D: ABCD  (3) 0000:0000:0000:AF36:7328:0000:87 AA:0398  (4) 2819:00AF:0000:0000:0000:0035:0CB2:B27 l  4-58 试把以下的零压缩的 1Pv6 地址写成原来的形式： (1) 0::0  (2) 0:AA::0  (3) 0:1234::3  (4) 123::1:2  4-59 从 IPv4 过渡到 1Pv6 的方法有哪些？ 4-60 多协议标签交换 MPLS 的工作原理是怎样的？它有哪些主要的功能？ 4-61 SDN 的广义转发与传统的基于终点的转发有何区别？ 4-62 试举出 IP 数据报首部中能够在 Op e nf low 1.0 中匹配的三个字段。试举出在 Op e nflow 中不能匹配的三个 IP 数据报首部。 4-63 网络如图 4-81 所示。 (1) 假定路由器 R1 把所有发往网络前缀 123. 1. 2.16/29 的分组都从接口 4 转发出去。 (2) 假定路由器 R1 要把凡发往 123.1.2.16/29 的分组从接口 4 转发出去，而把 H2 发 往 123. 1. 2.16/29 的分组从接口 3 转发出去。 试问，在上述两种情况下，你都能够给出路由器凡的转发表吗？转发表只需要给出 发往 123. 1. 2.16/29 的分组应当从哪一个接口转发出去。 二兰 128.1.2.16/29二 R 已－二l281218 仁二 `  图 4-81 习题 4-63 的网络 4-64 已知一具有 4 个接口的路由器凡的转发表如表 4-11 所示，转发表的每一行给出了目 的地址的范围，以及对应的转发接口。 • 208 •  表 4-11 习题 4-64 中路由器 R1 的转发表 目的地址范围 簸小地址 11100000 000000010000000000000000  蚊大地址 11100000 00000001 11111111 11111111  转发接口 。"}
{"doc_id": "network", "page": 220, "text": "续表 目的地址范困 转发接口 奻小地址 11100000 00000000 00000000 00000000 I  砓大地址 11100000 00000000 11111111 11111111  鼓小地址 11100000 00000010 00000000 00000000 2  酘大地址 1110000111111111 llllllll llllllll  其他 3  (1)试把以上转发表改换为另一形式，其中的目的地址范围改为前缀匹配，而转发表 由 4 行增加为 5 行。 (2) 若路由器收到一个分组，其目的地址是： (a) 111 00000 l 0000001 0 l O I 000 I O l O I O IO I  (b) 11100000 00000000 110 IO 111 01111100  (c) 111 0000 I 1 00 l 0000 000 I 000 I O 11 I O I I I  试给出每一种情况下分组应当通过的转发接口。 4-65 一路由器连接到三个子网，这三个子网共同的前缀是 225.2.17/24 。假定子网凡要有 62 台主机，子网凡要有 105 台主机，而子网 N3 要有 12 台主机。试分配这三个子网 的前缀。 4-66 图 4-82 是一个 SON Op e nflow 网络．假定： Open fl ow 控制器 10.3.0.6 H. I _,, • 1 、、几110.2.0 .4 0.2.0.3  I~之』一1 ~. -—-10.1.0.1 H  一1 一 1 图 4-82 一个 SON Op enFlow 网络 • 任何来自 Hs 或凡并到达输入端口 1 的且发往 H1 或比的分组，应通过端口 2 转发出去。 • 任何来自凡或 H2 并到达输入端口 2 的且发往凡或 H6 的分组，应通过端口 l 转发出去。 • 任何从端口 1 或 2 进入的且发往 H3 或比的分组，应交付指明的主机： • H3 或 H4 彼此可以互相发送分组。 试给出交换机 S2 的流表项（即每一行的＂匹配＋动作”)。 4-67 SON Op e nflow 网络同上题。从主机 H3 或凡发出并到达 S2 交换机的分组，应遵循以 下规则： • 任何来自凡并到达输入端口 2 的且发往 H1, H2, Hs 或儿的分组，应顺时针转发 出去。 • 209 •"}
{"doc_id": "network", "page": 221, "text": "• 任何来自 H4 并到达输入端 U2 的且发往 H1, H2, Hs 或 H6 的分组，应逆时针转发 出去。 试给出交换机 S2 的流表项（即每一行的＂匹配＋动作”)。 4-68 SDN Op enFlow 网络问上题。在交换机 S1 和 S3 有这样的规定：从源地卅庄或 H4 到来 的分组，将按照分组首部中的目的地址进行转发。试给出交换机 S1 和 S3 的流表。 4-69 SDN OpenFlow 网络同上题。假定我们把交换机 S2 作为防火瑞。防火墙的行为有以下 两种： (I) 对于目的地址为 H3 和比的分组，仅可转发从凡和 H6 发出的分组，也就是说， 从 H1 和 H5 发出的分组应当被阻挡。 (2) 仅对千目的地址为凡的分组才交付，也就是说，所有发往比的分组均被阻挡。 试分别对上述的每一种情况给出交换机 S2 的流表。对于发往其他路由器的分组可不 用管。 • 210 •"}
{"doc_id": "network", "page": 222, "text": "第 5 章运输层 本章先概括介绍运输层协议的特点、进程之间的通信和端口等祖要概念，然后讲述比 较简单的 UDP 协议。其余的篇幅都是讨论较为复杂但非常重要的 TCP 协议吁U 可靠传输的工 作原理，包括停止等待协议和 ARQ协议。在详细讲述 TCP 报文段的首部格式之后，讨论 TCP 的三个重要问题：滑动窗口、流爵控制和拥塞控制机制。最后，介绍 TCP 的连接管理。 运输层是整个网络体系结构中的关键层次之一。一定要弄清以下一些重要概念： (I) 运输层为相互通信的应用进程提供逻辑通信。 (2) 端口和套接字的意义。 (3) 无连接的 UDP 的特点。 (4) 面向连接的 TCP 的特点。 (5) 在不可靠的网络上实现可靠传输的工作原理，停止等待协议和 ARQ协议。 (6) TCP 的滑动窗口、流批控制、拥塞控制和连接管理。 5.1 运输层协议概述 5.1.1 进程之间的通信 从通信和信息处理的角度吞，运输层向它上面的应用层提供通信服务，它屈千面向通 信部分的最高层，同时也是用户功能中的最低层。当网络边缘部分的两台主机使用网络核心 部分的功能进行端到端的通信时，都要使用协议栈中的运输层，而网络核心部分中的路由器 在转发分组时只用到下三层的功能。 下面通过图 5-1 的示意图来说明运输层的作用。设局域网 LAN1 上的主机 A 和局域网 LAN2 ．上的主机 B 通过互连的广域网 WAN 进行通信。我们知道， IP 协议能够把源主机 A 发 送出的分组，按照首部中的目的地址，送交到目的主机 B, 那么，为什么还需要运输层呢？ 从 IP 层来说，通信的两端是两台主机。 1P 数据报的首部明确地标志了这两台主机的 IP 地址。但“两台主机之间的通信”这种说法还不够明确。真正进行通信的实体是在主机中的 哪个构件呢？是主机中的应用进程，是一台主机中的应用进程和另一台主机中的应用进程在 交换数据（即通信）。因此严格地讲，两台主机进行通信就是两台主机中的应用进程互相通 信。 IP 协议虽然能把分组送到目的主机，但是这个分组还停留在主机的网络层而没有交付 主机中的应用进程。通信的两端应当是两个主机中的应用进程。也就是说，端到端的通信是 应用进程之间的通信。在一台主机中经常有多个应用进程同时分别和另一台主机中的多个应 用进程通信。例如，某用户在使用浏览器查找某网站的信息时，其主机的应用层运行浏览器 客户进程。如果在浏览网页的同时，还要用电子邮件给网站发送反馈意见，那么主机的应用 ＠注 运输层最近又增加了第＝种协议，即流控制传输协议 SCTP (Stream Control Transmission Protocol) [RFC 4960, 建议 标准］．它具有 TCP 和 UDP 协议的共同优点，可支持一些新的应用，如 IP 电话。限千篇幅．这里不再介绍． • 211 •"}
{"doc_id": "network", "page": 223, "text": "层就还要运行电子邮件的客户进程。在图 5-1 中，主机 A 的应用进程 AP1 和主机 B 的应用 进程 AP3 通信，而与此同时，应用进程 AP2 也和对方的应用进程 AP4 通信。这表明运输层 有一个很亟要的功能一复用 (mul tiplex i n g)和分用 (demul tip lex ing)。这里的“复用”是指在发 送方不同的应用进程都可以使用同一个运输层协议传送数据（当然需要加上适当的首部），而 “分用”是指接收方的运输层在剥去报文的首部后能够把这些数据正确交付目的应用进程兜 图 5-1 中两个运输层之间有一·个深色双向粗箭头，写明”运输层提供应用进程间的逻辑通 信”。”逻辑通信”的意思是：从应用层来看，只要把应用层报文交给下面的运输层，运输层 就可以把这报文传送到对方的运输层（哪怕双方相距很远，例如几千公里），好像这种通信 就是沿水平方向直接传送数据。但事实上这两个运输层之间并没有一条水平方向的物理连接。 数据的传送是沿着图中的虚线方向（经过多个层次）传送的。＂逻辑通信”的意思是“好像 是这样通信，但事实上并非真的这样通信”。 运输层提供应用进程间的逻辑通信 ••  ::··… .r .. ::··  3-21  勹．层lp 勹． 3  2  '-.................... .,”“'···········  主机 A 主机 B ｀心之--W巴三少三 : :, 网络层为 l\"．机之间的通信提供服务 : :  : 坠输层为应用层进程之间的通信提供服务 :  图 5-1 运输层为相 h 通信的应用进程提供了逻钳通信 从这里可以看出网络层和运输层有明显的区别。网络层为主机之间的通信提供服务， 而运输层则在网络层的基础上，为应用进程之间的通信提供服务。然而正如后面还要讨论的， 运输层还具有网络层无法代替的许多其他正要功能。 运输层还要对收到的报文进行差错检测。大家应当还记得，在网络层， IP 数据报首部 中的检验和字段，只检验首部是否出现差错而不检查数据部分。 根据应用程序的不同盆求，运输层需要有两种不同的运输协议，即面向连接的 TCP 和 无连接的 UDP, 这两种协议就是本漳要讨论的主要内容。 我们还应指出，运输层向高层用户屏蔽了下面网络核心的细节（如网络拓扑、所采用 的路由选择协议等），它使应用进程看见的就是好像在两个运输层实体之间有一条端到端的 逻辑通信信道，但这条逻辑通信信道对卜层的表现却因运输层使用的不同协议而有很大的差 别。当运输层采用面向连接的 TCP 协议时，尽管下面的网络是不可靠的（只提供尽最大努 ＠注： rP 层也有复用和分用的功能．即仕发送方使用不同协议的数据都可以封装成 U) 数据报发送出去，而在接收方的 IP 层根据 IP 首部中的协议字段进行分川，把剥去门部后的妏据交付l应当接收这些数据的协议。 • 212 •"}
{"doc_id": "network", "page": 224, "text": "力服务），但这种逻辑通信信道就相当千一条全双工的可靠信道。但当运输层采用无连接的 UDP 协议时，这种逻辑通信信道仍然是一条不可靠信道。 5.1.2 运输层的两个主要协议 TCP/IP 运输层的两个主要协议都是互联网的正式标准，即： (1) 用户数据报协议 UDP (lJ ser Datagram Protocol) (RFC 768, STD6]  (2) 传输控制协议 TCP (Transmj ssion Control Protocol) [RFC 793, STD7]  图 5-2 给出了这两种协议在协议栈中的位置。 应用层 UDP | TCP  IP  与各种网络接门 图 5-2 TCP/IP 休系中的运输层协议 按照 OSI 的术语，两个对等运输实体在通信时传送的数据单位叫作运输协议数据单元 TPDU (Transport Protocol Data Unit)。但在 TCP/IP 体系中，则根据所使用的协议是 TCP 或 UDP, 分别称之为 TCP 报文段(se gmen t)或 UDP 用户数据报。 UDP 在传送数据之前不需要先建立连接。远地主机的运输层在收到 UDP 报文后，不需 要给出任何确认。虽然 UDP 不提供可靠交付，但由千 UDP 非常简单，在某些情况下 UDP 是一种最有效的工作方式。 TCP 则提供面向连接的服务。在传送数据之前必须先建立连接，数据传送结束后要释 放连接。 TCP 不提供广播或多播服务。由千 TCP 要提供可靠的、面向连接的运输服务，因 此不可避免地增加了许多的开销，如确认、流批控制、计时器以及连接管理等。这不仅使协 议数据单元的首部增大很多，还要占用许多的处理机资源。 表 5-1 给出了一些应用和应用层协议主要使用的运输层协议 (UDP 或 TCP) 。 表 5-1 使用 UDP 或 TCP 协议的各种应用和应用层协议 应用 应用层协议 运输层协议 名字转换 DNS （域名系统） UDP  文件传送 TFTP （简单文件传送协议） UDP  路由选择协议 RIP （路由信息协议） UDP  IP 地址配茂 DHCP （动态主机配跷协议） UDP  网络节理 SNMP （简巾网络符理协议） UDP  远程文件服务器 NFS （网络文件系统） UDP  IP 电话 专用协议 UDP  流式多媒体通信 专用协议 UDP  多播 IGMP （网际纠忤理协议） UDP  屯子邮件 SMTP （简单邮件传送协议） TCP  远程终端桵入 TELNET （远程终端协议） TCP  万维网 HTTP （超文木传送协议） TCP  文件传送 FTP （文件传送协议） TCP  • 213 •"}
{"doc_id": "network", "page": 225, "text": "5.1.3 运输层的端口 前面已经提到过运输层的复用和分用功能。共实在日常生活中也有很多复用和分用的 例子。假定一个机构的所有部门向外单位发出的公文都由收发室负责寄出，这相当千各部门 都“复用“这个收发室。当收发室收到从外单位寄来的公文时，则要完成“分用“功能，即 按照信封上写明的本机构的部门地址把公文正确进行交付。 运输层的复用和分用功能也是类似的。应用层所有的应用进程都可以通过运输层再传 送到 IP 层（网络层），这就是复用。运输层从 IP 层收到发送给各应用进程的数据后，必须 分别交付指明的各应用进程，这就是分用。显然，给应用层的每个应用进程赋予一个非常明 确的标志是至关重要的。 我们知道，在单个计算机中的进程是用进程标识符（一个不大的整数）来标志的。但 是在互联网环境下，用计算机操作系统所指派的这种进程标识符来标志运行在应用层的各种 应用进程则是不行的。这是因为在互联网上使用的计算机的操作系统种类很多，而不同的操 作系统又使用不同格式的进程标识符。为了使运行不同操作系统的计算机的应用进程能够互 相通信，就必须用统一的方法（而这种方法必须与特定操作系统无关）对 TCP/I P 体系的应 用进程进行标志。 但是，把一个特定机器上运行的特定进程，指明为互联网上通信的最后终点是不可行 的。这是因为进程的创建和撤销都是动态的，通信的一方几乎无法知道和识别对方机器上的 进程。另外，我们往往需要利用目的主机提供的功能来识别终点，而不需要知道具体实现这 个功能的进程是哪一个（例如，要和互联网上的某个邮件服务器联系，但并不一定要知道这 个服务器功能是由目的主机上的哪个进程实现的）。 解决这个问题的方法很巧妙，就是在应用层和运输层之间的界面上，设置一个特殊的 抽象的“门”。应用层中的应用进程要通过运输层发送到互联网，必须要通过这个门。而别 的主机上的应用进程要寻找本主机中的某个应用进程，也必须通过这个门。这样，我们就可 以把应用层和运输层的界面上这些“门”，设为通信的抽象终点。这些抽象终点的正式名称 就是协议端口(protocol p o rt),一般就简称为端口(pO rt)。每一个端口用一个称为端口号(pO rt number) 的正整数来标志。主机的操作系统提供了接口机制，使得进程能够通过这种机制找 到所要找的端口。 诸注意，这种在协议栈层间的抽象的协议端口是软件端口，和路由器或交换机上的硬 件端口是完全不同的概念。硬件端口是不同硬件设备进行交互的接口，而软件端口是应用层 的各种协议进程与运输实体进行层间交互的地点。不同的系统具体实现端口的方法可以是不 同的（取决于系统使用的操作系统）。 当应用层要发送数据时，应用进程就把数据发送到适当的端口，然后运输层从该端口 读取数据，进行后续的处理（把数据发送到目的主机）。当运输层收到对方主机发来的数据 时，就把数据发送到适当的端口，然后应用进程就从该端口读取这些数据。显然，端口必须 有一定容报的缓存来暂时存放数据。 在后面将讲到的 UDP 和 TCP 的首部格式中（图 5-5 和图 5-14), 都有源端口和目的端 口这两个亟要字段。这两个端口就是运输层和应用层进行交互的地点。 TCP/I P 的运输层用一个 16 位端口号来标志一个端口。但诸注意，端口号只具有本地意 义，它只是为了标志本计算机应用层中的各个进程在和运输层交互时的层间接口。在互联网 不同计算机中，相同的端口号是没有关联的。 16 位的端口号可允许有 65535 个不同的端口 • 214 •"}
{"doc_id": "network", "page": 226, "text": "号，这个数目对一个计算机来说是足够用的。 由此可见，两个计算机中的进程要互相通信，不仅必须知道对方的 IP 地址（为了找到 对方的计算机），而且要知道对方的端口号（为了找到对方计算机中的应用进程）。这和我 们寄信的过程类似。当我们要给某人写信时，就必须在信封上写明他的通信地址（这是为 了找到他的住所，相当千 IP 地址），并且还要写上收件人的姓名（这是因为在同一住所中可 能有好几个人，这相当于端口号）。在信封上还应写明自己的地址和姓名。当收信人回信时， 很容易在信封上找到发信人的地址和姓名。互联网上的计算机通信是采用客户－服务器方式。 客户在发起通信请求时，必须先知道对方服务器的 IP 地址（用来找到目的主机）和端口号 （用来找到目的进程）。因此运输层的端口号分为下面的两大类。 (I) 服务器端使用的端口号 这里又分为两类，最重要的一类叫作熟知端口号(well- known port number) 或全球通用端口号，数值为 0~1023 。这些熟知端口号砓初公布在文档中 [RFC 1700, STD2], 但后来因为互联网发展太快，这种标准文档无法随时更新，因此在阳RFC 3232 中就把 RFC 1700 列为陈旧的，而当前最新的熟知端口号可在网址 www.i ana.org上查到。 lANA 把这些熟知端口号指派给了 TCP/IP 敬重要的一些应用程序，让所有的用户都知道。 当一种新的应用程序出现后，JANA 必须为它指派—个熟知端口，否则互联网上的其他应用 进程就无法和它进行通信。和电话通信对比，熟知端口号相当干所有人都应知晓的重要电话 号码，如报警电话 110, 急救电话 120 等。表 5-2 给出了一些常用的熟知端口号。 表 5-2 常用的熟知端口号 应用程序 I FTP I TELNET I SMTP I DNS I TFTP I HTTP I SNMP I SNMP (trap) I HTTPS  熟知端口牙 I 21 23 25 53 69 80 161 162 44J  另一类叫作登记端口号，数值为 1024~49151 。这类端口号是为没有熟知端口号的应用 程序使用的。要使用这类端口号必须存 IANA 按照规定的手续登记，以防止屈复。 (2) 客户端使用的端口号 数值为 49152~65535 。由千这类端口号仅在客户进程运行 时才动态选择，因此又叫作短暂端口号°。这类端口号就是临时端口号，留给客户进程选择 临时使用。当服务器进程收到客户进程的报文时，就知道了客户进程所使用的端口号，因而 可以把数据发送给客户进程。通信结束后，刚才已使用过的客户端口号就被系统收回，以便 给其他客户进程使用。 下面将分别讨论 UDP 和 TCP 。 UDP 比较简单，本章主要讨论 TCP 。 5.2 用户数据报协议 UDP 5.2.1 UDP 概述 用户数据报协议 UDP 只在 IP 的数据报服务之上增加了很少一点的功能， 这就是复用和分用的功能以及差错检测的功能。 UDP 的主要特点是： 视桥讲解 ＠注：短暂端 rl(ephemeral port)[STEV94. p.13) 表示这种端Li的存在时间是短期的．客户进程并不在愁橾作系统给它分配的 是哪一个端口号，因为各户进程之所以必须有一个端口号（在木地上机中必须是唯一的），是为了让运输层的实体能够找到自己。 这和熟知端口不同。服务器机器一接通电源，服务器程序就运行起米．力 Il I:互联网上所有的客户程序都能找到服务器程序，服 务器程序所使用的端口（即熟知端口）就必须是固定的．并且是众所周知的． • 215 •"}
{"doc_id": "network", "page": 227, "text": "(1) UDP 是无连接的，即发送数据之前不需要建立连接（当然，发送数据结束时也没有 连接可释放），因此减少了开销和发送数据之前的时延。 (2) UDP 使用尽最大努力交付，即不保证可靠交付，因此主机不需要维持复杂的连接状 态表（这里面有许多参数）。 (3) UDP 是面向报文的。发送方的 UDP 对应川程序交下来的报文，在添加首部后就向 下交付 1P 层。 UDP 对应用层交下来的报文，既不合并，也不拆分，而是保留这些报文的边 界。这就是说，应用层交给 UDP 多长的报文， UDP 就照样发送，即一次发送一个报文，如 图 5-3 所示。在接收方的 UDP, 对 lP 层交上来的 UDP 用户数据报，在去除首部后就原封不 动地交付上层的应用进程。也就是说， UDP 一次交付一个完整的报文。因此，应用程序必 须选择合适大小的报文。若报文太长， UDP 把它交给 IP 层后， IP 层在传送时可能要进行分 片，这会降低 lP 层的效率。反之，若报文太短， UDP 把它交给 IP 层后，会使 lP 数据报的 首部的相对长度太大，这也降低了 IP 层的效率。 应用层报文 l 应用层 UDP 首部 I UDP 用户数据报的数据部分 I 运输层 IP 首部 I IP 数据报的数据部分 I IP 层 图 5-3 UDP 是面向报文的 (4) UDP 没有拥塞控制，因此网络出现的拥塞不会使源主机的发送速率降低。这对某些 实时应用是很重要的。很多的实时应用（如 IP 电话、实时视频会议等）要求源主机以恒定 的速率发送数据，并且允许在网络发生拥塞时丢失一些数据，但却不允许数据有太大的时延。 UDP 正好适合这种要求。 (5) UDP 支持一对一、一对多、多对一和多对多的交互通信。 (6) UDP 的首部开销小，只有 8 个字节，比 TCP 的 20 个字节的首部要短。 下面举例说明 UDP 的通信和端口号的关系（如图 5-4 所示）。主机 H1 中有三个应用进 程分别要和主机 H2 中的两个应用进程进行通信。通信双方的关系是： P1 一凡， P2-P4, P3 一 P50 主机凡的操作系统为这三个进程分别指派了端口，其端口号分别为 a, b 和 c 。图中位于应 用层和运输层之间的小方框代表端口。在端口小方框中间还画有队列，表示端口具有缓存的 功能，可以把收到的数据暂时存储一下。有时也可以把队列画成双向的，即分别表示存放来 自应用层或运输层的数据。现在假定主机凡中的进程已经知道了对方进程凡和凡的端口 号分别为 x 和y,于是在主机凡的运输层就可以组装成需要发送的 UDP 用户数据报，其中 最重要的地址信息（源端口，目的端口）分别是（a, x), (b, x) 和 (c, y)。在图 5-4 中把运输层以下 的都省略了。因此，进程之间的通信现在可以看成是两个端口之间的通信。 图中在两个运输层之间有一条虚线，表示在两个运输层之间可以进行通信，而不是一 条连接。但这种通信是不可靠的通信，即所发送的报文在传输过程中有可能丢失，同时也不 保证报文都能按照发送的先后顺序到达终点。这正是 UDP 通信的特点：简单方便，但不可 靠。如果想要得到可靠的运输层通信，那就要使用后面要介绍的 TCP 进行通信。诮注意， 在两个运输层的 UDP 之间并没有建立连接。 • 216 •"}
{"doc_id": "network", "page": 228, "text": "应用进程 运输层 复用 分用 不可靠的信道 a 二X b 二X C;;y  诮注意：运输层之间的这条虚线不是一条连接 图 5-4 UDP 的通信和端口号的关系 H2  应用层 端口 运输层 图 5-4 的例子画出了多对一的通信（ a-x, b-x) 。如果改成 a 一 X, a 一y,则是一对多的 情况了。 主机凡中的 3 个应用进桯，把用户数据通过各自的端口传送到了运输层后，就共用一 个网络层协议，把收到的 UDP 用户数据报组装成不同的 IP 数据报，发送到互联网。这就是 UDP 的复用功能。主机 H2 的网络层收到 3 个 IP 数据报后，提取出数据部分（即 UDP 用户 数据报），然后根据其首部中的目的端口号，分别传送到相应的端口，以便上层的应用进程 到端口读取数据。这就是 UDP 的分用功能。 虽然某些实时应用需要使用没有拥塞控制的 UDP, 但当很多的源主机同时都向网络发 送高速率的实时视频流时，网络就有可能发生拥塞，结果大家都无法正常接收。因此，不使 用拥塞控制功能的 UDP 有可能会引起网络产生严重的拥塞问题。 还有一些使用 UDP 的实时应用，需要对 UDP 的不可靠的传输进行适当的改进，以减 少数据的丢失。在这种情况下，应用进程本身可以在不影响应用的实时性的前提下，增加一 些提高可靠性的措施，如采用前向纠错或亘传已丢失的报文。 5.2.2 UDP 的首部格式 用户数据报 UDP 有两个字段：数据字段和首部字段。首部字段很简单，只有 8 个字节 （如图 5-5 所示），由 4 个字段组成，每个字段的长度都是 2 字节。各字段意义如下： (I) 源端口 源端口号。在需要对方回信时选用。不需要时可用全 0 。 (2) 目的端口 目的端口号。这在终点交付报文时必须使用。 (3) 长度 UDP 用户数据报的长度，其最小值是 8 （仅有首部）。 (4) 检验和 检测 UDP 用户数据报在传输中是否有错。有错就丢弃。 字节 4 4 I I 2  1 源 IP 地址 1 目的：地冲址 I 。 I 叶 u p芒叫 \\, -··--··,.-- 吓 12...i..... •······1········· 2 2  ．一一一一一一 ；＿伪男部心史，j目～的端口 L 尸度 1 ~l ．．一 ．．二心· .. •• .. •·  .•• .. •·  UDP首部 I UDP 的数据部分 fP首部 图 5-5 UDP 用户数据报的首部和伪首部 • 217 •"}
{"doc_id": "network", "page": 229, "text": "如果接收方 UDP 发现收到的报文中的目的端口号不正确（即不存在对应于该端口号的 应用进程），就丢弃该报文，并由网际控制报文协议 ICMP 发送“端口不可达”差错报文给 发送方。我们在上一竟 4 .4 .2 节 “ICMP 的应用举例”讨论tracerou te 时，就是让发送的 UDP 用户数据报故意使用一个非法的 UDP 端口，结果 ICMP 就返回“端口不可达”差错报文， 因而达到了测试的目的。 UDP 用户数据报首部中检验和的计算方法有些特殊。在计箕检验和时，要在 UDP 用户 数据报之前增加 12 个字节的伪首部。所谓“伪首部”是因为这种伪首部并不是 UDP 用户数 据报真正的首部。只是在计算检验和时，临时添加在 UDP 用户数据报前面，得到一个临时 的 UDP 用户数据报。检验和就是按照这个临时的 UDP 用户数据报来计算的。伪首部既不向 下传送也不向上递交，而仅仅是为了计岱检验和。图 5-5 的最上面给出了伪首部各字段的内 容。 UDP 计算检验和的方法和计算 IP 数据报首部检验和的方法相似。但不同的是： IP 数据 报的检验和只检验 IP 数据报的首部，但 UDP 的检验和是把首部和数据部分一起都检验。在 发送方，首先是先把全零放入检验和字段。再把伪首部以及 UDP 用户数据报看成是由许多 16 位的字串接起来的。若 UDP 用户数据报的数据部分不是偶数个字节，则要填入一个全零 字节（但此字节不发送）。然后按二进制反码计算出这些 16 位字的和。将此和的二进制反码 写入检验和字段后，就发送这样的 UDP 用户数据报。在接收方，把收到的 UDP 用户数据报 连同伪首部（以及可能的填充全零字节）一起，按二进制反码求这些 16 位字的和。当无差 错时其结果应为全 1 。否则就表明布差错出现，接收方就应丢弃这个 UDP 用户数据报（也 可以上交给应用层，但附 1：：出现了差错的警告）。图 5-6 给出了一个计算 UDP 检验和的例子。 这里假定用户数据报的长度是 15 宁节，因此要添加一个全 0 的字节。读者可以自己检验一 下在接收端是怎样对检验和进行检验的。不难看出，这种简单的差错检验方法的检错能力并 不强，但它的好处是简单，处理起米较快。 12 字节伪首部 l 8 字节 UDP 首部｛ 7 字节数据｛ 153.19.8.104  171.3.14.11  全 o I 11 15  1087 13  15 全 0 数据 1 数据 数据 1 数据 数据 1 数据 数氯压。7 充填 10011001 00010011 一 153.19 00001000 01101000 一 8.104 10101011 00000011 一 17 1.3 00001110 00001011 一 14.11 00000000 000 I 000 I 一 0 和 17 00000000 0000 I I I I 一 15 00000100 00111 I 11-今 1087 00000000 0000 I IO I 一 13 00000000 00001111 一 15 00000000 00000000 一 0 （检验和） 01010100 01000101 一数据 01010011 01010100 一数据 01001001 01001110 一数据 0100011 I 00000000 一数据和 0 （埴充） 按二进制反码运算求和 10010110 11101101 一求和得出的结果 将得出的结果求反码 01101001 00010010 一检验和 图 5-6 计算 UDP 检验和的例子 如图 5-6 所示，伪首部的第 3 字段是全岑；第 4 字段是J P 首部中的协议字段的值。以 前曾讲过，对于 UDP, 此协议字段值为 17; 第 5 字段是 UDP 用户数据报的长度。因此，这 样的检验和，既检查了 UDP 用户数据报的源端口号和目的端口号以及 UDP 用户数据报的数 据部分，又检查了 IP 数据报的源 IP 地址和目的地址。 • 218 •"}
{"doc_id": "network", "page": 230, "text": "5.3 传输控制协议 TCP 概述 f I I l  由千 TCP 协议比较复朵，闪此本节先对 TCP 协议进行一般的介绍，然 后再逐步讼入讨论 TCP 的可靠传输、流性控制和拥塞控制等问题。 5.3.l TCP 蔽主耍的特点 TCP 是 TCP/I P 体系中非常复杂的一个协议。下面介绍 TCP M i:要的特点。 (I) TCP 是面向连接的运输层协议。这就是说，应用程序在使川 TCP 协议之前，必须先 建立 TCP 连接。在传送数据完毕后，必须释放已经建立的 TCP 连接。也就是说，应用进程 之间的通估好像在“打电话”：迪话前耍先拨号建立连接，通话结束后要挂机释放连接。 (2) 每 条 TCP 连接只能有两个端点(end po i n t), 4斗一条 TCP 迕接只能是点对点的（一 对一）。这个问题后面还要进．步讨论。 (3) TCP 提供可靠交付的服务。迪过 TCP 连接传送的数据，无歧错、不去失、不讥复， 井且按序到达。 (4) TCP 提供全双工通信。 TCP 允许通估双方的应用进程在任何时候都能发送数据。 TCP 连接的两端都设布发送缓存和搂收缓存，用来临时存放双向通信的数据。在发送时， 应用程忭在把数据传送给 TCP 的缓存后，就可以做自己的事，而 TCP 在合适的时候把数据 发送出去。在接收时， TCP 把收到的数据放入缓存，上层的应用进程在合适的时候读取缓 存中的数据。 (5) 面向字节流。 TCP 中的“流 ”(st ream) 指的是流入到进程或从进程流出的字节序列。 “面向字节流”的含义是：虽然应用程J子和 TCP 的交互是一次～个数据块（大小不等），但 TCP 把应用程序交下来的数据仅仅看成是一连串的无结构的字节流。 TCP 并不知逆所传送的 字节流的含义。 TCP 不保证接收方应川程片所收到的数据块和发送方应用程序所发出的数据 块具有对应大小的关系（例如，发送方应用程序交给发送方的 TCP 共 10 个数据块，但接收 方的 TCP 可能只川了 4 个数据块就把收到的字节流交付上层的应川程序）。但接收方应用程 } r-收到的字节流必须和发送方应用程序发出的字节流完全一样。当然，接收力的应川程序必 须有能力识别收到的字节流，把它还原成有意义的应用层数据。图 5-7 是上述概念的示意图。 睾 f见挫 111 解 发送Jj 售应HI 进程 回虾 TCP 报文役的首郘 日及水／j,勺』为 x 的数据字廿 .• L 让仁J,1 ,' ,j `  桵收方 回 发送 TCP 报文段 酶畸 TCP 连接 TCP 连接像．乐管迫，把字节流可靠地按片传送到日的进程 图 5-7 TCP 面向字节流的概念 • 219 •"}
{"doc_id": "network", "page": 231, "text": "为了突出示意图的要点，我们只画出了一个方向的数据流。但请注意，在实际的网络 中，一个 TCP 报文段包含上于个字节是很常见的，而图中的各部分都只画出了几个字节， 这仅仅是为了更方便地说明”而向字节流”的概念。另一点很重要的是：图 5-7 中的 TCP 连接是一条虚连接（也就是逻辑连接），而不是一条真正的物理连接。 TCP 报文段先要传送 到 IP 层，加上 TP 首部后，再传送到数据链路层：再加上数据链路层的首部和尾部后，才离 开主机发送到物理链路。 从图 5-7 可看出， TCP 和 UDP 在发送报文时所采用的方式完全不同。 TCP 并不关心应 用进程一次把多长的报文发送到 TCP 的缓存中，而是根据对方给出的窗口值和当前网络拥 塞的程度（后而还将深入讨论），来决定一个报文段应包含多少个字节 (UDP 发送的报文长 度是应用进程给出的）。如果应用进程传送到 TCP 缓存的数据块太长， TCP 就可以把它划分 为短一些的数据块再传送。如果应用进程一次只发来一个字节， TCP 也可以等待积累足够 多的字节后再构成报文段发送出去。关千 TCP 报文段的长度问题，在后面还要进行讨论。 5.3.2 TCP 的连接 TCP 把连接作为最基本的抽象。 TCP 的许多特性都与 TCP 是面向连接的这个基本特性 有关。因此我们对 TCP 连接而要有更清楚的了解。 前面已经讲过，每一条 TCP 连接有两个端点。那么， TCP 连接的端点是什么呢？不是 主机，不是主机的 IP 地址，不是应用进程，也不是运输层的协议端口。 TCP 连接的端点叫 作套接字(socket)或插口。根据 RFC 793 的定义：端口号拼接到（conca tena ted with) IP 地址即 构成了套接字。因此，套接字的表示方法是在点分十进制的 IP 地址后面写上端口号，中间 用冒号或逗号隔开。例如，若 IP 地址是 192.3 .4 .5 而端口号是 80, 那么得到的套接字就是 (192.3.4.5: 80) 。总之，我们有 套接字 socke t = (IP 地址·端 U 号） (5-l)  每一条 TCP 连接唯一地被通信两端的两个端点（即套接字对 socke t pa i r) 所确定。即： TCP 连接．＝ {socket,, socket2} = {(IP,: port1), (lP2: port2)} (5-2)  这里 IP1 和 IP2 分别是两个端点主机的 IP 地址，而po rt 1 和port 2 分别是两个端点主机中 的端口号。因此， TCP 连接就是两个套接字 socke t,和 socke t2 之间的连接。套接字 socket是 个很抽象的概念，在下一节的 6.8 节还要对套接字进行更多的介绍。 总之， TCP 连接就是由协议软件所提供的一种抽象。虽然有时为了方便，我们也可以 说，在一个应用进程和另一个应用进程之间建立了一条 TCP 连接，但一定要记住： TCP 连 接的端点是个很抽象的套接字，即 (IP 地址：端口号）。也还应记住：同一个 IP 地址可以 有多个不同的 TCP 连接，而同一个端口号也可以出现在多个不同的 TCP 连接中。 木来 socket的意思就是插座（或插口）。选用 socke t这个名词是相当准确的。其实一条 TCP 连接就像一条电缆线，其两端都各带有一个插头。把每一端的插头插入位于主机的应 用层和运输层之间的插座（socke t)后，两个主机之间的进程就可以通过这条电缆线进行可靠 通信了。但插座这个名词很容易让人想起来是个硬件，而 socke t是个软件名词，这样“套 接字”就成为 socket的标准译名了。 请注意， socke t这个名词有时容易使人把一些概念弄混淆，因为随着互联网的不断发展 • 220 •"}
{"doc_id": "network", "page": 232, "text": "以及网络技术的进步，同一个名词 socke t却可表示多种不同的意思。例如： (I) 允许应用程序访问连网协议的应用编程接口 API (Application Programm ing Interface),  即运输层和应用层之间的一种接口，称为 socket AP!, 并简称为 socket。 (2) 在 socke t AP! 中使用的一个函数名也叫作 socke t。 (3) 调用 socke t函数的端点称为 socke t,如“创建一个数据报 socket”。 (4) 调用 socket函数时，其返回值称为 socket描述符，可简称为 socke t。 (5) 在操作系统内核中连网协议的 Berkeley实现，称为 socke t实现。 上面的这些 socke t的意思都和本章所引用的 RFC 793 定义的 socke t（指端口号拼接到 IP 地址）不同。请读者加以注意。 5.4 可靠传输的工作原理 我们知道， TCP 发送的报文段是交给 IP 层传送的。但 IP 层只能提供尽最大努力服务， 也就是说， TCP 下面的网络所提供的是不可靠的传输。因此， TCP 必须采用适当的措施才 能使得两个运输层之间的通信变得可靠。 理想的传输条件有以下两个特点： (1) 传输信道不产生差错。 (2) 不管发送方以多快的速度发送数据，接收方总是来得及处理收到的数据。 在这样的理想传输条件下，不需要采取任何措施就能够实现可靠传输。 然而实际的网络都不具备以上两个理想条件。但我们可以使用一些可靠传输协议，当 出现差错时让发送方重传出现差错的数据，同时在接收方来不及处理收到的数据时，及时告 诉发送方适当降低发送数据的速率。这样一来，本来不可靠的传输信道就能够实现可靠传输 了。下面从最简单的停止等待协议气井起。 5.4.1 停止等待协议 全双工通信的双方既是发送方也是接收方。下面为了讨论问题的方便，我们仅考虑 A 发送数据而 B 接收数据并发送确认。因此 A 叫作发送方，而 B 叫作接收方。因为这里是讨 论可靠传输的原理，因此把传送的数据单元都称为分组，而并不考虑数据是在哪一个层次上 传送的气＂停止等待”就是每发送完一个分组就停止发送，等待对方的确认。在收到确认 后再发送下一个分组。 1. 无差错情况 停止等待协议可用图 5-8 来说明。图 5-8(a) 是最简单的无差错情况。 A 发送分组 M1, 发 完就暂停发送，等待 B 的确认。 B 收到了 M1 就向 A 发送确认。 A 在收到了对 M1 的确认后， ＠注在计算机网络发展初期，通信链路不太可靠，因此在链路层传送数据时都要采用可靠的通信协议。其中最简单的协 议就是这种“停止等待协议”。在运输层并不使用这种协议，这里只是为了引出可靠传勃的问题才从最简弟的概念讲起．在运输 层使用的可靠传输协议要复杂得多（见后面 5.6 节）． ＠注：运输层传送的协议数据单元叫作报文段，网络层传送的协议数据单元叫作 IP 数据报。但在一般讨论问题时，都可 把它们简称为分组。 • 221 •"}
{"doc_id": "network", "page": 233, "text": "就书发送下－个分组 M2 。同样，在收到 B 对 M2 的确认后，再发送 M3. A B A B  发送 MIK | 发送 MI 围 确认 M, .-飞··..·.:.1 丢弃的报付差文 错 ．从这 M~ j:::三 超时且伈 M1 确认 M1 I ------ |  1过这 M3 I 一、~、- I  确认 M` I I  (a) 尤乃t:i 1h i兄 （ b) 迅 II 寸， B1L 图 5-8 停止等待协议 2. 出现差错 图 5-8 (b)是分组在传输过程中出现差错的悄况。 B 接收 M1 时检测出f&错，就丢弃 M,, 贝他什么也不做（小通知 A 收到有羌销的分组）”。也可能足队在传输过程中丢失了，这 时 B 呏然什么都不知道。在这两种情况 F, B 都不会发送任何亿息。可靠传输协议是这样 设计的： A 只要超过了一段时间仍然没有收到确认，就认为刚才发送的分组丢失了，因而重 传前面发送过的分组。这就叫作超时重传。要实现超时重传，就要在每发送完一个分组时设 置一个超时计时器。如果在超时计时器到期之前收到了对方的确认，就撤销己设四的超时计 时器。其实在图 5-8(a) 中， A 为每－个已发送的分组都设置了一个超时计时器。但 A 只要在 超时计时器到期之前收到了相应的础认，就撤销该超时计时器。为简单起见，这些细节在图 5-8(a) 中都省略仁 这里应注惹以卜三点。 第一， A 在发送完一个分组后，必须暂时保留已发送的分组的副本（在发生超时直传时 使川）。只有在收到相应的确认后才能消除暂时保衍的分组副本。 第..:.,分组和确认分组都必须进行编号。。这样才能明确是哪一个发送出去的分组收到 了确认，而哪一个分组还没有收到确认。 第二，超时计时器设咒的重传时间应当比数据在分组传输的平均往返时间更长一些。 图 5-8(b) 中的一段虚线表示如果 M1 正确到达 B 同时 A 也正确收到确认的过程。可见电传时 间应设定为比平均往返时间更长一些。显然，如果重传时间设定得很长，那么通信的效率就 I 、it:在可行化输的协议中，也可以在位测出打片错时发送“否认报文”给对方 这扦做的好处怂能够让发这方及早知道 出现(Jy;fn ．不过由 1 这tr处理会使协议复杂化，现 (I 实用的可靠传伶协议都不使I tI 这种否认报文（． (:1,)注：编号j卜小JL 一个非常简J)'I．的问题。分组编｀｝使用的位数总是｛丿限的． M ．个g码会讯及使用．例如． 10 位的编g 范ltl是 0 ~1023. 、1 ,1编 U 增加到 1023 U•J.再增加．个”就又回到 0 ，然后贞复使用这哎g｛马。我们的衣 IIj屯及、水从．以及汽 乍中的小f'U<.都打类似的问题．因此．仕所发送的分组中，必须能够(-,(．分开翊吐足新友达的．噶氏是几传的． l·J f·/.l 1Yl 链路上 传送的帧．如采 lll 停止了f引协议，只牧 Ill I I勺编号即可，也就是发送完 0 月帧．收到确认后．再发送 1” 帧，收到确认后．丙发 送 0 乃帕．们是在运输）A. 这种编乃打法付时并不能保Ill:III 韦传输（见习题 5-18). • 222 •"}
{"doc_id": "network", "page": 234, "text": "会很低。但如果巫传时间设定得太短，以致产生不必要的屯传，就浪费了网络资源。然而， 在运输层重传时间的准确设定是非常复杂的，这是因为已发送出的分组到底会经过哪些网络， 以及这些网络将会产生多大的时延（这取决千这些网络当时的拥塞情况），这些都是不确定 因素。图 5-9 中把往返时间当作固定的（这显然不符合网络的实际估况），只是为了讲述原 理的方便。关子项传时间应如何选抒，在后面的 5.6.3 节还要进一步讨论。 3. 确认丢失和确认迟到 图 5-9(a) 说明的是另一种情况。 B 所发送的对 M1 的确认丢失了。 A 在设定的超时重传 时间内没有收到确认，片无法知道是门已发送的分组出错、丢失，或者是 B 发送的确认丢 失f。因此 A 在超时计时器到期后就要亟传 M1 。现在应注意 B 的动作。假定 B 又收到了 矗传的分组 M1 。这时应采取两个行动。 第一，丢弃这个重复的分组 M1, 不向上层巫复交付。 第二，向 A 发送确认。不能认为已经发送过确认就不再发送，因为 A 之所以重传 M1 就及示 A 没有收到对 M1 的确认。 A  发这 MI 超时社化 MI B B  发这 M2 确认 M, 丢弁贞复的 MI 犹传确认 Ml l  A  发送 MI 超fl寸呕传 MI 发送 M2 收下迟到的确认 但什么也不做 确认 MI 丢弃重复的 MI 觅传确认 Ml l  (a) 确认丢失 (b) 确认迟到 图 5-9 确认丢失和确认迟到 图 5-9(b) 也是一种可能出现的悄况。传输过程中没有出现差错，但 B 对分组 M1 的确认 迟到了。 A 会收到重复的确认。对市复的确认的处理很简 ll1-: 收下后就丢弃，但什么也不做。 B 仍然会收到•T＄复的 M1, 井且同样要丢弃重复的 M1, 井重传确认分组。 通常 A 蚊终总是可以收到对所行发出的分组的确认。如果 A 不断亟传分组但总是收小 到确认，就说明通信线路太差，不能进行通信。 使用上述的确认和币．传机制，我们就可以在不可靠的传愉网络上实现可靠的通信。 像上述的这种可靠传输协议常称为自动重传请求 ARQ (Au tomatic Repeat re Qucs t)。意思 姑戍传的请求姑自动进行的，因此也可见到自动请求重传这样的译名。接收力不盂要诮求发 送方电传某个出错的分组。 4. 信道利用率 停止等待协议的优点是简单，但缺点是信追利用率太低。我们可以用图 5-10 来说明这 个问题。为简汁屯起见，假定在 A 和 B 之间有一条门通的信道来传送分组。 • 223 •"}
{"doc_id": "network", "page": 235, "text": "图 5-10 停止等待协议的信道利用率太低 假定 A 发送分组需要的时间是 TD 。显然， TD 等千分组长度除以数据率。再假定分组正 确到达 B 后， B 处理分组的时间可以忽略不计，同时立即发回确认。假定 B 发送确认分组 需要时间 TA 。如果 A 处理确认分组的时间也可以忽略不计，那么 A 在经过时间（ To+ RTT +  几）后就可以再发送下一个分组，这里的 RTT 是往返时间。因为仅仅是在时间兀内才用来 传送有用的数据（包括分组的首部），因此信道的利用率 U 可用下式计环： u ：：兀 T。 +RTT+TA (5-3)  清注意，更细致的计算还可以在上式分子的时间几内扣除传送控制信息（如首部）所 花费的时间。但在进行粗略计钵时，用近似的式(5-3) 就可以了． 我们知道，式(5-3) 中的往返时间 RTI 取决千所使用的信迫。例如，假定 1200 km 的信 道的往返时间 RTI = 20 ms, 分组长度是 1200 bit,发送速率是 I Mbit/s 。若忽略处理时间和 TA (TA 一般都远小千 TD ），则可算出信逆的利用率 U = 5.66% 。但若把发送速率提岛到 10 Mb it/s, 则 U= 5.96 X 10-3 。信道在绝大多数时间内都是空闲的。 从图 5-10 还可看出，当往返时间 RIT 远大十分组发送时间几时，信道的利用率就会 非常低。还应注意的是，伤 5-10 并没有考虑出现尤错后的分组亟传。若出现重传，则对传 送有用的数据信息来说，信迨的利用率就还要降低。 为了提高传输效率，发送方可以不使用低效；年的停止等待协议，而是采用流水线传输 （如图 5-11 所示）。流水线传输就是发送方可连续发送多个分组，不必每发完一个分组就停 顿下来等待对方的确认。这样可使信道上一直有数踞在不间断地传送。显然，这种传输方式 可以获得很高的信道利用率。 AE/ / 蔡麟氨t 图 5-11 流水线传输可提窝信道利用平 当使用流水线传输时，就要使用下面介绍的连续 ARQ协议和滑动窗口协议。 5.4.2 连续 ARQ协议 滑动窗口协议比较复杂，是 TCP 协议的精髓所在。这里先给出连续 ARQ协议奻基本的 概念，但不涉及许多细节问题。详细的滑动窗口协议将在后面的 5.6 节中讨论。 图 5- l 2(a) 表示发送方维待的发送窃口，它的意义是：位于发送窗口内的 5 个分组都可 • 224 •"}
{"doc_id": "network", "page": 236, "text": "连续发送出去，而不需要等待对方的确认。这样，信道利用率就提高了。 在讨论滑动窗口时，我们应当注意到，图中还有一个时间坐标（但以后往往省略这样 的时间坐标）。按照习惯，“向前”是指“向着时间增大的方向“，而“向后”则是“向着时 间减少的方向“。分组发送是按照分组序号从小到大发送的。 分组的序号 发送窗口 I二三勹|尸 |8|9|10|llI12| (a) 发送窗口是 5 发送窗口 ．一会向前 1 中 III 厂口 1 叶 IO|llIl2| (b) 收到一个确认后发送窗口向前滑动 图 5-12 连续 ARQ协议的工作原理 连续 ARQ协议规定，发送方每收到一个确认，就把发送窗口向前滑动一个分组的位置。 图 5-12(b) 表示发送方收到了对第 1 个分组的确认，千是把发送窗口向前移动一个分组的位 置。如果原来已经发送了前 5 个分组，那么现在就可以发送窗口内的第 6 个分组了。 接收方一般都是采用累积确认的方式。这就是说，接收方不必对收到的分组逐个发送 确认，而是在收到几个分组后，对按序到达的最后一个分组发送确认，这就表示；到这个分 组为止的所有分组都已正确收到了。 累积确认有优点也有缺点。优点是容易实现，即使确认丢失也不必重传；但缺点是不 能向发送方及时反映接收方已经正确收到所有分组的信息。 例如，如果发送方发送了前 5 个分组，而中间的第 3 个分组丢失了。这时接收方只能 对前两个分组发出确认。发送方无法知道后面三个分组的下落，而只好把后面的三个分组都 再重传一次。这就叫作 Go-back-N （回退 N), 表示盂要再退回来重传已发送过的 N 个分组。 可见当通信线路质伍不好时，连续 ARQ协议会带来负面的影响。 在深入讨论 TCP 的可靠传输问题之前，必须先了解 TCP 的报文段首部的格式。 5.5 TCP 报文段的首部格式 TCP 虽然是面向字节流的，但 TCP 传送的数据单元却是报文段。一个 TCP 报文段分为首部和数据两部分，而 TCP 的全部功能都体现在它首部中 各字段的作用。囚此，只有弄清 TCP 首部各字段的作用才能掌握 TCP 的工 作原理。下面讨论 TCP 报文段的首部格式。 TCP 报文段首部的前 20 个字节是固定的（如图 5-13 所示），后面有 411 字节是根据需要 而增加的选项 Cn 是整数）。因此 TCP 首部的最小长度是 20 字节。 首部固定部分各字段的意义如下： (1) 源端口和目的端口 各占 2 个字节，分别写入源端口号和目的端口号。和前面图 5-5 所示的 UDP 的分用相似， TCP 的分用功能也是通过端口实现的。 (2) 序号 占 4 字节。序号范围是 (0, 232 - I], 共 232 （即 4 294 967296) 个序号。序 号增加到 232 - l 后，下一个序号就又回到 0 。也就是说，序号使用 mod 232 运算。 TCP 是面 如愍乏 • 225 •"}
{"doc_id": "network", "page": 237, "text": "向字节流的。在一个 TCP 连按中传送的字节流中的每一个字节都按顺序编号。整个要传送 的字节流的起始序号必须在连接建立时设置。首部中的序号字段们则指的是本报文段所发送 的数据的第一个字节的序号。例如，一报文段的序号字段们是 301 ，面携带的数据共有 100 字节。这就表明：本报文段的数据的第一个字节的}f号是 30 1,最后一个字节的序号是 400 。 显然，下一个报文段（如果还有的话）的数据序号应当从 401 开始，即下一个报文段的序号 字段值应为 401 。这个字段的名称也叫作“报文段序号“。 位 0......'18'.'...'116L·'.'..'I'..'..'  T  『 源端口 日的端门 丿i＇ 一号 确认号 数据 l 保留 I 书 I ~I f,I ii飞 I t ，i计 11 偏移 检验和 紧总指针 选项 （长度可变） | 埴允 -- 4 2_ 31  I  的部廿首 ·字定． 20 固 、、、、、、、 ，俨-.. -•·.... - -· -.. -...  发送在前 TCP 首部 TCP 报文段的数拟部分 lP 首部 [p数据报的数据部分 图 5-13 TCP 报文段的首部格式 (3) 确认号 占 4 字节，是期望收到对方下一个报文段的第一个数据字节的序号。例 如， B 正确收到了 A 发送过来的一个报文段，其序号字段俏是 501, 而数据长度是 200 字节 （序号 501~700), 这表明 B 正确收到了 A 发送的到序号 700 为止的数据。因此， B 期望 收到 A 的下一个数据序号是 701 ，千是 B 在发送给 A 的确认报文段中把确认号翌为 701 。 请注意，现在的确认号不是 501 ，也不是 700, 而是 701 。 总之，应当记住： 若确认号＝ N, 则表明：到序号 N-l 为止的所有数据都已正确收到。 巾千序号字段有 32 位长，可对 4 GB （即 4 于兆字节）的数据进行编号。在一般情况下 可保证当序号益复使用时，旧忭号的数据早已通过网络到达终舟，了。 (4) 数据偏移 占 4 位，它指出 TCP 报文段的数据起始处距离 TCP 报文段的起始处 有多远。这个字段实际上是指出 TCP 报文段的首部长度。由千首部中还有长度不确定的选 项字段，因此数据偏移字段是必婓的。但应注意，“数据偏移＂的单位是 32 位字（叩以 4 字 节长的宁为计算单位）。由于 4 位二进制数能够表示的最大 I 进制数字是 l5 ，因此数据偏移 的砓大值是 60 字节，这也是 TCP 首部的最大长度（即选项长度不能超过 40 字节）。 (5) 保留 占 6 位，保留为今后使用，但目前应省为 0 。 下面打 6 个控制位，用来说明木报文段的性质它们的，意义见下面的 (6)~(11) 。 (6) 紧急 URG (URGent) 当 URG = I 时，表明紧急指针字段有效。它告诉系统此报 • 226 •"}
{"doc_id": "network", "page": 238, "text": "文段中有紧急数据，应尽快传送（相当干高优先级的数据），而不要按原来的排队顺序传送。 例如，已经发送了很长的一个程序要在远地的主机上运行。但后来发现了一些问题，需要取 消该程序的运行。因此用户从键盘发出中断命令（ Control-C) 。如果不使用紧急数据，那么 这两个字符将存储在接收 TCP 的缓存末尾。只有在所有的数据被处理完毕后这两个字符才 被交付接收方的应用进程。这样做就浪费了许多时间。 当 URG 置 1 时，发送应用进桯就告诉发送方的 TCP 有紧急数据婓传送。千是发送方 TCP 就把紧急数据插入到本报文段数据的最前面，而在紧急数据后面的数据仍是普通数据。 这时要与首部中紧急指针(Urgen t Pointer) 字段配合使用。 然而在紧急指针字段的具体实现上，由千过去的有些文档有错误或有不太明确的地方， 这就导致人们对有关的 RFC 文档产生了不同的理解。于是， 2011 年公布的建议标准 RFC 6093, 对紧急指针字段的使用方法做出了更加明确的解释，并更新了几个重要的 RFC 文档， 如 RFC 793, RFC IOI 1, RFC 1122 等。 (7) 确认 ACK (ACK.nowledgment) 仅当 ACK= l 时确认号字段才有效。当 ACK= 0  时，确认号无效。 TCP 规定，在连接建立后所有传送的报文段都必须把 ACK 置为 1 。 (8) 推送 PSH (PuSH) 当两个应用进程进行交互式的通亿时，有时在一端的应用进程 希望在键入一个命令后守即就能够收到对方的响应。在这种情况下， TCP 就可以使用推送 (push) 操作。这时，发送方 TCP 把 PSH 置 1, 并立即创建一个报文段发送出去。接收方 TCP 收到 PSH = I 的报文段，就尽快地（即“推送“向前）交付接收应用进程，而不再等到 整个缓存都填满了后再向上交付。 虽然应用程序可以选择推送操作，但推送橾作很少使用。 (9) 复位 RST (ReSeT) 当 RST = I 时，表明 TCP 连接中出现严重差错（如主机崩溃 或其他原因），必须释放连接，然后再重新建立运输连接。将 RST 置为 1 还用来拒绝一个非 法的报文段或拒绝打开一个连接。 RST 也可称为里建位或重置位。 (10) 同步 SYN (SYNchron ization) 在连接建立时用来同步序号。当 SYN= l 而 ACK = 0 时，表明这是一个连接诸求报文段。对方若同意建立连接，则应在响应的报文段中使 SYN= 1 和 ACK= 1 。因此， SYN 置为 l 就表示这是一个连接诮求或连接接受报文。关于连 接的建立和释放，在后面的 5.9 节还要进行详细讨论。 (11) 终止 FIN (F!Ni sh, 意思是“完了”“终止”) 用来释放一个连接。当 FIN= 1 时， 表明此报文段的发送方的数据已发送宪毕，并要求释放运输连接。 (12) 窗口 占 2 字节。窗口值是[0, 216- l] 之间的整数。窗口指的是发送本报文段的 一方的接收窗口（而不是自己的发送窗口）。窗口值告诉对方：从本报文段首部中的确认号 算起，接收方目前允许对方发送的数据量（以字节为单位）。之所以要有这个限制，是因为 接收方的数据缓存空间是有限的。总之，窗口值作为接收方让发送方设置其发送窗口的 依据。 打，打 例如，发送了一个报文段，其确认号是 70l ，窗口字段是 1000 。这就 是告诉对方：“从 701 号算起，我（即发送此报文段的一方）的接收缓存空 间还可接收 1000 个字节数据（字节序号是 70l ~1700), 你在给我发送数据 时，必须考虑到我的接收缓存容散。” 伐频讲解 总之，应当记住： 窗口字段明确指出了现在允许对方发送的数据量。窗口值经常在动态变化着。 • 227 •"}
{"doc_id": "network", "page": 239, "text": "(1 3) 检验和 占 2 字节。检验和字段检验的范围包括首部和数据这两部分。和 UDP 用户数据报一样，在计算检验和时，要在 TCP 报文段的前面加上 12 字节的伪首部。伪首部 的格式与图 5-5 中 UDP 用户数据报的伪首部一样。但应把伪首部第 4 个字段中的 17 改为 6 (TCP 的协议号是 6), 把第 5 字段中的 UDP 长度改为 TCP 长度。接收方收到此报文段后， 仍要加上这个伪首部来计算检验和。若使用 IPv6, 则相应的伪首部也要改变。 (14) 紧急指针 占 2 字节。紧急指针仅在 URG = I 时才有意义，它指出本报文段中 的紧急数据的字节数（紧急数据结束后就是普通数据）。因此，紧急指针指出了紧急数据的 末尾在报文段中的位置。当所有紧急数据都处理完时， TCP 就告诉应用程序恢复到正常操 作。值得注意的是，即使窗口为零时也可发送紧急数据。 (15) 选项 长度可变，砓长可达 40 字节。当没有使用”选项”时， TCP 的首部长度 是 20 字节。最后的填充字段仅仅是为了使整个 TCP 首部长度是 4 字节的整数倍。 TCP 最初只规定了一种选项，即最大报文段长度 MSS (Maximum Segment Size) [RFC  6691] 。请注意 MSS 这个名词的含义。 MSS 是每一个 TCP 报文段中的数据字段的最大长度。 数据字段加上 TCP 首部才等于整个的 TCP 报文段。所以 MSS 并不是整个 TCP 报文段的蔽 大长度，而是 “TCP 报文段长度减去 TCP 首部长度”。 为什么要规定一个最大报文段长度 MSS 呢？这并不是考虑接收方的接收缓存可能放不 下 TCP 报文段中的数据。实际上， MSS 与接收窗口值没有关系。我们知道， TCP 报文段的 数据部分，至少要加上 40 字节的首部（ TCP 首部 20 字节和 IP 首部 20 字节，这里都还没有 考虑首部中的选项部分），才能组装成一个 rP 数据报。若选择较小的 MSS 长度，网络的利 用率就降低了。设想在极端的悄况下，当 TCP 报文段只含有 1 字节的数据时，在 IP 层传输 的数据报的开销至少有 40 字节（包括 TCP 报文段的首部和 lP 数据报的首部）。这样，对网 络的利用率就不会超过 1/41 。到了数据链路层还要加上一些开销。但反过来，若 TCP 报文 段非常长，那么在[P层传输时就有可能要分解成多个短数据报片°在终点要把收到的各个短 数据报片装配成原来的 TCP 报文段。当传输出错时还要进行重传。这些也都会使开销增大。 因此，从提高网络传输效率考虑， MSS 应尽可能大些，只要在 lP 层传输时不需要再分 片就行。由于 IP 数据报所经历的路径是动态变化的，因此在某条路径上确定的不需要分片 的 MSS, 如果改走另一条路径就可能需要进行分片。因此最佳的 MSS 实际上是很难确定的。 在连接建立的过程中，双方都把自己能够支待的 MSS 写入这一字段，以后就按照这个数值 传送数据，两个传送方向可以有不同的 MSS 值！｀。若主机未填写这一项，则 MSS 的默认值 是 536 字节（这个数值来自 576 字节的 IP 数据报总长度减去 TCP 和 lP 的固定首部）。因此， 所有互联网上的主机都应能接受的报文段长度是 536 + 20 （固定首部长度） ＝ 556 字节。 随着互联网的发展，又陆续增加了几个选项，如窗口扩大选项、时间戳选项等（见建 议标准 RFC 7323) 。以后又增加了有关选择确认(SACK)选项（见建议标准 RFC 2018) 。这 些选项的位盟都在图 5-13 所示的选项字段中。 窗口扩大选项是为了扩大窗口。我们知道， TCP 首部中窗口字段长度是 16 位，因此最 大的窗口大小为 64 KB （见下一节）。虽然这对早期的网络是足够用的，但对于包含卫星信 ＠注；流行的一种说法．在 TCP 迕接建立阶段“双方协商 MSS 伯＇．，但这是铅误的，因为这电并不存在任何的协商，而 只是一方把 MSS 侦设定好以后内通知另一方而已。 • 228 •"}
{"doc_id": "network", "page": 240, "text": "道的网络©，其传播时延和带宽都很大，要获得高吞吐率需要更大的窗口大小。 窗口扩大选项占 3 字节，其中有一个字节表示移位值 S 。新的窗口值等于 TCP 首部中 的窗口位数从 16 增大到(16 + S) 。移位值允许使用的最大值是 14, 相当于窗口最大值增大 到i( l6 + 14) - l = 230 - I 。 窗口扩大选项可以在双方初始建立 TCP 连接时进行协商。如果连接的某一端实现了窗 口扩大，当它不再需要扩大其窗口时，可发送 S=O 的选项，使窗口大小回到 l6. 时间戳选项占 10 字节，其中最主要的字段是时间戳值字段 (4 字节）和时间戳回送回 答字段 (4 字节）。时间戳选项有以下两个功能： 第一，用来计算往返时间 RTT （见后面的 5.6.2 节）。发送方在发送报文段时把当前时 钟的时间值放入时间戳字段，接收方在确认该报文段时把时间戳字段值复制到时间戳回送回 答字段。因此，发送方在收到确认报文后，可以准确地计算出 RTT. 第二，用于处理 TCP 序号超过 232 的情况，这又称为防止序号绕回 PAWS (Protect  Against Wrapped Sequence numbers) 。我们知道， TCP 报文段的序号只有 32 位，而每增加 沪个序号就会重复使用原来用过的序号。当使用高速网络时，在一次 TCP 连接的数据传送 中序号很可能会被重复使用。例如，当使用 1.5 Mb it/s 的速率发送报文段时，序号重复要 6 小时以上。但若用 2.5 Gb it/s 的速率发送报文段，则不到 14 秒序号就会瘟复。为了使接收方 能够把新的报文段和迟到很久的报文段区分开，可以在报文段中加上这种时间戳。 我们将在后面的 5.6.3 节介绍选择确认选项。 5.6 TCP 可靠传输的实现 本节讨论 TCP 可靠传输的实现。 我们首先介绍以字节为单位的滑动窗口。为了讲述可靠传输原理的方便，我们假定数 据传输只在一个方向进行，即 A 发送数据， B 给出确认。这样的好处是使讨论限千两个窗 口，即发送方 A 的发送窗口和接收方 B 的接收窗口。如果再考虑 B 也向 A 发送数据，那么 还要增加 A 的接收窗口和 B 的发送窗口，这样总共有 4 个都不断在变化大小的窗口。这对 讲述可靠传输的原理并没有多少帮助，反而会使问题变得更加烦琐。 5.6.1 以字节为单位的滑动窗口 TCP 的滑动窗口是以字节为单位的。为了便于说明滑动窗口的丁作原 理，我们故意把后面图 5-14 至图 5-17 中的字节编号都取得很小（实协的窗 口大小多为数千字节）。现假定 A 收到了 B 发来的确认报文段，其中窗口是 视拓讲解 20 字节，而确认号是 31 （这表明 B 期望收到的下一个字节序号是 31 （请注意，这里不是分 组的序号），而到序号 30 为止的数据已经收到了）。根据这两个数据， A 就构造出自己的发 送窗口，如图 5-14 所示。 ＠注这种信道常称为长粗管道(long fat pipe}.  • 229 •"}
{"doc_id": "network", "page": 241, "text": "畛 不允许收缩叩 『 二－ A 的及送窗口＝ 20 ——立一前移 望勹：酶酶气勹：尸尸酶酶一气气千 收到的序号 时间 图 5-14 根据 B 给出的货口侦． A 构造出自己的发送窗门 我们先讨论发送方 A 的发送窗口。发送窗口表示：在没有收到 B 的确认的悄况下， A 可以连续把窗口内的数据都发送出去。凡是已经发送过的数据，在未收到确认之前都必须暂 时保留，以便在超时重传时使用。 发送窗口里面的序号表示允许发送的序号。显然，窗口越大，发送方就可以在收到对 方确认之前连续发送更多的数据，因而可能获得更高的传输效率。在上而的 5.5 节我们已经 讲过，接收方会把自己的接收窗门数值放在窗口字段中发送给对方。因此， A 的发送窗口一 定不能超过 B 的接收窗口数伯。在后面的 5.8 节我们将要讨论，发送方的发送窗口大小还要 受到当时网络拥塞程度的制约。但在目前，我们暂不考虑网络拥塞的影响。 发送窗口后沿的后面部分表示已发送且已收到了确认。这些数据显然不需要再保留了。 面发送窗口前沿的前面部分表示不允许发送，因为桵收方没有为这部分数据保留临时存放的 缓存空间。 发送窗口的位篮由窗口前沿和后沿的位置共同确定。发送窗口后沿的变化情况有两种 可能，即不动（没有收到新的确认）和前移（收到了新的确认）。发送窗口后沿不可能向后 移动，因为不能撤销掉已收到的确认。发送窗口前沿通常是不断向前移动的，但也有可能不 动。这对应两种情况：一是没有收到新的确认，对方通知的窗口大小也不变；二是收到了新 的确认但对方通知的窗口缩小了，使得发送窗口前沿正好不动。 发送窗口前沿也有可能向后收缩。这发生在对方通知的窗口缩小了。但 TCP 的标准强 烈不赞成这样做。因为很可能发送方在收到这个通知以前已经发送了窗口中的许多数据，现 在又要收缩窗口，不让发送这些数据，这样就会产生一些错误。 现在假定 A 发送了序号为 31~41 的数据。这时，发送窗口位置并未改变（如图 5-15 所示），但发送窗口内靠后面有 11 个字节（灰色方框表示）表示已发送但未收到确认。而发 送窗口内靠前面的 9 个字节（序号 42~50) 是允许发送但尚未发送的。 A 的发送窗口位坟不变 可用衙 11 酶回回回 1 酶酶酶酶酶酶酶酶酶酶酶酶回 器盓 『 已发送但末收到确认 t石矗矗三二t才允许发送 B 的接收窗口＝ 20 譬且气荨回回气声酶酶酶重荨巴严 井交付主机未按）午收到 允许接收 时间 图 5-15 A 发送了 II 个字节的数据 • 230 •"}
{"doc_id": "network", "page": 242, "text": "从以上所述可以看出，要描述一个发送窗口的状态盆要三个指针： P1, P2 和 P3 （如图 5-15 所示）。指针都指向字节的序号。 A 的发送窗口中三个指针指向的几个部分的意义如下： 凡之前的数据（序号<31) 是已发送并已收到确认的部分。 氏之后的数据（序号＞ 50) 是不允许发送的部分。 P3-P1 =A 的发送窗口＝ 20 （序号 31~50) 。 P2 - P1 =已发送但尚未收到确认的字节数（序号 31~4l) 。 P3 - P2 =允许发送但当前尚未发送的字节数（序号 42~50) （又称为可用窗口或有效窗 口）。 再看一下 B 的接收窗口。设 B 的接收窗口大小是 20 。在接收窗口外而，到序号为 30 的数据是已经发送过确认，并且已经交付主机了。因此在 B 可以不再保留这些数据。接收 窗口内的数据（序号 31~50) 是允许接收的。在图 5-15 中， B 收到了序号为 32 和 33 的数 据，但序号为 31 的数据没有收到（也许丢失了，也许滞留在网络中的某处）。诸注意， B 只 能对按序收到的数据中的最高序号给出确认，因此 B 发送的确认报文段中的确认号仍然是 3l （即期望收到的序号）。 现在假定 B 收到了序号为 31 的数据，把序号为 31~33 的数据交付主机，删除这些数 据。接符把接收窗口向前移动 3 个序号（如图 5-16 所示），同时给 A 发送确认，其中窗口 俏仍为 20, 但确认号是 34 。这表明 B 已经收到了到序号 33 为止的数据。我们注意到， B 还收到了序号为 37, 38 和 40 的数据，但这些数据都没有按序到达，只能先暂存在接收窗口 中。 A 收到 B 的确认后，就可以把发送窗口向前滑动 3 个序号，但指针贮不动。可以看出， 现在 A 的可用窗口增大了些，可发送的序号范围是 42~53 。 A 的发送窗口 向前滑动一 可用窗口增大 酶酶声酶酶醇醇酶酶酶酶酶酶酰酶 已发送井收到确认 几矗徊未收到确认 t 允许发送但尚未发送—丿卢 已发送确认并交付主机 B 的接收窗口向前滑动 •  回回日回回回回回回回回国召回回 允许俀收 不允许 接收 时间 图 5-16 A 收到新的确认号，发送窗口向前滑动 A 在继续发送完序号 42~53 的数据后，指针凡向前移动和 P3 重合。发送窗口内的序 号都已用完，但还没有再收到确认（如图 5-17 所示）。由千 A 的发送窗口已满，可用窗口 已减小到零，因此必须停止发送。请注意，存在下面这种可能性，就是发送窗口内所有的数 据都已正确到达 B, B 也早已发出了确认。但不幸的是，所有这些确认都滞留在网络中。在 没有收到 B 的确认时，为了保证可靠传输， A 只能认为 B 还没有收到这些数据。千是， A 在经过一段时间后（由超时计时器控制）就重传这部分数据，重新设置超时计时器，直到收 到 B 的确认为止。如果 A 按序收到落在发送窗口内的确认号，那么 A 就可以使发送窗口继 续向前滑动，并发送新的数据。 • 231 •"}
{"doc_id": "network", "page": 243, "text": "A 的发送窗口已满，可用窗口为零 酶酶酶叩酶酶延把貊啤醇叩尸 已发送并收到确认 1 已发送但未收到确认 ！：古 图 5-17 A 的发送窗口内的序号都属千已发送但未被确认 我们在前面的图 5-7 中曾给出了这样的概念：发送方的应用进程把字节流写入 TCP 的 发送缓存，接收方的应用进程从 TCP 的接收缓存中读取字节流。下面我们就进一步讨论前 面讲的窗口和缓存的关系。图 5-18 画出了发送方维持的发送缓存和发送窗口，以及接收方 维持的接收缓存和接收窗口。这里首先要明确两点： 芦 最后丐入 荨 TCP 、-的字节 厂＄产缓存 ·······•••••••••••••••••••••  TCP  I 已发送 t·．．二．二．．．．．t····: 砐后被确认 最后发送 序号增大 的字廿 的字节一时间 下一个期望收到的字节 －－－攀时间 (a) 发送缓存和发送窗门 (b) 接收缓存和接收窗口 图 5-18 TCP 的缓存和窗口的关系 第一，缓存空间和序号空间都是有限的，并且都是循环使用的。最好是把它们画成圆 环状的。但这里为了画图的方便，我们还是把它们画成了长条状的。 第二，由于缓存或窗口中实际的字节数可能很大，因此图 5-18 仅仅是个示意图，没有 标出具体的数值。但用这样的图来说明缓存和发送窗口以及接收窗口的关系是很清楚的。 我们先看一下图 5- I 8(a) 所示的发送方的情况。 发送缓存用来暂时存放： (1)发送应用程序传送给发送方 TCP 准备发送的数据； (2) TCP 已发送出但尚未收到确认的数据。 发送窗口通常只是发送缓存的一部分。已被确认的数据应当从发送缓存中删除，因此 发送缓存和发送窗口的后沿是第合的。发送应用程序最后写入发送缓存的字节减去最后被确 认的字节，就是还保留在发送缓存中的被写入的字节数。发送应用程序必须控制写入缓存的 速率，不能太快，否则发送缓存就会没有存放数据的空间。 再看一下图 5-18(b) 所示的接收方的情况。 接收缓存用来暂时存放： (1)按序到达的、但尚未被接收应用程序读取的数据； (2) 未按序到达的数据。 如果收到的分组被检测出有差错，则要丢弃。如果接收应用程序来不及读取收到的数 据，接收缓存最终就会被填满，使接收窗口减小到零。反之，如果接收应用程序能够及时 从接收缓存中读取收到的数据，接收窗口就可以增大，但最大不能超过接收缓存的大小。 • 232 •"}
{"doc_id": "network", "page": 244, "text": "图 5-18(b) 中还指出了下一个期望收到的字节号。这个字节号也就是接收方给发送方的报文 段的首部中的确认号。 根据以上所讨论的，我们还要再强调以下三点。 第—，虽然 A 的发送窗口是根据 B 的接收窗口设置的，但在同一时刻， A 的发送窗口 并不总是和 B 的接收窗口一样大。这是因为通过网络传送窗口值需要经历一定的时间滞后 （这个时间是不确定的）。另外，正如后面 5.7 节将要讲到的，发送方 A 还可能根据网络当 时的拥塞情况适当减小自己的发送窗口数值。 第二，对于不按序到达的数据应如何处理， TCP 标准并无明确规定。如果接收方把不 按序到达的数据一律丢弃，那么接收窗口的管理将会比较简单，但这样做对网络资源的利用 不利（因为发送方会重复传送较多的数据）。因此 TCP 通常是把不按序到达的数据先临时存 放在接收窗口中，等到字节流中所缺少的字节收到后，再按序交付上层的应用进程。 第三， TCP 要求接收方必须有累积确认的功能，这样可以减小传输开销。接收方可以 在合适的时候发送确认，也可以在自己有数据要发送时把确认信息顺便捎带上。但请注意两 点。一是接收方不应过分推迟发送确认，否则会导致发送方不必要的重传，这反而浪费了网 络的资源。 TCP 标准规定，确认推迟的时间不应超过 0.5 秒。若收到一连串具有最大长度的 报文段，则必须每隔一个报文段就发送一个确认 [RFC 1122, STD3] 。二是捎带确认实际上 并不经常发生，因为大多数应用程序很少同时在两个方向上发送数据。 最后再强调一下， TCP 的通信是全双工通信。通信中的每一方都在发送和接收报文段。 因此，每一方都有自己的发送窗口和接收窗口。在谈到这些窗口时，一定要弄清是哪一方的 窗口。 5.6.2 超时重传时间的选择 上面已经讲到， TCP 的发送方在规定的时间内没有收到确认就要重传已发送的报文段。 这种重传的概念是很简单的，但重传时间的选择却是 TCP 砐复杂的问题之一。 由于 TCP 的下层是互联网环境，发送的报文段可能只经过—个高速率的局域网，也可 能经过多个低速率的网络，并且每个 IP 数据报所选择的路由还可能不同。如果把超时重传 时间设置得太短，就会引起很多报文段的不必要的重传，使网络负荷增大。但若把超时重传 时间设置得过长，则又使网络的空闲时间增大，降低了传输效率。 那么，运输层的超时计时器的超时亟传时间究竞应设置为多大呢？ TCP 采用了一种自适应算法，它记录一个报文段发出的时间，以及收到相应的确认的 时间。这两个时间之差就是报文段的往返时间 RTT 。 TCP 保留了 RTT 的一个加权平均往返 时间 RTTs （这又称为平滑的往返时间， S 表示 Smoot hed 。因为进行的是加权乎均，因此得 出的结果更加平滑）。每当第一次测堂到 RTT 样本时， RT飞值就取为所测址到的 RTT 样本 值。但以后每测量到一个新的 RTT 样本，就按下式重新计算一次 RTT沪 新的 RTTs = (I - a) x （旧的 RTTs) + a x （新的 RTT 样本） (5-4)  在上式中， O ~a< 1 。若 a 很接近于零，表示新的 RT飞值和旧的 RT飞值相比变化 不大，而对新的 RTT 样本影响不大 (RTT 值更新较慢）。若选择 a 接近于I,则表示新的 RTTs 值受新的 RTT 样本的影响较大 (RTT 值更新较快）。已成为建议标准的 RFC 6298 推荐 的 a 值为 1/8, 即 0.125 。用这种方法得出的加权乎均往返时间 RTTs 就比测摄出的 RTT 值 • 233 •"}
{"doc_id": "network", "page": 245, "text": "更加 1l 滑。 显然，超时计时器设咒的超时重传时间 RTO (Rc t ransm i ss i onTi me-Ou t)应略大于上面得 出的加权平均往返时间 RTTs 。 RFC 6298 建议使用卜，式计算 RTO: RTO = RTT s + 4 x RTT。 (5-5)  r(1j RTTo 是 RTT 的偏差的加权、F 均值，它与 RTTs 和新的 RTT 样本之差有关。 RFC 6298 建议这样计优 RTTo• 寸 1 第一次测战时， RTTo 伯取为视1l1ik 到的 RTT 杆本俏的一半。在 以后的测坟中，则使用下式计算加权平均的 RTT心 新的 RTT0= (I -P) x （旧的 RTT0) + P x l RTT s -新的 RTT 样本 1 (5-6)  这里p是个小「· 1 的系数，它的推荐侦是 1/4, 即 0.25 。 上面所说的往返时间的视1J {,L 实现起米相当复杂。试看下面的例子。 如图 5-19 所示，发送出一个报义段，设定的，代传时间到（，还没有收到确认，于是重 传报义段。经过f一段时间）百，收到了确认报文段。现在的问题是：如何判定此确认报文段 是对先发送的报文段的确认，还是对后来重传的报文段的确认？由千重传的报文段和原来的 报文段元个一样，因此源主机在收到确认后，就无法做出正确的判断，而正确的判断对确定 加权平均 RTTs 的值关系很大。 若收到的确认是对重传报文段的确认，但却被源主机当成是对原来的报文段的确认， 则这样计算出的 RT飞和超时重传时间 RTO 就会偏大。若后面再发送的报文段又是经过重 传后才收到确认报文段，则按此方法得出的超时，r（传时间 RTO 就越来越长。 发达报文段 业传报义段 、收到确认 l 一超II田—| l 时间 ［~｀二m往返叶 I,IJIRIT__ 1  图 5-19 收到的确认是对哪．个报文段的确认？ 同样，若收到的确认是对原来的报文段的确认，但被当成是对笫传报文段的确认，则 由此计算出的 RTTs 和 RTO 都会偏小。这就必然导致报文段过多地重传。这样就有可能使 RTO 越来越短。 根据以上所述， Kam 提出了一个饮法：在计算加权平均 R们飞时，只要报文段重传了， 就不采用其往返时间样本。这样得出的加权平均 RT飞和 RTO 就较准确。 但是，这又引起新的问题。设想出现这样的情况：报文段的时延突然增大了很多。因 此在原来得出的币传时间内不会收到确认报文段，千是就重传报文段。但根据 Kam 算法， 不考虑f传的报文段的往返时间样本。这样，超时正传时间就无法更新。 闪此要对 Kam 算法进行修正。方法是：报文段每贞传一次，就把超时币传时间 RTO 增 大一些。典型的做法是取新的巫传时间为旧的巫传时间的 2 倍。当不再发生报文段的巫传时， 才根据 L 面给出的式(5-5) 计符超时觅伈时间。实践证明，这种策略较为合现。 • 234 •"}
{"doc_id": "network", "page": 246, "text": "总之， Kam 符法能够使运输层 l又分开有效的和无效的往返时间样本，从而改进了往返 时间的估测，使计红结果更加合理。 5.6.3 选择确认 SACK 现在还有一个问题没有讨论。这就是若收到的报文段无差错，只是木按序号，中间还 缺少一些序号的数据，那么能否设法只传送缺少的数据而不重传已经正确到达接收方的数据？ 答案是可以的。选择确认(Selec ti ve ACK)[RFC 20 I 8, 建议标准］就是一种可行的处理力法。 我们用一个例子来说明选择确认的工作原理。 TCP 的接收方在接收对方发送过来的数 据字节流的序号不连续，结果就形成f一些不连续的字节块（如图 5-20 所示）。可以看出， 序号 1 ~1000 收到了，但序号 1001~1500 没打收到。接下来的字节流又收到了，可是又缺 少了 3001~3500 。再后面从序号 4501 起又没有收到。也就是说，接收方收到了和前面的字 节流不连续的两个字节块。如果这些字节的序号都在接收窗口之内，那么接收方就先收下这 些数据，但攷把这些化息准确地告诉发送力， 1史发送方不哎再戍复发送这些已收到的数据。 尸迕线的j'邸一| 坊个字\\'i坎 沉心．个字节块 I 0001, • • • It 5.0 I  确认月－ 1001 l1 = 1501  30001. • • • 135.0 I  t  R1 =3001/飞= 3501  。5  .4  耋 00-, 5R 4  图 5-20 接收到的字节流忭勺不连续 从图 5-20 可石出，和前后字节不迕续的母一个字节块都有两个边界：左边界和右边界， 因此在图中用四个指针标记这些边界。请注意，第一个字节块的左边界 l1 = 1501, 但右边界 Ri = 3001 而不是 3000 。这就是说，左边界指出字节块的第叶个字节的序号，但右边界减 l 才 处字节块的砐后一个序号。同理，第．．个字节块的左边界 l2 = 350 1.而右边界 R2 = 4501 。 我们知道， TCP 的首部没有哪个字段能够提供上述这些字节块的边界信息。 RFC 2018  规定，如果要使用选择确认 SACK, 那么在建寸． TCP 连接时，就躲在 TCP 百部的选项中加 上“允许 SACK\" 的选项，而双方必须都事先商定好。如果使用选择确认，那么原米首部中 的“确认炒字段＂的用法仍然不变。只是以后在 TCP 报文段的首部中都增加了 SACK 选项， 以便报告收到的不迕续的字节块的边界。由于首部选项的长度最多只有 40 字节，而指明一 个边界就婓用掉 4 字节（因为序号有 32 位，面投使用 4 个字节表示），因此在选项中垃多只 能指明 4 个字节块的边界信息。这是囚为 4 个＇卢廿块共什 8 个边界，因而需要用 32 个字节 米描述。另外还盂婓两个字节，一个字节用米指明是 SACK 选项，另一个字节指明这个选 项要占用多少字节。如果要报告 5 个字节块的边界信息，那么至少需要 42 个字节。这就超 过了选项长度 40 字节的上限。互联网建议标准 RFC 2018 还对报告这些边界信息的格式都 做出了非常明确的规定，这里从略。 然而， SACK 文档并没付指明发送方应当怎样响应 SACK 。因此大多数的实现还是重传 所有未被确认的数据块。 • 235 •"}
{"doc_id": "network", "page": 247, "text": "5.7 TCP 的流量控制 扫一打 璧 般说来，找们总是祁望数据传输得更快一些。但如果发送方把数据 视即讲解 5.7.1 利用滑动窗口实现流盐控制 发送得过快，接收方就可能来不及接收，这就会造成数据的丢失。所谓流量控制(flow con t rol) 就是让发送方的发送速率不要太快，要让接收方来得及接收。 利用滑动窗口机制可以很方便地在 TCP 连接士实现对发送方的流损控制。 下面通过图 5-21 的例子说明如何利川滑动窗口机制进行流整控制。 B  : scq= 1, DATA : A 坟送（卢 l 罕 100, 还能发送 300 字节 : `eq= IOl.DATA : A 发送（归 101 至 200. 还能发送 200 字节 : seq =201,DATA 买鑫A 发达了中办 201 至 300 ，但丢')、f !  : ACK= 1,ack=201 ，八vnd=300 : 允许 A 发送抒\\.} 201 个 500 J~ 300 字节 seq=30LDATA ; A 及送了序号 301 个 400, 还能再发送 100 字节新数据 seq=401,DATA ; A 发送臼扩号 401 至 500, 不能再发送新数斟了 seq= 201, DATA  ACK= I. ack = 501, 八vnd = 100 :  ＄凹气 501, DATA  A 超时｀仕旧的数据，但个能发送新的数据 允许 A 发送序号 501 个． 600 共 100 字节 A 妏送（ l午勺 501 线 600, 不能 1且发送了 ACK= 1,ack~ ．八vnd~0 ; 不允许 A 再发送（到 h'\\} 600 为止的数据都收到了） 图 5-21 利川可变窗口进行流从控制举例 设 A 向 B 发送数据。在连接建立时， B 告诉了 A:“ 我的接收窗口 rwnd = 400 。”（这里 rwnd 表示 rece i ver wi ndow 。)因此，发送方的发送窗口不能超过接收方给出的接收窗口 0 的 数值。话注意， TCP 的窗口单位是字节，不是报文段。 TCP 连接建立时的窗口协商过程在 阳中没有显示出来。再设每一个报义段为 100 字节长，而数据报文段序号的初始值设为 1 （见图中第一个箭头上面的序号 seq= I 。阳中右边的注释可帮助理解整个过程）。请注意， 图中箭头上面人写 ACK 农不首部中的确认付 ACK, 小写 ack 表示确认字段的值。 我们应注，意到，接收方的主机 B 进行了三次流量控制。第一次把窗门减小到twnd = 300,  第二次又减到 1-w nd = 100, 最后减到 rwnd = O, 即不允许发送方再发送数据了。这种使发送 方暂停发送的状态将持续到主机 B 正新发出一个新的窗口值为止。我们还应注意到， B 向 A 发送的三个报文段都设置了 ACK= 1,只有在 ACK= l 时确认号字段才有意义。 现在我们考虑一种估况。在图 5-21 中， B 向 A 发送了零窗口的报文段后不久， B 的接 收缓存又有了一些存储空间。十是 B 向 A 发送了 rwnd = 400 的报文段。然而这个报文段在 传送过程中五失仁 A 一直等待收到 B 发送的非零窗口的通知，而 B 也一肖等待 A 发送的 数据。如果没有其他措施，这种互相等待的死锁局面将一直延续下去。 为了解决这个问题， TCP 为每一个连桵设有一个持续计时器(pers i s tence ti mer) 。只要 CD 注：从 rwnd 的原文行．中文 L予名 1屯 1 ,1儿接收方宙口。然而仆．不产'J.l吴紨的估况下，也可简称为接收窃口。 • 236 •"}
{"doc_id": "network", "page": 248, "text": "TCP 连接的一方收到对方的零窗口通知，就启动持续计时器。若持续计时器设恍的时间到 期，就发送一个零窗口探测报文段（仅携带 l 字节的数据）＇，而对方就在确认这个探测报 文段时给出了现在的窗口值。如果窗口仍然是零，那么收到这个报文段的－力就币新设置持 续计时器。如果窗口个是零，那么死锁的僵局就可以打破了。 5.7.2 TCP 的传输效率 ! I 1 1  前面已经讲过，J应用进程把数据传送到 TCP 的发送缓存后，剩下的发 送任务就巾 TCP 米拧制了。可以用不同的机制来控制 TCP 报文段的发送时 机。例如，第一种机制是 TCP 维持一个变址，它等千最大报文段长度 MSS 。 心吓 只要缓存中存放的数据达到 MSS 字节时，就组装成一个 TCP 报文段发送出去。第一种机制 是小发送方的应用进程指明要求发送报文段，即 TCP 支持的推送（push) 橾作。第二种机制是 发送方的一个计时器期限到了，这时就把当前已有的缓存数据装入报文段（但长度不能超过 MSS) 发送出去。 但是，如何控制 TCP 发送报文段的时机仍然是一个较为复杂的问题[RFC 1122] 。 例如，一个交互式用户使用一条 TELNET 连接（运输层为 TCP 协议）。假设用户只发 l 个字符，加 I:. 20 字节的首部后，得到 21 字节长的 TCP 报文段。再加上 20 字节的 IP 首部， 形成 41 字节长的 IP 数据报。在接收方 TCP 立即发出确认，构成的数据报是 40 字节长（假 定没有数据发送）。若用户要求远地屯机回送这一字符，则又要发回 41 字节长的 IP 数据报 和 40 字节长的确认 IP 数据报。这样，用户仅发 l 个字符时，线路上就需传送总长度为 162 字节共 4 个报文段。当线路带宽并不富裕时，这种传送方法的效率的确不高。队］此应适当推 迟发回确认报义，并尽址使用捎带确认的方法。 在 TCP 的实现中广泛使用 Nag le 算法。算法如下：若发送应用进程把要发送的数据逐 个字节地送到 TCP 的发送缓存，则发送方就把第一个数据字节先发送出去，把后面到达的 数据字节都缓存起来。当发送方收到对第一个数据字符的确认后，再把发送缓存中的所有数 据组装成～个报文段发送出去，同时继续对随后到达的数据进行缓存。只有在收到对前 4 个 报文段的确认后才继续发送下～个报文段。当数据到达较快而网络速率较慢时，用这样的力 法可明显地减少所用的网络带宽。 Nag le 算法还规定，当到达的数据已达到发送商口大小的 一半或已达到报文段的最大长度时，就立即发送一个报文段。这样做，就可以有效地提高网 络的吞吐址。 另一个问题叫作糊涂窗口综合征（s i ll y window s yn drome), 有时也会使 TCP 的性能变坏。 设想一种情况： TCP 接收方的缓存已满，而交互式的应用进程一次只从接收缓存中读取 1 个字节（这样就使接收缓存空间仅腾出 1 个字节），然后向发送方发送确认，并把窗 I I 设四 为 1 个字节（但发送的数据报是 40 字节长）。接着，发送方又发来 l 个字节的数据（消注意， 发送方发送的 LP 数据报是 41 字节长）。接收方发回确认，仍然将窗口设置为 1 个字节。这 样进行下去，使网络的效率很低。 要解决这个问题，可以让接收方等待一段时间，使得或者接收缓存已有足够空间容纳 一个最长的报文段，或者等到接收缓存已有一半空闲的空间。只要出现这两种悄况之一，接 邸法忍嚣磷唇均 5回 ＠汴 TCP 规定．即使设以为＇忑商I. I. 也必须接收以下儿种报文段零窗 11 探溯报义段、确认报义段和携悄紧．包敌拟（（）报 文段． • 237 •"}
{"doc_id": "network", "page": 249, "text": "收力就发出确认报文，并向发送方通知当前的窗门人小。此外，发送方也不要发送太小的报 文段，而是把数据积累成足够大的报文段，或达到桵收方缓存的空间的一半大小。 上述两种方法可配合使用。使得在发送方不发送很小的报文段的同时，接收方也不要 在缓存刚刚有了一｝坟小的空间就急忙把这个很小的窗 U 大小信息通知给发送方。 5.8 TCP 的拥塞控制 5.8.1 拥塞控制的一般原理 在计算机网络中的链路容伈（即带宽）、交换节点中的缓存和处理机＾夺， 都是网络的资源。在某段时间，若对网络中某一资源的需求超过了该资源所能 视桢吓斛 提供的可用部分，网络的性能就要变坏。这种情况就叫作拥塞（congesti on) 。可以把出现网络拥 塞的条件写成如下的关系式： 区对资曲的监求＞i1) 川资腺 (5-7)  若网络中付许多资源同时呈现供应个足，网络的性能就找明昴变坏，招个网络的吞吐 沁将随输入负荷的增大而下降。 付人可能会说：“只要任意增加一些资源，例如，把节，心i．缓存的存储空间扩大，或把链 路更换为吏商速率的链路，或把节点处理机的运环速度提高，就可以解决网络拥塞的问题。” 其实不然。这是因为网络拥寒是一个非常复杂的问题。简单地采用上述做法，在许多情况下， 不们不能解决拥寒问题，而 11 ．还可能使网络的性能史坏。 网络拥华往往足由很多囚素引起的。例如，ii,1某个节点级存的容战太小时，到达该节 点的分组因尤存储空间行存而不得不被丢弃。现在设想将该节，I.l}，缓存的容从扩展到非常大， 于是凡到达该廿点的分组均 11 f在节点的缓存队列中排队，不受任何限制。山于输出链路的容 砍和处理机的处理速度并未提商，因此在这队列中的绝大多数分组的排队笘待时间将会大大 附加，结果上从软件只好把它们进行币传（因为早就超时［）。由此可见，简单地扩大缓存 的存储空间同样会造成网络资源的严屯浪费，因而解决不了网络拥塞的问题。 又如，处刑机处理的速率太低可能引起网络的拥塞。简 1礼地将处狸机的速率提妯，可 能会使曰述情况缓解一些，但往往又会将瓶颈转移到其他地方。问题的实质往往是整个系统 的各个部分不［兀配。只有所付的部分都、臼衍了，问题才会得到斛决。 扒 1 寒常常趋j．鱼，恶化。如朱－个路山器没有足够的缓存空间，它就会丢弃－些新到的分 组。但,,,,分组被云介时，发送这一分组的源点就会玉传这 分组，甚至可能还要·1fli L· 多次． 这样会引起更多的分组流入网络和被网络中的路由器丢弃。可见拥塞引起的正传并不会缓解 网络的拥寒，反而会加剧网络的拥寨。 佣）k 控制与流趾控制的关系密切，它们之间也存在符·些差别。所叫拥塞控制就足防 止过多的数据注入到网络中，这样可以使网络中的路由器或链路不至千过载。拥塞控制所耍 做的都行一个前提，就是网络能够承受现有的网络负荷。拥塞控制是～个全局性的过程，涉 及所付的上机、所有的路 rl I 祸，以及与降低网络传输性能有关的所有因素。但 TCP 连接的 端点只婓迟迟不能收到对方的确认信息、，就猜想在当前网络中的某处很可能发生f拥塞，但 这时却儿法知逆拥塞到底发生在网络的何处，也无法知道发生拥塞的具体原因。（足访问某 个服务器的迪信钺过大？还是在某个地区出现自然灾害？） 相反，流量控制往往是指点对点通信昼的控制，足个端到端的问匙（接收端控制发送 • 238 •"}
{"doc_id": "network", "page": 250, "text": "端）。流揽控伽l 所要做的就是抑制发送端发送数据的速率，以便接收端来得及接收。 可以用一个简单例子说明这种区别。设某个光纤网络的链路传输速率为 1000 Gb it/s, 有 一台巨型计算机向 台个人电脑以 1 Gbit/s 的速率传送文件。显然，网络本身的带宽是足够 大的，因而不存在产生拥塞的问题。但流杂控制却是必需的，因为巨型计算机必须经常停下 来，以便个人电脑来得及接收。 但如果有另一个网络，其链路传输速率为 I Mb it/s, 而有 1000 台大型计镜机连接在这 个网络上。假定其中的 500 台计算机分别向其余的 500 台计算机以 100 kb it/s 的速率发送文 件。那么现在的问题已不是接收端的大型计算机是否来得及接收，而是整个网络的输入负载 是否超过网络所能承受的。 拥寒控制和流队控制之所以常常被弄混，是因为某些拥塞控制算法是向发送端发送 控制报义，并告诉发送端，网络已出现麻烦，必须放慢发送速率。这点又和流屾控制是很相 似的。 流巫控制和拥塞控制的区别可以用图 5-22 的简单比喻来说明。图中表示一水龙头通过 竹道向一个水桶放水。困 5-22(a) 表示水桶太小，来不及接收注入水桶的水。这时只好请求 管水龙头的人把水龙头拧小些，以减缓放水的速率。这就相当千流泣控制。图 5-22(b) 表示 虽然水桶足够大，但管道中有很狭窄的地方，使得管递不通畅，水流衱堵塞。这种悄况被反 馈到管水龙头的人，协求把水龙头拧小些，以减缓放水的速率，为的是减缓水管的堵寨状态。 这就相当 T 拥寒控制。谓注意，间样是把水龙头拧小些，但目的是很小一样的。 艺＼＼传输速率调整 旯 立心 小容扇 接收设备-乓勹 (a) 流杂控制 芦尸 (b) 拥寒控制 图 5-22 流匮控制和拥寒控制的比喻（本图取自 [TANE J I] 图 6-22, 粘此致谢） 进行拥塞控制需要付出代价。这首先需要获得网络内部流量分布的信息。在实施拥寒 控制时，还需要在节点之间交换信息和各种命令，以便选择控制的策略和实施控制。这样就 产生了额外开销。拥塞控制有时斋要将一些资源（如缓存、带宽等）分配给个别用户（或一 些类别的用户）单独使用，这样就使得网络资源不能更好地实现共享。十分明显，在设计拥 塞控制策略时，必须全面衡最得失。 在图 5-23 中的横坐标是提供的负载（o ffered load), 代表单位时间内输入给网络的分组数 目。因此提供的负载也称为输入负载或网络负载。纵坐标是吞吐量(throug h pu t),代表单位 时间内从网络输出的分组数目。具有理想拥塞控制的网络，在吞吐量饱和之前，网络吞吐扭 应等千提供的负载，故吞吐量曲线是 45° 的斜线。但当提供的负载超过某一限度时，由十网 • 239 •"}
{"doc_id": "network", "page": 251, "text": "络资源受限，吞吐扯不再增长而保持为水平线，即吞吐队达到饱和。这就表明捉供的负载中 有 郘分损失掉f （例如，输入到网络的某些分组被某个节点丢弃了）。虽然如此，在这种 理想的拥寒控制作用卜，网络的吞吐翟仍然维持在其所能达到的砓大俏。 谷 1U:tt 提供的负载 图 5-23 拥塞控制所起的 1个用 们是，实际网络的情况就很不相同了。从图 5-23 可看出，随卷捉供的负载的增大，网 络介叶讯的消长速率逐渐减小。也就是说，在网络吞吐队还未达到饱和时，就已经有一部分 的输入分组彼丢弃了。当网络的吞吐量明显地小千理想的吞吐岱时，网络就进入了轻度拥塞 的状态。史值行注意的是，当提供的负载达到某一数值时，网络的吞吐员反而随提供的负载 的研人而卜降，这时网络就进入了拥塞状态。当提供的负载继续增大到某一数值时，网络的 吞吐垃就下降到零，网络已无法工作，这就是所诮的死锁（deadlock) 。 从丿京理 L 讲，寻找拥塞控制的方案无非是寻找使不等式(5-7) 不再成立的条件。这或者 是增大网络的某些可用资源（如业务繁忙时增加一些链路，增大链路的带宽，或使额外的通 信扒从另外的通路分流），或减少一些用户对某些资源的需求（如拒绝接受新的建立连接的 咑求，或要求用户减轻其负荷，这屈千降低服务质狱）。但正如上而所讲过的，在采用某种 枯施时，还必须考虑到该措施所带来的其他影响。 实践证明，拥塞控制是很难设计的，因为它是一个动态的（而个足静态的）问题。当 前网络芷朝看高速化的方向发展，这很容易出现缓存不够大而导致分组的丢失。但分组的丢 失是网络发生拥塞的征兆而不是原因。在许多情况下，甚至正是拥塞控制机制本身成为引起 悯络抖能恶化甚至发生死锁的原因。这点应特别引起重视。 rl, r 计算机网络是一个很复杂的系统，因此可以从控制押论的角度来看拥塞控制这个 问题。这样，从大的方面看，可以分为开环控制和闭环控制两种）」法。开环控制就是在设计 网络时巾先将发生拥寒的有关因素考虑周到，力求网络在上作时不产生拥器。但一旦整个系 统运i」起米，就不丙中途进行改正了。 闭环控制是丛于反馈环路的概念，主要有以下几种措施： (I) 监测网络系统以便检测到拥塞在何时、何处发生。 (2) 把拥募发生的信息传送到可采取行动的地方。 (3) 调整网络系统的运行以解决出现的问题。 们很多的方法可用来监测网络的拥塞。主要的一些指标是：由于缺少缓存空间而被丢 弁的分组的百分数、平均队列长度、超时痲传的分组数、平均分组时延、分组时延的标准诠， 等等。 上述这些指标的上升都标志帮拥塞发生的可能性增加。 般在监测到拥塞发生时，要将拥塞发生的信息传送到产生分组的源站。当然，通知 扑Il 寒及小的分组同样会使网络更加拥塞。 • 240 •"}
{"doc_id": "network", "page": 252, "text": "另一种方法是在路由器转发的分组中保留一个比特或字段，用该比特或字段的伯表示 网络没有拥塞或产生了拥寒。也可以由一些主机或路由器周期性地发出探测分组，以询问拥 塞是否发生。 此外，过千频繁地采取行动以缓和网络的拥塞，会使系统产生不稳定的振荡 G 但过于 迟缓地采取行动又不具有任何实用价值。因此，要采用朵种折中的方法，但选择正确的时间 常数是相当困难的。 卜面就来介绍更加具体的防止网络拥寒的方法。 5.8.2 TCP 的拥塞控制方法 TCP 进行拥塞控制的算法有四种，即慢开始（slow-s t ar t)、拥塞避免 (congestion avo i dance) 、快重传(fas t re transmit)和快恢复(fas t recovery)（见草 f I ·f I  案标准 RFC 5681) 。下面就介绍这些算法的原理。为了共中精力讨论拥寨控 视频讲解 制，我们假定： (1) 数据是单方向传送的，对方只传送确认报文。 (2) 接收方总是有足够大的缓存空间，因而发送窗口的大小由网络的拥塞程度来决定。 1. 慢开始和拥塞避免 下面讨论的拥塞控制也叫作基于窗口的拥塞控制。为此，发送方维持一个叫作拥塞窗 □ cwnd (congestion wi ndow) 的状态变蚊。拥塞饼口的大小取决千网络的拥塞程度，并且是 动态变化着的。发送方让自己的发送窗口等于拥塞窗口。根据假定，对方的接收窗口足够大， 发送方在发送数据时，只需考虑发送方的拥塞囡口。 发送方控制拥塞窗口的原则是：只要网络没有出现拥塞，拥塞窗口就可以再增大一些， 以便把更多的分组发送出去，这样就可以提高网络的利用率。但只要网络出现拥塞或有可能 出现拥塞，就必须把拥塞窗口减小一些，以减少注入到网络中的分组数，以便缓解网络出现 的拥塞。 发送方又如何知道网络发生了拥塞呢？我们知道，当网络发生拥塞时，路由器就要把 来不及处理而排不上队的分组丢弃。因此只要发送方没有按时收到对方的确认报文，也就是 说，只要出现了超时，就可以估计可能在网络某处出现了拥塞。现在通信线路的传输质钺一 般都很好，因传输出差错而丢弃分组的概率是很小的（远小于 1 %)。因此，发送方在超时 蜇传计时器启动时，就判断网络出现了拥塞。 下面将讨论拥塞窗口 cwnd 的大小是怎样变化的。我们从“慢升始算法”讲起。 慢开始算法的思路是这样的：当主机在已建立的 TCP 连接上开始发送数据时，并不消 楚网络当前的负荷情况。如果立即把大品数枢字节注入到网络，那么就有可能引起网络发生 拥塞。经验证明，较好的方法是先探测一下，即由小到大逐渐增大注入到网络中的数据字节， 也就是说，由小到大逐渐增大拥塞窗口数值。 旧的规定是这样的：在刚刚开始发送报文段时，先把初始拥塞窗口 cwnd 设置为 1 至 2 个发送方的最大报文段 SMSS (Sender Maximum Segment S i ze) 的数值，但新的 RFC 5681  （草案标准）把初始拥塞窗口 cwnd 设置为不超过 2 至 4 个 SMSS 的数值。具体的规定如下： 若 SMSS > 2190 字节， 则设置初始拥塞窗口 cwnd = 2 x SMSS 字节，且不得超过 2 个报文段。 若 CSMSS > 1095 字节）且 (SMSS ~ 2190 字节）， • 241 •"}
{"doc_id": "network", "page": 253, "text": "则设置初始拥塞窗口 cwnd = 3 x SMSS 字节，且不得超过 3 个报文段。 若 SMSS ~ 1095 字节， 则设置初始拥塞窗口 cwnd = 4 x SMSS 字节，且不得超过 4 个报文段。 可见这个规定就是限制初始拥塞商口的字节数。 慢开始规定，在每收到一个对新的报文段的确认后，可以把拥塞窗口增加最多一个 SMSS 的数值。更具体些，就是 拥塞窗口 cwnd 每次的增加榄＝ m i n (N, SMSS) (5-8)  其中 N 是原先未被确认的、但现在被刚收到的确认报文段所确认的字节数。不难看出， 当 N<SMSS 时，拥熬窗口每次的增加址要小千 SMSS 。 用这样的方法逐步增大发送方的拥塞窗口 cwnd, 可以使分组注入到网络的速率更加合理。 卜而用例子说明慢开始算法的原理。诮注恣，虽然实际上 TCP 用字节数作为窗口大小 的单位。但为叙述方便起见，我们用报文段的个数作为窗口大小的单位，这样可以使用较小 的数字来阐明拥窑控制的原理。 在一开始发送方先设置 cwnd = 1, 发送第一个报文段．才妾收方收到后就发送确认。慢开 始货［法规定，发送方每收到一个对新报文段的确认（对点传的确认不算在内），就把发送方 的拥塞窗门加 1 。因此，经过 个往返时延 RTT 后，发送方就增大拥塞窗口，使 cwnd = 2,  即发送方现在可连续发送两个报文段。按收方收到这讷个报文段后，先后发回两个确认。现 在发送方收到两个确认，根据慢开始符法，拥塞窗口就应当加 2, 使拥塞窗口从 cwnd = 2 增 加到 cwnd = 4, 即可连续发送 4 个报文段。发送方收到这 4 个确认后，就可以把拥塞窗口再 加 4, i史 cwnd = 8 （如图 5-24 所示）。显然，发送力并个是要在所有的确认都收齐了之店才 调整其拥塞窗口，而是收到一个确认就调整一下拥寒窗口，抓紧时间发送报文段。但这样的 细＇l ）不是我们现在所要研究的，我们想知道的只是拥寒商口的大致增长趋势。 发送｝i 搂收方 图 5-24 发送方每收到 1 个确认就把钏塞窗口加 1 由此可见，慢开始的＂慢”并不是指 cwnd 的培长速率慢，而是指在 TCP 开始发送报 文段时，只发送一个报文段，即设过 cwnd =I, 目的是试探一下网络的拥塞悄况，然后视情 况再逐渐增大 cwnd 。这当然比一开始设置大的 cwnd 值，一下子把许多报文段迅速注入到 网络要“慢得多”。这对防止出现网络拥塞是一个非常好的方法。 为了防止拥塞窗口 cwnd 增长过大引起网络拥塞，还需要设置一个慢开始门限 ss t hresh 状态变楹（可以把门限 ss t hresh 的数值设置大些，例如达到发送窗口的最大容许值）。慢开 • 242 •"}
{"doc_id": "network", "page": 254, "text": "始门限 ss t hrcsh 的用法如下： 当 cwnd < ss thresh 时，使用上述的慢开始算法。 当 cwnd > ss thresh 时，停止使用慢升始算法而改用拥塞避免算法。 当 cwnd = ss thresh 时，既可使用慢开始算法，也可使用拥塞避免算法。 拥塞避免算法的目的是让拥塞窗口 cwnd 缓慢地增大（具体算法见[RFC 5681]) 。执行算 法后的结果大约是这样的：每经过一个往返时间 RTT ，发送方的拥塞窗口 cwnd 的大小就加 I, 而不是像慢开始阶段那样加倍增长。因此在拥塞避免阶段就称为“加法增大 “Al (Add itive Increase), 表明在拥塞避免阶段，拥塞窗口 cwnd 按线性规律缓慢增长，比慢开始 符法的拥塞窗口增长速率缓慢得多。 可以用曲线来说明 TCP 的拥塞窗口 cwnd 是怎样随时间变化的（如图 5-25 所示）。但这 里诮特别注意横坐标采用的单位是往返时延 RTT 。在实际的且联网中， TCP 发送的每一个 报文段的往返时延 RTT 都是不一样的（不会像图 5-24 中所屾出的那样很理想的情况）。但 在这里我们是讲解拥塞控制的原理，囚此应当把图中的 RTT 理解为一个人致的时间，在这 样的时间之内，发送方发出了一批报文段，并且都收到了接收方的确认。图 5-25 中的数字 0 至 0 是特别要注意的几个，I炽。现假定 TCP 的发送窗口等千拥塞窗口。 ＠超 II 寸（网络发 'L 拥寒，执 h慢开始符法）24 ....................``炾．．．．．．．．．． 第 1 次叫整 ss t hresh 20 淄寸名 '  芯骂厂:: ° 1@添粘、心3-A~:二『(t： 1『二i)小 拥寒i,;f r 1 cwnd  8 ···毛．．．．．扣....晕．．．．．．．．．．．．．．．．．．：．．．．．．．．．．．．．．．．．．．．．．．．．．． 荨 f曼开始 0 -:r； 2 幻秤 ssi hrcsh o , 仆返时延 l汀，TT 0 2 4 6 8 IO 12 14 16 18 20 22 24  图 5-25 TCP 拥寒窗 11 cwnd 在拥寒控制时的变化情况 当 TCP 连按已建立后，把拥塞商口 cwnd 置为 1 。在本例中，慢开始门限的初始值设置 为 16 个报文段，即 ss t hresh = 16 。在执行慢开始算法阶段，矫经过一个往返时间 RTT, 拥 塞窗门 cwnd 就加倍。当拥塞窗口 cwnd 增长到慢升始门限值 ss t hresh 时（图中的点 0, 此时 拥塞窗门 cwnd = 16), 就改为执行拥塞避免贺法，拥寒窗口按线性规律增长。但请注怠， “拥塞避免”并非完令避免拥寨，而是让拥塞窗口增长得缓慢些，使网络不容易出现拥塞。 当拥塞面 LI cwnd = 24 时，网络出现了超时（图中的点f))'这就是网络发生拥叁的标志。 于是调整门限值 ss t hresh = cwnd / 2 = 12, 同时设置拥塞窗口 cwnd =I, 执行慢开始镜法。 按照慢开始算法，发送方每收到一个对新报文段的确认 ACK, 就把拥塞窗口值加 1 。 当拥塞窗口 cwnd = ssthresh = 12 时（图中的点 0 ，这是 ss t l订esh 第 1 次调整后的数值），改 为执行拥塞避免符法，拥举窗口按线性规律增大。 当拥塞窗口 cwnd = 16 时（图中的点 0), 出现了一个新的情况，就是发送方一连收到 3 个对同一个报文段的重复确认（图中记为 3-ACK) 。关十这个问题要解释如下。 有时，个别报文段会在网络中意外丢失，但实际上网络并未发生拥塞。如果发送方迟 迟收不到确认，就会产生超时，并误认为网络发生了拥塞。这就导致发送方错误地启动慢开 始，把拥塞窗口 cwnd 又设置为 l ，因而不必要地降低了传输效率。 • 243 •"}
{"doc_id": "network", "page": 255, "text": "采用快重传算法可以让发送力尽早知道发生了个别报文段的丢失。快重传算法首先要 求接收方不要等待自已发送数据时才进1 J十肖带确认，而足婓立即发送确认，即使收到了失序 的报文段也要立即发出对已收到的报义段的重复确认。如图 5-26 所示，接收方收到了 M1 和 M2 后都分别及时发出了确认。现假定桵收方没有收到 M, 但却收到了 M4 。本来接收方可以 什么都不做。但按照快正传算法，才妾收方必须立即发送对 M2 的重复确认，以使让发送方及 早知道接收方没有收到报文段 M3 。发这方接若发送 M5 和 M6 。接收力收到后也仍要再次分 别发出对队的重复确认。这样，发这力共收到了搂收方的 4 个对队的确认，其中后 3 个 都是重复确认七快重传算法规定，发送力只耍一连收到 3 个重复确认，就可知道现在并未出 现网络拥塞，而只是接收方少收到一个报义段 M3 ，因而立即进行重传 M3 （即“快重传”)。 使用快重传可以使整个网络的吞吐坟提高约 20% 。 饺这Ji 收到 3 个连线的 权、I M2 的礼复确认， 立即快呕传 M3 图 5-26 快屯传的示总佟I 桵收}J 确认 M1 确认 M1 1R 复础认 M2 币．复确认 M2 蚁复确认 M2 因此，在图 5-25 中的点 0, 发送方知迫现在只是丢失了个别的报文段。千是不启动慢 开始，而是执行快恢复符法。这时，发送方第 2 次调脓门限值，使 ss t hresh = cwnd / 2 = 8,  同时设置拥塞窗口 cwnd = ssthresh = 8 （见图 5-25 中的点 0), 并开始执行拥塞避免算法。 在图 5-25 中还标注布 “TCP Reno 版本”，表示区别于老的 TCPTahao 版本。 请注意，也有的快恢复实现足把快恢复升始时的拥塞囡口 cwnd 伯再增大一些（增大 3 个报文段的长度），即等于新的 ss t hresh + 3 x MSS 。这样做的理由是：既然发送方收到 3 个 重复的确认，就表明有 3 个分组已经离开了网络。这 3 个分组不协消耗网络的资源而是停留 在接收方的缓存中（接收方发送出 3 个重复的确认就证明了这个事实）。可见现在网络中并 不是坢积了分组而是减少了 3 个分组。因此可以适当把拥塞阶门扩大些。 从图 5-25 可以乔出，什拥牡避免阶段，拥寨商门是按照线性规律增大的，这就是前面 提到过的加法增大 AI 。而一旦出现超时或 3 个亟复的确认，就牧把门限值设置为当前拥塞 窗口值的一半，并大大减小拥塞徇 11 的数值。这常称为＂乘法减小 “MD (Multiplicative  Decrease) 。二者合在一起就丛所俏的 AIMD 符法。 采用这样的拥塞控制方法使得 TCP 的性能有明显的改进［STEV94][RFC 5681] 。 根据以上所述， TCP 的拥塞控制可以归纳为阳 5-27 的流程图。这个流程图就比图 5-25 所示的特例要更加全面些。例如，图 5-25 没有说明在慢开始阶段如果出现了超时（即出现 了网络拥塞）或出现 3-ACK, 发送力应采取什么措施 G 但从图 5-27 的流程图就可以很明确 地知道发送方应采取的措施。 • 244 •"}
{"doc_id": "network", "page": 256, "text": "s.sthresh = c,\\'ll d / 2  cwnd= I  超时 超时 TCP 连接建立 慢开始 拥塞窗口 cwnd= I 3 个瓜复 按指数规伴增大 的 ACK cwnd ;;, ssthresh  拥塞避免 拥塞窗口 cwnd 按线性规律增大 TCP 迕接释放 3 个重复 的 ACK 图 5-27 TCP 的拥寒控制的流程图 在这一节的开始我们就假定了接收方总是有足够大的缓存空间，因而发送窗口的大小 由网络的拥塞程度来决定。但实际上接收方的缓存空间总是有限的。接收方根据自己的接收 能力设定了接收方窗口 rwnd, 并把这个窗口值写入 TCP 首部中的窗口字段，传送给发送方。 因此，接收方窗口又称为通知窗口 (adve rtised wi ndow) 。因此，从接收方对发送方的流护控 制的角度考虑，发送方的发送窗口一定不能超过对方给出的接收方窗口值 rwnd 。 如果把本节所讨论的拥塞控制和接收方对发送方的流址控制一起考虑，那么很显然， 发送方的窗口的上限值应当取为接收方窗口 rwnd 和拥塞窗口 cwnd 这两个变豐中较小的一 个，也就是说： 发送方窗口的上限值＝ M i n [rwnd, cwnd]  式(5-9) 指出： 当 rwnd < cwnd 时，是接收方的接收能力限制发送方窗口的砐大值。 反之，当 cwnd < rwnd 时，则是网络的拥塞程度限制发送方窗口的最大值。 也就是说， rwnd 和 cwnd 中数值较小的一个，控制了发送方发送数据的速率。 5.8.3 主动队列管理 AQM (5-9)  上一节讨论的 TCP 拥塞控制并没有和网络层采取的策略联系起来。其实，它们之间有 容密切的关系。 例如，假定一个路由器对某些分组的处理时间特别长，那么这就可能使这些分组中的 数据部分（即 TCP 报文段）经过很长时间才能到达终点，结果引起发送方对这些报文段的 矗传。根据前面所讲的，重传会使 TCP 连接的发送端认为在网络中发生了拥塞。千是在 TCP 的发送端就采取了拥塞控制措施，但实际上网络并没有发生拥塞。 网络层的策略对 TCP 拥塞控制影响最大的就是路由器的分组丢弃策略。在最简单的情 况下，路巾器的队列通常都按照“先进先出 “FIFO (F 订s t In Fi rst Ou t)的规则处理到来的分 组。由于队列长度总是有限的，因此当队列已满时，以后再到达的所有分组（如果能够继 • 245 •"}
{"doc_id": "network", "page": 257, "text": "续排队，这些分组都将排在队列的尾部）将都被丢弃。这就叫作尾部丢弃策略(ta i l-dro p p ol i c y)。 路由器的尾部丢弃往往会导致一连串分组的丢失，这就使发送方出现超时重传，使 TCP 进入拥塞控制的慢开始状态，结果使 TCP 连接的发送为突然把数据的发送速率降低到 很小的数值。更为严重的是，在网络中通常有很多的 TCP 连接（它们有不同的源点和终点）， 这些连接中的报文段通常是复用在网络层的 lP 数据报中传送的。在这种情况下，若发生了 路由器中的尾部丢弃，就可能会同时影响到很多条 TCP 连接，结果使这许多 TCP 连接在同 一时间突然都进入到慢开始状态。这在 TCP 的术语中称为全局同步(global s ynchron i za ti on) 。 全局同步使得全网的通信量突然下降了很多，而在网络恢复正常后，其通信她又突然增大很 多。 为了避免发生网络中的全局同步现象，右 1998 年提出了主动队列管理 AQM (Ac tive  Queue Manag ement)。所谓“主动”就是不要等到路由器的队列长度已经达到最大值时才不 得不丢弃后面到达的分组。这样就太被动了。应当在队列长度达到某个值得警惕的数值时 （即当网络拥塞有了某些拥塞征兆时），就主动丢弃到达的分组。这样就提醒了发送方放慢 发送的速率，因而有可能使网络拥塞的程度减轻，甚至个出现网络拥塞。 AQM 可以有不同 实现力法，其中曾流行多年的就是随机早期检测 RED (Random Early Detection). RED 还有 几个不同的名称，如 Random Early Drop或 Random Early D i scard （随机早期丢弃）。 实现 RED 时需要使路由器维待两个参数，即队列长度最小门限和最大门限。当每一个 分组到达时， RED 就按照规定的笃法先计符当前的平均队列长度。 (!)若平均队列长度小于最小门限，则把新到达的分组放入队列进行排队。 (2) 若平均队列长度超过敬大门限，则把新到达的分组丢弁。 (3) 若平均队列长度在最小门限和砐大门限之间，则按照朵一丢弃概率p把新到达的分 组丢弃（这就体现f丢弃分组的随机性）。 由此可见， RED 不是等到已经发生网络拥塞后才把所有在队列尾部的分组全部丢弃， 而是在检测到网络拥塞的早期征兆时（即路由器的平均队列长度达到一定数值时），就以概 率p丢弁个别的分组，让拥寒控制只在个别的 TCP 连接上进行，因而避免发生全局性的拥 牡控制。 在 RED 的操作中，最难处理的就是工弃概率p的选抒，因为p并不是个常数。对每一 个到达的分组，都必须计符丢弃概率p的数值。J ETF ，曾经推荐在互联网中的路由器使用 RED 机制 [RFC 2309), 但多年的实践证明， RED 的使用效果并不太理想。因此，在 2015 年 公布的 RFC 7567 已经把过去的 RFC 2309 列为“陈旧的＂，并且不再推荐使用 RED 。对路 由器进行主动队列管理 AQM 仍是必要的。 AQM 实际上就是对路由器中的分组排队进行智 能管理，而不是简单地把队列的尾部丢弃。现在已经有几种不同的算法来代替旧的 RED, 但 都还在实验阶段。目前还没有一种算法能够成为 IETF 的标准，读者可注意这方面的进展。 5.9 TCP 的运输连接管理 TCP 是面向连接的协议。运输连接是用来传送 TCP 报文的。 TCP 运输连接的建立和释 • 246 •"}
{"doc_id": "network", "page": 258, "text": "放是每一次面向连接的通信中必不可少的过程。因此，运输连接就有三个阶段，即：连接建 立、数据传送和连接释放。运输连接的管理就是使运输连接的建立和释放都能正常地进行。 在 TCP 连接建立过程中要解决以下三个问题： (1) 要使每一方能够确知对方的存在。 (2) 要允许双方协颓一些参数（如最大窗口值、是否使用窗口扩大选项和时间戳选项以 及服务质量等）。 (3) 能够对运输实体资源（如缓存大小、连接表中的项目等）进行分配。 TCP 连接的建立采用客户服务器方式。主动发起连接建立的应用进程叫作客户(cl i en t), 而被动等待连接建立的应用进程叫作服务器(server) 。 扫打 5.9.1 TCP 的连接建立 TCP 建立连接的过程叫作握手，握手需要在客户和服务器之间交换三 个 TCP 报文段。图 5-28 画出了三报文握手＇建立 TCP 连接的过程。 璧 视抚iJ I 紨 客户 服务器 二一 B I  I  一二 SYN­ SENT  LISTEN  ESTAB­ LISHED  SYN­ RCVD  令 ESTAB·  LISHED  00 5-28 用二报文握手建立 TCP 连桵 假定主机 A 运行的是 TCP 客户程序，而 B 运行 TCP 服务器程序。最初两端的 TCP 进 程都处千 CLOSED (关闭）状态。图中在主机下面的方框分别是 TCP 进程所处的状态。请 注意，在本例中， A 主动打开连接，而 B 被动打开连接。 一开始， B 的 TCP 服务器进程先创建传输控制块 TCB', 准备接受客户进程的连接诮求。 然后服务器进程就处千 LISTEN （收听）状态，等待客户的连接诸求。如有，即做出响应。 ＠汴．一报文仇手足本教材首次采用的译名，fl: RFC 793 <TCP 杯准的文朽）中使用的名称是小ree way handshake, 但这 个名称很难译为准确的中文。例如．以前本教材杆采用“二次握手”这个广为流行的洋名。其实这是在一次握手过程中交换J尸一． 个报文， 1(1j并不是进行了三次握手（这有点像两个人见曲进行一次握 F 时．他们的手 I· 下摇晃了三次．但这并非进行[~次握 手）。奻近冉次直新阅i负{ RFC 793 义栏，发现付这甘的表述：''three way (three message) handshake\", 可见采用“三报文握手” 这样的译名，在意思的表达上应当是比较准确的． i打注总， handshake 使用的是单数而不是复数，表明只是一次握手。 ＠注：传输控制块 TCB (Transmission Control Block) 存储(i呫升个连接中的一些重要信息，如： TCP 连接农、指向发送和 接收缓存的指针、指向重伟队列的指针、当前的发达和搂收1 i叮｝，等等． • 247 •"}
{"doc_id": "network", "page": 259, "text": "A 的 TCP 客户进程也是首先创建传输控制块 TCB 。然后，在打算建立 TCP 连接时，向 B 发出连接请求报文段，这时首部中的同步付 SYN = I,同时选择一个初始序号 se q = x 。 TCP 规定， SYN 报文段（即 SYN\"\" 1 的报文段）不能携带数据，但要消耗掉一个序号。这 时， TCP 客户进程进入 SYN-SENT （间步已发送）状态。 B 收到连接请求报文段后，如同意建立连接，则向 A 发送确认。在确认报文段中应把 SYN 付和 ACK 位都置 I, 确认号是 ack = x + 1 ，同时也为自己选择一个初始序号 se q= y。 诘注意，这个报文段也不能携带数据，但同样要消耗掉一个序号。这时 TCP 服务器进程进 入 SYN-RCVD （同步收到）状态。 TCP 客户进程收到 B 的确认后，还要向 B 给出确认。确认报文段的 ACK 置1,确认号 ack = y +I, 而自己的序号 seq= x + I 。 TCP 的标准规定， ACK 报文段可以携带数据。但如 果不携带数据则不消耗序号，在这种悄况下，下一个数据报文段的序号仍是 se q= x + 1 。这 时， TCP 连接已经建立， A 进入 ESTABLISHED （已建立连接）状态。 当 B 收到 A 的确认后，也进入 ESTABLISHED 状态。 上而给出的连接建立过程叫作三报文握手。请注意，在图 5-28 中 B 发送给 A 的报文段， 也可拆成两个报文段。可以先发送一个确认报文段 (ACK= 1,ack=x+ I), 然后再发送一 个同步报文段（ SYN = I, seq = y)。这样的过程就变成了四报文握手，但效果是一样的。 为什么 A 鼓后还耍发送一次确认呢？这主要是为了防止已失效的连接请求报文段突然 又传送到了 B, 因而产生错误。 所谓“已失效的连接请求报文段”是这样产生的。考虑一种正常情况， A 发出连接请求， 但因连接诮求报文丢失而未收到确认。于是 A 再重传一次连接请求。后来收到了确认，建 立了连接。数据传输完毕后，就释放了连接。 A 共发送了两个连接请求报文段，其中第一个 丢失，第广个到达了 B, 没有“已失效的连接请求报文段”。 现假定出现一种异常情况，即 A 发出的第一个连接请求报文段并没有丢失，而是在某 些网络节点长时间滞留了，以致延误到连接释放以后的某个时间才到达 B 。本来这是一个早 已失效的报文段。但 B 收到此失效的连接请求报文段后，就误认为是 A 又发出一次新的连 接悄求。于是就向 A 发出确认报文段，同意建立连接。假定不采用报文握手，那么只要 B 发出确认，新的连接就建立了。 由千现在 A 并没有发出建立连接的诸求，因此不会理睬 B 的确认，也不会向 B 发送数 据。但 B 却以为新的运输连接已经建立了，并一直等待 A 发来数据。 B 的许多资源就这样 臼白浪费了。 采用三报文握手的办法，可以防止上述现象的发生。例如在刚才的异常悄况下， A 不会 向 B 的确认发出确认。 B 由千收不到确认，就知道 A 并没有要求建立连接。 5.9.2 TCP 的连接释放 t I ·J I  TCP 连接释放过程比较复杂，我们仍结合双方状态的改变来阐明连接 释放的过程。 数据传输结束后，通信的双方都可释放连接。现在 A 和 B 都处千 颖 ESTABLISHED 状态（如图 5-29 所示）。 A 的应用进程先向其 TCP 发出连 视频讲解 接释放报文段，并停止再发送数据，主动关闭 TCP 连接。 A 把连接释放报文段首部的终止 • 248 •"}
{"doc_id": "network", "page": 260, "text": "控制位 FfN置 l ，具序号 seq = u ，它等 F 前面已传送过的数拟的最后一个字节的序号加 1 。 这时 A 进入 FIN-WAIT-I （终止等待 I) 状态，等待 B 的确认。诸注意， TCP 规定， FIN 报文段即使不携带数据，它也消耗掉一个序号。 客｝、＇ 胀务器 二A ：三；：三 FIN· 1------ WAIT-I 江二竺一二二一二LOSE· 改 WAIT -- ·  FIN- 三六ck=1l+ \\-- 衱动火闭 ,: \\.  TIME­ WAIT  I  咄国 ]一 图 5-29 TCP 连桵释放的过程 B 收到连接释放报文段后即发出确认，确认号是 ack = 11 + I, 而这个报文段自己的序号 是 V, 等千 B 前面已传送过的数据的砓后一个字节的序号加］。然后 B 就进入 CLOSE­ WAIT （关闭等待）状态。 TCP 服务器进程这时应通知高层应用进程，因而从 A 到 B 这个方 向的连接就释放了，这时的 TCP 连接处丁半关闭（ hal f-close) 状态，即 A 已经没有数据要发 送了，但 B 若发送数据， A 仍要接收。也就是说，从 B 到 A 这个方向的连接并未关闭，这 个状态可能会持续一段时间。 A 收到来自 B 的确认后，就进入 FIN-WAIT-2 （终」［等待 2) 状态，等待 B 发出的连接 释放报文段。 若 B 已经没有要向 A 发送的数据，其）壶用进程就通知 TCP 释放连接。这时 B 发出的连 接释放报文段必须使 FIN= I 。现假定 B 的序吁为 w （在半关闭状态 B 可能又发送了一些数 据）。 B 还必须鱼复上次已发送过的确认骂 ack = u + I 。这时 B 就进入 LAST-ACK （最后确 认）状态，等待 A 的确认。 A 在收到 B 的连接释放报文段后，必须对此发出确认。在确认报文段中把 ACK 置 I, 确认号 ack = w + I, 而自己的序号是 se q= u + I （根据 TCP 标准，前面发送过的 FfN报文 段要消耗一个片号）。然后进入到 TIME-WAIT （时间等待）状态。请注悠，现在 TCP 连接 还没有释放掉。必须经过时间等待计时器(TIME-WAIT ti mer) 设置的时间 2MSL 后， A 才进 入到 CLOSED 状态。时间 MSL 叫作最长报文段寿命(Max i mum Segment Lifetime), RFC 793  建议设为 2 分钟。但这亢全是从工桯上来考虑的，对于现在的网络， MSL = 2 分钟可能太长 了一些。因此 TCP 允许不同的实现可根据具体悄况使用更小的 MSL 值。因此，从 A 进入 到 TfM E-WAIT 状态）pi,要经过 4 分钟才能进入到 CLOSED 状态，才能开始建立下一个新 • 249 •"}
{"doc_id": "network", "page": 261, "text": "的连接。当 A 撤销相应的传输控制块 TCB 后，就结束了这次的 TCP 连接。 为什么 A 在 TIME-WAIT 状态必须等待 2MSL 的时间呢？这有两个理由。 第一，为了保证 A 发送的酘后一个 ACK 报文段能够到达 B 。这个 ACK 报文段有可能 丢失，因而使处在 LAST-ACK 状态的 B 收不到对已发送的 FIN+ ACK 报文段的确认。 B 会 超时重传这个 FIN+ ACK 报文段，而 A 就能在 2MSL 时间内收到这个蜇传的 FIN+ ACK 报 文段。接符 A 亟传一次确认，重新启动 2MSL 计时器。最后， A 和 B 都芷常进入到 CLOSED 状态。如果 A 在 TIME-WAIT 状态个等待一段时间，而是在发送完 ACK 报文段后 立即释放连接，那么就无法收到 B 重传的 FIN+ ACK 报文段，因而也不会再发送一次确认 报文段。这样， B 就尤法按照仆常步骤进入 CLOSED 状态。 第二，防止上一节提到的”已失效的连接请求报文段”出现在本连接中。 A 在发送完砓 后一个 ACK 报文段后，再经过时间 2MSL ，就可以使本连接持续的时间内所产生的所有报 文段都从网络小消失。这样就 1:iJ以使下 个新的连接中不会出现这种 Ill 的连接请求报文段。 B 只哎收到f A 发出的确认，就进入 CLOSED 状态。同样， B 在撤销相应的传输控 制块 TCB 后，就结束了这次的 TCP 连接。我们注意到， B 结束 TCP 连接的时间耍比 A 早 一些。 上述的 TCP 连接释放过程足四报文握手。 除时间竹待计时器外， TCP 还设有个保活计时器(kee p al i ve ti mer) 。设想付这样的悄况： 客户已卜动与服务器建立{ TCP 连核。但后来客户端的主机突然出故陓。昂然，服务器以 后就不能再收到客户发米的数据。因此，应当有措施使服务器个要再臼白等待下去。这就是 使用保活计时器。服务器每收到一次客户的数据，就矗新设匣保活计时器，时间的设觉通常 足曲小时。若 1历小时没有收到客户的数据，服务器就发送－个探测报文段，以后则每隔 75 秒钟发送一次。若一连发送 10 个探测报文段后仍无客户的响应，服务器就认为客户端出了 故陷，接抒就关闭这个连接。 5.9.3 TCP 的有限状态机 为了更沾晰地看出 TCP 连桵的各种状态之间的关系，图 5-30 给出了 TCP 的有限状态机。图中每一个方框是 TCP 可能具有的状态。每个方框中 f I ·f I  的大写奂义字符串足 TCP 标准所使用的 TCP 连接状态名。状态之间的箭头 视躲VI 斛 表示可能发生的状念变迁。箭头旁边的字，表明引起这种变迁的原因，或表明发生状态变迁 后又出现什么动作。清注总图中有三种不同的箭头。粗实线箭头农示对客户进程的正常变迁。 粗｝拈线箭头表示对服务器进程的止常变迁。另一种细线箭头表示异常变迁。 我们可以把图 5-30 和前曲的图 5-28 、图 5-29 对照起来吞。在阳 5-28 和图 5-29 中左边 客户进程从上到下的状态变迁，就是图 5-30 中粗实线箭头所指的状态变迁。而 {-1: 图 5-28 和 5-29 右边服务器进程从上到下的状态变辽，就是图 5-30 中粗虚线箭头所指的状态变迁。 还有 些状态变迁，例如连接建寸过程中的从 LISTEN 到 SYN-SENT 和从 SYN-SENT 到 SYN-RCVD 。读者可分析彴．什么估况下会出现这样的变迁（见习题 5-43) 。 • 250 •"}
{"doc_id": "network", "page": 262, "text": "起点 收到 SYN 发送 SYN+ACK••• ••  ．．少奇 RST 收到 SYN, 发送 SYN +ACK  同时打开.  ．斗扫） ACK •• ·•.  关闭 发送 FIN .  ．．叠心，．．，．， / 卢 FIN  沁屯伍亟严汀. . .  关闭 :  发送 F fN: .  霉 严t~:J.~CK 图 5-30 TCP 的有限状态机 本章的重要概念 • 运输层提供应用进程间的逻辑通估，也就是说，运输层之间的迪信并不足真正在两 个运输层之间直接传送数据。运输层向应用层屏蔽了下而网络的细节（如网络拓扑、 所采用的路由选择协议等），它使应用进程看见的就是好像在两个运输层实体之间 有一条端到端的逻辑通信信道。 • 网络层为主机之间提供逻辑通信，而运输层为应用进程之间提仪端到端的逻紨 通信。 • 运输层有两个主要的协议： TCP 和 UDP 。它们都有复用和分用，以及检错的功能。 当运输层采用面向连接的 TCP 协议时，尽管下面的网络是不可加的（只提供尽垃 大努力服务），但这种逻辑通信信道就相当千一条全双工通信的可靠信道。当运输 层采用无连接的 UDP 协议时，这种逻辑通信信道仍然是一条不可靠信道。 • 运输层用一个 16 位端口号来标志一个端口。端口号只具有本地总义，它只是为了 标志木计算机应用层中的各个进程在和运输层交互时的层间接口。在互联网的不同 计算机中，相同的端口号是没有关联的。 • 两台计算机中的进程要互相通信，不仅要知道对方的 P 地址（为了找到对方的计 算机），而且还要知道对方的端口号（为了找到对方计算机中的应用进程）。 • 251 •"}
{"doc_id": "network", "page": 263, "text": "• 运输层的端口号分为服务器端使用的端口号 (0~1023 指派给熟知端口， 1024~ 49151 是登记端口号）和客户端暂时使用的端 17 号 (49152~65535) 。 • UDP 的主要特点是： （ 1) 无连接； （2) 尽最大努力交付； （3) 面向报文； （4) 无拥塞 控制； （ 5) 支待一对一、一对多、多对一和多对多的交互通信； （ 6) 首部开销小 （只有四个字段：源端口、目的端口、长度和检验和）。 • TCP 的主要特点是： （ I) 面向连接； （ 2) 每一条 TCP 连接只能是点对点的（一对 -); (3) 提供可靠交付的服务； （ 4) 提供全双工通信； （ 5) 面向字节流。 • TCP 用主机的 IP 地址加上主机上的端口号作为 TCP 连接的端点。这样的端点就叫 作套接字(socket)或插口。套接字用（ IP 地址：端口号）来表示。 • 停止等待协议能够在不可靠的传输网络上实现可靠的通信。每发送完一个分组就停 止发送，等待对方的确认。在收到确认后再发送下一个分组。分组需要进行编号。 • 超时重传是指只要超过了一段时间仍然没有收到确认，就重传前面发送过的分组 （认为刚才发送的分组丢失了）。因此每发送完一个分组需要设置一个超时计时器， 其重传时间应比数据在分组传输的平均往返时间更长一些。这种自动重传方式常称 为自动重传请求 ARQ。 • 在停止等待协议中，若接收方收到篮复分组，就丢弃该分组，但同时还要发送 确认。 • 连续 ARQ协议可提高信道利用率。发送方维持一个发送窗口，凡位千发送窗口内 的分组都可连续发送出去，而不需要等待对方的确认。接收方一般采用累积确认， 对按序到达的最后一个分组发送确认，表明到这个分组为止的所有分组都已正确收 到了。 • TCP 报文段首部的前 20 个字节是固定的，后面有 4N 字节是根据需要而增加的选 项 (N 是整数）。在一个 TCP 连接中传送的字节流中的每一个字节都按顺序编号。 首部中的序号字段值则指的是本报文段所发送的数据的第一个字节的序号。 • TCP 首部中的确认号是期望收到对方下一个报文段的第一个数据字节的序号。若 确认号为 N, 则表明：到序号 N-1 为止的所有数据都已正确收到。 • TCP 首部中的窗口字段指出了现在允许对方发送的数据灿。窗口值是经常动态变 化着的。 • TCP 使用滑动窗口机制。发送窗口里面的序号表示允许发送的序号。发送窗口后 沿的后面部分表示已发送且已收到了确认，而发送窗口前沿的前面部分表示不允许 发送。发送窗口后沿的变化情况有两种可能，即不动（没有收到新的确认）和前移 （收到了新的确认）。发送窗口前沿通常是不断向前移动的。 • 流扯控制就是让发送方的发送速率不要太快，要让接收方来得及接收。 • 在某段时间，若对网络中某一资源的需求超过了该资源所能提供的可用部分，网络 的性能就要变坏。这种情况就叫作拥塞。拥塞控制就是防止过多的数据注入到网络 中，这样可以使网络中的路由器或链路不至于过载。 • 流量控制是一个端到端的问题，是接收端抑制发送端发送数据的速率，以便使接收 端来得及接收。拥塞控制是一个全局性的过程，涉及所有的主机、所有的路由器， 以及与降低网络传输性能有关的所有因素。 • 为了进行拥塞控制， TCP 的发送方要维持一个拥塞窗口 cwnd 的状态变便。拥塞窗 • 252 •"}
{"doc_id": "network", "page": 264, "text": "口的大小取决千网络的拥塞程度，并且动态地住变化。发送方让自己的发送窗口取 为拥塞窗口和接收方的接收窗口中较小的一个。 • TCP 的拥塞控制采用了四种算法，即慢开始、拥塞避免、快亟传和快恢复。在网 络层，也可以使路由器采用适当的分组丢弃策略（如主动队列管理 A QM), 以减 少网络拥塞的发生。 • 运输连接有三个阶段，即：连接建立、数据传送和连接释放。 • 主动发起 TCP 连接建立的应用进程叫作客户，而被动等待连接建立的应用进程叫 作服务器。 TCP 的连接建立采用三报文握手机制。服务器要确认客户的连接请求， 然后客户要对服务器的确认进行确认。 • TCP 的连接释放采用四报文握手机制。任何一方都可以在数据传送结束后发出连 接释放的通知，待对方确认后就进入半关闭状态。当另一方也没有数据再发送时， 则发送连接释放通知，对方确认后就完全关闭了 TCP 连接。 习题 5-0) 试说明运输层在协议栈中的地位和作用。运输层的通信和网络层的通信有什么重要 的区别？为什么运输层是必不可少的？ 5-02 网络层提供数据报或虚电路服务对上面的运输层有何影响？ 5-03 当应用程序使用面向连接的 TCP 和无连接的 IP 时，这种传输是面向连接的还是无连 接的？ 5-04 试画图解释运输层的复用。画图说明许多个运输用户复用到一条运输连接上，而这 条运输连接又复用到 IP 数据报上。 5-05 试举例说明有些应用程序愿意采用不可靠的 UDP. 而不愿意采用可靠的 TCP 。 5-06 接收方收到有差错的 UDP 用户数据报时应如何处理？ 5-07 如果应用程序愿意使用 UDP 完成可靠传输，这可能吗？诸说明理由。 5-08 为什么说 UDP 是面向报文的，而 TCP 是面向字节流的？ 5-09 端口的作用是什么？为什么端口号要划分为三种？ 5-10 试说明运输层中伪首部的作用。 5-11 某个应用进程使用运输层的用户数据报 UDP, 然后继续向下交给 IP 层后，又封装成 IP 数据报。既然都是数据报，是否可以跳过 UDP 而直接交给 IP 层？哪些功能 UDP 提供了但 IP 没有提供？ 5-12 一个应用程序用 UDP, 到了 IP 层把数据报再划分为 4 个数据报片发送出去。结果前 两个数据报片丢失，后两个到达目的站。过了一段时间应用程序重传 UDP, 曲 IP 层 仍然划分为 4 个数据报片来传送。结果这次前两个到达目的站而后两个丢失。试问： 在目的站能否将这两次传输的 4 个数据报片组装成为完整的数据报？假定目的站第 一次收到的后两个数据报片仍然保存在目的站的缓存中。 5-13 一个 UDP 用户数据报的数据字段为 8192 字节。在链路层婓使用以太网来传送。试 问应当划分为几个 IP 数据报片？说明每一个 IP 数据报片的数据字段长度和片偏移字 段的值。 5-14 一个 UDP 用户数据报的首部的十六进制表示是： 06 32 00 45 00 IC E2 17 。试求源端 口、目的端口、用户数据报的总长度、数据部分长度。这个用户数据报是从客户发 • 253 •"}
{"doc_id": "network", "page": 265, "text": "送给服务器还是从服务器发送给客户？使用 UDP 的这个服务器程）午是什么？ 5-15 使用 TCP 对实时话音数据的传输会有什么问题？使用 UDP 在传送数据文件时会有什 么问题？ 5-16 在停止等待协议中如果不使用编号是否可行？为什么？ 5-17 在停止等待协议中，如果收到重复的报文段时不予理睬（即悄悄地丢弃它而其他什 么也不做）是合可行？试举出具体例子说明理由。 5-18 假定在运输层使用停止等待协议。发送方发送报文段 M。后在设定的时间内未收到确 认，于是重传 M。，但 M。又迟迟不能到达接收方。不久，发送方收到了迟到的对 M。 的确认，千是发送下一个报文段 M1, 不久就收到了对 Ml 的确认。接着发送方发送 新的报文段 M 。，但这个新的 M。在传送过程中丢失了。正巧，一开始就滞留在网络 中的 M。现在到达接收方。接收方无法分辨 M。是旧的。千是收下 M。，并发送确认。 显然，接收方后来收到的 M。是重复的，协议失败了。 试画出类似千图 5-9 所示的双方交换报文段的过程。 5-19 试证明：当用 n 比特进行分组的编号时，若接收窗口等于 1 （即只能按序接收分组）， 则仅在发送窗口不超过 2\"- I 时，连续 ARQ协议才能正确运行。窗口单位是分组。 5-20 在连续 ARQ协议中，若发送窗口等千 7, 则发送端在开始时可连续发送 7 个分组。 因此，在每一分组发出后，都要嚣一个超时计时器。现在计算机里只有一个硬时钟。 设这 7 个分组发出的时间分别为to, l1,..., l6, 且tOU1 都一样大。试问如何实现这 7 个超 时计时器（这叫软时钟法） ?  5-21 假定使用连续 AR Q协议，发送窗口大小是 3, 而序号范围是[O, 15), 而传输媒体保 证在接收方能够按序收到分组。在某一时刻， 0`接收方，下一个期望收到的序号是 5 。 试问： (1) 在发送方的发送窗口中可能出现的序号组合有哪些？ (2) 接收方已经发送出的、但在网络中（即还未到达发送方）的确认分组可能有哪 些？说明这些确认分组是用来确认哪些序号的分组。 5-22 上机 A 向主机 B 发送一个很长的文件，其长度为 L'字节。假定 TCP 使用的 MSS 为 1460 字节。 (I) 在 TCP 的序号不重复使用的条件下， L 的最大值是多少？ (2) 假定使用 K 面计算出的文件长度，而运输层、网络层和数据链路层所用的首部开 销共 66 字节，链路的数据率为 10 Mb it/s, 试求这个文件所需的最短发送时间。 5-23 主机 A 向主机 B 连续发送了两个 TCP 报文段，其序号分别是 70 和 100 。试问： (I) 第一个报文段携带了多少字节的数据？ (2) 主机 B 收到第一个报文段后发回的确认中的确认号应当是多少？ (3) 如果 B 收到第二个报文段后发回的确认中的确认号是 180, 试问 A 发送的第二个 报文段中的数据有多少字节？ (4) 如果 A 发送的第一个报文段丢失了，但第二个报文段到达了 B 。 B 在第二个报文 段到达后向 A 发送确认。试问这个确认号应为多少？ 5-24 一个 TCP 连接下而使用 256 kb it/s 的链路，其端到端时延为 128 ms 。经测试，发现吞 吐量只有 120 kb it/s 。试问发送窗口 W 是多少？ （提示：可以有两种答案，取决于接 收端发出确认的时机。） • 254 •"}
{"doc_id": "network", "page": 266, "text": "5-25 为什么在 TCP 首部中要把 TCP 的端口号放入最开始的 4 个字节？ 5-26 为什么在 TCP 首部中有一个首部长度字段，而 UDP 的首部中就没有这个字段？ 5-27 一个 TCP 报文段的数据部分最多为多少个字节？为什么？如果用户要传送的数据的 字节长度超过 TCP 报文段中的序号字段可能编出的最大序号，问还能否用 TCP 来传 送？ 5-28 主机 A 向主机 B 发送 TCP 报文段，首部中的源端门是 m 而目的端口是 n 。当 B 向 A 发送回信时，其 TCP 报文段的首部中的源端口和目的端口分别是什么？ 5-29 在使用 TCP 传送数据时，如果有一个确认报文段丢失了，也不一定会引起与该确认 报文段对应的数据的亟传。试说明理由。 5-30 设 TCP 使用的最大窗口为 65535 字节，而传输信道不产生差错，带宽也不受限制。 若报文段的平均往返时间为 20 ms, 问所能得到的砐大吞吐矗是多少？ 5-31 通信信道带宽为 I Gb it/s, 端到端传播时延为 10 ms 。 TCP 的发送窗口为 65535 字 节。试问：可能达到的最大吞吐豐是多少？信道的利用率是多少？ 5-32 什么是 Kam 算法？在 TCP 的重传机制中，若不采用 Kam 算法，而是在收到确认时 都认为是对重传报文段的确认，那么由此得出的往返时间样木和重传时间都会偏小。 试问：重传时间最后会减小到什么程度？ 5-33 假定 TCP 在开始建立连接时，发送方设定超时重传时间 RT0=6 秒。 (1)当发送方收到对方的连接确认报文段时，测量出 RTT 样本值为1. 5 秒。试计算现 在的 RTO 值。 (2) 当发送方发送数据报文段并收到确认时，测员出 RTT 样本值为 2.5 秒。试计算现 在的 RTO 值。 5-34 已知第一次测得 TCP 的往返时间 RTT 是 30 ms 。接着收到了三个确认报文段，用它 们测似出的往返时间样本 RTT 分别是： 26 ms, 32 ms 和 24 ms 。设a= 0.1 。试计算每 一次新的加权平均往返时间伯 RTTs 。讨论所得出的结果。 5-35 用 TCP 通过速率为 I Gb it/ s 的链路传送一个 10 MB 的文件。假定链路的往返时延 RTT = 50 ms 。 TCP 选用了窗口扩大选项，使窗口达到可选用的最大值。在接收端， TCP 的接收窗口为 I MB （保待不变），而发送端采用拥塞控制绊法，从慢开始传送。 假定拥塞窗口以分组为单位计算，在一开始发送 1 个分组，而每个分组长度都是 l KB 。假定网络不会发生拥塞和分组丢失，并且发送端发送数据的速率足够快，因此 发送时延可以忽略不计，而接收端每一次收完一批分组后就立即发送确认 ACK 分组。 (I) 经过多少个 RTT 后，发送窗口大小达到 I MB?  (2) 发送端把整个 10 MB 文件传送成功共需要经过多少个 RTT? 传送成功是指发送 完整个文件，并收到所有的确认。 TCP 扩大的窗口够用吗？ (3) 根据整个文件发送成功所花费的时间（包括收到所有的确认），计絊此传输链路 的有效吞吐率。链路带宽的利用率是多少？ 5-36 假定 TCP 采用一种仅使用线性增大和乘法减小的简单拥塞控制算法，而不使用慢开 始。发送窗口不采用字节为计算单位，而是使用分组pk t为计算单位。在一开始时发 送窗口为 I p kt。假定分组的发送时延非常小，可以忽略不计。所有产生的时延就是 传播时延。假定发送窗口总是小于接收窗口。接收端每收到一组分组后，就立即发 回确认 ACK 。假定分组的编号为／，在一开始发送的是i = l 的分组。以后当i = 9, 25,  • 255 •"}
{"doc_id": "network", "page": 267, "text": "30, 38 和 50 时，发生了分组的丢失。再假定分组的超时重传时间正好是下一个 RTT 开始的时间。试画出拥塞窗口（也就是发送窗口）与 RTT 的关系曲线，画到发送第 51 个分组为止。 5-37 在 TCP 的拥塞控制中，什么是慢开始、拥塞避免、快重传和快恢复算法？这里每一· 种算法各起什么作用？“乘法减小”和“加法增大“各用在什么估况下？ 5-38 设 TCP 的 ss t hresh 的初始值为 8 （单位为报文段）。当拥寒窗口上升到 12 时网络发生 了超时， TCP 使用慢开始和拥塞避免。试分别求出 RTT = I 到 RTT = 15 的各拥塞窗 口大小。你能说明拥塞窗口每一次变化的原因吗？ 5-39 TCP 的拥塞窗口 cwnd 大小与 RTT 的关系如下所示： cwnd I 2 4 8 16 32 33 34 35 36  RTT I 2 3 4 5 6 7 8 9 10  cwnd 40 41 42 21 22 23 24 25 26 I  RTT 14 15 16 17 18 19 20 21 22 2.1  (l) 试画出如图 5-25 所示的拥塞窗口与 RTT 的关系曲线。 (2) 指明 TCP 工作在慢开始阶段的时间间隔。 (3) 指明 TCP 工作在拥塞避免阶段的时间间隔。 37 38 39  II 12 13  2 4 8  24 25 26  (4) 在 RTT= 16 和 RTT=22 之后发送方是通过收到三个亟复的确认还是通过超时检 测到丢失了报文段？ (5) 在 RTT= I 、 RTT= 18 和 RTT=24 时，门限 ss t hresh 分别被设置为多大？ (6) 在 RTT 等于多少时发送出第 70 个报文段？ (7) 假定在 RTT = 26 之后收到了三个疽复的确认，因而检测出了报文段的丢失，那 么拥寒窗口 cwnd 和门限 ss thresh 应设置为多大？ 5-40 TCP 在进行流足控制时，以分组的丢失作为产生拥塞的标志。有没有不是因拥塞而 引起分组丢失的情况？如有，请举出三种悄况。 5-41 用 TCP 传送 512 字节的数据。设窗口为 100 字节，而 TCP 报文段每次也是传送 100 字节的数据。再设发送方和接收方的起始序号分别选为 100 和 200, 试画出类似千图 5-28 的工作示总图。从连接建立阶段到连接释放都要画上（可不考虑传捅时延）。 5-42 在图 5-29 中所示的连接释放过程中，在 ESTABLISHED 状态下，服务器进程能否先 不发送 ack = u + I 的确认？ （因为后面要发送的连接释放报文段中仍有 ack = u + I 这 信息。） 5-43 什图 5-30 中，在什么情况下会发生从状态 SYN-SENT 到状态 SYN-RCYD 的变迁？ 5-44 试以具体例子说明为什么一个运输连接可以有多种方式释放。可以设两个互相通信 的用户分别连接在网络的两节点上。 5-45 解释为什么突然释放运输连接就可能会丢失用户数据，而使用 TCP 的连接释放方法 就可保证不丢失数据。 5-46 试用具体例了说明为什么在运输连接建立时要使用三报文握手。说明如不这样做可 能会出现什么悄况。 5-47 一客户向服务器请求建立 TCP 连接。客户在 TCP 连接建立的三报文握手中的最后一 个报文段中捎带上一些数据，请求服务器发送一个长度为 L 字节的文件。假定： • 256 •"}
{"doc_id": "network", "page": 268, "text": "(I) 客户和服务器之间的数据传送速率是 R 字节／秒，客户与服务器之间的往返时间 是 RTT （固定值）。 (2) 服务器发送的 TCP 报文段的长度都是 M 字节，而发送窗口大小是 nM 字节。 (3) 所有传送的报文段都不会出现差错（无重传），客户收到服务器发来的报文段后 就及时发送确认。 (4) 所有的协议首部开销都可忽略，所有确认报文段和连接建立阶段的报文段的长度 都可忽略（即忽略这些报文段的发送时间）。 试证明，从客户开始发起连接建立到接收服务器发送的整个文件所需的时间 T 是： T=2 RTT+LIR 当 nM> R (RTT) + M  或 T= 2 RTT + LIR + (K - 1)[MIR+ RTT -nMIR] 当 nM < R (RTT) + M  其中， k ＝「LlnMl, 符号 IXl 表示若 x 不是整数，则把 x 的整数部分加 1 。 （提示：求证的第一个等式发生在发送窗口较大的情况，可以连续把文件发送完。求 证的第二个等式发生在发送窗口较小的情况，发送几个报文段后就必须停顿下来，等 收到确认后再继续发送。建议先画出双方交互的时间图，然后再进行推导。） 5-48 网络允许的砐大报文段长度为 128 字节，序号用 8 位表示，报文段在网络中的寿命 为 30 秒。求发送报文段的一方所能达到的最高数据率。 5-49 下面是以十六进制格式存储的一个 UDP 首部： CB84000D00 I COO IC  试问： (1) 源端口号是什么？ (2) 目的端口号是什么？ (3) 这个用户数据报的总长度是多少？ (4) 数据长度是多少？ (5) 这个分组是从客户到服务器方向的，还足从服务器到客户方向的？ (6) 客户进程是什么？ 5-50 把图 5-6 计算 UDP 检验和的例子自己具体演算一下，看是否能够得出书上的计算结果。 5-51 在以下几种情况下， UDP 的检验和在发送时的数值分别是多少？ (1)发送方决定不使用检验和。 (2) 发送方使用检验和，检验和的数值是全 1 。 (3) 发送方使用检验和，检验和的数值是全 0 。 5-52 UDP 和 IP 的不可靠程度是否相同？请加以解释。 5-53 UDP 用户数据报的最小长度是多少？用最小长度的 UDP 用户数据报构成的最短 IP 数据报的长度是多少？ 5-54 某客户使用 UDP 将数据发送给一服务器，数据共 16 字节。试计算在运输层的传输 效率（有用字节与总字节之比）。 5-55 重做习题 5-54, 但在 IP 层计算传输效率。假定 IP 首部无选项。 5-56 重做习题 5-54, 但在数据链路层计算传输效率。假定 1P 首部无选项，在数据链路层 使用以太网。 • 257 •"}
{"doc_id": "network", "page": 269, "text": "5-57 某客户有 67000 字节的分组。试说明怎样使用 UDP 数据报将这个分组进行传送。 5-58 TCP 在时间为 4:30:20 （即 4 点 30 分 20 秒）发送了一个报文段。由于没有收到确认， 因此什 4:30:25 重传了前面这个报文段，并在 4:30:27 收到了确认。若以前的 RTT 值 是 4 秒，根据 Kam 釭法，新的 RTT 值是多少？ 5-59 TCP 连接使用 l000 字节的窗口值，而上一次的确认号是 22001 。现在收到了一个报 文段，确认号是 22401 。试用图来说明在这之前与之后的窗口悄况。 5-60 同卜题。但发送方收到确认号是 22401 的报文段时，其窗口字段变为 1200 字节。试 用图来说明在这之前与之后的窗口情况。 5-61 在本题中列出的 8 种情况下，画出发送窗口的变化，并标明可用窗口的位贯。已知 主机 A 要向主机 B 发送 3 KB 的数据。在 TCP 连接建立后， A 的发送窗口大小是 2 KB 。 A 的初始序号是 0 。 （ l) 一开始 A 发送 I KB 的数据。 (2) 接名 A 就一直发送数据，直到把发送窗口用宪． (3) 发送方 A 收到对第 l000 号字节的确认报文段。 (4) 发送方 A 再发送 850 B 的数据。 (5) 发送方 A 收到 ack = 900 的确认报文段。 (6) 发送方 A 收到对第 2047 号字节的确认报文段。 (7) 发送方 A 把剩下的数据全部都发送完。 (8) 发送方 A 收到 ack = 3072 的确认报文段。 5-62 TCP 连接处千 ESTABLISHED 状态。以下的事件相继发生： (I) 收到一个 FIN 报文段。 (2) 应用程序发送“关闭“报文。 在每一个事件之后，连接的状态是什么？在每一个事件之后发生的动作是什么？ 5-63 TCP 连接处于 SYN-RCVD 状态。以下的事件相继发生： (I) 应用程序发送“关闭“报文。 (2) 收到 FlN 报文段。 在以卜的每一个事件之后，连接的状态是什么？在每一个事件之后发生的动作是什么？ 5-64 TCP 连接处::P FIN-WAIT-I 状态。以下的事件相继发生： 收到 ACK 报文段。 收到 FIN 报文段。 发生f超时。 在以上的每一个事件之后，连接的状态是什么？在每一个事件之后发生的动作是什么？ 5-65 假定主机 A 向 B 发送一个 TCP 报文段。在这个报文段中，序号是 50, 而数据一共有 6 字节长。试问，在这个报文段中的确认字段是否应当写入 56? 5-66 上机 A 通过 TCP 连接向 B 发送—个很长的文件，因此这饰要分成很多个报文段来发 送。假定某一个 TCP 报文段的序号是 X, 那么下一个报文段的序号是否就是 x+1 呢？ 5-67 TCP 的吞叶岱应当是每秒发送的数据字节数，还是每秒发送的首部和数据之和的字 订数？在 IIt屈应当是每秒发送的字节数，还是每秒发送的比特数？ 5-'18 在 TCP 的连接建立的三报义握手过程中，为什么第＝个报文段不需要对方的确认？ • 258 •"}
{"doc_id": "network", "page": 270, "text": "这会不会出现问题？ 5-69 现在假定使用类似 TCP 的协议（即使用滑动窗口可靠传送字节流），数据传输速率是 I Gb it/s, 而网络的往返时间 RTT = 140 ms 。假定报文段的最大生存时间是 60 秒。如 果要尽可能快地传送数据，在我们的通信协议的首部中，发送窗口和序号字段至少 各应当设为多大？ 5-70 假定用 TCP 协议在 40 Gb it/s 的线路上传送数据。 (I) 如果 TCP 充分利用了线路的带宽，那么需要多长的时间 TCP 会发生序号绕回？ (2) 假定现在 TCP 的首部中采用了时间戳选项。时间戳占用了 4 字节，共 32 位。每 隔一定的时间（这段时间叫作一个嘀唔）时间戳的数值加 1 。假定设计的时间戳 是每隔 859 微秒，时间戳的数值加 1 。试问要经过多少时间才发生时间戳数值的 绕回？ 5-71 在 5.5 节中指出：例如，若用 2.5 Gb it/s 的速率发送报文段，则不到 14 秒钟序号就会 重复。谓计算验证这句话． 5-72 已知 TCP 的接收窗口大小是 600 （单位是字节，为简单起见以后就省略了单位），已 经确认了的序号是 300 。试问，在不断地接收报文段和发送确认报文段的过程中，接 收窗口也可能会发生变化（增大或缩小）。请用具体例子（指出接收方发送的确认报 文段中的亟要信息）来说明哪些情况是可能发生的，而哪些情况是不允许发生的。 5-73 在上题中，如果接收方突然因某种原因不能够再接收数据了，可以立即向发送方发 送把接收窗口贸为零的报文段（即 rwnd = 0) 。这时会导致接收窗口的前沿后退。试 问这种悄况是否允许？ 5-74 流量控制和拥塞拧制的最主要的区别是什么？发送窗口的大小取决于流量控制还是 拥塞控制？ • 259 •"}
{"doc_id": "network", "page": 271, "text": "第 6 章应用层 在前五章我们已经详细地讨论了计算机网络提供通信服务的过程。但是我们还没有讨 论这些通信服务是如何提供给应用进程来使用的。本竟讨论各种应用进程通过什么样的应用 层协议来使用网络所提供的这些通信服务。 在上一章，我们已学习了运输层为应用进程提供了端到端的通信服务。但不同的网络 应用的应用进程之间，还需要有不同的通信规则。因此在运输层协议之上，还需要有应用层 协议 (app l i cati on layer pro tocol) 。这是因为，每个应用层协议都是为了解决某一类应用问题， 而问题的解决又必须通过位千不同主机中的多个应用进程之间的通信和协同工作来完成。应 用进程之间的这种通信必须遵循严格的规则。应用层的具体内容就是精确定义这些通信规则。 具体来说，应用层协议应当定义： • 应用进程交换的报文类型，如请求报文和响应报文。 • 各种报文类型的语法，如报文中的各个字段及其详细描述。 • 字段的语义，即包含在字段中的信息的含义。 • 进程何时、如何发送报文，以及对报文进行响应的规则。 互联网公共领域的标准应用的应川层协议是由 RFC 文档定义的，大家都可以使用。例 如，万维网的应用层协议 HTTP （超文本传输协议）就是由建议标准 RFC 7230 定义的。如 果浏览器开发者遵守 RFC 7230 标准，所开发出来的浏览器就能够访问任何遵守该标准的万 维网服务器并获取相应的万维网页面。在互联网中还有很多其他应用的应用层协议不是公开 的，而是专用的。例如，很多现有的 P2P 文件共享系统使用的就是专用应用层协议。 请注意，应用层协议与网络应用并不是同一个概念。应用层协议只是网络应用的一部 分。例如，万维网应用是一种基于客户／服务器体系结构的网络应用。万维网应用包含很多 部件，有万维网浏览器、万维网服务器、万维网文档的格式标准，以及一个应用层协议。万 维网的应用层协议是 HTTP, 它定义了在万维网浏览器和万维网服务器之间传送的报文类型、 格式和序列等规则。而万维网浏览器如何显示一个万维网页面，万维网服务器是用多线程还 是用多进程来实现，则都不是 HTTP 所定义的内容。 应用层的许多协议都是基于客户服务器方式。即使是 P2P 对等通信方式，实质上也是 一种特殊的客户服务器方式。这里再明确一下，客户(cl i en t)和服务器 (server) 都是指通信中所 涉及的两个应用进程。客户服务器方式所描述的是进程之间服务和被服务的关系。这里最主 要的特征就是：客户是服务请求方，服务器是服务提供方。 下面先讨论许多应用协议都要使用的域名系统。在介绍了文件传送协议和远程登录协 议后，再堇点介绍万维网的工作原理及其主要协议。由于万维网的出现使互联网得到了飞速 的发展，因此万维网在本章中占有最大的篇幅，也是本竞的重点。接着讨论用户经常使用的 电子邮件。最后，介绍有关网络管理方面的问题以及有关网络编程的基本概念。对应用层更 深入的学习可参阅［COME I 5][COME06][KURO I 7][TANE 11] 及有关标准。 本章敬重要的内容是： (l) 域名系统 DNS 一从域名解析出 IP 地址。 • 260 •"}
{"doc_id": "network", "page": 272, "text": "(2) 万维网和 HTTP 协议，以及万维网的两种不同的信息搜索引擎。 (3) 电子邮件的传送过程， SMTP 协议和 POP3 协议、 IMAP 协议使用的场合。 (4) 动态主机配置协议 DHCP 的特点。 (5) 网络管理的三个组成部分 (SNMP 本身、管理信息结构 SMI 和管理信息库 MIB) 的作用。 (6) 系统调用和应用编程接口的基本概念。 (7) P2P 文件系统。 6.1 域名系统 DNS 6. l.1 域名系统概述 域名系统 DNS (Doma in Name S ys t em) 是互联网使用的命名系统，用来把便于人们使用 的机器名字转换为 TP 地扯。域名系统其实就是名字系统。为什么不叫“名字”而叫“域名“ 呢？这是因为在这种互联网的命名系统中使用了许多的＂域 ”(domai n), 因此就出现了＂域 名“这个名词。 ＂域名系统”很明确地指明这种系统是用在互联网中的。 许多应用层软件经常直接使用域名系统 DNS 。虽然计算机的用户只是间接而不是直接 使用域名系统，但 DNS 却为互联网的各种网络应用提供了核心服务。 用户与互联网上某台主机通信时，必须要知道对方的 IP 地址。然而用户很难记住长达 32 位的二进制主机地址。即使是点分十进制 IP 地址也并不太容易记忆。但在应用层为了便 于用户记忆各种网络应用，连接在互联网上的主机不仅有 IP 地址，而且还有便于用户记忆 的主机名字。域名系统 DNS 能够把互联网上的主机名字转换为 lP 地址。 早在 ARPANET 时代，整个网络士只有数百台计算机，那时使用一个叫作 hosts 的文件， 列出所有主机名字和相应的 IP 地址。只要用户输入一台主机名字，计算机就可很快地把这 台主机名字转换成机器能够识别的二进制 IP 地址。 为什么机器在处理 IP 数据报时要使用 lP 地址而不使用域名呢？这是因为 IP 地址的长 度是固定的 32 位（如果是 IPv6 地址，那就是 128 位，也是定长的），而域名的长度并不是 固定的，机器处理起来比较困难。 从理论上讲，整个互联网可以只使用一个域名服务器，使它装入互联网上所有的主机 名，并回答所有对 IP 地址的查询。然而这种做法并不可取。因为互联网规模很大，这样的 域名服务器肯定会因过负荷而无法正常工作，而且一旦域名服务器出现故降，整个互联网就 会瘫痪。因此，早在 1983 年互联网就开始采用层次树状结构的命名方法，并使用分布式的 域名系统 DNS [RFC 1034, RFC 1035, STDl3] 。 互联网的域名系统 DNS 被设计成为一个联机分布式数据库系统，并采用客户服务器方 式。 DNS 使大多数名字都在本地进行解析(resolve评，仅少量解析盂要在互联网上通信，因 此 DNS 系统的效率很高。由于 DNS 是分布式系统，即使单个计算机出了故障，也不会妨碍 整个 DNS 系统的正常运行。 O 注：在 TCP/IP 的文杻中，这种地址$t换祁称为地址解析．解析就是转换的意思，地址解析可能会包含多次的究询诸求 和回答过f'八 • 261 •"}
{"doc_id": "network", "page": 273, "text": "域名到 IP 地址的解析是由分布在互联网上的许多域名服务器程序（可简称为域名服务 器）共同完成的。域名服务器程序在专设的节点上运行，而人们也常把运行域名服务器程序 的机器称为域名服务器。 域名到 IP 地址的解析过程的要点如下：当某一个应用进程需要把主机名解析为 IP 地址 时，该应用进程就调用解析程序（resolver), 并成为 DNS 的一个客户，把待解析的域名放在 DNS 请求报文中，以 UDP 用户数据报方式发给本地域名服务器（使用 UDP 是为了减少开 销）。本地域名服务器在查找域名后，把对应的 IP 地址放在回答报文中返回。应用进程获得 目的主机的 IP 地址后即可进行通信。 笘本地域名服务器不能回答该请求，则此域名服务器就暂时成为 DNS 中的另一个客户， 并向其他域名服务器发出查询谓求。这种过程直至找到能够回答该请求的域名服务器为止。 上述这种查找过程，后面还要进一步讨论。 6.1.2 互联网的域名结构 早期的互联网使用了非等级的名字空间，其优点是名字简短。但当互联网上的用户数 急剧增加时，用非等级的名字空间来管理一个很大的而且是经常变化的名字集合是非常困难 的。因此，互联网后来就采用了层次树状结构的命名方法，就像全球邮政系统和电话系统那 样。采用这种命名方法，任何一个连接在互联网上的主机或路由器，都有一个唯一的层次结 构的名字，即域名 (doma i n name) 。这里，“域 ”(domai n) 是名字空间中一个可被管理的划分。 域还可以划分为子域，而子域还可继续划分为子域的子域，这样就形成了顶级域、二级域、 三级域，等等。 从语法上讲，每一个域名都由标号(label) 序列组成，而各标号之间用点隔开（请注意， 这导所说的“点”是英语中的句号”“，不是中文的句号”。”)。例如下面的域名 mail.cctv.com  / l \\  三级域名．二级域名．顶级域名 就是中央电视台用于收发电子邮件的计算机（即邮件服务器）的域名，它由三个标号组成， 其中标号 com 是顶级域名，标号 cc tv是二级域名，标号 mai l 是三级域名。 DNS 规定，域名中的标号都由英文字母和数字组成，每一个标号不超过 63 个字符（但 为了记忆方便，最好不要超过 12 个字符），也不区分大小写字母（例如， CCTV 或 cc t v 在 域名中是等效的）。标号中除连字符（一）外不能使用其他的标点符号。级别最低的域名写在最 左边，而级别最高的顶级域名则写在最右边。由多个标号组成的完整域名总共不超过 255 个 字符。 DNS 既不规定一个域名需要包含多少个下级域名，也不规定每一级的坡名代表什么 ：意思。各级域名由其上一级的域名管理机构管理，而最高的顶级域名则由 ICANN 进行管理。 用这种方法可使每一个域名在整个互联网范围内是唯一的，并且也容易设计出一种查找域名 的机制。 需要注悠的是，域名只是个逻辑概念，并不代表计算机所在的物理地点。变长的域名 和使用有助记忆的字符串，是为了便于人使用。而 IP 地址是定长的 32 位二进制数字则非常 便于机器进行处理。这里需要注总，域名中的“点”和点分十进制 IP 地址中的“点”并无 一一对应的关系。点分十进制 IP 地址中一定是包含三个“点”，但每一个域名中“点”的数 • 262 •"}
{"doc_id": "network", "page": 274, "text": "目则不一定正好是三个。 截至 2020 年 6 月的统计(W-W如］，现在全球顶级域名 TLD (Top Level Doma i n) 在 IANA 登记的已有 1584 个（其中有不到 80 个未使用）。原先的顶级域名共分为三大类： (I) 国家顶级域名 nTLD: 采用 ISO 3166 的规定。如 en 表示中国， us 表示美国， uk 表 示英国，等等立国家顶级域名又常记为 ccTLD (cc 表示国家代码 coun try -code) 。截至 2020 年 6 月为止，国家顶级域名总数已达 316 个。 (2) 通用顶级域名gTLD: 到 2006 年 12 月为止，通用顶级域名的总数已经达到 20 个。 最先确定的通用顶级域名有 7 个，即： com （公司企业）， ne t（网络服务机构）， org（非营利性组织），in t（国际组织）， edu （美国专用的教育机构），gov （美国的政府部门）， mi l 表示（美国的军事部门）。 以后又陆续增加了 13 个迪用顶级域名： aero （航空运输企业）， as i a （亚太地区）， b i z （公司和企业）， cat（使用加泰隆人的语 言和文化团体）， coo p（合作团体），i n fo（各种情况），j obs （人力资源管理者）， mobi（移 动产品与服务的用户和提供者）， museum （博物馆）， name （个人），pro （有证书的专业人 员），tel (Teln i c 股份有限公司），travel （旅游业）。 (3) 基础结构域名(i n fras t ruc tu re doma i n): 这种顶级域名只有 个，即 a rp a, 用千反向域 名解析，因此又称为反向域名。 伯得注意的是， lCANN 千 2011 年 6 月 20 日在新加坡会议上正式批准新顶级域名 (New gTLD), 因此任何公司、机构都有权向 ICANN 申请新的顶级域名。新顶级域名的后缀特点， 使企业域名具有了显著的、强烈的标志特征。因此，新顶级域名被认为是真正的企业网络商 标。新顶级域名足介业品牌战略发展的出耍内容，其申沽费很高 (18 万美元），井且在 2013 年开始启用。目前已有一些由两个汉字组成的中文的顶级域名出现了，例如，尚城、公口」、 新闻等。然而中文顶级域名并未获得广泛的使用（可能是使用不太方便吧）。 在国家顶级域名下注册的二级域名均由该国家自行确定。例如，顶级域名为jp的日本， 将其教育和企业机构的二级域名定为 ac 和 co, 而不用 edu 和 com 。 我国把二级域名划分为＂类别域名“和“行政区域名“两大类。 ”类别域名“共 7 个，分别为： ac （科研机构）， com （工、商、金融等企业）， edu （中国的教育机构），gov （中国的政府机构）， mi l （中国的国防机构）， ne t（提供互联网络 服务的机构）， org（非营利性的组织）。 “行政区域名“共 34 个，适用于我国的各省、自治区、直辖市。例如： bj（北京市）， j s （江苏省），等等。 关于我国的互联网络发展现状以及各种规定（如申请域名的手续），均可在中国互联网 网络信息中心 CNNIC 的网址上找到 (W-CNNIC] 。 用域名树来表示互联网的域名系统是最清楚的。图 6-1 是互联网域名空间的结构，它实 (i)注：实际上． I司家顶级域名也包括某些地区的域名．如我国的香港特~ (hk) 和台湾省 (1w) 也都是 ccTLD 里面的顶 级域名。此外．同家顶级域名可以使用．个国知'.I 己的文字。例如．中国可以有 “cn” 、”中囚”和繁体字的 “I1,·“ 这＿，．种不 同形式的域名． • 263 •"}
{"doc_id": "network", "page": 275, "text": "际上是一个倒过来的树，在最上面的是根，但没有对应的名字。根下面一级的节点 I，就是砓 高一级的顶级域名（由于根没有名字，所以在根下面一级的域名就叫作顶级域名）。顶级域 名可往下划分子域，即二级域名。再往下划分就是三级域名、四级域名，等等。图 6-1 列举 了一些域名作为例子。凡是在顶级域名 com 下注册的弟位都获得f一个二级域名。图中给 出的例子有：中央电视台 cc tv, 以及 IBM 和华为等公司。在顶级域名 en （中国）下面举出 了几个二级域名，如： bj, edu 以及 com 。在某个二级域名下注册的单位就可以获得一个三级 域名。图中给出的在 edu 下面的三级域名有：ts i nghua （消华大学）和pku （北京大学）。一 旦某个单位拥有了一个域名，它就可以自己决定是否要进一步划分其下屈的子域，并且不必 由其上级机构批准。图中 cc tv （中央电视台）和ts i n ghua （清华大学）都分别划分了自己的 下一级的域名 mai l 和 WWW （分别是三级域名和四级域名） （2，。域名树的树叶就是单台计算 机的名字，它不能再继续往下划分子域了。 顶级域名 二级域名 三级域名 四级域名 努耍勹哭寀窊… cn 》K … l\\.`hu菜C1)二1 maII …吓`'m 二·· pku  图 6-1 互联网的域名空间 应当注意，虽然中央电视台和消华大学都各有一台计算机取名为 ma 仆，但它们的域名 并不一样，因为前者是 mail. cc tv.com, 而后者是 ma il.ts i n ghua.edu.cn 。因此，即使在世界上 还有很多单位的计算机取名为 mai l, 但是它们在互联网中的域名都必须是唯一的。 这里还要强调指出，互联网的名字空间是按照机构的组织来划分的，与物理的网络无 关，与 IP 地址中的“子网”也没有关系。 6.1.3 域名服务器 上面讲述的域名体系是抽象的。但具体实现域名系统则是使用分布在各地的域名服务 器。从理论上讲，可以让每一级的域名都有一个相对应的域名服务器，使所有的域名服务器 构成和图 6-] 相对应的“域名服务器树”的结构。但这样做会使域名服务器的数量太多，使 域名系统的运行效率降低。因此 DNS 就采用划分区的办法来解决这个问题。 一个服务器所负责管辖的（或有权限的）范围叫作区(zone) 。各单位根据具体情况来划 分自己管辖范围的区。但在一个区中的所有节点必须是能够连通的。每一个区设置相应的权 限域名服务器(au t ho rita ti ve name server), 用来保存该区中的所有主机的域名到 lP 地址的映 射。总之， DNS 服务器的管辖范围不是以＂域”为单位，而是以“区”为单位的。区是 DNS ＠注：根据［M 囚GCl94]. 对十树这样的数据结构，它的 node 应当译为“节点”（小是结点）． ＠注·为了便于记忆，人们愿意把用作邮什服务器的计轩机取名为 ma i l ，曲把川作网站脏务器的计箕机取名为 wW\\Ve • 264 •"}
{"doc_id": "network", "page": 276, "text": "服务器实际管辖的范围。区可能等于或小于域，但一定不能大于域。 图 6-2 是区的不同划分方法的举例。假定 abc 公司有下属部门 x 和y，部门 x 下面又分三 个分部门 U, V 和 W, 而y下面还有其下屈部门t。图 6-2(a) 表示 abc 公司只设一个区 abc.com 。 这时，区 abc.com 和域 abc.com 指的是同一件事。但图 6-2(b) 表示 abc 公司划分了两个区 （大的公司可能要划分多个区）： abc.com 和y.abc.com 。这两个区都隶属于域 abc.com, 都 各设置了相应的权限域名服务器。不难看出，区是＂域”的子集。 根 -----1----- org com edu  -·:·/~............ ~r............,:~  f域 abc.com 区 abccom9已〉＼ ; \\  会．．．今．．．令噜．．．．．．．...今·寻．．噜．．．．．．．．．．．．．．．．．．．．．．．．． (a)  根 ------1----- org com  区勹om ••••••••••••••••••••••••••••••••••••••••••••••••••••  (b)  图 6-2 DNS 划分区的举例 图 6-3 以图 6-2(b) 中公司 abc 划分的两个区为例，给出了 DNS 域名服务器树状结构图。 这种 DNS 域名服务器树状结构图可以更准确地反映出 DNS 的分布式结构。在图 6-3 中的每 一个域名服务器都能够进行部分域名到 rP 地址的解析。当某个 DNS 服务器不能进行域名到 IP 地址的转换时，它就设法找互联网上别的域名服务器进行解析。 根域名服务器 :  ····························•······················=  --陨级域名服务器 2芒：昙：已 竺巴：：：：巴l 竺2;：：芒」… •·.  权限域名服务器 品；。矗」-t-- abc 公司有两个 权限域名服务器 心；二I]向Jy ',  图 6-3 树状结构的 DNS 域名服务器 从图 6-3 可看出，互联网上的 DNS 域名服务器也是按照层次安排的。每一个域名服务 器都只对域名体系中的一部分进行管辖。根据域名服务器所起的作用，可以把域名服务器划 分为以下四种不同的类型： (I)根域名服务器 (roo t name server): 根域名服务器是最高层次的域名服务器，也是最 重要的域名服务器。所有的根域名服务器都知道所有的顶级域名服务器的域名和 RP 地址。根 域名服务器是最重要的域名服务器，因为不管是哪一个本地域名服务器，若要对互联网上任 何一个域名进行解析（即转换为 IP 地址），只要自己无法解析，就首先要求助于根域名服务 • 265 •"}
{"doc_id": "network", "page": 277, "text": "器。假定所有的根域名服务器都瘫痪了，那么整个互联网中的 DNS 系统就无法工作。全世界 的根域名服务器只使用 13 个不同 IP 地址的域名，即 a.roo tservers.ne t, b.rootservers.ne t,…,  m.rootservers. ne t。每个域名下的根域名服务器由专门的公司或美国政府的某个部门负责运营。 但诮注意，虽然互联网的根域名服务器总共只有 13 个域名，但根域名服务器并非仅由 13 台 机器所组成（如果仅仅依靠这 13 台机器，根本不可能为全世界的互联网用户提供令人满意 的服务）。实际上，在互联网中是由 13 套装置 (13 i ns t allati ons, 也就是 13 套系统）构成这 13 组根域名服务器的 [W-ROOT] 。每一套装置在很多地点安装根域名服务器（也可称为镜像 根服务器），但都使用同一个域名。负贵运营根域名服务器的公司大多在美国，但所有的根 域名服务器却分布在全世界。为了提供更可靠的服务，在每一个地点的根域名服务器往往由 多台机器组成（为了安全起见，这些根域名服务器的具体位置是严格保密的，不对外开放参 观）。现在世界上大部分 DNS 域名服务器，都能就近找到一个根域名服务器查询 lP 地址 （现在这些根域名服务器都已增加了 1Pv6 地址）。为了方便，人们常用从 A 到 M 的前 13 个 英文字母中的一个，来表示某组根域名服务器。截至 2021 年 3 月 24 日，全球共有 1375 个 根域名服务器在运行，其中在我国的共有 37 个（分布在北京(8 个）、上海、杭州（2 个）、武 汉（2 个）、贵阳、重庆、广州、西宁 (3 个）、郑州（2 个）、香港(7个）、澳门 (2) 、台北 (7 个））。 由千根域名服务器采用了任播(an y cas t)技术 L＇，因此当 DNS 客户向某个根域名服务器的 lP 地址发出查询报文时，互联网 L 的路由器就能找到离这个 DNS 客户砐近的一个根域名服 务器。这样做不仅加快了 DNS 的查询过程，也更加合理地利用了互联网的资源。 必须指出，目前根域名服务器在全球的分布仍然是很不均衡的。在某些地区根域名服 务器还较少，这就影响了上网的速率。 需要注意的是，在许多悄况下，根域名服务器并不直接把待查询的域名直接转换成 1P 地址（根域名服务器也没有存放这种信息），而是告诉本地域名服务器下一步应当找哪一个 顶级域名服务器进行查询。 由于根域名服务器在 DNS 中的地位特殊，因此对根域名服务器有许多具体的要求．如 必须能够运行某些程序等(RFC 7720] 。 (2) 顶级域名服务器（即 TLD 服务器）：这些域名服务器负责管理在该顶级域名服务器 注册的所有二级域名。当收到 DNS 杳询请求时，就给出相应的回答（可能是最后的结果， 也可能是下一步应当找的域名服务器的 IP 地址）。 (3) 权限域名服务器：这就是前面已经讲过的负贲一个区的域名服务器。当一个权限域 名服务器还不能给出最后的查询回答时，就会告诉发出查询请求的 DNS 客户，下一步应当 找哪一个权限域名服务器。例如在图 6-2(b) 中，区 abc.com 和区y.abc.com 各设有一个权限 域名服务器。 (4) 本地域名服务器(local name server): 木地域名服务器并不屈于图 6-3 所示的域名服 务器层次结构，但它对域名系统非常正要。当一台主机发出 DNS 查询诮求时，这个查询请 求报文就发送给本地域名服务器。由此可看出本地域名服务器的重要性。每一个互联网服务 提供者 ISP, 或一个大学，甚至一个大学里的系，都拥有一个本地域名服务器，本地域名服 务器跷用户较近，一般不超过几个路由器的距离。当所要查询的主机也屈千同一个本地 ISP ＠注：任播的 IP 数据报的终点是一组仕不同地点的 UL. 但具钉相同的 IP 地址。 IP 数枢报父付离源·'?垃近的一台上机． • 266 •"}
{"doc_id": "network", "page": 278, "text": "时，该本地域名服务器立即就能将所查询的主机名转换为它的 IP 地址，而不面要 14 去询问 其他的域名服务器。 为了提高域名服务器的可靠性， DNS 域名服务器都把数据复制到儿个域名服务器来保 存，其中的一个是主域名服务器(mas t er name server), 其他的足辅助域名服务器(secondary name server) 。当主域名服务器出故陌时，辅助域名服务器可以保证 DNS 的查询工作不会中 断。主域名服务器定期把数据复制到辅助域名服务器中，而更改数据只能在土域名服务器中 进行。这样就保证了数据的一致性。 下而简单讨论一下域名的解析过程。这里要注意两点、 0 第一，主机向本地域名服务器的杳询一般都采用递归查询(recurs i ve q ue ry)。所讷递归查 询就是：如果主机所询问的本地域名服务器不知道被查询域名的 IP 地址，那么本地域名服 务器就以 DNS 客户的身份，向其他根域名服务器继续发出查询悄求报文（即替该上机继续 查询），而不是让该主机自已进行下一步的查询。因此，递归位询返回的众询结果或者是所 要查询的 lP 地址，或者是报错，表示无法查询到所需的 IP 地址。 第二，本地域名服务器向根域名服务器的杏询迪常采用迭代查询（itera ti ve q ue ry)。迭代 查询的特点是这样的：当根域名服务器收到本地域名服务器发出的迭代介询请求报文时，要 么给出所要查询的 IP 地址，要么告诉本地域名服务器：“你下·步应当向哪一个域名服务器 进行查询＂。然后让本地域名服务器进行后续的查询（而不是替本地域名服务器进行后续的 查询）。根域名服务器通常是把自已知道的顶级域名服务器的 IP 地址告诉本地域名服务器， 让本地域名服务器内向顶级域名服务器杳询。顶级域名服务器在收到本地域名服务器的查询 诮求后，要么给出所要查询的 IP 地址，要么告诉本地域名服务器下一步／立节向哪一个权限域 名服务器进行查询，本地域名服务器就这样进行迭代查询。圾后，知道了所耍解析的域名的 IP 地址，然后把这个结果返回给发起查询的上机。当然，本地域名服务器也可以采用递归 查询，这取决千垃初的查询诮求报文的设置要求使用哪·种查询方式。 图 6-4 用例了说明了这两种查询的区别。 根域名）以务器 顶级域名限钮 ］．．一环碌厂： 根坡名服务器 顶级坡名 1员务器 dns.com  ~II衫／°; 1. 。 1-....1 .·. `...... ` · ·今·············今．令．．．．．．．．金· 本地域名脱务器 权限成名服务 dns.xyz.com dns.abc.com  递归 ll卢己一五王查询。 本地城名服务捎 权限域名服务 dn~.xyz.com dns.obc.com  心二三 三 I  I 一 m.xyz..com m.X)'Z .com  (a) 个地域名服务器采用迭代ft询 (b) 本地域名脱务器采用递＂介询 图 6-4 DNS Jt询举例 假定域名为 m.xy z.com 的主机想知逍另一台主机（域名为y.abc.com) 的 IP 地址。例如， • 267 •"}
{"doc_id": "network", "page": 279, "text": "主机 m.x y z.com 打仅发送邮件给上机y.abc.com 。这时就必须知道主机y.abc.com 的 IP 地址。 下面是图 6-4(a) 的几个介询步骤： 0 主机 m.x y z.com 先向其本地域名服务器 dns.x y z.com 进行递归令询。 0 本地域名服务器采用迭代杏询。它先向－·个根域名服务器查询。 0 根城名服务器告诉本地域名服务器，下一次／立查询的顶级域名服务器 dns.com 的 IP 地址。 0 本地域名服务器向顶级域名服务器 dos.com 进行杏询。 0 顶级域名服务器 dns 噜 com 告诉本地域名服务器，下一次应介询的权限域名服务器 dns.abc.com 的 IP 地址。 0 本地域名服务器向权限域名服务器 dns.abc.com 进行查询。 0 权限域名服务谣 dns.abc.com 告诉本地域名服务器，所查询的主机的 IP 地址。 ＠本地域名服务器垃后把查询结果告诉主机 m.x yz.com 。 我们注＄（到这 8 个步骤总共要仗用 8 个 UDP 用户数据报的报文。本地域名服务器经 过飞久迭代杏询后，从权限域名服务器 dns.abc.com 得到了主机y.abc 令 com 的 lP 地址，垃后 把结果返回给发起查询的主机 m.xyz.com. 图 6-4(b) 足本地域名服务器采用递归查询的情况。在这种情况下，本地域名服务器只 需向根域名服务器查询一次，后面的几次查询都是在其他几个域名服务器之间进行的（步 骤 0 至 0) 。只是在步骤 0 ，本地域名服务器从根域名服务器得到了所需的 IP 地址。垃后 在步骤 0 ，本地域名服务器把代询结果告诉主机 m.x yz.com 。整个的杏询也是使用 8 个 UDP 报文。 为了提，灯 DNS 许询效率，并减轻根域名服务器的负荷和减少互联网上的 DNS 查询报 文数忧，在域名服务器中广泛地使用了高速缓存（有时也称为高速缓存域名服务器）。高速 缓存用来存放垃近开询过的域名以及从何处获得域名映射·1信息的记求。 例如，在图 6-4(a) 的杳询过程中，如果在不久前已经有川户查询过域名为y.abc.com 的 IP 地址，那么木地城名服务器就不必向根域名服务器重新究询y.abc.com 的 IP 地址，而是 直桵把高速缓存中存放的上次杏询结果（即y.abc.com 的 IP 地址）告诉用户。 假定本地域名服务器的缓存中并没有y.abc.com 的 IP 地址，而是存放肴顶级域名服务器 dns.com 的 IP 地址，那么本地域名服务器也可以不向根域名服务器进行查询，而是直接向 com 顶级域名服务器发送杳询讲求报文。这样不仅可以大大减轻根域名服务器的负荷，而且 也能够使 h联网上的 DNS :6.询请求和回答报文的数：止大为减少。 由千名字到地址的绑定寸I· 不经常改变，为保持高速缓存中的内容正确，域名服务器应 为每项内容设岂计时祸并处理超过合理时间的项 H （例如，每个项目只存放两天）。当域名 服务器已从缓存中删去某项信息后又被讲求查询该项信息，就必须币．新到授权管理该项的域 名服务器中荻取绑定信息。当权限域名服务器回答·个查询请求时，在响应中都指明绑定有 效存在的时 1司侦。增加此时间侦可减少网络开销，而减少此时间值可提高域名转换的准确性。 不但在本地域名服务器中盂疫高速缓存，在t机中也很需要。许多主机任启动时从本 (i)注：眈射(ma ppi ng)指两个从合几尔之间的．忡付J勺规则． ＠注：绑定(bi nd i ng)指 个对仗（或l岈行）与其某 H灶性让 :r. 某仲联系的过仅 • 268 •"}
{"doc_id": "network", "page": 280, "text": "地域名服务器下载名字和地址的全部数据库，维护存放自己蚊近使用的城名的高速缓存，井 且只在从缓存中找不到名字时才使川域名服务器。维护本地域名服务器数据库的上机自然应 该定期地检查域名服务器以获取新的映射信息，而且主机必须从缓存中删掉无效的项。由于 域名改动并不频繁，大多数网点不油花太多粕力就能维护数据库的·致性。 6.2 文件传送协议 6.2. l FTP 概述 文件传送协议 FTP (File Transfer Protocol) [RFC 959, STD9] 曾是互联网 视知讲解 上使用得最广泛的文件传送协议。 FTP 提供交互式的访问，允许客户指明文件的类型与格式 （如指明是否使用 ASCII 码），片允许文件具有存取权限（如访问文件的用户必须经过授权， 并输入有效的门令）。 FTP 屏蔽了各计算机系统的细节，因而适合千在异构网络中任意计邓 机之间传送文件。 在互联网发展的早期阶段，用 FTP 传送文件约占整个托联网的迪信贵的三分之一，而 由电子邮件和域名系统所产生的通估屈远小千 FTP 所产生的通信战。只是到了 1995 年， WWW 的通信扯才首次超过了 FTP 。 在下面 6.2.2 和 6.2.3 节分别介绍基千 TCP 的 FTP 和基于 UDP 的简单文件传送协议 TFTP, 它们都是文件共享协议中的一人类，即复制整个文件，其特点是：若投存取一个义件，就必 须先获得一个本地的文件副本。如果要修改文件，只能对文件的副本进行修改，然后再将修 改后的文件副本传回到原节点。 文件共享协议中的另一大类是联机访问 (on-l i ne access) 。联机访 I司意味沿允许多个程序 同时对一个文件进行存取。和数据库系统的不同之处是用户不油要调用一个特殊的客户进程， 而是由操作系统提供对远地共亨文件进行访问的服务，就如同对本地文件的访问一样。这就 使用户可以川远地文件作为输入和输出来运行任何应用程序，而橾作系统中的义件系统则提 供对共享义件的透明存取。透明存取的优点是：将原来片j于处理本地文件的应川程序用来处 理远地文件时，不需要对该应用程｝i廿故明显的改动。屈f·文件共享协议的有网络文件系统 NFS (Network Fi le System) [COME06] 。网络文件系统 NFS 蚊初是在 UNIX 操作系统环境卜． 实现文件和门求共享的。 NFS 可使本地计符机共享远地的资源，就像这些资源在本地一样。 由-f NFS 原先是美国 SUN 公司在 TCP/IP 网络上创建的，因此目前 NFS 主要应用在 TCP八 P 网络上。然而现在 NFS 也可在 OS/2, MS-Windows, Net Ware 等操作系统上运们。 NFS 还没 有成为互联网的正式标准。经过儿次修订更新，现在的砐新版本 (NFSv4) 是 2015 年 3 月 发布的建议标准[RFC 7530] 。限千篇幅，本书 4；讨论 NFS 的详细工作过程。 6.2.2 FTP 的基本工作原理 网络环境中的一项基本应用就姑将文件从台计算机中复制到另台可 能相距很远的计笃机中。初看起来，在两台主机之间传送文件是很简单的事 悄。其实这往往非常困难。原因是众多的计邪机厂椭研制出的文件系统多达 数百种，且差别很大。经常遇到的问题是： (I) 计符机存储数据的格式不同。 (2) 文件的目录结构和文件命名的规定不同。 (3) 对于相同的文件存取功能，橾作系统使用的命令不同。 视桢讲解 • 269 •"}
{"doc_id": "network", "page": 281, "text": "(4) 访问控制方法不同。 文件传送协议 FTP 只提供文件传送的一些基本的服务，它使用 TCP 可靠的运输服务。 FTP 的主要功能是减少或消除在不同操作系统下处理文件的不兼容性。 FTP 使用客户服务器方式。 个 FTP 服务器进程可同时为多个客户进程提供服务。 FTP 的服务器进程由荫大部分组成： 个主进程，负责接受新的请求；另外有若干个从属进程， 负责处理单个诸求。 主进程的工作步骤如下： (I) 打开熟知端口（端口号为 21), 使客户进程能够连接上。 (2) 等待客户进程发出连接诮求。 (3) 启动从屈进程处理客户进程发来的请求。从屈进程对客户进程的请求处理完毕后即 终止，但从屈进程在运行期间根据盂要还可能创建其他一些千进程。 (4) 回到等待状态，继续接受其他客户进程发来的诸求。主进程与从屈进程的处理是并 发进行的。 FTP 的工作估况如图 6-5 所示。图中的椭圆圈表示在系统中运行的进程。图中的服务器 端有两个从屈进程：控制进程和数据传送进程。为简单起见，服务器端的主进程没有画上． 客户端除了控制进程和数据传送进程外，还有一个用户界而进程用来和用户接门。 在进行文件传输时， FTP 的客户和服务器之间要建立两个并行的 TCP 连接：“控制连接” 和“数据连接＂。控制连接在整个会话期间一直保持打开， FTP 客户所发出的传送请求，通 过控制连接发送给服务器端的控制进程，但控制连接并不用来传送文件。实际用于传输文件 的是“数据连接＂。服务器端的控制进程在接收到 FTP 客户发送来的文件传输请求后就创建 “数据传送进程”和“数据连接”，用来连接客户端和服务器端的数据传送进程。数据传送 进程实际完成文件的传送，在传送完毕后关闭“数据传送连接”并结束运行。巾千 FTP 使 用了一个分离的控制连桵，因此 FTP 的控制信息是带外(ou t of band) 传送的。 FTP 客）、，沿 TCP 数拭连接 FTP 服务器端 图 6-5 FTP 使用的两个 TCP 连接 当客户进程向服务器进程发出建立连接请求时，要寻找连接服务器进程的熟知端口 21, 同时还要告诉服务器进程自己的另一个端口号码，用于建立数据传送连接。接肴，服务器进 程用自己传送数枢的熟知端口 20 与客户进程所提供的端口号建立数据传送连接。由千 FTP 使用了两个不同的端口号，所以数据连接与控制连接不会发生混乱。 使川两个独立的连桵的主要好处是使协议更加简单和更容易实现，同时在传输文件时 还可以利用控制连接对文件的传输进行控制。例如，客户发送“请求终止传输＂。 FTP 并非对所有的数据传输都是最佳的。例如，计＄印机 A 上运行的应用程序要在远地 计算机 B 的一个很大的文件末尾添加一行信息。若使用 FTP, 则应先将此文件从计算机 B • 270 •"}
{"doc_id": "network", "page": 282, "text": "传送到计算机 A, 添加上这一行信息后，再用 FTP 将此文件传送到计算机 B, 来回传送 这样大的文件很花时间。实际上这种传送是不必要的，因为计算机 A 并没有使用该文件的 内容。 然而网络文件系统 NFS 则采用另一种思路。 NFS 允许应用进程打开一个远地文件，并 能在该文件的某一个特定的位置上开始读写数据。这样， NFS 可使用户只复制一个大文件 中的一个很小的片段，而不需要复制整个大文件。对于上述例子，计符机 A 中的 NFS 客户 软件，把要添加的数据和在文件后面写数据的诸求一起发送到远地的计算机 B 中的 NFS 服 务器， NFS 服务器更新文件后返回应答信息。在网络上传送的只是少量的修改数据。 6.2.3 简单文件传送协议 TFTP 扫一打 TCP/IP 协议族中还有一个简单文件传送协议 TFTP (Trivial File Trans fer  Pro tocol), 它是一个很小且易于实现的文件传送协议 [RFC 1350, STD33] 。 虽然 TFTP 也使用客户服务器方式，但它使用 UDP 数据报，因此 TFTP 衙 视频讲解 要有自己的差错改正拈施。 TFTP 只支持文件传输而不支待交互。 TFTP 没有一个庞大的命 令集，没有列目录的功能，也不能对用户进行身份鉴别。 TFTP 的主要优点有两个。第一， TFTP 可用于 UDP 环境。例如，当需要将程序或文件同 时向许多机器下载时就往往衙要使用 TFTP 。第二， TFTP 代码所占的内存较小。这对较小的 计算机或某些特殊用途的设备是很重要的。这些设备不袖要硬盘，只盂要固化了 TFTP 、 UDP 和 IP 的小容扯只读存储器即可。当接通电源后，设备执行只读存储器中的代码，在网络上广 播一个 TFTP 请求。网络上的 TFTP 服务器就发送响应，其中包括可执行二进制程序。设备收 到此文件后将其放入内存，然后开始运行程片。这种方式增加了灵活性，也减少了开销。 TFTP 的主要特点是： (I)每次传送的数据报文中有 512 字节的数据，但最后一次可不足 512 字节 c (2) 数据报文按序编号，从 l 开始。 (3) 支持 ASCII 码或二进制传送。 (4) 可对文件进行读或写。 (5) 使用很简单的首部。 TFTP 的工作很像停止等待协议（见第 5 盎 5 .4 .1 节）。发送完一个文件块后就等待对方 的确认，确认时应指明所确认的块编号。发完数据后在规定时间内收不到确认就要重发数据 PDU 。发送确认 PDU 的一方若在规定时间内收不到下一个文件块，也要重发确认 PDU 。这 样就可保证文件的传送不致因某一个数据报的丢失而告失败。 在一开始工作时。 TFTP 客户进程发送一个读诮求报文或写请求报文给 TFTP 服务器进 程，其熟知端口号码为 69 。 TFTP 服务器进程要选择一个新的端口和 TFTP 客户进程进行通 信。若文件长度恰好为 512 字节的整数倍，则在文件传送完毕后，还必须在奻后发送一个只 含首部而无数据的数据报文。若文件长度不是 512 字节的整数倍，则砓后传送数据报文中的 数据字段一定不满 512 字节，这正好可作为文件结束的标志。 扫一扫 噩 6.3 远程终端协议 TELNET TELNET 是一个简单的远程终端协议 [RFC 854, STD8] 。用户用 视频讲蛁 • 271 •"}
{"doc_id": "network", "page": 283, "text": "TELNET 就可在其所在地通过 TCP 连接注册（即登录）到远地的另毛台主机上（使用主机 名或 IP 地址）。 TELNET 能将用户的击键传到远地主机，同时也能将远地主机的输出通过 TCP 连接返回到用户屏幕。这种服务是透明的，因为用户感觉到好像键盘和显示器是直接 连在远地主机上的。因此， TELNET 又称为终端仿真协议。 TELNET 并不复杂，以前应 FIl 得很多。现在由千计算机的功能越来越强，用户已较少 使用 TELNET 了，可作为历史资料了解一下即可。 TELNET 也使用客户服务器方式。在本地系统运行 TELNET 客户进程，而在远地主机 则运行 TELNET 服务器进程。和 FTP 的情况相似，服务器中的主进程等待新的诮求，并产 生从屈进程来处理每一个连接。 TELNET 能够适应许多计算机和橾作系统的差异。例如，对于义本中一行的结束，有 的系统使用 ASCII 码的同车(CR), 有的系统使用换行(LF), 还有的系统使用两个字符，回车 换行(CR-LF) 。又如，在中断一个程序时，许多系统使用 Control-C (AC), 但也有系统使用 ESC 按键。为［适应这种差异， TELNET 定义了数据和命令应怎样通过互联网。这些定义 就是所诮的网络虚拟终端 NVT (Ne twork Virtual Termi nal) 。图 6-6 说明了 NVT 的意义。客户 软件把用户的击键和命令转换成 NVT 格式，并送交服务器。服务器软件把收到的数据和命 令从 NVT 格式转换成远地系统所需的格式。向用户返回数据时，服务器把远地系统的格式 转换为 NVT 格式，本地客户再从 NVT 格式转换到本地系统所盐的格式。 TELNET  存户端 TELNET  服务渊瑞 使用客户端的格式 ．（如 ll NVT 格式 仗川服务器端的格式 图 6-6 TELNET 使川网络庙拟终端 NVT 格式 NVT 的格式定义很简巾。所有的汕信都使用 8 位一个宁节。打运转时， NVT 使用 7 位 ASCll 码传送数据，而吤吓位置 1 时用作控制命令。 ASCII 码共有 95 个可打印字符（如字 母、数字、标点符号）和 33 个拧制字符。所有可打印字符在 NVT 中的慈义和在 ASCII 码 中一样。但 NVT 只使用了 ASCII fi½的控制字符中的几个。此外， NVT 还定义了两字符的 CR-LF 为标准的彴结束控制符。当用户键入回车按键时， TELNET 的客户就把它转换为 CR-LF 再进行传输，而 TELNET 服务器婓把 CR-LF 转换为远地机器的行结束字符。 TELNET 的选项协商(Opti on Neg o ti a ti on) 使 TELNET 客户和 TELNET 服务器可商定使 用更多的终端功能，协商的双方是平等的。 6.4 万维网 WWW 6.4.1 万维网概述 万维网 WWW (World Wide Web) 是一个大规模的、联机式的信息储藏所，英文简称为 Web, 而不是什么特殊的计算机网络。万维网用链接的力法能非常方便地从互联网上的一个 站点访问另一个站点（也就是所罚的“链接到另一个站点”），从而主动地按面获取丰富的信 • 272 •"}
{"doc_id": "network", "page": 284, "text": "息。图 6-7 说明了万维网提供分布式服务的特点。 维曰丿／冷，占 B％丿 月维网站点 D )j维网站点 C 图 6-7 万维网提供分布式服务 图 6-7 画出了四个万维网上的站点，它们可以相隔数干公里，但都必须连接在互联网上。 每个万维网站点都存放了许多文档。在这些文档中有一些地方的文字是用特殊方式显示的 （例如用不同的颜色，或添加了下划线），而当我们将鼠标移动到这些地方时，鼠标的箭头 就变成了，．只手的形状。这就表明这些地方有一个链接 (l i nk) （这种链接有时也称为超链 hyper! i nk), 如果我们在这些地方点击鼠标左键，就可从这个文档链接到可能相隔很远的另 一个文档。经过一定的时延（几秒钟、几分钟甚至更长，取决千所链接的文档的大小和网络 的拥塞悄况），在我们的屏幕上就能将远方传送过来的文档显示出来。例如，站点 A 的某个 文档中有两个地方有链接。点击链接 0 可链接到站点 B 的某个文档，点击 e 可链接到站点 C 。 站点 B 的文档也有两个链接。点击链接 0 可链接到站点 D, 点击链接0 可链接到站点 C, 但 站点 C 的这个文档已无其他的链接了。站点 D 的文档中有两个链接。点击0 可链接到站点 A, 点击 O 可以链接到存储在本站点硬盘中的文档。 正是由于万维网的出现，使计算机的操作发生 r 革命性的变化。不必在键盘上输入复 杂而难以记忆的命令，而改用鼠标点击一不屏砾上的链接，这就使互联网从仅由少数计算机 专家使用变为普通百姓也能利用的信息资源。万维网的出现使网站数按指数规律增长，因而 成为互联网发展中的一个非常重要的里程碑。 万维网是欧洲粒子物理实验室的 Ti m Bemers-Lee 最初千 1989 年 3 月提出的。 1993 年 2 月，第一个图形界面的浏览器 (browser) 开发成功，名字叫作 Mosai c 。 1995 年著名的 Netscape Nav ig a t or 浏览器上市。目前流行的浏览器很多，如微软公司的 In terne t Explorer  （简称 IE), 谷歌公司的 Chrome 浏览器，腾讯公司的QQ浏览器，苹果公司的 Safari浏览 器，等等。 万维网是一个分布式的超媒体(h ypem,ed i a) 系统．它是超文本(h ype rtext)系统的扩充。所 讷超文本是指包含指向其他文档的链接的文本(tex t)。也就是说，一个超文本巾多个信息源 链接成，而这些信息源可以分布在世界各地，并且数目也是不受限制的。利用一个链接可使 用户找到远在异地的另一个文档，而这又可链接到其他的文档（依此类推）。这些文档可以 位于世界上任何一个接在互联网上的超文本系统中。超文本是万绯网的基础。 超媒体与超文本的区别是文档内容不同。超文本文档仅包含文本信息，而超媒体文档 还包含其他表示方式的信息，如图形、图像、声音、动画以及视频图像等． 分布式的和非分伯式的超媒体系统有很大区别。在非分布式系统中，各种信息都驻留 • 273 •"}
{"doc_id": "network", "page": 285, "text": "在单个计算机的磁盘中。山于各种义档都可从本地获得，闪此这些文档之间的链接可进行一 致性检奋。所以，一个非分布式超媒体系统能够保证所有的链接都是有效的和一致的。 万维网把大榄信息分布在整个可联网上。每台主机上的文档都独立进行管理。对这些 文档的增加、修改、删除或重新命名都不伽要（实际上也不可能）通知到互联网上成于上万 的节点。这样，万维网义档之间的链接就经常会不一致。例如，主机 A 上的文档 X 本米包 含了一个指向主机 B 上的文档 Y 的链接。若主机 B 的管理员在某日删除了文档 Y, 那么主 机 A 的上述链接显然就失效了（但是 B 并没有贡任必须通知 A) 。 万维网以客户服务器方式」作。上面所说的浏览器就是在用户主机上的万维网客户程 序。万维网文档所驻留的主机则运行服务器程序，因此这台主机也称为万维网服务器。客户 程序向服务器程序发出请求，服务器程序向客户程序送回客户所要的万维网文档。在一个客 户程序主窗口 K 昂示出的万维网文档称为页面(pa ge) 。 从以上所述可以看出，万维网必须解决以下几个问题： (I) 怎样标志分布在整个互联网上的万维网文档？ (2) 用什么样的协议来实现万维网上的各种链接？ (3) 怎样使不同作者创作的不同风格的万维网文档，都能在互联网上的各种主机上显示 出来，同时使用户清楚地知道在什么地方存在稽链接？ (4) 怎样使用户能够很方便地找到所需的信息？ 为了解决第一个问题，万维网使用统一资源定位符 URL (Un iform Resource Locator) 来标 志万维网上的各种文档，并使匈一个文档在整个互联网的范围内具有唯一的标识符 URL 。 为了解决上述的第二个问题，就要使万维网客户程序与万维网服务器程序之间的交互遵守严 格的协议，这就是超文本传送协议 HTTP (HyperText Transfer Pro t ocol) 。 HTTP 是一个应用层 协议，它使用 TCP 连接进行可靠的传送。为了解决上述的第三个问题，万维网使用超文本 标记语言 HTML (HyperText Markup Lang ua ge), 使得万维网页面的设计者可以很方便地用链 接从本页面的某处链接到互联网上的任何一个万维网页面，并且能够在自己的主机屏幕上将 这些页面显示出来。最后，用户可使用搜索工具在万维网上方便地查找所需的信息。 下面我们将进一步讨论上述亚要概念。 6.4.2 统一资源定位符 URL 1. URL 的格式 统一资源定位符 URL 是用来表示从互联网上得到的资源位置和访问这些资源的方法。 URL 给资源的位置提供一种抽象的识别方法，并用这种方法给资源定位。只要能够对资源 定位，系统就可以对资源进行各种橾作，如存取、更新、替换和查找其屈性。由此可见， URL 实际上就是在互联网上的资源的地址。只有知道了这个资源在互联网上的什么地方， 才能对它进行操作。显然，互联网上的所有资源，都有一个唯一确定的 URL 。 这里所说的“资源”是指在互联网上可以被访问的任何对象，包括文件目录、文件、 文档、图像、庄音等，以及与互联网相连的任何形式的数据。 UR..L 相当于一个文件名在网络范围的扩展。因此， URL 是与互联网相连的机器上的任 何可访问对象的一个指针。由千访问不同对象所使用的协议不同，所以 URL 还指出读取某 个对象时所使用的协议。 URL 的一般形式由以下四个部分组成： • 274 •"}
{"doc_id": "network", "page": 286, "text": "通常省略 （一 协议：／／主机名：端口／路 径 URL 最左边的协议指出使用何种协议来获取该万维网文档。现在最常用的协议就是 h ttp（超文本传送协议 HTTP), 其次是ftp（文件传送协议 FTP) 。在协议后面的 \".II\" 是规 定的格式，必须写上。 主机名是万维网文档所存放的主机的域名，通常以 WWW 开头，但这并不是硬性规定。 主机名用点分十进制的 IP 地址代替也是可以的。 主机名后面的＂：端口”就是端口号，但经常被省略掉。这是因为这个端口号通常就是 协议的默认端口号（例如，协议 HTTP 的默认端口号为 80), 因此就可以省略。但如不使用 默认端口号，那么就必须写明现在所使用的端口号。 砐后的路径可能是较长的字符串（其中还可包括若干斜线／），但有时也不需要使用。在 路径后面可能还有一些选项，这里不进行介绍了。 现在有些浏览器为了方便用户，在输入 URL 时，可以把最前面的 “http://\"甚至把主机 名最前面的 “www\" 省略，然后浏览器替用户把省略的字符添上。例如，用户只要键入 c trip .com, 浏览器就自动把未键入的字符补齐，变成 h ttp ://www.c t rip .com 。 下面我们简单介绍使用得最多的一种 URL, 即协议 HTTP 。 2. 使用 HTTP 的 URL 使用协议 HTTP 的 URL 最常用的形式是把“：端口“省略： h ttp://主机名／ 路 径 若再将 URL 中的路径省略，则 URL 就指明互联网上的某个主页（home p a g e) 。主页是 个很亟要的概念，它可以是以下几种情况之一： (1)一个 WWW 服务器的最高级别的页面。 (2) 某一个组织或部门的一个定制的页面或目录。从这样的页面可链接到互联网上的与 本组织或部门有关的其他站点。 (3) 由某一个人自己设计的描述他本人情况的 WWW 页面。 例如，要查有关清华大学的信息，就可先进入到清华大学的主页，其 URL 为觅 http://www.tsinghua.edu.cn  这里省略了默认的端口号 80 。我们从清华大学的主页入手，就可以通过许多不同的链 接找到所要查找的各种有关渚华大学各个部门的信息。 更复杂一些的路径是指向层次结构的从属页面。例如： ht 1p ://ww-.v.1si nghua.edu.cn/p ubl i sh/ne\"1hu/ne叭hu_cnt/fa cul ti es/i ndex.h tml `、J r- 主机域名 路径名 ＠注： Ts i nghua 是沾华大学创立时所用的拼音名字（那时拼音ts 和现在的汉语拼音字母q的发音一样）。由于国外都早已 知道 Ts i n ghua 这个名字，因此现在就不使用标准的汉语拼音qinghua. • 275 •"}
{"doc_id": "network", "page": 287, "text": "是清华大学的＂院系设四”页面的 URL 。注意：上面的 URL 中使用了指向文件的路径，而 文件名就是砓后的index. ht m 。后缀 h t m （有时可写为 h t ml) 表示这是一个用超文本标记语 言 HTML 写出的文件。 URL 的＂协议”和“主机名”部分，字母不区分大小写。但“路径”中的字符有时要 区分大小写。 用户使用 URL 并非仅仅能够访问万维网的页面，而且还能够通过 URL 使用其他的互联 网应用程序，如 FTP 或 USENET 新闻组等。更重要的是，用户在使用这些应用程序时，只 使用一个程）午，即浏览器。这显然是非常方便的。 扫一扫 6.4.3 超文本传送协议 HTTP 1. HTTP 的操作过程 蠲 协议 HTTP 定义了浏览器（即片维网客户进程）怎样向万维网服务器 视频讲解 请求万维网文档，以及服务器怎样把文档传送给浏览器。从层次的角度看， HTTP 是面向事 务的(transac ti on-or i en t ed)(I)应用层协议，它是万维网上能够可靠地交换文件（包括文本、声 音、图像等各种多媒体文件）的币要基础。请注意，协议 HTTP 不仅传送完成超文本跳转所 必需的信息，而且也传送任何可从互联网上得到的信息，如文本、超文本、声音和图像等。 万维网的大致工作过程如图 6-8 所示。 链桵到 URL的超链 服务器 www. tsinghua.cdu.cn  匾 ．．．．．．．．．．．．．建立 TCP 连接．．．．．．．．．．．．．． 霍卢|·严三王.··········=··  今一一．．．．．．．．．三 .............释放 TCP 连接．一争..一..…… 服务器 返回响应 图 6-8 万维网的工作过程 每个万维网网点都有一个服务器进程，它不断地监听 TCP 的端口 80, 以便发现是否有 浏览器（即万维网客户。请注意，浏览器和万维网客户是同义词）向它发出连接建立请求。 一旦监听到连接建立请求并建立了 TCP 连接之后，浏览器就向万维网服务器发出浏览某个 页面的诸求，服务器接着就返回所诮求的页面作为响应。服务器在完成任务后， TCP 连接 就被释放［。在浏览器和服务器之间的诮求和响应的交互，必须按照规定的格式和遵循—定 ＠汴．所谓事务(transacti on)就是指系列的信息交换，而这一系列的们息交换怂·一个不可分割的整体，也就是说．决么所 有的信息交换都完成令要么一次交换都不进行． • 276 •"}
{"doc_id": "network", "page": 288, "text": "的规则。这些格式和规则就是超文本传送协议 HTTP 。 HTTP 规定在 HTTP 客户与 HTTP 服务器之间的每次交且，都由一个 ASCIl 码串构成的 请求和一个类似的通用互联网扩充，即“类 MIME (MIME-li ke)\" 的响应组成。 HTTP 报文 通常都使用 TCP 连接传送。 用户浏览页面的方法有两种。一种方法是在浏览器的地址窗口中键入所要找的页面的 URL 。另一种方法是在某一个页面中用鼠标点击一个可选部分，这时浏览器会自动在互联网 上找到所要链接的页面。 HTTP 使用了面向连接的 TCP 作为运输层协议，保证了数据的可靠传输。 HTTP 不必考 虑数据在传输过程中被丢弃后又怎样被重传。但是，协议 HTTP 本身是无连接的。这就是说， 虽然 HTTP 使用了 TCP 连接，但通信的双方在交换 HTTP 报文之前不孟要先建立 HTTP 连 接。在 1997 年以前使用的是协议 HTTP/ 1. 0 [RFC 1945]. 现在普遍使用的升级版本是建议标 准 HTTP/ l.l [RFC 723 I] 。 2015 年以后，又有了新的建议标准 HTTP/2 [RFC 7540], 以及压 缩 HTTP 报文首部的建议标准 [RFC 7541] 。 协议 HTTP 是无状态的 (s t a teless) 。也就是说，同一个客户第二次访问同一个服务器上 的页面时，服务器的响应与第一次被访问时的相同（假定现在服务器还没有把该页面更新）， 因为服务器并不记得曾经访问过的这个客户，也不记得为该客户曾经服务过多少次。 HTTP 的无状态特性简化了服务器的设计，使服务器更容易支持大量并发的 HTTP 请求。 下面我们粗略估算一下，从浏览器请求一个万维网文档到收到整个文档所需的时间 （如图 6-9 所示）。用户在点击鼠标链接某个万维网文档时，协议 HTTP 首先要和服务器建 立 TCP 连接。这彻要使用三报文握手。当建立 TCP 连接的三报文握手的前两个报文完成后 （即经过了一个 RTT 时间后），万维网客户就把 HTTP 请求报文，作为建立 TCP 连接的三 报文握手中的第三个报文的数据，发送给万维网服务器。服务器收到 HTTP 请求报文后，就 把所请求的文档作为响应报文返回给客户。 发起 TCP 连接 HTTP 请求报文 万维网客户 |  一 1 万维网服务器 丿 叩l门科 1、、L1 以入 1} 传输文档的时间 <==3  整个文档收到 时间 时间 图 6-9 消求一个万维网文档所需的时间 从图 6-9 可看出，诸求一个万维网文档所袖的时间是该文档的传输时间（与文档大小成 正比）加上讷倍往返时间 RTI （一个 RTT 用千连接 TCP 连接，另一个 RTT 用于请求和接 收万维网文档。 TCP 建立连接的三报文握手的第三个报文段中的数据，就是客户对万维网 文档的请求报文）。 协议 HTTP/1 .0 的主婓缺点，就是每诸求一个文档就要有两倍 RTT 的开销。若一个主页 • 277 •"}
{"doc_id": "network", "page": 289, "text": "上有很多链接的对象（如图片等）盂要依次进行链接，那么母－次链接下载都导致 2 x RTT  的开销。另一种开销就是万维网客户和服务器每一次建立新的 TCP 连接都要分配缓存和变 量。特别是万维网服务器往往要同时服务千大觉客户的讷求，所以这种非持续连接会使万维 网服务器的负担很重。好在浏览器都能够打开 5 ~10 个并行的 TCP 连接，而每一个 TCP 连 接处理客户的一个请求。因此，使用并行 TCP 连接可以缩短响应时间。 协议 HTTP/1 .1 较好地解决J'这个问题，它使用了持续连接（pers i s t en t connec ti on) 。所谓 持续连接就是万维网服务器在发送响应后仍然在一段时间内保持这条连接，使同一个客户 （浏览器）和该服务器可以继续在这条连接上传送后续的 HTTP 请求报文和响应报文。这并 不局限千传送同一个页面上链接的文档，而是只要这些文档都在同一个服务器上就行。协议 HTTP/ I. I 的持续连接有两种工作方式，即非流水线方式(w ith ou t pip e lining)和流水线方式 (with pipelining).  非流水线方式的特点，是客户在收到前一个响应后才能发出下一个请求。因此，在 TCP 连接已建立后，客户每访问一次对象都要用去一个往返时间 RTT 。这比非待续连接要用去两 倍 RTT 的开销，节省了建立 TCP 连接所需的一个 RTT 时间。但非流水线方式还是有缺点的， 因为服务器在发送完一个对象后，其 TCP 连接就处于空闲状态，浪费了服务器资源。 流水线方式的特点，是客户在收到 HTTP 的响应报义之前就能够接茬发送新的请求报 文。千是一个接一个的请求报文到达服务器后，服务器就可连续发回响应报文。因此，使用 流水线方式时，客户访问所有的对象只需花费一个 RTT 时间。流水线工作方式使 TCP 连接 中的空闲时间减少，提高了下载文档效率。 最初网页是以文本为主，但很快发展到使用大猖的图片、音频和视频，并且对页面的 实时性要求也越来越高（如视频聊天或直播），这样就使得协议 HTTP/ 1.l已无法跟上互联 网的发展了。于是谷歌公司在 2009 年开发了软件 SPDY, 用来提高协议 HTTP/ 1.1的工作效 率。 IETF 在此基础上与谷歌合作完成了协议 HTTP/2, 而谷歌也停止了对 SPDY 的继续完善 工作。 协议 HTTP/2是协议 HTTP/1.1 的升级版本，其 HTTP 方法／状态码／语义等都没有改变， 其主要特点如下： (1) 我们知道， HTTP/I.I 具有流水线的工作方式。这就是在 TCP 连接建立后，客户可 以连续向服务器发出许多个请求，而不必等到收到一个响应后再发送下一个请求。但服务器 发回响应时必须按先后顺序排队，逐个地发送给客户。有时遇到某个响应迟迟不能发回，那 么排在后面的一些响应就必须等待很长的时间。 HTTP/2 把服务器发回的响应变成可以并行 地发回（使用同一个 TCP 连接），这就大大缩短了服务器的响应时间。 (2) 使用 HTTP/ 1. 1 时，当客户收到服务器发回的响应后，原来建立的 TCP 连接就释放 了。如果客户还要继续向该服务器发送新的诸求，就必须重新建立 TCP 连接。 HTTP/2 允许 客户复用 TCP 连接进行多个请求，这样就节省了 TCP 连续多次建立和释放连接所花费的时 间。 (3) HTTP/ 1.1的请求和响应报文是面向文本的(tex t -or i en t ed) 。当客户连续发送请求并受 到响应时，在 TCP 连接上传送的 HTTP 报文首部成为不小的开销。在这些首部中有很多字 段是重复的。为此， HTTP/2 把所有的报文都划分为许多较小的二进制编码的帧，并采用了 新的压缩算法，不发送重复的首部字段，大大减小了首部的开销，提高了传输效率。 因此，现在主流的浏览器都支持 HTTP/2 。但是，有的服务器还未来得及更新，仍然只 • 278 •"}
{"doc_id": "network", "page": 290, "text": "支持 HTTP/ I. I 。但 HTTP/2 是向后兼容的。当使用 HTTP/2的客户向服务器发出请求时，如 果服务器仍然使用 HTTP/ I. I,那么服务器仍然可以收到请求报文。在发回响应后，客户就 改用 HTTP/ I. I 与服务器进行交互。 2. 代理服务器 代理服务器(prox y server) 是一种网络实体，它又称为万维网高速缓存(Web cache) 。代理 服务器把砐近的一些请求和响应暂存在本地磁盘中。当新请求到达时，若代理服务器发现这 个请求与暂时存放的请求相同，就返同暂存的响应，而不需要按 URL 的地址再次去互联网 访问该资源。代理服务器可在客户端或服务器端工作，也可在中间系统上工作。下面我们用 例子说明它的作用。 设图 6-1 O(a) 是校园网不使用代理服务器的情况。这时，校园网中所有的计算机都通过 2 Mbit/s 专线链路 (R1-R2) 与互联网上的源点服务器建立 TCP 连接。因而校园网各计算机访 问互联网的通信量往往会使这条 2 Mbit/s 的链路过载，使得时延大大增加。 图 6-IO(b) 是校园网使用代理服务器的情况。这时，访问互联网的过程是这样的： (I)校园网的计算机中的浏览器向互联网的服务器诮求服务时，就先和校园网的代理服 务器建立 TCP 连接，并向代理服务器发出 HTTP 请求报文（见图 6-10 (b)中的 O) 。 (2) 若代理服务器已经存放了所诰求的对象，代理服务器就把这个对象放入 HTTP 响应 报文中返回给计算机的浏览器。 (3) 否则，代理服务器就代表发出请求的用户浏览器，与互联网上的源点服务器(or igi n server) 建立 TCP 连接（如图 6-IO(b) 中的＠所示），并发送 HTTP 请求报文。 二 浏览器 I  \\==  , .. -•  丘了~· (a) 不仗用代理服务器 \\  校园网的 代理服务器 -· b i lls' 芞平 喻． 。 ＿、天 丿 (b) 使用代理服务器 图 6-10 代理服务器的作用 (4) 源点服务器把所请求的对象放在 HTTP 响应报文中返回给校园网的代理服务器。 (5) 代理服务器收到这个对象后，先复制在自己的本地存储器中（留待以后用），然后 再把这个对象放在 HTTP 响应报文中，通过已建立的 TCP 连接（见图 6-IO(b) 中的 O), 返回 • 279 •"}
{"doc_id": "network", "page": 291, "text": "给请求该对象的浏览器。 我们注意到，代理服务器有时是作为服务器（当接受浏览器的 HTTP 请求时），但有时 却作为客户（当向互联网上的源点服务器发送 HTTP 诸求时）。 在使用代理服务器的悄况下，由千有相当大一部分通信址局限在校园网的内部，因此， 2 Mbit/s 专线链路 (R 叫心上的通信量大大减少，因而减小了访问互联网的时延。 以代理服务器方式构成的内容分发网络 CDN (Content Distribution Network)在互联网应 用中起到了很大的作用。最先使用 CDN 技术的是美国的 Akama i（阿卡迈）公司。 Akama) 公 司现在是全球最大的 CDN 乎台，是全球能够提供最大规模分发在线视频的服务商。目前 Akamai公司拥有 24 万台服务器， 3900 个位置节点，使全球的用户可以就近下载视频、音 频节目，或进行其他业务联系，而用户甚至根本不知道已经使用了 Akama) 提供的服务。现 在 Akamai与全球多家电信运营商建立了深度合作关系，所提供的通信流量高达每秒 40 TB,  颤 业务遍及 137 个国家和地区。 门一扫 3. HTTP 的报文结构 HTTP 有两类报文： (l)请求报文一从客户向服务器发送诸求报文，如图 6-ll(a) 所示。 (2) 响应报文－~从服务器到客户的回答，如图 6-1 l(b) 所示。 ，空格 回车换行 视频讲杆 芦妇 版本 II 状态码 II 短语 ICRLFI 状态行 首部字 1 二｝首部行 CRLF  实体主体 实体主体 （通常不用） （有些呐应报文不用） (a) 诸求报文 (b) 响应报文 图 6-11 HTTP 的报文结构 由千 HTTP 是面向文本的，因此在报文中的每一个字段都是一些 ASCII 码串，因而各 个字段的长度都是不确定的。 HTTP 请求报文和响应报义都是由三个部分组成的。可以看出，这两种报文格式的区别 就是开始行不同。 (I) 开始行，用千区分是请求报文还是响应报文。在诰求报文中的开始行叫作请求行 (Reques t -L i ne), 而在响应报文中的开始行叫作状态行(S ta tu s-L i ne) 。在开始行的三个字段之 间都以空格分隔开，朵后的 “CR\" 和 “LF\" 分别代表“回车”和“换行“。 (2) 首部行，用来说明浏览器、服务器或报文主体的一些信息。首部可以有好几行，但 也可以不使用。在每一个首部行中都有首部字段名和它的值，每一行在结束的地方都要有 “回车”和“换行”。整个首部行结束时，还有一空行将首部行和后面的实体主体分开。 (3) 实体主体(en tity bod y),在请求报文中一般都不用这个字段，而在响应报文中也可能 没有这个字段。 下面先介绍 HTTP 请求报文的一些主要特点。 • 280 •"}
{"doc_id": "network", "page": 292, "text": "请求报文的第一行“请求行“只有三个内容，即方法、请求资源的 URL, 以及 HTTP 的版本。 请注意：这里的名词“方法 ”(met hod) 是面向对象技术中使用的专门名词。所谓“方法” 就是对所请求的对象进行的操作，这些方法实际上也就是一些命令。因此，请求报文的类型 是由它所采用的方法决定的。表 6-1 给出了请求报文中常用的几种方法。 表 6-1 HTTP 请求报文的一些方法 方法（操作） 惹义 0盯ION 哨求一些选项的（九息 GET 请求读取由 URL 所标志的信息 HEAD 哨求读取由 URL 所标志的信息的首部 POST 给服务器添加倍息（例如，注释） PUT 在指明的 URL 下存储一个文档 DELETE 删除指明的 URL 所标志的资源 TRACE 用来进行环回测试的诘求报文 CONNECT 用于代理服务器 下面是 HTTP 的诸求报文的开始行（即请求行）的格式。请注意，在 GET 后面有一个 空格，接着是某个完整的 URL, 其后面又有一个空格，最后是 HTTP/ I. I 。 GET http ://www.x yz.edu.cn/d i r/ i ndex.h t m HTTP/1.1  下面是一个完整的 HTTP 请求报文的例子： GET /d i r/ i ndex. h t m HTTP/ 1. 1 ｛请求行使用了相对 URL} Hos t: www.x yz.edu.cn ｛此行是首部行的开始。这行给出主机的域名｝ Connec 豆on: close ｛告诉服务器发送完请求的文档后就可释放连接｝ User-A gen t: Moz i lla/5.0 ｛表明用户代理是使用火狐浏览器 F i re fo x} Acce pt -Lan gua ge: en ｛表示用户希望优先得到中文版本的文档｝ ｛请求报文的最后还有一个空行｝ 在请求行使用了相对 URL （即省略了主机的域名）是因为下面的首部行（第 2 行）给 出了主机的域名。第 3 行是告诉服务器不使用持续连接，表示浏览器希望服务器在传送宪所 诸求的对象后即关闭 TCP 连接。这个请求报文没有实体主体。 再看一下 HTTP 响应报文的主要特点。 每一个请求报文发出后，都能收到一个响应报文。响应报文的第—行就是状态行。 状态行包括三项内容，即 HTTP 的版本、状态码，以及解释状态码的简单短语。 状态码（S ta t us-Code) 都是三位数字的，分为 5 大类，原先有 33 种 [RFC 2616), 后来又增 加了几种[RFC 6585, 建议标准］。这 5 大类的状态码都是以不同的数字开头的。 lxx 表示通知信息，如诮求收到了或正在进行处理。 2xx 表示成功，如接受或知道了。 3xx 表示重定向，如要完成诰求还必须采取进一步的行动。 4xx 表示客户的差错，如请求中有错误的语法或不能完成。 5xx 表示服务器的差错，如服务器失效无法完成诸求。 • 281 •"}
{"doc_id": "network", "page": 293, "text": "下面三种状态行在响应报文中是经常见到的。 HTTP/1.1 202 Acce pt ed ｛接受｝ HTTP/1.1 400 Bad Re ques 七 ｛错误的请求｝ Http /1.1 404 Not Found ｛找不到｝ 若诮求的网页从 h ttp ://www.ee.x yz.ed u/i ndex.h t ml 转移到了一个新的地址，则响应报文 的状态行和一个首部行就是下面的形式： HTTP/1.1 301 Moved Permanen 七 l y ｛永久性地转移了｝ Loca 七i on: h ttp ://www.x yz.edu/ee/ i ndex.h t ml ｛新的 URL} 4. 在服务器上存放用户的信息 在本节 (6 .4 .3 节）第 1 小节 “HTTP 的操作过程”中已经讲过， HTTP 是无状态的。这 样做虽然简化了服务器的设计，但在实际工作中，一些万维网站点却常常希望能够识别用户。 例如，在网上购物时，一个顾客要购买多种物品。当他把选好的一件物品放入“购物车”后， 他还要继续浏览和选购其他物品。因此，服务器需要记住用户的身份，使他接着选购的一些 物品能够放入同一个“购物车”中，这样就使千集中结账。有时某些万维网站点也可能想限 制某些用户的访问。要做到这点，可以在 HTTP 中使用 Cooki e 。在 RFC 6265 中对 Cook i e 进行了定义，规定万维网站点可以使用 Cooki e 来跟踪用户。 Cook i e 原意是“小甜饼”（广 东人用方言音译为“曲奇”），目前尚无标准译名，在这里 Cook i e 表示在 HTTP 服务器和客 户之间传递的状态信息。现在很多网站都已广泛使用 Cooki e 。 Cooki e 是这样工作的：当用户 A 浏览某个使用 Cook i e 的网站时，该网站的服务器就为 A 产生一个唯一的识别码，并以此作为索引在服务器的后端数据库中产生一个项目。接着在 给 A 的 HTTP 响应报文中添加一个叫作 Set -cooki e 的首部行。这里的“首部字段名”就是 \"Set -cook i e\", 而后面的＂值”就是赋予该用户的＂识别码＂。例如这个首部行是这样的： Set -cook i e: 31d4d96e407aad42  当 A 收到这个响应时，其浏览器就在它管理的特定 Cook i e 文件中添加一行，其中包括 这个服务器的主机名和 Set -cook i e 后面给出的识别码。当 A 继续浏览这个网站时，每发送一 个 HTTP 请求报文，其浏览器就会从其 Cook i e 文件中取出这个网站的识别码，并放到 HTTP 请求报文的 Cook i e 首部行中： Cook i e: 31d4d96e407aad42  于是，这个网站就能够跟踪用户 31d4d96e407aad42 （用户 A) 在该网站的活动。需 要注意的是，服务器并不需要知道这个用户的真实姓名以及其他的信息。但服务器能够知道 用户 3ld4d96e407aad42 在什么时间访问了哪些页面，以及访问这些页面的顺序。如果 A 是在网上购物，那么这个服务器可以为 A 维护一个所购物品的列表，使 A 在结束这次购物 时可以一起付费。 如果 A 在几天后再次访问这个网站，那么他的浏览器会在其 HTTP 请求报文中继续使 用首部行 Cook i e: 31d4d96e407aad42, 而这个网站服务器根据 A 过去的访问记录可以 向他推荐商品。如果 A 已经在该网站登记过和使用过信用卡付费，那么这个网站就已经保 • 282 •"}
{"doc_id": "network", "page": 294, "text": "存了 A 的姓名、电子邮件地址、信用卡号码等信息。这样，当 A 继续在该网站购物时，只 要还使用同一个计算机上网，山于浏览器产生的 HTTP 诮求报文中都携带了同样的 Cook飞 首部行，服务器就可利用 Cook i e 来验证出这是用户 A, 因此以后 A 在这个网站购物时就不 必重新在键盘上输入姓名、信用卡号码等信息。这对顾客显然是很方便的。 尽管 Cooki e 能够简化用户网上购物的过程，但 Cooki e 的使用一直引起很多争议。有人 认为 Cook i e 会把计算机病毒带到用户的计算机中。其实这是对 Cooki e 的误解。 Cook i e 只是 一个小小的文本文件，不是计算机的可执行程序，因此不可能传播计算机病毒，也不可能用 来获取用户计算机硬盘中的信息。对于 Cooki e 的另一个争议，是关于用户隐私的保护问题。 例如，网站服务器知道了 A 的一些信息，就有可能把这些信息出卖给第三方。 Cooki e 还可 用来收集用户在万维网网站上的行为。这些都屈千用户个人的隐私。有些网站为了使顾客放 心，就公开声明他们会保护顾客的隐私，绝对不会把顾客的识别码或个人信息出售或转移给 其他厂商。 为了让用户有拒绝接受 Cooki e 的自由，在浏览器中用户可自行设置接受 Cook i e 的条件。 例如在浏览器 IE I 1. 0 中，选择工具栏中的“工具”- \"In terne t选项”一“隐私”命令，就 可以看见菜单中的左边有一个可上下滑动的标尺，它有六个位置。最高的位置是阻止所有 Cook记，而最低的位置是接受所有 Cooki e 。中间的位置则是在不同条件下可以接受 Coo 妞e 。 用户可根据自己的悄况对 IE 浏览器进行必要的设置。 6.4.4 万维网的文档 1. 超文本标记语言 HTML 要使任何一台计算机都能显示出任何一个万维网服务器上的页而，就必须解决页面制 作的标准化问题。超文本标记语言 HTML (HyperText Markup Languag e) 就是一种制作万维 网页面的标准语言，它消除了不同计算机之间信息交流的障碍。但诮注意， HTML 并不是 应用层的协议，它只是万维网浏览器使用的一种语言。由千 HTML 非常易于掌握且实施简 单，因此它很快就成为万维网的重要基础 [RFC 2854] 。官方的 HTML 标准由万维网联盟 W3C （即 WWW Conso rti um) 负责制定。有关 HTML 的一些参考资料见[W-HTML] 。从 HTML 在 1993 年问世后，就不断地对其版本进行更新。现在最新的版本是 HTML 5.0, 新 的版本增加了 <aud i o> 和＜v i deo> 两个标签来实现对多媒体中的音频、视频使用的支持，增加 了能够在移动设备上支持多媒体功能。 HTML 定义了许多用于排版的命令，即“标签”(ta g)、1，。例如，＜l＞表示后面开始用斜体 字排版，而</I> 则表示斜体字排版到此结束。 HTML 把各种标签嵌入到万维网的页面中，这 样就构成了所诮的 HTML 文档。 HTML 文档是～种可以用任何文本编辑器（例如， Wi ndows 的记事本 Notepad) 创建的 ASCU 码文件。但应注意，仅当 HTML 文档是以 html 或h trn 为后 缀时，浏览器才对这样的 HTML 文档的各种标签进行解释。如果 HTML 文档改为以txt为其 后缀，则 HTML 解释程序就不对标签进行解释，而浏览器只能看见原来的文本文件。 ＠注：在[MINGCl93) 中，朽tag和 nag内个名词都译为“标志”。由十 Fl 前已有较多的作者将ta g译为＂杯签＂．井芍虑到 蚊好与flag的译名有所区别，故将 1a g译为标签。实际上，”标签＂的：恣思也还比较准确，因为，个 HTML 文档与浏览器所显不 的内容相比，屯要就是增加（许多的标签． • 283 •"}
{"doc_id": "network", "page": 295, "text": "并非所有的浏览器都支持所有的 HTML 标签。若某一个浏览器不支持某一个 HTML 标 签，则浏览器将忽略此标签，但在一对不能识别的标签之间的文本仍然会被显示出来。 下面是一个简单例子，用来说明 HTML 文档中标签的用法。在每一个语句后面的花括 号中的字是给读者看的注释，在实际的 HTML 文档中并没有这种注释。 <HTML>  <HEAD>  <TITLE> 一个 HTML 的例子</TITLE> </HEAD>  <BODY>  <Hl>HTML 很容易掌握<IH I> <P> 这是第一个段落。<JP> <P> 这是第二个段落。<IP> </B ODY>  </H TML>  {HTML 文档开始｝ ｛首部开始｝ {“一个 HTML 的例子”是文档的标题｝ ｛首部结束｝ ｛主体开始｝ { \"HTML 很容易掌握”是主体的 1 级题头｝ {<P>和 </P> 之间的文字是一个段落｝ {<P，寸和I <IP>之间的文字是一个段落｝ ｛主体结束｝ {HTML 文档结束｝ 把上面的 HTML 文档存入 D 盘的文件夹 HTML 中，文件名是 HTML-examp le.html （注 意：实际的文档中没有注释部分）。当浏览器读取了该文档后，就按照 HTML 文档中的各种 标签，根据浏览器所使用的显示器的尺寸和分辨率大小，重新进行排版并显示出来。图 6-12 表示 TE 浏览器在计算机屏硌上显示出的与该文档有关部分的画面。文档的标题(title)” 一个 HTML 的例子”显示在浏览器最上面的标题栏中。文件的路径显示在地址栏中。再下面就 是文档的主体部分。主体部分的题头 (head i ng),即文档主体部分的标题 “HTML 很容易掌 握“，用较大的字号显示出来，因为在标签中指明了使用的是 1 级题头 <HI> 。 目前已开发出了很好的制作万维网页面的软件工具，使我们能够像使用 Word 文字处理 器那样很方便地制作各种页面。即使我们用 Word 文字处理器编辑了一个文件，但只要在 “另存为（Save As)\" 时选取文件后缀为ht m 或html,就可以很方便地把 Word 的．doc 格式文 件转换为浏览器可以显示的 HTML 格式的文档。 k' 一 t,.q、 慎噪屯） ．看 0 ....1 工具(t> 蟾阮叩 ｀匕曼＂ ｀口m孔”“”:'”“ HTl\\IL很容易掌握 这是霎一忖芯． 过量等二个段习 图 6-12 在屏幕上显示的 HTML 文杻主体部分的例子 HTML 允许在万维网页面中插入图像。一个页面本身带有的图像称为内含图像(inl i ne i mage) 。 HTML 标准并没有规定该图像的格式。实际上，大多数浏览器都支持 GIF 和JPEG 文件。很多格式的图像占据的存储空间太大，因而这种图像在互联网传送时就很浪费时间。 例如，一幅位图文件(.brn p)可能要占用 500~700 KB 的存储空间。但若将此图像改存为经压 缩的．gif格式，则可能只有十几个于字节，大大减少了存储空间。 HTML 还规定了链接的设觅方法。我们知道每个链接都有一个起点和终点。链接的起 点说明在万维网页面中的什么地方可引出一个链接。在一个页面中，链接的起点可以是一个 字或几个字，或是一幅图，或是一段文字。在浏览器所显示的页面上，链接的起点是很容易 • 284 •"}
{"doc_id": "network", "page": 296, "text": "识别的。在以文字作为链接的起点时，这些文字往往用不同的颜色显示（例如，一般的文字 用黑色字时，链接起点往往使用蓝色字），甚至还会加上下划线(—般由浏览器来设置）。当 我们将鼠标移动到一个链接的起点时，表示鼠标位置的箭头就变成了一只手。这时只要点击 鼠标，这个链接就被激活。 链接的终点可以是其他网站上的页面。这种链接方式叫作远程链接。这时必须在 HTML 文档中指明链接到的网站的 URL 。有时链接可以指向本计算机中的某一个文件或本 文件中的某处，这叫作本地链接。这时必须在 HTML 文档中指明链接的路径。 实际上，现在这种链接方式已经不局限于用在万维网文档中。在最常用的 Word 文字处 理器的工具栏中，也设有＂插入超链接”的按钮。只要点击这个按钮，就可以看到设置超链 接的窗口。用户可以很方便地在自己写的 Word 文档中设置各种链接的起点和终点。 在这一小节的最后，我们还要简单介绍一下和浏览器有关的几种其他语言。 XML (Extensible Markup Language) 是可扩展标记语言，它和 HTML 很相似。但 XML 的设计宗旨是传输数据，而不是显示数据 (HTML 是为了在浏览器上显示数据）。更具体些， XML 用千标记电子文件，使其具有结构性的标记语言，可用来标记数据、定义数据类型， 是一种允许用户对自己的标记语言进行定义的源语言。 XML 是一种简单、与平台无关并被 广泛采用的标准。 XML 相对千 HTML 的优点是它将用户界面与结构化数据分隔开来。这 种数据与显示的分离使得集成来自不同源的数据成为可能。客户信息、订单、研究结果、账 单付款、病历、目录数据及其他信息都可以转换为 XML 。 XML 不是要替换 HTM L,而是 对 HTML 的补充。 XML 标记由文档的作者定义，并且是无限制的。 HTML 标记则是预定 义的； HTML 作者只能使用当前 HTML 标准所支持的标记。 另一种语言 XHTML (Extensible HTML)是可扩展超文本标记语言，它与 HTML 4.01 几 乎是相同的。但 XHTML 是更严格的 HTML 版本，也是一个 W3C 标准 (2000 年 1 月制定）， 是作为一种 XML 应用被堇新定义的 HTML ，并将逐渐取代 HTML 。所有新的浏览器都支持 XHTML 。 还有一种语言 CSS (Cascad ing Style Sheets) 是层叠样式表，它是一种样式表语言，用于 为 HTML 文档定义布局。 CSS 与 HTML 的区别就是： HTML 用于结构化内容，而 CSS 则 用千格式化结构化的内容。例如，在浏览器上显示的字体、颜色、边距、高度、宽度、背拱 图像等方面，都能够给出精确的规定。现在所有的浏览器都支持 CSS 。 2. 动态万维网文档 上面所讨论的万维网文档只是万维网文档中最基本的一种，即所谓的静态文档 (s tati c document)。静态文档在文档创作完毕后就存放在万维网服务器中，在被用户浏览的过程中， 内容不会改变。由千这种文档的内容不会改变，因此用户对静态文档的每次读取所得到的返 回结果都是相同的。 静态文档的最大优点是简单．由千 HTML 是一种排版语言，因此静态文档可以由不懂 程序设计的人员来创建。但静态文档的缺点是不够灵活。当信息变化时就要由文档的作者手 工对文档进行修改。可见，变化频繁的文档不适于做成静态文档。 动态文档 (dyna皿 c document)是指文档的内容是在浏览器访问万维网服务器时才由应用 程序动态创建的。当浏览器请求到达时，万维网服务器要运行另一个应用程序，并把控制转 移到此应用程序。接养，该应用程序对浏览器发来的数据进行处理，并输出 HTML 格式的文 • 285 •"}
{"doc_id": "network", "page": 297, "text": "杻，万维网服务器把应用程序的输出作为对浏览器的响应。由千对浏览器每次请求的响应都 是临时生成的，因此用户通过动态文档所看到的内容是不断变化的。动态文档的主要优点是 贝有报告当前最新信息的能力。例如，动态文档可用来报告股市行情、天气预报或民航售票 估况等内容。但动态文档的创建难度比静态文档的高，囚为动态文档的开发不是直接综写文 档本身，而是编写用千生成文档的应用程序，这就要求动态文档的开发人员必须会编程，而 所编写的程序还要通过大范围的测试，以保证输入的有效性。 动态文档和静态文档之间的主要经别体现在服务器一端。这主要是文档内容的生成方 法不同。而从浏览器的角度看，这两种文档并没有区别。动态文档和静态文档的内容都遵循 HTML 所规定的格式，浏览器仅根据在屏幕上看到的内容无法判定服务器送来的是哪一种 文档，只有文档的开发者才知道。 从以上所述可以石出，要实现动态文档就必须在以下两个方面对万维网服务器的功能 进行扩充： (I) 应增加另一个应用程序，用来处理浏览器发来的数据，并创建动态文档。 (2) 应增加一个机制，用来使万维网服务器将浏览器发来的数据传送给这个应用程序， 然后万维网服务器能够解释这个应用程序的输出，并向浏览器返回 HTML 文档。 图 6-13 是扩充了功能的万绯网服务器的示总图。这里增加了一个机制，叫作通用网关 接口 CGI (Common Gateway In t erface) 。 CGI 是一种标准，它定义了动态文档应如何创建， 输入数据应如何提供给应用程序，以及输出结果应如何使用。 在万维网服务器中新增加的应用程序叫作 CGI 程序。取这个名字的原因是：万维网服 务器与 CGI 的通信遵循 CGT 标准。“通用”是因为这个标准所定义的规则对其他任何语言都 是通用的。“网关”二字的出现是因为 CGl 程序还可能访问其他的服务器资源，如数据库或 图形软件包，因而 CGI 程序的作用有点像一个网关。也布人将 CGI 程序简称为网关程序。 “接口”是因为有一些已定义好的变雄和调用等可供其他 CGl 程序使用。请读者注意：在 石到 CGI 这个名词时，应弄消是指 CGI 标准，还是指 CGl 程序。 万维网 客户端 浏览器 互联网 」片一呈序 万维网服务器 厂堕求文档严王五巨 三O响应动』文档 售 图 6-13 扩充了功能的万维网服务器 CGI 程序的正式名字是 CGI 脚本（scr ipt)。按照计算机科学的一般概念，“脚本”\\J'指的 (i)注：脚本(script) • i n] 还行其他的意思。例如，在多媒体开发程序中用“脚本“米表示编程人员输入的一系列指令，这些 指令指明多媒体义件应按什么顺序执行． • 286 •"}
{"doc_id": "network", "page": 298, "text": "是一个程序，它被另一个程序（解释程序）而不是计＄t机的处理机来解释或执行。有一些语 言专门作为脚本语言(scr ipt lan guag e), 如 Perl, REXX （在 IBM 主机上使用），JavaScr ipt以 及 Tcl/Tk 等。脚本也可用一些常用的编程语言写出，如 C, C＋＋等。使用脚本语言可更容易 和更快地进行编码，这对一些有限功能的小程序是很合适的。但一个脚本运行起来比一般的 编译程序要慢，因为它的每一条指令先要被另一个程序来处理（这就要一些附加的指令）， 而不是直接被指令处理器来处理。脚本不一定是一个独立的程序，它可以是一个动态装入的 库，甚至是服务器的一个子程序。 CGI 程序又称为 c gi -b in 脚本，这是因为在许多万维网服务器上，为便于找到 CGI 程序， 就将 CGT 程序放在/c gi -b i n 的目录下。 3. 活动万维网文档 随卷 HTTP 和万维网浏览器的发展，上一节所述的动态文档已明显地不能满足发展的 需要。这是因为，动态文档一旦建立，它所包含的信息内容也就固定下来而无法及时刷新屏 幕。另外，像动画之类的显示效果，动态文档也无法提供。 有两种技术可用千浏览器屏幕显示的连续更新。—种技术称为服务器推送(server push),  这种技术是将所有的工作都交给服务器。服务器不断地运行与动态文档相关联的应用程序， 定期更新信息，并发送更新过的文档。 尽管从用户的角度看，这样做可达到连续更新的目的，但这也有很大的缺点。首先， 为了满足很多客户的诸求，服务器就要运行很多服务器推送程序。这将造成过多的服务器开 销。其次，服务器推送技术要求服务器为每一个浏览器客户维持一个不释放的 TCP 连接。 随着 TCP 连接的数目增加，每一个连接所能分配到的网络带宽就下降，这就导致网络传输 时延的增大。 另一种提供屏幕连续更新的技术是活动文档（ac ti ve document)。这种技术是把所有的工 作都转移给浏览器端。每当浏览器诸求一个活动文档时，服务器就返回一段活动文档程序副 本，使该程序副本在浏览器端运行。这时，活动文档程序可与用户直接交互，并可连续地改 变屏幕的显示。只要用户运行活动文档程序，活动文档的内容就可以连续地改变。由千活动 文档技术不需要服务器的连续更新传送，对网络带宽的要求也不会太高。 从传送的角度看，浏览器和服务器都把活动文档看成是静态文档。在服务器上的活动 文档的内容是不变的，这点和动态文档是不同的。浏览器可在本地缓存一份活动文档的副本。 活动文档还可处理成压缩形式，以便于存储和传送。另一点要注意的是，活动文档本身并不 包括其运行所孟的全部软件，大部分的支持软件是事先存放在浏览器中的。图 6-14 说明了 活动文档的创建过程。 由美国 SUN 公司开发的Java 语言是一项用于创建和运行活动文档的技术。在Java 技 术中使用了一个新的名词“小应用程序 ”(app le t沪来描述活动文档程序。当用户从万维网服 务器下载一个嵌入了Java 小应用程序的 HTML 文档后，用户可在浏览器的显示屏幕上点击 某个图像，然后就可看到动画的效果；或是在某个下拉式菜单中点击某个项目，即可看到根 ＇注·在Java 语，＇i出现之前就已经{i (app let这一名礼小应用程Jf app le t通常被嵌入在橾作系统或·个较大的应用程疗 之中．在片维网技术中，此名词常常指的是Java 小应用捏序． • 287 •"}
{"doc_id": "network", "page": 299, "text": "据用户键入的数据所得到的计算结果。实际上，Java 技术是活动文档技术的一部分。限千 篇幅，有关Java 技术的进一步讨论这里从略。 万维网 客户端浏览器 互联网 万维网服务器 译，编码件被代文先制为事进放序二存程成 匾 ？霄仁上 －一一一一气气邑55巴巴芒［官O 响应程序 出 图 6-14 活动文档由服务器发送过来的程序在客户端创建 6.4.5 万维网的信息检索系统 1. 全文检索搜索与分类目录搜索 万维网是一个大规模的、联机式的信息储藏所。那么，应当采用什么方法才能找到所 盂的信息呢？如果已经知道存放该信息的网点，那么只要在浏览器的地址(Locati on) 框内键 入该网点的 URL 并按回车键，就可进入该网点。但是，若不知道要找的信息在何网点，那 就要使用万维网的搜索工具。 在万维网中用来进行搜索的工具叫作搜索引擎（search engi ne) 。搜索引擎的种类很多， 但大体上可划分为两大类，即全文检索搜索引擎和分类目录搜索引罪。 全文检索搜索引擎是一种纯技术型的检索工具。它的工作原理是通过搜索软件（例如一 种叫作“蜘蛛”或“网络机器人”的 S pi der 程序）到互联网上的各网站收集信息，找到一个 网站后可以从这个网站再链接到另一个网站，像蜘蛛爬行一样。然后按照一定的规则建立一 个很大的在线索引数据库供用户查询。用户在查询时只要输入关键词，就从已经建立的索引 数据库里进行查询（并不是实时地在互联网上检索到的信息）。因此很可能有些查到的信息已 经是过时的（例如很多年前的）。建立这种索引数据库的网站必须定期对已建立的数据库进行 更新维护（但不少网站的维护很不及时，因此对查找到的信息一定要注意、其发布的时间）。现 在全球最大的并且最受欢迎的全文检索搜索引擎就是谷歌 Google (www. goo gle.com) 。谷歌提 供的主要的搜索服务有：网页搜索、图片搜索、视频搜索、地图搜索、新闻搜索、购物搜索、 博客搜索、论坛搜索、学术搜索、财经搜索等。应全球用户的需求，谷歌在美国及世界各地 创建数据中心。至 2013 年底，谷歌的数据中心在全球共设有 12 处。大多数数据中心的业主 菇于信息安全考虑，极少透露其数据中心的信息及内部悄形。 我们将在卜一小节简单介绍谷歌搜索技术的特点。现在“谷歌”不仅是网站名，而且 还是动词。例如，“谷歌一下”的意思就是“用谷歌网站进行信息搜索”。在全文检索搜索引 擎中另外两个著名的网站是美国微软的必应（en.b i n g .com) 和中国的百度(www.bai du.com). 分类目录搜索引擎并不采集网站的任何信息，而是利用各网站向搜索引擎提交网站信 • 288 •"}
{"doc_id": "network", "page": 300, "text": "息时填写的关键词和网站描述等信息，经过人工审核编辑后，如果认为符合网站登录的条件， 则输入到分类目录的数据库中，供网上用户查询。因此，分类目录搜索也叫作分类网站搜索。 分类目录的好处就是用户可根据网站设计好的目录有针对性地逐级查询所需要的信息，查询 时不需要使用关键词，只需要按照分类（先找大类，再找下面的小类），因而查询的准确性 较好。但分类目录查询的结果并不是具体的页面，而是被收录网站主页的 URL 地址，因而 所得到的内容就比较有限。相比之下，全文检索可以检索出大址的信息（一次检索的结果是 几百万条，甚至是于万条以上），但缺点是查询结果不够准确，往往是罗列出了海城的信息 （如上千万个页面），使用户无法迅速找到所需的信息。在分类目录搜索引擎中最著名的就 是雅虎 (www. yahoo.com) 。国内著名的分类搜索引擎有雅虎中国 (en. y ahoo.com) 、新浪 (s i na.com.cn) 、搜狐(www.sohu.com) 、网易 (www.163.com) 等。 图 6-16 说明了上述这两种搜索方法的区别。图 6-IS(a) 是全文搜索谷歌的首页。用户只 需在空白的栏目中键入拟搜索的关键词，搜索引擎就返回搜索结果，用户可根据屏幕上显示 的结果继续点击下去，直到看到满意的结果。圈 6-15 (b)是分类检索新浪网的首页。我们可 以看到页面上有三行共 63 个类别。用户要检索的内容通常总是在这几十个类别之中，因此 按类别点击查找下去，最后就可以查找到所要检索的内容。 Gog |e  (a) 全文检索举例 6  s,na新演fills .. acom(cn  ．，尽 严：兰古怎9 篱燭言撸 r：仑巳忘 体胄咄A 干\"' .. 王 蠕富守仁t史天气 钓耐艾勹忖增袁II 城市轼谥辽凡“心1',h 句滇 财经扮彝毫之朽沦 镶乐砃妥跷彰吧I'll Ill频也艺息·,!fl Ji喝 笱寓戛聋公幻色夕 篡谔扒宁比最马尔入 “墙 II片¥乐贷实忙工 汽车 哎价,-4- I ，丘 膺产二于护.“l!l又霉 ·片，令书伍噙心讫 谐戏氏丹1-讫”“'J 停乒 (b) 分类检索举例 图 6-15 举例说明两种检索的区别 从用户的角度看，使用这两种不同的搜索引擎一般都能够实现自己查询信息的目的。 为了使用户能够更加方便地搜索到有用信息，目前许多网站往往同时具有全文检索搜索和分 类目录搜索的功能。在互联网上搜索信息需要经验的积累。要多实践才能华握从互联网获取 信息的技巧。 这里再强调一下，不管哪种搜索引擎，就是告诉你只要链接到什么地方就可以检索到 所需的信息。搜索引擎网站本身并没有直接存储这些信息。 值得注意的是，目前出现了垂直搜索引擎(ve rti cal search en gi ne), 它针对某一特定领域、 特定人群或某一特定需求提供搜索服务。垂直搜索也是提供关键字来进行搜索的，但被放到 了一个行业知识的上下文中，返回的结果更倾向千信息、消息、条目等。例如，对买房的人 讲，他希望查找的是房子的具体供求信息（如面积、地点、价格等），而不是有关房子供求 的一般性的论文或新闻、政策等。目前热门的垂直搜索行业有：购物、旅游、汽车、求职、 房产、交友等。还有一种元搜索引擎(met a search en gi ne), 它把用户提交的检索请求发送到 多个独立的搜索引擎上去搜索，并把检索结果渠中统一·处理，以统一的格式提供给用户，因 此是搜索引擎之上的搜索引擎。它的主要精力放在提高搜索速度、智能化处理搜索结果、个 • 289 •"}
{"doc_id": "network", "page": 301, "text": "性化搜索功能的设置和用户检索界而的友好性上。元搜索引擎的查全率和查准率都比较高。 2. Goog le 搜索技术的特点 Goog le 的搜索引擎性能优良，因为它使用了先进的硬件和软件。以往的大多数的搜索 引乎是使用少量大型服务器，在访问高峰期，搜索的速度就会明显减慢。 Google 则利用在 互联网上相互链接的计算机来快速查找每个搜索的答案，并且成功地缩短了查找的相应时间。 Google 的搜索软件可同时进行计多运算，它的核心技术就是 Pag eRank™, 译为网页排名。 Pa g eRank 对搜索出来的结果按重要性进行排序，这是 Google 的两个创始人 Larry Page  和 Serg e y B ri n 共同开发出来的 [W-PageRank] 。由于用户在有限的时间内，不可能阅读全部 的搜索结果（因为数量往往非常大），而通常仅仅是查阅一下前几个（或前几十个）项目。 因此用户希望检索结果能够按重要性来排序。但怎样确定某个页面的重要性呢？传统的搜索 引擎往往是检查关键字在网页上出现的频率。 Pa geRank 技术则把整个互联网当作了一个整 体对待，检查整个网络链接的结构，并确定哪些网页重要性最高。更具体些，就是如果有很 多网站上的链接都指向页面 A, 那么页而 A 就比较亟要。 Pag eRa咄对链接的数目进行加权 统计。对来自重要网站的链接，其权重也较大。统计链接数目的问题是一个二维矩阵相乘的 问题，从理论上讲，这种二维矩阵的元素数是网页数目的平方。对于 1 亿个网页，这个矩阵 就有 1 亿亿个元素。这样大的矩阵相乘，计算量是非常大的。 Larry Pa ge 和 Sergey Bri n 两人 利用稀疏矩阵计算的技巧，大大地简化了计算揽。他们用迭代的方法解决了这个问题。他们 先假定所有网页的排名是相同的，并且根据此初始值，算出各个网页的第一次迭代排名，再 根据第一次迭代排名算出第二次的排名。他们从理论上证明了不论初始值如何选取，这种算 法都保证了网页排名的估计值能收敛到排名的真实值。这种算法是完全没有任何人工干预的， 厂商不可能用金钱购买网页的排名。 Goog le 还要进行超文本匹配分析，以确定哪些网页与 正在执行的特定搜索相关。在综合考虑整体亟要性以及与特定查询的相关性之后， Goog le 就把砐相关、砐可靠的搜索结果放在首位。 然而有一些著名网站通过“竞价排名“把虚假广告信息放在检索结果的首位，结果误 导了消费者，使受骗者蒙受很大的损失。因此对网络搜索的结果，我们应认真分析其真伪， 提高辨别能力，不要随意轻信网络检索的广告信息（哪怕是知名度很高的网站）。 6.4.6 博客和微博 近年来，万维网的一些新的应用广为流行，这就是博客和微博。下面进行简单的介绍。 1. 博客 我们知道，建立网站就是万维网的一种应用。博客（blo g)和网站有很相似的地方。博客 的作者可以源源不断地往万维网上的个人博客里埴充内容，供其他网民阅读。网民可以用浏 览器上网阅读博客、发表评论，也可以什么都不做。 博客是万维网日志(weblo g)的简称。也有人把 blo g进行音译，译为“部落格”，或“部 落阁”。还有人用“博文”来表示“博客文熙＂。 本来，网络日志是指个人撰写并在互联网士发布的、屈于网络共享的个人日记。但现 在它不仅可以是个人日记，而且可以有无数的形式和大小，也没有任何实际的规则。 现在博客已经极大地扩充了互联网的应用和影响，成为了所有网民都可以参与的一种 • 290 •"}
{"doc_id": "network", "page": 302, "text": "新媒体，并使得无数的网民有了发占权，有了与政府、机构、企业，以及很多人交流的机会。 在博客出现以前，网民是互联网上内容的消费者，网民在互联网上搜寻并下载感兴趣的估息。 这些信息是其他人生产的，他们把这些信息放在互联网的某个服务器上，供广大网民使用 （也就是供网民消费）。但博客改变了这种情况，网民不仅是互联网上内容的消费者，而且 还是互联网上内容的生产者。 从历史上看， weblog这个新词是Jorn Barger 千 1997 年创造的。简写的 blo g（这是今天 最常用的术语）则是 Peter Merholz 于 1999 年创造的。不久，有人把 blog既当作名词，也当 作动词，表示编辑博客或写博客。接着，新名词 blo gg er 也出现了，它表示博客的拥有者， 或博客内容的撰写者和维护者，或博客用户。博客可以看成是继电子邮件、电子公告牌系统 BBS 和即时传信 IM (Instant Messagi n g)(j)之后的第四种网络交流方式。 现在从一些著名的门户网站的主页上都能很容易地进入到博客页面，这让用户查看博 客或发表自己的博客都非常方便。前面的图 6-15(b) 所示的新浪网站首页，就可看到在几十 个分类中的第 1 行第 9 列的“博客”。 当我们在新浪网站主页点击“博客”项时，就可以看到各式各样的博客。也可以利用 搜索工具寻找所需的博客。如果我们已在新浪博客注册了，那么也可随时把自己的博客发表 在此，让别人来阅读。我们还可直接登录新浪博客网站 blo g .s i na.corn.cn 。 博客与个人网站还是有不少区别的。这里最主要的区别就是建立个人网站成本较高， 需要租用个人空间、域名等，同时建立网站的个人需要懂得 HTML 语言和网页制作等相关 技术；但博客在这方面是不需要什么投资的，所需的技术仅仅是会上网和会用键盘或书写板 输入汉字即可。因此网民用较短的时间就能够把自己写的博客发表在网上，而不像制作个人 网站那样花费较多的时间。正因为写博客的门槛较低，广大的网民才有可能成为今天互联网 上的信息制造者。 顺便提一下，不要把“博客”和“播客”弄混。播客(Podcas t)是苹果手机的一个预装软 件，能够让用户通过手机订阅和自动下载所预订的音乐文件，以使随时欣赏音乐。 2. 微博 在图 6-15(b) 新浪网站首页各种分类的第 l 行的最后，可以找到“微册”项。微博就是 微型博客(mi croblog),又称为微博客，它的意思已经非常消楚。博客或微博里的朋友，常称 为“博友＂。微博也被人戏称为“围脖＂，把博友戏称为＂脖友”。 但微博不同于一般的博客。微博只记录片段、碎语，三言两语，现场记录，发发感慨， 晒晒心情，永远只针对一个问题进行回答。微博只是记录自己琐碎的生活，呈现给人看，而 且必须很真实。微阱中不必有太多的逻辑思维，很随便，很自由，有点像电影中的一个镜头。 写微博比写其他东西简单多了，不衙要标题，不盆要段落，更不加要渍亮的词汇。 2009 年是中国微阱蓬勃发展的一年，相继出现了新浪微间、 139 说客、 9911 、嘀咕网、 同学网、贫嘴等微博客。例如，新浪微博就是巾中国最大的门户网站新浪网推出的微博服务， 是中国目前用户数最多的微博网站 (we i bo.com), 名人用户众多是新浪微博的一大特色，基 本已经覆盖大部分知名文体明星、企业高管、媒体人士。用户可以通过网页、 WAP 网、手 O 注：山ijif,ii/I的 I予名心付”即时通估”或”即时心iH\", 但 messagi n g计为“传估＂似了史准确。 • 291 •"}
{"doc_id": "network", "page": 303, "text": "机短信彩信、手机客户端等多种方式史新自己的微博。每条微博字数最初限制为 140 英文字 符，但现在已增加了“长微博＂的选项，可输入更多的字符。微博还提供插入图片、视频、 音乐等功能。截至 2019 年 3 月底，微博的月活跃用户已达 4.65 亿。 现在不少地方政府也开迪了微博（即政务微博），这是信息公开的表现。政府可以通过 政务微博，及时公布政情、公务、资讯等，获取与民众更多、更打接、更快的沟通，特别是 在突发事件或者群体性事件发生的时候，微博就能够成为政府新闻发布的一种腐要手段。 虽然政务微博具有“传递信息、沟通上下、解决问题”的功能性特点，并受到广大网 民的欢迎，但政务微博的日常管理也非常重要。如果政务微朋因缺乏良好的管理而不能够满 足群众的各种需求，那么它就会成为一种无用的摆设。 微博是一种互动及传播性极快的工具，其实时性、现场感及快捷性，往往超过所有媒 体。这是因为微博对用户的技术要求门槛非常低，而且召语言的编排组织上，没有朋客那么 高。另外，微协开通的多种 API 使大址的用户可通过手机、网络等方式来即时更新自己的 个人信息。微博网站的即时传信功能非常强大，可以通过QQ和 MSN 直接书写。 我们正处在一个急剧变革的时代，人们需要用贯穿个同社会阶层的信息去了解社会、 改变生活。在互联网上微博的出现正好满足了广大网民的面求。微朋发布、转发信息的功能 很强大，这种一个人的“通讯社”将对整个社会产生越来越人的影响。 6.4.7 社交网站 社交网站 SNS (Social Networking S ite) 是近年来发展非常迅速的一种网站，其作用是为 一群拥有相同兴趣与活动的人创建在线社区。社交网站的功能非常丰富，如电子邮件、即时 传信（在线聊天）、博客撰写、共享相册、上传视频、网页游戏、创建社团、刊登广告等， 对现实社交结构已经形成了巨大冲击。社交网络服务提供商针对不同的群众，有着不同的定 位，对个人消费者都是免费的。这种网站通过朋友，一传十、十传百地把联系范围不断扩大 下去。前面曾提到过的 BBS 和微博，可以看作是补交网站的前身。 2004 年社交网站脸书 (Facebook, 又名面书、脸谱、脸谱网）在美国诞生。脸书最初 的用户定位是大学生，但现在它的用户范围已经扩大了很多。按看社交网站热潮席卷全球， 而国内以人人网、开心网等为代表的社交网站也如雨后春笋般迅速崛起。社交网站极大地丰 宫了人们的社交生活，孕育了新的经济增长点，其所谥含的巨大商业价值和社会力蛋也正凸 显出来。 毫无疑问，目前世界上排名第一且分布最广的社交网站是脸书。脸书砓大的特点就是 可以非常方便地寻找朋友或联系老同学、老同事，能够简易地在朋友圆中分享图片、视频和 音频文件（现在也可以发送其他文件，如 docx,.xlsx 等），以及通过集成的地图功能分享用 户所在的位置。现在脸书的月度活跃用户已达 1 1. 5 亿人之多，其中半数以上为移动电话用 户。在 2010 年 3 月，脸书在美国的访问人数已超过谷歌，成为全美访问批最大的网站。脸 书的官网域名为 Facebook.com, 并持有en 域名 Facebook.cn 。排名第二的社交网站是视频分 享网站油管 YouTube, 其月度活跃用户人数为 10 亿人。 2006 年 YouTube.com 网站被谷歌收 购，目前谷歌手卜持有[ youn1be.conl/ .com.c n/ .ne t/.org等域名。国内类似的视频分享网站有 优酷(www. y ouku.com) 、土豆 (www.tu dou.com) 、 56 网 (56.com) 等。 另一种能够提供微博服务的社交网络现在也很流行。例如推特 Tw itter (twitt er.com) 网站 创建千 2006 年，它可以让用户发表不超过 140 个英文字符的消息。这些消息也被称为“推 • 292 •"}
{"doc_id": "network", "page": 304, "text": "文 ”(Tweet)。我国的新浪微朋 (www.we i bo.com) 、腾讯微博(t.qq.com) 等就是这种性质的社交 网站。职业性社交网站领英 L i nkedTn 也是很受欢迎的网站。 目前在我国最为流行的社交网站就是微信（wei xi n. qq .com) 。微信最初是专为手机用户使 用的聊天工具，其功能是“收发信息、拍照分享、联系朋友”。但几年来经过多次系统更新， 现在微信不仅可传送文字短信、图片、录音电话、视频短片，还可提供实时音频或视频聊天， 甚至可进行网上购物、转账、打车，等等。现在微信的功能已远远超越了社交领域。原来彶 信仅限于在手机上使用，但新的微信版本已能够安装在普通电脑上。我们知道，电子邮件可 以发送给网上任何一个并不认识你的用户，也不管他是否愿意接收你发送的邮件。各种博客 和微博也可供任何上网用户浏览。但微信只能在确定的朋友圈中交换信息。正是由于朋友之 间更加需要交换信息，而微信的功能又不断在扩展，因此彷女信在我国已成为几乎每个网民都 必备的应用软件。 6.5 电子邮件 6.5.1 电子邮件概述 大家知道，实时通信的电话固然使用方便，但有内个严现缺点。第一， 电话通信的主叫和被叫双方必须同时在场。第二，有些电话常常不必要地打 视拔叩紨 断被叫者的工作或休息。 电子邮件(E-mai l) 是互联网上使用最多的和最受用户欢迎的一种应用。电子邮件把邮件 发送到收件人使用的邮件服务器，并放在其中的收件人邮箱(mai l box) 中，收件人可在自己 方便时上网到自己使用的邮件服务器进行读取。这相当千互联网为用户设立了存放邮件的信 箱，因此 e-mai l 有时也称为“电子信箱”。电子邮件不仅使用方便，而且还具有传递迅速和 费用低廉的优点。据有的公司报道，使用电子邮件后可提高劳动生产率 30％以上。现在电 子邮件不仅可传送文字信息，而且还可附上卢音和图像。由于电子邮件和手机的广泛使用， 现已迫使传统的电报业务退出市场，因为这种传统电报既贵又慢，且很不方便。 1982 年 ARPANET 的电子邮件问世后，很快就成为最受广大网民欢迎的互联网应用。 电子邮件的两个最重要的草案标准，是 2008 年更新的简单邮件传送协议 SMTP (Simple Mail  Transfer Protocol) [RFC 5321] 和互联网文本报文格式[RFC 5322] 。 由千互联网的 SMTP 只能传送可打印的 7 位 ASCII 码邮件，因此在 1996 年又发布了通 用互联网邮件扩充 MIME (Multipurpose Internet Mail Extensions)[RFC 2045, 草案标准］。 MIME 在其邮件首部中说明了邮件的数据类型（如文本、声音、图像、视像等）。在 MIME 邮件中可同时传送多种类型的数据。这在多媒体通信的环境下是非常有用的。 一个电子邮件系统应具有图 6-16 所示的三个主要组成构件，这就是用户代理、邮件服 务器，以及邮件发送协议（如 SMTP) 和邮件读取协议（如 POP3) 。 POP3 是邮局协议(Post Office Pro tocol) 的版本 3 。凡是有 TCP 连接的，都经过了互联网，有的甚至可以跨越数千公 里的距离。这里为简洁起见，没有画出网络。在互联网中，邮件服务器的数量是很大的。正 是这些邮件服务器构成了电子邮件基础结构的核心。在图 6-16 中为了说明问题，仅仅画出 了两个邮件服务器。 • 293 •"}
{"doc_id": "network", "page": 305, "text": "发件人 发送方 用户代理 发达邮件服务器 （发送邮件） 发 邮件缓存 发送｝i 邮件服务器 发送邮件 SMTP TCP 连接 用户邮箱 搂收方 邮件服务器 图 6-16 电子邮件的婌主要的组成构件 收件人 用户代胖 用户代理 UA (User A gen t)就是用户与电子邮件系统的接口，在大多数情况下它就是运 行在用户计算机中的一个程序。因此用户代理又称为电子邮件客户端软件。用户代理向用户 提供一个很友好的接口（目前主要是窗口界面）来发送和接收邮件。现在可供大家选择的用 户代理有很多种。例如，微软公司的 Out look Express 和我国张小龙制作的 Foxma il,都是很 受欢迎的电子邮件用户代理。 用户代理至少应当具有以下 4 个功能。 (1) 撰写。给用户提供编辑信件的环境。例如，应让用户能创建便于使用的通信录（有 常用的人名和地址）。回信时不仅能很方便地从来信中提取出对方地址，并自动地将此地址 写入到邮件中合适的位置，而且还能方便地对来信提出的问题进行答复（系统自动将来信复 制一份在用户撰写回信的窗口中，因而用户不盆要再输入来信中的问题）。 (2) 显示。能方便地在计算机屏器上显示出来信（包括来信附上的声音和图像）。 (3) 处理。处理包括发送邮件和接收邮件。收件人应能根据情况按不同方式对来信进行 处理。例如，阅读后删除、存盘、打印、转发等，以及自建目录对来信进行分类保存。有时 还可在读取信件之前先查看一下邮件的发件人和长度等，对千不愿收的信件可直接在邮箱中 删除。 (4) 通信。发信人在撰写完邮件后，要利用邮件发送协议将邮件发送到用户所使用的邮 件服务器。收件人在接收邮件时，要使用邮件读取协议从本地邮件服务器桵收邮件。 互联网上有许多邮件服务器可供用户选用（有些要收取少觉的邮箱使用费川）。邮件服 务器 24 小时不间断地工作，并且具有很大容狱的邮件信箱。邮什服务器的功能是发送和接 收邮件，同时还要向发件人报告邮件传送的结果（已交付、被拒绝、丢失等）。邮件服务器 按照客户服务器方式工作。邮件服务器需要使用两种不同的协议。一种协议用千用户代理向 邮件服务器发送邮件或在邮件服务器之间发送邮件，如 SMTP 协议，而另一种协议用于用 户代理从邮件服务器读取邮件，如邮局协议 POP3 。 这里应当注怒，邮件服务器必须能够同时充当客户和服务器。例如，当邮件服务器 A • 294 •"}
{"doc_id": "network", "page": 306, "text": "向另竹个邮件服务器 B 发送邮件时， A 就作为 SMTP 客户，而 B 是 SMTP 服务器。反之， 当 B 向 A 发送邮件时， B 就是 SMTP 客户，而 A 就是 SMTP 服务器。 图 6-16 给出了计絊机之间发送和接收电子邮件的几个重要步骤。请注意， SMTP 和 POP3 （或 IMAP) 都是使用 TCP 连接来传送邮件的，使用 TCP 的目的是为了可靠地传送 邮件。 0 发件人调用计算机中的用户代理撰写和编辑要发送的邮件。 0 发件人点击屏岭上的“发送邮件”按钮，把发送邮件的工作全都交给用户代理来完 成。用户代理把邮件用 SMTP 协议发给发送方邮件服务器，用户代理充当 SMTP 客户，而 发送方邮件服务器充当 SMTP 服务器。用户代理所进行的这些工作，用户是看不到的。有 的用户代理可以让用户在屏幕上吞见邮件发送的进度显示。用户所使用的邮件服务器究竞在 什么地方，用户并不知道，也没必要知道。实际上，用户在把写好的信件交付给用户代理后， 就什么都不用管了。 @ SMTP 服务器收到用户代理发来的邮件后，就把邮件临时存放在邮件缓存队列中， 等待发送到接收方的邮件服务器（等待时间的长短取决于邮件服务器的处理能力和队列中待 发送的信件的数址。但这种等待时间一般都远远大于分组在路由器中等待转发的排队时间）。 0 发送方邮件服务器的 SMTP 客户与接收方邮件服务器的 SMTP 服务器建立 TCP 连接， 然后就把邮件缓存队列中的邮件依次发送出去。请注意，邮件不会在互联网中的某个中间邮 件服务器落地。如果 SMTP 客户还有一些邮件要发送到同一个邮件服务器，那么可以在原 米已建立的 TCP 连接上矗复发送。如果 SMTP 客户无法和 SMTP 服务器建立 TCP 连接（例 如，接收方服务器过负荷或出了故障），那么要发送的邮件就会继续保存在发送方的邮件服 务器中，并在稍后一段时间再进行新的尝试。如果 SMTP 客户超过了规定的时间还不能把 邮件发送出去，那么发送邮件服务器就把这种情况通知用户代理。 0 运行在接收方邮件服务器中的 SMTP 服务器进程收到邮件后，把邮件放入收件人的 用户邮箱中，等待收件人进行读取。 0 收件人在打纾收信时，就运行计算机中的用户代理，使用 POP3 （或 IMAP) 协议读 取发送给自己的邮件。请注意，在图 6-16 中， POP3 服务器和 POP3 客户之间的箭头表示的 是邮件传送的方向。但它们之间的通估是由 POP3 客户发起的。 诮注意这里有两种不同的通信方式。一种是“推＂ (push): SMTP 客户把邮件”推“给 SMTP 服务器。另一种是“拉”(pull): POPJ客户把邮件从 POP3 服务器“拉”过来。细心 的读者可能会想到这样的问题：如果让图 6-16 中的邮件服务器程序就在发送方和接收方的 计算机中运行，那么岂不是可以匣接把邮件发送到收件人的计算机中？ 答案是“不行“。这是因为并非所有的计算机都能运行邮件服务器程序。有些计算机可能 没有足够的存储空间来运行允许程序在后台运行的操作系统，或是可能没有足够的 CPU 能 力来运行邮件服务器程序。更亟要的是，邮件服务器程序必须不间断地运行，每天 24 小时 都必须不间断地连接在互联网上，否则就可能使很多外面发来的邮件无法接收。这样看来， 让用户的计算机运行邮件服务器程序显然是很不现实的（一般用户在不使用计算机时就将机 器关闭）。让来信暂时存储在用户的邮件服务器中，而当用户方便时就从邮件服务器的用户 信箱中读取来信，则是—种比较合理的做法。在 Foxma i l 中使用一种“特快专递＂服务。这 种服务就是从发件人的用户代理直接利用 SMTP 把邮件发送到接收方邮件服务器。这就加 快了邮件的交付（省去在发送方邮件服务器中的排队等待时间）。但这种“特快专递”和邮 • 295 •"}
{"doc_id": "network", "page": 307, "text": "政的 EMS 直接把邮件送到用户家中不同，它并没有把邮件直接发送到收件人的计算机中。 但有些邮件服务器为了防止垃圾邮件和计算机病毒，拒绝接收从一般用户直接发来的邮件。 电子邮件由信封（envelo p e) 和内容(con ten t)两部分组成。电子邮件的传输程序根据邮件信 封上的信息来传送邮件。这与邮局按照信封上的信息投递信件是相似的． 在邮件的信封上，最重要的就是收件人的地址。 TCP/IP 体系的电子邮件系统规定电子 邮件地址(E-ma i l address) 的格式如下： 用户名＠邮件服务器的域名 (6-1)  在式(6-1) 中，符号“@“应读作 “at\",表示“在”的意思。例如，在电子邮件地址 \"xyz@abc.com\" 中， “abc.com\" 就是邮件服务器的域名，而 “xyz\" 就是在这个邮件服务 器中收件人的用户名，也就是收件人邮箱名，是收件人为自己定义的字符串标识符。但应注 意，这个用户名在邮件服务器中必须是唯一的（当用户定义自己的用户名时，邮件服务器要 负责检查该用户名在本服务器中的唯一性）。这样就保证了每一个电子邮件地址在世界范围 内是唯一的。这对保证电子邮件能够在整个互联网范围内的准确交付是十分重要的。电子邮 件的用户一般采用容易记忆的字符串。 6.5.2 简单邮件传送协议 SMTP 下面介绍 SMTP 的一些主要特点。 SMTP 规定了在两个相互通信的 SMTP 进程之间应如何交换信息。由于 SMTP 使用客 户服务器方式，因此负贡发送邮件的 SMTP 进程就是 SMTP 客户，而负责接收邮件的 SMTP 进程就是 SMTP 服务器。至千邮件内部的格式，邮件如何存储，以及邮件系统应以多 快的速度来发送邮件， SMTP 也都未做出规定。 SMTP 规定了 14 条命令和 21 种应答估息。每条命令用几个字母组成，而每一种应答信 息一般只有一行信息，由一个 3 位数字的代码开始，后面附上（也可不附上）很简单的文字 说明。下面通过发送方和接收方的邮件服务器之间的 SMTP 通信的三个阶段介绍几个最主 要的命令和响应信息。 1. 连接建立 发件人的邮件送到发送方邮件服务器的邮件缓存后， SMTP 客户就每隔一定时间（例如 30 分钟）对邮件缓存扫描一次。如发现有邮件，就使用 SMTP 的熟知端口号码 25 与接收方 邮件服务器的 SMTP 服务器建立 TCP 连接。在连接建立后，接收方 SMTP 服务器要发出 \"220 Service ready\"（服务就绪）。然后 SMTP 客户向 SMTP 服务器发送 HELO 命令，附上 发送方的主机名。 SMTP 服务器若有能力接收邮件，则回答： “250 OK\", 表示已准备好接 收。若 SMTP 服务器不可用，则回答 “421 Service not ava i lable\" （服务不可用）。 如在一定时间内（例如三天）发送不了邮件，邮件服务器会把这个情况通知发件人。 SMTP 不使用中间的邮件服务器。不管发送方和接收方的邮件服务器相隔有多远，不管 在邮件传送过程中要经过多少个路由器， TCP 连接总是在发送方和接收方这两个邮件服务 器之间直接建立。当接收方邮件服务器出故降而不能工作时，发送方邮件服务器只能等待一 段时间后再尝试和该邮件服务器建立 TCP 连接，而不能先找一个中间的邮件服务器建立 TCP 连接。 • 296 •"}
{"doc_id": "network", "page": 308, "text": "2. 邮件传送 邮件的传送从 MAIL 命令开始。 MAIL 命令后面有发件人的地址。如： MAIL FROM:  <xi ex 订en@ts i n ghua.org.cn> 。若 SMTP 服务器已准备好接收邮件，则回答 “250 OK”。否则， 返回一个代码，指出原因。如： 451 （处理时出错）、 452 （存储空间不够）、 500 （命令无法 识别）等。 下面跟若—个或多个 RCPT 命令，取决千把同一个邮件发送给一个或多个收件人，其 格式为 RCPT TO: ＜收件人地址＞。 RCPT 是 rec ipi en t（收件人）的缩写。每发送一个 RCPT 命令，都应当有相应的信息从 SMTP 服务器返回，如： “250 OK\", 表示指明的邮箱在接收 方的系统中，或 “550 No such user here\" （无此用户），即不存在此邮箱。 RCPT 命令的作用就是：先弄清接收方系统是否己做好接收邮件的准备，然后才发送邮 件。这样做是为了避免浪费通信资源，不至千发送了很长的邮件以后才知道地址错误。 再下面就是 DATA 命令，表示要开始传送邮件的内容了。 SMTP 服务器返回的信息是： \"354 Start mail input; end with <CRLF>.<CRLF>”。这里 <CRLF>是“回车换行”的意思。若 不能接收邮件，则返回 421 （服务器不可用）， 500 （命令无法识别）等。接若 SMTP 客户就 发送邮件的内容。发送宪毕后，再发送<CRLF>.<CRLF> （两个回车换行中间用一个点隔开） 表示邮件内容结束。实际上在服务器端看到的可打印字符只是一个英文的句点。若邮件收到 了，则 SMTP 服务器返回信息 ”250 OK\", 或返回差错代码。 虽然 SMTP 使用 TCP 连接试图使邮件的传送可靠，但“发送成功”并不等千“收件人 读取了这个邮件”。当一个邮件传送到接收方的邮件服务器后（即接收方的邮件服务器收下 了这个邮件），再往后的情况如何，就有以下几种可能性： (I) 接收方的邮件服务器刚收到邮件后就出了故障，使收到的邮件全部丢失（在收件人 读取信件之前）。 (2) 收件人由于某种原因，未检查自己的邮箱，不知道邮箱中有新的来信。 (3) 收件人很长时间不删除邮箱中的过期邮件，导致有限的邮箱容扭用尽，无法再接收 新的邮件。 (4) 邮件服务器根据某种原则，误判某些邮件屈千垃圾邮件，就把收到的某些邮件转入 到垃圾邮件的文件火。收件人应从垃圾邮件的文件夹中清理出未收到的非垃圾邮件。 因此，使用电子邮件的人，应当养成及时收取和清理自己的邮箱的好习惯。 3. 连接释放 邮件发送完毕后， SMTP 客户应发送QUIT 命令。 SMTP 服务器返回的信息是 “221 （服务关闭）“,表示 SMTP 同意释放 TCP 连接。邮件传送的全部过程即结束。 这里再强调—下，使用电子邮件的用户看不见以上这些过程，所有这些复杂过程都被 电子邮件的用户代理屏蔽了。 已经广泛使用多年的 SMTP 存在着一些缺点。例如，发送电子邮件不需要经过鉴别。 这就是说，在 FROM 命令后而的地址可以任慾填写。这就大大方便了垃圾邮件的作者，给 收信人添加了麻烦（有人估计，在全世界所有的电子邮件中，垃圾邮件至少占到 50 ％以上， 甚至高达 90%) 。又如， SMTP 本来就是为传送 ASCII 码而不是传送二进制数据设计的。虽 然后来有了 MIME 可以传送二进制数据（见后而 6.5.6 节的介绍），但在传送非 ASCII 码的 长报文时，在网络上的传输效率是不高的。此外， SMTP 传送的邮件是明文，不利于保密。 • 297 •"}
{"doc_id": "network", "page": 309, "text": "为了解决上述问题 2008 年 10 月颁布的单案标准 RFC 5321 对 SMTP 进行了扩充，成 为扩充的 SMTP (Extended SMTP), 记为 ESMTP 。 RFC 5321 在许多命令中增加了扩展的参 数。新增加的功能有：客户端的鉴别，服务器接受二进制报文，服务器桵受分块传送的大报 文，发送前先检查报文的大小，使用安全传输 TLS （见下一堂 7.6.2 节），以及使用国际化 地址等。考虑到现在的许多 SMTP 邮件服务器可能还没有升级到 ESMTP, 因此特规定使用 ESMTP 的客户端在准备传送报文时，不是发送 HELO 而是发送 EHLO 报文。如果 EHLO 报 文被对力服务器端拒绝，就表明对方仍然是一个标准的 SMTP 邮件服务器（不使用扩展的 参数），因而就要按照原来使用的 SMTP 参数进行邮件的传送。如果 EHLO 报文被接受了， 那么客户端就可以使用 ESMTP 扩展的参数传送报文了。 6.5.3 电子邮件的信息格式 一个电子邮件分为信封和内容两大部分。在草案标准 RFC 5322 文档中只规定了邮件内 容中的首部(header) 格式，而对邮件的主体(bod y)部分则让用户自由撰写。用户写好首部后， 邮件系统自动地将信封所盂的信息提取出来并写在信封上。所以用户不需要填写电子邮件信 封上的信息。 邮件内容首部包括一些关键字，后而加上冒号。最觅要的关键字是： To 和 Subj ec t。 “To·” 后面填入一个或多个收件人的电子邮件地址。在电子邮件软件中，用户把经常 通信的对象姓名和电子邮件地址写到地址簿（address book) 中。当撰写邮件时，只需打开地址 簿点击收件人名字，收件人的电子邮件地址就会自动地填入到合适的位置上． \"Subj ec t:\"是邮件的主题。它反映了邮件的主要内容。主题类似于文件系统的文件名， 便于用户查找邮件。 邮件首部还有一项是抄送 “Cc:\" 。这两个字符来自 “Carbon co py\",意思是留下一个 “复写副本”。这是借用旧的名词，表示应给某某人发送一个邮件副本。 有些邮件系统允许用户使用关键字 Bee (Blind carbon co py)来实现盲复写副本。这是使 发件人能将邮件的副本送给某人，但不希望此事为收件人知道。 Bee 又称为暗送。 首部关键字还有 “From\" 和 “Da t e\", 表示发件人的电子邮件地址和发信日期。这两项 一般都山邮件系统自动埴入。 另一个关键字是 “Rep l y -To\", 即对方同信所用的地址。这个地址可以与发件人发信时 所用的地址不同。例如有时到外地借用他人的邮箱给自己的朋友发送邮件，但仍希望对方将 回信发送到自己的邮箱。这一项可以事先设置好，不孟要在每次写信时进行设置。 6.5 .4 邮件读取协议 POP3 和 IMAP 现在常用的邮件读取协议有两个，即邮局协议第 3 个版本 POP3 和网际报文存取协议 IMAP (Internet Message Aecess Protoeol) 。现分别讨论如下。 邮局协议 POP 是一个非常简单、但功能有限的邮件读取协议。邮局协议 POP 最初公布 于 1984 年。经过几次更新，现在使用的是 1996 年的版本 POP3 [RFC 1939, STD53], 大多 数的 ISP 都支持 POP3 。 POP3 也使用客户服务器的工作力式。在接收邮件的用户计算机中的用户代理必须运行 POP3 客户程疗，而在收件人所连接的 ISP 的邮件服务器中则运行 POP3 服务器程序。当然， 这个 TSP 的邮件服务器还必须运行 SMTP 服务器程序，以便接收发送方邮件服务器的 SMTP • 298 •"}
{"doc_id": "network", "page": 310, "text": "客户程序发来的邮件。这些请参阅图 6-16 。 POP3 服务器只有在用户输入鉴别信息（用户名 和口令）后，才允许对邮箱进行读取。 POP3 协议的一个特点就是只要用户从 POP3 服务器读取了邮件， POP3 服务器就把该 邮件删除。这在某些情况下就不够方便。例如，某用户在办公室的台式计算机上接收了一个 邮件，还来不及写回信，就马上携带笔记本电脑出差。当他打开笔记本电脑写回信时， POP3 服务器上却已经删除了原来已经看过的邮件（除非他祖先将这些邮件复制到笔记本电 脑中）。为了解决这一问题， POP3 进行了一些功能扩充，其中包括让用户能够半先设置 邮件读取后仍然在 POP3 服务器中存放的时间 [RFC 2449, 建议标准］。 另一个读取邮件的协议是网际报文存取协议 IMAP, 它比 POP3 复杂得多。 IMAP 和 POP 都按客户服务器方式工作，但它们有很大的娑别。现在较新的版本是 2003 年 3 月修订的版本 4, 即 IMAP4 [RFC 350 I, 建议标准］。不过在习惯上，对这个协议大家很少加上版本号 “4\", 而经常简单地用 IMAP 表示 IMAP4 。但是对 POP3 却不会忘记写上版本号 “3”。 在使用 IMAP 时，在用户的计算机上运行 IMAP 客户程序，然后与接收方的邮件服务 器上的 IMAP 服务器程序建立 TCP 连接。用户在自己的计镜机上就可以操纵邮件服务器的 邮箱，就像在本地操纵一样，因此 IMAP 是一个联机协议。当用户计算机上的 lMAP 客户程 序打开 lMAP 服务器的邮箱时，用户就可乔到邮件的首部。若用户需要打开某个邮件，则该 邮件才传到用户的计算机上。用户可以根据需要为自己的邮箱创建使1一分类管理的层次式的 邮箱文件夹，并且能够将存放的邮件从某召个文件夹中移动到另一个文件夹中。月」户也可按 某种条件对邮件进行查找。在用户未发出删除邮件的命令之前， IMAP 服务器邮箱中的邮件 一直保存若． IMAP 最大的好处就是用户可以在不问的地方使用不同的计算机（例如，使用办公室的 计算机、或家中的计符机，或在外地使用笔记本电脑）随时上网阅读和处理自己在邮件服务 器中的邮件。 IMAP 还允许收件人只读取邮件中的某 个部分。例如，收到了一个带有视像 附件（此文件可能很大）的邮件，而用户使用的是无线上网，信道的传输速率很低。为了节 省时间，可以先下载邮件的正文部分，待以后有时间再读取或下载这个很大的附件。 IMAP 的缺点是如果川户没有将邮件复制到自己的计算机上，则邮件一直存放在 IMAP 服务器上。要想查阅自己的邮件，必须先上网。 下面的表 6-2 给出了 IMAP 和 POP3 的主要功能的比较。 表 6-2 IMAP 和 POP3 的主要功能比较 操作位登 操作内容 IMAP POP3  收件箱 阅读、标记、移动、删除邮什等 客户戏与邮箱更新同步 仅仕客户端内 发件箱 保存到已发送 存户端与邮箱更新同步 仅任客户端内 创建文件夹 新让自定义的文件火 客户端与邮箱更新同步 仅在客户茹内 单稿 保存华稿 客户端与邮箱更新同步 仅在客户墙内 垃圾文件夹 接收并移入垃圾文件火的邮件 支持 不支什 广告邮件 俀收升移入广告邮件夹的邮件 支持 不支待 最后再强调一下，不要把邮件读取协议 POP3 或 lMAP 与邮件传送协议 SMTP 弄混。发 件人的用户代理向发送方邮件服务器发送邮件，以及发送方邮件服务器向接收方邮件服务器 发送邮件，都是使用 SMTP 协议。而 POP3 或 IMAP 则是用户代理从接收方邮件服务器上读 • 299 •"}
{"doc_id": "network", "page": 311, "text": "取邮件所使用的协议。 6.5.5 基千万维网的电子邮件 从前面的图 6-16 可看出，用户要使用电子邮件，必须在自己使用的计算机中安装用户 代理软件 UA 。如果外出到某地而又未携带自己的笔记本电脑，那么要使用别人的计算机进 行电子邮件的收发，将是非常不方便的。 现在这个问题解决了。在 20 世纪 90 年代中期， Hotmai l 推出了基于万维网的电子邮件 (Webmai l) 。今天，几乎所有的著名网站以及大学或公司，都提供了万维网电子邮件。常用 的万维网电子邮件有谷歌的 Gma i l (@gma il. com), 微软的 Hot mai l (@hot ma il. com), 雅 虎的 Yahoo 邮箱(@yahoo.com) 。我国的互联网技术公司也都提供万维网邮件服务，例如， 网易邮箱 (@163.eom 或＠ 126.com) 、新浪邮箱 (@sina.com 或＠s i na.cn) 和腾讯的QQ邮 箱(@qq .com) 等。 万维网电子邮件的好处就是：不管在什么地方（在任何一个国家的网吧、宾馆或朋友 家中），只要能够找到上网的计算机，在打开任何一种浏览器后，就可以非常方便地收发电 子邮什。使用万维网电子邮件不需要在计览机中再安装用户代理软件。浏览器本身可以向用 户提供非常友好的电子邮件界面（和原来的用户代理提供的界面相似），使用户在浏览器上 就能够很方便地撰写和收发电子邮件。 例如，你使用的是网易的 163 邮箱，那么在任何一个浏览器的地址栏中，键入 163 邮 箱的 URL (ma il. 163.com), 按回车键后，就可以使用 163 电子邮件了，这和在家中一样 方便。你曾经接收和发送过的邮件、已删除的邮件以及你的通信录等内容，都照常呈现在屏 幕上。 我们知道，用户在浏览器中浏览各种信息时谣要使用 HTTP 协议。因此，在浏览器和 互联网上的邮件服务器之间传送邮件时，仍然使用 HTTP 协议。但是在各邮件服务器之间传 送邮件时，则仍然使用 SMTP 协议。 6.5.6 通用互联网邮件扩充 MIME 1. MIME 概述 前面所述的电子邮件协议 SMTP 有以下缺点： (I) SMTP 不能传送可执行文件或其他的二进制对象。人们曾试图将二进制文件转换为 SMTP 使用的 ASCII 文本，例如流行的 UNIX UUencode/UUdecode 方案，但这些均未形成 正式标准或事实上的标准。 (2) SMTP 限于传送 7 位的 ASCII 码。许多其他非英语国家的文字（如中文、俄文，甚 至带呕音符号的法文或德文）就无法传送。即使在 SMTP 网关将 EBCDIC 码（即扩充的二／ 十进制交换码）转换为 ASCII 码，也会遇到一些麻烦。 (3) SMTP 服务器会拒绝超过一定长度的邮件。 (4) 某些 SMTP 的实现并没有完全按照 SMTP 的互联网标准。常见的问题如下： • 回车、换行的删除和增加； • 超过 76 个字符时的处理；截断或自动换行； • 后面多余空格的删除； • 300 •"}
{"doc_id": "network", "page": 312, "text": "• 将制表符tab 转换为若干个空格。 千是在这种情况下就提出了通用互联网邮件扩充 MIME [RFC 2045~2049, 前三个文档 是草案标准］。 MIME 并没有改动或取代 SMTP 。 MIME 的意图是继续使用原来的邮件格式， 但增加了邮件主体的结构，并定义了传送非 ASCII 码的编码规则。也就是说， MIME 邮件 可在现有的电子邮件程序和协议下传送。图 6-17 表示 MIME 和 SMTP 的关系。 芦 7 位 ASCII 码 图 6-17 MIME 和 SMTP 的关系 MIME 主要包括以下三部分内容： 卫 (I) 5 个新的邮件首部字段，它们可包含在原来的邮件首部中。这些字段提供了有关邮 件主体的信息。 (2) 定义了许多邮件内容的格式，对多媒体电子邮件的表示方法进行了标准化。 (3) 定义了传送编码，可对任何内容格式进行转换，而不会被邮件系统改变。 为适应千任意数据类型和表示，每个 MIME 报文包含告知收件人数据类型和使用编码 的信息。 MIME 把增加的信息加入到原来的邮件首部中。 下面是 MIME 增加的 5 个新的邮件首部的名称及其意义（有的可以是选项）。 (I) MIME-Versi on: 标志 MIME 的版本。现在的版本号是1.0 。若无此行，则为英文文本。 (2) Con ten t-Descr ipti on: 这是可读字符串，说明此邮件主体是否是图像、音频或视频。 (3) Conten t-Id: 邮件的唯一标识符。 (4) Conten t -Trans fer-Encod i ng:在传送时邮件的主体是如何编码的。 (5) Conten t -Typ e: 说明邮件主体的数据类型和子类型。 上述的前三项的意思很消楚，因此下面只对后两项进行介绍。 2. 内容传送编码 下面介绍三种常用的内容传送编码（Cont en t-Trans fe r-Encodi n g). 最简单的编码就是 7 位 ASCII 码，而每行不能超过 1000 个字符。 MIME 对这种由 ASCH 码构成的邮件主体不进行任何转换。 另一种编码称为quo ted- p r int able, 这种编码方法适用千所传送的数据中只有少让的非 ASCII 码，例如汉字。这种编码方法的要点就是对千所有可打印的 ASCII 码，除特殊字符等 号”=“外，都不改变。等号“=”和不可打印的 ASCH 码以及非 ASCII 码的数据的编码方 法是：先将每个字节的二进制代码用两个十六进制数字表示，然后在前面再加上一个等号 ＂＝＂。例如，汉字的”系统”的二进制编码是： 11001111 101 10101 ll 00 11 01 1 0 11 00 11 （共 有 32 位，但这四个字节都不是 ASCII 码），其十六进制数字表示为： CFB5CDB3 。用 q uoted- p ri n table 编码表示为： ＝CF=B5=CD=B3, 这 12 个字符都是可打印的 ASCII 字符，它 • 301 •"}
{"doc_id": "network", "page": 313, "text": "们的．．进制编码＇八点要 96 位，和原来的 32 位相比，开销达 200% 。而等号”=\"的二进制代 码为 0011110 1.即十六进制的 30, 因此等号”=\"的q uo ted-pr i n t able 编码为 “=30\". 对「任意的一进制文件，可用 base64 编码。这种编码方认是先把一进制代码划分为一 个个 24 位长的单元，然后把每一个 24 位单元划分为 4 个 6 位纠。每一个 6 位组按以卜．方法 转换成 ASCII 码。 6 位的二进制代码共有 64 种不同的值，从 0 到 63 。用 A 表示 o. 用 B 表 示 l ，等等。 26 个人写字母排列完毕后，接下去再排 26 个小写字母，再后面是 10 个数字， 最后川“+”表示 62 ，而用 “I\" 表示 63 。再用两个连在一起的等号”==”和一个等号”=\" 分别表示砓后一组的代码只有 8 位或 16 位。回车和换行都忽略，它们可在任何地方插入。 下面是一个 base64 编码的例子： 24 位二进制代码 划分为 4 个 6 位组 对应的 base64 编码 川 ASCH 编码发送 0 100 I 001 0011 000 I O 1111 001  0 I 00 IO O I 0011 000 I O I 11100 I  S T F 5  010100110101010001000110 00110101  不难看出， 24 位的二进制代码采用 base64 编码后变成了 32 位，开销为 8 位，占 32 位 的 25% 。 3. 内容类型 MIME 标准规定 Cont en t-Type 说明必须含有两个标识符，即内容类型(type) 和子类型 (sub typ e), 中间用 “I\" 分开。 MIME 一直到现在还是坏案标准。除了内容类型和子类型， MIME 允许发件人和收件人 自己定义专用的内容类型。但为避免可能出现名字冲突，标准要求为专川的内容类型选择的 名字必以字符：：I\\ X- 升始。后来陆续出现f几百个子类型，而 I I. f类型的数目还在不断地增 加。现在可以在网站上查出现有的 MIME 类型和千类型的名称，以及巾诮新的仁类型的具 体步骤[W-MEDIA-TYPE] 。表 6-3 列出f MIME 常用的内容类型、仁类型举例及其说明气 表 6-3 可出现在 MIME Cont en t-T yp e 说明中的类型及子类型举例 内容类型 子类型举例 说明 t ex t（文本） plain. html, xml, css 不 I·,1 格式的文本 i ma ge （图像） gif, jpeg. tiff 不同恪式的静止 1 引饮 audio C 沿桢） basic. mpeg, mp4 叩Ir 见的））；行 、 1dco （视频） mpeg. mp4. quickli me 个同格式的影片 I ii: ASCII 砃／众米定义为 7 位码．但朵初为了增加捡错能力就增加（·个令偶彴i2 位．因而仗/II．个字节 (8 i ·,I) 长示 一个 ASCII 砃． 卜是 ASCII 码就变成 (8 位码．但只垃叶位一定是 o. 曲后面的 7 位祝儿垃切定义的 ASCII 编码． (2) i I:, GIF (Grarhics Interchange Fonnac), JPEG (Joint Photographic Ex pen Grou p)和 TIFF (Tagged Image File Fonnac) 都址静 止图仪（如照片）格式的怀准，前两行是 II靠的，后行可以是 IF缩的，也可以足个 1 f、缩的。面 MPEG (Motion Picrure Expens  Grou p)儿沽动图仪（如电影）的压缩标准，包括 MPEG 视频、 MPEG 开频和 MPEG 系纹（视按音频 1,~ 护动、部分．Qu ickTi me  是守果公，＇］的媒体播放机， VRML (Vi nual Reality Modeling Language) 凡虚办现实让厌i/1,i, PDF (Ponable Document Fonnat)是 Adobe 公，4) 「发的一种 IU f．文件格式． ZIP 是一种文件压细仅法． • 302 •"}
{"doc_id": "network", "page": 314, "text": "续表 内容类型 子类型举例 说明 model （校型） vnnJ 3D 饺型 app l ica ti on （应用） oc tet-s tream 、p d f. j avascript, zip 不同应用程序产牛的数据 message （报文） hup, rfc822 封装的报文 mu ltipart（多部分） mixed, alternative, parallel, digest 多种类型的组合 MIME 的内容类型中的 multi p art是很有用的，因为它使邮件增加了相当大的灵活性。 MIME 标准为 mul tip art定义了四种可能的子类型，每个子类型都提供重要功能。 (1) m i xed 子类型允许单个报文含有多个相互独立的子报文，每个子报文可有自己的类 型和编码。 m i xed 子类型报文使用户能够在单个报文中附上文本、图形和声音，或者用额外 数据段发送一个备忘录，类似商业信笺含有的附件。在 mi xed 后面还要用到一个关键字，即 Boundary=,此关键字定义了分隔报文各部分所用的字符串（由邮件系统定义），只要在邮 件的内容中不会出现这样的字符串即可。当某一行以两个连字符”--,,开始，后面紧跟上述 的字符串，就表示下面开始了另一个子报文。 (2) al t erna ti ve 了类型允许单个报文含有同一数据的多种表示。当给多个使用不同硬件和 软件系统的收件人发送备忘录时，这种类型的 multipa rt报文就很有用。例如，用户可同时 用普通的 ASCH 文本和格式化的形式发送文本，从而允许拥有图形功能的计算机用户在查 看图形时选择格式化的形式。 (3) p arallel 子类型允许单个报文含有可同时显示的各个子部分（例如，图像和声音子部 分必须一起播放）。 (4) d ig es t子类型允许单个报文含有一组其他报文（如从讨论中收集电子邮件报文）。 下面显示了一个 MlME 邮件，它包含有一个简单解释的文本和含有非文本信息的照片。 邮件中第一部分的注解说明第二部分含有一张照片。 From: xiexiren@tsinghua.org.cn  To: xyz@l63.com  MIME-Version: 1.0  Content-Type: multipart/rnixed; boundary=qwertyui op  --qwertyui op  XYZ:  你要的图片在此邮件中，收到后请回信。 谢希仁 --qwertyui op  Content-Type: image/gif  Content-Transfer-Encoding: base64  … data for the image （图像的数据）．．． --qwertyuiop-- 上面最后一行表示 boundary的字符串后面还有两个连字符”--“，表示整个 multip art的 结束。 • 303 •"}
{"doc_id": "network", "page": 315, "text": "6.6 动态主机配置协议 DHCP 为了把协议软件做成通用的和便于移植的，协议软件的编写者不会把所 有的细节都固定在源代码中。相反，他们把协议软件参数化。这就使得在很 视频讲铲 多台计算机上有可能使用同一个经过编译的二进制代码。一台计算机和另一台计算机的许多 区别，都可以通过一些不同的参数来体现。在协议软件运行之前，必须给每一个参数赋值。 在协议软件中给这些参数赋值的动作叫作协议配置。一个协议软件在使用之前必须是 已正确配置的。具体的配置信息有哪些则取决于协议栈。例如，连接到互联网的计算机的协 议软件需要配置的项目包括： (I) IP 地址； (2) 子网掩码； (3) 默认路由器的 lP 地址； (4) 域名服务器的 IP 地址。 为了省去给计算机配置 IP 地址的麻烦，我们能否在计算机的生产过程中，事先给每一 台计杻机配置好一个唯一的 IP 地址呢（如同每一个以太网适配器拥有一个唯一的 MAC 地 址） ？这显然是不行的。这是因为 IP 地址不仅包括了主机号，而且还包括了网络号。一个 IP 地址指出了一台计算机连接在哪一个网络上。当计算机还在生产时，无法知道它在出厂 后将被连接到哪一个网络上。因此，需要连接到互联网的计算机，必须对 IP 地址等项目进 行协议配置。 用人工进行协议配置很不方便，而且容易出错。因此，应当采用自动协议配置的方法。 互联网现在广泛使用的是动态主机配置协议 DHCP (Dynamic Host Configuration  Pro tocol), 它提供了一种机制，称为即插即用连网(plu g-and- p la y ne t worki ng)。这种机制允许 一台计算机加入新的网络和获取 IP 地址而不用手工参与。 DHCP 砐新的 RFC 文档还是互联 网草案标准[RFC 2131 一2132] 。 DHCP 对运行客户软件和服务器软件的计算机都适用。当运行客户软件的计算机移至一 个新的网络时，就可使用 DHCP 获取其配置信息而不需要手工干预。 DHCP 给运行服务器 软件而位置固定的计算机指派一个永久地址，而当这计算机重新启动时其地址不改变。 DHCP 使用客户服务器方式。需要 IP 地址的主机在启动时就向 DHCP 服务器广播发送 发现报文(DHCPDISCOVER) （将目的 IP 地址置为全 l ，即 255.255.255.255), 这时该主机就 成为 DHCP 客户。发送广播报文是因为现在还不知道 DHCP 服务器在什么地方，因此要发 现(DISCOVER)DHCP 服务器的 IP 地址。这台主机目前还没有自己的 IP 地址，因此它将 IP 数据报的源 IP 地址设为全 0 。这样，在本地网络上的所有主机都能够收到这个广插报文， 但只有 DHCP 服务器才对此广播报文进行回答。 DHCP 服务器先在其数据库中查找该计算 机的配翌信息。若找到，则返回找到的信息。若找不到，则从服务器的 IP 地址池(address p ool) 中取一个地址分配给该计算机。 DHCP 服务器的回答报文叫作提供报文(DHCPOFFER), 表示“提供”了 IP 地址等配置信息。 但是我们并不愿意在每一个网络上都设置一个 DHCP 服务器，因为这样会使 DHCP 服 务器的数量太多。因此现在是使每一个网络至少有一个 DHCP 中继代理(rela y ag en t)（通常 是一台路由器，如图 6-18 所示），它配置了 DHCP 服务器的 IP 地址信息。当 DHCP 中继代 理收到主机 A 以广播形式发送的发现报文后，就以单播方式向 DHCP 服务器转发此报文， • 304 •"}
{"doc_id": "network", "page": 316, "text": "并等待其回答。收到 DHCP 服务器回答的提供报文后， DHCP 中继代理再把此提供报文发 回给主机 A 。需要注意的是，图 6-18 只是个示意图。实际上， DHCP 报文只是 UDP 用户数 据报的数据，它还要加上 UDP 首部、 IP 数据报首部，以及以太网的 MAC 帧的首部和尾部 后，才能在链路上传送。 主机 A I 广播 一 IDHCPDISCOVER 尸 + 1 1 单播 DHCP 服务器 勹 I I |DHCPDISCOVER 尸 I 一 1 DHCP 中继代到1 图 6-18 DHCP 中继代理以单播方式转发发现报文 DHCP 服务器分配给 DHCP 客户的 IP 地址是临时的，因此 DHCP 客户只能在一段有限 的时间内使用这个分配到的 IP 地址。 DHCP 协议称这段时间为租用期(l ease p eri od), 但并没 有具体规定租用期应取为多长或至少为多长，这个数值应由 DHCP 服务器自己决定。例如， 一个校园网的 DHCP 服务器可将租用期设定为 1 小时。 DHCP 服务器在给 DHCP 发送的提 供报文的选项中给出租用期的数值。按照 RFC 2132 的规定，租用期用 4 字节的二进制数字 表示，单位是秒。因此可供选择的租用期范围从 1 秒到 136 年。 DHCP 客户也可在自已发送 的报文中（例如，发现报文）提出对租用期的要求。 DHCP 的详细工作过程如图 6-19 所示。 DHCP 客户使用的 UDP 端口是 68, 而 DHCP 服务器使用的 UDP 端口是 67 。这两个 UDP 端口都是熟知端口。 旦o UDP  DHCPDISC丽百勹——气豆L——_UDP  DHCPOFFER 尸—气豆亘亘扣 UDP  DHCPREQ韭江」———卫＿＿＿勹 UDP  DHCl'A.CK 尸—气可亘豆日 0 DHCPREQUEST 尸 UDP  DHCPACK 尸—气荨 0 UDP  DHCPNACK I 冗乔服务器 10 DHCPRELEASE  图 6-19 DHCP 协议的工作过程 下面按照图 6-19 中的注释编号 (0 至 O) 进行简单的解释。 0 DHCP 服务器被动打开 UDP 端口 67, 等待客户端发来的报文。 0 DHCP 客户从 UDP 端口 68 发送 DHCP 发现报文。 0 凡收到 DHCP 发现报文的 DHCP 服务器都发出 DHCP 提供报文， 视频讲斛 因此 DHCP 客户 • 305 •"}
{"doc_id": "network", "page": 317, "text": "可能收到多个 DHCP 提供报文。 0 DHCP 客户从几个 DHCP 服务器中选择其中的一个，并向所选择的 DHCP 服务器 发送 DHCP 诸求报文。 0 被选择的 DHCP 服务器发送确认报文 DHCPACK 。从这时起， DHCP 客户就可以使 用这个 LP 地址了。这种状态叫作已绑定状态，因为在 DHCP 客户端的 IP 地址和 MAC 地址已经完成绑定，并且可以开始使用得到的临时 IP 地址了。 DHCP 客户现在要根据服务器提供的租用期 T 设置两个计时器 T1 和 T2, 它们的超 时时间分别是 0.5T 和 0.875T 。当超时时间到了就要清求更新租用期。 0 租用期过了一半（兀时间到）， DHCP 客户发送请求报文 DHCPREQUEST 要求更 新租用期。 8 DHCP 服务器若同意，则发回确认报文 DHCPACK 。 DHCP 客户得到了新的租用期， 重新设置计时器。 0 DHCP 服务器若不同意，则发回否认报文 DHCPNACK 。这时 DHCP 客户必须立即 停止使用原来的 IP 地址，而必须重新中诮 IP 地址（回到步骤0) 。 若 DHCP 服务器不响应步骤 0 的诸求报文 DHCPREQUEST, 则在租用期过了 87.5 ％时（飞时间到）， DHCP 客户必须亟新发送谘求报文 DHCPREQUEST （重复 步骤 0), 然后又继续后面的步骤。 0 DHCP 客户可以随时提前终止服务器所提供的租川期，这时只需向 DHCP 服务器发 送释放报文 DHCPRELEASE 即可。 DHCP 很适合于经常移动位置的计算机。当计算机使用 Wi ndows 橾作系统时，点击 “控制而板”的“网络“图标就可以找到某个连接中的“网络”下而的菜单，找到 TCP/I P 协议后点击其“屈性”按钮，若选择“自动获得 IP 地址”和“自动获得 DNS 服务器地址” 选项，就表示是使用 DHCP 协议。 6.7 简单网络管理协议 SNMP 6.7.1 网络管理的基本概念 虽然网络管理还没有精确定义，但它的内容可归纳为： 网络管理包括对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、 测试、配置、分析、评价和控制，这样就能以合理的价格满足网络的一些需求，如实时运行 性能、服务质量等。网络管理常简称为网管。 我们可以看到，网络管理并不是指对网络进行行政上的管理。 网络是一个非常复杂的分布式系统。这是因为网络上有很多不同厂家生产的、运行着 多种协议的节点（主要是路由器），而这些节点还在相互通信和交换信息。网络的状态总是 不断地变化着。可见，我们必须使用一种机制来读取这些节点上的状态信息，有时还要把一 些新的状态信息写入到这些节点上。 下而简单介绍网络管理模型中的主要构件（如图 6-20 所示）。 管理站又称为管理器，是整个网络愤理系统的核心，它通常是个有着良好图形界面的 高性能的工作站，并由网络管理员直接操作和控制。所有向被管设备发送的命令都是从管理 站发出的。管理站的所在部门也常称为网络运行中心 NOC (Network Operations Cen ter) 。管 • 306 •"}
{"doc_id": "network", "page": 318, "text": "理站中的关键构件是管理程序（如图 6-20 中有字母 M 的椭圆形图标所示）。管理程疗在运 行时就成为管理进程。管理站（硬件）或秤理程序（软件）都可称为管理者(manager) 或管 理器，所以这里的 manager 不是指人而是指机器或软件。网络管理员 (admi n i s tra t or) 才是指人。 大型网络往往实行多级管理，因而有多个管理者，而一个管理者一般只管理本地网络的设备。 I  互联网 !  、、一 ....  被管设备 岭 被行设备 夕 、 被管设备三－－究屯巴苍盂总巨｝·, Ll:[i  @—管理桯斤（运行 SNMP 客户程H) O —代理程序（运行 SNMP 服另器程厅） 图 6-20 网络管理的一般模型 被忤设备 |  在被管网络中有很多的被管设备（包括设备中的软件）。被管设备可以是主机、路由器、 打印机、媒线器、网桥或调制解调器等。在每一个被管设备中可能有许多被管对象 (Managed Obj ec t)。被管对象可以是被秤设备中的某个硬件（例如，一块网络接口卡），也可 以是某些硬件或软件（例如，路由选择协议）的配置参数的栠合。被管设备有时可称为网络 元素或简称为网元。在被管设备中也会有一些不能被管的对象（在下面的 6.7.2 节将会讲到 对象命名树，所谓不能被管的对象就是不在对象命名树上的对象）。 在每一个被管设备中都要运行一个程序以便和管理站中的节理程序进行通信。这些运 行着的程序叫作网络管理代理程序，或简称为代理(a gen t)（如图 6-20 中有字母 A 的几个椭 圆形图标所示）。代理程序在管理程序的命令和控制卜，在被管设备上采取本地的行动。 在图 6-20 中还有一个重要构件就是网络管理协议，简称为网管协议。后面还要讨论它 的作用。 简单网络管理协议 SNMP (Simple Network Management Pro tocol) 中的管理程序和代理程 序按客户服务器方式工作。管理程序运行 SNMP 客户程序，而代理程序运行 SNMP 服务器 程序。在被管对象上运行的 SNMP 服务器程序不停地监听来自管理站的 SNMP 客户程序的 请求（或命令）。一旦发现了，就立即返回昝押站所孟的信息，或执行某个动作（例如，把 某个参数的设置进行更新）。在网笘系统中往往是一个（或少数几个）客户程片与很多的服 务器程序进行交互。 关千网络管理有一个基本原理，这就是： 若要管理某个对象，就必然会给该对象添加一些软件或硬件，但这种“添加“对原有 对象的影响必须尽量小些。 SNMP 正是按照这样的基本原理来设计的。 SNMP 发布于 1988 年。 OSI 虽然在这之前就已制定出许多的网络管理标准，但当时 （到现在也很少）却没有符合 OSI 网管标准的产品。 SNMP 最氮要的指导思想就是要尽可 能简单。 SNMP 的基本功能包括监视网络性能、检测分析网络差错和配置网络设备等。在网 络正常～［作时， SNMP 可实现统计、配置和测试等功能。当网络出故陓时，可实现各种差错 检测和恢复功能。经过近二十年的使用， SNMP 不断修订完善，较新的版本是 SNMPv3, 而 • 307 •"}
{"doc_id": "network", "page": 319, "text": "前两个版本分别是 SNMPv2 和 SNMPvl 。但一般可简称为 SNMP 。 SNMPv3 最大的改进就 是安全特性。也就是说，只有被授权的人员才有资格执行网络管理的功能（如关闭某一条链 路）和读取有关网络忤理的信息（如读取一个配翌文件的内容）。然而 SNMP 协议已相当庞 大，一点也不“简单＂，整个标准共有八个 RFC 文档 [RFC 3411—3418, STD62] 。因此这里 只能给出一些最基本的概念。 若网络元素使用的不是 SNMP 协议而是另一种网络管理协议，那么 SNMP 协议就无法 控制该网络元素。这时可使用委托代理(p rox y a gen t)。委托代理能提供如协议转换和过滤操 作等功能对被管对象进行管理。 SNMP 的网络管理巾三个部分组成，即 SNMP 本身、管理信息结构 SMl (Structure of  Management In formati on) 和管理信息库 MIB (Management Infonna tion Base) 。下面简述这三 部分的作用。 SNMP 定义了管理站和代理之间所交换的分组格式。所交换的分组包含各代理中的对象 （变侣）名及其状态（值）。 SNMP 负责读取和改变这些数值。 SMT 定义了命名对象和定义对象类型（包括范围和长度）的通用规则，以及把对象和 对象的值进行编码的规则。这样做是为了确保网络管理数据的语法和语义无二义性。但从 SMI 的名称并不能看出它的功能。谓注意， SMI 并不定义一个实体应管理的对象数目，也 不定义被管对象名以及对象名及其侦之间的关联。 MIB 在被管理的实体中创建了命名对象，并规定了其类型。 为了更好地理解上述的几个组成部分，可以把它们和程序设计进行一下对比。 我们在编程时要使用某种语言，而这种语言就是用来定义编程的规则。例如，一个变 贵名必须从字母开始而后面接若是字母数字。在网络管理中，这些规则由 SMI 来定义。 在程序设计中必须对变量进行说明。例如，in t counter, 表示变量 coun t er 是整数类型。 MIB 在网络管理中就做这样的事情。 MIB 给每个对象命名，并定义对象的类型。 在编程中的说明语句之后，程序需要写出一些语句用来存储变揽的值，并在需要时改 变这些变址的值。协议 SNMP 在网络管珅中完成这件任务。 SNMP 按照 SMI 定义的规则， 存储、改变和解释这些已由 MTB 说明的对象的值。 总之， SMI 建立规则， MlB 对变量进行说明，而 SNMP 完成网管的动作。 下面就一一介绍上述的三个构件。 6.7.2 管理信息结构 SMI 管理信息结构 SMI 是 SNMP 的重要组成部分。根据 6.7.1 节所讲， SMl 的功能应当有 三个，即规定： (I) 被管对象应怎样命名； (2) 用来存储被管对象的数振类型有哪些： (3) 在网络上传送的管狸数据应如何编码。 1. 被管对象的命名 SMI 规定，所有的被管对象都必须处在对象命名树(obj ec t naming tree) 上。图 6-21 给出 了对象命名树的一部分。对象命名树的根没有名字，它的下面有三个顶级对象，都是世界上 著名的标准制定单位，即 ITU-T （过去叫作 CCITT) 和 ISO, 以及这两个组织的联合体，它 • 308 •"}
{"doc_id": "network", "page": 320, "text": "们的标号分别是 0 到 2 。图中的对象名习惯上用英文小写表示。在 ISO 的下面的一个标号为 3 的节点是 ISO 认同的组织成员 org。在其下面有一个美国国防部 dod (Department of  Defense) 的子树（标号为 6), 再下面就是i n terne t（标号为 l) 。在只讨论i n terne t中的对象时， 可只画出血emet以下的子树，并在internet节点旁边写上对象标识符1. 3.6.] 即可。 system(I) interfaces(2)  /1\\ /I\\  根 itu-t (0) is9 (1)  一个 org (3)  ^  dod.(6)  I  UIIerne1 (l )<;= 1.3.6.1 (iso.org.dod.ir1temet)  不mgmt (2)  .  m心2 (I) 令 1.3.6.1.2.1 (iso.org.dod.intemet.mgmt.mib-2)  了勹at(3) ip(4) icmp(5) tcp(6)  刀＼ 1 \\/ I \\f l \\  iplnRece ives(3) <::= 1.3.6.1.2. 1.4.3  udp(7) egp(8)...  /j\\ /1\\  图 6-21 SMI 规定所有被管对象必须在命名树上 在internet节点下面的标号为 2 的节点是 mg mt（管理）。再下面只有一个节点，即管理 信息库 mi b-2, 其对象标识符为1.3 .6. 1. 2.1 。在皿b-2 下面包含了所有被 SNMP 管理的对象 （见下面 6.7.3 节的讨论）。 2. 被管对象的数据类型 SMI 使用基本的抽象语法记法］ （即 ISO 制定的 ASN.1 (i))来定义数据类型，但又增加 了一些新的定义。因此 SMI 既是 ASN.1 的子集，又是 ASN.I 的超集。 ASN.1 的记法很严格， 它使得数据的含义不存在任何可能的二义性。例如，使用 ASN.l 时不能简单地说“一个具 有整数值的变僵＂，而必须说明该变量的准确格式和整数取值的范围。当网络中的计算机对 数据项并不都使用相同的表示时，采用这种精确的记法就尤其重要。 我们知道，任何数据都具有两种重要的属性，即值(value) 与类型(type) 。这里“值”是 某个值媒合中的一个元素，而“类型”则是值集合的名字。如果给定一种类型，则这种类型 的一个值就是该类型的一个具体实例。 SMI 把数据类型分为两大类：简单类型和结构化类型。简单类型是砓基本的、直接使 用 ASN.l 定义的类型。表 6-4 给出了最主要的几种简单类型。 ＠注： ISO 原以为还会制定出更多的抽象语法记法，但实际上到目前为止并没有第二个抽象语法记法出现． 1月此 ASN.I 似 应写为 ASN 。抽象语法只描述数据的结构形式且与具体的编码格式无关，同时也不涉及这些数据结构在计算机内如何存放． • 309 •"}
{"doc_id": "network", "page": 321, "text": "表 6-4 几种晟主要的简单类型 类型 大小 说明 INTEGER 4 字节 仕-2“ 到 231 一 1 之间的整数 lnlerger32 4 字节 和 INTEGER 相同 Unstgned32 4 字节 在 0 到 2l2_ I 之间的无符号敌 OCTET STRING 可变 不超过 65535 字节长的字节串 OBJECT IDENTIFIER 可变 对象标识符 IPAddress 4 字节 由 4 个整数组成的 IP 地址 Coun1cr32 4 字节 “I 从 0 增加到 2ll 的整数：．l，心到达最大伯时就返回到 0 Time Ticks 4 字节 记求时间的计数值，以 1/1 0-0秒为'rl 位 BITS 比特串 Opaque 可变 不解释的串 SMI 定义了两种结构化数据类型，即 se quence 和 se q uence o f。 数据类型 seq uence 类似于 C 语言中的 s truc t或 record, 它是一些简单数据类型的组合 （不一定要相同的类型）。而数据类型 se q uence o f类似于 C 语言中的 array,它是同样类型 的简单数据类型的组合，或同样类型的 sequence 数据类型的组合。 3. 编码方法 SMI 使用 ASN.I 制定的基本编码规则 BER (Basic Encoding Rule) 进行数据的编码。 BER 指明了每种数据的类型和值。在发送端用 BER 编码，可把用 ASN.1 所表述的报文转换成唯 一的比特序列。在接收端用 BER 进行解码，就可得到该比特序列所表示的 ASN.1 报文。 初吞起来，或许用两个字段就能表示类型和值。但由十表示伯可能斋要多个字节，因 此还需要一个指出“要用多少字节表示伯”的长度字段。因此 ASN.I 把所有的数据元素都 表示为 T-L-V 三个字段组成的序列（见图 6-22) 。 T 字段(Ta g)定义数据的类型， L 字段 (Len gth) 定义 V 字段的长度，而 V 字段 (Value) 定义数据的值。 字节 l 可变 可变 数据元素 1 标记 T I 长度 L I 伯 V I 类别 1 格式 1 编勺 位 2 5  图 6-22 用 TLV 方法进行编码 (1) T 字段又叫作标记字段，占 1 字节。 T 字段比较复杂，因为它要定义的数据类型较 多。 T 字段又再分为以下三个子字段： • 类别（ 2 位）共四种：通用类(00), 即 ASN.I 定义的类型；应用类(01), 即 SMI 定 义的类型；上下文类(10), 即上下文所定义的类型；专用类(11), 保留为特定厂商 定义的类型。 • 格式 (1 位）共两种，指出数据类型的种类：简单数据类型（0), 结构化数据类型 (I) 。 • 310 •"}
{"doc_id": "network", "page": 322, "text": "• 编号 (5 位）用米标志不同的数据类型。编号的范围一般为 0~30 。当编号大于 30 时， T 字段就要扩展为多个字节（这种悄况很少用到，可参考 ITU-T X.209, 这里 从略）。 表 6-5 是些数据类型的 T 字段的编码。 表 6-5 几种数据类型的 T 字段编码 数据类型 类别 格式 编号 T 字段（二进制） T 字段（十六进制） INTEGER 00 。 00010 00000010 02  OCTET STRING 00 。 00100 00000100 04  OBJECT IDENTIFIER 00 。 00110 00000110 06  NULL 00 。 00101 00000101 05  S 凶uencc. sequence of 00 1 10000 00110000 30  IPAddress 01 。 00000 01000000 40  Counter 01 。 00001 01000001 41  Gauge 01 。 00010 01000010 42  TimeTicks 01 。 00011 01000011 43  Opaque 01 。 00100 01000100 44  (2) L 字段又叫作长度字段（单乍节或多字节）。当 L 字段为单字节时，其蚊商位为 O, 后面的 7 位定义 V 字段的长度。节 L 字段为多个字节时，其最高位为I,而后面的 7 位定 义后续字节的字节数（用二进制熬数表示）。这时，所有的后续字节并究起来的二进制熬数 定义 V 字段的长度。图 6-23 给出了 L 字段的格式举例。 指出 V.r 段长度＝ 2 字节 ，＾、 ,r．字节的 L 字段田 o|o|o|o|ol1 |o|  指出后续字 li数＝ 2 指出 V 字段长度＝ 262 字 W ，人、--- 多字节的 L 字段 ”o|oIo 间 oII |oI |o|o|o|o|o|o|ohI |o|o|o|o|oI 仆 1|o| , 后纹字订数＝ 2- 图 6-23 L 字段的格式举例 (3) V 字段又叫作值字段，用千定义数据元素的值。 根据以上所述，我们给出两个用十六进制表示的编码例丘例如， INTEGER 15, 根捩 表 6-5, 其 T 字段是 02, 再根据表 6-4, fNTEG ER 类型耍川 4 字节编码。最后得出 TLV 编 码为 02 04 00 00 00 OF 。义如 IPAddress I 92. 1.2.3, lPAddress 的 T 字段是 40, V 字段需要 4 字节表示，因此.I PAddress 192.1.2.3 的 TLV 编码是 40 04 CO O I 02 03 。 TLY 方法中的 V 才段还可嵌套其他数据元素的 TLV 字段，并可多呕嵌套。 6.7.3 管理信息库 MlB 所谓“管理信息”就是指在互联网的网管框架中被管对象的集合。被管对象必须维持 可供管理程序读写的若干控制和状态信息。这些被管对象构成了一个虚拟的信息存储器，所 以才称为管理信息库 MIB 。管理程1子就使用 MIB 中这些伈息的值对网络进行管刑（如读取 或必新设置这些侦）。只有在 MIB 中的对象才是 SNMP 所能够管理的。例如，路由器应当 • 31 l •"}
{"doc_id": "network", "page": 323, "text": "维持各网络接口的状态、入分组和出分组的流量、丢弃的分组和有差错的报文的统计信息， 而调制解调器则应当维持发送和接收的字符数、码元传输速率和接受的呼叫等统计信息。因 此在 MlB 中就必须有上面这样一些信息。 我们再看一下图 6-21 ，可以找到节点 mi b-2 下面的部分是 M田子树。表 6-6 给出了节 点 m 心2 所包含的前八个信息类别代表的意思（在后面还有好几个类别）。 表 6-6 节点 m 心2 所包含的信息类别举例 类别 标号 所包含的信息 sys1cm (I) 主机或路由器的操作系统 inlerfaccs (2) 各种网络接口 address translation (3) 地址转换（例如， ARP 映射） 'P (4) IP 软件 icmp (5) ICMP 软件 tcp (6) TCP 软件 udp (7) UDP 软件 egp (8) EGP 软件 我们可以用个简单例子进一步说明 MlB 的意义。例如，从图 6-21 可以看出，对象甲 的标号是 4 。因此，所有与 IP 有关的对象都从前缀1. 3.6. 1. 2. 1. 4 开始。 (I) 在节点ip下面有个名为iplnRece i ves 的 MIB 变量（见图 6-21), 表示收到的[P数据 报数。这个变揽的标号是 3, 变揽的名字是：iso.org .dod. i n temet. mgmt. mib. ip.ipltl Recei ves, 而相应的数值表示是： 1.3.6.1.2.1 .4 .3 。 (2) 当 SNMP 在报文中使用 MIB 变堂时，对于简单类型的变量，后缀 0 指具有该名字 的变拯的实例。因此，当这个变爵出现在发送给路由器的报文中时，iplnRece i ves 的数值表 示（即变量的一个实例）就是： 1.3.6.1.2.1 .4 .3.0. (3) 请注意，对于分配给一个 MIB 变贷的数值或后缀是完全没有办法进行推算的，必 须查找已发布的标准。 上面所说的 MIB 对象命名树的大小并没有限制。下面给出若干 MIB 变揽的例子（见表 6-7), 以便更好地理解 MIB 的意义。这里的“变位”是指特定对象的一个实例。 表 6-7 MIB 变量的例子 MIB 变量 所辰类别 意义 sysUpTime system 距上次狠启动的时间 ,tNumber interfaces 网络接口数 ,tMm interfaces 特定接口的最大传送单元 MTU ipOefauhTTL ip IP 在生存时间字段中使用的们 iplnReccivcs ip 接收到的数据报数目 ipFonvDatagrams ip 转发的数据报数目 1pOutN0Routes ip 路山选择失败的数目 1pReasmOKs IP 觅装的数据报数目 ipFragOKs IP 分片的数据报数目 ipRoutingTable ip IP 路由表 icmplnEchos icmp 收到的 ICMP 回送诮求数目 • 312 •"}
{"doc_id": "network", "page": 324, "text": "续表 MIB 变量 所展类别 意义 tcpRtoM,n ICp TCP 允许的砓小戍传时间 tcpMaxConn ICp 允许的垃）,TCP 连接数 H tcplnSegs tcp 已收到的 TCP 报文段数 1 j udplnDatagrams udp 已收到的 UDP 数据报数 II 上面列举的大多数项目的值可用一个整数来表示。但 MIB 也定义了更复杂的结构。例如， MJB变豐ipRouti n gTable 则定义一个完整的路由表。还有其他一些 MIB 变量定义了路由表 项目的内容，并允许网络管理协议访问路由器中的单个项目，包括前缀、地址掩码以及下一 跳地址等。当然， MIB 变量只给出了每个数据项的逻辑定义，而一个路由器使用的内部数 据结构可能与 MlB 的定义不同。当～个查询到达路由器时，路由器上的代理软件负责 MTB 变批和路由器用于存储信息的数据结构之间的映射。 6.7.4 SNMP 的协议数据单元和报文 实际上， SNMP 的操作只有两种基本的管理功能，即： (])“读“操作，用 Get报文来检测各被管对象的状况： (2)” 写“操作，用 Se t报文来改变各被管对象的状况。 SNMP 的这些功能通过探询操作来实现，即 SNMP 管理进程定时向被管理设备周期性 地发送探询信息。上述时间间隔可通过 SNMP 的管理信息库 MIB 来建立。探询的好处是： 第一，可使系统相对简单：第二，能限制通过网络所产生的管理信息的通信址。但探询管理 协议不够灵活，而且所能管理的设备数目不能太多。探询系统的开销也较大。如探询频繁而 并未得到有用的报告，则通信线路和计符机的 CPU 周期就被浪费了。 但 SNMP 不是先全的探询协议，它允许不经过询问就能发送某些信息。这种信息称为 陷阱(trap),表示它能够捕捉”事件”。但这种陷阱信息的参数是受限制的。 当被管对象的代理检测到有事件发生时，就检查其门限值。代理只向管理进程报告达 到某些门限俏的事件（这就叫作过滤）。这种方法的好处是：第～，仅在严重事件发生时才 发送陷阱；第二，陷阱信息很简单且所盂字节数很少。 总之，使用探询（至少是周期性地）以维持对网络资源的实时监视，同时也采用陷阱 机制报告特殊事件，使得 SNMP 成为一种有效的网络管理协议． SNMP 使用无连接的 UDP, 因此在网络上传送 SNMP 报文的开销较小。但 UDP 是不保 证可靠交付的。这里还要指出， SNMP 使用 UDP 的方法有些特殊。在运行代理程序的服务 器端用熟知端口 16] 来接收 Get或 Se t报文和发送响应报文（与熟知端口通信的客户端使用 临时端口），但运行管理程序的客户端则使用熟知端口 162 来接收来自各代理的trap报文。 SNMP 现在共定义了如表 6-8 所示的 8 种类型的协议数据单元[RFC 3416, STD62), 其 中 PDU 编号为 4 的已经废弃了。在 PDU 编号后而是对应的 T 字段值（十六进制形式表示）。 表 6-8 SNMP 定义的协议数据单元类型 。气一号（ T 字段） 1 Ge1 ：二尸 I ，目砰者从代理读取个或一组变妇尸 • 313 •"}
{"doc_id": "network", "page": 325, "text": "续表 POU 编号 (T 字段） POU 名称 用途 l (A1) GelNcmReqlICSl 忭J小行从代坪认取 MIO H I 寻的卜．．个企从的伯（即仗 4 ；知迨此交点名也行）．此 橾仆 1II 反复进行，行别足f女UI）!lr ．．以收列«中的伯很}j使 2 (A2) Response 代开11i,J'j忖用者或管开＂＇；，）五、理行发达付／L 仲 Req u 心1 报义的响应．}1'从供及错 抖、J,.tn 从忐笘伈息 3 (A3 J Sc1Rcqucs1 管开＇，J．HI.开的个或匕个 MIB 变从的仇进行设罚 5 (A5) GctBulkRequcst 管押打从代咒读取人．改拟块的伯（如大的列及中的俏） 6 (A6) ln fonnR 凶UC` 许开片从＂士远仵许开，今议取该行开，拧:!,1 的代跸中的企杜仇 7 (A7l SNM 阳2Tra p 代开向竹埋占报告代即 1I'从生的计ii,i 'l 计牛 8 (A l!) Repon {I 忤J'I' 行之间报为某吹类刑的差悄． IIIlili',切人定义 和大多数 TCP/I P 协议不一样， SNMP 报文没有固定的字段。相反，它们使用标准 ASN.1 织码。因此， SNMP 报文川人［进行编码和理解时都比较闲难。为此，在图 6-24 中 给出f SNMPvl 的报文格式。可以和 1 i，一个 SNMP 报义共巾四个部分组成，即版本、首 部｀安全参数和 SNMP 报文的数据部分。目前垃新版本是版本 3 。首部包括报文标识 (message i den tifi ca ti on) 、垃大报文长度、报文标志（ message fl a g)。报文标志占 1 字节，其中 的匈·位定义安个类型或其他信息。女个参数） 11 米产生报文撕耍（见下一·辛的 7 .3 .1 ,1j)。 20' j'  II'  r,  fi关加密（，．i息的F 段 1  IP 敌拆报 UDP 玫剔报 SNMP 报文 SNMP 报文的数据部分 1 1 差销状态 1 岸错索引 1 名 1 俏 1 名 1 气··, 1-- M 部 ! 炒炽—寸 SNMP POU  图 6-24 SNMP 的报文格式 从图 6-24 可石出，在 SNMP POU 前曲还有两个什关加密估息的字段。这是当数据部分 ·1 /ri牧加密时才仗川的两个字段。与网络竹理直接相关的是后面的 SNMP POU 部分。对于表 6-8 给出的前四种 PDU 的格式都是相同的，即由 PDU 类型、请求 lD 、差错状态、差错索引 以及变量绑定这儿个字段组成。 PDU 的各种类型以及类型的编号和 T 字段的编码已在表 6-8 中给出。 下面简惮介绍一下其他字段的作用。 (I) 请求 ID (request ID) 巾竹狸进程设罚的 4 字节整数值。代理进程在发送响应报 文时也要返回此讷求 ID 。由 F管理进程可同时向许多代理发出请求读取变扭值的报文，因 此设f'l f汕求 ID 可使忤理进程能够识别返同的响应是对应J··哪一个诮求报文。 (2) 差错状态(error stallls) 在悄求报文中，这个字段是芬。当代理进程响应时，就填 入 0~18 中的一个数字。例如 0 表示 noError (切正常）， I 农示tooB ig（代理无法把回答 装入到个 SNMP 报文之中）， 2 表水 noSuchName （操作指明｛一个不存在的变阰）， 3 表 示 badYalue （尤效伯或无效话法），等等 [RFC 3416] 。 • 314 •"}
{"doc_id": "network", "page": 326, "text": "(3) 差错索引 (error index) 在请求报文中，这个字段是各。当代理进程响应时，若出 现 noSuchName, badYalue 或 readOnl y的差错，代理进程就设置一个整数，指明有差错的交 量在变址列表中的偏移。 (4) 变量绑定（var i able-b i nd i n gs) 指明一个或多个变量的名和对应的伯。在清求报文 中，变从的值应忽略（类型是 NULL) 。 为了大致了解 ASN.I 给出的定义的形式，下面举出定义 GetReq ues t -PDU 的例了。两个 连字符”--“正面的是注解。 Get-request-POU ::= (0)  JMPLICIT SEQUENCE {  --[O] 表示上下文类，编号为 0 －－类型是 SE Q UENCE request-id  error-status  ,  error-index  integer32,  INTEGER {0.. 18},  －－变卅 re q ues t-i d 的类型是i n t eg cr32 －－变械 error-s ta tus 取值为 0~18 的整数 INTEGER {O.. max-b i nd i ng s}, －－变扇 error- i ndex 取侦为 0 ~max-b i nd i n gs 的整数 vari able-bindings VarBindList } －－变拊 var i able-b i nd i n g的类型是 YarB i nd Li s t 但变翟 VarB i ndL i s t是什么类型呢？还需要继续定义（这里从略）。」而 ASN.I 定义中 的第二行中的 IMPLICIT 叫作隐式标记，是为了在进行编砃时可省去对 IMPLICIT 后面的类 型 (SEQUENCE) 的编码，使最后得出的编码更加简洁。 下面我们假定管理者发送 GetReq ues t -PDU, 为的是从某路由器的代理进程获得“收到 UDP 数据报的数目”的信息。从图 6-21 可以查出， mi b-2 下面第 7 个节点是 ud p,而 udp节 点下面的第一个节点就是 udpT nDatagrams 。由于这个节点已经是叶节点（即没有连接在它下 面的子节点了），读取这个节点的数值时应在节点标识符后面加上 o, 即 1.3. l. I.2. I.7. I.0 。这 样，可得出 Get Req ues t -PDU 的 ASN.l 编码，如图 6-25 所示。 OBJECT l~ENTIFIERI 。~I 。 I 03 0601 益。 I 01 01 00  I. 3. 6. I. 2. 1. 7. 1. 0  图 6-25 GetReq ues t-PDU 的 ASN.l 编码 可以把图中各字段的十六进制编码表示如下。 AOID  02 04 05 AE 56 02  02 01 00  02 01 00  30 OF  300D  -- GetReq ues t-PDU, 上下文类型，长度 I D16 = 29  -- INTEGER 类型，长度 0416• request-id= 05 AE 56 02  -- INTEGER 类型长度 0 I 16• error status= 0016  -- INTEGER 类型，长度 0 I 16' error index= 0016  -- SEQUENCE OF 类型，长度 OF16=15 --SEQUENCE 类型，长度 0D16 = 13  • 315 •"}
{"doc_id": "network", "page": 327, "text": "06 09 010306 0102010701 00 •• OBJECT IDENTIFIER 类型，长度 09161 udplnDatagrarns  05 00 •• NULL 类型，长度 0016 6.8 应用进程跨越网络的通信 在这以前我们已经讨论了互联网使用的几种常用的应用层协议，这些应用协议使广大 用户可以更加方便地利用互联网的资源。 现在的问题是：如果我们还有 些特定的应用需要互联网的支持，但这些应用又不能 自接使用已经标准化的互联网应用协议，那么我们应当做哪些工作？要回答这个问题，实际 上就是要了解下面要介绍的系统调用和应用编程接口。这些问题需要一门专门的课程来学习， 我们在这里只能给出一些初步的概念。 6.8.1 系统调用和应用编程接口 大多数操作系统使用系统调用 (s ys tem call) 的机制在应用程序和操作系统之间传递控制 权。对程序员来说，系统调用和一般程疗设计中的函数调用非常相似，只是系统调用是将控 制权传递给了操作系统。图 6-26 说明了多个应用进程使用系统调用的机制。 由应用程序调用的系统函数 包括 TCP/IP协议软件的橾作系统内核 在用户地址空间中 的应用程序 一系统调用接口 系统地址空间中 一的协议软件 图 6-26 多个应用进程使用系统调用的机制 当某个应用进程启动系统调用时，控制权就从应用进程传递给了系统调用接口。此接 口再把控制权传递给计算机的操作系统。操作系统把这个调用转给某个内部过程，并执行所 诮求的操作。内部过程一旦执行完毕，控制权就又通过系统调用接口返回给应用进程。总之， 只要应用进程衙要从操作系统获得服务，就要把控制权传递给操作系统，操作系统在执行必 要的操作后把控制权返还给应用进程。困此，系统调用接口实际上就是应用进程的控制权和 操作系统的控制权进行转换的一个接口。由于应用程序在使用系统调用之前要编写一些程序， 特别是需要设置系统调用中的许多参数，因此这种系统调用接口又称为应用编程接口 API (Application Programming In t er face) 。 API 从程序设计的角度定义了许多标准的系统调用函数。 应用进程只要使用标准的系统调用函数就可得到操作系统的服务。因此从程序设计的角度看， 也可以把 API 看成是应用程序和操作系统之间的接口。 现在 TCP/IP 协议软件已驻留在操作系统中。由千 TCP/IP 协议族被设计成能运行在多 种橾作系统的环境中，因此 TCP/IP 标准没有规定应用程序与 TCP/IP 协议软件如何接口的细 节，而是允许系统设计者能够选择有关 API 的具体实现细节。目前，只有几种可供应用程 序使用 TCP/IP 的应用编程接口 API 。这里最著名的就是美国加利福尼亚大学伯克利分校为 Berkeley UNIX 橾作系统定义的一种 APl ，它又称为套接字接口 (socke t in ter face) （或插口接 口）。微软公司在其操作系统中采用了套接字接口 API ，形成了一个稍有不同的 API ，并称 • 316 •"}
{"doc_id": "network", "page": 328, "text": "之为 Wi ndows Socket,简称为 Wi nSock 。 AT&T 为其 UNIX 系统 V 定义了一种 AP J,简写为 TLJ (Transport Layer In terfa ce) 。 我们知道，若要让计算机做某件事情，就要编写使计算机能理解的程序。在网络环境 下的计算机应用都有一个共同特点，这就是：位于不同地点的计算机要通过网络进行通信。 从另一种角度看，计算机之间的通信就是本计算机要读取另一个地点的计算机中的数据，或 者要把数据从本计算机写入到另一个地点的计算机中。这种“读取“和“写入＂的过程都要 用到上面所说的系统调用。 在讨论网络编程时常常把套接字作为应用进程和运输层协议之间的接口，图 6-27 表示 这一概念。图中假定了运输层使用 TCP 协议（若使用 UDP 协议，情况也是类似的，只是 UDP 是无连接的。通信的两端仍然可用两个套接字来标志）。现在套接字已成为计算机操作 系统内核的一部分。 飞勹 由操占尸n 户 I 客 服务器 l  图砬7 套接字成为应用进程与运输层协议的接口 请注意：在套接字以上的进程是受应用程序控制的，而在套接字以下的运输层协议软 件则是受计算机操作系统的控制。因此，只要应用程序使用 TCP/IP 协议进行通信，它就必 须通过套接字与操作系统交互（这就要使用系统调用函数）并诮求其服务。我们应当注总到， 应用程序的开发者对套接字以上的应用进程具有完全的控制，但对套接字以下的运输层却只 有很少的控制，例如，可以选择运输层协议（ TCP 或 UDP) 以及一些运输层的参数（如最 大缓存空间和最大报文长度等）。 当应用进程（客户或服务器）需要使用网络进行通信时，必须首先发出 socke t系统调 用，请求操作系统为其创建一个“套接字“。这个调用的实际效果是诸求操作系统把网络通 信所需要的一些系统资源（存储器空间、 CPU 时间、网络带宽等）分配给该应用进程。操 作系统为这些资源的总和用一个叫作套接字描述符(socke t descriptor) 的号码（小的整数）来 表示，然后把这个套接字描述符返回给应用进程。此后，应用进程所进行的网络操作（建立 连接、收发数据、调整网络通信参数等）都必须使用这个套接字描述符。所以，几乎所有的 网络系统调用都把这个套接字描述符作为套接字的许多参数中的第一个参数。在处理系统调 用的时候，通过套接字描述符，操作系统就可以识别出应该使用哪些资源来完成应用进程所 请求的服务。通信宪毕后，应用进程通过一个关闭套接字的 close 系统调用通知操作系统回 收与该套接字描述符相关的所有资源。由此可见，套接字是应用进程为了获得网络通信服务 而与操作系统进行交互时使用的一种机制。 图 6-28 给出了当应用进程发出 socke t系统调用时，操作系统所创建的套接字描述符与 套接字数据结构的关系。由于在一个进程中可能同时出现多个套接字，因此需要有一个存放 套接字描述符的表，而每一个套接字描述符有一个指针指向存放套接字的地址。在套接字的 • 3 I 7 •"}
{"doc_id": "network", "page": 329, "text": "数据结构中有许多参数要捎写。图 6-28 中已埴与好的参数足协议族 (PF_INET, 表示使用 In1emc1 的 TCP/IP 协议族）和服务 (SOCK_STREAM, 表示使用流式服务，也就是使用 TCP 服务）。在刚刚创建一个新的套接字时，有灰色背氛的四个项目（本地和远地 IP 地址， 本地和远地端门）都是未填弓的，因此它和任何机器中的应川进程暂时都还没有联系。 0:  I:  2:  3:  4:  I  仑接字描述符 K （母 个进程·个抽述符长） -- --. _  .  . . .  橾仆系纹 i？校字的数枢结构 图 6-28 调用 socke t创建仓接宁 这里要特别强调一下，在第 5 汽 5.3.2 节的垃后，我们曾指出，同一个名词 socket可表 示多种不同的意思。在本节讨论 socke t系统调用时，套接字 socke t已不仅仅是 RFC 793 所 定义的如公式(5-1)所示的那样，而是如图 6-28 右边所示的套接字的数躯结构。 6.8.2 儿种常用的系统调用 下而我们以使用 TCP 的服务为例介绍几种常川的系统调用。 1. 连接建立阶段 、 5 众接字被创建后，它的端口号和 IP 地址都是空的，因此应用进程要调用 b i nd （绑 定）米指明套桵字的木地地址（本地端 11 号和本地 IP 地址）。在服务器端调用 b i nd 时就是 把熟知端门号和本地 IP 地址埴写到己创建的套接字中。这就叫作把本地地址绑定到仓接字。 在客户端也可以不调用 b i nd, 这时由橾作系统内核自动分配少个动态端口号（通估结束后 由系统收回）。 服务器在调川 b i nd 后，还必须调川 l i s 七 en （收听）把在接字设凶为被动方式，以便 随时接受客户的服务请求。 UDP 服务器由千只提供儿连接服务．不使用li s 七en 系统调用． 服务器紧接抒就调用 acce pt（接受），以便把远地客户进程发来的连接请求提取出来。 系统调川 accept的一个变拉就是要指明足从哪一个套接字发起的连接。 调用 acce pt要完成的动作较多。这是因为一个服务器必须能够问时处理多个连接。 这样的服务器常称为并发方式(concurren t)工作的服务器。可以付多种方法实现这种井发方式。 图 6-29 所示的是一种实现方法。 中服务器进程 M （就足迪常所说的服务器进程）一调用 acce pt,就为每一个新的连 接清求创建一个新的套接字，并把这个新创建的仑接字的标识符返回给发起连接的客户方。 与此同时，主服务器进程还耍创建一个从屈服务器进程（如阳 6-29 中的 S1) 来处理新建立 的连桵。这样，从屈服务器进程用这个新创建的衣桵字和客户进程建立连接，而主）服务器进 • 318 •"}
{"doc_id": "network", "page": 330, "text": "程用原来的套接字亟新调用 accept,继续桵受下一个连接请求。在已建立的连接上，从屈 服务器进程就使用这个新创建的套接字传送和接收数据。数据通信结束后，从屈服务器进程 就关闭这个新创建的众接字，问时这个从屈服务器也被撤销。 主服务器进程 、· ` • 、、` ` 、、、、｀｀、｀、一、｀从屈服务器进程 、、、`、`、、` ` -、、、、｀～、仁 、、｀、、、仁、仁 接受连接消求：连接 连接 连接 的究接字 ；套接字 套接字 套接字 （原来的套接沪： 一（新创建的仓接字）一 图 6-29 并发方式__[作的服务器 ＿＿．服务器 应用进程 ～橾作系统 总之，在任一时刻，服务器中总是有一个主服务器进程和零个或多个从屈服务器进程。 主服务器进程用原来的套接字接受连接请求，而从屈服务器进程用新创建的套接字（在图 砬9 中注明是“连接套接字”)和相应的客户建立连接并可进行双向传送数据。 以上介绍的是服务器为了接受客户端发起的连接谓求而进行的一些系统调用。现在看 一下客户端的悄况。当使用 TCP 协议的客户已经调用 socke t创建了套接字后，客户进程 就调用 connec t,以便和远地服务器建立连接（这就是主动打开，相当千客户发出的连接 请求）。仕 connec t系统调用中，客户必须指明远地端点（即远地服务器的 IP 地址和端口 号）。 2. 数据传送阶段 客户和服务器都在 TCP 连接上使用 send 系统调用传送数据，使用 recv 系统调用接 收数据。通常客户使用 send 发送诮求，而服务器使用 send 发送回答。服务器使用 recv 接收客户用 send 调用发送的诸求。客户在发完请求后用 recv 接收回答。 调用 send 需要三个变量：数据要发往的套接字的描述符、要发送的数据的地址以及数 据的长度。通常 send 调用把数据复制到操作系统内核的缓存中。若系统的缓存已满， send 就暂时阻塞，直到缓存有空间存放新的数据。 调用 recv 也需要三个变昼：要使用的套接字的描述符、缓存的地址以及缓存空间的长 度。 3. 连接释放阶段 一旦客户或服务器结束使用套接字，就把套接字撤销。这时就调用 close 释放连接和 撤销套接字。 图 6-30 画出了上述的一些系统调用的使用顺序。有些系统调用在一个 TCP 连接中可能 会循环使用。 • 3 I 9 •"}
{"doc_id": "network", "page": 331, "text": "客户端 服务器端 socke t  l bi nd  i  socke t !i s.t en  i 叶ct••·· 一连接建立喟因. ．．可pt 二::(~ ···································~:『 recv __ send i ◄•.••....•••• --·······........ •••••• l  close close  图 6-30 系统调用使用顺片的例子 UDP 服务器由于只提供无连接服务，因此不使用 l i s t en 和 accept系统调用。 6.9 P2P 应用 我们在第 1 草的1.3 .1 节中已经简单地介绍了 P2P 应用的概念。现在我们将进一步讨论 P2P 应用的若干工作原理。 P2P 应用就是指具有 P2P 体系钻构的网络应用。所研 P2P 体系结构就是在这样的网络 应用中，没有（或只有极少数的）固定的服务器，而绝大多数的交互都是使用对等方式 (P2P 方式）进行的。 P2P 应用的范围很广，例如，文件分发、实时音频或视频会议、数据库系统、网络服务 支持（如 P2P 打车软件、 P2P 理财等）。限于篇幅，下面只介绍最常用的 P2P 文件分发的工 作原理。 P2P 文件分发不衙要使用集中式的媒体服务器，而所有的音频／视频文件都是在普通的 互联网用户之间传输的。这其实是相当千有很多（有时达到上百万个）分散在各地的媒体服 务器（由普通用户的计算机充当这种媒体服务器）向其他用户提供所要下载的音频／视频文 件。这种 P2P 文件分发方式解决了媒中式媒体服务器可能出现的瓶颈问题。 目前在互联网流量中， P2P 工作方式下的文件分发已占据了最大的份额，比万维网应用 所占的比例大得多。因此单纯从流量的角度看， P2P 文件分发应当是互联网上最亟要的应用。 现在 P2P 文件分发不仅传送音频文件 MP3, 而且还传送视频文件 (10~1000 MB, 或更大）、 各种软件和图像文件。 6.9.1 具有集中目录服务器的 P2P 工作方式 最早使用 P2P 工作方式的是 Naps ter 。这个名称来自 1999 年美国东北大学的新生 Shawn Fann i ng所写的一个叫作 Naps ter 的软件。利用这个软件就可通过互联网免费下载各种 MP3 • 320 •"}
{"doc_id": "network", "page": 332, "text": "音乐。 Nap s ter 的出现使 MP3 成为网络音乐事实上的标准＇＇。 Naps ter 能够搜索音乐文件，能够提供检索功能。所有音乐文件的索引信息都块中存放 在 Nap s ter 目录服务器中。这个目录服务器起着索引的作用。使用者只要查找目录服务器， 就可知道应从何处下载所要的 MP3 文件。在 2000 年， Naps ter 成为互联网上最流行的 P2P 应用，并占据互联网上的通信址中相当大的比例。 这里的关键就是运行 Naps ter 的所有用户，都必须及时向 Nap s ter 的目录服务器报告自 己已经存有哪些音乐文件。 Nap ster 目录服务器就用这些用户信息建立起一个动态数据库， 集中存储了所有用户的音乐文件信息（即对象名和相应的 IP 地址）。当某个用户想下载某个 MP3 文件时，就向目录服务器发出查询（这个过程仍是传统的客户－服务器方式），目录服 务器检索出结果后向用户返回存放这一文件的计算机 lP 地址，千是这个用户就可以从中选 取一个地址下载想要得到的 MP3 文件（这个下载过程就是 P2P 方式）。可以看出， Naps ter 的文件传输是分散的 (P2P 方式），但文件的定位则是集中的（客户－服务器方式）。 图 6-31 是 Naps ter 的工作过程的示意图。假定 Nap s ter 目录服务器已经建立了共用户的 动态数据库。图中给出了某个用户要下载音乐文件的主要交互过程。 Na ps t cr 其中式 目录服务器 、 “- I  ::J  IA  一 I I B  勹 le  ~1  图 6-3 I Nap ster 的工作过程 0 用户 X 向 Nap s ter 目录服务器查询（客户～服务器方式）谁有文件 MP3# 。 8 Nap s ter 目录服务器回答 X: 有三个地点有文件 MP3#, 即 A, B 和 C （给出了这三个 地点的 IP 地址） C 千是用户 X 得知所需的文件 MP3＃的三个下载地点。 0 用户 X 可以随机地选择三个地点中的任一个，也可以使用 PING 报文寻找最方使下 载的一个。在图 6-31 中，我们假定 X 向 A 发送下载文件 MP3 ＃的诸求报文。现在 X 和 A 都使用 P2P 方式通信，互相成为对等方， X 是临时的客户，而对等方 A 是 临时的服务器。 0 对等方 A （现在作为服务器）把文件 MP3＃发送给 X 。 这种集中式目录服务器的最大缺点就是可靠性差，而且会成为其性能的瓶颈（尤其是 在用户数非常多的情况下）。更为严重的是这种做法侵犯了唱片公司的版权。虽然 Naps ter 网站并没有直接非法复制任何 MP3 文件 (Naps ter 网站不存储任何 MP3 文件，因而并没有 ＠注：通常 CD 光盘中的音乐都采用四＼，格式．即采用标准的 PCM 编码． MP3 则进行了压缩，把一些人几朵不人能够听 出来的部分频率分杂压缩掉了．压缩比一般在 I :4 到 I :12 之间，例如，压缩比为 I: 10 就表明 10MB 的 wa ＼，格式音乐．可儿缩成 I MB 的 MP3 格式，而名质的下降并不太明显． • 321 •"}
{"doc_id": "network", "page": 333, "text": "自接仗犯版权），但法院还是判决 Naps ter 屈千“间接佼砉版权”，因此在 2000 年 7 月底 Na p s t er 网站就披迫关闭了。 6.9.2 具有全分布式结构的 P2P 文件共享程序 什笫一代 P2P 文件共享网站 Naps ter 关闭后，开始出现f以 Gnu tella 为代表的第二代 P2P 义件共学程序。 Gnutella 是一种采用全分布方法定位内容的 P2P 文件共享应用程序。 Gnut ella 与 Nap s ter 最大的区别就是不使用集中式的目录服务器进行查询，而是使用洪泛法 在大整 Gnut ella 用户之间进行查询。为了不使查询的通信批过大， Gnut ella 设计了一种有限 范围的洪泛查询。这样可以减少倾注到互联网的查询流揽，但由于查询的范围受限，因而这 也影响到杳询定位的准确性。 为了更加有效地在大扭用户之间使用 P2P 技术下载共享文件，最近几年已经引发出很 多种第二代 P2P 共享文件程序[KUR017), 它们使用分散定位和分散传输技术。如 KaZaA, 屯骡 eMule, 比特洪流 BT (Bit Tomn t)等。 卜伽对比特洪流 BT 的主要特点进行简单的介绍。 在 P2P 的文件分发应用中， 2001 年由 Brahm Cohen 开发的 B itTorrent（中文意思是“比 特洪流”)是很具代表性的一个。取这个名称的原因就是 B itTorren t把参与某个文件分发的 所行对等方的梊合称为一个洪流（torren t）。为了方便，下而我们使｝ll B itTorren t的简称 BT 。 BT 把对等方下载文件的数据单元称为文件块（chunk), 一个文件块的长度是固定不变的，例 如，典型的数值是 256 KB 。当一个新的对等方加入某个洪流时，一开始它并没有文件块。 们新的对等方逐渐地能够下载到一些文件块。而与此同时，它也为别的对等方上传一些文件 块。某个对哼方获得了整个的文件后，可以立即退出这个洪流（相当于自私的用户），也可 继续留在这个洪流中，为其他的对等方上传文件块（相节于无私的用户）。加入或退出某个 洪流可在任何时间完成（即使在某个文件还没有下载完毕时），也是完全自由的。 BT 的协议相当复杂 [W-BT] 。下面讨论其基本机制。 每个洪流都有一个基础设施节点，叫作追踪器(tracker) 。当一个对等方加入洪流时， 必须向追踩器登记（或称为注册），并周期性地通知追踪器它仍在洪流中。追踪器因而就跟 踪1，洪流中的对等方。一个洪流中可以拥有少到几个多到几百或几于个对等方。 我们用图 6-32 来进一步说明 BT 的工作原理。当一个新的对等方 A 加入洪流时，追踪 器就随机地从参与的对等方集合中选择若干个（例如， 30 个），并把这些对等方的 lP 地址 告诉 A 。于是 A 就和这些对等方建立了 TCP 连接。我们称所有与 A 建立了 TCP 连接的对 等力为”相邻对等方 ”(neig hbori n g p eers) 。在图 6-32 中我们在上面的覆盖网络中画出了 A ｛l.:. 个相邻对等方 (B, C 和 D) 。这些相邻对等方的数目是动态变化的，有的对等方可能不 久就离开f，但不久后又有新加入进来的对等方。请注意，实际的网络拓扑司能是非常复杂 的（参见图 6-32 悛盖网络下面的实际网络图）。我们知道， TCP 连接只是个逻辑连接，而每 一个 TCP 连接可能会穿越很多的网络。因此我们在讨论问题时，可以利用实际网络上面的 个更加简洁的覆盖网络，这个覆盖网络忽略了实际网络的许多细节，使问题的讨论更加方 使。在设盖网络中， A 的三个相邻对等方就看得很清楚。 妇T 何时刻，匈一个对等方可能只拥有某文件的一个文什块子集，而不同的对等方所 拥有的义件块f集也不会完全相间。对等方 A 将通过 TCP 连接周期性地向其和邻对等方索 取它们拥有的文件块列表。根据收到的文什块列表， A 就知道了应当诸求哪一个相邻对等方 • 322 •"}
{"doc_id": "network", "page": 334, "text": "把哪些自己缺少的文件块发送过来。 ＿追踪器 勹 , ;、、•， \\ [ ｀、． ．＼、 实际网络 ` - C『；． V- 、｀ ` ／久） \\、,. 4,  :  仓； D`','  , ,1.{,','I.  ,  ，合 , ,'  .,'  ,.  ,.  ，合 .i 7.,  ..  ,.,.,'`  .  ,'  ,'  , .  ..  •  悛盖网络 图 6-32 在投盖网络中对等方的相邻关系的示意图 图 6-33 是对等方之间互相传送数据块的示意图。例如， A 向 B 、 C 和 D 索取数据块， 但 B 同时也向 C 和 D 传送数据块， D 和 C 还互相传送数据块。由于 P2P 对等用户的数忧非 常多，因此，从不同的对等方获得不同的数据块，然后组装成整个的文件，一般要比仅从一 个地方下载整个的文件要快很多。 对等方 A ／［二＼＼、玉专送 —尸xt等方 C ] \\ 对等方 D 图 6-33 对等方之间互相传送文件数据块 然而 A 必须做出两个重要决定。第一，哪些文件块是首先需要向其相邻对等方诸求的？ 第二，在很多向 A 谘求文件块的相邻对等方中， A 应当向哪些相邻对等方发送所请求的文 件块？ 对于第一个问题， A 要使用叫作最稀有的优先（rares t fi rs t)的技术。我们知道，凡是 A 所 缺少的而正好相邻对等方已拥有的文件块，都应当去索取。可能其中的某些文件块，很多相 邻对等方都有（即文件块的副本很多），这就是“不稀有的“文件块，以后可慢慢请求。如 果 A 所缺少的文件块在相邻对等方中的副本很少，那就是“很稀有的＂。因此， A 首先应当 诮求副本最少的文件块（即最稀有的）。否则，一旦拥有最稀有文件块的对等方退出了洪流， 就会影响 A 对所缺文件块的收集。 对于第二个问题， BT 采用了一种更加机灵的算法，其基本思想就是：凡当前有以最高 数据率向 A 传送文件块的某相邻对等方， A 就优先把所请求的文件块传送给该相邻对等方。 具体来说， A 持续地测铅从其相邻对等方接收数据的速率，并确定速率最高的 4 个相邻对等 方。接着， A 就把文件块发送给这 4 个相邻对等方。每隔 10 秒钟， A 还要重新计算数据率， • 323 •"}
{"doc_id": "network", "page": 335, "text": "然后可能修改这 4 个对等方。在 BT 的术语中，这 4 个对等方叫作已疏通的或无障碍的 (unchoked) 对等方。更重要的是，每隔 30 秒， A 要随机地找一个另外的相邻对等方 B, 并向 其发送文件块。这样， A 有可能成为 B 的前 4 位上传文件块的提供者。在此情况下， B 也 有可能向 A 发送文件块。如果 B 发送文件块的速率足够快，那么 B 也有可能进入 A 的前 4 位上传文件块的提供者。这样做的结果是，这些对等方相互之间都能够以令人满意的速率交 换文件块。 6.9.3 P2P 文件分发的分析 我们从一个例子开始，来讨论 P2P 文件分发中的几个重要概念 [KUR017] 。 在图 6-34 中，有 N 台主机要从互联网上的服务器下载一个大文件，其长度为 Fb仆。在 图中我们把这个文件也记为 F。按照习惯，从互联网传送数据到主机，叫作下载（download), 而反过来传送数据，即从主机向互联网传送，则称为上传(u p load) 或上载。服务器的文件是 供互联网上的用户享用的，因此服务器的文件只是单方向上传到互联网。我们把服务器的上 传速率记为 Us, 单位是 bit/s 。再假定上机与互联网连接的链路的上传速率和下载速率分别为 u ，和 d;, 单位都是 bit/s 。我们还假定互联网的核心部分不会产生拥塞。瓶颈只会发生在服务 器的接入链路，或者是某些主机的接入链路。 J III  \\  j_  ～飞～ \\  互联网 ／占 ) 文件 F i 1,  喝 服务器 J// , I 4  图 6-34 文件分发的例f 我们先在传统的客户－服务器方式下，计算给所有主机分发完毕的最短时间 T酐 从服务器端考虑， N 台主机共需要从服务器得到的数据总拯（比特数）是 NF。如果服 务器能够不停地以其上传速率 Us 向各主机传送数据，一直到各主机都收到文件 F, 就需要 时间 NF/u5, 单位是秒。由此可见， TCS 不可能小千 NF/u砰 如果 N 台主机都以各自的下载速率不停地下载文件 F, 那么下载速率最慢的主机（设 其下载速率为 dmi n) 的下载文件时间 (F/dm i n), 将是 N 个下载时间中最大的一个。由此可见， 几也不可能小千 Fldmi n• 如果 NF/us ~ Fldmi n• 则瓶颈在服务器端的接入链路。这时 Tes= NF/u砰 如果 Fldm i n ~ NF/u5, 则瓶颈在下载最慢的主机的接入链路。这时 Tes= Fldmin•  • 324 •"}
{"doc_id": "network", "page": 336, "text": "由此可得出所有主机都下载完文件 F 的最少时间是 几＝ max ｛芒，二｝ (6-2)  从以上分析可以看出，若公式(6-2) 括号中的第一项大于第二项，则 Tes 就与主机数 N 成 正比。如果主机数增大 l000 倍，那么文件的分发时间也要增大 1000 倍． 下面讨论在 P2P 方式下，文件全部分发完毕的最少时间 TP2P 。然而在 P2P 方式下，文 件分发所需的时间较难计算，这是因为每一台主机在接收文件的同时，还利用自己的上传能 力向其他主机传送文件。文件传送所需的时间取决于主机向对等方传送文件的具体方式。但 是，我们还是可以导出文件分发所需的敬少时间的表达式。 在文件分发开始时，只有服务器有文件 F。服务器必须把文件 F 的每一个比特通过接入 链路传送到互联网（至少要传送一次）。因此文件分发的最少时间不可能小于 Flus 。和客户－ 服务器方式相比，在 P2P 方式下，服务器不需要一遍一遍地发送文件 F, 因为互联网上的其 他主机（即对等方）可以代替服务器向其他对等方分发文件 F。 在 P2P 方式下，下载速率最慢的主机（设其下载速率为 dnun) 下载文件 F 的时间是 F/dnun, 这是 N 个对等方下载时间中最大的一个。可见文件分发的最少时间不可能小千 Fldmi n 。这个 结论和客户～服务器方式是一样的。 整个系统中所有主机（包括服务器）的上传速率之和是 UT= Us+ tit+ U2 +... +UN。因此， 文件分发的最少时间也不可能小于 NF/uTo 这样，我们得出在 P2P 方式下所有主机都下载完文件 F 的最少时间的下限是 Tm~ max{f,亡勹｝ (6-3)  在公式(6-3) 的推导过程中，我们假定每一个对等方只要收到一个比特就立即上传到互 联网的其他对等方。但实际上是把收到的若干个比特组成一个数据块后再上传出去。但是当 文件 F 很大时，我们也可以在公式(6-3) 中取等号，作为文件 F 的最少分发时间 TP2P 的近似 值。 有一种情况最值得我们注意。这就是对等方的数目 N 非常大，因此在公式(6-3) 的括号 中的最后一项的值将大于前两项的值。这样， TP2P 值的下限就近似为 NF/uTo 我们再假定一些数据。设所有的对等方的上传速率都是 U, 并且 Flu= 1 小时，所有对 等方的下载速率都不小千服务器的上传速率，因而不会对我们的计算产生影响。我们再设服 务器的上传速率 Us= lOu 。当 N=30 时，用公式(6-3) 算出所有主机都下载完文件 F 的最少时 间的下限是 Trir = 0.75 Flu = 0.75 小时（这个数值一定小于 1 小时）。如果采用客户－服务器 方式，则当 N=30 时，所有主机都下载完文件 F 的最少时间是 Tes= NF/u5 = 3 小时。 6.9.4 在 P2P 对等方中搜索对象 在 P2P 文件系统中，对等方用户的数扭非常多，并且处于一种无序的状态。任何一个 对等方可以随时加入进来或随时退出。在这种情况下，怎样有效地找到所需的文件，也就是 怎样有效地定位对等方及其资源，乃是 P2P 系统中的一个十分重要的问题。 限于篇幅，我们在这里只简单介绍一下怎样利用散列函数来定位对等方。 • 325 •"}
{"doc_id": "network", "page": 337, "text": "我们知道， Gnutella 是一种采用全分布方法定位内容的 P2P 文件共享应用程序，它解决 了集中式目录服务器所造成的瓶颈问题。然而 Gnutella 是在非结构化的覆盖网络中采用查询 洪泛的方法来进行查找的，因此查找的效率较低。现在比较好的查找方法是设法构建一种分 布式数据库，以进行对等方及其资源的定位。这种分布式数据库在概念曰并不复杂，只要能 够支持大员对等方（可能有几百万个）进行索引查找即可。存储在数据库中的信息只有两个 部分： (I) 要查找的资源名 K （例如，电影或歌曲的名字）。资源名也可称为关键字。 (2) 存放该对象的节点的 IP 地址 N 。有的 IP 地址还附带有端口号。 存放在数据库中的信息就是大量成对出现的（资源名 K, 节点的 IP 地址 N) 。在查找某 资源名 K 时，只要在数据库中查找到匹配的资源名 K, 数据库就能够返回对应的节点的 IP 地址 N 。所以问题的关键就是要设法把每个资源名 K 存放在一个非常便千查找的地方。 细心的读者可能会联想到曾在前面 6.1 节讨论的 DNS 域名系统。 DNS 是根据主机的域 名来查找其 lP 地址，这和 P2P 的情况有相似之处。但我们知逍，主机的域名是结构化的命 名系统，因此域名服务器可以划分为几种不同的级别（如根服务器等）便千查找。但 P2P 系统则不同，其资源名是非结构化的。因此不能套用 DNS 的那种查找方法。 前面已经讲过， Nap s ter 在一个集中式目录服务器中构建的查找数据库虽然很简单，但 性能上却有瓶颈。在 P2P 系统中，应怎样构建分布式的 P2P 数据库？让每个对等方都拥有 所有对等方 IP 地址的列表是不可行的。让所有成对出现的（资源名 K, IP 地址 N) 随机地分 散到各对等方也是不可行的。因为这将使查找对象的次数过大，无法使用。现在广泛使用的 索引和查找技术叫作分布式散列表 DHT (Distributed Hash Table) 。 DHT 也可译为分布式哈希 表，它是由大址对等方共同维护的散列表。基于 DHT 的具体符法已有个少，如 Chord, Pastry, CAN (Content Addressable Network), 以及 Kadem i l i a 等。下面简单介绍广泛使用的 Chord 绊法，这是美国麻省理工大学于 2001 年提出的 [STOJO I] 。 分布式散列表 DHT 利用散列函数，把资源名 K 及其存放的节点 IP 地址 N 都分别映射 为资源名标识符 KID 和节点标识符 NTD 。如果所有的对等方都使用散列函数 SHA-I （我们 在下一竞 7.3.1 节还要介绍 S 1-lA-l 在网络安全方面的应用），那么通过散列得出的标识符 KID 和 NID 都是 160 位二进制数字，且其数值范围在 [O, 2160 - I] 之间。虽然从理论上讲，散 列函数 SHA-I 是多对一的函数，但实际上不同输入得到相同的输出的概率是极小的。此外， 通过 SHA-l 映射得到的标识符能够比较均匀而稀疏地分布在 Chord 环上。为便千讨论，我 们假定现在标识符只有 5 位二进制数字，也就是说，所有经散列函数得出的标识符的数值范 闱都在(0, 31] 之间。 Chord 把节点按标识符数值从小到大沿顺时针排列成一个环形蹬盖网络 （见图 6-35(a)), 并按照下面的规则进行映射： (1) 节点标识符 NID 按照其标识符值映射到 Chord 环上对应的点，见图 6-35(a) 中标有 NID 的小圆点，如 N4, N7, NI 0, N20, N26 和 N30 。 (2) 资源名标识符 KID 则按照其标识符值映射到与其伯最接近的下一个 NID, 见图 6-36(a) 中标有 KlD 的小方块。所谓“最接近的下一个 “NID 就是指：从 KID 值开始，按顺时针方 向沿 Chord 环遇到的下一个 NID 。例如， K31 和 K2 应放在 N4, 因为在环上从 31 和 2 按顺 时针方向遇到的下一个 NID 是 N4 。同理， K8, Kl2, K23 和 K29 应分别放在 NI 0, N20, N26  和 N30 。如果碰巧同时出现K.29 和 N29 （这种概率极小），那么K.2 9 就应当放在 N29 。 请注意：在图 6-35 中， K31 和 K2 都放在 N4, 这表示要查找存放资源 K31 或 K2 的节 • 326 •"}
{"doc_id": "network", "page": 338, "text": "点的 IP 地址，就应当到节点 N4 去杳找。请注意，资源 K31 和 K2 并非存放在节点 N4 。 这就是说，每个资源由 Chord 环上与其标识符值最接近的下一个节点提供服务。我们 再强调一下， Chord 坏并非实际的网络。在 Chord 环上相邻的节点，在地理上很可能相距非 常远。 ,  7 N 70  J. \\. `} ，三. . .i 。飞 U  弓召＄｀ 221 乙、 志 l 图例： 0 NID  0 klD  7  ?-  (a) KID 和 NID 映射在环上 (b) Nl3 加入， N26 退出 图 6-35 基十 DHT 的 Chord 环 Chord 环上的每一个节点都要维护两个指针变黛，一个指向其后继节点，而另一个指向 其前任节点。例如，在图 6-35(a) 中， NIO 的后继节点是 N20 (N J O 沿顺时针方向的下一个 节点），其前任节点是 N7 (N J O 沿逆时针方向的前一个节点）。如果一个新的节点 Nl3 加入 进来，那么 N20 的前任节点就变为 N J 3, 因而 Kl2 就要从 N20 的位置移到 Nl3, 同时 NlO 的后继节点就变为 Nl3 （见图 6-35(b)) 。此外，如果节点 N26 退出，那么 K23 就要移到 N30, 而 N30 的前任节点就变为 N20, 同时 N20 的后继节点变为 N30 。 在这样的 Chord 环上查找资源，从理论上讲，任何一个节点，只要从其后继节点一个 个地遍历查找下去，一定可以找到所查询的资源。可见要定位一个资源，平均油要沿环发送 查找报文 N/2 个，或遍历 O(N)个节点 (N 为环上的总节点数）。显然，这种顺序查找的方法 效率很低。 为了加速查找，在 Chord 环上可以增加一些指针表(fi n ger table), 它又称为路由表或查 找器表。若 Chord 环上的标识符有 m 位（现在 m = 5), 则在节点 n 上的指针表可设置不超 过 m 个指针，指向其后继的节点。我们先看图 6-36 中节点 N4 的指针表。指针表中的第 2 列是从 N4 可以指向的多个后继节点。本来每一个节点仅仅指向沿顺时针方向的下一个后继 节点，但现在则指向多个后继节点（在本例中就是 N7, NIO 和 N20) 。第 1 列的第 L 行是计 算 (N4 + i -1), 用来得出后继节点。例如，第 4 行i = 4, 算出 (N4+ i -1) =N4+8= 12,  而 Chord 坏上的节点 12 的后继节点是 N20 。图中还画出了从 N4 到这几个后继节点的连线 （这些连线就是 Chord 环上的弦， Chord 名字由此得出）。还有一点要注总的是，在 N20 的 指针表中的第 5 行， N20+ 16=36, 但按照模 25 运算， 36 mod 25 = 4, 恰好节点 4 的后继节 点是 N4 。 假定在图 6-36 中的节点 N4 要查找 K29 。如果用遍历各节点的方法，则要查找 5 次， 即 N7-Nl0 一 N20-N26-tN30 。但若利用指针表，则 N4 首先在自己的指针表中寻找在不 到 29 且最接近 29 的节点，即 N20, 然后把定位资源 K29 的清求发送给 N20 。在 N20 的指 针表中继续类似的寻找。结果是：最接近 29 的节点是 N30 。这就是存放资源 K29 的节点。 这种查找方法类似于二分查找，只用了两次查找，定位一·个资源仅需 O(l og2 N)步。 • 327 •"}
{"doc_id": "network", "page": 339, "text": "1针例： 0 NID  OKID .__.:  N2  N4 的指针及 图 6-36 节点 N4 和 N20 的指针表 在 P2P 网络中，对等方可能相当频紧地加入或退出系统，这就盂要很好地维护这个分 布式数据库（维护各节点的指针和指针表），而这种维护的工作址可能会很大。当对等方数 贵非常大时，究竞采用何种查询机制更加合理，则需要根据具体情况来确定。 P2P 技术还在不断地改进，但随杆 P2P 文件共享桯序日益广泛地使用，也产生了一系 列的问题有待于解决。这些问题已迫使人们要重新思考下一代互联网应如何演进。例如， 音频／视频文件的知识产权就是其中的一个问题。又如，当非法盗版的、或不健康的音频／视 频文件在互联网上利用 P2P 文件共享程序广泛传播时，要对 P2P 的流批进行有效的管理， 在技术上还是有相当的难度。由于现在 P2P 文件共享程序的大拱使用，已经消耗了互联网 主干网上大部分的带宽。因此，怎样制定出合理的收费标准，既能够让广大网民接受，又能 使网络运营商赢利并继续加大投入，也是目前迫切需要解决的问题。 本章的重要概念 • 本章所讨论的应用程序是为了解决互联网上的某一类应用问题的软件，而这些应用 问题的解决又必须通过位于不同主机中的多个应用进程之间的通信和协同工作来完 成。应川层协议规定了应用进程在通信时所遵循的各种规则。应用层协议是为应用 程序的实现服务的． • 应用层的许多协议都是基千客户服务器方式的。客户足服务谐求方，服务器是服务 提供方。 • 域名系统 DNS 是互联网使用的命名系统，用来把便卜人们使用的机器名字转换为 IP 地址。 DNS 是一个联机分布式数据库系统，并采川客户服务器方式。 • 域名到 IP 地址的斛析是由分布在互联网上的许多域名服务器程序（即域名服务器） 共同完成的． • 互联网采用层次树状结构的命名方法，任何一台连接在互联网上的主机或路由器， 都有一个唯一的层次结构的名字，即域名。域名中的点和点分十进制 IP 地址中的 点没有对应关系。 • 域名服务器分为根域名服务器、顶级域名服务器、权限域名服务器和本地域名服 务器。 • 文件传送协议 FTP 使用 TCP 可靠的运输服务。 FTP 使用客户服务器方式。一个 FTP 服务器进程可同时为多个客户进程提供服务。在进行文件传输时， FTP 的客户和服 务器之间要建立两个井行的 TCP 连接：控制连接和数据连接。实际用于传输文件 • 328 •"}
{"doc_id": "network", "page": 340, "text": "的是数据连接。 • 万维网 WWW 是一个大规模的、联机式的信息储藏所，可以非常方便地从互联网 上的一个站点链接到另一个站点。 • 万维网的客户程序向互联网中的服务器程序发出请求，服务器程序向客户程序送回 客户所要的万维网文档。在客户程序主窗口上显示出的万维网文档称为页面。 • 万维网使用统一资源定位符 URL 来标志万维网上的各种文档，并使每一个文档在整 个互联网的范围内具有唯一的标识符 URL 。 • 万维网客户程序与服务器程序之间进行交互所使用的协议是超文本传送协议 HTTP 。 HTTP 使用 TCP 连接进行可靠的传送。但 HTTP 协议本身是无连接、无状态的。 HT「P/ 1. 1 协议使用了待续连接（分为非流水线方式和流水线方式）。 • HTTP/2 可使用同一个 TCP 连接把服务器发回的响应并行发回；允许客户复用 TCP 连接进行多个清求：把所有的报文划分为许多较小的二进制编码的帧，采用新的压 缩算法，不发送重复的首部字段，大大减小了首部的开销，提高了传输效率。 • 万维网使用超文本标记语言 HTML 来显示各种月维网页面。 • 万维网静态文档是指在文档创作完毕后就存放在万维网服务器中，在被用户浏览的 过程中，内容不会改变。动态文档是指文档的内容是在浏览器访问万维网服务器时 才由应用程序动态创建的。 • 活动文档技术可以使浏览器屏幕连续更新。活动文档程序可与用户直接交互，并可 连续地改变屏幕的显示。 • 在万维网中用来进行搜索的工具叫作搜索引来。搜索引浓大体上可划分为全文检索 搜索引挚和分类目录搜索引求两大类。 • 电子邮件是互联网七使用砐多的和垃受用户欢迎的一种应用。电子邮件把邮件发送 到收件人使用的邮件服务器，并放在其中的收件人邮箱中，收件人可随时上网到自 已使用的邮件服务器进行读取，相当十“电子信箱”。 • 一个电子邮件系统有三个上要组成构件，即：用户代理、邮件服务器和邮件协议 （包括邮件发送协议，如 SMTP, 和邮件读取协议，如 POP3 和 IMAP) 。用户代理 和邮件服务器都要运行这些协议。 • 电子邮件的用户代理就是用户与电子邮件系统的接口，它向用户提供一个很友好的 视窗界面来发送和接收邮件。 • 从用户代理把邮件传送到邮件服务器，以及在邮件服务器之间的传送，都要使用 SMTP 协议。但用户代理从邮件服务器读取邮件时，则要使用 POP3 （或 IMAP) 协议。 • 基于万维网的电子邮件使用户能够利用浏览器收发电子邮件。用户浏览器和邮件服 务器之间的邮件传送使用 HTTP 协议，而在邮件服务器之间邮件的传送仍然使用 SMTP 协议。 • 简单网络管理协议 SNMP 由三部分组成，即(I) SNMP 本身，负贞读取和改变各代 理中的对象名及其状态数值： （ 2) 管理信息结构 SMI, 定义命名对象和定义对象类 型（包括范围和长度）的通用规则，以及把对象和对象的伯进行编码的基本编码规 则 BER: (3) 管理信息库 MIB, 在被管理的实体中创建了命名对象，并规定了其类 型。 • 329 •"}
{"doc_id": "network", "page": 341, "text": "• 系统调用接口是应用进程的控制权和操作系统的控制权进行转换的－个接口，又称 为应用编程接口 API 。 APl 就是应用程序和橾作系统之间的接门。 • 套接字是应用进程和运输层协议之间的接口，足应川进程为了获得网络通信服务而 与橾作系统进行交互时使用的一种机制。 • 目前 P2P 工作方式下的文件共享在互联网流扭中已占据最大的份额，比万维网应用 所占的比例大得多。 • BT 是很流行的一种 P2P 应用。 BT 采用“最稀有的优先＂的技术，可以尽早把最 稀有的文件块收集到。此外，凡有当前以鼓高数据率向某个对等方传送文件块的相 邻对等方，该对等方就优先把所沾求的文件块传送给这些相邻对等方。这样做的结 果处，这些对等方相 I ［之间都能够以令人满意的速率交换文件块。 • 当对等方的数礼很大时，采用 P2P 方式下载大文件，要比传统的客户－服务器）j式 快得多。 • 在 P2P J立用中， I 、t泛使用的索引和查找技术是分布式散列表 DHT 。 习题 6-01 互联网的域名结构是怎样的？它与目前的屯话网的巧码结构有何异同之处？ 6-02 域名系统的上要功能是什么？域名系统中的本地域名服务器、根域名服务器、顶级 域名服务器以及权限域名服务器付何区别？ 6-03 举例说明域名转换的过程。域名服务器中的高速缓存的作用是什么？ 6-04 设想有一天整个互联网的 DNS 系统都瘫痪f （这种情况不大会出现），试问还有可 能给朋及发送屯子邮件鸣？ 6-05 文件传送协议 FTP 的主找工作过程是怎样的？为什么说 FTP 是带外传送控制信息？ 主进利和从屈进程各起什么作用？ 6-06 简单文件传送协议 TFTP 勹 FTP 的主要区别是什么？各用在什么场合？ 6-07 远程登求 TELNET 的主要特点是什么？什么叫作虚拟终端 NVT? 6-08 解释以下名词。各英文缩写i司的原义是什么？ WWW, URL, HTTP, HTML, CG J，浏览器，超文本，超媒体，超链，页曲，活动文档， 搜索引笠． 6-09 假定一个超链从一个万维网文档链接到另一个万维网文档时，巾于万维网文杻上出 现了比错而使得超链指向一个无效的计算机名字。这时浏览器将向用户报告什么？ 6-10 假定要从已知的 URL 获得一个月维网文档。若该丿j乡1「网服务常的 IP 地址开始时并不 知道。试问：除 HTTP 外，还而耍什么应用层协议和运输层协议？ 6-11 你所使用的浏览器的高速缓存有多大？诸进行一个实验：访问几个月维网文档，然 后将你的计算机与网络断开，然后再回到你刚才访问过的文档。你的浏览器的高速 缓存能够存放多少个页面？ 6-12 什么是动态文档？试举出片维网仗川动态文档的一些例子。 6-13 浏览器同时打开多个 TCP 连接进行浏览的优缺点如何？请说明理由。 6-14 请判断以下论述的正误，并简述理由。 • 330 •"}
{"doc_id": "network", "page": 342, "text": "(I) 用户点击某网贞，该网页付 l 个文本义件和 3 个 OO 片。此用户可以发送一个请求 就可以收到 4 个响应报文。 (2) 有以下两个不同的网页： www.abc.co1对ml.html 和 www.abc.co1n/m2.h tm1 。用户可 以使川同一个 HTTP/I] 持续连接传送对这两个网页的请求和响应。 (3) 在客户与服务器之间的非持续连接，只盂要用一个 TCP 报文段就能够装入两个不 同的 HTTP 请求报文。 (4) 在 HTTP 响应报文中的土体实体部分水远不会是空的。 6-15 假定你在浏览器卜点击一个 URL ，但这个 URL 的 IP 地址以前并没有缓存·在本地主 机上。冈此斋要用 DNS 自动查找和解析。假定要解析到所要找的 URL 的 IP 地址共 经过 n 个 DNS 服务器，所经过的时间分别为 RTT1, RTT2;··,RTT,, 。假定从要找的网 页上只孟投读取一个很小的图片（即忽略这个小图片的传输时间）。从本地主机到这 个网页的往返时间是 RTT\\\\ 。试问从点占这个 URL 丿「始，一直到本地上机的屏幕上 出现所读取的小图片，一共要经过多长时间？ 6-16 在上题中，假定同·台服务器的 HTML 文件中又链搂了三个非常小的对象。若忽略 这些对象的发送时间，试计环客户点击读取这些对象所需的时间。 (I)没有并行 TCP 连接的非持续 HTTP: (2) 使用并行 TCP 连接的非持续 HTTP: (3) 流水线方式的持续 HTTP. 6-17 在浏览器中应当有儿个可选解释程序。试给出一些可选解释桯序的名称。 句 8 一个力维网网点付 1000 乃个贞而，平均每个页面钉 10 个超链。读取·个页而平均 要 100 ms 。诸问：要检索整个网点所盂的砓少时间是多少？ 6-19 搜索引节可分为哪两种类型？各有什么特点？ 6-20 试述 1 1.!.f邮件的奻t要的组成部件。用户代理 UA 的作用是什么？没有 UA 行不行？ 6-21 电子邮件的信封和内容在邮件的传送过程中起什么作用？和用户的关系如何？ 6-22 电子邮件的地址格式是怎样的？请说明各部分的意思。 6-23 试简述 SMTP 通信的三个阶段的过程。 6-24 试述邮局协议 POP 的工作过程。在电子邮件中，为什么盆要使用 POP 和 SMTP 这两 个协议？ IMAP 与 POP 有何区别？ 6-25 MIME 与 SMTP 的关系是怎样的？什么是quot ed- p ri n t able 编码和 base64 编码？ 6-26 一个二进制文件共 3072 字节长。若使用 base64 编码，并且每及送完 80 字节就插入 一个同乍符 CR 和一个换行符 LF, 问一共发送了多少个字节？ 6-27 试将数据 1100 I I 00 I 000000 I 0011 1000 进行 base64 编码，并得出最后传送的 ASCII 数据。 6-28 试将数据 0 I 00 I I 00 I 00 1110 I 00 I I I 00 I 进行quo t ed- p r i ntable 编码，并得出最后传送的 ASCll 数据。这样的数据用quoted- pri n t able 编码后，其编码开销有多大？ 6-29 电子邮件系统盂耍将人们的电子邮件地址编成目录以便千杳找。要建立这种目录应 将人名划分为儿个标准部分（例如，姓、名）。若要形成一个国际标准，那么必须解 决哪些问题？ 6-30 电子邮件系统使用 TCP 传送邮件。为什么有时我们会遇到邮件发送失败的情况？为 什么付时对方会收不到我们发送的邮件？ • 33 I •"}
{"doc_id": "network", "page": 343, "text": "6-31 基千万维网的电子邮件系统有什么特点？在传送邮件时使用什么协议？ 6-32 DHCP 协议用在什么估况下？当一台计笃机第一次运行引导程序时，其 ROM 中有没 h 该主机的 IP 地址、f网掩砃或某个域名服务器的 IP 地址？ 6-33 什么是网络管理？为什么说网络竹理是当今网络领域中的热门淉题？ 6-34 斛释下列术语：网络元素、股行对象、管理进程、代理进程和管理信息库。 6-35 SNMP 使用 UDP 传送报文。为什么不使用 TCP? 6-36 为什么 SNMP 的笱则进程使用探询掌握全网状态屈千正常悄况，而代理进程用陷阱 向管理进桯报告属千较少发生的异常情况？ 6-37 SNMP 使用哪几种橾作？ SNMP 在 Get报文中设置了请求标识符字段，为什么？ 6-38 什么是管理信息库 MIB? 为什么要使用 MIB? 6-39 什么是管理信息结构 SMI? 它的作用是什么？ 6-40 用 ASN.I 基本编码规则对以下 4 个数组(SEQ UENCE-OF)进行编码。假定每一个数字 古用 4 个字节。 2345, 1236, 122, 1236  6-4I SNMP 耍发送一个 Get Req uest报文，以便向一个路由器荻取 ICMP 的icrnp 1nPannProbs 的值。在icrn p中变坎i crn p lnParrnProbs 的标号是 5, 它是一个计数器，用来统计收到 的类型为参数问题的 ICMP 差错报告报文的数目。试给出这个 GetReques t报文的编 码。 6-42 对象tc p的 OB JECT IDENTIFIER 是什么？ 6-43 在 ASN.I 中， IP 地址{I PAddress) 的类别是应用类。若 IPAddress = 13 1. 2 1.1 4.2, 试求 其 ASN.I 编码。 6-44 什么是应川编程接口 API? 它是应用程序和谁的接口？ 6-45 试举出常用的几种系统调用的名称，说明它们的用途。 6-46 图 6-37 表示了各应川协议在层次中的位贸。 (I) 简单讨论－．下为什么有的应川层协议要使用 TCP 而付的却要使用 UDP? (2) 为什么 MlME 画在 SMTP 之 I:? (3) 为什么路由选择协议 RIP 放在应用层？ 荨三］ 五 ”> 荨 图 6-37 习题 6-46 的图 荨 6-47 现在流行的 P2P 文件共享应用程序都有哪些特点？存在哪些值得注意的问题？ 6-48 仗用客户－服务器方式进行文件分发。一台服务器把一个长度为 F 的大文件分发给 N 个对等方。假设文件传输的瓶颈是各计货机（包括服务器）的上传速率 u 。试计贷文 件分发到所有对等力的垃短时间。 • 332 •"}
{"doc_id": "network", "page": 344, "text": "6-49 爪新考虑上题的文件分发任务，但采用 P2P 文件分发方式，并且每个对等方只能在接 收完整个文件后才能向其他对等方转发。试计釭文件分发到所有 N 个对等方的最短 时间。 6-50 再亚新考虑上题的文件分发任务，但可以把这个非常大的文件划分为一个个非常小 的数据块进行分发，即一个对等方在下载完一个数据块后就能向其他对等方转发， 并同时可下载其他数据块。不考虑分块增加的控制信息，试计算整个大文件分发到 所有对等方的最短时间。 6-51 假定某服务器有一文件 F = 15 Gb it要分发给分布在互联网各处的 N 个对等方。服务 器上传速率 Us = 30 Mb it/ s, 每个对等方的下载速率 d = 2 Mb it/s, 上传速率为 u = 300  kb it/s 。设(I) N = 10, (2) N = 1000 。试分别计笃在客户－服务器方式下和在 P2P 方式 下，该文件分发时间的最小值。 • 333 •"}
{"doc_id": "network", "page": 345, "text": "第 7 章网络安全 随竹计算机网络的发展，网络中的安全问题也日趋严项。当网络的用户来自社会各个 阶层与部门时，大地在网络中有储和传输的数据就衙要保护。由千计算机网络安全是另一门 专业学科，所以本汽只对计仅机网络安全问题的基本内容进行初步的介绍。 木存最重要的内容是： (I) 计算机网络面临的安全性威胁和计算机网络安全的主要问题。 (2) 对称密钥密码体制和公钥密码体制的特点。 (3) 鉴别、报文鉴别码、数字签名、证书、证书链的概念。 (4) 网络层安令协议 IPscc 协议族和运输层安全协议 TLS 的要点。 (5) 应用层屯f邮件的安个措施。 (6) 系统安全：防火墙与入侵检测。 7.1 网络安全问题概述 本节讨论计符机网络面临的安全性威胁、安全的内容和一般的数据加密模型。 7.1.1 计算机网络面临的女全性威胁 计符机网络的通信而临两大类威胁，即被动攻击和主动攻击（如图 7-1 所示）。 ,···························-:-·······--········· ·:··············.......、... ················--·、············ :'''; : .. ，源点 终点，源，I.1,． 终，1, ：源，仅 终点抵．＼ 终 I'.\\ : i  二气°霆°嘉心：．．． ; 被动攻，．Ir : 主动攻击 : '......'.......  ,......................................................................... ·····················································'  图 7-1 对网络的被动攻市和主动攻击 被动攻击是指攻击者从网络上窃听他人的通信内容。通常把这类攻击称为截获。在被 动攻击中，攻击者只是观察和分析某·个协议数据单元 PDU （这里使用 PDU 这一名词是考 虑到所涉及的可能是不同的层次）而不干扰信息流。即使这些数据对攻击者来说是不易理解 的，他也可通过观察 PDU 的协议控制信息部分， f解正在通伈的协议实体的地址和身份， 研究 PDU 的长度和传输的频度，从而f解所交换的数据的某种性质。这种被动攻击又称为 流量分析~tra ffi c anal ys i s) 。在战争时期，通过分祈某处出现大砒异常的通信搅，往往可以发 现敌方指挥所的位四。 主动攻击有如下几种蚊常见的方式。 (I) 篡改 攻击者故意煤改网络 I ．．传送的报文。这里也包括彻底中断传送的报文，甚 至是把完全伪造的报文传送给接收方。这种攻击方式有时也称为更改报文流。 (2) 恶意程序 恶意程序 (ro gue p ro g ram) 种类繁多，对网络安全威胁较大的主要有以 下几种： • 334 •"}
{"doc_id": "network", "page": 346, "text": "• 计算机病毒（compu t er v i ms), 一种会“传染”其他程序的程序，“传染”是通过修 改其他程序来把自身或自己的变种复制进去而完成的。 • 计算机蠕虫(comp u t er wonn) ，一种通过网络的通信功能将自身从一个节点发送到 另一个节点并自动启动运行的程序。 • 特洛伊木马(Troj an horse), 一种程序，它执行的功能并非所声称的功能而是某种恶 意功能。如一个编译程序除了执行编译任务以外，还把用户的源程序偷偷地复制下 来，那么这种编译程序就是一种特洛伊木马。计算机病毒有时也以特洛伊木马的形 式出现。 • 逻辑炸弹（lo gi c bomb), 一种当运行环境满足某种特定条件时执行其他特殊功能的 程序。如一个编辑程序，平时运行得很好，但当系统时间为 13 日又为星期五时，它 会删去系统中所有的文件，这种程序就是一种逻辑炸弹。 • 后门入侵（backdoor knocki n g),是指利用系统实现中的漏洞通过网络入侵系统。就 像一个盗贼在夜晚试图闯入民宅，如果某家住户的房门有缺陷，盗贼就能乘虚而入。 索尼游戏网络(PlayS ta ti on Network) 在 2011 年被入侵，导致 7700 万用户的个人信息， 诸如姓名、生日、 E-mai l 地址、密码等被盗 [W-BACKD] 。 • 流氓软件，一种未经用户允许就在用户计算机上安装运行并损害用户利益的软件， 其典型特征是：强制安装、难以卸载、浏览器劫持、广告弹出、恶意收集用户信息、 恶意卸载、恶意捆绑等。现在流氓软件的泛滥程度已超过了各种计算机病毒，成为 互联网上最大的公害。流氓软件的名字一般都很吸引人，如某某卫士、某某搜霸等， 因此要特别小心。 上面所说的计算机病毒是狭义的，也有人把所有的恶意程序泛指为计算机病毒。例如 1988 年 10 月 “Morri s 病毒”入侵美国互联网，舆论说该事件是“计算机病毒入侵美国计算 机网”，而计算机安全专家却称之为“互联网蠕虫事件”。 (3) 拒绝服务 DoS (Denial of Service) 指攻击者向互联网上的某个服务器不停地发送 大量分组，使该服务器无法提供正常服务，甚至完全瘫痪。 2000 年 2 月 7 日至 9 日美国几 个著名网站遗黑客(1)袭击，使这些网站的服务器一直处于“忙”的状态，因而无法向发出请 求的客户提供服务。这种攻击被称为拒绝服务。又如在 2014 年圣诞节，索尼游戏网 (PlayStation Network) 和微软游戏网(M i croso ft Xbox Li ve) 被黑客攻击后瘫痪，估计有1. 6 亿用 户受到影响 [W-DOS] 。 若从互联网上的成百士干个网站集中攻击一个网站，则称为分布式拒绝服务 DDoS (Distributed Denial of Serv i ce) 。有时也把这种攻击称为网络带宽攻击或连通性攻击。 2018 年 2 月， 6 日世界标准时间零时，亚太地区许多计鍔机同时向根服务器系统发动 袭击，企图使之瘫痪。它们每秒传送的数据量相当于服务器每分钟要接收 75 万封电子邮件。 结果至少有 6 个根服务器系统受到影响，两个破坏严重。有分析认为攻击来自韩国，但 ＠注：咒客（hacker) 是指精通计江机编桯的启i于，他们能够迪过专门的技术手段进入某些据称是相当安全的计算机系统中． 黑客一般可分为两大类。－·类是芹意搞破坏或盗窃别人计．戏机中数据信息的坏人．而另一类则是片门研究计算机系统安全性的好 人。例如，银行发行的信用卡必须 I· 分安全．但这种信用卡的女介性在公开发行之前却上从知晓。这时就要诸专门研究计饵机安 全的阴客对伯用卡进行攻击实验。如黑各在努力尝试后仍无法攻破．则可认为该信用卡至少在 1」前丛相对安全的． • 335 •"}
{"doc_id": "network", "page": 347, "text": "ICANN 不认为黑客一定是韩国人，他可以是任何地点的任何人，只不过是操纵了韩国的计 算机而已。 还有其他类似的网络安全问题。例如，在使用以太网交换机的网络中，攻击者向某个 以太网交换机发送大揽的伪造源 MAC 地址的帧。以太网交换机收到这样的帧，就把这个假 的源 MAC 地址写入交换表中（因为交换表中没有这个地址）。由于这种伪造的地址数掘太 大，因此很快就把交换表填满了，导致以太网交换机无法正常工作（称为交换机中毒）。 对于主动攻击，可以采取适当措施加以检测。但对于被动攻击，通常却是检测不出来 的。根据这些特点，可得出计算机网络通信安全的目标如下： (1) 防止析出报文内容和流批分析。 (2) 防止恶意程序。 (3) 检测更改报文流和拒绝服务。 对付被动攻击可采用各种数据加密技术，而对付主动攻击，则需将加密技术与适当的 鉴别技术相结合。 7.1.2 安全的计算机网络 人们一直希望能设计出一种安全的计算机网络，但不幸的是，网络的安全性是不可判 定的 [DENN82] 。目前在安全协议的设计方面，主要是针对具体的攻击设计安全的通信协议。 但如何保证所设计出的协议是安全的？这可以使用两种方法。一种是用形式化方法来证明， 另一种是用经验来分析协议的安全性。形式化证明的方法是人们所希望的，但一般意义上的 协议安全性也是不可判定的，只能针对某种特定类型的攻击来讨论其安全性。对于复杂的通 信协议的安全性，形式化证明比较困难，所以主要采用人工分析的方法来找漏洞。对千简单 的协议，可通过限制入侵者的操作（即假定入侵者不会进行某种攻击）来对一些特定情况进 行形式化的证明，当然，这种方法有很大的局限性。 根据上一节所述的各种安全性威胁，不难看出，一个安全的计绊机网络应设法达到以 下四个目标： 1. 机密性 机密性（或私密性）就是只有信息的发送方和接收方才能懂得所发送信息的内容，而 信息的截获者则看不懂所截获的信息。显然，机密性是网络安全通信最基本的要求，也是对 付被动攻击所必须具备的功能。通常可简称为保密。尽管计算机网络安全并不仅仅依靠机密 性，但不能提供机密性的网络肯定是不安全的。为了使网络具有机密性，需要使用各种密码 技术。 2. 端点鉴别 安全的计算机网络必须能够鉴别信息的发送方和接收方的真实身份。网络通信和面对 面的通信差别很大。现在频繁发生的网络诈骗，在许多情况下，就是由于在网络上不能鉴别 出对方的真实身份。当我们收到一封电子邮件时，发信人也可能并不是邮件上所署名的那个 人。当我们进行网上购物时，卖家也有可能是犯罪分子假冒的商家。不能解决这个问题，就 不能认为网络是安全的。端点鉴别在对付主动攻击时是非常重要的。 • 336 •"}
{"doc_id": "network", "page": 348, "text": "3. 信息的完整性 即使能够确认发送方的身份是真实的，并且所发送的信息都是经过加密的，我们依然 不能认为网络是安全的。还必须确认所收到的信息都是完整的，也就是估息的内容没有被人 篡改过。保证信息的完整性在应对主动攻击时也是必不可少的。信息的完整性和机密性是两 个不同的概念。例如，淌家向公众发布的商品广告当然不需要保密，但如果广告在网络上传 送时被人恶意删除或添加了一些内容，那么就可能对商家造成很大的损失。 实际上，信息的完整性与端点鉴别往往是不可分割的。假定你准确知道报文发送方的 身份没有错（即通过了端点鉴别），但收到的报文却已被人篡改过（即信息不完整），那么这 样的报文显然是没有用处的。因此，在谈到“鉴别”时，有时是同时包含了端点鉴别和报文 的完整性。也就是说，既鉴别发送方的身份，又鉴别报文的亢整性。 4. 运行的安全性 现在的机构与计算机网络的关系越密切，就越要亟视计算机网络运行的安全性。上一 节介绍的恶意程序和拒绝服务的攻击，即使没有窃取到任何有用的信息，也能够使受到攻击 的计算机网络不能正常运行，甚至完全瘫痪。因此，确保计镜机系统运行的安全性，也是非 常重要的工作。对于一些要害部门，这点尤为重要。 访问控制（access con trol) 对计算机系统的安全性非常重要。必须对访问网络的权限加以 控制，并规定每个用户的访问权限。由于网络是个非常复杂的系统，其访问控制机制比操作 系统的访问控制机制更复杂（尽管网络的访问控制机制是建立在操作系统的访问控制机制之 上的），尤其在安全要求更商的多级安全(mul ti level security)情况下更是如此。 7. 1.3 数据加密模型 一般的数据加密模型如伤 7-2 所示。用户 A 向 B 发送明文 X, 但通过加密算法 E 运算 后，就得出密文 Y。 加密密钥 Kr 截：上—截；者寸担终改 A | l  一1 ？解密密钥 K IB  ．一1 图 7-2 一般的数据加密模型 图中所示的加密和解密用的密钥 K (k ey)是一串秘密的字符串（即比特串）。公式 (7-1) 就 是明文通过加密绊法变成密文的一般表示方法。 y = EK(X) (7-1)  在传送过程中可能出现密文的截取者（或攻击者、入侵者）。公式(7-2) 表示接收端利用 解密算法 D 运算和解密密钥 K, 解出明文 X。解密算法是加密算法的逆运算。在进行解密运 算时，如果不使用事先约定好的密钥就无法解出明文。 DK(Y) = DK(EK(X)) = X (7-2)  • 337 •"}
{"doc_id": "network", "page": 349, "text": "这里我们假定加密密钥和解密密钥都是一样的。但实际上它们可以是不一样的（即使 不一样，这两个密钥也必然有某种相关性）。密钥通常由密钥中心提供。当密钥衙要向远地 传送时，一定要通过另一个安全信道。 密码编码学（c rypto grap h y)是密码体制的设计学，而密码分析学 (c ryptanal ys i s) 则是在未知 密钥的悄况下从密文推演出明文或密钥的技术。密码编码学与密码分析学合起来即为密码学 (c rypt olo gy)。 如果不论截取者获得了多少密文，但在密文中都没有足够的信息来唯一地确定出对应 的明文，则这一密码体制称为无条件安全的，或称为理论上是不可破的。在无任何限制的条 件下，目前几乎所有实用的密码体制均是可破的。因此，人们关心的是要研制出在计算上 （而不是在理论上）是不可破的密码体制。如果一个密码体制中的密码，不能在一定时间内被 可以使用的计算资源破译，则这一密码体制称为在计算上是安全的。 早在几千年前人类就已经有了通信保密的思想和方法。直到 1949 年，信息论创始人香 农 (C. E. Shannon) 发表著名文章 [SHAN49], 论证了一般经典加密方法得到的密文几乎都是可 破的。密码学的研究曾面临着严业的危机。但从 20 世纪 60 年代起，随着电子技术、计算技 术的迅速发展以及结构代数、可计算性和计算复杂性理论等学科的研究，密码学又进入了一 个新的发展时期。在 20 世纪 70 年代后期，美国的数据加密标准 DES (Da ta Encryption Standard)  和公钥密码体制（publ i c key c rypt o-sys t em, 又称为公开密钥密码体制）的出现，成为近代 密码学发展史上的两个蜇要里程碑。 7.2 两类密码体制 7.2.l 对称密钥密码体制 所谓对称密钥密码体制，即加密密钥与解密密钥都使用相同密钥的密码体制。例如图 7-2 所示的悄况，通信的双方使用的就是对称密钥。 数据加密标准 DES 属千对称密钥密码体制。它巾 lBM 公司研制出，于 1977 年被美国 定为联邦信息标准后，在国际上引起了极大的重视。 ISO 齿将 DES 作为数据加密标准。 DES 是一种分组密码。在加密前，先对整个的明文进行分组。每一个组为 64 位长的二 进制数据。然后对每一个 64 位＿进制数据进行加密处理，产生一组 64 位密文数据。最后 将各组密文串接起来，即得出整个的密文。使用的密钥占有 64 位（实际密钥长度为 56 位， 外加 8 位用千奇偶校验）。 DES 的机密性仅取决于对密钥的保密，而算法是公开的。 DES 的问题是它的密钥长度。 56 位长的密钥意味着共有 256 种可能的密钥，也就是说，共有约 7.6 X 1016 种密钥。假设一 台计算机 I µs 可执行一次 DES 加密，同时假定平均只需搜索密钥空间的一半即可找到密钥， 那么砐译 DES 要超过 1000 年。 然而芯片的发展出乎意料地快。不久， 56 位 DES 已不再被认为是安全的。 对于 DES 56 位密钥的问题，学者们提出了三重 DES (Triple DES 或记为 3DES) 的方 案，把一个 64 位明文用一个密钥加密，再用另一个密钥解密，然后再使用第一个密钥加密， 即 Y = DESK1(DES坛(OESK1 （劝）） • 338 •"}
{"doc_id": "network", "page": 350, "text": "这里， X 是明文， Y 是密文， Kl 和 K2 分别是第一个和第二个密钥， DESkl(·) 表示用密 钥 Kl 进行 DES 加益而 DEs·1K2() 表示用密钥 K2 进行 DES 解密。 这种三重 DES 曾广泛用干网络、金融、信用卡等系统。 在 DES 之后， 1997 年美国标准与技术协会(NIST), 对一种新的加密标准即高级加密标 准 AES (Advanced Encryption S tandard) 进行遴选，最后由两位年轻比利时学者Joan Daemen 和 Vi ncen t肋 men 提交的 Rij ndael 莫法被选中，在 2001 年正式成为 NTST 的加密标准。在 2002 年成为美国政府加密标准。现在 AES 也是 ISO/IEC 18033-3 标准。 AES 是一种分组密码，分组长度为 128 位。 AES 有三种加密标准，其密钥分别为 128 位、 192 位和 256 位，加密步骤相当复杂，运算速度比 3DES 快得多，且安全性也大大加强。 在 2001 年， NIST 齿有一个大致的估计，就是假定有一台高速计算机，仅用 1 秒钟就能够破 译 56 位的 DES （也就是采用穷举法，在 l 秒钟内能够把 DES 所有的 256 个密钥逐个进行解 密运算一遍），那么要破译 128 位的 AES, 就需要 1012 年！但是计算机运算速度的提高是很 难预测的。因此美国国家安全局 NSA 认为，对于最高机密信息（这类信息必须保证数十年 以上的安全性）的传递，至少需要 192 或 256 位的密钥长度。 到 2020 年 5 月为止，尚未见到能够成功破解 AES 密码系统的报道。有人认为，要破解 AES 可能需要在数学上出现非常重大的突破。 7.2.2 公钥密码体制 公钥密码体制的概念是由斯坦福（S tan fo rd) 大学的研究人员 D iffi e 与 Hellman 千 1976 年 提出的 [DIFF76] 。公钥密码体制使用不同的加密密钥与解密密钥。这种加密体制又称为非对 称密钥密码体制。 公钥密码体制的产生主要有两个方面的原因，一是由于对称密钥密码体制的密钥分配 问题，二是由于对数字签名的需求。 在对称密钥密码体制中，加解密的双方使用的是相同的密钥。但怎样才能做到这一点 呢？一种是事先约定，另一种是用信使来传送。在高度自动化的大型计算机网络中，用信使 来传送密钥显然是不合适的。如果事先约定密钥，就会给密钥的管理和更换带来极大的不便。 若使用高度安全的密钥分配中心 KDC (Key Distribution Center), 也会使得网络成本增加。 对数字签名的强烈需要也是产生公钥密码体制的一个原因。在许多应用中，人们盓要 对纯数字的电子伯息进行签名，表明该信息确实是某个特定的人产生的。 公钥密码体制提出不久，人们就找到了三种公钥密码体制。目前奻著名的是由美国三 位科学家 R i ves t, Shami r 和 Adleman 于 l976 年提出并在 1978 年正式发表的 RSA 体制，它 是一种基于数论中的大数分解问题的体制 [RIVE78] 。 在公钥密码体制中，加密密钥 PK (Publ ic Key,即公钥）是向公众公开的，而解密密 钥 SK (Secre t Key,即私钥或密钥）则是需要保密的。加密算法 E 和解密算法 D 也都是公 升的。 公钥密码体制的加密和解密过程有如下特点： (I) 密钥对产生器产生出接收者 B 的一对密钥：加密密钥 PKB 和解密密钥 SKB 。发送者 A 所用的加密密钥 PKB 就是接收者 B 的公钥，它向公众公开。而 B 所用的解密密钥 SKB 就 是接收者 B 的私钥，对其他人都保密。 (2) 发送者 A 用 B 的公钥 PKB 通过 E 运算对明文 X 加密，得出密文 Y, 发送给 B 。 • 339 •"}
{"doc_id": "network", "page": 351, "text": "Y = £PK0 (X)  B 用自己的私钥 SKa 通过 D 运算进行解密，恢复出明文，即 DsK, i (Y) = DsK11 (£PK” （劝）＝ X (7-3)  (7-4)  (3) 虽然在计算机上可以容易地产生成对的 P 岛和 SKB ，但从已知的 PKB 实际上不可能 推导出 SKB ，即从 PKB 到 SK8 是“计算上不可能的＂。这就是说，除了 B 以外，具他任何人 都无法解密出明文 X。 (4) 虽然公钥可用来加密，但却不能用来解密，即 DPKu (£PKa (X)严 X (5) 先后对 X 进行 D 运算和 E 运算或进行 E 运笃和 D 运算，结果都是一样的： £PK8 (DsK0 (X)) = DsK0 (£PK•（劝）＝ X (7-5)  (7-6)  请注意，通常都是先加密然后再解密。但仅从运算的角度看， D 运算和 E 运算的先后 顺序则可以是任意的。对某个报文进行 D 运算，并不表明是要对其解密。 图 7-3 给出了用公钥密码体制进行加密的过程。 ?B 的公钥 P岛 A I 力 ，一1 丁 甘 B 的私钥 SK8 m| 2  明文 X 图 7-3 公钥密码体制 公开密钥与对称密钥在使用通信信道方面有很大的不同。在使用对称密钥时，由于双 方使用同样的密钥，因此在通信信道上可以进行一对一的双向保密通信，每一方既可用此密 钥加密明文，并发送给对方，也可接收密文，用同一密钥对密文解密。这种保密通信仅限千 待有此密钥的双方（如再有第三方就不保密了）。但在使用公钥密码体制时，在通信信道上 可以是多对一的单向保密通信。例如在图 7-3 中，可以有很多人同时待有 B 的公钥，并各自 用此公钥对自己的报文加密后发送给 B 。只有 B 才能够用其私钥对收到的多个密文一一进 行解密。但使用这对密钥进行反方向的保密通信则是不行的。在现实生活中，这种多对一的 单向保密通信是很常用的。例如，在网购时，很多顾客都向同一个网站发送各自的信用卡信 息，就属千这种情况。 请注意，任何加密方法的安全性取决千密钥的长度，以及攻破密文所需的计算量，而 不是简单地取决于加密的体制（公钥密码体制或传统加密体制）。我们还要指出，公钥密码 体制并没有使传统密码体制被弃用，因为目前公钥加密算法的开销较大，在可见的将来还不 会放弃传统加密方法。 • 340 •"}
{"doc_id": "network", "page": 352, "text": "7.3 鉴别 7.3.l 报文鉴别 在网络的应用中，鉴别 (au t hen ti ca ti on) 是网络安全中一个很重要的问题。鉴别和加密是 不相同的概念。鉴别的内容有二。一是要鉴别发信者，即验证通信的对方的确是自己所要通 信的对象，而不是其他的智充者。这就是实体鉴别。实体可以是发信的人，也可以是一个进 程（客户或服务器）。因此这也常称为端点鉴别。二是要鉴别报文的完整性，即对方所传送 的报文没有被他人篡改过。至千报文是否需要加密，则是与“鉴别“性质不同的问题。有的 报文需要加密（这要另找措施），但许多报文并不需要加密。 请注意，鉴别与授权(au thori za ti on) 也是不同的概念。授权涉及的问题是：所进行的过程 是否被允许（如是否可以对某文件进行读或写）。 不过有时常用报文鉴别一词包含上述鉴别的两个内容，既鉴别报文的发送者，也鉴别 报文的完整性。 下面分别讨论报文鉴别与实体鉴别的特点。 1. 用数字签名进行鉴别（原理） 我们知道，书信或文件可根据亲笔签名或印程来鉴别其真实性。但在计货机网络中传 送的报文，则可使用数字签名进行鉴别。下面就介绍数字签名的原理。 为了进行数字签名， A 用其私钥 S心对报文 X 进行 D 运算（如图 7-4 所示）。 D 运算本 来叫作解密运算。可是，还没有加密怎么就进行解密呢？其头 D 运算只是把报文变换为某 种不可读的密文（因此有时也说成 A 用其私钥对报文加密，但这样说不准确）。在图 7-4 中 我们使用 “D 运算＇而不是“解密运算“，就是为了避免产生这种误解。 A 把经过 D 运算得 到的密文传送给 B 。 B 为了核实签名，用 A 的公钥进行 E 运算，还原出明文 X。诸注意， 任何人用 A 的公钥 P心进行 E 运算后都可以得出 A 发送的明文。可见图 7-4 所示的通信方 式并非为了保密，而是为了进行签名和核实签名，即确认此明文的确是 A 发送的。 A 的私钥 SK团 A 的公钥 PK^ 『 名 核实 密文 DSK,(n 召了：；：＼＼：（怅文 Ds K,,(X) 图 7-4 用数字签名进行鉴别 下面讨论一下为什么数字签名具有鉴别报文的功能。 因为除 A 外没有别人持有 A 的私钥 SKA, 所以除 A 外没有别人能产生密文 DsKA (X) 。 这样， B 确信报文 X 是 A 签名发送的。这就鉴别了报文的发送者。同理，具他人如果篡改 过报文，但由于无法得到 A 的私钥 SKA 对篡改后的报文进行 D 运算，那么 B 对收到的报文 进行核实签名的 E 运算后，将会得出不可读的明文，因而不会被欺骗。这样就保证了报文 的完整性。 数字签名还有另一功能，就是发送者事后不能抵赖对报文的签名。这叫作不可否认。 • 341 •"}
{"doc_id": "network", "page": 353, "text": "若 A 要抵赖曾发送报文给 B, B 可把 X 及 DsK, (X)出示给进行公证的第三者。第三者很容 易用 PKA 去证实 A 确实发送 X 给 B 。 以上这三项功能的关键都在于没有其他人能够持有 A 的私钥 SKA• 但数字签名仅对报文进行了签名，对报文 X 本身却未保密。因为截获到密文 DsK,. (X)  并知道发送者身份的任何人，若通过某种手段获得了发送者的公钥 PKA, 就能解出报文的 内容。如果用图 7-5 所示的方法，就可同时实现保密通信和数字签名。图中 SKA 和 SKB 分 别为 A 和 B 的私钥，而 P心和 PKB 分别为 A 和 B 的公钥。请注意，在许多情况下，我们 往往强调的是使用何种密钥进行运算，这时的表达方式可简单些。例如，“用 A 的私钥对明 文 X 进行签名“可记为 SKA(X)。若“再用 B 的公钥对此签名进行加密＂，则可记为 PKB(SK从劝），而不必深究使用的是 D 运算还是 E 运算。 B 的私钥 SK8 A 的公钥 PK/\\ 加密与解密 签名与核实签名 图 7-5 可保证机密性的数字签名 r  如图 7-5 所示的可保证机密性的数字签名方法，虽然在理论上是正确的，但很难用于现 实生活中。因此这一节的小标题后边有“原理”二字。这是因为要对报文（可能很长的报文） 先后要进行两次 D 运算和两次 E 运算，这种运算量太大，要花费非常多的计算机 CPU 时间， 在很多情况下是无法令人接受的。因此目前对网络上传送的大狱报文，普遍都使用开销小得 多的对称密钥加密。要实现数字签名当然必须使用公钥密码，但一定要设法减小公钥密码算 法的升销。这就要使用后而几个小节所讨论的密码散列函数和报文鉴别码。 2 密码散列函数 散列函数（又称为杂凑函数，或哈希函数）在计算机领域中使用得很广泛。密码学对 散列函数有非常高的要求，因此符合密码学要求的散列函数又常称为密码散列函数 (cryptographic hash fu nc ti on) 。以后在不致产生错误概念时，我们也常把密码散列函数简称为 散列函数。具体说来，密码散列函数 H(X)应具有以下四个特点： (I) 虽然散列函数的输入报文 X 的长度不受限制，但计算出的结果 H(X)的长度则应是 较短的和固定的。散列函数的输出 H(X)又称为散列值，或散列。散列函数采用确定算法， 因此相同的输入必定得出相同的输出。虽然密码散列函数相当复杂，但利用计算机，散列函 数的运算还是相当快的。 (2) 散列函数的输入和输出的关系是多对一的。若散列值 H(X)的长度为 128 位，那么 输出散列值只有 2128 个有限多的可能值（ 2128 与 IPv6 的地址数一样大，是个很大的数值）。 然而我们的输入报文 X 却有无限多的取值。可见必然会出现不同输入却产生相同输出的碰 撞现象。精心挑选的密码散列函数应当非常不易发生碰撞，即应具有很好的抗碰撞性。 • 342 •"}
{"doc_id": "network", "page": 354, "text": "(3) 若给出散列值 H(X),则无人能找出输入报文 X。也就是说，散列函数是一种单向函 数(one-way fu nc ti on), 即逆向变换是不可能的（如图 7-6 所示）。 任意长度的明文 X 这比心及心的f: 忐也打垃的叫义， KIJl不识，… ••  .........一一...........嘈 逆向变换足不可能的 图 7-6 密码散列函数是单向的 上述特点的另一种表述方法是： 输出固定长度 的散列值 H(X) 10010... 1011  若已知 X 和 H(X),则没有人能够找到 Y(Y ;t: X），使得 H( Y) = H(X)。 但下面我们要讲到，关于这方面的研究，后来已有了一些新的进展。 (4) 好的密码散列函数还具有这样一些特性：散列函数输出的每一个比特，都与输入的 每一个比特有关；哪怕仅改动输入的一个比特，输出也会相差极大：散列函数的运算包括许 多非线性运算． 通过许多学者的不断努力，已经设计出一些实用的密码散列函数（或称为散列算法）， 其中最出名的就是 MD5 和 SHA-I 。 MD 就是 Message D ig es t的缩写，意思是报文摘要。 MD5 是报文摘要的第 5 个版本。 报文摘要符法 MD5 公布于 RFC 1321 (1991 年），并获得了非常广泛的应用。 MD5 的 设计者Rives t曾提出一个猜想，即根据给定的 MD5 报文摘要代码，要找出—个与原来报文 有相同报文摘要的另一报文，其难度在计钧上几乎是不可能的。但在 2004 年，中国学者王 小云©发表了轰动世界的密码学论文，证明可以用系统的方法找出一对报文，这对报文具有 相同的 MD5 报文摘要(W-WANG], 而这仅需 15 分钟，或不到 1 小时。千是， MD5 的安全 性就产生了动摇。随后，又有许多学者开发了对 MD5 实际的攻击。千是 MD5 酘终被另一 种叫作安全散列算法 SHA (Secure Hash Algor ithm) 的标准所取代。 下面仍以 MD5 为例来介绍报文摘要。这主要是考虑到目前新的散列函数（如 SHA-2) 是从 MD5 发展而来的。对于有兴趣研究散列函数的读者， MD5 是个很好的出发点。 MD5 算法的大致过程如下： (I) 先把任意长的报文按模 264 计算其余数（ 64 位），追加在报文的后面。 (2) 在报文和余数之间填充 l~512 位，使得填充后的总长度是 512 的整数倍。填充的首 位是 I, 后面都是 0 。 (3) 把追加和填充后的报文分割为许多 512 位的数据块，每个 512 位的报文数据再分成 4 个 128 位的数据块依次送到不同的散列函数进行 4 轮计绊。每一轮又都按 32 位的小数据 块进行复杂的运算。一直到最后计算出 MD5 报文摘要代码（ 128 位）。 这样得出的 MD5 报文摘要代码中的每一位都与原来报文中的每一位有关。由此可见， 像 MD5 这样的密码散列函数实际上已是个相当复杂的算法，而不是简单的函数了。 SHA-1 是由美国标准与技术协会 NIST 提出的一个散列算法系列。 SHA-I 和 MD5 相似， ＠注·王小＂，女， 1966 年出生，山东大学和消华入学教授．中国科冷院院士．主要研究领域为密码学和倌息安全学． • 343 •"}
{"doc_id": "network", "page": 355, "text": "但其散列值的长度为 160 位（比 MD5 的 128 位多了 25%) 。 SHA-I 也是先把输入报文划分 为许多 512 位长的数据块，然后经过复杂运算后得出散列值。 SHA-I 比 MD5 更安全，但计 笃起来却比 MD5 要慢些。 1995 年发布的新版本 SHA-1 [RFC 3174] 在安全性方面有了很大的 改进。 但 SHA-I 后来也被证明其实际安全性并未达到设计要求，并且也曾被王小云教授的研 究团队攻破。谷歌也宣布了攻破 SHA-I 的消息。现在 SHA-I 已被另外的两个版本 SHA-2 [RFC 6234] 和 SHA-3 [W-SHA3]所替代。 SHA-2 和 SHA-3 都各有好几种变型。前者有 SHA- 224, SHA-256, SHA-384 和 SHA-512, 后者有 SHA3-224, SHA3-256, SHA3-384 和 SHA3-512 。 在上面名称最后的 3 位数字表示散列的位数。这里需要指出， SHA-3 采用了与 SHA-2 完全 不同的散列函数。现在许多组织都已纷纷宣布停用 SHA-I 。例如，微软于 2017 年 1 月 1 日 起停止支待 SHA-I 证书，而以前签发的 SHA-I 证书也必须更换为 SHA-2 证书。 谘注意， MD5 或 SHA-I” 被攻破“，是指有人能设法找出具有相同散列值的一对报文。 这样就动摇了 MD5 或 SHA-I 的安全性。但是，密码学家目前尚无法把一个任意已知的报文 X, 篡改为具有同样 MD5 或 SHA-I 散列值的另一报文 Y。 3. 用报文鉴别码实现报文鉴别 下面进一步讨论怎样使用散列函数来实现报文鉴别。 下面给出的三个简单步骤，给出鉴别报文的初步概念。 (l) 用户 A 首先根据自己的明文 X 计算出散列 H(X)（例如，使用 MDS) 。为简单起见， 我们把得出的散列 H(X)记为 H。 (2) 用户 A 把散列 H 拼接在明文 X 的后面，生成了扩展的报文(X, H),然后发送给 B 。 (3) 用户 B 收到了这个扩展的报文(X, H)。因为散列的长度 H 是早已知道的固定值，因 此很容易把收到的散列 H 和明文 X 分离开。 B 通过散列函数的运算，计约出所收到的明文 X 的散列 H( X)。若 H(X) =H，则 B 就认为所收到的明文是 A 发送过来的。 但上述做法实际上是不可行的。设想某个入侵者创建了一个伪造的报文 M, 然后也用 同样的方法计算出其散列 H(M),并且冒充 A 把拼接有散列的扩展报文发送给 B 。 B 收到扩 展的报文 (M, H(M))后，按照上面步骤（3 ）的方法进行验证．发现一切都是正常的，就会误认 为所收到的伪造报文就是 A 发送的。 因此，必须设法对上述的攻击进行防范。解决的办法可以是： A 把双方共享的密钥 K (K 就是一串不太长的字符串）拼接到报文 X 后，进行散列运算（如图 7-7 所示）。散列 运算得出的结果为固定长度的 H(X + K), 称为报文鉴别码 MAC (Message Authentication  Code) 。请注意：局域网中使用的媒体接入控制 MAC 正好也使用这三个字母，因此在看到缩 写词 MAC 时应注意 I:: 下文。 A 把报文鉴别码 MAC 拼接在报文 X 后面，得到扩展的报文， 发送给 B 。我们注意到，共享密钥 K 并没有出现在网上传送的扩展的报文中。 B 收到扩展的报文后，把报文鉴别码 MAC 与报文 X 进行分离。 B 再用同样的密钥 K 与 报文 X 拼接，进行散列运算，把得出的结果 H(X+ K)与分离出的报文鉴别码 MAC 进行比较。 如相等，就可确认收到的报文 X 的确是 A 发送的。只要入侵者不掌握密钥 K, 就无法伪造 A 的报文鉴别码 MAC ，因而无法伪造 A 发送的报文。像这样的报文鉴别码称为数字签名， 或数字指纹。图 7-7 所示的过程就是 A 对报文进行了签名，而 B 对报文进行了鉴别。 • 344 •"}
{"doc_id": "network", "page": 356, "text": "固定长度的 报文鉴别码 互联网-.~ 尸｀ 图 7-7 用报文鉴别码 MAC 鉴别报文 图 7-7 所示的鉴别过程并没有执行加密算法，只是在计算散列值时在报文后面拼接了密 钥，因此这种鉴别报文的方法消耗的计算资源很少，但却能有效地保护报文的完整性。 在许多有关鉴别的文献中，常常看到在 MAC 前面加上一个 H 的写法，即 HMAC (H,ashed MAC). MAC 与 HMAC 的区别如图 7-8 所示［PETE12, 第 646 页］。前面图 7-7 所示的 MAC 实际上就是 HMAC 。计算 HMAC 是规定把密钥 K 拼接在明文后面，然后使用密码散列算法 对其进行运算，得出的散列值就是 HMAC 。但在计算 MAC 时则不一定这样做。首先，密 钥 K 不一定非要拼接在明文的后面，只要把密钥 K 作为一个计算 MAC 的参数即可。其次， 可以有多种计算 MAC 的算法，不一定非要使用严格的密码散列算法。在 RFC 2104 中，对 各种不同情况下 HMAC 的计算方法都有着详细的规定。但在本书中，为了方便，对 MAC 和 HMAC 可视为同义词。 产－ K -  图 7-8 MAC 与 HMAC 的区别 上述这种鉴别报文的方法还有一些问题有待解决。例如，采用怎样安全有效的方法来 分发通信双方共享的密钥 K? 另一种可行的方法是采用公钥系统。我们用图 7-9 来说明。 A I  一 1 已签名的非固定长度 不安全的 的报文鉴别码 互联网 一、～ 长度 的报文鉴别码 图 7-9 使用已签名的报义鉴别码对报文鉴别 用户 A 对报文 X 进行散列运算，得出固定长度的散列 H(X)。用自己的私钥对 H(X)进行 D 运算（也可以说成是用私钥进行加密），得出已签名的但非固定长度的报文鉴别码 MAC 。 • 345 •"}
{"doc_id": "network", "page": 357, "text": "诸注意，这里没有对报文 X 进行加密，而是对很短的散列 H(X)进行 D 运算，因此这种运算 仍然是很快的。 A 把已签名的非固定长度的报文鉴别码 MAC, 拼接在报文 X 后面，构成扩 展的报文发送给 B. B 收到扩展的报文后，先进行报文分离。虽然 B 不知道已签名的报文鉴别码的长度， 但由于报文 X 是明文，其结束处可以设有标记，因此分离出 MAC 不困难。分离后， B 对报 文 X 进行散列函数运算，同时用 A 的公钥对分离出的已签名的报文鉴别码 MAC 进行 E 运 算（也可以说成是用公钥进行解密）。最后对这两个运算结果 H(X)进行比较。如相等，就说 明一切正确。由于入侵者没有 A 的私钥，因此不可能伪造出 A 发出的报文。这里我们假定 B 事先知道 A 的公钥。 不难看出，采用这种方法得到的扩展的报文，不仅是不可伪造的，也是不可否认的。 图 7-9 所示的过程，可简称为： “A 用自己的私钥进行签名， B 用 A 的公钥进行鉴别”。 7.3.2 实体鉴别 实体鉴别和报文鉴别不同。报文鉴别是对每一个收到的报文都要鉴别报文的发送者， 而实体鉴别是在系统接入的全部待续时间内对和自已通信的对方实体只需验证一次。 最简单的实体鉴别过程如图 7-10 所示。 A 向远端的 B 发送带有自己身份 A （例如， A 的姓名）和口令的报文，并且使用双方约定好的共享对称密钥 KAB 进行加密。 B 收到此报文 后，用共享对称密钥 KAB 进行解密，从而鉴别了实体 A 的身份。 A I  一 1 1B  仁 图 7-10 仅使用对称密钥传送鉴别实体身份的报文 然而这种简单的鉴别方法具有明显的涌洞。例如，入侵者 C 可以从网络上截获 A 发给 B 的报文， C 井不需要破译这个报文（因为破译可能很费时间），而是直接把这个由 A 加密 的报文发送给 B, 使 B 误认为 C 就是 A; 然后 B 就向伪装成 A 的 C 发送许多本来应当发给 A 的报文。这就叫作重放攻击(re p lay a ttack) 。 C 甚至还可以截获 A 的 IP 地址，然后把 A 的 IP 地址冒充为自己的 IP 地址（这叫作 IP 欺骗），使 B 更加容易受骗。 为了对付重放攻击，可以使用不重数 (nonce) 。不重数就是一个不重复使用的大随机数， 即“一次一数”。在鉴别过程中不重数可以使 B 能够把蜇复的鉴别谘求和新的鉴别诮求区分 开。图 7-11 给出了这个过程。 A I  一1 时间 • 346 •  KAO 上 ,  RB  图 7-11 使用不重数进行鉴别 I B , _,"}
{"doc_id": "network", "page": 358, "text": "在图 7-11 中， A 首先用明文发送其身份 A 和一个不觅数 RA 给 B 。接看， B 响应 A 的 查问，用共享的密钥 K础对 RA 加密后发回给 A, 同时也给出f自己的不重数 R胪垃后， A 再响应 B 的查问，用共享的密钥 KABX寸 RB 加密后发回给 B 。这里很重耍的一点是 A 和 B 对 不问的会话必须使用不同的不重数染。由于不重数个能正复使用，所以 C 在进行觅放攻击时 无法正复使用所截获的,,t,,R 数。 在使用公钥密码体制时，可以对不重数进行签名鉴别。例如在图 7-11 中， B 用其私钥 对不屯数 RA 进行签名后发回给 A 。 A 用 B 的公钥核实签名，如能得出们已原来发送的不成 数 RA, 就核实f和自己通估的对方的确是 B 。同样， A 也用自己的私钥对不亟数胚进行签 名后发送给 B 。 B 用 A 的公钥核实签名，鉴别了 A 的身份。 公钥密码休制虽然不必在互相迪信的用户之间秘密地分配共享密钥，但仍打受到攻击 的可能。让我们石下面的例子。 C 冒充是 A, 发送报文给 B, 说：“我是 A”。 B 选择一个不重数 RB ，发送给 A, 但被 C 截获了。 C 用自己的私钥 SKc 冒充是 A 的私钥，对岛加密，并发送给 B. B 向 A 发送报文，要求对方把解密川的公钥发送过来，但这报文也被 C 截获了． C 把自己的公钥 P 氏冒允是 A 的公钥发送给 B 。 B 用收到的公钥 PKc 对收到的加密的 RB 进行解密，其结果当然正确。于是 B 相信通伈 的对方是 A, 接右就向 A 发送许多敏感数据，但都被 C 截获了。 然而上述这种欺骗手段不够高明，因为 B 只要打电话询问一下 A 就能戳穿骗局，因为 A 根本没有和 B 进行通信。但下面的“中间人攻击 “(man- i n- t he-mi ddle a ttack) 就更加具有 欺骗性。图 7-12 是“中间人攻击＂的示意图。 A I , -1  I I·, rlJ)  图 7-12 中间人攻击 I B  仁 从图 7-12 可石出， A 想和 B 通信，向 B 发送“我是 A\" 的报文，并给出了自己的身份。 这个报文被“中间人 “C 截获， C 把这个报文原封不动地转发给 B 。 B 选择一个不围数 RB 发送给 A, 但同样被 C 截获后也照样转发给 A. 中间人 C 用自己的私钥 S 殴对胚加密后发回给 B, 使 B 误以为是 A 发来的。 A 收到 RB 后也用自己的私钥 S 心对 RB 加密后发回给 B, 但中途被 C 截获丿t丢弃。 B 向 A 索取其 公钥，这个报文被 C 截获后转发给 A 。 C 把自己的公钥 PI<c,1i充是 A 的公钥发送给 B, 而 C 也截获到 A 发送给 B 的公钥 PKA• B 用收到的公钥 PKc （以为是 A 的）对数捩 DATA 加密，并发送给 A 。 C 截获后用自 己的私钥 S 氏解密，复制一份留下，然后再用 A 的公钥 PKA 对数据 DATA 加密后发送给 A 。 • 347 •"}
{"doc_id": "network", "page": 359, "text": "A 收到数据后，用自己的私钥 SKA 解密，以为和 B 进行了保密通信。其实， B 发送给 A 的 加密数据已被中间人 C 截获井解密了一份，但 A 和 B 却都不知道。 由此可见，公钥的分配以及认证公钥的真实性也是一个非常重要的问题。关于这点我 们在后面 (7.4.2 节）还要讨论。 7.4 密钥分配 由于密码环法是公开的，网络的安全性就完全基于密钥的安全保护上。因此在密码学 中出现了一个重要的分支一密钥管理。密钥管理包括：密钥的产生、分配、注入、验证和 使用。木节只讨论密钥的分配。 密钥分配（或密钥分发）是密钥忤理中最大的问题。密钥必须通过蚊安全的通路进行 分配。例如，可以派非常可靠的信使携带密钥分配给互相通信的各用户。这种方法称为网外 分配方式。但随行用户的卅多和网络流负的增大，密钥更换频繁（密钥必须定期更换才能做 到可靠），派信使的办法已不再适用，而应采用网内分配方式，即对密钥自动分配。 7.4.1 对称密钥的分配 对称密钥分配存在以下两个问题。 第一，如果 n 个人中的拼一个需要和其他 11-l 个入通信，就斋要 11(11 - I) 个密钥。但每 两人共享一个密钥，因此密钥数是 n(n - 1)/2 。这常称为 n2 问题。如果 n 是个很大的数，所 需要的密钥数狱就非常大。 第二，通信的双方怎样才能安全地得到共享的密钥呢？正是因为网络不安全，所以才 需要使用加密技术。但密钥义需要怎样传送呢？ 目前常用的密钥分配方式是设立密钥分配中心 KOC (Key Distribution Center). KOC 是 大家都估任的机构，其任务就是给需要进行秘密通信的用户临时分配一个会话密钥（仅使用 一次）。在图 7-13 中假定用户 A 和 B 都是 KDC 的登记用户。 A 和 B 在 KDC 登记时就已经 在 KDC 的服务器上安装了各自和 KDC 进行通信的主密钥 (mas t er key) KA 和 KB 。为简单起 见， 下面在叙述时把“主密钥＂简称为“密钥＂。密钥分配分为二个步骤（如图 7-13 中带箭 头直线上的O,e 和 O 所示）。 勹心中配 DC 分 K 钥密 。 时间 IB  t三一1 图 7-13 KDC 对会话密钥的分配 0 用户 A 向密钥分配中心 KDC 发送时用明文，说明想和用户 B 通信。在明文中给出 • 348 •"}
{"doc_id": "network", "page": 360, "text": "A 和 B 在 KDC 登记的身份。 8KDC 用随机数产生“一次一密＂的会话密钥 KAB 供 A 和 B 的这次会话使用，然后向 A 发送回答报文。这个回答报文用 A 的密钥 KA 加密。这个报文中包含这次会话使用的密钥 心和请 A 转给 B 的一个票据(ticke t?,该票据包括 A 和 B 在 KDC 登记的身份，以及这次 会话将要使用的密钥 KAB 。票据用 B 的密钥 K。加密， A 无法知道此票据的内容，因为 A 没 有 B 的密钥 KB ，当然 A 也不衙要知道此票据的内容。 0 当 B 收到 A 转来的票据并使用自己的密钥 KB 解密后，就知道 A 要和他通信，同时 也知道 KDC 为这次和 A 通信所分配的会话密钥 KABo 此后， A 和 B 就可使用会话密钥 KAB 进行这次通信了。 请注意，在网络上传送密钥时，都是经过加密的。解密用的密钥都不在网上传送。 KDC 还可在报文中加入时间戳，以防止报文的截取者利用以前已记录下的报文进行重 放攻击。会话密钥 KAB 是一次性的，因此机密性较高。而 KDC 分配给用户的密钥 KA 和 K扣 都应定期更换，以减少攻击者破译密钥的机会。 目前最出名的对称密钥分配协议是 Kerberos V 5® [RFC 4120, 4121, 建议标准］，是美国麻 省理工学院(MIT) 开发的。 Kerberos 既是鉴别协议，同时也是 KDC, 它已经变得很普及。 Kerberos 使用比 DES 更加安全的高级加密标准 AES 进行加密。下面用图 7-l4 介绍 Kerberos V4 的大致工作过程（其原理和 V5 大体一样，但稍简单些）。 勹飞A  TGSa As j  OS r c rb e k  A  。 KA穴 可从从句三］ I e  Ks 屯， Bkm 陑 k心从立 k佥屯 K8 麟 KA 佥 。 图 7-14 Kerberos 的工作原理 Kerberos 使用两个服务器：鉴别服务器 AS (Authentication Server) 、票据授予服务器 TGS (i)注：目前在网络安全领域中ticket一词还没有标准译名，也有人译为＂票”“执照“\"票证”或“签条“· ＠注： Kerberos 是希腊神话中具有三个头的狗，它为 Hades （哈得斯，主宰阴间的冥王）看门。 • 349 •"}
{"doc_id": "network", "page": 361, "text": "(Ticket-Granting Server) 。 Kerberos 只用千客户与服务器之间的鉴别，而不用千人对人的鉴别。 在图 7-14 中， A 是诮求服务的客户，而 B 是被请求的服务器。 A 通过 Kerberos 向 B 诮求服 务。 Kerberos 需要通过以下六个步骤鉴别的确是 A （而不是其他人冒充 A) 向 B 请求服务 后，才向 A 和 B 分配会话使用的密钥。下面简单解释各步骤。 OA 用明文（包括登记的身份）向鉴别服务器 AS 表明自己的身份。 AS 就是 KOC, 它 掌握各实体窍记的身份和相应的口令。 AS 对 A 的身份进行验证。只有验证结果正确，才允 1!1: A 和票据授予服务器 TGS 进行联系。 0 鉴别服务器 AS 向 A 发送用 A 的对称密钥 KA 加密的报文，这个报文包含 A 和 TGS 通估的会话密钥 Ks 以及 AS 要发送给 TGS 的票据（这个票据是用 TGS 的对称密钥 KTG 加密 的）。 A 并不保存密钥 KA• 但当这个报文到达 A 时， A 就键入其口令。若口令正确，则该 门令和适当的算法一起就能生成密钥 KA 。这个口令随即被销毁。密钥 KA 用来对 AS 发送过 米的报文进行解密。这样就提取出会话密钥 Ks （这是 A 和 TGS 通信要使用的）以及要转发 给 TGS 的票据（这是用密钥 KTG 加密的）。 8A 向 TGS 发送三项内容： • 转发鉴别服务器 AS 发来的票据。 • 服务器 B 的名字。这表明 A 诸求 B 的服务。请注意，现在 A 向 TGS 证明自己的 身份并非通过键入口令（因为入侵者能够从网上截获明文口令），而是通过转发 AS 发出的票据（只有 A 才能提取出）。票据是加密的，入侵者伪造不了。 • 用从加密的时间戳 T。它用来防止入侵者的重放攻击。 0 TGS 发送两个票据，每一个都包含 A 和 B 通信的会话密钥 KAB 。给 A 的票据用 Ks 加密；给 B 的票据用 B 的密钥岛加密。请注意，现在入侵者不能提取 KAB• 因为不知道 Ks 和 KB 。入佼者也不能重放步骤 8, 因为入侵者不能把时间戳更换为一个新的（因为不知道 Ks) 。如果入侵者在时间戳到期之前，非常迅速地发送步骤 0 的报文，那么对 TGS 发送过来 的两个梨据仍然不能解密。 0A 向 B 转发 TGS 发来的票据，同时发送用 KAB 加密的时间戳 T。 08 把时间戳 T 加 1 来证实收到了票据。 B 向 A 发送的报文用密钥 KAB 加密。 以后， A 和 B 就使用 TGS 给出的会话密钥 KAB 进行通信。 顺便指出， Kerberos 要求所有使用 Kerberos 的主机必须在时钟上进行“松散的“同步。 所谓“松散的“同步是要求所有主机的时钟误差不能太大，例如，不能超过 5 分钟的数点级。 这个要求是为了防止重放攻击。 TGS 发出的票据都设置较短的有效期。超过有效期的煦据就 作废f。因此入侵者即使截获了某个票据，也不能长期保留用来进行以后的重放攻击。 7.4.2 公钥的分配 在公钥密码体制中，公钥的分配方法并不简单。本节就讨论这个问题。 我们不妨先假定大家都各自保存有自己的私钥，而把各自的公钥发布在网上。假定 A 和 B 都是公司。有个捣乱者给 A 发送邮件，声称自己是 B, 要购买 A 生产的设备，货到付 款，并给出了 B 的收货地址。邮件中还附上 “B 的公钥＂ （其实是捣乱者的公钥）。最后用 捣乱者的私钥对邮件进行了签名。 A 收到邮件后，就用邮件中给出的捣乱者的公钥 (A 以为 自己使用了 B 的公钥），对邮件中的签名进行了鉴别，就误认为 B 真的是要购买设备。当 A • 350 •"}
{"doc_id": "network", "page": 362, "text": "把生产的设备运到 B 的地址后， B 才知道被愚弄了！捣乱者甚至还可伪造一个冒充 B 的网 站，上面有 “B 的公钥＂ （其实是捣乱者的公钥）。 那么，有没有可靠的方法来获得 B 的公钥，并且能确信公钥是真的？ 有一种非常可靠的方法，就是公司 A 派人亲自去公司 B, 直接向公司 B 索要其公钥。 这样拿到的 B 的公钥当然是可信任的。但这种很不方便的办法显然不能普遍推广使用。 现在流行的办法，这就是找一个可信任的第三方机构（第三方机构既不是需要 B 的公 钥的公司 A, 也不是拥有公钥的公司 B), 给拥有公钥的实体发一个具有数字签名的数字证 书 (digital ce rtifi cate), 有时也可简称为证书。数字证书就是对公钥与其对应的实体（入或机 器）进行绑定（b i ndin g)一个证明。因此它常称为公钥证书。这种签发证书的机构就叫作认证 中心 CA (Certifi cation Autho rity),它由政府或知名公司出资建立（这样就可以得到大家的信 任）。每个证书中写有公钥及其拥有者的标识信息（人名、地址、电子邮件地址或 [P 地址 等）。更重要的是，证书中有 CA 使用自己私钥的数字签名，这就是认证中心 CA 把 B 的未 签名的证书进行散列函数运算，再用 CA 的私钥对散列值进行 D 运算（也就是对散列值进 行签名）。这样就得到了 CA 的数字签名。把 CA 的数字签名和未签名的 B 的证书放在一起， 就最后构成了已签名的 B 的数字证书（如图 7-15 所示）。图中的数字证书只给出了砓护要的 几个项目。这样的证书无法伪造。任何用户都可从可信任的地方（如代表政府的报纸）获得 认证中心 CA 的公钥，以验证证书的真伪。这种数字证书是公开的，不需要加密。现在我国 的认证中心已有不少，例如，在金融领域，中国金融认证中心 CFCA (China Financial  Certifi cation Au t hor ity)是由中国人民银行牵头，联合 14 家全国性商业银行共同建立的金融认 证机构，其权威性是毋庸置疑的。在国际上，威瑞信公司 Ver i S ign是发行数字证书产品的一 家具有权威性的公司。 已签名的 B 的数字证书 勹1詈三三］荨 图 7-15 已签名的 B 的数字证书的产生过程 公司 A 拿到 B 的数字证书后，可以对 B 的数字证书的真实性进行核实。 A 使用数字证 书上给出的 CA 的公钥，对数字证书中 CA 的数字签名进行 E 运算，得出一个数值。再对 B 的数字证书（把 CA 的数字签名除外的部分）进行散列运算，又得出一个数值。比较这两个 数值。若～致，则数字证书是真的。当 A 收到包含有 B 的数字签名的订货单时，也能用类 似的方法，对订单的真实性进行核实（使用 B 的数字证书中给出的 B 的公钥）。 为了使 CA 发布的数字证书在各行各业中能够通用，数字证书的格式就必须标准化。为 此， ITU-T 制定了X. 509 协议标准，后来 TETF 采用了现在的版本，即 X .5 09 V3 [RFC 5280],  作为互联网的建议标准(1 47 页）。 X.509 又称为互联网公钥基础结构 PKI (Publ ic Key  Tn fras truc tt1re) 。 X.509 规定了一个数字证书必须包括以下这些重要字段： • X. 509 的版本 • 数字证书名称及序列号 • 351 •"}
{"doc_id": "network", "page": 363, "text": "• 本数字证书所使用的签名算法 • 数字证书签发者的唯一标识符 • 数字证书的有效期（有效期开始到结束的日期范围） • 主体名（或主题名，公钥和数字证书拥有者的唯一标识符） • 公钥（数字证书拥有者的公钥和使用算法的标识符，对应的私钥由证书拥有者保存） X.509 提出把多级认证中心链接起来的，构成一个树状的认证系统（如图 7-16(a) 所示）。 在多级认证系统的末端就是用户 (A~E) 。在 X .5 09 中并没有规定这种链接需要多少级，也 没有给每一级的认证中心规定统一的名称。但最高一级的认证中心都称为根认证中心 (Root CA), 即公认可信的认证中心（或无条件信任的），且其公钥是公开的。在这种树状的认证 系统中，可以有不止一个根 CA 。从根 CA 向下的所有链接都称为信任链，表示处在这条链 接上的认证机构都是可信的。 根证书 ＂片． L｀者 中间 CA2 的证书 ...,. ~  验证” 中间 CA 中间 CA，的公钥 根 CA笭发 根 CA 签名 (b)  图 7-16 树状结构的多级认证系统(a) 和证书链(b) 图 7-l 6(a) 最右边的一串链接就是一条信任链的例子：根 CA 一中间 CA2一用户 E 。与这 条倍任链对应的是证书链（如图 7-16(b) 所示），通过图中所示的链接，就可以查到本证书的 签发者，也可以知道用谁的公钥来验证本证书中的签名。在这条证书链中，根 CA 给中间 CA2 签发了中间证书，并使用根 CA 的私钥进行数字签名。中间 CA2 可以用根 CA 的公钥， 对证书中的根 CA 签名进行验证。因此中间证书是可信的和不可篡改的。同理，中间 CA2 给下面的一个用户签发了用户证书，并使用中间 C心的私钥进行数字签名。用户可以用中 间 C心的公钥，对用户证书中的中间 C处的签名进行验证。因此，这个用户证书也是可信 的和不可篡改的。请注意，最顶层的根证书的数字签名是自签名（即自己的私钥给自己签 名）。根证书不需要其他的认证机构对其签名，是我们的信任链的起点。 若证书链中的某个认证中心没有严格遵守证书所规定的要求（例如，把证书转让给了 其他单位，但并未严格验证其身份），那么这个节点以下的证书是否还可信，就应重新验证。 用户若发现私钥被盗或遗失，应及时报告上级 CA, 以便撤销证书。每一个 CA 应当有一个 公布于众的、用本 CA 的私钥签名证书撤销名单，并定期更新。 7.5 互联网使用的安全协议 前面几节所讨论的网络安全原理都可用在互联网中，目前在网络层、运输层和应用层 都有相应的网络安全协议。下面分别介绍这些协议的要点。 • 352 •"}
{"doc_id": "network", "page": 364, "text": "7.5.1 网络层安全协议 1. IPsec 协议族概述 我们在第 4 章的 4.8.l 节中讨论虚拟专用网 VPN 时，提到在 VPN 中传送的信息都是经 过加密的。现在我们就要介绍提供这种加密服务的 IPsec 。 JPsec 并不是单一的协议，而是能够在 IP 层提供互联网通信安全的协议族（不太严格的 名词 “IPsec 协议”也常见到）。实际上， IPsec 包含了一个通用框架和若干加密算法，具有 相当的灵活性和可扩展性。 IPsec 允许通信双方从中选择合适的算法和参数（例如，密钥长 度），以及是否使用鉴别。为保证互操作性， lPsec 规定其所有的实现都必须包含 IPsec 所推 荐的全部加密算法。 IPsec 就是 “IP 安全 (security) \"的缩写。在很多 RFC 文档中已给出了详细的描述。在这 些文档中，最重要的就是描述 IP 安全体系结构的 RFC 4301 （目前是建议标准）和提供 JPsec 协议族概述的 RFC 6071 。 IPsec 协议族中的协议可划分为以下三个部分： (1) IP 安全数据报格式的两个协议：鉴别首部 AH (Authentication Header)协议和封装安 全有效载荷 ESP (Encapsulation Secur ity Payload) 协议。 (2) 有关加密算法的三个协议。 (3) 互联网密钥交换 IKE (Intem~t Key Exchange) 协议。 下面我们要重点介绍 IP 安全数据报的格式，以便了解 IPsec 怎样提供网络层的安全通 信。 AH 协议提供源点鉴别和数据完整性，但不能保密。而 ESP 协议比 AH 协议复杂得多， 它提供源点鉴别、数据完整性和保密。 TPsec 支持 1Pv4 和 IPv6 。在 1Pv6 中， AH 和 ESP 都 是扩展首部的一部分。 AH 协议的功能都已包含在 ESP 协议中，因此使用 ESP 协议就可以 不使用 AH 协议。下而我们将不再讨论 AH 协议，而只介绍 ESP 协议的要点。 使用 ESP 或 AH 协议的 IP 数据报称为 IP 安全数据报（或 IPsec 数据报），它可以在两 台主机之间、两个路由器之间或一台主机和一个路由器之间发送。 IP 安全数据报有以下两种不同的工作方式。 第一种工作方式是运输方式(trans po rt mode) 。运输方式是在整个运输层报文段的前后分 别添加若干控制信息，再加上 IP 首部，构成 IP 安全数据报（见图 7-17(a)) 。 发送在前 [Psec 首部 !Pscc 尾部 !Psec 首部 [Psec尾部 lP 首部 1 [p安全数据凇的有效载荷 「 IP 安全数据报 (a) 运输方式 IP 首部 I IP 安全数据可报的有效载荷 IP 安全数据报 (b) 隧道方式 图 7-17 IP 安全数据报的两种工作方式 第二种工作方式是隧道方式(tunnel mode) 。隧道方式是在原始的 IP 数据报的前后分别 添加若干控制信息，再加上新的 IP 首部，构成一个 IP 安全数据报（见图 7-17(b)) 。 无论使用哪种方式，最后得出的JP安全数据报的 IP 首部都是不加密的。只有使用不加密 的 IP 首部，互联网中的各个路由器才能识别 IP 首部中的有关信息，把 IP 安全数据报在不安全 • 353 •"}
{"doc_id": "network", "page": 365, "text": "的互联网中进行转发，从源点安全地转发到终点。所谓“安全数据报”是指数据报的数据部分 是经过加密的，并能够被鉴别的。通常把数据报的数据部分称为数据报的有效载荷（pay load) 。 由千目前使用最多的就是隧道方式，因此下面的讨论只限于隧道方式。 2. 安全关联 在发送 IP 安全数据报之前，在源实体和目的实体之间必须创建一条网络层的逻辑连接， 即安全关联 SA (Secu rity Assoc i a ti on) 。这样，传统的互联网中无连接的网络层就变为了具有 逻辑连接的一个层。安全关联是从源点到终点的单向连接，它能够提供安全服务。如要进行 双向安全通信，则两个方向都需要建立安全关联。假定某公司有一个公司总部和一个在外地 的分公司。总部需要和这个分公司以及在各地出差的 n 个员工进行双向安全通信。在这种情 况下，一共需要创建(2 + 2n) 条安全关联 SA 。在这些安全关联 SA 上传送的就是 IP 安全数据 报。 图 7- l 8(a) 是安全关联 SA 的示意图。公司总部和分公司都各有一个负责收发 IP 数据报 的路由器 R] 和 R2 （通常就是公司总部和分公司的防火墙中的路由器），而公司总部与分公 司之间的安全关联 SA 就是在路由器凡和 R2 之间建立的。当然，路由器民和 R2 都必须预 先装有 IPsec 。现假定公司总部的主机 H1 要和分公司的主机 H2 通过互联网进行安全通信。 公司总部主机凡发送给分公司主机比的 lP 数据报，必须先经过公司总部的路由器 RlO 然后经 IPsec 的加密处理后，成为 IP 安全数据报。这样就把原始的 IP 数据报隐藏在 IP 安全 数据报中了。 IP 安全数据报经过互联网中很多路由器的转发，最后到达分公司的路由器 R2. 路由器 R2 对 IP 安全数据报解密，还原出原始的数据报，传送到终点主机 H2 。从逻辑上看， IP 安全数据报在安全关联 SA 上传送，就好像通过一个安全的隧道。这就是＂隧道方式”这 一名词的来源。如果总部的主机 H] 要和总部的另一台主机 H3 通信，由于都在公司内部，不 需要加密，因此不需要建立安全关联。凡发出的 lP 数据报只需通过总部内部的路由器 R1 转发一次即可送到 H3 。如果儿要上网查看天气预报，同样不需要建立安全关联，而是发送 IP 数据报，经过路由器 R1 转发到互联网中的下一个路由器，最后到达互联网中预报气象的 服务器。 .  、、,' 、蛉 2, •  .  H.  ~n-} ..  司~~公~分~ H, 公二 (a) 公司总部与分互I::1 的安全通化 (b) 公司总部另业务员的安全通伯 图 7-18 安全关联 SA 的不意图 • 354 •"}
{"doc_id": "network", "page": 366, "text": "若公司总部的主机凡要和某外地业务员的便携机比进行安全通信，则情况将稍有不同 （如图 7-18 (b)所示）。可以看出，这时公司总部的路由器民和外地业务员的便携机比建立 安全关联 SA （即路由器和主机之间的安全关联）。公司总部凡发送的 IP 数据报，通过路由 器 R) 后，就变成了 IP 安全数据报。经过互联网中许多路由器的转发，最后到达 H2 。可以 看出，现在是在路由器 R) 和业务员的便携机比之间构成了一个安全隧道。外地业务员利用 事先安装在便携机比中的JPsec 对 IP 安全数据报进行鉴别和解密，还原凡发来的 TP 数据 报。 建立安全关联 SA 的路由器或主机，必须维护这条 SA 的状态信息。我们以图 7-18 中的 安全关联 SA 为例，说明其状态信息应包括的项目： (1) 一个 32 位的连接标识符，称为安全参数索引 SPI (Security Parameter Index) 。 (2) 安全关联 SA 的源点和终点的 IP 地址（即路由器凡和凡的 IP 地址）。 (3) 所使用的加密类型（例如， DES 或 AES) 。 (4) 加密的密钥。 (5) 完整性检查的类型（例如，使用报文摘要 MD5 或 SHA-I 的报文鉴别码 MAC) 。 (6) 鉴别使用的密钥。 当路由器凡要通过 SA 发送 IP 安全数据报时，就必须读取 SA 的这些状态信息，以便 知道如何把 IP 数据报进行加密和鉴别。 3. IP 安全数据报的格式 图 7-19 是 IP 安全数据报的格式。下面以隧道方式为例，结合各字段的作用，讨论—下 IP 安全数据报是怎样构成的。图中的数字O 至 O 表示 IP 安全数据报构成的先后顺序。 匕芦］前 协议＝ 50; e ESP  首部 安全参数索引 SP J 启 [P安全数据报 IP 安全数据报的有效载荷 O 鉴别的部分 e 加密的部分（填充为 4 字节的倍数） ESP 的有效载荷 原始的 IP 数据报 IOESP O 报文鉴别码 的有效载荷 尾部 I MAC  1 飞。商 1 填充长度忭一个加 填充 8 位 8 位 协议＝ 4 图 7-19 IP 安全数据报的格式 0 首先在原始的 IP 数据报（也就是 ESP 的有效载荷）后面添加 ESP 尾部。 ESP 尾部 有三个字段。第一个字段是填充字段，用全 0 填充。第二个字段是填充长度 (8 位），指出 填充字段的字节数。为什么要进行填充呢？这是因为在进行数据加密时，通常都要求数据块 长度是若千字节（例如， 4 字节）的整数倍。当 IP 数据报长度不满足此条件时，就必须用 0 进行填充。每个 0 为一个字节长。虽然填充长度 (8 位）的最大值是 255, 但实际上，填充 很少会用到这个最大值。 ESP 尾部最后一个字段是“下一个首部 “(8 位）。这个字段的值指 明，在接收端， ESP 的有效载荷应交给哪个协议来处理。如图 7-19 所示， IP 安全数据报有 • 355 •"}
{"doc_id": "network", "page": 367, "text": "三个首部。现在 ESP 尾部中的“下一个首部“显然就是指 ESP 的有效载荷中的“原始的 IP 首部“, lP 的协议值是 4, 因此“下一个首部“应填入的数值是 4 。如果不是隧道方式而是 运输方式，则 “ESP 的有效载荷”就应当是 TCP 或 UDP 报文段，“下一个首部”的值也要 改为另外的数值。 0 按照安全关联 SA 指明的加密算法和密钥，对 “ESP 的有效载荷（即原始的 IP 数据 报） ＋ ESP 尾部“（见图 7-19 中的“加密的部分”)进行加密。 0 对“加密的部分“完成加密后，就添加 ESP 首部。 ESP 首部有两个 32 位字段。第 一个字段存放安全参数索引 SPJ。通过同一个 SA 的所有 IP 安全数据报都使用同样的 SP1 值。 第二个字段是序号，鉴别要用到这个序号，它用来防止重放攻击。请注意，当分组重传时序 号并不重复。 0 按照 SA 指明的算法和密钥，对 “ESP 首部＋加密的部分”（见图 7-19 中的“鉴别 的部分”)生成报文鉴别码 MAC 。 0 把所生成的报文鉴别码 MAC 添加在 ESP 尾部的后面，和 ESP 首部、 ESP 的有效载 荷、 ESP 尾部一起，构成 IP 安全数据报的有效载荷。 0 生成新的 IP 首部，通常为 20 字节长，和普通的 IP 数据报的首部的格式是一样的。 需要注意的是，首部中的协议字段的值是 50, 表明在桵收端，首部后面的有效载荷应交给 ESP 协议来处理。 当分公司的路由器民收到 IP 安全数据报后，先检查首部中的目的地址。发现目的地址 就是 R2, 于是路由器民就继续处理这个 IP 安全数据报。 路由器凡找到 IP 首部的协议字段值（现在是 50), 就把 IP 首部后面的所有字段（即 IP 安全数据报的有效载荷）都用 ESP 协议进行处理。先检查 ESP 首部中的安全参数索引 SPL 以确定收到的数据报屈于哪一个安全关联 SA （因为路由器 R2 可能有多个安全关联）。 路由器凡接若计算报文鉴别码 MAC, 看是否和 ESP 尾部后面添加的报文鉴别码 MAC 相符。 如是，即知收到的数据报的确是来自路由器 R1 。再检验 ESP 首部中的序号，以证实有无被 入侵者重放。接着要用和这个安全关联 SA 对应的加密算法和密钥，对已加密的部分进行解 密。再根据 ESP 尾部中的填充长度，去除发送端埴充的所有 O, 还原出加密前的 ESP 有效 载荷，也就是 H1 发送的原始 TP 数据报。 根据解密后得到的 ESP 尾部中“下一个首部”的值（现在是 4), 把 ESP 的有效载荷交 给 lP 来处理。当找到原始的 lP 首部中的目的地址是主机比的 IP 地址时，就把整个的 IP 数据报传送给主机 H2 。整个 IP 数据报的传送过程到此结束。 请注悠，在图 7-19 的“原始的 IP 首部“中，是用主机 H1 和 H2 的 lP 地址分别作为源 地址和目的地址，而在 IP 安全数据报的“新的 IP 首部“中，是使用路由器 R1 和 R2 的 TP 地 址分别作为源地址和目的地址（这是图 7-18(a) 所示的情况）。但如果是图 7-l 8(b) 所示的情况， TP 安全数据报不经过另一个路由器 R2, 那么在 IP 安全数据报的“新的 IP 首部“中，要用 路由器民和主机 H2 的 TP 地址分别作为 IP 安全数据报的源地址和目的地址。 从以上的讨论可以看出，设想有一个 IP 安全数据报在互联网中被某人截获，如果截获 者不知道此安全数据报的密码，那么他只能知道这是一个从路由器 R1 发往路由器凡的 IP 数据报，但却无法看懂其有效载荷中的数据含义。如果截获者篡改了数据报的源地址，那么 安全数据报的鉴别功能可以保证源地址的真实性。假定截获者故意删除了安全数据报中的一 些字节，但由于接收端的路由器凡能够进行完整性检验，就不会接收这种含有差错的信息。 • 356 •"}
{"doc_id": "network", "page": 368, "text": "如果截获者试图进行虚放攻击，那么由千安全数据报使用了有效的序号，使得重放攻击也无 法得逞。 4. IPsec 的其他构件 前面已经提到过，发送 IP 安全数据报的实体可能要用到很多条安全关联 SA 。那么这些 SA 存放在什么地方呢？这就要提及 lPsec 的一个亟要构件，叫作安全关联数据库 SAD (Security Assoc iation Database) 。所有需要运行 IPsec 的站点都必须有 SAD 。当主机要发送 IP 安全数据报时，就要在 SAD 中查找相应的 SA, 以便获得必要的信息，来对该 IP 安全数据 报实施安全保护。同样，当主机要接收 IP 安全数据报时，也要在 SAD 中查找相应的 SA, 以便获得信息来检查该分组的安全性。 前面已经提到了，主机所发送的数据报并非都必须进行加密，很多信息使用普通的数 据报用明文发送即可。因此，除了安全关联数据库 SAD, 还衙要另一个数据库，这就是安 全策略数据库 SPD (Security Policy Database) 。 SPD 指明什么样的数据报衙要进行 IPsec 处理。 这取决千源地址、源端口、目的地址、目的端口，以及协议的类型等。因此，当一个 IP 数 据报到达时， SPD 指出应当做什么（使用 IP 安全数据报还是不使用），而 SAD 则指出，如 果需要使用 IP 安全数据报，应当怎样做（使用哪一个 SA) 。 还有一个问题，安全关联数据库 SAD 中存放的许多安全关联 SA 是怎样建立起来的呢？ 如果一个虚拟专用网 VPN 只有几个路由器和主机，那么用人工键入的方法就可以建立起所 需的安全关联数据库 SAD 。但如果一个 VPN 有好几百或几千个路由器和主机，人工键入的 方法显然是不行的。因此，对千大型的、地理位置分散的系统，为了创建 SAD, 我们需要 使用自动生成的机制，即使用互联网密钥交换 IKE (Internet Key Exchan ge) 协议。 IKE 的用途 就是为 IP 安全数据报创建安全关联 SA 。 IKE 是个非常复杂的协议， l K.E v2 是其新的版本，在 2014 年 10 月已成为互联网的正式 标准 [RFC 7296, STD79] 。 IKEv2 以另外三个协议为基础： (I) Oakley—是个密钥生成协议[RFC 2412] 。 (2) 安全密钥交换机制 SKEME (Secure Key Exchange MEchani sm)-—是用千密钥交换 的协议。它利用公钥加密来实现密钥交换协议中的实体鉴别。 (3) 互联网安全关联和密钥管理协议 IS AK.MP (Internet Secure Association and Key Management  Pro tocol) —用于实现 IKE 中定义的密钥交换，使 IKE 的交换能够以标准化、格式化的报 文创建安全关联 SA 。 关于 IKE 的深入介绍可参阅有关文档，如 RFC4945 和 RFC 7427 （都是建议标准）。 7.5.2 运输层安全协议 1. 协议 TLS 的要点 当万维网能够提供网上购物时，安全问题就马上被提到桌面上来了。例如，当顾客在 不安全的互联网士购物时，他会要求得到下列安全服务： (1) 顾客需要确保服务器屈千真正的销售商，而不是某个冒充者。这就是应对身份进行 鉴别。 (2) 顾客与销售淌需要确保报文的内容（例如账单）在传输过程中没有被篡改。这就是 • 357 •"}
{"doc_id": "network", "page": 369, "text": "应保证通信内容的数据完整性。 (3) 顾客与销售商需要确保诸如信用卡上的敏感信息不被泄露。这就是要有机密性。 不仅在电子商务领域，即使在我们日常上网浏览各种信息时，我们所浏览的信息也是 属千个人隐私，不应作为网上的公开信息。因此，在很多情况下，客户端（浏览器）与服务 器之间的通信需要使用安全的运输层协议。曾经广泛使用的运输层安全协议有两个，即： (1)  安全套接字层 SSL (Secure Socket Layer). (2) 运输层安全 TLS (Transp o兀 Layer Security)。 协议 SSL 是 Netscape 公司在 1994 年开发的安全协议，广泛应用千基于万维网的各种网 络应用（但不限千万维网应用）。 SSL 作用在端系统应用层的 HTTP 和运输层之间，在 TCP 之上建立起一个安全通道，为通过 TCP 传输的应用层数据提供安全保障。 1995 年 Netscape 公司把协议 SSL 转交给 IETF, 希望能够把 SSL 进行标准化。 1999 年 IETF 在 SSL 3.0 的基础上设计了协议 TLS 1. 0 （改动极少），为所有基千 TCP 的网络应用提供 安全数据传输服务。为了应对网络安全的变化， IETF 及时地对 TLS 的版本进行升级，如 2006 年的 TLS 1.1, 2008 年的 TLS 1.2 。 2014 年 10 月，谷歌建议禁用 SSL3.0, 因为其设计上 有涌洞，用户的敏感信息有被窃取的可能。接着， Mozi lla 和微软也发出了同样的安全通告。 2018 年 8 月 IETF 发布了经历了 28 个草案后才通过的最新版本 TLS 1.3 [RFC 8446, 建议标准］ （不向后兼容）。在 2020 年，旧版本 TLS 1. 0/ 1.1均被废弃。目前谷歌浏览器 Chrome 和火狐 浏览器 Fire fo x 都已开始使用更加安全的协议 TLS 1.3,但不少老客户端仍未抛弃一些旧版本。 应当说，到目前为止协议 TLS 1.2 还是安全可用的，只是被发现了有潜在的安全隐患。因此， 现在能够使用的运输层安全协议就只剩下协议 TLS 1.2 和协议 TLS 1.3 了。 协议 TLS 的位置在运输层和应用层之间（如图 7-20 所示）。虽然协议 SSL 2.0/3.0 均已 被废弃不用了，但现在还经常能够看到把 “SSL厅LS\" 视为 TLS 的同义词。这是因为协议 TLS 本来就源千 SSL （但并不兼容），而现在旧协议 SSL 被更新为新协议 TLS 。 I  应用程序 TLS （或 SSUTLS) TCP  IP  图 7-20 协议 TLS 位千运输层和应用层之间 应用层使用协议 TLS 最多的就是 HTTP, 但并非仅限千 HTTP 。因为协议 TLS 是对 TCP 加密，因此任何在 TCP 之上运行的应用程序都可以使用协议 TLS 。例如，用于 IMAP 邮件存取的鉴别和数据加密也可以使用 TLS 。 TLS 提供了一个简单的带有套接字的应用程 序接口 AP J.这和 TCP 的 API 是相似的。 当不需要运输层安全协议时， HTTP 就直接使用 TCP 连接，这时协议 TLS 不起作用。 由千衙要使用运输层安全协议的人越来越多，因此现在相当多的网站已是全站使用运输层安 全协议。例如，当我们使用百度网站浏览信息时，在浏览器的地址栏键入其官网地址 www.ba i du.com 后（不必在前面键入 http://或 https://), 就可以在屏幕上看到这样的响应： a littp s://v心w.ba i du.com 可以看出，尽管用户在浏览器上没有键入 h ttp s://, 但百度网站总是提供安全的运输层 服务。提供安全运输层服务的标志是地址栏 URL 中的协议部分显示出的是 https, 并且在其 • 358 •"}
{"doc_id": "network", "page": 370, "text": "左边还有一个安全锁丛的标忐。在 h ttp后面加上的 s 代表 security,表明是使用 HTIPS ，即 提供安全服务的 HTTP 协议 (TCP 的 HTIPS 端口号是 443, 而不是 HTTP 使用的端 U 号 80) 。 这时我们就可以放心和这样的网站进行通信，因为这个网站已经被鉴别了是贞正的百度网站， 井且之后在浏览器和百度服务器之间的所有交互报文都是加密的，因而通信的机密性得到了 保证。 现在我们使用某些主流浏览器访问不安全的网站时，浏览器会向用户发出“不安全” 的警告。 下面给出;i,,我们键入桔梗网的网址 shu .ji egen g.com 后所行到的响应： 谷歌 Chrome 浏览器指出“不安全“ 火狐 F i re fo x 浏览器提示无安全锁 。下右之 shu.jiegeng.com (D & st jiegeng.com  这就提醒找们在上网时要注总信息的安全。 协议 TLS 具有双向鉴别的功能。但大多数情况下使用的是 1)1向鉴别，即客户y间（浏览 器）需要鉴别服务器。也就是说，浏览器 A 要确信即将访问的网站服务器 B 是安全和可信 的。这必须耍有两个前提。首先，服务器 B 必须能够证明本身是安全和可信的。因此服务 器 B 需婓有一个证书来证明自己。现在我们假定服务器 B 已经持有了有效的 CA 证书。这 正是运输层安全协议 TLS 的基石。其次，浏览器 A 应具有一些手段来证明服务器 B 是安全 和可信的。下面就来讨论这一点。 生产电脑操作系统的厂~j为了方便用户，把当前获得公众信任的许多上流认证中心 CA 的根证书，都已内甡在其操作系统中。这些根证书上都有认证中心 CA 的公钥 P 氐扣而且 根证书都用 CA 的私钥 SKcA 进行了自签名（防止伪造）。用户为了验证要访问的服务器是否 安全和可信，只要打开电脑中的浏览器（操作系统自带的或用户自己装上的），就可查到操 作系统收藏的某个根认证中心的根 CA 证书，井可以利用证书上的公钥 PKcA x-t B 的证书进 行验证。若服务器 B 的证书是证书链上的某个中间 CA 签发的，那么浏览器 A 也可用类似 方法验证 B 的证书的页实性。 由丁·浏览器与服务器的通信方式就是以前讲过的“客户－服务器方式”，因此下面就用 客户代表浏览器。 如图 7-21 所示，在客户与服务器双方已经建立了 TCP 连接后，就可开始执行协议 TLS 。 根据 RFC 8446, 这甩主要有两个阶段，即握手阶段和会话阶段。在握手阶段， TLS 使用其 中的握手协议，而在会话阶段， TLS 使用其中的记录协议。下血讨论协议 TLS 的婓点。 客户 A 双方已建立了 TCP 连桵 钥书 MS 钥 公证密的的钥话AB 密会 C 别主成 用鉴生生 七 oo  议 01 议 协协 一手一求 l' 握记 A 选定的加密算法 B 确认的加密算法 B 的数字证书,  2 用 B 的公钥加密 PKu(MS) PK心· 数据传输（保密，完整性） 0 用 B 的私钥觯密 SK8(P岛(MS)) sMS  O 生成会话密钥 007-21 TLS 建立安全会话的工作原理 • 359 •"}
{"doc_id": "network", "page": 371, "text": "我们先介绍协议 TLS 的握手阶段。握手阶段要验证服务器是安全可信的，同时生成在 后面的会话阶段所衍的共享密钥，以保证双方交换的数据的私密性和完整性。这里要提阱读 者，但刚开始执行协议 TLS 时，通信双方的信逍是不安全的。因此要弄消： （ I) 双方怎样通 过不安全的信道得到会话时所需的共享密钥。这里没有采用密钥分发中心K.DC 来分配密钥， 而是采用自己生成共享密钥的方法。（ 2) 用什么方法保证所传送数据的机密性与完整性。 (I) 协商加密算法 O 客户 A 向服务器 B 发送自己选定的加密郓法（包括密钥交换算 法）。 O服务器 B 从中确认自己所支持的环法，同时把自己的 CA 数字证书发送给 A 。这里 要说明一下，从 TLS 1.0 更新到I. I 和1. 2 版本时，每一次更新都浒加了当时认为是更加安 全可靠的加密笃法。为了协议的向后兼容，对老版本中的不太安全的数十种钵法也都保留下 来了。这就造成协商过程非常耗时，需要花费 2 倍 RTT 的时间（通常记为 2-RTT) 。因此最 新的 TLS 1.3 版本把陈旧的很多种算法统统取悄（例如 MOS, SHA-I, DES, 3DES 等），只留 下几种最安全的算法。客户不是把自己所有的加密符法都告诉服务器，供服务器来挑选，而 是猜测服务器可能愿心使用什么加密算法，把自己选定的加密算法兀接发送给服务器，让服 务器来确认。这就把 “协商”时间缩短为 1-RTT 。 (2) 服务器鉴别 O 客户 A 用数字证书中 CA 的公钥对数字证书进行验证鉴别。 (3) 生成主密钥 O 客户 A 按照双方确定的密钥交换符法生成主密钥 MS (Master Secre t)。 O 客户 A 用 B 的公钥 PKB 对主密钥 MS 加密，得出加密的主密钥 PKe(MS), 发送给服务器 B 。请注意，在有关 TLS 的文档中，密钥一词使用的是 Secre t,而不是 Key。 (4) 服务器 B 用自己的私钥把主密钥解密出来： SK8(PK8(MS)) = MS 。这样，客户 A 和 服务器 B 都拥有了为后面的数据传输使用的共同的主密钥 MS 。 (5) 为了使双方的通信更加安全，客户 A 和服务器 B 奻好使用不同的密钥。千是主密钥 被分割成 4 个不同的密钥，这就是图 7-21 中的 O 和 0 ：生成会话密钥。在这以后，每一方 都拥有这样 4 个密钥（请注意，这些都是对称密钥，即加密和解密用的是同一个密钥）： • 客户 A 发送数据时使用的会话密钥 KA • 客户 A 发送数据时使JI]的 MAC 密钥 MA • 服务器 B 发送数据时使川的会话密钥 KB • 服务器 B 发送数据时使用的 MAC 密钥 MB 会话密钥不使用非对称密钥，因为对称密钥的运行速度快得多（相差 3 个数揖级）。 下面讨论协议 TLS 的会话阶段。会话阶段要保证传送数据的机密性和完整性。 客户或服务器在发送数据时，都把长的数据划分为较小的数据块，叫作记录(record) 。 然后对每一个记录进行鉴别运环和加密运环。为了防止入佼者截取传输中的记录，或颠倒记 录的前后顺序， TLS 的记录协议对每一个记录按发送顺序赋予序号，把每一方发送的第一 个记录作为 0 号记录。发送下一个记录时）字号就加 1 ，但序号砐大值不得超过 264 - I, 且不 允许序号绕问。然而此序号并非写在记求之中，而是在进行散列运算时，把序号包含进去。 例如，当客户 A 向服务器 B 发送一个明文记录时，客户 A 先把 MAC 密钥 MA 和该记录当 前的序号一起拼接在此明文记录之后，然后进行散列运算，得出 MAC 。再把得出的 MAC 和明文记录拼接起来，用会话密钥 KA 进行加密，发送给服务器 B 。 B 使用同样的会话密钥 趴进行解密，然后分离出明文记录和 MAC 。 B 再把同样的 MAC 密钥 MA 和该记录应有的 序号拼接在此明文记录之后，进行散列运算，看得出的结果与前面得出的 MAC 值是否一致， 以鉴别收到的明文记求的完整性（内容和顺序均无误）。上述对记录加密的方法称为 AEAD • 360 •"}
{"doc_id": "network", "page": 372, "text": "{Authenticated Encryption with Assoc iated Data), 即带关联数据的鉴别加密。 实际上，客户 A 所发送的加密的记录的前面，还必须添加三个不加密的字段，图 7-22 给出f这三个字段的位觉。类屯字段指明所传送的记录出握手阶段的报文，还是应用程序传 送的报文，或奻后要关闭 TLS 连接的报文（下一小节将要解释）。长度字段给出的字节数可 用来从 TCP 报文中提取 TLS 记录。 对这部分用 KA 加密 1 类型 I 版个 1 长度［了厂；；；勹云汀 图 7-22 TLS 传送的记录格式 2. 协议 TLS 必须包含的措施 以上介绍的只是协议 TLS 的要点。但若仅仅是这样，还不能提供足够的安全。因此， 对前面图 7-21 所示的双方的握手阶段，需要补充一些措施。 (I) 在客户 A 向服务器 B 发送自己选定的加密符法（包括密钥交换算法）时，还要向 服务器 B 发送客户的不重数。服务器 B 从中确认自己所支持的算法，同时把自己的 CA 数 字证书和服务器的不重数发送给客户 A 。 (2) 生成预主密钥 客户 A 验证了服务器 B 的数字证书后，生成为下一步生成主密 钥使用的预主密钥 PMS (Pre-Mas ter Secret),并用 B 的公钥 P 知对预主密钥 PMS 加密，把 加密的预主密钥 PKo(PMS) 发送给服务器 B 。 B 用其私钥 SKB 进行解密，得出预主密钥 PMS 。 这样，客户 A 和服务器 B 都拥有了为后面的数据传输使用的共同的预主密钥 PMS 。 (3) 生成主密钥 客户 A 和服务器 B 各自使用同样的（已酕定的）仅法，使用拯主 密钥 PMS 以及客户的不重数和服务器的不项数，生成主密钥 MS 。然后再将其划分为 4 个 密钥。于是 A 和 B 各拥有相同的 4 个密钥（屈一方在发送数据时使用的会话密钥和 MAC 密 钥）。 (4) 客户 A 向服务器 B 发送的全部握手阶段报文的 MAC 。 (5) 服务器 B 向客户 A 发送的全部握手阶段报文的 MAC 。 上述最后的 (4) 和 (5) 的作用是这样的。在 A 向 B 发送加密的预主密钥之前的握手信息是 没有加密的明文，因此可能受到入佼者的篡改。现在 A 和 B 都各自对全部握手阶段的报文 计算f散列值 MAC 。如果入侵者篡改了处在传输过程中的某个报文，那么上面(4)和 (5) 所得 出的 MAC 值必然不一致。这样 A 或 B 就可以立即中止当前的连接。 在 (I) 中客户和服务器各产生一个仅使用一次的不重数，其目的是为了防止“重放攻击“。 设想在 A 和 B 之间有一个入佼者，他截获了 A 和 B 交互的全部报文。虽然他未能解密 A 和 B 交互的具体内容，但他可以在以后的某 El' 呕新按照原来的顺序依次发送给 B 。如果没有 使用上述的不觅数，那么 B 无法发现这是入侵者重放 1 日的报文。 B 也将和前次的握手过程 一样，向 A 发回报文（实际上是发给了中间人入侵者）。这样造成的后果是很严重的。但使 用了不亟数以后．在下一个 TCP 连接中，客户 A 必须使用另一个不同的不亟数。这样就有 效地防止了觅放攻击。 前面曾提到在关闭 TLS 连接之前， A 或 B 应当先发送关闭 TLS 的记录，目的是防止入 侵者的截断攻击(trunca ti on a ttack ）。所诮截断攻击就是在 A 和 B 正在进行会话时，入佼者突 然发送 TCP 的 F 爪报文段来关闭 TCP 连接。但如果 A 或 B 没有事先发送一个要关闭 TLS • 361 •"}
{"doc_id": "network", "page": 373, "text": "的记录，那么 A 或 B 见到 TCP 的 FIN 报文段时，就知道这是入佼者的截断攻击了。入侵者 无法伪造关闭 TLS 的记录，因为虽然记承前面的三个字段都是明文，但每个记录的内容是 加密的，并有 MAC 保证其完整性的。 在 TLS 1.3 中使用了更加安全的椭圆曲线密码 ECC (Elliptic Curve Crypt o g ra p hy)与 AES, 使运算速度比旧的 l.2 版本有了很大的提高。 TLS 1.3 还添加了 0-RTT 的功能。这就 是说，如果客户之前连接过某服务器， TLS 1.3通过储存先前会话的秘密伈息，不需婓经过 1-RTT 的握手过程，仅需 0-RTT 即可开始会话阶段，这样就更加提高了 TLS 的效率。当然， 这样做必须要防止可能发生的重放攻击。 7.5.3 应用层安全协议 限千篇幅，我们在这一节仅讨论应用层中有关电子邮件的安全协议。 电千邮件在传送过程中可能要经过许多路由器，其中的任何一个路山器都有可能对转 发的邮件进行 1阅读。从这个意义上讲，屯子邮件是没有什么隐私可言的。 电子邮件这种网络应用也有其很特殊的地方，这就是发送电子邮件是个即时的行为。 这种行为在本质上与我们前两节所讨论的不同。当我们使用 IPSec 或 SSL 时，我们假设双 方在相厅之间建立起一个会话并双向地交换数据。而在电子邮件中没有会话存在。当 A 向 B 发送一个电子邮件时， A 和 B 并不会为此而建立任何会话。而在此后的某个时间，如果 B 读取了该邮件，他有可能会、也有可能不会回复这个邮件。可见我们所讨论的是单向报文的 安全问题。 如果说电子邮件是即时的行为，那么发送方与接收方如何才能就用千电子邮件安全的 加密仅法达成一致意见呢？如果双方之间不存在会话，不存在协商加密／解密所使用的符法， 那么接收方如何知道发送方选择了哪种环法呢？ 要解决这个问题，电子邮件的安全协议就应当为每种加密操作定义相应的算法，以便 用户在其系统中使用。 A 必须要把使用的算法的名称（或标识）包含在电子邮件中。例如， A 可以选择用 AES 进行加密／解密，并选择用 SHA-I 作为报文摘要算法。当 A 向 B 发送电 子邮件时，就在自己的邮件中包含与 AES 和 SHA-I 相对应的标识。 B 在桵收到该邮件后， 首先要提取这些标识，然后就能知道在解密和报文摘要运算时应当分别使用哪种算法了。 加密算法在使用加密密钥时也存在同样的问题。如果没有协商过程，通信的双方如何 在彼此之间知道所使用的密钥？目前的电子邮件安全协议要求仗用对称密钥算法进行加密和 解密，并且这个一次性的密钥要跟随报文一起发送。发信人 A 可以生成一个密钥并把它与 报文一起发送给 B 。为了保护密钥不被外人截获，这个密钥衙要用收信入 B 的公钥进行加 密。总之，这个密钥本身也要被加密。 还有一个问题也需要考虑。很显然，要实现屯子邮件的安全就必须使用某些公钥算法。 例如，我们需要对密钥加密或者对邮件签名。为了对密钥进行加密，发信人 A 就需要收信 人 B 的公钥，同样为了验证被签名的报文，收信人 B 也盂要发信人 A 的公钥。因此，为了 发送个具有鉴别和保密的报文，就需耍用到两个公钥。但是 A 如何才能确认 B 的公钥， B 又如何才能确认 A 的公钥呢？不同的电子邮件安全协议有不同的方法来验证密钥。 下面我们介绍在应用层为电子邮件提供安全服务的协议 PGP 。 PGP (Pretty Good Pri vac y)是 Z i mmermann 于 1995 年开发的。它是一个完整的屯f·邮件 安全软件包，包括加密、鉴别、电子签名和压缩等技术。 PGP 并没有使川什么新的概念， • 362 •"}
{"doc_id": "network", "page": 374, "text": "它只是把现有的一些加密算法（如 RSA 公钥加密钵法或 MDS 报文摘要饵法）综合在一起 而已。山于包括源程序的整个软件包可以从互联网免费下载[W-PGP], 因此 PGP 在 MS-DOS/ Wi ndows 以及 UNIX 等平台 I一得到f广泛的应用。现在 PGP 的网站以每个月白）｝火的规校， 为一百多个国家的川户提供服务。 后米 PGP 公司与 Z i mmem1ann I 司总 IETF 制定 PGP 的公开互联网标准 Op enPGP 。 2007 年 IETF 发布J OpcnPGP 的建议标准[RFC 4880] 。 PGP 的工作原捚并不复朵。它提供电子邮件的安全性、发送力鉴别和报文完整性。 假定 A 向 B 发送电f邮件明义 X，现在用 PGP 进行加密。 A 有三个密钥：自己的私钥 SKA, B 的公钥 PK。和自己生成的一次性密钥 K。 B 有两个密钥：自己的私钥 SKB 和 A 的公 钥 PKA• A 盂坟做以下儿件事（如图 7-23 所示）。 图 7-23 （记坟送Jj A 的 PGP 处理过程 0 川 A 的私钥 SKA 对明文邮件 X 进行签名。把签名拼接在明文邮件 X 后面。 e 利用随机数 A 生成一次性密钥 K （共享的对称密钥）。 0 用 A 生成的沙次性密钥 K 对已签名的邮件加密。 0 川 B 的公钥 PKB 对 A 生成的一次性密钥 K 进行加密。 O 把已加密的一次性密钥和已加密的签名邮件，拼接在一起发送给 B. 诮注总，图 7-23 中＝个“加密＂的作用址不同的。第一次加密是用 A 的私钥 SK/1对明 文邮件的报文摘投进行加密，即进行数字签名，目的姑保证邮件的亢整性。第二次加密是川 A 生成的次性密钥 K 对已签名的邮件加密，目的是保证邮件的机密性。第三次加密是月 1 B 的公钥 PKB 对 A 的一次性密钥 K 加密，目的是保证对称密钥 K 的机密性。 B 收到 A 发过来的报义后要做以下几件!JJ（建议诙者自行画出相应的图，这里从略）： (I) 在义档 RFC 4880 中，对加密邮件的各种格式（如仅加密但不鉴别，或仅鉴别但不 加密，或加密加 l骨鉴别），均有详细的规定。 l\"El此 B 可以根据邮件的种类，准确地把已加密 的一次性密钥和已加密的签名报义分离开。 (2) JI] B 私钥 SKB 解出一次忖密钥 k （这足对称密钥，加密和解密都·,仿耍各仗川一次）。 (3))Il 寺出的·次件密钥 K 对加密的签名邮件进行解密，分窝出明义邮件 X 和 A 的数 字签名。 (4) 川 B 手中的 A 的公钥 PKA 对 A 的数字签名进行解密。然后即可j妾打验证邮件的完 整性．具体的做法勺前面图 7-9 所述的相似，这里不冉重复。 在 PGP 中，发件方和收件方是如何获得对方的公钥呢？当然，最安全的办法是双方由 对面直接交换公钥，但在大多数情况卜这并不现实。因此可以迪过认证中心 CA 签发的证书 来验证公钥持有者的合法身份。然曲（1:: PGP 中个耍求使用 CA, 而是允许川一种第二方签署 的方式来解决该问题。例如，如果用户 A 和用户 B 分别和第三方 C 已经确认对方拥有的公 • 363 •"}
{"doc_id": "network", "page": 375, "text": "钥屈实，则 C 可以用其私钥分别对 A 和 B 的公钥进行签名，为这两个公钥进行担保。当 A 得到一个经 C 签名的 B 的公钥时，可以川已确认的 C 的公钥对 B 的公钥进行鉴别。不过， 用户发布其公钥的最常见的方式还是把公钥发布在他们的个人网页上，或仅仅通过电子邮件 进行分发。 PGP 很难被攻破。因此在 H 前可以认为 PGP 是足够安全的。 7.6 系统安全：防火墙与入侵检测 恶意用户或软件迪过网络对计符机系统的入佼或攻击已成为节今计算机安全最严重的 威胁之一。用户入侵包括利用系统漏洞进行未授权登录，或者授权用户非法获取更高级别权 限。软件入 1义方式包括通过网络仕播病宙、蠕虫和特洛伊木马。此外还包括阻止合法用户正 常仗用服务的拒绝服务攻击，等等。而前面讨论的所有安全机制都不能有效解决以上安全问 题。例如，加密技术井不能阻止梢入[“特洛伊木马”的计环机系统通过网络向攻击者泄漏 秘密信息。 7.6.1 防火墙 防火墙(fi rewall) 作为一种访问控制技术，通过严格控制进出网络边界的分组，禁止任何不 必攷的通信，从而减少潜在入侵的发生，尽可能降低这类安全威胁所带来的安全风险。由于防 火瑞不可能阻止所有入仗行为，作为系统防御的第二道防线，入侵检测系统 IDS (Intrusion  Detection S ys t em)通过对进入网络的分组进行深度分析与检测发现疑似入侵行为的网络活动， 井进行报警以便进一步采取相应措施。 防火墙姑一种特殊编程的路由器，女装在·个网点和网络的其余部分之间，目的是实 施访问控制策略。这个访问控制策略是由使用防火墙的单位自行制定的。这种安全策略应当 奻适合本单位的需要。图 7-24 指出防火墙位于互联网和内部网络之间。互联网这边是防火 墙的外面，而内部网络这边是防火墙的里面。一般都把防火墙里面的网络称为“可信的网络” (trusted ne 八vork)', 而把防火墙外面的网络称为“不可信的网络 ”(untrus ted ne t work) 。 ,•·····.............. ••••••••••••• ·····················、 防火出的外面· .,' 防火墙 防火墙的里面 ｀．、 / ＿一一、、 [  分组过滤 路由器 / 11 f信的网络 , ;  I  二2} 、- - Z.:  ..  ···········•······················  I冬I 7-24 防火墙在互连网络中的位过 Cl) 注, 2004 仆 II 月，联合国总部让 `,I (“互联网泊｝用工作组 WG J G (Work ing Group on Internet Governance) 气来解决儿联 网的诚亿和女个问心．我国(t 2006 年 2 月仇，（1i的（冈心中长期科学和技木发展戍划纲婓 (2006一2020 年）》中．提出以发展高 可估网络为 •TW. 现在高可们网络已成为研亢热点． • 364 •"}
{"doc_id": "network", "page": 376, "text": "防火墙技术一般分为以下两类。 (I) 分组过滤路由器是一种具有分组过滤功能的路由器，它根据过滤规则对进出内部网 络的分组执行转发或者丢弃（即过滤）。过滤规则是基于分织的网络）式或运输丿ij、 l' ,1.,•邪的信息， 例如：源／目的 IP 地址、源／目的端口、协议类型 (TCP 或 UDP), 等等。我们知心． TCP 的 端门号指出了在 TCP 上面的应用层服务。例如，端口号 23 是 TELNET. 端口号 I 19 足新闻 网 USENET ，等笘。所以，如果在分组过滤器中将所有目的端门号为 23 的入分组(i ncom i n g p acket)都进们阳拦，那么所有外单位用户就不能使用 TELNET 登录到 4qt位的 l 汁J l |,。同 理，如果某公 KI.」不愿意其厢员在上班时花费大批时间去石互联网的 USENET 新闻．就可将 目的端口号为 I 19 的出分组(ou tgo i n g p acket)阻拦住，使其无法发送到叩：联网。 分组过滤 lI ［以是无状态的，即独立地处理每一个分组。也可以丛付状态的，即吱跟踪 每个连接或会话的通信状态，并根据这些状态信息米决定是否转发分组。例如． ．个进入到 分组过滤路山器的分组，如果其目的端口是某个客户动态分配的，那么该端门显然无法事先 包含在规则中。这样的分组被允许通过的唯～条件是：该分组是该瑞「」发出合法诮求的·个 响应。这样的规则只能迪过有状态的检查来实现。 分组过滤路由器的优点是简单环效，且对千用户是透明的，但不能对高 1公放据进行过 滤。例如，不能禁止某个川户对某个特定应用进行某个特定的操作，不能支持应川层用户鉴 别哼。这些功能盂要使用应用网关技术来实现。 (2) 应用网关也称为代理服务器（p rox y server), 它在应用层通信中扮浙报义中尔的角色。 一种网络应用盂要一个应用网关，例如在上一汽 6 .4 .3 节中”代理服务器”介绍过的万绯网 缓存就是一种万维网应用的代理服务淄。在应川网关中，可以实现拈J··应用压数据的过滤和 的层用户鉴别。 所有进出网络的应用程序报文都必须通过应用网关。当某应用客户进程向服务器发送 一份诮求报文时，先发送给应用网关，应用网关在应用层打开该报义，个行该哨求丛否合认 （可根据应用层用户标识 ID 或其他应用层信息来确定）。如果请求合法，砬川网关以客户 进程的身份将诮求报文转发给原始服务器。如果不合法，报文则被丢介 例如， ·个邮件网 关在检查每一个邮件时，会根据邮件地址，或邮件的其他首部，甚至）上报义的内容（如，有 没付“导弹”“核弹头”等关锦词）来确定该邮件能否通过防火墙。 应用网关也有一些缺点。首先，每种应用都孟要一个不同的应加衬关（可以运行(+同 一台主机上）。其次，在应用层转发和处理报文，处理负担较重。另外，对应川程忭不透明， 而要在应用程序客户端配仪应用网关地址。 通常可将这两种技术结合使用．图 7-24 所画的防火瑞就同时具付这两种技术 它包括 两个分组过滤路巾器和一个应用网关，它们通过两个局域网连接在tg. 7.6.2 入侵检测系统 防火墙试图在入侵行为发生之前阻止所有可疑的通信。但事实丛不可能阻止 Hi行的入 佼行为，有必要采取措施在入侵已经开始，但还没有造成危山或在选成史大位，I 釭｝if.及时检 测到入侵，以使尽快阻止入侵，把f包占降低到蚊小。入侵检测系统 IDS 1 上是这样一种技术。 IDS 对进入网络的分组执行深度分组检查，当观察到可疑分组时，向网络管押员及出告警或 执行阻断操作 (lh 千 lDS 的＂误报”率通常较高，多数估况不执行,·,动阻断）。 IDS 能川J: 检测多种网络攻击，包括网络映射、端口扫描、 DoS 攻击、蚽虫和病战、系统仙洞攻出等。 • 365 •"}
{"doc_id": "network", "page": 377, "text": "入佼检测方法一般可以分为基千特征的入侵检测和基于异常的入佼检测两种。 基于特征的 IDS 维护·个所有已知攻击标志性特征的数据库。每个特征是一个与某种 入仗活动相关联的规则集，这些规则可能丛千单个分组的首部字段值或数据中特定比特串， 或者'j系列分组有义。当发现有与某种攻击特征匹配的分组或分组序列时，则认为可能检 测到某种入侵行为。这些特征和规则通＇，常巾网络安全专家生成，机构的网络符理员定制并将 其加入到数据J车中。 J&卜特征的 IDS 只能检测已知攻巾，对于未知攻击则束手儿策。姑于异常的 IDS 通过观 察正常运行的网络流榄，学习正常流状的统计特性和规律，当检测到网络中流量的某种统计 规仆不符合正常情况时，则认为可能发生了入侵行为。例如，芍攻击者(l:对内网t机进行 pi n g搜索时，或出致 ICMP pi n g报文突然大如增加，与正常的统计规1书有明显不同。但区分 正常流和统计异常流是一件 1 比常困难的市估。至今为止，大多数部署的 IDS 主耍足丛于特征 的，尽行某些 IDS 包括了某些丛干异常的特性。 不论采用什么检测技术都存在“汕报”和＂误报＂估况。如果”汕报”率比较的，则 只能检测到少从的入侵，给人以安全的假象。对于特定 lDS, llI 以通过调整某些阙伯米降低 ＂沥报”率，但同时会增大”误报”率。＂误报”：年太大会导致大屈虚似警报，网络忤理员 需要化费大蚊时间分析报郣伈息，其至会因为虚假弊报太多而对报警“视而个见＇｀，使 IDS 形同虚设。 7.7 一些未来的发展方向 本浮介绍了网络安全的上找概念。网络安全足一个很人的领域，尤法在这进行探入的 探讨。对 l有忐！这一领域的读者，可在卜面几个方向做进一步的研究： (I) 椭圆曲线密码 ECC Id 前椭圆仙线密码已{I: TLS 1.3 的握手协议中占据 1 陷常重要 的地位。此外，在电子护照和金炖系统中也大扯使川椭圆曲线密码系统。在几联网上已有许 多关J．椭圆曲线密码的资料。限千篇幅，无法在本书中进行介绍。 (2) 移动安全 (Mobi le Security) 移动逍估带来的广泛应用（如移动支付， Mobi le Pa y ment)向网络安全提出了更高的要求。 (3) 从子密码(Quan tu m Cryptography) 揽fi l· 符机的到来将使得 II 前许多使用中的密 码技术尤效，后欣f密码学(Pos t-Q uan t um C rypt og ra p h y)的研究方兴未艾． (4) 商密儿',)符法 SM9 为（降低公钥和证书管理的复杂性，早在一；十多年前提出的 标识密码{Iden tity -Based Cryptogra p h y),现在又被屯视。标识密码把用户的标识（如乒机号 砃）仵为公钥，使得安令系统变得易，·.部署和管理。 2008 年标识密码饮法正式获得我国密 码节理屈签发为商密九号t；（法 SM9 。此殍法不孟必中请数字证书，适丿l J J呫互联网应川的各 种新兴应用的安个保障，其应川前跟值得关注。 本章的重要概念 • 计算机网络上的汕估血临的威胁可分为两大类，即被动攻击（如截获）和上动攻击 （如中断、篡改、伪造）。卞动攻击的类型有更改报文流、拒绝服务、伪造初始化、 恶意程序（病甜、蠕虫、木＇｝、逻辑炸弹、后门入佼、流氓软件）等。 • 计符机网络安全主要有以下一些内容：机密性、端点鉴别、信息的元整性、运行的 • 366 •"}
{"doc_id": "network", "page": 378, "text": "安全性和访问控制。 • 密码编码学是密码体制的设计学，而密码分析学则是在未知密钥的悄况下从密文推 演出明义或密钥的技术。密码编码学与密码分析学合起来即为密码学。 • 如果不论截取者获得了多少密文，都无法唯一地确定出对应的明文，则这一密码体 制称为无条件安全的（或理论上是不可破的）。在无任何限制的条件下，目前几乎 所有实用的密码体制均是可破的。如果一个密码体制中的密码不能在—定时间内被 可以仗用的计算资源破译，则这一密码体制称为在计算上是安全的． • 对称密钥密码体制是加密密钥与解密密钥相同的密码体制（如数据加密标准 DES 和高级加密标准 AES) 。这种加密的机密性仅取决千对密钥的保密，而絊法是公 开的。 • 公钥密码体制（又称为公开密钥密码体制）使用不同的加密密钥与解密密钥。加密 密钥（即公钥）是向公众公开的，而解密密钥（即私钥或密钥）则是盂要保密的。 加密算法和解密算法也都是公开的。 • Fl 前奻著名的公钥密码体制是 RSA 体制，它是基于数论中的大数分解问题的体制。 • 任何加密方法的安全性取决于密钥的长度，以及攻破密文所需的计符量，而不是简 单地取决千加密的体制（公钥密码体制或传统加密体制）。 • 数字签名必须保证能够实现以下三点功能： （ l ）报文鉴别，即接收者能够核实发送 者对报义的签名； （ 2 ）报文的完整性，即接收者确信所收到的数据和发送者发送的 完全一样而没有被篡改过； （ 3 ）不可否认，即发送者事后不能抵赖对报文的签名。 • 鉴别是要验证通信的对方的确是自己所要通信的对象，而不是其他的回允者。鉴别 与授权是不同的概念。 • 报文摘要 MD 曾是利鉴别报文的常用力法，后来有了更加安全的 SHA-I 。但目 前敬为安全的是 SHA-2 和 SHA-3 。 • 密钥管理包括：密钥的产生、分配、注入、验证和使用。密钥分配（或密钥分发） 是密钥管理中鼓大的问题。密钥必须通过最安全的通路进行分配。密钥分配中心 KDC 是一种常用的密钥分配方式。 • 认证中心 CA 是签发数字证书的实体，也是可信的第三方。 CA 把公钥与其对应的 实体（人或机器）进行绑定和写入证书，并对证书进行数字笭名。任何人都可从可 信的地方获得认证中心 CA 的公钥来鉴别数宁址书的真伪。 • 为了方便地签发数字证书，根 CA 可以有下面的多级的中间 CA, 负责给用户签发 数字证书。这样就构成了信任链和证书链。 . 什网络层可使用 IPsec 协议族， IPsec 包括鉴别首部协议 AH 和封装安全有效载荷 协议 ESP 。 AH 协议提供源点鉴别和数据宪整性，但不能保密。而 ESP 协议提供源 点鉴别、数据完整性和保密。 IPsec 支持 1Pv4 和 IPv6 。在 1Pv6 中， AH 和 ESP 都 是扩展首部的一部分。 IPsec 数据报的：［作方式有运输方式和隧道方式两种。 • 运输层的安全协议普经有 SSL （安全套接字层）和 TLS （运输层安全）。但 SSL 已 被淘汰。目前使用的最新版本是 TLS 1.3 。 TLS 不仅对服务器的女令性进行鉴别， 而且对浏览器与服务器的所有会话记录进行加密，并保证了所传送的报文的完整性。 • PGP 是一个完整的电子邮件安全软件包，包括加密、鉴别、电了签名和压缩等技 术。 PGP 并未使用新概念，只是把现有的一些加密算法（如 RSA 公钥加密算法或 • 367 •"}
{"doc_id": "network", "page": 379, "text": "SHA 报文摘耍算法）综合使川而已。 • 防火蹈是 种特殊编程的路由器，安装在一个网点和网络的其余部分之间，目的是 劝也切问扑制策略。防火瑞里面的网络称为“可信的网络＂，而把防火墙外面的网 络称为“小可信的网络＂。防火墙的功能有两个：一个是阻止（主要的），另一 个丛允许。 • 防火墙技术分为：网络级防火墙，用来防止整个网络出现外来非法的入侵（屈于这 类的有分组过滤和授权服务器）；应用级防火墙，用来进行访问控制（用应用网关 或代押服务器来区分各种应用）。 • 入仗检测系统 IDS 是在入侵已经开始，但还没有造成危害或在造成更大危害前， 及时检测到入仗，以便尽快阻止入侵，把危害降低到最小。 习题 7-01 计符机网络都面临哪几种威胁？主动攻击和被动攻击的区别是什么？对千计算机网 络，其安令拈施都有哪些？ 7-02 i式解扦以卜名词： （ I ）拒绝服务 (2) 访问控制； （3 ）流她分析； （4 ）恶意程序。 7-03 为什么说计优机网络的安全不仅仅局限千机密性？试举例说明，仅具有机密性的计 钧机网络不一定是安全的。 7-04 密砃编码学、密码分析学和密码学都有哪些区别？ 7-05 “儿条件安全的密码体制”和“在计算上是安全的密码体制”有什么区别？ 7-06 试破译下面的密文诗。加密采用替代密码。这种密码是把 26 个字母（从 a 到 z) 中 的符一个川其他某个字母替代（注意，不是按序替代）。密文中无标点符号。空格未 加密。 kfd ktbd fzm cubd kfd pzyiom mztx ku kzyg ur bzha kfthcm ur mfudm zhx  mftnm zhx mdzythc pzq ur ezsszcdm zhx gthcm zhx pfa kfd mdz tm sutythc  l 、uk zhx pfdkfdi ntcrn fzld pthcm sok pztk z stk kfd uamkdim eitdx sdruid  pd fzld uoi etzk mi rnubd ur om zid uok ur sidzkf zhx zyy ur om zid rzk  hu foii a mztx kfcl ezindhkdi kfda kfzhgdx ftb boef rui kfzk  7-07 对称密切体制与公钥密码体制的特点各是什么？各有何优缺点？ 7-08 为什么密钥分配足一个非常重要但又十分复杂的问题？试举出一种密钥分配的方法。 7-09 公钥密砃体制卜的加密和解密过程是怎样的？为什么公钥可以公升？如果不公开是 古可以提高安个性？ 7-10 试述数字签名的原理。 7-11 为什么盂耍进行报文鉴别？鉴别和保密、授权布什么不同？报文鉴别和实体鉴别有 什么 IX 别？ 7-12 试分别举例说明以下情况： （ l ）既需要保密，也需要鉴别； （ 2 ）衙要保密，但不需要鉴 别：（ 3 ）小油要保密，但需要鉴别。 7-13 A fll B 共回持有个只有他们二人知道的密钥（使用对称密码）。 A 收到［用这个密 钥加密的一份报义。 A 能否出示此报文给第三方，使 B 不能否认发送了此报文？ 7-14 将图 7-5 所；可的具有机密性的签名与使用报文鉴别码相比较，哪一种方法更有利十进 行笭别？ • 368 •"}
{"doc_id": "network", "page": 380, "text": "7-15 试述实现报文鉴别和实体鉴别的方法。 7-16 结合第 5 章图 5-6 计算 UDP 的检验和的例子，说明这种检验和不能用来鉴别报文。 7-17 报文的机密性与完整性有何区别？什么是 MD5? 7-18 什么是重放攻击？怎样防止重放攻击？ 7-19 图 7-11 的鉴别过程也有可能被骗子利用。假定 A 发送报文和 B 联系，但不巧被骗子 P 截获了，于是 P 发送报文给 A:“ 我是 B” 。接着， A 就发送困 7-11 中的第一个报 文 “A, RA\"• 这里凡是不重数。本来， P 必须也发给 A 另一个不重数，以及发回使 用两人共同拥有的密钥 K戍加密的 RA, 即 KAB(RA) 。但 P 根本不知道 KAB, 只好就发 送同样的 RA 作为自己的不重数。 A 收到凡后，发给 P 报文 “KAa(RA)\", P 仍然不知 道密钥 KAB ，也照样发回报文 “KAB(RA)“ 。接若 A 就把一些报文发送给 P 了。虽然 P 不知道密钥 K戍，但可以慢慢设法攻破。试问 A 能否避免这样的错误？ 7-20 什么是“中间人攻击“？怎样防止这种攻击？ 7-21 试讨论 Kerberos 协议的优缺点。 7-22 互联网的网络层安全协议族 lPsec 都包含哪些主要协议？ 7-23 用户 A 和 B 使用 IPsec 进行通信。 A 需要向 B 接连发送 6 个分组。是否需要在每发 送一个分组之前，都先建立一次安全关联 SA? 7-24 在图 7-18 (b)中，公司总部和业务员之间先建立了 TCP 连接，然后使用 IPsec 进行通信。 假定有一个 TCP 报文段丢失了。后来在重传该序号的报文段时，相应的 IPsec 安全 数据报是否也要使用同样的 IPsec 序号呢？ 7-25 试简述协议 TLS 的工作过程。 7-26 在图 7-21 中，假定在第一步，顾客（客户 A) 发送报文给经销商（服务器 B) 时， 误将报文发送到一个骗子处，而骗子就接着冒充经销商继续下面的步骤。试问在报 文交互到第几个步骤时，顾客可以发现对方并不是真正的经销面？ 7-27 电子邮件的安全协议 PGP 主要都包含哪些措施？ 7-28 试述防火墙的工作原理和所提供的功能。什么叫作网络级防火墙和应用级防火墙？ • 369 •"}
{"doc_id": "network", "page": 381, "text": "第 8 章 互联网上的音频／视频服务 本革首先对互联网提供音频／视频服务进行概述。然后介绍流式音频／视频中的媒体服务 器和实时流式协议 RTSP, 并以 IP 电话为例介绍交互式咨频／视频所使用的一些协议，如实 时运输协议 RTP 、实时传送控制协议 RTCP 、 H.323 以及会话发起协议 SIP 。接若讨论改进 “尽最大努力交付“服务的一些措施，包括怎样仗互联网能够提，叫服务质爵，并介绍综合服 务 ln t Serv 、资源预留协议 RSVP 和区分服务 D iffS erv 的婓点。 本菜最监耍的内容是； (I) 多媒体信息的特点（如时延和时延抖动，播放时延笘）。 (2) 流媒体的概念。 (3) IP 电话仗用的几种协议。 (4) 改进“尽最大努力交付“服务的几种方法。 8.1 概述 计符机网络最初是为传送数据设计的。互联网 IP 层提供的“尽最大努力交付“服务以 及每一个分组独立交付的策略，对传送数据信息十分合适。叮联网使用的 TCP 协议可以很 好地解决 IP 层不能提供可靠交付这一问题。 然而技术的进步使许多用户开始利用开联网伈送、心频／视频信息。在许多情况下，这种 齿频／视频常称为多媒体信息。。本来电路交换的公J廿屯话网传送话音和多媒体信息早已是成 熟的技术。例如视频会议（义称为电视会议）原先是使川屯路交换的公用电话网。使用电路 交换的好处是： 旦连接建立了（也就是只要拨通了电话），各种信号在电话线路上的传输 质昼就有保证。但仗用公用电话网的缺点是价格太高。囚此要想办法改川且联网。 多媒体信息（包括卢音和图像信息）与不包括声音和图像的数据信息有很大的区别， 其中最主要的曲个特点如＿＿卜。 第一，多媒体信息的信息量往往很大。 含有音频或视频的多媒体估息的估息屋 般都很人， 下面是简单的说明。 对十电话的声音信息，如采川标准的 PCM 编码 (8 kHz 速率采样），而每一个采样脉冲 用 8 位编码，则得出的户音信号的数据率就是 64 kb it/s 。对千高质量的立体声音乐 CD 信息， 虽然它也使用 PCM 编码，但其采样速率为 44.1 kHz, 1fri匈一个采杆脉冲川 16 位编码，因此 这种双声道立体声音乐估号的数扼率超过了 1 .4 Mb it/s 。 u 汁：多媒休仙0 和化统数据仙，息不同．．匕是指内容 r．相斤关联的文小、图形、图像、市齐、动间和活动图像等所形成的 复合数枢信息。血多媒体＼LK 务则应付从1I'x计、交从件和同步件的特，占心化成性足指对多媒体伈息进行什（诺、 1M 输、处理、显示的 能力．又＇J．性是指人勾多媒体、LK 各系统之间的相T/拧制能力．同步件是指在多媒体LK 务终端 I.~ ，下的图像、卢济和文宁是以同步 方式＿l 作的． h 本节小，我们纾常把许频／视频们息和多媒体信息仆为回义词火使/II.扒然它们｝t不严格地等同． • 370 •"}
{"doc_id": "network", "page": 382, "text": "再看一下数码照片。假定分辨率为 1280 X 960 （中等质仅）。若每个像素川 24 位进行编 码，则一张未经压缩的照片的字节数约合 3.52 MB （这里 l B = 8 bit, I M = 22()) 。 活动图像的信息督就更大，如不压缩的彩色电视信号的数据率超过 250 Mbit/s 。 因此在网上传送多媒体信息都无例外地采用各种信息压缩技术。例如在话音斥缩方面的 标准有：移动通信的 GSM (\\3kb it/s), lP 电话使用的 G. 729 (8 kb it/s) 和 G.723.1 (6 .4 kbit/s  和 5.3 kbit/s); 在立体中音乐的压缩技术有 MP3 C 128 kbit/s 或 112 kb it/s) 。在视频伈号方面 有： VCD 质揽的 MPEG I (1.5 Mbit/s) 和 DVD)贞负的 MPEG 2 (3~6 Mbit/s) 。由于多奴体 信息压缩技术本身不是计算机网络技术范畴，本书将不讨论有关数据压缩方面的内容。 第二，在传输多媒体数据时，对时延和时延抖动均有较高的要求。 首先要说明的是，“传输多媒体数据“隐含地表示[“边传输边播放＂的意思。因为如 果是把多媒体音频／视频节目先下载到计符机的硬盘中，等下载亢毕后协去播放，那么在互 联网上传输多媒体数据就没有什么更多的特点值得我们专门来讨论（仅仅是数据队非你大而 己）。设想我们想欣赏网上的某个视频或音频节目。如果必须先花好几个小时（准确的时间 事先还不知道）来下载它，等下载完毕后才能开始播放，那么这显然是很不方便的。因此， 今后讨论在互联网上传输多媒体数据时，都是指含有“边传输边播放＂的特点。 我们知道，校拟的多媒体信号只有经过数字化后才能在互联网上传送。就是对桢拟估 号要经过采样和模数转换变为数字信号，然后将一定数砒的比特组装成分组进行传送。这些 分组在发送时的时间间隔都是恒定的，通常称这样的分组为等时的(isochronous) 。这种等时 分组进入百联网的速率也是恒定的。但传统的互联网本身是非等时的。这是因为在使川JP 协议的互联网中，每一个分组是独立地传送，因而这些分组在到达接收端时成变成为非等时 的。如果我们在接收端对这些以非恒定速率到达的分组边接收边还原，那么就一定会产生很 大的失真。图 8- J说明了互联网是非等时的这一特点。 校拟信另． 采祥后的｛心 发送的分组 到达的分组 （人夺时的） （作等时的） ~ －酗血』L与之』上上上，气厅联网产—』』—且， 扣定速午 ＼～夕 职n 几，速率 图 8-1 厅联网是非等时的 婓解决这一问题，可以在接收端设置适当大小的缓存＇，当缓存中的分组数达到一定的 数妞后再以恒定速率按顺序将这些分组读出进行还原播放。图 8-2 说明了缓存的作用。 有可能发 4 到达的分组 分组工失经过缓存 （非等时的） 缓存（队列） ＼＼变成笘时的 J1 n n nn l =IIlIIII|门_ _jL_Jl_jlJL I  I r-恒定逑中 一—-T- 恒定速冲｛ 图 8-2 缓存把非等时的分组变换为等时的 从图 8-2 可看出，缓存实际上就是一个先进先出的队列。图中标明的 T 叫作播放时延， 这就是从最初的分组开始到达缓存算起，经过时间 T 后就按固定时间间隔把缓存中的分组 ＠注： i行不要和运输层 TCP 的缓仔如队这申所说的缓存是在I屯用层的缓存． • 371 •"}
{"doc_id": "network", "page": 383, "text": "按先后顺序依次读出。找们看到，缓存使所有到达的分组都经受了迟延。由于分组以非恒定 速率到达，因此早到达的分组｛I，缓存中停留的时间较长，而晚到达的分组在缓存中停留的时 间就较短。从缓存中取出分组是按照固定的时钟节拍进行的，困此，到达的非等时的分组， 经过缓存后再以恒定速率读出，就变成了等时的分组（但谓注总，时延太大的分组就丢弁 了），这就在很大程度上消除了时延的抖动。但我们付出的代价是增加了时延。以上所述的 概念可以用图 8-3 来说叭。 组出分发 数 1l  组｀了IJ 达到 12 13 14 15 16  6  一、夕 4  32  O 推迟播放 \\  0 冉推迟播放时间 2 3  纠达 4 分列 ::,;1I V, i  -tJ 2  6  且」 4 5 6  图 8-3 利用缓存得到 ^1 时的分组忭列 图 8-3 画出了发送端一连发送 6 个等时的分组。如果网络没有时延，那么到达的分组数 随时间的变化就如图中最左边的阶梯状的曲线所示。这就是说，只攷发送方一发出一个分组， 在接收方到达的分组数就立即加 1 。但实标的网络使每 个分组经受的时延不同，因此这一 串分组在到达接收端时就变成 [-I|a 等时的，这就使得分组到达的阶梯状曲线向右移动，并且 变成不均匀的。图 8-3 标注出了分组 I 的时延。图中给出了两个不同的升始播放时刻。黑色 小圆点表示在播放时刻对应的分组已经在缓存中．而空心小圆圆表示在播放时刻对应的分组 尚未到达。我们可以看出，即仗推迟了播放时间（如图中的 0), 也还有可能有某个迟到分 组赶不上播放（如图中的空心小圆 1卷1) 。如果冉推迟播放时间（如图中的 6), 则所有的 6 个 分组都不会错过播放，但这样做的时延会较大。 然而我们还布一些问题没有讨论。 首先，播放时延 T 府芍选为多人？把 T 选抒得越大，就可以消除更大的时延抖动，但 所有分组经受的平均时延也增人了，曲这对某些实时应用（如视频会议）是很不利的。当然 这对单向传输的视频节目问题并不太人（如从网上下载一段视频节目，只要耐心多等待一段 时间用来将分组放入缓存即可）。如果 T 选择得人小，那么消除时延抖动的效果就较差。因 此播放时延 T 的选择必须折中劣虑。仆传送时延敏感(dela y sens iti ve) 的实时数据时，不仅传 输时延不能太大，而且时延抖动也必须受到限制。 • 372 •"}
{"doc_id": "network", "page": 384, "text": "其次，在互联网上传输实时数据的分组时有可能会出现差错或甚罕丢失。如果利川 TCP 协议对这些出错或丢失的分组进行觅传，那么时延就会大大增加。因此头时数据的传 输在运输层就应采用用户数据报协议 UDP 而不使用 TCP 协议。这就是说，对于传送实时数 据，我们宁可丢失少量分组（当然不能丢失太多），也不要太晚到达的分组。（L 连续的音频 或视频数据流中，很少揽分组的丢失对播放效果的影响并不大（因为这是由人来进行主观评 价的），因而是可以容忍的。丢失容忍(loss toleran t)也是实时数据的另一个矗耍特点。 巾十分组的到达可能不按序，但将分组还原和播放时又应当是按序的。因此在发送多 媒体分组时还应当给每一个分组加上序号。这表明还应当有相应的协议支持才行。 还有一种情况，就是要使接收端能够将节目中本来就存在的正常的短时间停顿（如话 音中的静默期或音乐中出现的几拍停顿）和因某些分组产生的较大迟延造成的“停顿”区分 开来。这就盂要在每一个分组增加一个时间戳(ti mestamp),让接收喘知道所收到的每一个分 组是在什么时间产生的。 有了序号和时间戳，再采用适当的算法，接收端就知道应在什么时间开始播放缓存中 收到的分组。这样既可减少分组的丢失率，也可使播放的延迟在人们可容忍的范围之内。 根据以上的讨论可以看出，若想在互联网上传送质性很好的音频／视频数据，就衙要设 法改造现有的互联网使它能够适应音频／视频数据的传送。 对这个问题，网络界一直有较大的争论，众说纷纭。有人认为，只要大觉使用光缆， 网络的时延和时延抖动就可以足够小。再加上使用具有大容量高速缓存的高速路由器，在互 联网上传送实时数据就不会有问题。也有人认为，必须将互联网改造为能够对端到端的带宽 实现预留（reserva ti on), 从而根本改变互联网的协议栈一从无连接的网络转变为面向连接 的网络。还有人认为，部分改动互联网的协议栈所付出的代价较小，而这也能够使多媒体信 息在互联网上的传输质爵得到改进。 尽管上述的争论仍在继续，但互联网的一些新的协议也在不断出现。下而我们有选择 地讨论与传送音频／视频信息有关的若干问题。 目前互联网提供的音频／视频服务大体上可分为三种类型： (1)流式 (s tream i n g)存储音频／视频 这种类型是先把已压缩的录制好的音频／视频文件 （如音乐、电影等）存储在服务器上。用户通过互联网下载这样的文件。请注意，用户并不 是把文件全部下载完毕后再播放，因为这往往需要很长时间，而用户一般也不大愿意等待人 长的时间。流式存储音频／视频文件的特点是能够边下载边播放，即存文件下载后不久（例 如，一般在缓存中存放最多几十秒）就开始连续播放。请注意，普通光盘中的 DVD 电影文 件不是流式视频文件。如果我们打算下载一部光盘中的普通的 DVD 电影，那么你只能花费 很长的时间把整个电影文件全部下载完毕后才能播放。请注总，fl ow 的译名也是“流”（或 “流扯＂），但意思和 s tream i n g完全不同。 (2) 流式实况音频／视频 这种类型和无线电台或电视台的实况广播相似，不同之处是 音频／视频节目的广播是通过互联网来传送的。流式实况音频／视频是一对多（而不是一对一） 的通信。它的特点是：音频／视频节目不是事先录制好和存储在服务器中的，而是在发送方 边录制边发送（不是录制完毕后再发送）。在接收时也要求能够连续播放。接收方收到节目 的时间和节目中事件的发生时间可以认为是同时的（相差仅仅是电磁波的传播时间和很短的 信号处理时间）。流式实况音频／视频按理说应当采用多播技术才能提高网络资源的利用率， • 373 •"}
{"doc_id": "network", "page": 385, "text": "但目前实际上还是使用多个独立的单播。 (3) 交互式音频／视频 这种类型是用户使用互联网和其他人进行实时交互式通信。现 在的互联网电话或互联网电视会议就屈千这种类型。 请注意，对于流式音频I 视频的＂～卜载“，实际上并没有把“下载＂的内容存储在硬盘上。 因此当“边下载边播放”结束后，在用户的硬盘上没有留下有关播放内容的任何痕迹。播放 流式谥频／视频的用户，仅仅能够在屏船上观看播放的内容。用户既不能修改节目内容，也 不能把播放的内容存储下来，因此也无法进行转发。这对保护版权非常有利。 不过技术总是在不断进步的，现在已经有了能够存储在网上播放的流式音频／视频文件 的软件。 我们现在常见的词汇流媒体(s t ream i n g med i a) 就是上而所说的流式音频I 视频。流媒体最 主要的特点就是不是全部都收录下来冉开始播放。在国外的一些文献中，常见到 s tream i ng 一词，网上有人译为“串流”或“流播＂，但目前还没有找到对 s t ream i n g更好的译名。 限于篇幅，下而简单介绍上面的第一种和第三种音频／视频类型的服务。 8.2 流式存储音频／视频 “流式存储音频／视频”中的“存储“二字，表明这里所讨论的流式音频／视频文件不是 实时产生的，而是已经录制好的，通常存储在光盘或硬盘中。不过有时为了简便，往往省略 “存储“二字。在讨论从网上下载这种文件之前，我们先回忆一下使川传统的浏览器是怎样 从服务器下载已经录制好的音频／视频文件的。图 8-4 说叽［下载的三个步骤。 l HI ,J ) 客 服务器 一 1 - GET: rH如视频义fI ＝监:~I 视颇文件 图 8-4 传统的下载文件力认 0 用户从客户机(cl i en t mach i ne) 的浏览器上用 HTTP 协议向服务器谘求下载某个音频／ 视频文件， GET 表示谘求下载的 HTTP 报文。请注意， HTTP 使用 TCP 连接。 0 服务器如有此文件就发送给浏览器， RESPONSE 表示服务器的 HTTP 响应报文。在 响应报文中装有用户所要的音频／视频文件。整个下载过程可能会花费很长的时间。 0 当浏览器完全收下这个文件后（所盂的时间取决于音频／视频文件的大小），就可以 传送给自己机器上的媒体播放器进行解压缩，然后播放。 为什么不能直接在浏览器中播放音频／视频文件呢？这是因为播放器并没有集成在万维 网浏览器中。因此，必须使用一个单独的应用程序来播放这种音频／视频节目。这个陟用程 序通常称为媒体播放器(medi a p la yer) 。现在流行的媒体播放器有 Real Networks 的 Rea IP la y er 、 微软的 Wi ndows Medj a Play er 和苹果公司的Qu i ckTi me 。媒体播放器具有的主要功能是：管 • 374 •"}
{"doc_id": "network", "page": 386, "text": "理用户界面、解压缩、悄除时延抖动和处理传输带来的拉铅。 清注意，图 8 -4所示传统的卜载文件的方法并没有涉及“流式”（即边下载边播放）的概 念。传统的下载方法砓大缺点就是历时太长，这往往使下载者不愿继续等待。为此，已经找 出了几种改进的猎施。 8.2.1 具有元文件的片维网服务器 第一种改进的措施就处在为维网服务器中，除了真正的音频／视频文件外，还增加了 个元文件(mct a ftl e) 。所讷元文件（诮注意，不足源文件）就是一种非常小的文件，它描述或 指明其他文件的一些重耍信息。这里的元文件保存了有关这个音频／视频文件的倍息。图 8-5 说明了使用元文件下载音频／视频义件的几个步骤。 ，各户机 I  一 1 GET:,~ 文ft RESPONSE  限务器 力维网 1 服务器 GE兰J 图 8-5 使 Ill 具有元文件的万维网）服务器 0 浏览猎川户点出所要看的音频／视频文件的超链，仗川 HTTP 的 GET 报义接入到万 维网服务器。实际上，这个超链井没付直接指向所请求的音频／视频文件，而是指向一个元 文件。这个元义件有实际的音频／视频文件的统一资源定位符 UR L. 0 万维网服务器把该元文件装入 HTTP 响应报文的 E 体，发回给浏览器。在响应报文 中还有指明该扦频／视频文件类型的首部。 0 客户机浏览器收到万维网服务器的响应，分析其内容类型首部行，调用相关的媒体 播放器（客户机中可能装有多个媒体播放器），把提取出的几文件传送给媒体播放器。 0 媒体播放器使用元文件中的 URL 直接和万维网服务器建立 TCP 连接，并向万维网 服务器发送 HTTP 请求报义，要求下载浏览器想要的音频／视频文件。 0 万维网服务器发送 HTTP 响应报文，把该音频／视频文件发送给媒体播放器。媒体播 放器在存储f若干秒的行频／视频义件后（这比为f消除抖动），就以音频／视频流的形式边 下载、边解压缩、边播放。 8.2.2 媒体服务器 为了更好地提供播放流式音频／视频文件的服务，现在垃为流行的做法就足使用两个分 开的服务器。如图 8-6 所示，现在使用一个性迪的片维网服务器，和另一个媒体服务器 (media server) 。媒体服务器和万维网服务器可以运行在一个端系统内，也可以运行 (L 两个不 同的端系统中。媒体服务器与普通的力维网服务器的砓大区别就是，媒体服务器是专门为播 放流式音频／视频文件而设计的，因此能够更加有效地为用户提供播放流式多媒体文件的服 务。因此媒体服务器也常被称为流式服务器(s t ream i n g server）。下面我们介绍其工作原理。 • 375 •"}
{"doc_id": "network", "page": 387, "text": "，各户机 I  一1 GET: Ji:义件 RESPONSE  甘IH“片 GET 旮频／视频文件 • 媒体 RESPONSE @  图 8-6 使用媒体服务器 在川户端的媒体播放热勹媒体服务器的关系是客户与服务器的关系。 l j图 8-5 不同的是， 现在媒体播放淄不足向万绯网服务器而是向媒体服务器请求音频／视频文件。媒体服务器和 媒休播放器之间和 I J另外的协议进行交叭 采川媒体服务器后，下载音频／视频文件的前-::．个步骤仍然和上一节所述的 样，区别 就是后面曲个步骏，即： 0 ~0 前．．．个步骤忖图 8-5 中的相同。 0 媒体播放凇使用元文件中的 URL 接入到媒体服务器，悄求下载浏览器所诮求的音频 1 视频义件。下载义件可以使用 L 一小节讲过的 HTTPff CP, 也可以借助J一．仗用 UDP 的任何 协议，例如使用头时运输协议 RTP (见 8.3.3 节）。 0 媒体服务祸给出响应，把该音频／视频文件发送给媒体播放器。媒体播放器在迟延了 若丁·抄后（例如， 2~5 秒），以流的形式边下载、边解压缩、边播放。 上面提到，传送音频／视频文件可以使用 TCP, 也可以使川 UDP 。起初人们选川 UDP 米传送。小采用 TCP 的卞要原囚是担心呏网络出现分组丢失时， TCP 的屯传机制会使重传 的分组不能按时到达接收端，使得媒体播放器的播放个流畅。但后来的实践经验发现，采用 UDP 会行以下几个缺点。 (I) 发送端按干常播放的速率发送流媒体数据帧，但由于网络的情况多变，在接收端的 播放湘很难做到始终按规定的迷率播放。例如，－·个视频节 H 盂要以 I Mbit/s 的速率播放。 如果从媒体服务器到媒体播放器之间的网络容址突然降低到 I Mbit/s 以卜．，那么这时就会出 现播放器的暂停，影响正常的观石。 (2) 很多单位的防火墙往往阻拦外部 UDP 分组的进入，厌l 而使用 UDP 传送多媒体文件 时会陂防火墙阳拦掉。 (3) 使用 UDP 传送流式多媒体文件时，如果在用户端希惶能够控制媒体的播放，如进 h 暂停、快进笘橾作，那么还孟要使川另外的协议 RTP （见 8.3.3 节）和 RTSP （见 8.2.3 节）。这样就增加f成本和复杂性。 j··足，现在对流式存储音频／视频的播放，如 YouTube 和 Netfli x', 都采用 TCP 米传送。 图 8-7 说明了使川 TCP 传送流式视频的儿个主要步骤［KUR017] 。 IJ,i.: YouTubc （心行）是全球从大的视坎H 站．能支持数百 h 用户同时戏石 lft(托的视频节 H, 也丈片网 LI'. I I 打 1 己刹作 的儿＇；，观桢 h Il NeInix t众飞．或网飞）足 1仕界 1 ．从人们在线影片 Ill 赁提供商．＂「从供超过 85000 ，切 DVD 电影的 1111,'1限务， 以及 4000 名；1U 影片或打电视剧的在线观／i llI i分． • 376 •"}
{"doc_id": "network", "page": 388, "text": "视频义件 TCP  发送绕（f待发送的 仇／ 且联网上(i这 亡] 应 IIIr,!I f叮 I 飞时地从缓存中把 帧i).:出． 俅 l玉缩． 显，J,在 I斤岱卜 ＿，客户机 图 8-7 如II TCP 传送流犬视频的书畟步获 步骤 0: 川户使用 HTTP 获取存储在万维网服务器中的视频文件，然后把视频数据传送 到 TCP 发送绥存中。若发送缓存已坟满，就暂时停止传送。 步骤 0 ：从 TCP 发送缓存通过 l i联网向客户机中的 TCP 接收缓{f传送视频数据，直到 接收缓存被埴满。 步骤 0 ：从 TCP 接收缓存把视频数摒协传送到应用程序缓存（即媒体播放器的缓存）。 这叫作预先存储。当预先存储在缓存中的视频奻锅存储到一定数歉时，就开始播放。这个过 程一般不超过 1 分钟。 步骤 0 ：在播放时，媒体播放器等时地（即周期性地）把视频数据按帧读出，经解压缩 后，把视频节 11 显示在用户的屏俗上 请注意。这里只有步骤0 的读出速年是严格按照源视频文件的规定速率来播放的。而前 面的三个步骤中的数据传送速率则可以是任悠的。如果用户听停播放，那么佟1 中的：：：．：个缓存 将很快被填满，这时 TCP 发送缓存就暂停读取所耍传送的视频文件，否则就会引起视频数 据的丢失。以后，当用户继续播放时，媒体播放器每读出 II bit, TCP 发送缓存就可以从存 储的视频义件再读取 n b it。如果客户机中的两个缓存经常处千填满状态，就能够较好地应 付网络中偶然出现的拥塞。 如果步骤O 的传送速率小于步驻 0 的读出速率，那么客户机中的两个缓存中的存位就会 逐渐减少。当媒体播放器缓存的数据被取空后，播放就不得不暂停，直到后续的视频数据重 新注入进来后才能再继续播放。实践证明，只要在步骤 0 的 TCP 平均传送速率达到视频节 目规定的播放速率的两倍，媒体播放器一般就能流畅地播放网上的视频节目。 这里要指出，如果是观行实况转播，那么垃好应当首先打虑使用 UDP 来传送。如果使 用 TCP 传送，则当出现网络严巫拥寒而产生播放的暂停时，就会使人难于接受。使用 UDP 传送时，即仗囚网络拥塞丢失了－些分组，对观石的感觉也会比突然出现暂停要好些。 顺便指出，我们在豕中的宽带上网并不能保证媒体播放器一定能够流畅地回放任何视 频节目。这是 I 人1 为网络社运商只能保证，从用户家中到网络运背商的某个路由器之间的这段 网络的数据速率。但从网络运营商到兀联网上下载视频的朵个媒体服务器的这段网络状况则 是未知的，很可能在某些时段会出现·些网络拥寒。此外，还攷考虑所选的视频节目的清晰 度所要求的传输带宽。我们都知道， DVD 质阰的视频和高消电视或 4K 超高清视频节目所 要求的网速就相差很远。 流式媒体播放器问世后就很受欢迎。网民们不需要冉随身携带刻求有视频节目的光盘， 只要有能够上网的智能手机或轻巧的平板电脑，就能够随时 1·，网观石各种视频音频节目。曾 经在城市中很热闹的光盘销伟刹店，巾于受到流式媒体的冲山，现已变得相当谅条。 • 377 •"}
{"doc_id": "network", "page": 389, "text": "8.2.3 实时流式协议 RTSP 实时流式协议 RTSP (Real-Time Streaming Pro t ocol) 是 lETF 的 MMUSIC 工作组(Mul tiparty MUitimedia Session Control WG, 多jj多媒体会话控制 L 作纠）片发的协议，现在是 RTSP 2.0  [RFC 7826, 建议标准］。 RTSP 是为j，给流式过程哨加史多的功能曲设计的协议。 RTSP 本身 并不传送数掘，而仅仅是使媒体播放器能够控制多媒体流的传送（有点像文件传送协议 FTP 有个控制信追），因此 RTSP 又称为带外协议 (ou t -o f-band p ro t ocol) 。 RTSP 协议以客户－服务器方式 1 ：作，它是·个应川层的多媒体播放控制协议，用来 使川户在播放从兀联网下载的实时数据时能够进行控制（像在影碟机上那样的控制），如： 暂伈／继续、快退、快进等。因此， RTSP 义称为“互联网录像机遥控协议”。 RTSP 的诏法和橾作与 HTTP 协议的相似（所付的请求和 II向应报文都是 ASCII 文本）。 但勹 HTTP 不同的地方是 RTSP 是有状念的协议 (HTTP 是无状态的）。 RTSP 记求客户机所 处J··的状态（初始化状态、播放状态或行停状态）。 RFC 7826 还规处·, RTSP 控制分组既可 在 TCP 十传送，也可在 UDP I．传送。 RTSP 没有定义名频／视频的压缩方案，也没钉规定音 频／视频在网络中伈送时应如何封装在分组中。 RTSP 不规记行频／视频流在媒体播放器中应 如何续亿 在仗川 RTSP 的播放器中比较茗名的足苹果公司的Qu i ck Ti me 和 Real Networks 公司的 Real Pla y er 。 图 8-8 表不使川 RTSP 的媒体脱务器的工作过程。 ，各户机 I  一1 服竹沿 GET: 兀义f'I RESPONSE  __  网牲绯务万服 SETUP  RESPONSE  PLAY  RESPONSc  齐频／视频泊 TEARDOWN  RESPONSF  图 8-8 如 ll RTSP 的媒体服务器的 1 作过程 0 浏览器使川 HTTP 的 GET 报义向Jj维网服务器请求齐频／视频文件。 e 力维网服务器从浏览器发送拱带付元文件的响应。 0 浏览器把收到的元文件仕送给媒体播放器。 0 媒体播放器的 RTSP 客户发送 SETUP 报文与媒体服务淄的 RTSP 服务器建立连接。 0 媒体服务器的 RTSP 服务器发送响应 RESPONSE 报文。 0 媒体播放器的 RTSP 客户发送 PLAY 报义开始卜载音频／视频文件（即开始播放）。 0 媒体服务器的 RTSP 服务器发这响应 RESPONSE 报文。 • 378 •"}
{"doc_id": "network", "page": 390, "text": "此后，音频／视频文件被下载，所用的协议是运行在 UDP t-.的。可以是后面要介绍的 RTP, 也可以是其他专用的协议。在音频／视频流播放的过程中，媒体播放器可以随时暂停 （利用 PAUSE 报文）和继续播放（利用 PLAY 报文），也可以快进或快退。 0 用户在不想继续观石时，可以 rt~ RTSP 客户发送 TEARDOWN 报文断开连接。 0 媒体服务凇的 RTSP 服务器发送响应 RESPONSE 报文。 诮注意，以上编号的步骤 0 至 0 都使用实时流协议 RTSP 。在图 8-8 中步骤 0 后面没有 编号的“音频／视频流”则使川另外的传送音频／视频数据的协议，如 RTP 。 8.3 交互式音频／视频 限千篇幅，在本节中我们只介绍交互式音频，即 IP 屯话。 lP 电话是在互联网上传送多 媒体信息的一个例f·。通过 IP 电话的讨论，可以有助千了解在互联网上传送多媒体信息应 斗，，解决好哪些问题。 8.3. l lP 电话概述 1. 狭义的和广义的 IP 电话 TP 电话有多个英文同义词。常见的有 VoIP (Voice over IP), Internet Telephon y和 YON (Voice On the Net)。但 IP 电话的含义却有不同的解释。 狭义的 IP 电话就是指在 IP 网络上打电话。所谓 “IP 网络”就是“使用 TP 协议的分组 交换网＂的简称。这里的网络可以是互联网，也可以是包含有传统的电路交换网的互联网， 不过在互联网中至少要有一个 IP 网络。 广义的 IP 电话则不仅仅是电话迪估，而且还可以是在 IP 网络上进行交冗式多媒体实时 迪信（包括话音、视像等），甚全还包括即时传信 IM (Instant Messagi ng)。即时传信是在上 网时就能从屏幕上得知有哪些朋友也正在上网。若有，则彼此可在网上即时交换信息（文字 的或声音的），也包括使用 1 点对多点的多播技术。目前流行的即时传信应用程序付侬信、 S kyp e 、QQ和 MSN Messenger [CHEN07], 很受网民的欢迎。 IP 电话可看成是一个正在演进 的多媒体服务平台，是话音、视像、数据综合的尪础结构。在某些条件下（例如使用宽带的 屈域网）， IP 电话的话音质址甚至还优千普通电话。 下面讨论狭义的 IP 电话 [COLLOI), 而广义的 IP 电话在原理 I才．是一样的。 其实 IP 电话并非新概念。早在 20 世纪 70 年代初期 ARPANET 刚开始运行不久，美国 即着手研究如何在计符机网络上传送电话信息，即所谓的分组话音通信。但在很长一段时间 甩，分组话音通信发展得并不快。主｝胜的原因是： (I) 缺少廉价的荔质从、低速率的话音信号编解码软件和相应的芯片。 (2) 计饮机网络的传输速率和路小器处理速率均不够快，因而导致传输时延过大。 (3) 没有保证实时通估服务质量QoS (Quality of Serv i ce) 的网络协议。 (4) 计符机网络的规橾较小，而通信网只有在具有一定规模后才能产生经济效益。 2. IP 电话网关 然而到了 20 世纪 90 年代中期，上述的几个问题才相继得到了较好的解决。千是美国的 • 379 •"}
{"doc_id": "network", "page": 391, "text": "Yoca!Tec 公司在 1995 年初率先推出了实川化的JP 电话。但是这种 IP 电话必须使用 PC 。 1996 年 3 月， IP 电话进入了一个转折，1从： VocalTec 公司成功地推出了 IP 电话网关(J P Telephony  Gat eway),它是公用电话网百 IP 网络的搂口设备。 IP 电话网关的作用就是： (1) 在电话呼叫阶段和呼叫释放阶段进行电话信令的转换。 (2) 在通话期间进行话音编码的转换。 有了这种 IP 电话网关，就可实现 PC 用户到固定电话Jf]户打 IP 电话（仅衙经过 IP 屯话 网关一次），以及固定电话用户之间打 IP 电话（盂要经过 IP 电话网关两次）。 图 8-9 画出{ IP 电话几种不同的连桵方式。图中最上而的估况最简州是两个 PC 川户 之间的迪话。这许然不孟要经过 IP 电话网关，但必须是从方都同时上网才能进行通话。图 砂中间的一种估况是 PC 到固定电话之间的迪话。最后十种悄况是两个固定电话之间打 IP 电话，这当然是垃方使的。读者应当特别注意在哪一部分是使用电路交换还是分组交换。 ．，＇令-··区百三］．．．．．．． ，、｀ \\ _—- .-----···············~固定电话 1··-·-···---.,  ＼勹》1P1：：二少一 ．．．．．．．．--．一斗．． 4 郎已电话到固定电让 L······ 一一．七．．．．～... • • · ·  ~- 1 IP 1[! i,~ IP I I!话 I 、 宜之二。二－二3,. 田 —电路交换 , 分组交换 1 电路交换 阳 8-9 IP 屯话的儿种连接力法 3. IP 电话的通话质量 IP 电话的迪话质岱与电路交换电话网的通话质社钉很大差别。在电路交换屯话网中， 任何两端之间的通话质阰都是有保证的。但 IP 屯话则不然。 IP 电话的通话｝贞狄主要由两个 囚素决定，一个是通话双方端到端的时延和时延抖动，另一个是话音分组的丢失率。但这两 个因素都是不确定的，而是取决于当时网络上的通信量。若网络上的迪估蚊非常大以致发生 （网络拥塞，那么端到端时延和时延抖动以及分组丢失率都会很商，这就导致 IP 电话的通 话质见下降。因此，一个J I1 户使川 IP 电话的迪话质址取决于当时其他许多用户的行为。请 注总，屯路交换屯话网的估况则完全不是这样。当电路交换电话网的通信她太大时，往往使 我们无法拨通电话（听到的是忙齿）．即电话网拒绝对正在拨号的用户提供接通服务。但足 (j)注：公用电话网即公用 1 1.!. ra 交换 l I.!.认网．人称为{',统电讯网或电f,．，网． • 380 •"}
{"doc_id": "network", "page": 392, "text": "只要我们拨通了电话，那么电信公司就能保证让用户享受满意的通话质屈。 经验证明，在电话交谈中，端到端的时延不应超过 250 ms, 否则交谈者就会感到不自 然。陆地公用电话网的时延一般只有 50~70 ms 。但经过问步卫拉的电话端到端时延就超过 250 ms, 一般人都不太适应经过卫星传送的过长的时延。JP 电话的时延有时会超过 250 ms,  闵此 lP 电话必须努力减小端到端的时延。当通信线路产生回声时，则容许的端到端时延就 更小些（有时甚至只容许几卜杂秒的时延）。 JP 电话端到端时延是由以下几个因素造成的： (I) 话音信号进行模数转换要产生时延。 (2) 已经数字化的话音比特流要积累到一定的数拭才能够装配成一个话音分组，这也会 产生时延。 (3) 话音分组的发送需要时间，此时间等千话音分组长度与通信线路的数据率之比。 (4) 话音分组在互联网中经过许多路由器的存储转发时延。 (5) 话音分组到达接收端在缓存中暂存所引起的时延． (6) 将话音分组还原成校拟话音信号的数模转换也要产生一定的时延． (7) 话音信号在通信线路上的传播时延． (8) 山终端设备的硬件和操作系统产生的接入时延。由 IP 电话网关引起的接入时延约 为 20~40 ms, 而用户 PC 声卡引起的接入时延为 20~180 ms 。有的调制解调器（如V. 34) 还 会再增加 20~40 ms 的时延（由于进行数字信号处理、均衡等）。 话音信号在通信线路上的传播时延一般都很小（卫甩通信除外），通常可不予考虑。当 采用高速光纤主干网时，上述的第三项时延也不大。 第一、第二和第六项时延取决于话音编码的方法。很明显，在保证话音质狱的前提下， 话音信号的数码率应尽可能低些。为了能够在世界范围提供 IP 屯话服务，话音编码就必须 采用统一的国际标准。 ITU-T 己制定出不少话音质位不错的低速率话音编码的标准。 H 前适 合 IP 电话使用的 lTU-T 标准主要有以下两种： (I) G.729 话音速率为 8 kb it/s 的共枙结构代数码激励线性预测 CS-ACELP (Conj ugate­ Structure Algebraic-Code-Exc ited Linear Pred i c ti on) 声码器。 (2) G.723.1 话音速率为 5.3/6.3 kb it/s 的线性预测缩码 LPC (Linear Prediction Cod i n g)声 码器。 这两种标准的比较见表 8-1 。 表 8-1 G.729 和 G.723.1 的主要性能比较 G勹 I 比特勹tJs) 1 帧大J3 』 ms) 1 处理时『 (ms) 1 帧长2 ：广 数字信号处理 MIPS 20  16  表中的比特率是输入为 64 kb it/s 标准 PCM 信号时在编码器输出的数据率。帧大小是压 缩到每一个分组中的话音信号时间长度。处理时间是对一个帧运行编码笃法所需的时间。帧 长是一个已编码的帧的字节数（不包括首部）。数字信吁处理 MIPS （每秒百万指令）是用 数字信号处理芯片实现编码所需的砓小处理机速率（以每秒百万指令为单位）。如使用 PC 的通用处理机，则所孟的处理机 MIPS 还要高些。不难行出， G.723.1 标准虽然可得到更低 的数据率，但其时延也更大些。 • 381 •"}
{"doc_id": "network", "page": 393, "text": "要减少上述第四和第五项时延较为困难。当网络发牛拥塞而产生话音分组丢失时，还 必须采用一定的策略（称为＂丢失掩蔽算法”)对丢失的话音分组进行处理。例如，可使用 前一个话音分组来填补丢失的话音分组的间隙。 接收端缓存空间和播放时延的大小对话音分组丢失率和端到端时延也有很大的影响。 图 8-10 说明了这一问题。话音质岱可分为四个级别，即“长途电话质批“（这是最好的质 阰）、“良好”“基本可用“和“不好”，各对应于图 8-10 中的一个区域。越接近坐标原点， 话音质从就越好。我们假定某 IP 电话的迪话质侦处在图中 B 点的位置。若增大接收端缓存 空间并增大播放时延，则话音分组丢失率将减小，但端到端的时延将增大（如图中的 C 点）。 继续增大播放时延，则话音分组丢失率将继续减小，趋向于网络所引起的丢失率（如图中的 D 点），但 D 点的端到端时延很大，话1,子）贞社很不好。反之，若将接收端缓存做得很小井减 小播放时延，则端到端时延将减小，趋向千网络所引起的端到端时延（如图中的 A 点），但 话音分组丢失率将会大大增加，话音质礼也不好。 分组 L 失率 20~.  10%  5%  长达电话 ／贞橇 良 .  、；o...  D  ｝为到谥时延 图 8-10 播放时延｛j -个砓仕伯 可见接收端的播放时延有一个砐佳侦． OO 中打一个）＂．I,i. N, 相芍于端到端时延和话音分组 丢失率都是最小的，但实际上井不可能工作在这个点上。 据统计，当通话双方相距 3200 km II 寸，互联网上的时延约为 30~100 111S （传播和排队）， 而所有各环节的时延总和约为 100~262 ms （在两个 1P 电话网关之间）或 170~562 ms （在两 个 PC 之间） ［ KAST98] 。可见为f减小时延，应尽可能不要直接用 PC 打 IP 电话。 提的路由器的转发分组的速率对提高 IP 电话的质坎也是很屯要的。据统计，一个跨大 西洋的 IP 电话一般要经过 20~30 个路巾器。现在一个普迪路巾器每秒可转发 50~100 万个分 纠。若能改用吉比特路巾器（又称为线速路由器），则的秒可转发 500 月至 6000 万个分组 （即交换速率达 60 Gb it/s 左右）。这样还可进一步减少山网络造成的时延． 近几年来， IP 电话的质队得到了很大的提高。现在许多 IP 屯话的话音质挝已经优于固定 电话的话音质她。一些电信运营商还建造了自己专用的 IP 电话线路，以使保证更好的通话质 队。在 IP 电话领域里，砐值得一提的就是 Skyp e IP 电话，它给全世界的广大用户带来了高 品质并且廉价的通话服务。 Skype 使用了 Global IP Sound 公司开发的互联网低比特率编解码 器iLBC (internet Low Bit rate Codec)[RFC 3951, 3952), 进行话音的编解码和压缩，使其话音 质扯优于传统的公J Il 电话网（采用电路交换）的话音质批。 Sk ype 支持两种帧长： 20 ms （速 率为 15.2 kbit/s, 竹个话音分组块为 304 b it)和 30 ms （速率为 13.33 kb it/s, 一个话音分组 块为 400 b it)。 Skype 的另一个特点是对话音分组的丢失进行了特殊的处理，因而能够容忍高 达 30 ％的话音分组丢失率，通话的用户·般感觉不到话音的断续或迟延，朵音也很小。 • 382 •"}
{"doc_id": "network", "page": 394, "text": "Skyp e 采用了 P2P （见第 6 章 6.9 节的介绍）和全球索引 (Global Index) 技术提供快速 路由选择机制（而不是单纯依靠服务器来完成这些工作），因而其管理成本大大降低，在用 户呼叫时，出于用户路由信息分布式存储千互联网的节点中，因此呼叫连接完成得很快。 S kype 还采用了端对端的加密方式，保证信息的安全性。 Skyp e 在信息发送之前进行加密， 在接收时进行解密，在数据传输过程中完全没付可能在中途被窃听。 由千 Skyp e 使川的是 P2P 的技术，用户数据主要存储在 P2P 网络中，闪此必须保证存 储在公共网络中的数据是可靠的和没什被篡改的心 Skype 对公共目录中存储的和用户相关的 数据都采用了数字签名，保证了数据无法被絊改。 自 2003 年 8 月 Skype 推出以来，在短短 15 个月内， Sk ype 已拥有超过 5000 万次的下 载砒，注册批超过 2000 万川户，并且还在以每天超过 15 万用户的速度增长。在 2011 年， 在同～时间使用 Skyp e 的用户数已经突破了 3000 万大关。据统计，在 2014 年的国际长途电 话的市场份额中， Skype 已经占据了 40% 。 Skyp e 的问世给全球信息技术和通信产业带来深 远的影响，也给每一位网络使用者带来生活方式的改变。 8.3.2 IP 电话所盂要的几种应用协议 在 IP 电话的通信中，我们至少盂要两种应用协议。一种是信令协议，它使我们能够在 互联网上找到被叫川户（－，）。另一种处话音分组的传送协议，它使我们用来进行电话通信的话 音数据能够以时延敏感属性在互联网中传送。这样，为（在互联网中提供实时交互式的音频 ／视频服务，我们盂要新的多媒体体系结构。 图 8-11 给出（在这样的体系结构中的三种应用层协议。第一种协议是与信令有关的， 如 H.323 和 SIP （面在最左边）：第二种协议是直接传送肾频／视频数据的，如 RTP （画在最 右边）；第＝种协议是为了提高服务质址，如 RSVP 和 RTCP （画在中间）。 估令 {  议协层f “V“ I I  TCP  服务质攸 行频／视频 UDP  1Pv4/[Pv6  底层网络 图 8-11 提供实时交互式音频／视频服务所需的应用以协议 下面先介绍实时运输协议 RTP 及其配套的协议一一实时运输控制协议 RTCP, 然后冉介 ＠注在公用电话网中．电话之换机根据用户所拨打的另肘就能够通过合适的路由找到被叫用户．片在主叫和校叫之间建 立起召条电路迂接．这忱邵依作电认信令(s ignali ng)完成～我们听到的振铃卢、忙音或一共及行提示．以及打完电话扎机杆放连 仪，也都是 111 屯话仿令米处开的。现（「电话网使 I0 的仇令就是 7 \\}(,]令 SS7, ,flff1J IP 网络打屯话同样也',t1 耍 lP 网络能够识别的 从种信令．但小于 LP 电iii1 往要纾过已'i的公用电话网．因此 IP 电占的亿令必须在所有的功能上与距付的 7 号信令什1 抡容．这 l l-才能使 IP 网络和公用电沾网上的两种估令能够 h．相书换．因向能够做到Y.~i!ft. • 383 •"}
{"doc_id": "network", "page": 395, "text": "绍 IP 电话的信令协议 H.323 和会话发起协议 SIP 。 8.3.3 实时运输协议 RTP 实时运输协议 RTP (Real-time Trans port Pro t ocol) 是 lETF 的 AVT 工作组（AudioNi deo Transport WG)开发的协议，现已成为互联网标准[RFC 3550, STD64] [RFC 3551, STD65] 。 RTP 为实时应用提供端到端的运输，但不提供任何服务质量的保证。需要发送的多媒 体数据块（音频／视频）经过压缩编码处理后，先送给 RTP 封装成为 RTP 分组（也可称为 RTP 报文 1) 。 RTP 分组装入运输层的 UDP 用户数据报后，再向下递交给 lP 层。 RTP 现已 成为互联网正式标准，并且已被广泛使用。 RTP 同时也是 ITU-T 的标准 (H.225.0) 。实际上， RTP 是一个协议框架，因为它只包含了实时应用的一些共同功能。 RTP 自己并不对多媒体 数据块做任何处理，而只是向应川层提供一些附加的信息，让应用层知道应当如何进行处理。 图 8-11 把 RTP 协议画在应用层。这是因为从应用开发者的角度看， RTP 应当是应用层 的一部分。在应用程序的发送端，开发者必须编写用 RTP 封装分组的程序代码，然后把 RTP 分组交给 UDP 套接字接门。在接收端， RTP 分组通过 UDP 套接字接口进入应用层后， 还要利用开发者级写的程序代码从 RTP 分组中把应用数据块提取出来。 然而 RTP 的名称又跺含地表示它是一个运输层协议。这样划分也是可以的，因为 RTP 封装了多媒体应用的数据块，井且由于 RTP 向多媒体应用程序提供了服务（如时间戳和序 勺），因此也可以把 RTP 石成是在 UDP 之上的－·个运输层子层的协议。 RTP 还有两点值得注意。首先， RTP 分组只包含 RTP 数据，而控制是由另一个配恁使 用的 RTCP 协议捉供的（这在下节介绍）。其次， RTP 在端口号 1025 到 65535 之间选择 个未使用的偶数 UDP 端口号，而在同一次会话中的 RTCP 则使用下一个奇数 UDP 端口号。 但端口勺 5004 和 5005 则分别用作 RTP 和 RTCP 的默认端口号。 图 8-12 给出了 RTP 分组的首部格式，下面进行简羊的介绍。 位 0 I 3  版对叶 xl 参与渊数 I MJ打效载荷类戏 1 序 飞口． 时间戳 同步拟标识符 (SSRC) 参与源标识符（CSR C) (0.. 15)  ...  8 16 丁 12上 3  发这 IP 1',1竹叶 UDP {1部j RTP l1部 I RTP 数据部分（应用以数据） I---- RTP 分组 UDP 用户数据报 IP 奻据报 图 8-12 RTP 分组的首部格式 ＠注：按惯例． h 必输从或应用臣的协议数据单元应当叫作报文．但相欠 RFC 文t'l 中都是使用 RTP p acket这一名词的． 为f和 RFC 文档一致．这里也使川 “RTP 分纤l... 下一订的 RTCP 也按同样）i认处理． • 384 •"}
{"doc_id": "network", "page": 396, "text": "在 RTP 分组的首部中，前 12 个字节是必需的，而 12 字节以后的部分则是可选的。下 面按照各字段重要性的顺序来进行介绍。 {I) 有效载荷类型(pa yload type) 占 7 位。这个字段指出后面的 RTP 数据屈于何种格 式的应用。收到 RTP 分组的应月」层就根据此字段指出的类型进行处理。例如，对 F 音频有 效载荷（每一种格式后面括弧中的数字就表示其有效载荷类型的编码）： µ律 PCM (0), GSM  (3), LPC (7), A 律 PCM (8), G.722 (9), G.728 (15) 等。对千视频有效载荷：活动JPEG (26),  H.261 (31), M PEG I (32), M PEG2 (33) 等。 (2) 序号 占 16 位。对每个发送出的 RTP 分组，其序号加 1 。在一次 RTP 会话开 始时的初始序乃是随机选择的 e Ff 3 使接收端能够发现丢失的分组，同时也能将失序的 RTP 分组重新按序排列好。例如，在收到序号为 60 的 RTP 分组后又收到了序号为 65 的 RTP 分组。那么就可推断出，中间还缺少序号为 61 至 64 的 4 个 RTP 分组。 (3) 时间戳 占 32 位。时间戳反映［ RTP 分组中数据的第一个字节的采样时刻。在 一次会话开始时时间戳的初始值也是随机选择的。即使在没有信号发送时，时间戳的数值也 要随时间而不断地增加。按收端使川时间戳可准确知道应当在什么时间还原哪一个数据块， 从而消除时延的抖动。时间戳还可以川来使视频应用中卢音和图像同步。在 RTP 协议中井 没付规定时间戳的粒度，这取决于有效载荷的类型。因此 RTP 的时间戳又称为媒体时间戳， 以强调这种时间戳的粒度取决于信号的类型。例如，对于 8 kHz 采样的话音信号，若每隔 20 ms 构成一个数据块，则一个数据块中包含有 160 个样本 (0.02 X 8000 = 160) 。因此发送 端每发送一个 RTP 分组｀其时间戳的值就增加 160 。 (4) 同步源标识符 占 32 位。同步源标识符 SSRC (Synchronous SouRCe i den tifi er) 是 一个数，用米标志 RTP 流(s tream) 的米源。 SSRC 与 lP 地址无关，在新的 RTP 流开始时随机 地产生。由于 RTP 使用 UDP 传送，因此可以 4了多个 RTP 流（例如，使用几个彶像机从不 同角度拍摄同一个节目所产生的多个 RTP 流）复用到一个 UDP 用户数据报中。 SSRC 可使 接收端的 UDP 能够将收到的 RTP 流送到各自的终点。两个 RTP 流恰好都选择同介个 SSRC 的概率是极小的。若发生这种情况，这两个源就都重新选择另一个 SSRC 。 (5) 参与源标识符 这是选项，蚊多可钉 15 个。参与源标识符 CSRC (Contributing  SouRCe i dea tifi er) 也是个 32 位数，用来标忐来源于不同地点的 RTP 流。在多播环境中， 可以用中间的一个站（叫作混合站 m i xer) 把发往同一个地点的多个 RTP 流混合成一个流 (nJ节省通估资源），在 II 的站再根据 CSRC 的数伯把不同的 RTP 流分开。 (6) 参与源数 占 4 位。这个字段给出后面的参与源标识符的数目。 (7) 版本 占 2 位。节前使川的是版本 2 。 (8) 填充 P 占 1 位。在某些特殊悄况 F 盂要对应川数据块加密，这往往要求每一个 数据块有确定的长度。如不满足这种长度要求，就谣要进行订i充 e 这时就把 P 位仪 l ，表示 这个 RTP 分组的数据有若干填充字节。在数据部分的垃后·个字节用米表示所埴允的字节 数。 (9) 扩展 X 占 1 位。 X 置 1 表示在此 RTP 首部后而还有扩展首部。扩展首部很少使 用，这里不再讨论。 (10) 标记 M 占 1 位。 M rl. I 表示这个 RTP 分组具有特殊意义。例如，在传送视频 流时川来表示匈帧的开始。 • 385 •"}
{"doc_id": "network", "page": 397, "text": "8.3.4 实时运输控制协议 RTCP 实时运输控制协议 RTCP (RTP Control Pro t ocol) 是与 RTP 配合使用的协议[RFC 3550,  3551), 实际上， RTCP 协议也是 RTP 协议不可分割的部分。 RTCP 协议的主要功能是：服务质讯的监视与反馈、媒体间的同步（如某一个 RTP 发送 的声齐和图像的配合），以及多播组中成员的标志。 RTCP 分组（也可称为 RTCP 报文）也 使用 UDP 来传送，但 RTCP 井不对音频／视频分组进行封装。由于 RTCP 分组很短，因此可 把多个 RTCP 分组封装在一个 UDP H j户数据报中。 RTCP 分组周期性地在网上传送，它带 有发送端和接收端对服务质批的统计信息报告（例如，已发送的分组数和字节数、分组丢失 率、分组到达时间间隔的抖动等）。 表 8-2 是 RTCP 使用的五种分组类刑，它们都使用同样的格式。 表 8-2 RTCP 的五种分组类型 类型 缩写表示 意义 200 SR 发送为报行 201 RR 搂收谥报？， 202 SDES 源点描述 203 BYE 结束 204 APP 持定应Ill 结束分组 BYE 表示关闭·个数据流。 特定应用分组 APP 使应用程序能够定义新的分组类型。 接收端报告分组 RR 用来使接收端周期性地向所有的点川多播方式进行报告。接收端每 收到一个 RTP 流（一次会话包含有许多的 RTP 流）就产生·个接收端报告分组 RR 。 RR 分 组的内容有：所收到的 RTP 流的 SSRC: 该 RTP 流的分组丢失率（若分组丢失率太商，发 送端就应、l i适节降低发送分组的速率）：在该 RTP 流中的最后介个 RTP 分组的序号：分组 到达时间间隔的抖动等。 发送 RR 分组有两个目的：第一，可以使所有的接收端和发送端了解当前网络的状态； 第二，可以使所有发送 RTCP 分组的站点自适应地调整自已发送 RTCP 分组的速率，使得起 控制作用的 RTCP 分组不要过多地影响传送应用数据的 RTP 分组在网络中的传输。通常是 使 RTCP 分组的通信最不超过网络中数据分组的通信量的 5 ％，而接收端报告分组的通估量 又应小千所有 RTCP 分组的通估益的 75% 。 发送端报告分组 SR 用来使发送端周期性地向所有接收端川多播方式进行报告。发送端 每发送一个 RTP 流，就要发送一个发送端报告分组 SR 。 SR 分组的主耍内容有：该 RTP 流 的同步源标识符 SSRC ；该 RTP 流中砓新产生的 RTP 分组的时间戳和绝对时钟时间（或墙 上时钟时间 wall clock ti me): 该 RTP 流包含的分组数：该 RTP 流包含的字节数。 绝对时钟时间是必要的。因为 RTP 要求每一种媒体使川·个流。例如，要传送视频图 像和相应的声音就需要传送两个流。有f绝对时钟时间就可进行图像和卢苦的同步。 源点描述分组 SDES 给出会话中参加者的描述，它包含参加者的规范名 CNAME (Canonical NAME) 。规范名是参加者的屯子邮件地址的字符串。 • 386 •"}
{"doc_id": "network", "page": 398, "text": "8.3.5 H.323  现在 IP 电话有两套信令标准：一仓是JTU-T 定义的 H.323 协议，另～一套是 IETF 提出 的会话发起协议 SIP (Session Initiation Pro tocol) 。我们先介绍 H.323 协议。 H.323 是 ITU-T 千 1996 年制定的为在局域网上传送话音信息的建议书。 1998 年H. 323 的第二个版本改用的名称是“基千分组的多媒体通信系统”。在 2009 年已更新到 H.323v7 。 基于分组的网络包括互联网、局域网、企业网、城域网和广域网。 H.323 是互联网的端系统 之间进行实时声音和视频会议的标准。请注意， H.323 不是一个单独的协议而是一组协议。 H.323 包括系统和构件的描述、呼叫校型的描述、呼叫伉令过程、控制报文、复用、话音编 解码器、视像编觞码器，以及数据协议等。图 8-13 示意了连接在分组交换网上的 H.323 终 端使用 H.323 协议进行多媒体通信。 图 8-13 H.323 终端使用 H.323 协议进行多媒体迪估 H.323 标准指明［四种构件，使用这些构件连网就可以进行点对点或一点对多点的多媒 体通信。 (l} H.323 终端 这可以是一个 PC, 也可以是运行 H.323 程序的单个设备。 (2) 网关 网关连接到两种不同的网络，使得 H.323 网络可以和非 H.323 网络（如公 用电话网）进行通信。仅在一个 H.323 网络上迪信的两个终端当然就不盐要使用网关。 (3) 网闸(ga t ekee p er) 网闸相当千整个 H.323 网络的大脑。所有的呼叫都要迪过网闸， 因为网闸提供地址转换、授权、带宽忤理和计费功能。网闸还可以帮助 H.323 终端找到距离 公用电话网上的被叫用户蚊近的一个网关。 (4) 多点控制单元 MCU (Multipoint Control Unit) MCU 支持三个或更多的 H.323 终 端的音频或视频会议。 MCU 忤理会议资源、确定使用的音频或视频编解码器。 网关、网闸和 MCU 在逻辑上是分开的构件，但它们可实现在一个物理设备中。在 H.323 标准中，将 H.323 终端、网关和 MCU 都称为 H.323 端点(end p oi n t)。 图 8-14 表示了利用 H.323 网关使冗联网能够和公用电话网进行连接。 ＼V 下（ I H.32;芦＼ \\ -  网关 `' 公用电话网 、 图 8-14 H .3 23 网关用米和非1-1 .323 网络进行连接 图 8-15 给出了 H.323 的体系结构。可以石出， H.323 是一个协议族，它可以使用不同 的运输协议。 H.323 包括以下一些组成部分： • 387 •"}
{"doc_id": "network", "page": 399, "text": "音频／视频应用 信令和控制 气卢 RTCP 飞°艺°赞｝ UDP TCP  IP  图 8-15 H.323 的协议体系结构 数据应用 T.120  数枢 (I) 音频编解码器 H.323 要求至少要支持 G.711 (64 kb it/s 的 PCM) 。建议支待如 G.722 (16 kb it/s 的 ADPCM), G.723.1 (5.3/6 .3的 LPC), G.728 (16 kb it/s 的低时延 CELP) 和 G.729 (8 kb it/ s 的 CS-ACELP) 等。 (2) 视频编解码器 H. 323 耍求必须支持 H.261 标准 (176x 144 像素）。 (3) H.255.0 登记信令，即登记／接纳／状态 RAS (Registrati011/ Admi ss i o n/Statu s) 。 H.323 终端和网闸使用 RAS 来完成登记、接纳控制和带宽转换等功能。 (4) H.225.0 呼叫信令 用来在两个 H.323 端点之间建立连接。 (5) H.245 控制信令 用来交换端到端的控制报文，以便管理 H.323 端点的运行。 (6) T. 120 数据传送协议 这是与呼叫相关联的数据交换协议。用户在参加音频／视频 会议时，可以和其他与会用户共享屏籓上的白板。由千使用 TCP 协议，因此能够保证数据 传送的正确（在传送音频／视频文件时使用的是 UDP, 因此不能保证服务质掛）。 (7) 实时运输协议 RTP 和实时运输控制协议 RTCP 这两个协议前面已讨论。 H.323 的出发点是以已有的电路交换电话网为基础，增加了 IP 电话的功能（即远距离 传输采用 IP 网络）。 H.323 的信令也沿用原有电话网的信令模式，因此与原有电话网的连接 比较容易。 8.3.6 会话发起协议 SIP 虽然 H.323 系列现在已被大部分生产 IP 电话的厂商采用，但由于 H.323 过千复杂（整 个文档多达 736 页），不便千发展基于J P 的新业务，因此 lETF 的 MMUSlC 工作组制定了另 一套较为简单且实用的标准，即会话发起协议 SIP (Session Initi ation Protocol) [RFC 3261 一 3264], 目前已成为互联网的建议标准。 SIP 使用了 KISS 原则：即“保持简单、傻瓜” (Keep It Simple and S tupi d) 。 SIP 协议的出发点是以互联网为基础，而把 IP 电话视为互联网上的新应用。因此 SlP 协议只涉及 1P 电话所需的信令和有关服务质岱的问题，而没有提供像 H.323 那样多的功能。 SIP 没有强制使用特定的编解码器，也不强制使用 RTP 协议。然而，实际上大家还是选用 RTP 和 RTCP 作为配合使用的协议。 SIP 使用文本方式的客户－服务器协议。 SIP 系统只有两种构件，即用户代理(user agent)  和网络服务器(ne t\\vork server) 。用户代理包括两个程序，即用户代理客户 UAC (User Agent  Cl i en t)和用户代理服务器 UAS (User Agent Server), 前者用来发起呼叫，后者用来接受呼叫。 网络服务器分为代理服务器(prox y server) 和重定向服务器(redi rec t server) 。代理服务器接受 来自主叫用户的呼叫请求（实际上是来自用户代理客户的呼叫请求），并将其转发给被叫用 户或下一跳代理服务器，然后 1、一跳代理服务器再把呼叫请求转发给被叫用户（实际上是转 发给用户代理服务器）。重定向服务器不接受呼叫，它通过响应告诉客户下一跳代理服务器 • 388 •"}
{"doc_id": "network", "page": 400, "text": "的地址，由客户按此地址向下一跳代理服务器重新发送呼叫请求。 SIP 的地址十分灵活。它可以是电话号码，也可以是电子邮件地址、 TP 地址或其他类型 的地址。但一定要使用 SIP 的地址格式，例如： • 电话号码 sip:zhangsan@8625-87654321  • 1Pv4 地址 sip:zhangsan@20 J.12.34.56  • 电子邮件地址 sip:zhangsan@l63.com  和 HTTP 相似， SIP 是基于报文的协议。 SIP 使用了 HTTP 的许多首部、编码规则、差 错码以及一些鉴别机制。它比 H.323 具有更好的可扩缩性。 SIP 的会话共有三个阶段：建立会话、通信和终止会话。图 8-16 给出了一个简单的 SIP 会话的例子。图中的建立会话阶段和终止会话阶段，都是使用 SIP 协议，而中间的通信阶段， 则使用如 RTP 这样的传送实时话音分组的协议。 主叫方 ＼二 被叫方 \\4  立话建会 通信 终止 会话 INVITE ：地址，选项 OK：地址 ACK  电话交谈 BYE  图 8-16 ～个简单的 SIP 会话的例子 在图 8-16 中，主叫方先向被叫方发出爪VITE 报文，这个报文中含有双方的地址信息 以及其他一些信息（如通话时话音编码方式等）。被叫方如接受呼叫，则发回 OK 响应，而 主叫方再发送 ACK 报文作为确认（这和建立 TCP 连接的三报文握手相似）。然后双方就可 以通话了。当通话完毕时，双方中的任何一方都可以发送 BYE 报文以终止这次的会话。 SIP 有～种跟踪用户的机制，可以找出被叫方使用的 PC 的 IP 地址（例如，被叫方使用 DHCP, 因而没有固定的 IP 地址）。为了实现跟踪， SIP 使用登记的概念。 SlP 定义一些服务 器作为 SIP 登记器（regi s t rar）。每一个 SIP 用户都有一个相关联的 SIP 登记器。用户在任何时 候发起 SIP 应用时，都应当给 SIP 登记器发送一个 SIP REGISTER 报文，向登记器报告现在 使用的 IP 地址。 SlP 登记器和 SIP 代理服务器通常运行在同一毛台主机上。 图 8-17 说明了 SIP 登记器的用途。主叫方把fNVITE 报文发送给 SIP 代理服务器。这 个fNVITE 报文中只有被叫方的电子邮件地址而没有其 IP 地址。 SIP 代理服务器就向 SIP 登 记器发送域名系统 DNS 查询（这个查找报文不是 SIP 的报文），然后从回答报文得到了被叫 方的 IP 地址。代理服务器把得到的被叫方的 IP 地址插入到主叫方发送的 INVITE 报文中， 转发给被叫方。被叫方发送 OK 响应，然后主叫方发送 ACK 报文，完成了会话的建立。 • 389 •"}
{"doc_id": "network", "page": 401, "text": "卞．叫方 ＼」 INVITE  OK  ACK  SIP 代理 服务揣 SLP 登记器 灶找 问答 电话交谈 BYE  I  INVITE  OK  ACK  图 8-17 跟踪被叫方的机制 被叫方 \\  如果被叫没有在这个 SIP 登记器进行过登记，那么这个 SIP 登记器就发回重定向报文， 指示 SlP 代理服务器向另一个 SIP 登记器重新进行 DNS 查询，直到找到被叫为止。图 8-17 给出了这种悄况下主叫方发出确认之前的呼叫过程。 SIP 还有一个配套协议是会话描述协议 SDP (Session Description Pro tocol) 。 SDP 在电话 会议的情况下特别重要，因为电话会议的参加者应当能够动态地加入和退出。 SDP 详细地 指明了媒体编码、协议的端口号以及多播地址。 SDP 现在也是互联网建议标准 [RFC 8866] 。 由于 SIP 问世较晚，因此它现在比 H.323 占有的市场份额要小。对今后作为 IETF 标准 的 SlP 协议的进展情况应当引起我们的注意。 8.4 改进“尽最大努力交付＂的服务 使互联网更好地传送多媒体信息的另一种方法，是改变互联网平等对待所有分组的思 想，使得对时延有较严格要求的实时音频／视频分组，能够从网络得到更好的服务质量QoS 。 下面我们先介绍提供服务质址的一般方法。 8.4.1 使互联网提供服务质噩 根据 ITU-T 在建议书 E.800 中给出的定义，服务质量QoS 是服务性能的总效果，此效 果决定了一个用户对服务的满意程度。因此在最简单的意义上，有服务质矗的服务就是能够 满足用户的应用斋求的服务，或者说，可提供一致的、可预计的数据交付服务。 在涉及一些具体问题时，服务质岳可用若干基本的性能指标来描述，包括可用性、差 错率、响应时间、吞吐豐、分组丢失率、连接建立时间、故障检测和改正时间等。服务提供 者可向其用户保证某一种等级的服务质队。 我们已多次强调过，互联网的网络本身只能提供“尽最大努力交付”的服务。而要传 送多媒体信息，网络又必须具有一定的服务质揽。下面通过图 8-18 的例子说明应从哪些方 面入手使互联网具有一定的服务质榄[KUR017] 。图中表示局域网上的两台主机凡和 H2 通 • 390 •"}
{"doc_id": "network", "page": 402, "text": "过非常简单的网络（路由器 R1 和 R2 以及连接它们的链路）分别向远地另外两台卞机 H3 和 比发送数据。连接 R1 和 R2 的链路带宽是 1.5 Mb it/s 。现在考虑以下四种情况。 1.5 Mbilfs 链路 112  岱：：：：二皿胪:=_ Mbit/s 链ia 输出队列 图 8-18 主机1-1 1 禾II 1-1 2 分别向主机 H3 和 H4 发送数据 (l) 一个 I Mb it/s 的实时音频数据和一个 FTP 文件数据 -I~1}  假定凡向 H3 传送 I Mbit/s 的实时音频数据，而 H2 向 H4 传送低优先级的 FTP 文件数据。 两台主机发送的数据都在路由器 R1 的输出队列中排队。若突然有一个很大的 FTP 数据块来 到 Rl ，就会把输出队列全部占满。后面到达路山器凡的实时音频分组就会被丢弃。显然这 是不合理的。因此需要增加一个机制，就是给不同性质的分组打上不同的标记。这样当 H1 和l-12 的分组进入路由器凡时， R1 就能够识别比的实时数据分组，并使这些分组以高优先 级进入输出队列，而仅化队列有多余空间时才准许低优先级的 FTP 的数据分组进入。 (2) 一个 I Mb it/s 的实时音频数拱和一个高优先级的 FTP 文件数据 假定 FTP 的用户用高价从 ISP 处购买了高优先级服务，而实时音频的用户只购买了低 优先级服务。因此，仅根振分组自己的标记来确定其服务等级还不够合理。可见应当使路山 器卅加一种机制一分类(class ifi ca ti on), 即路山器根据某些准则（例如，根据发送数据的地 址）对输入分组进行分类，然后对不同类别的通信屈给予不同的优先级。 (3) 一个数据率异常的实时音频数据和一个 FTP 文件数躯 假定上述的屯机 H1 的数据率突然不正常地增大到 1 .5 Mbit/s 或更凶（这可能是出了故 院或恶意破坏网络的汗常运行），那么就会使主机凡的 FTP 的低优先级数据无法迪过路山 器 Rl 。因此，应当使路巾器能够对某个数据流进行通信址的管制(pol i c i n g),仗得这个数据 流不要影响其他正常的数据流在网络中通过。例如，可以将凡的数据率限定为 I Mbit/s 。 路山器 R1 不停地监视 H1 的数据率。只要 H1 的数据率超过规定的 I Mbit/s, 路由器 R1 就把 其中的某些分组丢弃，使其数据率不超过原来设定的门限。 为了更加合理地利川网络资源，应在路由器中再增加·种机制一调度(schedul i ng)。 我们可以利用调度功能给实时音频和文件传送这两个应用分别分配 I Mbit/s 和 0 .5 Mbit/s 的 带宽。这就好像在带宽为 1.5 Mbit/s 的链路中划分出两个逻辑链路，其带宽分别为 I Mbit/ s  和 0 .5 Mbit/s, 因而对这两种应用都有相应的服务质过保证。 (4) 凡和 H2 都发送数据率为 I Mb it/s 的实时数据 在这种情况下，到达路由器 R ，的总数据率是 2 Mb it/s, 已超过[ 1.5 Mbit/s 链路的带宽． 若使这两台主机发出的数据流平等地共享 1.5 Mbit/s 链路的带宽，则每个数据流平均将丢失 25 ％的分组，阳而都变得没有用f。比较合理的做法是让一个数据流迪过 1.5 Mbit/s 的链路， 而阻止另一个数据流的迪过。这就盂要另一种机制一一呼叫接纳(call admi ss i on) 。这里借用 了电话网的术语，进一步的讨论见后而的 8 .4 .3 节。在使用呼叫接纳机制时， 一个数据流要 预先卢明它所需的服务质拭，然后或者被准许进入网络（能得到所盂的服务质战），或者被 • 391 •"}
{"doc_id": "network", "page": 403, "text": "拒绝进入网络（当所需的服务质址不能得到满足时）。 上面简单地说明了为使互联网能够提供一定的服务质揽，应当设法增加一些机制，即： 分组的类别、管制、调度以及呼叫接纳。在后面的几节我们将陆续讨论这些问题。 8.4.2 调度和管制机制 调度和管制机制是使互联网能够提供服务质量的点要措施［STALlO] 。下面先讨论调度 机制。 1. 调度机制 这里所说的“调度”就是指排队的规则。如果不采用专门的调度机制，那么在路由器 的队列采用的默认排队规则就是先进先出 FIFO (First In First Out)。当队列已满时，后到达 的分组就被丢弃。先进先出的最大缺点就是不能区分时间敏感分组和一般数据分组，并且也 不公平，因为这使得排在长分组后面的短分组要等待很长的时间。就像在机场办理登机卡时， 正巧排在你前面的一个人代表 20 个人的团队来办理登机卡，这时你只能耐心等待。 在先进先出的基础上增加按优先级排队，就能使优先级高的分组优先得到服务。图 8-19 是按优先级排队的例子。图中假定优先级分为两种，因此有两个队列：高优先级队列和低优 先级队列。 高优先级队列 路由器 I I I I l l l I  分类 分组离开路由器 调度 I I  ＼、三诉员） 低优先级队列 高低庙 低高 分组到达早厚早 早單 ,...'...... ~..... :...,..................、...................,............······!···················;--·• I  接受服务 丘 5 5 5 巨 分组离开 心 心 心 响 心• I  图 8-19 按优先级排队的例子 假定分组的到达是按照编号从小到大的顺序。在到达路由器后就由分类器（又称为分 类程序）对其进行优先级分类，然后按照类别进入相应的队列。图中的圆圈表示调度，其作 用是从队列中取走排在队首的分组。“调度”相当于排队论中的服务员。只要高优先级队列 中有分组在内，就从高优先级队列中按照链路速率取出排在队首的分组。只有当高优先级队 列已空时，才能轮到低优先级队列中的分组输出到链路上。在图 8-19 的下方给出三个高优 先级的分组（灰色方块）与两个低优先级的分组（白色方块）交替地到达路由器。但在分组 离开路由器时，高优先级的分组 3 和 5 都提前得到服务。请注意，低优先级的分组 2 仍然比 高优先级的分组 5 先得到服务。这是因为在分组 2 得到服务时，分组 5 还没有到达路由器。 当高优先级的分组 5 到达时，路由器正在发送分组 2, 因此分组 5 必须等待分组 2 离开路由 器后才能得到服务。 • 392 •"}
{"doc_id": "network", "page": 404, "text": "简单地按优先级排队会带来一个缺点，这就是在高优先级队列中总是有分组时，低优 先级队列中的分组就长期得不到服务。这就不太公平。公平排队 FQ (Fair Queu i ng)可解决这 一问题。公平排队是对每种类别的分组流设仅一个队列，然后轮流使钜一个队列一次只能发 送－个分组。对于空的队列就跳过去。但公平排队也有不公平的地方，这就是长分组得到的 服务时间长，而短分组就比较吃亏，并且公平排队并没有区分分组的优先级。 为了使高优先级队列中的分组有更多的机会得到服务，可增加队列“权重”的概念， 这就是加权公平排队 WFQ (Weighted Fair Q ueu i ng),其工作原理如图 8-20 所示。 I 铭由器 )  分类器 图 8-20 加权公平排队 WFQ 加权公平排队 WFQ是这样工作的：分组到达后就进行分类，然后送交与其类别对应的 队列（图中假定分为三类）。三个队列按顺序依次把队首的分组发送到链路 C 遇到队列空就 跳过去。但根据各类别的优先级不同，每种队列分配到的服务时间也不同。可以给队列i指 派介个权重 w; 。千是队列i得到的平均服务时间为 w,I(1 丐），这里 2丐是对所有的非空队列的 权瓜求和。这样，若路山器输出链路的数据率（即带宽）为 R, 那么队列i将得到的有保证 的数据率 R，应为 Rxw  R ='  LW  (8-1)  加权公平排队 WFQ在服务质负体系结构中占有重要的地位。当前的许多路由器产品都 加入了 WFQ调度的功能。为了更好地理解 WFQ的概念，阳 8-2] 给出［一个简单的例子， 并把先进先出 FIFO 的情况也同时叫出。我们假定在 WFQ的悄况下，分配给分组流 1 的权 正是 0.5 （即得到服务的时间占总的服务时间的一半），而分配给其他 10 个分组流的权亟都 各为 0.05 。这样，分组流 2~11 共 10 个分组流合起来的权觅也是 0.5 。 在使用先进先出规则时，只有一个队列，因此每个分组流的第一个分组共 11 个分组排 在队首。在图 8-21(a) 和 (b) 两种情况下， FIFO 的结果都是一样的，即队列中前 11 分组发送 完毕后才能发送分组流中剩下的分组。在使用 WFQ时，在图(a) 中分组流 l 先可以发送 10 个分组（但第 11 个分组还不能发送），而在图 (b) 中分组流 l 和其他的分组流交替地发送． 不竹是哪一种情况，分组流 1 都能够得到更多时间的服务。 2. 管制机制 前面提到了使用管制机制可以提供服务质此。对一个数据流，我们可根据以下三个方 面进行管制： (I) 平均速率 网络孟要控制嘈个数枢流的平均速率。这里的平均速率是指在一定的 时间间隔内通过的分组数。但这个时间间隔的选择也说明了这个指标的严格程度。例如，限 • 393 •"}
{"doc_id": "network", "page": 405, "text": "定数据流的 •1!. 均速率为每秒 50 个分组和、r 均速平为每分钟 3000 个分组，虽然这两个指标的 平均值都一样，但其严格程度却不同。假定有一个数据流，有一秒钟迪过[ 1000 个分组， 但一分钟平均下来仍 4淖超过 3000 个，那么这个数据流的平均速率符合后面·个指标，但却 远远不满足前面的指标。 hll2  分组流 l 分组流 2 . .  分纠流 l FIFO  WFQ  分组流 1 FIFO  WFQ  1 1 | 2 | 3 | 4 | 5 | 6 1 7 1 8 | 9 | IO| 1 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 | 1 1,  | 1 1 1 | I | 1 | 1 | 1 | l | I | 1 | 1| 2 |.} 1 4 1 5 | 6 | 7 | 8 1 9 | IO| i 1 | 1 |,  ml2  m 巨］ 工 (a)  m m m 巨］ m m 匡L, 分f|l 流 2 . . .  分组流 1 I I | 2 1 3 1 4 | 5 1 6| 7 | 8 | 9 | I O| 1 l | I I I I I | 1 1 1 1 1 | 1  1 1 | 2 1 1 1 3 | 1 | 4 | l_1 5 | I | 6 1 1 1 7 | I l_8 | I l 9 | l_l IO  图 8-21 (b)  WFQ与 FlFO 的比较 (2) 峰值速率 衅值速率限制了数据流在非常短的时间间隔内的流量。数学上的“瞬 时伯”在实际网络中儿法测定。闪此这里所说的 “I 臣常知的时间间隔＂需要指明时间间脱是 多少。例如，限定数据流的平均速率为符分钟 3000 个分织，但同时限定其峰伯速率不超过 每秒 1000 个分组。峰侦速率也同时受到链路带宽的限制。 (3) 突发长度 网络也限制在非常短的时间间 1补内连续注入到网络中的分组数。 要在网络中对进入网络的分组流按以上三个指标进行节制， 11J仗用非常告名的漏桶管 制器(leaky bucket p ol i cer) （可简称为漏桶），其 1 ：作原理如图 8-22 所示。 注入ihi h i的速率为协抄 r 个权杯 ：｝：亡霖f,J 飞待杖怀 夕屯兰二三口廿一 准许分组 进入网络:~ ·.,且联网｀，＼ (L 任何时间间 ~·,1 I 内准许进入网络的分组玫不能超过 r t +h、一／ 图 8-22 漏桶管制器的 L 作原理 涌桶是一种抽象的机制。在漏桶中可装入许多权标{token), 但垃多装入 b 个权标。只要 沥桶中的权标数小于 b 个，新的权标就以母秒 1 个权标的们定速率加入到湔桶中。但若油桶 已装满了 b 个权标，则新的权标就不再装入，而漏桶的权标数达到垃大侦 b 。 汕桶忤制分组流进入网络的过程如下：分组进入网络前，先耍进入一个队列中等候湔 • 394 •"}
{"doc_id": "network", "page": 406, "text": "桶中的权标。只要漏桶中有权标，就可从漏桶取走一个权标，然后就准许一个分组从队列进 入到网络。若伽桶已无权标，就要等新的权标注入到刹桶，再把这个权标拿走后才能准许下 一个分组进入网络。请注意：“准许进入网络＂井不等于说”已经进入了网络＂，因为分组进 入网络还需要时间，这取决千输出链路的带宽和分组在输出端的排队情况。 假定在时间间隔（中把漏桶中的全部 b 个权标都取走，但在这个时间间隔内漏桶又装入 了 rt个新的权标，因此在任何时间间隔t内准许进入网络的分组数的蚊大值为rt + b 。控制 权标进入湿桶的速率 r 就可对分组进入网络的逑率进行行制。 3. 漏桶机制与加权公平排队相结合 把漏桶机制与加权公平排队结合起来，可以控制队列中的蚊大时延． 现假定有 n 个分组流输入到一个路由器，复用后从一条链路输出。每一个分组流使用 漏桶机制进行管制，油桶参数为 b，和 r;, i = I, 2, …,n （如图 8-23 所示）。 路由｝片 ~ 8-23 用漏桶机制进行忤制 前面已经讲过， WFQ可以使每一个分组流得到如公式(8-1) 所示的有保证的数据率。那 么当分组流通过漏桶后等待 WFQ服务时，一个分组所经受的最大时延是多少？ 现在考虑分组流，。假定沥桶i已经装满了 bi个权标。这就表示分组流i不需要等待就 可从沥桶中拿走 bi个权标，因此 b1 个分组可以马上从路由器输出。但分组流i得到的数据率 由公式(8-1)给出。这 bi个分组中的垃后一个分组所经受的时延最大，它等于传输这 bi个分 组所衙的时间 dmax• 即 bi除以公式(8-1) 给出的传输速率： b t w d ='I  m“R x wi  8.4.3 综合服务 In t Serv 与资源预留协议 RSVP (8-2)  垃初试图在互联网中将互联网提供的服务划分为不同类别的是 IETF 提出的综合服务 lntServ (Integrated Services) [RFC 2210一2215] 和资源预留协议 RSVP (ReSource reserVation  Protocol) [RFC 2205—2209] [Z l-l AN93], 其中的某些 RFC 文档已成为互联网的建议标准。 ln t Serv 可对单个的应用会话提供服务质拭的保证，其主要特点有二： (1) 资源预留。一个路由器需要知追给不断出现的会话已经预留了多少资源（即链路带 宽和缓存空间）。 (2) 呼叫建立。一个需要服务质砒保证的会话，必须首先在源点到终点路径上的每一个 路由器预留足够的资源，以保证其端到端的服务质量的要求。因此，在一个会话开始之前必 • 395 •"}
{"doc_id": "network", "page": 407, "text": "须先有一个呼叫建立（又称为呼叫接纳）过程，它衙没(f:其分组传输路径上的每一个路由器 都参加。每一个路由器都婓确定该会话所需的本地资源是否够J Il ，同时还不要影呐到已经建 立的会话的服务质从。 ln t Serv 定义了两类服务： (I) 有保证的服务(guaran t eed serv i ce), 可保证一个分组在通过路由器时的排队时延有一 个严格的上限。 (2) 受控负载的服务(con trolled-load serv i ce). 可以使应用程序得到比迪常的“尽最大努 力”更加可靠的服务。 ln t Serv) 日有以下四个组成部分： (I) 资源预留协议 RSVP, 它是 ln t Serv 的信令协议。 (2) 接纳控制(adm i ss i on con trol), 用来决定是否同意对某一资源的清求。 (3) 分类器(class ifi er), 用来把进入路山器的分组进行分类，并根据分类的结果把不同类 别的分组放入特定的队列。 (4) 调度器(scheduler), 根据服务质战要求决定分组发送的前后顺序。 会话必须首先卢明它所需的服务质址，以便使路由器能够确定是否有足够的资源来满 足该会话的盆求。资源预衍协议 RSVP 在进行资源预留时采川了多播树的方式。发送端发送 PATH 报文（即存储路径状态报义），给所有的接收端指明通信量的特性。衍个中间的路由 器都要转发 PATH 报文，而接收端用 RESY 报文（即资源预留请求报文）进行响应。路径上 的每个路巾器对 RESV 报文的悄求都可以拒绝或接受。当诮求被某个路由器拒绝时，路由 器就发送一个差错报文给桵收端，从而终止了这一信令过程。芍请求被接受时，链路带宽和 缓存空间就被分配给这个分组流，而相关的流(fl ow) 状态信息就保留在路由器中。“流”是在 多媒体通信中的一个常用的名词，一般定义为“具有同样的源 IP 地址、源端口号、目的 IP 地址、目的端口号、协议标识符及服务质量需求的一连串分组”。 图 8-24 用一个简单例f说明 RSVP 协议的要点。设主机 H1 耍向互联网上的四台主机 H2~H5 发送多播视频节目，在图中这四台主机右边标注的数据率就是这些卞机打忱以这样的 数据率来接收 H1 发送的视频节 H 。这个视频节目可使川不同的数据率来接收。用较低数据 率接收时，图像和卢音的质扯也就较差仁 主机 H1 先以多播方式从源点 H1 向下游方向发送 PATH 报文，如困 8-24(a) 所示。当 PATH 报文传送到多播路径终点的四台卞机（即叶节点）时，每一台卞机就向多播路径的上 游发送 RESV 报文，指明在接收该多播节目时所面的服务质员等级。路巾器若无法预衍 RESV 报文所讲求的资源，就返回差错报义。若能预留，则把下游传来的 RESV 报文合并构成 新的 RESY 报文，化送给日己的上游路小器，蚊后传送到源，I一．I，心机 1l1 。这些估况如图 8-24(b) 所示。因此， RSVP 协议是面向终点的。 ，I店要注忍的是，路由器合并下游的 RESV 报文并不是把下游提出的预留数据率简单地 相加而是取其中较大的数们。例如，路由器凡收到两个预留 3 Mbit/s 的 RESV 报文，但凡 向 R2 发送的 RESV 报文只攷求预悄 3 Mb it/s 而不是 6 Mbit/s （囚为向下游方向发送数据是采 用可以节省带宽的多播技术）。同理， R3 向 R2 发送的 RESV 报文要求预留 100 kb it/s 而不是 150 kb it/s 。垃后， R1 向源点凡发送的 RESV 报文要求预衍 3 Mb it/s 。节 HI 收到返回的 RESV 报文后，就开始发送视频数据报文了。 • 396 •"}
{"doc_id": "network", "page": 408, "text": "丿，儿 50 kbit/s  源点 II, J. - ［一表示 PATH 报文） i儿 3 Mbit/ s ,_  3 Mbit/s  一t (a) 源点用多播发送 PATH 报文 [, H2 50 kb 哈 ．一1 源点 3 Mbil/ s R, 3 Mbil/ s  HI I 令_,  ，一1 [, H3 100 kbir.Js  （一＞及示 RESV 报文］ 一切• 3 Mbit/s  (b) 各终点向源点返回 RESV 报文 图 8-24 RSVP 协议的工作原理 ln t Serv/RSVP 使得互联网的体系结构发生了根本的变化，因为 ln tServ/RSVP 使得互联 网不再是提供“尽砐大努力交付＂的服务。在有关服务质舟的协议中， RSVP 是最复杂的。 ln t Serv/RSYP 所基千的概念是端系统中与分组流有关的状态倌息。各路由器中的预留信 息只存储有限的时间（这称为软状态 so ft -s tate), 因而各终点对这些预留信息必须定期进行 更新。我们还应注意到， RSVP 协议不是运输层协议而是网络层的控制协议。 RSVP 不携带 应用数据。图 8-25 给出了在路由器中实现的 ln t Serv 体系结构。 路由选抒协议 后台部分 前台部分 00 8-25 ln t Scrv 体系结构在路由器中的实现 In tServ 体系结构分为前台和后台两个部分。前台部分画在 F 面，包括两个功能块，即 分类器与分组转发，分组的调度器。每一个进入路由器的分组都要通过这两个功能块。后台 部分画在上面（有灰色阴影的部分），包括四个功能块和两个数据库。这四个功能块是： • 路由选择协议，负资维持路由选择数据库。由此可查找出对应千每一个目的地址和 每一个流的下一跳地址。 • RSVP 协议，为每一个流预留必要的资源，并不断地更新通信批控制数据库。 • 接纳控制，当一个新的流产生时， RSVP 就调用接纳控制功能块，以便确定是否有 足够的资源可供这个流使用。 • 397 •"}
{"doc_id": "network", "page": 409, "text": "管理代理，用来修改通们沁控制数据库和管理接纳控制功能块，包括设胃接纳控制 策略。 综合服务 ln tServ 体系结构存在的主耍问题是： {I) 状态信息的数量与流的数目成正比。例如，对千 OC-48 链路（ 2 .5 Gbit/s) 上的主干 网路由器，通过 64 kbit/s 的音频流的数 H 就超过 39000 个。如果对数据率再进行压缩，则流 的数目就更多。因此在大型网络中，按每个流进行资源预留会产生很大的开销。 (2) In t Serv 体系结构复杂。若婓得到有保证的服务，所有的路由器都必须装有 RSVP 、 接纳控制、分类器和调度器。这种路由器称为 RSVP 路由器。在应用数据传送的路径中只要 有一个路由器不是 RSVP 路由器，整个的服务就又变为“尽最大努力交付”了。 (3) 综合服务 In t Serv 所定义的服务质量等级数量太少，不够灵活。 .  8.4.4 区分服务 D iffS erv 1. 区分服务的基本概念 由于综合服务 ln t Serv 和资源预留协议 RSVP 都较复杂，很难在大规模的网络中实现， 因此 IETF 提出了一种新的策略，即区分服务 D iffS erv (Diff erentiated Services) [RFC 2475] 。 区分服务有时也简写为 DS 。因此，具有区分服务功能的节点就称为 DS 节点。 区分服务 DiffS erv 的要，I．I、}、如下： (I) D iffS erv 力图不改变网络的基础结构，但在路巾器中增加区分服务的功能。因此， DiffS erv 将 IP 协议中原有 8 位的 1Pv4 的服务类型字段和 1Pv6 的通信扭类字段重新定义为 区分服务 DS （如图 8-26 所示）。路由器根据 DS 字段的值来处理分组的转发。因此，利用 OS 字段的不同数值就可提供不同等级的服务质量。根据互联网的建议标准 [RFC 2474), OS  字段现在只使用其中的前 6 位，即区分服务码点 DSCP (Diff erentiated Servi ces CodePoint),  再后面的两位目前不使用，记为 CU (Currently Unused) 。因此中 OS 字段的值所确定的服务 质位实际上就足由 DS 字段中 DSCP 的值来确定的。 位 0 5 6 7  l I I I I I CP I I I I, u  DS- 图 8-26 区分服务码点 DSCP 占 DS 字段的前 6 位 在使用 OS 字段之前，互联网的 ISP 要和用户商定一个服务等级协定 SLA (Service Level  Agreement)。在 SLA 中指明了被义持的服务类别（可包括吞吐量、分组丢失率、时延和时 延抖动、网络的可用性等）和每｀类别所容许的通信桢． (2) 网络陂划分为许多个 DS 域 (DS Doma i n) 。一个 DS 域在一个管理实体的控制下实 现同样的区分服务策略。 D iffS erv 将所有的复杂性放在 DS 域的边界节点(boundary node) 中， 而使 DS 域内部路由器工作得尽可能简单。边界节点可以是主机、路由器或防火墙等。为了 简单起见，下而只讨论边界节点是边界路由器的情况（原理都是一样的）。图 8-27 给出了 DS 域、边界路由器(bounda ry rou t er) 和内部路由器(in t er i or rou ter) 的示意图。图中标有 B 的 路由器都是边界路由器。 • 398 •"}
{"doc_id": "network", "page": 410, "text": "俨，．，．，一腔旯｀｀ 边界路由器 一___ _I?..＄圾～｀、 ＇，＇，、、｀＇，＇，．， 二二勹户二二厂二三三：二 图 8-27 DS 域、边界路由器和内部路由器的示意图 (3) 边界路由器中的功能较多，可分为分类器（class ifi er) 和通信量调节器 (cond itio ner) 两 大部分。调节器又由标记器(marker) 、整形器(shaper) 和测定器(meter) 三个部分组成。分类器 根据分组首部中的一些字段（如源地址、目的地址、源端口、目的端口或分组的标识等）对 分组进行分类，然后将分组交给标记器。标记器根据分组的类别设置 DS 字段的值。以后在 分组的转发过程中，就根据 DS 字段的值使分组得到相应的服务。测定器根据事先商定的 SLA 不断地测定分组流的速率（与事前商定的数值相比较），然后确定应采取的行动，例如， 可重新打标记或交给整形器进行处理。整形器中设有缓存队列，可以将突发的分组峰值速率 平滑为较均匀的速率，或丢弃一些分组。在分组进入内部路由器后，路由器就根据分组的 DS 值进行转发。图 8-28 给出了边界路由器中各功能块的关系。 .、、`、... •·:::...............一... ····••..、· |，一． ．、、、～；立＇ 4 ＇,.,····','．，．一一 ．、·-.. 己一：，、 边界路由器 '···-.......内部路由器，···· ··'．，，边界路由器 （入口） ..................' （出口） |  ．一1 图 8-28 边界路由器中的各功能块的关系 (4) D iffS erv 提供了一种聚合(aggre gati on) 功能。 D iffS erv 不是为网络中的每—个流维持 供转发时使用的状态信息，而是把若干个流根据其 DS 值聚合成少世的流。路由器对相同 DS 值的流都按相同的优先级进行转发。这就大大简化了网络内部的路由器的转发机制。区 分服务 DiffS erv 不需要使用 RSVP 信令。 2. 每跳行为 PHB DiffS erv 定义了在转发分组时体现服务水平的每跳行为 PHB (Per-Hop Behav i or) 。所谓 “行为”就是指在转发分组时路由器对分组是怎样处理的。”行为＂的例子可以是：“首先转 发这个分组”或“最后丢弃这个分组”。\"每跳”是强调这里所说的行为只涉及本路由器转发 的这一跳的行为，而下一个路由器再怎样处理则与本路由器的处理无关。这和 lntServ/RSVP 考虑的服务质扯是“端到端＂的很不一样。 IETF 的 D iffS erv 工作组已经定义了两种 PHB, 即迅速转发 PHB 和确保转发 PHB 。 迅速转发 PHB (Expedited Forward ing PHB) 可记为 EF PHB, 或 EF [RFC 3246, 建议标 准］。 EF 指明离开一个路由器的通信址的数据率必须等于或大于某一数值。因此 EF PHB 用 • 399 •"}
{"doc_id": "network", "page": 411, "text": "来构造通过 DS 域的一个低丢失率、低时延、低时延抖动、确保带宽的端到端服务（即不排 队或很少排队）。这种服务对端点来说像点对点连接或“虚拟租用线”，又称为 Premi um （优 质）服务。对应千 EF 的区分服务码点 DSCP 的值是 IOlllO 。 确保转发 PHB (Assured Forwarding PHB)可记为 AFPHB 或 AF[RFC 2597, 建议标准）。 AF 用 DSCP 的第0~2 位把通信蜇划分为四个等级（分别为 001, 010, 011 和 100), 并给每 一种等级提供最低数扭的带宽和缓存空间。对于其中的每一个等级再用 DSCP 的第 3~5 位 划分出三个＂丢弃优先级＂ （分别为 010, 100 和 110, 从最低丢弁优先级到砐高丢弃优先级）。 当发生网络拥塞时，对千每一个等级的 AF, 路由器就首先把“丢弃优先级”较高的分组丢 弃。 从以上所述可看出，区分）服务 D iffS erv 比较灵活，因为它并没有定义特定的服务或服务 类别。当新的服务类别出现而旧的服务类别不再使用时， DiffS erv 仍然可以工作。 本章的重要概念 • 多媒体信息有两个巫要特点： （ I) 多媒体信息的信息阰往往很大： （ 2) 在传输多媒 体数据时，对时延和时延抖动均有较高的要求。在兀联网上传输多媒体数据时，我 们都是指含有“边传输、边播放”的特点。 • 由多媒体信息构成的分组在发送时是等时的。这些分组在到达接收端时就变成为非 等时的。当接收端缓存中的分组数达到一定的数蛋后，再以恒定速率按顺序将这些 分组进行还原播放。这样就产生了播放时延，同时也可以在很大程度上消除时延的 抖动。 • 在传送时延敏感的实时数据时，传输时延和时延抖动都必须受到限制。通常宁可丢 失少贷分组，也不要接收太晚到达的分组。 • 目前互联网提供的音频／视频服务有三种类型： （ l) 流式存储音频／视频，用户通过 互联网边下载、边播放。 (2) 流式实况齿频／视频，其特点是在发送方边录制、边 发送，在接收时也是婓求能够连续播放。（ 3) 交互式音频／视频，如互联网电话或 互联网屯视会议。 • 流媒体(s treaming med i a) 就是流式音频／视频，其特点是边下载、边播放。若使用专 门的软件，则可将其｛＋储在硬盘上成为用户的文件。 • 媒体服务器（或称为流式服务器）可以更好地支持流式音频和视频的传送。 TCP 能够保证流式音频／视频文件的播放质位，但开始播放的时间要比请求播放的时间 滞后一些（必须先在缓存中存储一定数杂的分组）。对千实时流式音频／视频文件的 传送则应当选用 UDP. • 实时流式协议 RTSP 是为了给流式过程增加更多功能而设计的协议。 RTSP 本身并 不传送数据，而仅仅足使媒体播放器能够控制多媒体流的传送。 RTSP 又称为“互 联网录像机遥控协议”。 • 狭义的 IP 电话是指杆 IP 网络上打电话。广义的 IP 电话则不仅是电话通信，而且 还可以在 lP 网络上进行交互式多媒体实时通信（包括话音、视像等），甚至还包括 即时传信 lM （如QQ和 Skype 等）。 • IP 电话的通话质桢主要由两个因素决定： （ I) 通话双方端到端的时延和时延抖 动： （ 2) 话音分组的丢失率。但这两个因素都是不确定的，而是取决于当时网 • 400 •"}
{"doc_id": "network", "page": 412, "text": "络上的通信世。 • 实时运输协议 RTP 为实时应用提供端到端的运输，但不提供任何服务质批的保证。 需要发送的多媒体数据块（音频／视频）经过压缩编码处理后，先送给 RTP 封装成 为 RTP 分组，装入运输层的 UDP 用户数据报后，再向下递交给 IP 层。可以把 RTP 看成是在 UDP 之上的一个运输层子层的协议。 • 实时运输拧制协议 RTCP 是与 RTP 配合使用的协议。 RTCP 协议的主要功能是：服 务质员的监视与反馈，媒体间的同步，以及多播组中成员的标志。 RTCP 分组也使 用 UDP 来传送，但 RTCP 并不对音频／视频分组进行封装。 • 现在 IP 电话有两套估令标准。一套是 ITU-T 定义的 H.323 协议，另一套是 IETF 提出的会话发起协议 SIP. • H.323 不是一个单独的协议而是一组协议。 H.323 包括系统和构件的描述、呼叫模型 的描述、呼叫信令过程、拧制报文、复用、话音编解码器、视像编解码器，以及数 据协议等。H. 323 标准的四个构件是： ( I) H.323 终端： （ 2) 网关： （ 3) 网闸； （4) 多 点控制单元 MCU 。 • 会话发起协议 SIP 只涉及 lP 电话所需的信令和有关服务质址的问题。 SIP 使用文 本方式的客户服务器协议。 SIP 系统只有两种构件，即用户代理（包括用户代理客 户和用户代理服务器）和网络服务器（包括代理服务器和重定向服务器）。 SIP 的 地址十分灵活，它可以是电话号码，也可以是电子邮件地址、 IP 地址或其他类型 的地址。 • 服务质扭QoS 是服务性能的总效果，此效果决定了一个用户对服务的满意程度。 因此，有服务质扭的服务就是能够满足用户的应用需求的服务。或者说，可提供一 致的、可预计的数据交付服务。 • 服务质揽可用若干基本的性能指标来描述，包括可用性、差错率、响应时间、吞吐 豐、分组丢失率、连接建立时间、故陷检测和改正时间等。服务提供者可向其用户 保证某一种等级的服务质量。 • 为了使互联网具有一定的服务质址，可采取以下一些措施： （ I) 分类，如区分服务； (2) 管制； （ 3) 调度； （ 4) 呼叫接纳； （ 5) 加权公平排队等． • 综合服务 In t Serv 可对单个的应用会话捉供服务质揽的保证，它定义了两类服务， 即有保证的服务和受控负载的服务。 ln t Serv 共有以下四个组成部分，即（ 1) 资源预 留协议 RSVP: (2) 接纳控制： （ 3) 分类器； （ 4) 调度器。 • 区分服务 D iffS erv 在路由器中增加区分服务的功能，把 IP 协议中原有的服务类型 字段重新定义为区分服务 DS ，利用 DS 字段的不同数值提供不同等级的服务质址。 Dift'S erv 将所有的复杂性放在 DS 域的边界节点中，而使 DS 域内部路由器工作得 尽可能地简单。 DiffS erv 定义了在转发分组时体现服务水平的每跳行为 PHB, 包括 EF 和 AF, 即迅速转发 PHB 和确保转发 PHB 。 习题 8-01 音频／视频数据和普通的文件数据都有哪些主要的区别？这些区别对音频／视频数据在 互联网上传送所用的协议有哪些影响？既然现有的电信网能够传送音频／视频数据， 并且能够保证原护，为什么还要用互联网来传送音频／视频数据呢？ • 401 •"}
{"doc_id": "network", "page": 413, "text": "8-02 端到端时延与时延抖动有什么区别？产生时延抖动的原因是什么？为什么说在传送 音频／视频数据时对时延和时延抖动都有较高的要求？ 8-03 目前有哪几种方案改造互联网，使互联网能够适合千传送音频／视频数据？ 8-04 实时数据和等时的数据是一样的意思吗？为什么说互联网是不等时的？实时数据都 有哪些特点？试说明播放时延的作用。 8-05 流式存储音频／视频、流式实况音频／视频和交互式音频／视频都有何区别？ 8-06 媒体播放器和媒体服务器的功能是什么？请用例子说明。媒体服务器为什么又称为 流式服务器？ 8-07 实时流式协议 RTSP 的功能是什么？为什么说它是个带外协议？ 8-08 狭义的 IP 电话和广义的 IP 电话都有哪些区别？ IP 电话都有哪几种连接方式？ 8-09 IP 电话的通话质量与哪些因素有关？影响 IP 电话话音质量的主要因素有哪些？为什 么 IP 电话的通话质蜇是不确定的？ 8-10 为什么 RTP 协议同时具有运输层和应用层的特点？ 8-11 RTP 协议能否提供应用分组的可靠传输？请说明理由。 8-12 在 RTP 分组的首部中为什么要使用序号、时间戳和标记？ 8-13 RTCP 协议使用在什么场合？ RTCP 使用的五种分组各有何主要特点？ 8-14 IP 电话的两个主要信令标准各有何特点？ 8-15 携带实时音频信号的固定长度分组序列发送到互联网。每隔 10 ms 发送一个分组。前 10 个分组通过网络的时延分别是 45 ms, 50 ms, 53 ms, 46 ms, 30 ms, 40 ms, 46 ms, 49 ms,  55 ms 和 51 ms 。 (1) 用图表示出这些分组发出时间和到达时间。 (2) 若在接收端还原时的端到端时延为 75 ms, 试求出每一个分组在接收端缓存中应 增加的时延。 (3) 画出接收端缓存中的分组数与时间的关系。 8-16 话音信号的采样速率为 8000 Hz 。每隔 10 ms 将已编码的话音采样装配成话音分组。 每一个话音分组在发送之前要加上一个时间戳。假定时间戳是从一个时钟得到的， 该时钟每隔 A 秒将计数器加 1 。试间能否将 A 取为 9 ms? 如果行，请说明理由。如 果不行，你认为 A 应取为多少？ 8-17 在传送音频／视频数据时，接收端的缓存空间的上限由什么因素决定？实时数据流的 数据率和时延抖动对缓存空间上限的确定有何影响？ 8-18 什么是服务质屈QoS? 为什么说“互联网根本没有服务质扯可言”? 8-19 在讨论服务质从时，管制、调度、呼叫接纳各表示什么意思？ 8-20 试比较先进先出 (FIFO) 排队、公平排队(F Q)和加权公平排队 (WFQ)的优缺点。 8-21 假定有一个支持三种类别的缓存运行加权公平排队 WFQ的调度策略，并假定这三种 类别的权护分别是 0.5, 0.25 和 0.25 。如果是采用循环调度，那么这三个类别接受服 务的顺序是 123123123···· (I) 如果每种类别在缓存中都有大揽的分组，试问这三种类别的分组可能以何种顺序 接受服务？ (2) 如果第 1 类和第 3 类在缓存中有大械的分组，但缓存中没有第 2 类的分组，试问 这两类分组可能以何种顺序接受服务？ • 402 •"}
{"doc_id": "network", "page": 414, "text": "8-22 漏桶管制器的工作原理是怎样的？数据流的平均速率、峰俏速率和突发长度各表示 什么意思？ 8-23 采用漏桶机制可以控制达到某一数值的、进入网络的数据率的持续时间。设漏桶最 多可容纳 b 个权标(token）。当油桶中的权标数小千 b 个时，新的权标就以每秒 r 个权 标的恒定速率加入到漏桶中。设分组到达速率为 N pkt/ s (p kt代表分组），试推导以 此速率进入网络所能持续的时间 T。讨论一下为什么改变权标加入到涌桶中的速率就 可以控制分组进入网络的速率。 8-24 在上题中，设 b = 250 token, r = 5000 token / s, N = 25000 pkt / s 。试求分组用这样的 速率进入网络能够持续多长时间。若 N = 2500 pkt / s, 觅新计算本题。 8-25 试推导公式(8-2) 。 8-26 假定图 8-23 中分组流 1 的漏桶权标装入速率 r1 < Rw1 I (t w;), 试证明： （ 8-2) 式给出的 drn缸实际上是分组流 1 中任何分组在 WFQ队列中所经受的最大时延。 8-27 考虑 8 .4 .2 节讨论的管制分组流的乎均速率和突发长度的涌桶管制器。现在我们限制 其峰值速率p pkt / s 。试说明怎样把一个漏桶管制器的输出流入到第二个涌桶管制器 的输入，以便用这样串接的两个漏桶能够管制分组流的平均速率、峰值速率以及突 发长度。第二个油桶的大小和权标产生的速率应当是怎样的？ 8-28 综合服务 IntServ 由哪几个部分组成？有保证的服务和受控负载的服务有何区别？ 8-29 试述资源预留协议 RSVP 的工作原理。 8-30 区分服务 D iffS erv 与综合服务Jn t Serv 有何区别？区分服务的工作原理是怎样的？ 8-31 在区分服务 DiffS erv 中的每跳行为 PHB 是什么意思？ EF PHB 和 AF PHB 有何区别？ 它们各适用千什么样的通信伉？ 8-32 假定一个发送端向 2” 个接收端发送多播数据流，而数据流的路径是一个完全的二叉 树，在此二叉树的每一个节点上都有一个路由器。若使用 RSVP 协议进行资源预留， 问总共要产生多少个资源预留报文 RESV （有的在接收端产生，也有的在网络中的路 由器产生） ?  8-33 假定 IP 电话的发送方在讲话时，每秒钟产生 8000 字节的话音数据。每隔 20 亳秒把 得到的数据块加上 RTP 首部和 UDP 首部后，交给 IP 层发送出去。假定 RTP 首部和 IP 首部都没有选项。试计笃发送方在发送这种 IP 数据报时的数据率 (kb it/s) 。这个 数据率比原始的话音数据率增加了百分之多少？ 8-34 如图 8-29 所示，发送方在t = I 发送话音分组 8 个（等时发送，时间间隔是一个时间 单位）。第 1 个分组在t = 8 到达接收方。后续的话音分组的到达时间如图 8-29 所示。 (I)分组 2 到分组 8 的时延（从发送方到接收方）各为多少？ (2) 如果接收方在t =8 就开始播放，试问这 8 个分组中有哪几个未能按时到达赶上 播放？ (3) 如果要所有的 8 个分组都能按时赶上播放，那么接收方应在什么时间开始播放？ • 403 •"}
{"doc_id": "network", "page": 415, "text": "数组r 夕 上8765432  l 2 3 4 5 6 7 8 9 lO l l l2 l3 l4 l5 l6  图 8-29 习题 8.34 的图 8-35 有一个 RTP 会话包括四个用户，他们都和同一个多播地址进行通信：发送和接收分 组。每个用户发送视频的速率是 100 kb it/s 。 (1) RTCP 的通信批将被限制在多少(kb it/s)? (2) 每一个用户能够分配到的 RTCP 带宽是多少？ 8-36 在图 8-7 中，客户机的应用程序缓存容掀为 100 Mb it。假定只要当应用程序缓存没有 存满数据， TCP 接收缓存就要向应用程序缓存传送视频数据，并且数据率是 2 Mbit/s,  而播放器从应用程序缓存读取数据的速率是 3 Mbit/s 。当应用程序缓存所存储的数据 达到 30 Mbit时，播放器就开始从应用程序缓存中读取数据，开始播放视频。 (I) 播放器福放多少时间后就暂停了（无数据可读取了） ？暂停多久后才能继续播放？ (2) 现在把假定条件改变一个，即把 TCP 接收缓存向应用程序缓存传送视频数据的数 据率改为 4 Mb it/s 。试计算从 TCP 接收缓存向应用程序缓存传送数据开始，然后 播放器播放视频，到应用程序缓存存满了数据为止，总共花费多少时间？ • 404 •"}
{"doc_id": "network", "page": 416, "text": "第 9 章无线网络和移动网络 近几十年来，无线蜂窝电话通信技术得到了飞速发展。现在移动电话数已经超过了发 展历史达一百多年的固定电话数。据 lTU 的统计，在 2015 年，全世界移动电话的普及率 已达到 96.8% [W-ITU], 大大超过了当时固定电话 14.5 ％的普及率。据工信部 2020 年上半年 的统计，我国的移动电话用户已超过 15.9 亿户，也大大超过了固定电话的用户数1. 88 亿户 （固定电话的总数仍在逐年下降）。 对移动通信的这种需要也必然反映到计算机网络中。人们也希望能够在移动中使用计 算机网络。如果说，互联网在过去曾是 PC 互联网，那么现在就应当是移动互联网了。 由于无线网络和移动网络的数据链路层与传统的有线互联网的数据链路层相差很大， 因此有必要单列一章来讨论这个问题。 本菜先讨论无线局域网 WLAN, 其重点是无线局域网 MAC 层协议载波监听多点接入／ 碰撞避免 CSM A/CA 的原理接若对无线个人区域网 WPAN 和无线城域网 WMAN 进行简 单的介绍；最后简要介绍一下蜂窝移动通信网。本来，这种蜂窝移动通信网属于通信领域的 内容，与计算机网络并无关联。但是随着技术的发展，情况发生了根本的变化：蜂窝移动通 信网已演进到全部使用 lP 技术。按照计钵机网络对主机的定义，现在的智能手机已经变成 了计算机网络上的主机。因此在本书中也应对无线蜂窝通信网进行适当的介绍。 本章最瘟要的内容是： (I) 无线局域网的组成，特别是分配系统 OS (Distribution S ys t em)和接入点 AP (Access  Poi n t)的作用。 (2) 无线局域网使用的 CSMA/CA 协议（弄清与载波监听多点接入／碰撞检测 CSMA/CD 的区别）和无线局域网 MAC 帧使用的几种地址。 (3) 蜂窝移动通信网的基本概念以及与互联网互连的方法。 9.1 无线局域网 WLAN 在局域网刚刚问世后的一段时间，无线局域网的发展比较缓慢，原因是价格贵、数据 传输速率低、安全性较差，以及使用登记手续复杂（使用无线电频率必须得到有关部门的批 准）。但自 20 世纪 80 年代末以来，由千人们工作和生活节奏的加快以及移动通信技术的飞 速发展，无线局域网也就逐步进入市场。无线局域网提供了移动接入的功能，这就给许多需 要发送数据但又不能坐在办公室的工作人员提供了方便。当一个工厂跨越的面积很大时，若 要将各个部门都用电缆连接成网，其费用可能很高；但若使用无线局域网，不仅节省了投资， 而且建网的速度也会较快。另外，当大量持有便榄式计算机的用户在一个地方同时要求上网 时（如在图书馆或股票交易大厅里），若用电缆连网，恐怕连铺设电缆的位置都很难找到。 而用无线局域网则比较容易。由于手机普及率日益增高，通过无线局域网接入到互联网已成 为当今上网最常用的方式。无线局域网常简写为 WLAN (Wireless Local Area Network) 。 诸读者注意，便携站（po rtable s ta ti on) 和移动站(mobi le s ta ti on) 表示的意思并不一样。便 • 405 •"}
{"doc_id": "network", "page": 417, "text": "携站当然是便于移动的，但便携站在工作时其位仅是固定不变的。而移动站不仅能够移动， 而且还可以在移动的过程中进行通信（正在进行的应用程序感觉不到计仅机位置的变化，也 不因计符机位贸的移动而中断运行）。移动站一般使用电池供电。 9.1.1 无线局域网的组成 无线局域网可分为两大类。第一类是有基础设施的，第二类是无基础设施的。本章主 要介绍第一类无线局域网。 1. IEEE 802.11  对于第一类有基础设施的无线局域网， 1997 年 IEEE 制定出无线局域网协议 802.11 系列 标准。 2003 年 5 月，我国颁布了 WLAN 的国家标准，该标准采用 ISO/IEC 8802-11 系列国际 标准，并针对 WLAN 的安全问题，把国家对密码算法和无线电频率的要求纳入了进来。它 是基千国际标准的符合我国安全规范的 WLAN 标准，是屈于国家强制执行的标准。该国标 在 2004 年 6 月已经正式执行，不符合此标准的 WLAN 产品将不允许出现在国内市场上。 802. l l 是个相当复杂的标准。但简单地说， 802.11 就是无线以太网的标准，它使用星形 拓扑。无线局域网的中心叫作接入点 AP (Access Po i nt),它是尤线局域网的基础设施，也是 一个链路层的设备。接入点 AP 也叫作无线接入点 WAP (Wireless Access Poi n t)。所有在无线 局域网中的站点，对网内或网外的通信，都必须通过接入点 AP 。现在的无线局域网的接入 点 AP 往往具有 100 Mb it/ s 或 I Gb it/s 的端口，用来连接到有线以太网。家庭使用的无线局 域网接入点 AP, 为了方便居民上网，就把 IP 层的路由器的功能也嵌入进来。因此家用的接 入点 AP 往往又称为无线路由器（直接用网线连接到家中墙上的 RJ -45 插孔即可）。但企业 或机构使用的接入点 AP 还是和路由器分开的。 802.11 无线局域网的 MAC 层使川 CSM A/CA 协议（在后面的 9. 1.3节讨论）。现在 802.11 系列标准的无线局域网常称为 Wi -F i。曾经广为流传的 “Wi-氏是 Wi reless-F i del ity的 缩写“其实是错误的（本书的前几个版本也曾这样写过）。这点在 Wi -F i的官网可以查到 [W­ Wi F i]。 Wi -F i是非茸利性国际组织 Wi -F i联盟 (Wi -F i All i ance) 的一个标记。 Wi -F i联盟对通过 其互橾作性测试的产品就发给这样的注册商标。Fi，表明是经过 Wi -F i联盟认证的。从 2000 年起到 2020 年，全球有 Wi -F i注册商标认证的产品已超过 150 亿个。 Wi -F i的写法并 无统一规定，如 Wifi, Wifi, Wi-fi等都能在文献中见到。 802.11 标准规定无线局域网的砐小构件是基本服务集 BSS (Basic Service Set)。一个基本 服务渠 BSS 包括～个接入点和若干个移动站（这里所说的移动站，也可包括不经常搬动的台 式电脑。这种电脑的主板上都装有 Wi -F i适配器）。各站在本 BSS 以内之间的通信，或者与外 部站点的通信，都必须通过木 BSS 的搂入点。当网络管理员安装 AP 时，必须为该 AP 分配 一个不超过 32 字节的服务集标识符 SSID (Serv ice Set !Den tifi er)” 和一个通信信道。 SSID 就 是指使用该 AP 的无线局域网的名字。 SSID 使用字符串而不使用二进制数字的理由就是字 U) i 1今：例如．对 1 使用 Wi ndo认 s 10 的计＂机． 1呻“开始”一”\\Vindows 系纹”-“控制（旬板”一“网络和 lnleme广 -“网络和共亨小心” , 下面 h ：个达 1贞，点击“让j名到网络＂，就可以 6 见在每个儿线局城网的iu ，盖位出内的网络名 SSID. 这些网络名可以山设各 AP 的生产J京攸先给出，也可以山 1',J战网的竹开员更改为另外的名字。 • 406 •"}
{"doc_id": "network", "page": 418, "text": "符串便于记忆。—个基本服务集 BSS 所覆盖的地理范围叫作一个基本服务区 BSA (Basic  Service Area) 。基本服务区 BSA 和无线移动通信的蜂窝小区相似。无线局域网的基本服务区 BSA 的范围直径一般不超过 100 米。我们知道，在网络通信中，链路层设备的唯一标志是 其 MAC 地址。接入点 AP 在出厂时就已有了一个唯 的 48 位二进制数字的 MAC 地址，其 正式名称是基本服务集标识符 BSSID 。在无线局域网中传送的各种帧的首部中，都必须有 节点的 MAC 地址（即 BSSID, 但不是 SSID) 。请不要把 BSSID 和 SSlD 弄湿。用户通常都 知道所连接的无线局域网的名 SSTD, 但可以不知道其 MAC 地址 BSSID 。 现在简单介绍一下无线局域网所用的信道(channel) 的概念。无线局域网通常使用的频段 是 2 .4 GHz 和 5 GHz 频段。每一个频段又再划分为若干个信道，供各无线局域网使用。例 如，在 2 .4 GHz 频段中有大约 85 MHz 的带宽可用。 802.11 b 标准定义了 11 个部分重叠的信 道集。相邻信道的中心频率相差 5 MHz, 而每个信道的带宽约为 22 MHz 。因此，仅当两个 信道由四个或更多信道隔开时它们彼此才无重叠。其中，信道 I, 6 和 11 的媒合是唯一的三 个非重叠信道的集合。现在已经广泛使用的无线路由器就是典型的接入点设备，并且在出厂 时就预先设置了 SSID 和使用的信道（用户也可以自行更改）。例如，当发现附近的接入点 使用的频道对自己有干扰时，就可以重新设置本服务集接入点的工作信道。 一个基本服务集可以是孤立的单个服务集，也可通过接入点 AP 连接到一个分配系统 DS (Distribution Sy s t em), 然后再连接到另一个基本服务集，这样就构成了一个扩展服务集 ESS (Extended Service Se t)。 ESS 也有个标识符，是不超过 32 字符的字符串名字而不是地址， 叫作扩展服务集标识符 ESSID （如图 9-1 所示）。分配系统的作用就是使扩展的服务集 ESS 对上层的表现就像一个基本服务集 BSS 一样。分配系统可以使用以太网（这是最常用的）、 点对点链路或其他无线网络。扩展服务媒 ESS 还可为无线用户提供到 802.x 局域网（也就是 非 802.11 无线局域网）的接入。这种接入是通过叫作门户（po rtal) 的设备来实现的。门户是 802]] 定义的新名词，其实它的作用就相当于一个网桥。在一个扩展服务集内几个不同的基 本服务集也可能有相交的部分。图 9-1 中的移动站 A 如果要和另一个基本服务共中的移动 站 B 通信，就必须经过两个接入点 AP1 和 AP2, 即 A － AP1 一 AP2....B 。我们应当注总到，在 图 9-1 的例子中，从凡＼到 A 凡的通信是使用有线传输的。 至其他 802x 分配系统 DS ．，．．．．．．．应戾回＿ ＿豆］．．． l ．.......今......-=-===--······.,.......... ;·' 扩展服务渠 ESS \\: ？心了一;::<~:::; 言凇；1 < r,）．．．心｀谕．．．．－从飞｀｀ 工三飞至 基冒勹詈 ········································-·······················''''.、··--······、已\"\"················· 图 9-1 IEEE 802.11 的基本服务渠 BSS 和扩展服务渠 ESS 我们还应注意到，图 9-1 所示的两个基本服务桀的覆盖范围有重合的地方。为了避免在 这种重合的地方出现不同信道的相互干扰，这两个接入点所选择的工作信道，必须相隔 5 个 或更多的信道。 图 9-1 画出了移动站 A 漫游的情况。但移动站 A 漫游到图中的位置 A1 时，就能够同时 • 407 •"}
{"doc_id": "network", "page": 419, "text": "收到两个接入点的信号。这时，移动站 A 可以选择和信号较强的一个接入点联系。当移动 站漫游到位置 A2 时，就只能和接入点 AP2 联系了。移动站只要能够和其中一个接入点联系 上，就一直可保持与另一个移动站 B 的通信。基本服务媒的服务范围是由移动站所发射的 电磁波的辐射范围确定的。在图 9-1 中用一个虚线椭圆来表示基本服务区的范围。由于实际 地形条件可能是多种多样的，一个服务区的覆盖范围可能是很不规则的几何形状。 802. ll 标准并没有定义如何实现漫游，但定义了一些基本的工具。例如，一个移动站若 要加入一个基本服务集 BSS, 就必须先与某个接入点 AP 建立关联(associ a ti on) 。建立关联就 表示这个移动站加入了选定的 AP 所屈的子网，并和这个接入点 AP 创建了一个虚拟线路。 只有已关联的 AP 才向这个移动站发送数据帧，而这个移动站也只有通过关联的 AP 才能向 其他站点发送数据帧。这和手机开机后必须和附近的某个基站建立关联的概念是相似的。 移动站与接入点 AP 建立关联的方法有两种。一种是被动扫描（如图 9-2(a) 所示），其过 程如下： 0 接入点 AP 周期性发出（例如每秒 10 次）信标帧(beacon frame), 其中包含有若干系 统参数（如服务集标识符 SS[D 以及支持的速率等）。图 9-2(a) 表示移动站 A 收到了两个接 入点发出的信标帧。 0 移动站 A 扫描 ll 个信道，选择厄意加入接入点 AP2 所在的基本服务渠 BSS2, 于是 向 AP2 发出关联请求帧(Assoc i ati on Request frame) 。 0 接入点 AP2 同意移动站 A 发来的关联请求，向移动站 A 发送关联响应帧(Assoc i ati on Response frame) 。 这样，移动站 A 和接入点 AP2 的关联就建立了。 ,',;,'.:'  、、,',' \\,','  、、 、 .2,', 、、.p,' A,'  f、、勺，一.SSl` 。- B;`@  ,'',1,'.  BSs\\ -',,$、`',,Pl 、、一 ',''A\\  ,',·  ,','  ＇，＇｀、 ,·1,· `  ,','.  、、＇，＇ 、＇、，． ,'  、',' ｀、贮妒，，． 、｀ ,.  ..A 一 ..  蕊竺:`.0, ．，尽 .、,''`、、.', :',',!·2, 、 1 、 •.  SSI`o\\° ·}覃}、·}.B 了},、 ＇，、、',Pl 、、 ',:A, 、`、 ：＇，＇、 矿，＇｀、 ',',、,·· (b)  图 9-2 被动扫描(a) 与主动扫描(b) 另一种建立关联的方法是主动扫描（如图 9-2 (b)所示），其步骤如下： 0 移动站 A 主动发出广播的探测请求帧（ Probe Request frame), 让所有能够收到此帧的 接入点都能够知道有移动站要求建立关联（见图 9-2(b) 中的多个虚线箭头）。 e 现在两个接入点都回答探测响应帧(Probe Response frame) 。 0 移动站 A 向 AP2 发出关联请求帧。 0 接入点 AP2 向移动站 A 发送关联响应帧，与移动站 A 建立了关联。 为了使一个基本服务媒 BSS 能够为更多的移动站提供服务，往往在一个 BSS 内安装有 多个接入点 AP 。有时一个移动站也可以收到本服务集以外的 AP 信号。移动站只能在多个 AP 中选择一个建立关联。通常可以选择信号最强的一个 AP 。但有时也可能该 AP 提供的信 道都已被其他移动站占用了。在这种情况下，也只能与信号强度稍差些的 AP 建立关联。 此后，这个移动站就和选定的 AP 互相使用 802.11 关联协议进行对话。移动站点还要 • 408 •"}
{"doc_id": "network", "page": 420, "text": ",  mTE`,4 、J .I, J.一 ••  I),.,,',' 、,'.'·',',, ..  ,··111', j  向该 AP 鉴别自身。现在的接入点 AP 在出厂时就已经嵌入了 DHCP 模块。因此在关联建立 后，移动站点通过关联的 AP 向该子网发送 DHCP 发现报文就可以获取 TP 地址。这时，互 联网中的其他部分就把这个移动站当作该 AP 子网中的一台主机。 若移动站使用重建关联（reassoc i ati on) 服务，就可把这种关联转移到另一个接入点。当使 用分离（小ssoc i a ti on)服务时，就可终止这种关联。 一个移动站可以同时进行主动扫描和被动扫描，这样可以更加迅速地和 AP 建立关联。 802.11 标准没有规定移动站应选择哪一种扫描方式。但很多移动站愿意使用被动扫描，这样 可以节省移动站的电源功率消耗。 现在许多地方，如办公室、机场、快餐店、旅馆、购物中心等都能够向公众提供有偿 或无偿接入 Wi -F i的服务。这样的地点就叫作热点(ho t s p o t)。由许多热点和接入点 AP 连接 起来的区域叫作热区(ho t zone) 。热点也就是公众无线入网点。 由千无线局域网已非常普及，因此现在无论是智能手机、智能电视机或计算机，其主 板上都已经有了内置的无线局域网适配器，能够实现 802.11 的物理层和 MAC 层的功能。只 要在无线局域网信号覆盖的地方，用户就能够通过接入点 AP 连接到互联网。 无线局域网用户在和附近的接入点 AP 建立关联时，一般还要键入用户口令。键入正确 后，才能和在该网络中的 AP 建立关联。在无线局域网发展初期，这种接入加密方案称为 WEP (Wired Equivalent Pr i vac y,意思是“有线等效的保密＂），它曾经是 1999 年通过的 IEEE 802. 1 1 b 标准中的一部分。然而 WEP 的加密方案有安全漏洞，因此现在的无线局域网 普遍采用了保密性更好的加密方案 WPA (W iFi Protected Access, 意思是“无线局域网受保 护的接入“)或其第二个版本 WPA2 。现在 WPA2 是 802.1 ln 中强制执行的加密方案，微软 的 Wi ndows 10 支持 WPA2 。这表明只有在电脑屏幕上弹出的口令窗口键入正确的口令后， 才能与其 AP 建立关联。 2. 移动自组网络 另一类无线局域网是无固定基础设施的无线局域网，它又叫作自组网络 (ad hoc  ne twork)w 。这种自组网络没有士述基本服务集中的接入点 AP, 而是由一些处于平等状态的 移动站相互通信组成的临时网络（如图 9-3 所示）。图中还画出了当移动站 A 和 E 通信时， 经过 A-+B, B 一 C, C-D 和最后 D-E 这样一连串的存储转发过程。因此，在从源节点 A 到 目的节点 E 的路径中，移动站 B, C 和 D 都是转发节点，这些节点都具有路由器的功能。由 于自组网络没有预先建好的网络固定基础设施（基站），因此自组网络的服务范围通常是 受限的，而且自组网络一般也不和外界的其他网络相连接（当然也不能接入到互联网）。 移动自组网络也就是移动分组无线网络。 自组网络通常是这样构成的：一些可移动的设备发现在它们附近还有其他的可移动设 备，并且要求和其他移动设备进行通信。随着便携式电脑和智能手机的普及，自组网络的组 (i)注·拉丁语 ad hoc 木来的意思是＂仅为此目的(for 1his purpose onl y)'',并且通常还有“临时的“含义，译成中文就是 “特定的＂．宜译 ad hoc ncrwork 就是“特定网络＇．．但由于这种网络的组成并不袖耍使用固定的基础设施，因此可意译为“自组 网络＂．表明不祈要固定基站而仅依靠移动站自身就能组成网络。 • 409 •"}
{"doc_id": "network", "page": 421, "text": "网方式已受到人们的广泛关注。由于在自组网络中的每一个移动站，都要参与到网络中其他 移动站的路由的发现和维护，同时由移动站构成的网络拓扑有可能随时间变化得很快，因此 在固定网络中行之有效的一些路由选择协议对移动自组网络已不适用。这样，在自组网络中 路由选择协议就引起了特别的关注。另一个重要问题是多播。在移动自组网络中往往需要将 某个重要信息同时向多个移动站传送。这种多播比固定节点网络的多播要复杂得多，需要有 实时性好而效率又高的多播协议。在移动自组网络中，安全问题也是一个更为突出的问题。 转发节点 转发节点 轧飞节点｀｀一二飞目的i1 点 、．．·．．．．．心；足．．······,' 源节点·································· 图 9.3 山处千平等状念的一些便携机构成的 r, 组网络 移动自组网络在军用和民用领域都有很好的应用前崇。在军事领域中，由千战场上往 往没有预先建好的固定接入点，其移动站就可以利用临时建立的移动自组网络进行迪估。这 种组网方式也能够应用到作战的地面车辆群和坦克群，以及治i上的舰艇群、空中的机群。由 于每｀个移动设备都具有路由器转发分组的功能，闪此分布式的移动自组网络的生存性非常 好。在民用领域，持有笔记本电脑的人可以利用这种移动自组网络方便地交换信息，而不受 便携式电脑附近没有电话线插头的限制。当出现自然灾害时，在抢险救灾时利用移动自组网 络进行及时通信往往也是很有效的，因为这时事先已建好的网络基础设施（基站）可能都已 经被破坏了。 近年来，移动自组网络中的一个f集一无线传感器网络 WSN (Wireless Sensor  Network) 引起了人们广泛的关注。无线传感器网络是由大雇传感器节点通过无线通估技术构 成的自组网络。无线传感器网络的应用就是进行各种数据的采渠、处理和传输，一般井不需 要很茼的带宽，但是在大部分时间必须保持低功耗，以节省电池的消耗。由于无线传感节点 的存储容扯受限，因此对协议栈的大小有严格的限制。此外，无线传感器网络还对网络安全 性、节点自动配仅、网络动态重组等方面有一定的要求。 据统计，全球 98％的处理器并不在传统的计算机中，而是处在各种家电设备、运输工 具以及工厂的机器中。如果在这些设备上能够嵌入合适的传感器和无线通信功能，就可能把 数位极大的节点连接成分布式的传感器无线网络，因而能够实现连网计符和处理。 图 9-4 是典型的传感器节点的组成，它的主耍构件包括 CPU 、存你器、传感器硬件、 无线收发器和电池。 无线传感器网络中的节点基本上是困定不变的，这点和移动自组网络有很大的区别。 无线传感器网络上要的应用领城就是组成各种物联网 IoT (Internet of Th i n g s) 。下面是物联网 的一些举例： (I) 环境监测与保护（如洪水预报、动物栖息的监控）： (2) 战争中对敌情的侦究和对兵力、装备、物资等的监控： • 410 •"}
{"doc_id": "network", "page": 422, "text": "＠巴芦品 存储｝片1 门门］1霄 图 9-4 伈感监甘．点的上＇畟构件 (3) 医疗中对病历的监割和对患者的护理： (4) 在危险的工业坏境（如矿井、核电站笘）中的安全监测： (5) 城市交迪管狸、建筑内的温度／照明／安全控制等。 关J：：无线传感器网络更详细的内容可参阅［COMM02] 。 顺便指出，移动自组网络和移动 IP 并不相同。移动 IP 技术使漫游的主机可以用多种方 式连拨到互联网。漫游的主机可以直桵连接到或通过无线链路连接到固定网络上的另·个子 网。支从这种形式的主机移动性需要地址管狸和增加协议的杠橾作性，但移动 IP 的核心网 络功能仍然是从 F 在固定互联网中～ 1'i在使川的各种路由选择协议。但移动自组网络是把移 动性扩展到无线领坡中的自治系统，它具有 (I 己特定的路巾选择协议，并且可以不和兀联网 相连。即使仆和互联网相连时，移动门组网络也是以末梢网络{s t ub ne t work) 力式工作的。所 谓“术梢网络”就是迪们捂 IlI 以进入术梢网络，也可以从末梢网络发出，但不允许外部的通 信业穿越未梢网络。 垃后需婓片清在文献中纾常要遇到的、与搂入有关的几个名词。 固定接入(fi xed access) 一（［作为网络用户期间，用户设四的地理位驾保持不变。 移动接入(mob i l ity access ）一—用户设备能够以车辆速度（．般取为 120 k m/11) 移动时进 行网络迪信。、 ''1 发生切换（即川户移动到不同蜂窝小区）时，迎信仍然足连续的。 便携接入(po rtable access)- 在受限的网络豹盖面积中．用户设备能够在以步行速度移 动时进行网络迪信，提供有限的切换能力。 游牧接入(nomad i c access)-m 户设备的地理伈四至少在进行网络迪估时保持不变。如 果用户设备移动（位宜（改变［蜂窝小区），那么再次进行通估时可能还要寸找砓佳的基站。 也有的义献把便拱接入和游牧接入当作·样的，定义为可以在迫信时以步行速度移动。 这点在阅读文献时应加以注意。 9. 1.2 802.11 局域网的物理层 802.11 标准中物理层相当复杂。限于篇幅，这里对尤线局域网的物理层不能展开讨论。 根据物理层的不问（如 T．作频段、数炽率、调制方法＾、夺），对应的标准也个问。垃早流行的 无线肋域网处 802.11 b, 802.11 a 和 802.1 l g。 2009 年以后又公布［新的标准 802.11 n, 802.11 ac  以及 802.1 lax （见表 9-1) 。为f使无线局域网的适配器能够适应多种标准，很多适配器都做 成双模的 (802. ll a/g)或多快的（例如， 802.lla/b/ g n ac) 。顺便说，下，“别名”并仆一开 始就有的。在 802.11 以后的新标准就在原米的 802.11 后面增加介个英义字母。但 26 个英文 字母很快就川完了。这时就采川附加两个英文字母的办法。在 2018 年人们仵迫感到无线局 域网的名字太难记忆时， Wi -F i联盟就决定使川 Wi -F i 4/5/6 作为 802.11 n/ac/ax 的别名。随后 也顺便把 Wi -F i 1/2/3 作为最早流行的三种无线局域网的别名。 • 411 •"}
{"doc_id": "network", "page": 423, "text": "表 9-1 几种常用的 802.11 无线局域网 标准 别名 频段 虽高数据军 物理层 优缺点 802.llb W1-Fi I 2.4 GH, II Mb1ls 扩频 垃的攻从（中较低．价格垃低．i：,sHU＄诈岚蚊远，且个易 (1999 :1) 受阻们 802.1 In \\Vi_,1 2 5 Gll7 54 \\1b1t s OFOM 垃扁坎枢f·坟的· 义 1 ．卜史t IIlI.,MII·1 1 一．网．价 1各蚊岛，估 (1999'-I) 巧传插扑／为较伈． II．易受 lII 从1 801. Il g ＼＼卜几 3 2.4 GH1 54 \\l bll s OFDM 妓庙攻斟午较的·支甘史til1 户 I, iI II`l l I`4. f,., 3 传播仆贞 (2003 ii,) 最远． I l 个易受阻f月．价格比 802 I lb 贷 802. lln W1-Fi4 2 4 5 GH ✓ 600 Mbits Mll\\ 10 使用名个友射和拉收天线达到更，为的数拟i打旮扎 (2009 仆） OFDM 汛扣I J从（＄帝宽（ 40 MHz)ll·t让宰可达 600 Mbit/s  8位． I I J c Wi.Fi .5 5 GHz 7 UbiL's MIMO ，r. 个心i”,1 802 I I i女个杯小的所（J I勾＃． （史t＇，儿线j生柲能 (201-l :1 l OHDM ,“．人，i压刁力 I! -少企业 ·?lII ，的、，，人 !\\02.1 lux Wi-Fi 6 2,41 $ Gll1 9.6 Gbit1s MIMO 侧币斛决密儿）个垃卜．（如火个站、机场）提向忭叶从密度 (~019,, J OfDM c l!ll 1Y.. Fr1面f!!i'!'J仆 11 1. :11)  表 9-1 中 802.1 lax 又称为高效率无线标准 HEW (H igh-E niciency W i reless), 向下兼容 802.1 la心gi n ac 。其侧重要解决的问题是要在密从环境下（如火车站、飞机场等热点和人员 都很密块的场所）保持手机的畅汕。表 9-1 给出的关f- 802.1 lac 和 802.1 lax 的垃高数祸率 来自 [KHOR19], 但现在已付不少 802.1 lax 的产品的垃扁数据率达到了更高的数值。目前正 在研究的还付被称为极高吞吐量 EHT (Ex tremel y High Throug h p u t)的 802.llbe (W i-Fi 7), 其 奻高数据率｛T 望达到 30 Gb it/s, 它的另一个特点是要降低延迟和抖动（迟延要降低到 5 ms  以下），这对实时游戏具有匪要意义。 802.llbe 的标准可能在 2024 年亢成。 2016 年的 802.1 lah, 工作频段在 900 MHz, 最商数据率为 18 Mb it/s, 这种无线局域网 的功耗低、传输距离长（蚊长可达 1 km), 很适合于物联网设备之间的通信。 儿线局坡网最初还使川过跳频扩频 FHSS (Frequency Hopping Spread Sp ec tru m) 和红外技 术J R (ln fraRcd), 但现在已经很少仗用了。 以上几种标准都使用共同的媒体接入控制协议，都可以川千有固定某础设施的或无固 定挂础设施的无线同城网。除 IEEE 的 802.11 委员会外，欧洲屯估标准协会 ETSI (Euro pean  Telecommun ications Standards Ins titu te) 的 RESIO 工作组也为欧洲制定无线局域网的标准，他 们把这种扁城网取名为 H ip erLAN 。 ETSI 和 IEEE 的标准足可以冗操作的。 卜伽我们讨论 802.11 标准的 MAC 耘． 9. 1.3 802.1 I 局域网的 MAC 层协议 1. CSMA/CA 协议 斗然 CSM凶CD 协议已成功地应用 T 使用有线连接的局域网，们尤线局域网能不能也 使用 CSMNCD 协议呢？卜血我们从无线信道本身的特点出发米详细讨论这个问题。 ＂碰梳检测＂耍求一个站点在发送本站数枢的同时，还必须不间断地检测估追。一且 IJ计 （l物J小／凶妞 l 的 OFDM 儿 O rtho gonal Frequency Oh i、i on Multiplexing (ti次频分复Ill) 的细',j. MIMO 足 Mu ltip le Input Muh,plc Ou1pu1 <多入t :I1) 的衔刃．即宁fII) 分{,I_,使用多乍（可通道，即利Ill 物开 l ：元全分 1人的战名 4 个发射大线和 4 个j& 收人线，付不同玫从（进行小 l11J的调店l斛＇调， 1 小(11 促邸j辱枚树的｛q坋过书． • 412 •"}
{"doc_id": "network", "page": 424, "text": "检测到碰撞，就立即停止发送。但山 F 尤线信道的传输条件特殊，其信号强度的动态范围非 常大，因此在 802.11 适配器上接收到的信号强度往往会远远小f发送信号的强度（信号强 度可能相比百万倍）。因此尤线局域网的适配器无法实现碰掩检测。 我们知逍，尤线电波能够向所付的方向传播，且其传播距离有限。当电磁波在传播过 程中遇到阶碍物时，其传播距离就会受到限制。如图 9-5 所示的例子就是无线局域网的隐蔽 站问题。我们假定每个移动站的无线电信号传播范围都是以发送站为圆心的一个圆形面积。 A 的作 l廿过 [11 \\ ：忙 l1 ; ｀足｀足 ，，··、 A 困 A 的f1JlJ范围 C 的作用范 1.l1 ............... \"'---············  ·、..、·、·',. ·．气、..．、 、·` ·  .. ..  .. ..  ...  '  ..  ·•..  也包 A,.',,?!  ．．．、 .. •... ·•...........  3c  .,,..  (a) (b)  图 9-5 A 和 Cl\"l时向 B 发送数据，发生碰撞 倏19-5(a) 表示站点 A 和 C 都想和 B 通信（这里仅仅是讲解隐蔽站问题的原理，在逌估 的过程中省略了桵入点 AP 。可以把 B 看成是接入点 AP) 。但 A 和 C 相距较远，彼此都检 测不到对方发送的信号。当 A 和 C 检测到估道空闲时，就都向 B 发送数据，结果发生了碰 简并LL 儿法检测出这种碰掩。这就足隐蔽站问题(hidden station problem) 。所谓隐蔽站，就 是它发送的信号检测不到，但却能产生碰撞。这里 C 是 A 的隐蔽站， A 也是 C 的隐蔽站。 当移动站之间有陷碍物时也有可能出现上述问题。例如，图 9-5(b) 的三个站点 A, B 和 C 彼此距离都羌不多。从距离上看，彼此都应当能够检测到对方发送的信吵。但 A 和 C 之 间有高楼或高山，因此 A 和 C 都互相成为对方的隐蔽站。若 A 和 C 同时向 B 发送数据就会 发生碰掩，使 B 尤法正常接收。此时也无法检测出碰撞。 综上所述，在制定九线屈域网的协议时，必须考虑以下特点： (I) 无线局坡网的适配器无法实现砚撞检测： (2) 检测到信追空闲，其实信道可能并不空闲： (3) 即使我们能够在硬件上实现无线局域网的碰撞检测功能，也无法检测出隐蔽站问题 带来的碰掩。 我们知道， CSMA/CD 有两个要点。一是发送前先检测信道，信道忭就不发送。二是边 发送边检测估道，一发现碰撞就立即停止发送，并执行退避算法进行亟传。因此偶尔发生的 碰撞并不会使局域网的运行效率降低很多。无线局域网显然可以使用 CSMA, 但无法使用 碰撞检测（由上述尤线局域网特点(I) 和 (3) 决定的），一曰开始发送数据，就一定把整个帧发 送完毕：一旦发生碰惮，整个信道资源的浪费就比较严机。 为此， 802.11 局域网使用 CSMA/CA 协议')。 CA 表示 Coll i s i on Avo i dance, 是碰撞避免 的总思，或者说，协议的设计是要尽量减少碰撞发生的概率。这点和使用有线连接的以太网 有很大的区别。以太网当然不希望发生碰撞，但并不怕发生碰撞，因为碰撞的影响并不大。 <D注： （i的资抖称这忡协议为具有幔撞泪免的多点接入 MACA (Mu ltip le Access with Collision A,ordan动· • 413 •"}
{"doc_id": "network", "page": 425, "text": "802.11 / .. j城网在使用 CSMA/CA 的同时，还使川停止等待协议。这是因为无线信逍的通 伈J贞 :ct远个员巾线忙逍的，因此尤线站．i队协迎过尤线局域网发送完一帧后，要哼到收到对方 的 l1佣认帧后才能继续发送卜帧。这就足链路层确认。链路）公确认也是解决碰掩后重传的手 段 我们在进一步讨论 CSMA/CA 协议之前先耍介绍 802.11 的 MAC 层。 802.11 标准设计f独特的 MAC 层（如图 9-6 所小）。它迪过协调功能（Coord i nati on Function)  米确定在人［本服务坎 BSS 中的移动站，在什么时间能发送数据或接收数据。 802.11 的 MAC ｝式在物即以的！．面，它包括两个f层。 A:'ftJ II 服行（选用） 争片I J怅竹（必须实现） .;  l r 、 A M  ．，从 1办调功能 PCF (Point Coorclina1ion Func1ion)  分布协浏功能 DCF (D i、t ri bu tcd Coordination Function)  (CSMA/ CA)  物咒IA 图 9-6 802.11 的 MAC 层 (I) 分布协调功能 DCF (Dis1ributed Coordination Functi on) 。 DCF 不采用任何中心控制， 血足（i付 个竹点使川 CSMA 机制的分布式接入环法，让各个站通过争用伈道来获取发送 杖 因此 DCF 向上提供争用服务。 802.11 杯准规定．所有的实现都必须有 DCF 功能。为此， ，心义 r 两个仆常出要的时间间隔，即短帧间间隔 SIFS (Short Inter-Frame Sp ac i n g)和分布协调 功能帧间间隔 DIFS (DCF IFS) 。关「这两个时间间阰后面还议讲到。 802.11 标牡还定义f其 他儿种时间间隔，这用从略。 (2) 点协调功能 PCF (Point Coordination Functi on) 。 PCF 是选项，是用接入点 AP 渠中 扑制整个 BSS 内的活动，闪此自组网络就没有 PCF 子层。 PCF 使用集中控制的接入环法， 川类似于探询的方法把发送数据权轮流交给各个站，从而避免了碰掩的产生。对于时间栨感 的业务，如分组话齐，就应使川捉供尤争川服务的，I，L,I、协调功能 PCF 。 找们 11 前人址使川的尤线），j域网都怂使用上述的分布协调功能 DCF. CSMA/CA 协议比较复朵 IEEE 的 802.11-2007 标准文档共付 1232 页之多。这里介绍 CSMA/CA 协议的婴．＼［如下： (I) 站，I ．飞从想发送数据必须先监听估迫。若信迫在时间间隔 DIFS 内均为空闲，则发送 招个数据帧。否则，进行(2) 。 (2) 站点选择随机数，设罚退避计时器。计时器的运们规则）心：若信逍忙，则冻结退 避计时器，然线等待，白至估追变为空闲（这叫作推迟接入）：若估追空闲，并在时间间隔 DIFS 内均为空闲，则斤始争用信道，进行倒计时。当退避计时器的时间减到岑时（显然这 只能发生在伈道空杯lII 寸），站，I.l.i．就发送数据帧，把．整帧发龙。 (3) 站灶若收到接收方发米的确认帧，且还打后续帧要发送，就转到（2) 。若在设定时间 内木收到确认，则准各屯传，并转到（2), 但会在更大的范川内选择一随机数。 卜曲详细韶释上述协议中的内容。 • 414 •"}
{"doc_id": "network", "page": 426, "text": "2. 时间间隔 DIFS 的重要性 在图 9-7 中，站点 A 要向站点 B 发送数据。 A 监听信道。若信道在时间间隔 DIFS 内一 直都是空闲的（理由下而就婓讲到）， A 就可以在to 时间发送数据帧 DATA 。 B 收到后立即 发回确认 ACK 。 B 开始发送确认的时刻，实际上必然略滞后千 B 收完 DATA 的时间，滞后 的时间是 SIFS 。这是因为 B 收到数据帧后，必须进行 CRC 检验。若检验无差错，再从接收 状态转为发送状态，这些动作不可能在瞬间完成。 SIFS 值在 802.11 标准中均有规定。因此， 从 A 发送数据帧 DATA 开始，到收到确认 ACK 为止的这段时间(DATA + SIFS + ACK), 必 须不允许任何其他站发送数据，这样才不会发生碰撞。为此， 802.11 标准规定了每个站必须 同时使用以下的两个方法。 B  DIFS SIF$  A H DATA 尸 (o 11 12 : :-CW —- ;  : f启迫忙 l NAV  其他站在此期间不得发 图 9 习 A 向 B 发送数据， B 发回确认 第一个方法是用软件实现的虚拟载波监听（Virtual Carr ier Sense) 的机制。这就是让源 站 A 把要占用信道的时间（即 DATA+ SJFS + ACK), 以微秒为单位，写入其数据帧 DATA 的首部（在后面的 9.1 .4节还要介绍首部的各字段）。所有处在站点 A 的），播范围内的各站， 都能够收到这一信息，并创建自己的网络分配向量 NAV (Network Alloca tion Vec tor) 。 NAV 指出了信道忙的待续时间，意思是： “A 和 B 以外的站点都不能在这段时间发送数据“。 第二个方法是在物理层用硬件实现载波监听。每个站检查收到的信号强度是否超过一 定的门限数值，用此判断是否有其他移动站在信道上发送数据。任何站要发送数据之前，必 须监听信道。只要监听到信道忙，就不能发送数据。 从图 9-7 可以看出，/ I 至t2 这段时间 SIFS, 估道是空闲的。为了保证在这小段空闲时间 不让其他站点发送数据， 802.11 标准定义了比 SlFS 更长的时间间陷 D JF S (DCF IFS), 并且 规定，凡在空闲时间想发送数据的站点，必须等待时间 DlFS 后才能发送。这就保证f确认 帧 ACK 得以优先发送。这个重要措施使得在这段时间(DATA+ SIFS + ACK), 整个信道好像 是 A 和 B 专用的，因为其他站点暂时都不能发送数据。 3. 争用信道的过程 现假定在站点 A 和 B 通信的过程中，站点 C 和 D 也要发送数据（如图 9-8 所示）。但 C 和 D 检测到信道忙，因此必须推迟接入(de fe r access), 以免发牛碰撞。很明显，如果有讷 个或更多的站，在等待信道进入空闲状态后，大家都经过规定的时间间隔 DIFS 再同时发送 数据，那么必然产生碰撞。因此，协议 CSMA/CA 规定，所有推迟核入的站，都必须在争用 期执行统一的退避算法开始公平地争用信道。 • 415 •"}
{"doc_id": "network", "page": 427, "text": "信道 信道忙 仇道忙 位道忭 ,  DIFS 占用估道 DIFS  A 「勹 A:DATA一B,B:ACK-+A —一 c  DATA + SIFS + ACK  l ．．推迟接入....一退避 冻结 D  心； r..  闲；沪？ 山川（如迫 计＾• ~ • I  L____ －－推迟搂入－..今金·--- l-..--- …推迟接入··------- 严三酶匡 图 9-8 在争川期根据退避打法公平竞 ✓jt 图 9-8 中的争用期也叫作争用窗口 CW (Contention Wi ndow) 。争川彻 r lrb 许多时隙(ti me slo t)组成。例如，争用窗口 cw= 15 表示窗口大小足 15 个时隙。时隙长度是这样确定的： 在下个时隙开始时，每个站点都能检测出在前一个时隙开始时信道是否忙（这样就可采取 适当对策）。时隙的长短在不同 802.11 标准中可以有不同数值。例如， 802.1 l g规定一个时 隙时间为 9 µs, SIFS = 10 µs, 而 DIFS 应比 SIFS 的长度多两个时隙，闪此 DIFS = 28 µs 。 退避算法规定，站点在进入争用期时，应在 0 ~CW 个时隙中随机生成一个退避时隙数， 并设四退避计时器 (backo ff ti mer) 。当几个站同时争川估道时，计时器垃先降为零的站，就 首先桵入媒体，发送数据帧。这时信逆转为忙，而其他正在退避的站则冻纠其计时器，保留 计时器的数值不变，推迟到在下次争川估道时接祚倒计时。这样的规定对所付的站是公平的。 例如，图 9-8 中的站点 C 的退避时隙数为 3, 而站点 D 的退避时隙数为 9 。当经过 3 个 退避时隙后，站点 C 获得了发送权，？，，．即发送数掘帧，信逆轧为忙状态。站点 D 随即冻结 具剩余的 6 个时隙，推迟到下个争川估逍时间的到米。如果此后没有其他站要发送数拟， 那么经过剩余的 6 个退避时隙，站点 D 就可以发送数据了． 请注意“推迟接入“和“退避（backo fl)\"的区别。推迟接入发生在估迅处于忙的状态， 为的是等待争用期的到来，以使执行退避犹法来争川伈迫。这时退避计时器处于冻结状态。 而退避是争用期各站点执行的符法，退避计时器进行倒计时。这时估道是空闲的，井且总是 出现在时间间隔 DIFS 的后而（如图 9-8 所示）。 802.11 标准并未规定争J 11 砌口 CW 的初始值，但建议 CW 蚊小伯可取为 15, 址大仙为 1023.  为了减少碰撞的机会，协议 CSMNCA 规定，如果未收到确认帧（可能是发生碰撞， 或数据帧传输出差错），则必须重传。但协虫传一次，争用商 11 的数伯就近似加倍妍大。 例如，假定选抒初始争用窗口 CW = 24 - I = 15, 那么仵次争川估逍时，随机退避时隙 数应在 0~15 之间生成。在进行重传时，第 1 次重传的争用商 LI CW=24''- I 。 第 1 次重传时，随机退避的时隙数应在 0~31 之 1、u] 生成。 第 2 次重传时，随机退避的时隙数应在 0~63 之间生成。 第 3 次重传时，随机退避的时隙数应在 0~127 之间生成。 第 4 次重传时，随机退避的时隙数应在 0~511 之间生成。 第 5 次以及 5 次以上重传时，随机退避的时隙数应在 0~1023 之间生成，争用窗口 CW • 416 •"}
{"doc_id": "network", "page": 428, "text": "不再增大了。 采用上面这些措施，发生儿个站同时发送数据的概率可以大大减小。 归纳以上的讨论可以得出如下结论：当站点想发送数据，并检测信道连续空闲时间超 过 DIFS 时，即可立即发送数据，而不必经过争用期。 在以下几种情况下，发送数据必须经过争用期的公平竞争： (I) 要发送数据时检测到信道忙。 (2) 已发出的数据帧未收到确认，巫传数据帧。 (3) 接若发送后续的数据帧。 上述的 (3) 是为了防止一个站长期垄断发送权。若一站点要连续发送若丁数据帧，则不 管有无其他站争用信递，都必须进入争用期（如图 9-9 所示）。 DfFS  A  占用信道 DIFS cw  占用信道 要发这 I t  数据不争川 争用 信道 信道 图 9-9 只有 A 站连续发送数据 即使有了上述措施，碰撞仍有可能发生。例如， B 站正好在图 9-9 中 A 占用信道时要发 送数据。 B 检测到信道忙，千是推迟到争用信逆时与 A 一起争用信道。但正巧 A 和 B 又生 成了同样大小的随机退避时隙数。结果就发生了碰撞， A 和 B 都必须再巫传。这就浪费了 宝贵的信道资源。因此，要进～步减少碰撞的机会，还需要冉采用一些措施。这就是下而要 介绍的信道预约。 4. 对信道进行预约 为了更好地解决隐蔽站带来的碰撞问题， 802.11 允许要发送数据的站对信逆进行预约。 我们假定在图 9-10 中的 A 站要和 B 站通信。显然， A 站与 B 站的通信都必须通过接入点 AP 的转发。在前面图 9-7 和图 9-8 中讲解原理时，我们都把接入点 AP 省略了。下即我们要 画出 A 站和 AP 之间交换的信息，但为简单起见，图中省略了 AP 和 B 站之间交换的信息。 我们再假定， A 站或 B 站向接入点 AP 发送数据时，远处的 C 站接收不到这些信号， 而 C 站向 AP 发送的信号也传播不到远处的 A 站或 B 站。 在 A 站向 AP 发送数据帧 DATA 之前，先发送一个很短的控制帧，叫作请求发送 RTS (Request To Send), 目的是告诉所有能够收到 RTS 帧的站：“我将要占用信道一段时间： [SIFS + CTS + SIFS + DATA + SIFS + ACK]” 。这段时间写在控制帧 RTS 的肖部中。 A 站发 送的 RTS 帧， B 站能够收到，但远处的 C 站收不到。 接入点 AP 若正确收到 RTS 帧，纾过最短的时间间隔 SlFS 后，就向 A 站发送一个叫作 允许发送 CTS (Clear To Send) 的控制帧，自的不仅是告诉 A 站：“你可以发送数据了＂，而 且也是告诉所有能够收到 CTS 帧的站： “A 站和我通信，要占用信道一·段时间： [SIFS +  DATA+ SIFS + ACK]“。这段时间是写在控制帧 CTS 的首部中。 AP 发送的 CTS 帧， A 站和 B 站以及 C 站都能够收到。 在随后 A 站发送的 DATA 帧的首部中，也写入了时间 [DATA+ SIFS + ACK] 。如果有的 站没有收到 RTS 和 CTS 帧，那么收到 DATA 帧后，也能设陇其 NAV 。 以上措施就使得 A 站和接入点 AP （以及 A 站和 B 站）的通信过程中，发生碰撞的概 • 417 •"}
{"doc_id": "network", "page": 429, "text": "率大大降低，特别是减少［隐蔽站的干扰问题。 ：：二;夕--一 一心隐蔽站） AAl'-1二早勹尸 : ; : : :  DATA  气荨 I; 开始争用 2  收到 RT二的的广｀尸芦詈二霄l 的时间 收到 DATA 帧的站 NAY: A 在 DATA 帧中填＇为的时间 ，一 I I  图 9-10 发送 RTS 帧和 CTS 帧对估追进行预约 显然，增加使用 RTS 帧和 CTS 帧会仗整个网络的通信效率有所下降，要多浪费伯道的 时间 [RTS + Slf S + CTS + SIFS] 。但巾丁这两种控制帧都很短，其长度分别为 20 字节和 14 宁节，与数据帧（最长可达 2346 字＼j)相比开销不符人。相反，若不使用这种控制帧，则 一日发生碰撞而导致数据帧市发，浪费的时间就更多［。 从图 9-10 可以看出，即仗我们使用 RTS 和 CTS 对信道进行了预约，但碰撞也有可能发 生。例如，有的站可能在时间， 1 或 /2 就发送了数据（这些站可能是没有收到 RTS 帧或 CTS 帧或 NAY), 结果必定与 RTS 帧或 CTS 帧发 4碰描。 A 站若收个到 CTS 帧，就不能发送数 据帧，而必须重传 RTS 帧。 A 站只们正确收到 CTS 帧后才能发送数据帧。但我们可以石出， 在使用信道预约的协况卜，即使发生了碰撞，伈道资源的浪费足很小的。 信逍f·贝约不是强制性规定。各站可以自己决定使用或不仗用伈道预约。看来，只有当 数据帧的长度超过某喽女伯时，使）廿 RTS 帧和 CTS 帧才比较有利。 因为儿线信逆的误码率比有线倌道的高得多所以，儿线凡域网的 MAC 帧长一般应当 短些，以便什出铅正传时减小开销。这样，有时就必须将太长的帧进行分片。 砓后，我们要提一下关j一无线局域网的数据发送速率问题。在第 2 亲的 2.3.2 节的图 2-13 中，已经指出无线信逆中的误码牛与信噪比（信道状况）以及所选择的调制技术（包括数据 率）有关。 802.11 标准）i没行对尤线局域网数据率的自迼应殍法有具体的标准或规定。但牛 产无线局域网适配器的厂莉， 般都使自己的产品能够自适应地改变数据率，以使更好地适 应估道特性的变化。例如可以采用这样的絊法：如果一迕友送两个数振帧但都没有收到确 认，就认为估迫的质挔纹丿；．，这时）；们把数据率调慢一挡。反之，如果此后又能够连续收到 10 个数据帧的确认，那么就可以认为信道质僵改哟了，因而可以把数据率调快一挡。这与 协议 TCP 中的拥塞控制的处理思路足相似的。 9.1.4 802.11 局域网的 MAC 帧 为（更好地了解 802.11 局域网的．［作原理，找们应当进一步了解 802.11 局域网的 MAC 帧的结构。 802.11 帧共 4l 二种类店，即控制帧、数据帧和管理帧。通过图 9-1 l 所不仆勺 802.11 局域网的数据帧和一种控制帧的主要了段，可以进一｝J.,了解 802.11 局域网的 MAC 帧 的特点。 • 418 •"}
{"doc_id": "network", "page": 430, "text": "从图 9-l I (a) 可以看出， 802.11 数据帧由以下二大部分组成： MAC 首部 字节， 2 2 6 6 6 2 6 O~2312  L 帧控制 1 持续期 1 地址 l 1 地址 2 1 地址 3 1 序号控制 1 地址｝ 帧主体 MAC  尾部 4  尸 位飞 2 4  类型 子类型 汇了飞 I 姐试 1 器卫 1WEP1 顺疗 (a) 数据帧格式（帧控制字段中的仁类刚为0000) 字节 2 2 6 6 4  I 帧归Il 1 持续期 1 桵收地hf 1 友送地址| FCS I  (b) RTS 帧格式（帧控制字段中的千类和为 1011) 字节 2 2 6 4  I 帧控制 1 持续期 1 接收地叶 尸5—I (c} CTS 和 ACK 帧格式（帧控制字段中的（类型分别为 1100 和 1101) 图 9-11 802.11 局域网的帧格式 (1) MAC 首部，共 30 字节。帧的复杂性都在帧的 MAC 首部。 (2) 帧主体，也就是帧的数据部分，不超过 2312 字节。这个数值比以太网的最大长度 长很多。不过 802.11 帧的长度通常都小于 1500 字节。 (3) 帧检验序列 FCS 是 MAC 尾部，共 4 字节。 1. 关千 802.11 数据帧的地址 802.11 数据帧最特殊的地力就是有四个地址字段。这几个地址与帧控制字段中的“去往 AP\" （移动站发送到接入点）和”来自 AP\" （从接入点发往移动站）这两个子字段的数值有 关。 地址 l 永远是接收地址（即直接接收数据帧的节点地址）。 地址 2 永远是发送地址（即实际发送数据帧的节点地址）。 地址 3 和地址 4 取决于数据帧中的”来自 AP\" 和“去往 AP\" 这两个字段的数值。 这里要再强调一下，上述地址都是 MAC 地址，即硬件地址 ({I数据链路层不可能使用 IP 地址），而 AP 的 MAC 地址就是在 9.1.1 节介绍的 BSSID 。表 9-2 给出了 802.11 帧的地址 字段砐常用的两种情况（在有枯础设施的网络中一般只使用前三种地址，很少使用仅在自组 移动网络中使用的地址 4) 。 表 9-2 802.11 帧的地址字段品常用的两种情况 去往 AP 地址 4 。 。来自 AP:~ ：三勹：： 地址 3 源地址 「1 的地址 ＠注： 802.1 I t不准 l·仗 lll 的名叫比分配系统 DS, 但任解释中，指出这甲的 DS 也包含桵入八 AP. 因此我们仆这里仗用怯 入点 AP 代替 DS. • 419 •  -~"}
{"doc_id": "network", "page": 431, "text": "现假定在一个基本服务集中的站点 A 向站点 B 发送数据帧。在站点 A 发往接入点 AP 的数据帧的帧控制宁段中，“去往 AP= I\" 而”来自 AP=O”。 A-AP 的数据帧首部： 地址 l ：接收地址（不是目的地址）是 AP 的地址 BSSID 。 地址 2: 发送地址，即源地址，也就是站点 A 的地址 MACA• 地址 3: 目的地址（不是接收地址）是站点 B 的地卅 MAC胪 桵入点 AP 收到数据帧后，转发给站点 B, 但在数据帧的帧控制字段中，“去往 AP= O\"  而“来自 AP= I” 。 AP-+B 的数据帧首部： 地址 l ：接收地址就是目的地址 MAC胪 地扯 2: 发送地址（不是源地址）是接入点 AP 的地址 BSSID 。 地址 3: 源地址（不是发送地址）是站点 A 的地址 MACAO 下面讨论另一种稍复杂些的怡况，即站，心 A 向站点 B 发送数掘帧（如图 9-12 所示）。 现在 A 和 B 分别处在不问的两个f网 N1 和 N2 中，闪此在网络层看，是地址为 I 凡的站点 A, 把 IP 数据报从子网 N1 经过路巾器 R 转发到子网 N2 。在网络层看不见链路层的接入点 AP1 和 AP2 。 IP 数据报必须装入链路层的帧才能在链路层发送。但链路层不认识 lP 地址， 只认识 MAC 地址，即硬件地址。站点 A 使用协议 ARP 获得了默认路由器 R 的接口 1 的地 址 MACR·I 。这样，站点 A 先把 802.11 数据帧发到接入点 AP1, 然后 AP1 把 802.11 帧转换 为 802.3 帧，发送到路巾器 R 的接口 1 。站点 A 发送的 802.11 帧的帧控制字段中，“去往 AP= I\" 而”来自 AP=O” 。 A 一 AP1 的 802.11 数据帧首部： 地址 l ：接收地址（不是目的地址）是 AP1 的地址 BSS1D1. 地址 2: 发送地址，即源地址，也就是站点 A 的地址 MACAo 地址 3 ：目的地址（个足接收地址）是本了网中路由器 R 接口 1 的地址 MAC 凡 Io .................、..... .........................、·、.,·· ·· · · ··,.... l....  .,.. [P ll 辱．．．一．、．、·．．,. AP1 一 802 1 1 帧(,.,[P入·· 地：心°211 帧地、：S1二巨巨亘～～二土气5lD 地归 飞：ss ：二)··:-~--:-·~尸1 飞 图 9-12 链路上的 802.11 帧和 802.3 帧 当接入点 AP1 收到 802.11 数据帧后，就转换成 802.3 帧（ 802.3 帧只有酌个地址），其 目的地址是 MACRI ，而源地址是 MACA （而不是接入点 AP1 的地址 BSSID 凸 路由器 R 收到 802.3 帧肛，剥士、首部和尾部，上交给网络层。网络层根据 IP 数据报首 部中的目的地址 IPB 查找转发表，知道应从接口 2 转发给地址为 lPB 的设备。再使用协议 ARP ，获得此设备的硬件地址是 MACB ，这个地址就是 802.3 帧的目的地址，路巾器 R 接口 2 的地址 MACR-2 是这个 802.3 帧的源地址。 接入点 AP2 收到 802.3 帧，将其转换为 802.11 帧，其帧控制字段中，“去往 AP= O\" 而 ”来自 AP=I”。 • 420 •"}
{"doc_id": "network", "page": 432, "text": "AP2 一 B 的 802.11 帧首部 地址 l ：接收地址（即目的地址）是站点 B 的地卅 MAC胪 地址 2: 发送地址是 AP2 的地址 BSSlD狂 地址 3: 源地址（不是发送地址）是路由器 R 接口 2 的地址 MACR2O 2. 序号控制字段、持续期字段和帧控制字段 下面再介绍 802.11 数据帧中其他的～些字段。 (1)序号控制字段占 16 位，其中序号子字段占 12 位（从 0 开始，每发送一个新帧就加 l ，到 4095 后再回到 O), 分片子字段占 4 位（不分片则保持为 0 。如分片，则帧的序号子字 段保持不变，而分片子字段从 0 开始，每个分片加 1 ，最多到 15) 。重传的帧的序号和分片 子字段的值都不变。序号控制的作用是使接收方能够区分开是新传送的帧还是因出现差错而 重传的帧。这和运输层讨论的序号的概念是相似的。 (2) 持续期字段占 16 位。在 9. 1.3小节第 4 部分”对信道进行预约”中已经讲过 CSMNCA 协议允许发送数据的站点预约信道一段时间（见前面的图 940 的例子），并把这 个时间写入到持续期字段中。这个字段有多种用途（这里不对这些用途进行详细的说明）， 只有最高位为 0 时才表示待续期。这样，持续期不能超过 215 - I= 32767, 单位是微秒。 (3) 帧控制字段共分为 11 个子字段。下面介绍其中较为重要的几个。 协议版本字段现在是 0 。 类型字段和子类型字段用来区分帧的功能。上面已经讲过， 802.11 帧共有三种类型：控 制帧、数据帧和管理帧，而每一种帧又分为若干种子类型。例如，控制帧有 RTS, CTS 和 ACK 等儿种不同的子类型。控制帧的几种常用的帧格式如图 9-ll(b) 和（c ）所示。 更多分片字段置为 1 时表明这个帧屈于～个帧的多个分片之一。我们知道．无线信道 的通信质虽是较差的。因此无线局域网的数据帧不宜太长。当帧长为 n 而误比特率p = 10-4  时，正确收到这个帧的概率p = {I - p)”。若 11 = 12144 b it（相当于 1518 字节长的以太网帧）， 则算出这时 P = 0.2969, 即正确收到这样的帧的概率还不到 30% 。因此，为了提高传输效率， 在信道质挝较差时，需要把一个较长的帧划分为许多较短的分片。这时可以在一次使用 RTS 和 CTS 帧预约信道后连续发送这些分片。当然这仍然要使用停止等待协议，即发送一 个分片，等收到确认后再发送下一个分片，不过后而的分片都不需要用 RTS 和 CTS 帧亟新 预约信道（如图 9-13 所示）。 源站 17 的站 其他站 长的帧划分为许多分片 --.: •:.— 乎 同 门可可 尸可勹 门可可 国国产国可 NA\\/ (RTS)  NAV(CTS)  图 9-13 NAV （分片 0) NAV (ACKO)  分片的发送 NAV （分片 I) NAV (ACK!)  功率管理字段只有 1 位，用来指示移动站的功率管理模式。我们知道，移动站的功率 是其非常宝贵的资源。移动站在活跃状态时（即发送或接收信息）需要消耗功率，而在关机 • 421 •"}
{"doc_id": "network", "page": 433, "text": "状态虽然不消耗功率，但却可能漏掉重要伈息的接收。因此我们需要有第三种状态，这就是 待机状态，或省电状态。这时移动站个进行任何实质性操作，屏幕也处于断电状态，但并未 断开与 AP 的关联，因此这种状态非常省电。若一个移动站在发送给接入点 AP 的 MAC 帧 中的功率管理字段置为 0, 就表示这个移动站是处于活跃状态。但若把功率管理字段翌为 I, 则表示在成功发送完这一帧后，即进入待机状态。由丁接入点 AP 总是处在活跃状态，因此 AP 发送的 MAC 帧的功率管理字段总是置为 0 。 接入点 AP 保存有处在待机状态的移动站的名单。所有要发送给待机状态的移动站的帧， AP 都暂时不发送，而足保存在自己的缓存中 C 由千 AP 要周期性地向周围的移动站发送信 标帧（通常是衍熙 100 ms 发送一次），因此衍个要转为待机状态的移动站都必须设置一个计 时器，为的是在 AP 即将发送估标帧时，把处在待机状态的移动站唤醒，以便接收 AP 发来 的信标帧。唤醒时间很短，仅 0.25 ms 。 AP 发送的信标帧中有帧被缓存在 AP 中的节点列表。 若移动站从收到的估标帧中发现有发给自己的帧，就向 AP 发送请求把缓存的帧发过来。反 之，若发现没有发给自己的帧，就再返回到待机状态。这样，若移动站既不发送也不接收数 据帧，就可以有 99 ％的时间处在待机状态，因而大大地减少了电池功率的消耗。 WEP 宁段占 1 位。若 WEP = I, 就表明对 MAC 帧的帧主体字段采用了加密算法。我 们已经仆 9. 1. 1 节指出， WEP 加密算法有安全涌洞。因此， IEEE 802.11 i就努力解决无线 屈域网的安全问题。 2002 年 Wi -F i联盟制定了符合 802.1 I i功能的加密方式 WPA 。 2004 年 制定的 WPA2 增加了支持 AES 加密算法，并完全符合 IEEE 802.1 I i -2004 的安全功能。现在 的 Wi -F i产品几乎都支持 WPA2 。但在 MAC 帧首部的帧控制字段中， WEP 字段的名称仍继 续使用（已发现有的文献把 WEP 字段改为被保护帧（Pro tec ted Frame) 字段，但字段的作用不 变）。 WPA2 的加密算法相当复杂 [KUR017], 限于篇幅，这里从略。 9.2 无线个人区域网 WPAN 无线个人区域网 WPAN (Wireless Personal Area Network) 就是在个人工作的地方把屈于 个人使用的电子设备（如便携式电脑、平板电脑、便携式打印机以及蜂窝电话等）用无线技 术连接起来自组网络，不需要使用桵入点 AP, 整个网络的范围约为 10 m。 WPAN 可以是一 个人仗用，也可以是若干人共同使用（例如，一个外科手术小组的几位医生把几米范围内使 用的一些屯了设备组成一个无线个人区域网）。这些电子设备可以很方便地进行通信，就像 用忤通屯缆连接一样。请注意，尤线个人区域网 WPAN 和个人区域网 PAN (Personal Area  Net work) 并不完全等同，［月为 PAN 不处都是使用无线连接的． WPAN 和无线局域网 WLAN 并个一样。 WPAN 是以个人为中心来使用的无线个人区域 网，它实协上就是一个低功率、小范围、低速率和低价格的电缆替代技术。 WPAN 的 lEEE 标准起初都由 IEEE 的 802.15 工作组制定，这个标准也包括 MAC 层和 物理层这两层的标准[W-IEEE802. I 5] 。后来也有其他组织参加了标准的制定。 WPAN 都工作 -fr 2.4 GHz 的 ISM 频段。顺便指出，欧洲的 ETSI 标准则把无线个人区域网取名为 H ip erPAN 。 1 蓝牙系统 砐早使用的 WPAN 是 1994 年爱立信公司推出的蓝牙（Blue too th) 系统。 IEEE 的 802.15 • 422 •"}
{"doc_id": "network", "page": 434, "text": "工作组曾经把蓝牙技术标准化为 IEEE 802.15. 1.但此标准现已不再继续使用。目前蓝牙技 术由蓝牙技术联盟负责维护和更新其技术标准、认证制造厂商，并授权仗用蓝牙技术和蓝牙 标志 0 ，但蓝牙技术联盟井不负责蓝牙设备的设计、生产和出售 [W-BLUE] 。 第一代蓝牙的数据率仅为 720 kbit/s, 通信范围在 10 m 左右。蓝牙版本更新很快，到 2010 年已经是蓝牙 4.0 了。这个版本增加了低耗能蓝牙 BLE (Bluetooth Low Energy)。 BLE 适用千数据扯很小的节点，但电池可以连续工作 4 ~ 5 年（对比一卜现在的智能手机可能每 天都需要充电），传送距离增大到 30 m, 数据率可达 I Mb it/s 。这大大推动了低耗能蓝牙节 点在物联网中的使用。蓝牙 4.0 的传统蓝牙(class i c B lue too th) 的数据率已提高到 3 Mb it/s, 传 输距离可达 100 m 。 2016 年发布的第五代蓝牙 5.0 的数据率上限达 24 Mbit/s, 有效传输距离 最高可达 300 m 。目前最新的版本是 2020 年发布的蓝牙 5.2 。 蓝牙使用 TDM 方式和跳频扩频 FHSS 技术．组成不使用接入点 AP 的皮可网(pi cone t)。 pi cone t的意思就是“微微网”，因为前缀pi co- 是微微 (,0-12), 表示这种无线网络的毅盖而 积非常小。每一个皮可网有一个主设备(Master) 和最多 7 个工作的从设备(Slave) 。通过共享 主设备或从设备，可以把多个皮可网链接起来，形成一个范闱更大的扩散网（sca tt erne t)。这 种主从工作方式的个人区域网实现起来价格就会比较便宜。 图 9-14 给出了蓝牙系统中的皮可网和扩散网的概念。图中标有 M 和 S 的小圆闱分别表 示主设备和从设备，而标有 P 的小圆圆表示不工作的搁置的(parked) 设备。一个及可网最多 可以有 255 个搁置的设备。 扩散网 ；金 ,、,··' ;  @:.,.  2G)····  ＠网 尸 O` 、｀ \\j 0//  l@ 网妇＠@  图 9-14 蓝牙系统中的皮可网和扩散网 蓝牙技术联盟的成员已超过三力，分布在电信、计算机以及消费性电子产品等领域 c 蓝牙技术现广泛用千计算机与外设（鼠标、键盘、耳机、打印机等）的连搂，家居自动化 （如室内照明、温度、家用电器的控制等），医疗和保健（如血糖、血氧、心率的监测）以 及汽车上的各种蓝牙设备的连接。 为了适应不同用户的布求， WPAN 还定义了另外两种低速 WPAN 和高速 WPAN （下由 介绍）。 2. 低速 WPAN 低速 WPAN 主要用于工业监控组网、办公自动化与控制等领域，其速率是 2 ~250 kb it/s 。 低速 WPAN 的标准是 IEEE 802.15 .4。最近新修订的标准是 IEEE 802.15 .4—2006 。在低速 WPAN 中最重要的就是 Zig Bee 。 Z igBee 名字来源十蜂群使用的赖以生存和发展的通信方式。 蜜蜂通过跳 Z 形（即 Z ig Zag)的舞蹈，来通知其伙伴所发现的新食物源的位贤、距岛和方向 等信息，因此就把 Z igBee 作为新一代无线通信技术的名称。 ZigBee 技术主要用于各种电子设 • 423 •"}
{"doc_id": "network", "page": 435, "text": "备（固定的、便携的或移动的）之间的无线通信，其主要特点是通信距离短 (10~80 m),  传输数据速率低，并且成本低廉。 ZigBee 的另一个特点是功耗非帘低。在工作时，伈号的收发时间很短：而在非工作时， Zig Bee 节点处千休眠状态（处于这种状态的时间一般都远远大千工作时间）。这就使得 Zig Bee 节点非常省电，其节点的电池工作时间可以长达 6 个月到 2 年左右。对千某些工作 时间和总时间（工作时间＋休眠时间）之比小于 1 ％的情况，电池的寿命甚至可以超过 10 年． Zig Bee 网络容量大。一个 Z igBee 的网络最多包括有 255 个节点，其中一个是主设备 (Master), 其余则是从设备（Slave) 。若是逌过网络协调器(Net work Coordi na tor), 整个网络最 多可以支持超过 64000 个节点。 Zig Bee 标准是在 IEEE 802.15 .4标准基础上发展而来的。因此，所有 ZigB ee 产品也是 802.15 .4产品。虽然人们常常把 Zig Bee 和 802.15 .4作为同义词，但它们之间是有区别的。 图 9-15 是 Zig Bee 的协议栈。可以看出， IEEE 802. I 5 .4只是定义了 Z igBee 协议栈的最低的 两层（物理层和 MAC 层），而上面的两层（网络层和应用层）则是由 Z igBee 联盟吟巨义的 (W五gBee] 。在一些文献中可以见到 “ZigBee/802.15 .4\"的写法，这就表示 ZigBee 标准是由 两个不同的组织制定的。 ZigBee  协议栈 应用层 =  网络／云 MAC 层 物理层 I Z ig 8\" 联盟定义 I  l IEEE 802 154 足义 l - 图 9-15 Z ig Bee 的协议栈 IEEE 802.15 .4的物理层定义了表 9-3 所示的三个频段（都是免费开放的）。 表 9-3 IEEE 802.15 .4物理层使用的三个频段 频段 数据率 信道数 2.4 GHz （全球） 250 kb it/s 16  915 MHz （美同） 40 kbit/s JO  868 MHz （欧洲） 20 kb i11s I  在 MAC 层，主要沿用 802.11 无线局域网标准的 CSMA/CA 协议。这就是在传输之前 会先检查信道是否空闲，若信道空闲，则开始进行数据传输：若没有收到确认，则执行退避 算法重传。 在网络层， Z igBee 可采用星形和网状拓扑，或两者的组合（如图 9-16 所示）。一个 Zig Bee 网络最多可以有 255 个节点。 Z ig Bee 的节点按功能的强弱可划分为两大类，即全功 能设备 FFD (Full-Func tion Dev i ce) 和精简功能设备 RFD (Reduced-Func tion Device). RFD 节 点是 Zig Bee 网络中数侦最多的端设备（如图 9-16 中的 9 个黑色小圆点），它的电路简单， 存储容泣较小，因而成本较低。 FFD 节点具备控制器（Con t roller) 的功能，能够提供数据交换， ＠汴 Z ig Bee 联盟成立于 2001 釬 8 月，是由t.;·f l 开发J Il-I 能；队（比、 rl';) 业和 1 ．．业应用的无线斛决方案的企业组成的全 球企寸V 团体。截止到 2007 年 4 月． Zig Bee 联盟的成员已超过 220 个． • 424 •"}
{"doc_id": "network", "page": 436, "text": "是 Z ig Bee 网络中的路由器。 RFD 节点只能与处在该民形网中心的 FFD 节点交换数据。在一 个 Zig Bee 网络中有一个 FFD 充当该网络的协调器 (coord i na tor) 。协调器负责维护整个 Z ig Bee 网络的节点信息，问时还可以与其他 Zig Bee 网络的协调器交换数据。通过各网络协 调器的相互通信，可以得到稷盖更大范围、超过 65000 个节点的 Zig Bee 网络。 RFD  端 图 9-16 Z ig Bee 的组网方式 3. 高速 WPAN .  高速 WPAN 的标准是 IEEE 802.15.3, 是专为在便携式多媒体装置之间传送数据而制定的。 这个标准支持 11~55 Mb it/s 的数据率。这在个人使用的数码设备口益增多的情况下特别方便。 例如，使用高速 WPAN 可以不用连接线就能把计算机和在同一间屋子里的打印机、扫描仪、 外接硬盘，以及各种消费电子设备＇连接起来。别人使用数码摄像机拍摄的视频节目，可以不 用连接线就能复制到你的数码摄像机的存储卡I:- 。在会议厅中的便携式计算机可以不用连接 线就能通过投影机把制作好的幻灯片投影到大屏幕上。 IEEE 802. I 5.3a 工作组还提出了更高数 据率的物理层标准的超高速 WPAN 。这种网络使用超宽带 UWB (Ultra-Wide Band) 技术。根据 第 2 章所介绍的香农公式，我们知道信道的极限传输速率与信道的带宽成正比。因此，超宽 带技术工作在 3.1~10.6 GHz 微波频段就是为了得到非常高的估道带宽。现在的超宽带信号的 带宽，应超过信号中心频率的 25 ％以上，或者信号的绝对带宽超过 500 MHz 。 UWB 规定为： 超宽带技术使用了瞬间高速脉冲，因此信号的频带就很宽，就是指可支持 100~400 Mbit/s 的 数据率，可用于小范围内高速传送图像或 DVD 质址的多媒休视频文件。 9.3 蜂窝移动通信网 9.3. l 蜂窝无线通信技术的发展简介 1. 蜂窝移动通信系统问世 移动通信的种类很多，如蜂窝移动通信、卫星移动通信、集群移动通信、无绳电话通 信等，但目前使用最多的是蜂窝移动通信，它又称为小区制移动通信。 蜂窝无线通信网发展非常迅速，其信号的覆盖面已远远超过 Wi -F) 无线局域网的覆盖面。 蜂窝无线通信砓初只是用来打电话，这和本书讨论的计算机网络并无关联。但随着技术的发 0 注消费电子设备 CE (Consumer Elec1ron i cs) 衍电视机｀数码相机、数码摄像机、 MP3 播放怒笘电f设备”(:t这些设备 之间快速传达数据的需求促进［尤线个人区域网的发展。 • 425 •"}
{"doc_id": "network", "page": 437, "text": "展，拟米仅用来进行电话逌1 心的f机，已经发展成为桵入到互联网砓主要的用户设备。手机 之间 I,．．相传送的故据（其中大牡足视频、音频数据）已构成芍今互联网上流址的主要成分。 现在若快在移动的孙境卜搂入到互联网已经战不开蜂窝无线迪亿网了。 蜂窝尤线逌估技术相、1,1 复朵，婓深入f解其工作原理，了／，｝要学习另外的课程。因此本 节的币点仅限］．介绍两种网络（蜂窝移动迪信网和伍联网）怎祥相互连搂。为此，对女午窝移 动通估网必须有垃低限度的入门介绍。初学者往往不熟悉大叶的英文缩写词（但这此都是在 技术义献中性遍使川的）。（1 ：遇到牛疏的纠I\\}写词时，蚊好的办法就足反复多石儿遍． 垃早的第一代(IG) 蜂窝移动迪信系统F- l 978 年底问tll:, 它仗用模拟技术和传统的电路 交换及频分多址 FDMA 提供电话服务。这里的 G 表示 Genera ti on （代），而不是 G iga （千兆， 或占）。 IG 移动迪（古系统的手机相当笨 1µ, （俗称人飞f人），J|．话心质酰差，因此不久后就被 第二代(2G) 蜂窝移动逋亿系统取代了。 2. 2G 蜂窝移动通信系统 1990 年后丿「始了从j数字技术的第一代(2G) 蜂窝移动逌信，其代表性体制就是欧洲提 出的 GSM 系统 出然许多 1 卧家现在已纾停止使用 2G 系统j＇，但为了更好地了解 3G 和 4G 体制．这里有必找非常简们也介绍～下 GSM 2G 锋以通信系统的玉婓组成构件（还有另外 种也）成于 2G 蜂窝移动汕们的 CDMA. 这里从略）。 如图 9-17 所小，蜂窝移动迪估的特，I丛足把整个网络服务区划分成许多小区（ cell, 也就 是＂蜂窝＂），每个小区设咒·个基站，负贞与本小区各个移动站的联络和控制。小区也就是 拈站的设盖区。移动站的发送或接收都必须经过基站九成，因此基站又称为收发基站。每个 基站的发射功率既块能够悛溫个小区，义不能太大以致下扰f邻近小区的迪信。小区的大小 视拈站大线高度、增益和（，＇；砂传播条件以及该小区内的移动川户密度而定，从半径 20 m  （移动川户很密丿i的地方）到 1~25km 1' 笘。采J Il 小区的好处足可以在相隔一定距离的小区 中觅复使用相同的频率，这称为频率复用。图 9-17,mi出了 7 个小区，匈个小区的丛站使用 不同的频率。这样，只要相邻小区采Iii不同的频率，就可以组成由大屈小区构成的蜂窝无线 通估系统 实协的小区因受地形的限制，并非严格的六边形 之所以画成六边形的小区是为 了史好地说明采川蜂窝技术怎样解决了回频下扰以及频率平复使用的问题。这样，用一个个 相且拼接的六边形的小区，就可组成设盖面积很大的蜂窝尤线迪信系统。 乍中搂 统晶系，十呻、、}勹C 迥． O 、} 十 ••  J o gt  网络子系纹或袨心网 1 i＂名汕估）.,.. ．．．．一晕．一· ·...  ．．，＇，移动 网关移动．、、、 ; ，过换小心 交换小心｀、 MSC _ GMSC  二一 丿 归己了了， 图 9-17 2G GSl\\'1 t'f窝通亿系统的币要组成构件 GSM 系统出然使用［数字技术，但仍然使川传统的电路交换提供从本的话音迪伈服务。 移动川户到且站之间的空口（即儿线空中按门）采用的多址方式是 FDM A/f DMA 的混合系 统。这种混合系统先按频分复川力式，把可用频带（士 1 」和卜．行各占用 25 MHz) 划分为 125 个卅宽为 200 kHz 的j啸蠕。然后 11 i把每个f频带进行时分复用，符个 TOM 帧划分为 • 426 •"}
{"doc_id": "network", "page": 438, "text": "8 个时隙，使匈个迪话的川户占川一个 TDM 帧中的一个特定时隙。化知个蜂窝内可以从 125 X 8 个频追中合理地挑选出也些频道，就可以使相隔一定距离的蜂窝能够重复使Jll相同 频率的频道。在移动迪信系统中，“上行”是指从移动站到基站，而“卜一行”是指从基站到 移动站 如图 9-17 所/J~, GSM 包括基站子系统和网络子系统（常称为核心网）。基站f系统包 括儿十个基站和－－个基站控制器 BSC (Base Station Con t roller) 。从站拧制器 BSC 为本居站f 系统中的几卜个挂站服务。当本基站系统中的移动用户和牡站进行通信时，从站拧制器 BSC 要负贞为具分配无线估逍，确定移动用户所 {1 的小区，并 .,,1 移动JIJ户（1: 本从站f系统 内漫游时进行估迫的切换。 核心网包括移动交换中心 MSC (Mobile Switching Cent er) 和网关移动交换中心 GMSC (Gateway Mobile Switching Cen ter) 。 MSC 的重要任务是负贞用户的授权和账＇、（1. (即确定是台 允许一个移动设备接入到这个蜂窝网络中），川户呼叫连接的建立和杆放，以及瑁 II 户移动 在不同的尪站f系统之间漫游时的估逆切换。迪常－个移动交换中心 MSC II 「以节押 5 个从 站控制器 BSC, 而移动汕信运让商，1 ［以建立很多的 MSC, 然后迪过网关移动文换中心 GMSC, 连桵到公川屯话网或其他移动逌信网。 GSM 的奻据才仅为 9.6 kb il/s, ，如迕拔到 1 i 联网浏览网页是很不合适的。不过 GSM 可通过其（订令系统提供字数个多的知信服＇片． 才1. 佟|9-17 中，我们省略了相节复朵的信令系统的构件。我们使川 F 机迪话之前的拨＇少， 就是奇估令系统来准确找到袚叫川户的。整个蜂窝移动迪估系统的节狸和绯护都找依靠复朵 的估令系统。 3. 数据通信披引入移动通信系统 GSM 初期以提供话齿为主，在中后期为了满足移动数据汕信需求，引入通用分组无线 服务 GPRS (General Packet Radio Serv i ce) （俗称 2.SG) 和增强型数据速率 GSM 演进 EDGE (Enhanced Data rate for GSM Evolu ti on) （俗称 2.75G)) 系统，除了在空口调制方式山高斯最 小频移诅控 GMSK (Gau沁ia n Minimum Shift Keyi n g)提高到 8PSK 外，网元方面引入了分组 控制单元 PCU (Packet Control Unit), PCU 逌常和 BSC 织成在一起，负贞处则有义数据迪估 的业务。 PCU 根据用户数据业务的突发性原，动态地分配空门资源给用户，提的［空 11 资 源的利川率，提供的垃大速率为 17 l.2 kbit/s (GPRS) 和 384 kbit/s (EDGE) 。 引入 GPRS 后的核心网巾两个不同性质的域组成，即电路交换域和分组交换域（如 阳 9-18 所爪）。电路交换域就是原来 GSM 的核心网部分，而分组父换域则包括服务 GPRS 支持节点 SGSN (Serving GPRS Suppo11 Node)和网关 GPRS 支持节点 GGSN (Gateway GPRS  Support Node) 。电路交换域负贵话音通信，而分组交换域负责数据通信。 SGSN 把J,~站控制 器发来的 IP 数据报发送到 GGSN, 同时把 GGSN 发来的 lP 数据报转发到基站拉制监。 SGSN 还哎和纾窝i1~ I;子核心网的移动交换中心 MSC 交互，以使亢成川户的投权、迪化的切 换，以及维护移动'1 ,l,r丛的位置信息等功能。 GGSN 具有网络接入控制功能，把名个 SGS 连搂起来后搂入到 li联网。因此 GGSN 又称为 GPRS 路巾器，它选择哪些分组可进入 GPRS 网络，以保证 GPRS 网络的安全 • 427 •"}
{"doc_id": "network", "page": 439, "text": "汉区灶小 ．卓 .、·',... ，．、、 暑 `  恩\\9·· 、9- 午 A 人叫匕加移动fTJ I 勹 核心网-··········· ·············今．．，．，．． 忒乳 霖鞍＼ ,  一、公用电话网丿 厂－～－ \\ t 盯联网 `  I G5凇飞霆＼－／ ｀＼分组交换域（数据通信i夕、金~．勹\"rm”“.”“·· 心阜，．．，．．．亡．＂．了．． 图 9-18 引入 GPRS 后的核心网由屯路交换坡和分组交换域组成 4. 3G 蜂窝移动通信系统 1996 年国协电联儿线电通信部门 ITU-R 把第三代(3G) 蜂窝移动通信的正式标准名称定 为 IMT-2000, 希炽全球能够制定出一个统一的标准（但实际上术能统一）。名称中的 2000 表示：这个系统工作在 2000 MHz 频段，支持的数据率可达 2000 kb it/s （固定站）和 384 kb it/s （移动站），并预期在 2000 年方右得到莉用。下面介纠 IMT-2000 中最广泛使用的一种 标准。 1998 仆个球在通信领域蚊付影响的 7 个组织，其中包括中国通信标准化协会 CCSA (China Communications Standards Associ a ti on), 成立［第三代移动通信合作伙伴计划 3CPP (3rd Generation Partnership Proj ect l. 以便制定从 2G GSM 平滑过渡到 3G 的端到端标准。 3GPP 制定的 3G 标准名称是通用移动通信系统 UMTS (Universal Mobile Telecommunications  S ys t em), 发布在 3GPP R99 中。 R99 (Release 99) 表示这是 3GPP 规范的 1999 年版本。但在 2000 年以后，版本的格式改变了，字母 R 后面的数字表示 3GPP 规范的版本顺序号。 3GPP R99 版本对 UMTS 的要求是，下行和上行的数据率都要超过 384 kb it/s 。 3G UMTS 引入了无线接入网的概念（如图 9-19 所示），其全名是通用移动通信系统陆 地无线接入网 UTRAN (UMTS Terrestrial Radio Access Net work), 它由多个无线网络系统组 成。每个无线网络系统有－个无线网络控制器 RNC (Radio Ne八vork Controller) 和许多基站， 但在 UMTS 中，基站的正式名称是节点 B (Nodc-B), 简笃为 NB 。 UTRAN 中无线网络控制 器 RNC 的作用和 GSM 网络中的从站控制器相似。 RNC 一方面迪过电路交换域的 MSC 连 搂到的蜂窝话音网络，另？方面汕过分组交换域的 SGSN 和 GGSN 连接到分组交换的互联 网。 3G UMTS 把移动站称为用户设备 UE (User Eq u ip men t)。在用户设备 UE 和基站 NB 之 间足尤线链路，这点和 2G 的悄况是相似的． 3G 中的核心网由 GSM 系统中 GPRS 核心网进行平滑演进（软件升级和部分硬件升级）。 仆实际运旮中还采川融合设备实现，例如， SGSN 和 GGSN 设备同时支持 2G/3G 功能。从 .!.if: ITU 足联合国卜屈的各国政叶之间的组织．按咒说 ITU 制定的 11、准应具 h相｀I·1 的权威件 但牛兑 ITU 井非 L 业技 术t'「很强的纠织，曲 I I.I小汁卜制定纤历的时间ii ll rt!!得很长．闪此许名怀准的J l 体制定，还娼（罚芷·1lt II 政府机构的组织来,·,:;成． 例如（1 人＇，联网的 I利1. 归婓由 1 上TF 米切比 3GPP 的名称井小如；其研亢付如仅限 1 3G 锋窝移动通亿系统．日前全世界垃 I 戏的数 1'1 ，议拸动通1' 1 网络坠＇作商、心片制心1飞、学术界、研究机构和政府机构．郘积极爷'j了 3GPP 各种杯市的制定．实杯上， 现(I.的 3GI,P 远远小足），，i怅J..3G I砬i l 的制定，曲是进行从 4G ·兀到 5G 系统l刓l 的钊定 • 428 •"}
{"doc_id": "network", "page": 440, "text": "互联网尤法石到 GGSN 以内 3G 节点的移动性， GGSN 把这些对 UMTS 的外部都隐藏仁 3G UMTS 与 2G 的 GSM 的主要区别集中在 UTRAN 侧，在空门使用直接序列宽带码分 多址 DS-WCDMA (Direct Sequence Wideband CDMA), 或时分同步码分多址 TD-SCOMA (Time Division-Synchronous Code Division Multiple Access) 。这样，每个移动川户使川的带宽 比 GSM 的增大很多，因而能以更高的数据率享用多种移动宽带多媒体业务（浏览网贞，传 送高清图片和视频短片，即时视频通信，进行多方视频会议等）。 3G UMTS 也不断提商数据 率，例如， WCDMA 引入高速分组接入增强型版本 HSPA+ (Hig b Speed Packet Access+) 来传 输数据后，具下行数据率可达到 21 Mbit/s (5 MHz 带宽），大大超过了 3G 垃初设定的指标。 及区虴小 ` ... .... 尸 ·1 、 2 A 心夕5l 比Jl!'盓t备 无线网络系统 l,6..K. « i'  且 汪:  勹：UT二二 .•··................  , 交岱輩t、 婴斜职忽 ｀、 公川电由网 IJ : MSC GMSC 一千～～一丿 \\ t'  =  ．．．．、 支持节点 分组交换域（数据通伯） .、~ 核心网··············:::.:::.:...............  图 9-19 JG UMTS 蜂窝通信系统的且要组成构件 我国现使用二种 3G 国际标准，即 3GPP 组织中由欧洲提出的宽带码分多址 WCDMA (Wideband CDMA) (UMTS 的标准，中国联通使用）， 3GPP 组织中巾美国提出的 CDMA2000 （中国电信使用）和 3GPP 组织中主要由中国提出的时分同步码分多址 TD­ $CDMA (Time Division-Synchronous CDMA) (UMTS 标准，中 1月移动使用），儿中 TD­ SCDMA 和 WCDMA 使用相同的 3GPP 规范，仅在接入网空口部分有差异。 3GPP 组织的 CDMA2000 系统的核心网及接入网与 TD-SCDMNWCDMA 的都不同。 3G 蜂窝移动迪信是以传输多媒体数据业务为主的通信系统，而且必须兼容 2G 的功能 （即能够迪电话和发送短信），这就是所谓的向后兼容。 5. 4G 蜂窝移动通信系统 ITU-R 于 2008 年把第四代(4G) 移动通信的名称定为 IMT-Advanced (International Mobile  Telecommun i ca ti ons-Advanced), 意思是高级国际移动通信。 I MT-Advanced 的一个砐重要 的特点就是取消了电路交换，无论传送数据还姑传送话齿，全部使用分组交换技术，或称为 全网 IP 化。 I MT-Advanced 的目标峰侦数据率是：固定的和低速移动通信时应达到 I Gbit/ s,  在庙速移动通信时（如在火车、汽车上）应达到 100 Mbit/s 。不断捉高数据率的动力米自客 观的盆求。智能手机的用户迫切需要利用手机上安装的即时通信应用软件，把他们川手机拍 彶的视频短片或高清照片及时分享给自己的亲友，或用视频会议方式和亲友们进行视频交谈。 这就要求移动通信系统把网络数据率再提高到新的水平。 ITU-R 提出的这个 4G 标准比 3G 的标准战出很多。在当时的技术条件下，各囚的电信 企业都很难实现这个 4G 标准。 3GPP R8 版本发布的长期演进 LTE (Long-Term Evolu ti on) 标 • 429 •"}
{"doc_id": "network", "page": 441, "text": "准，在忙道带宽为 20 MHz 时，其下行和上行数据率应分别达到 100 Mb it/s 和 50 Mb it/s 。 这虽然比 3G 快得多，但仍达不到 4G 的标准。为照顾许多商家的经济利益，经协商， ITU­ R 同意运行 LTE 标准的商家在手机左上 1n 显示 “4G\" 的字样。但实际上 LTE 井不是具止的 4G. I 月此就有许多人把 LTE 俗称为 3.9G 或 3.95G, 表水 LTE 已很接近 4G I 。 图 9-20)L LTE 体系结构的垃 l：要部分的简图。 卜 lli l J且竹徇 l'1令的讨论 UE E-UTRAN  矿了一·· ··: - J  中 cNB 仵 一二·••  g·· eNB  呵 L- —I ,1跺卜—忑旯加一一十一一，｝肃且汇，a-1 制曲控层 [] c. p~ E  估令..... •·•••  数振 X2 t如 1,' 图 9-20 I.TE 体系结构的简图 LTE 的体系结构山＝．大部分组成，即用户设备 UE 、演进的无线接入网 E-UTRAN (Evolvcd-UTRAN) 和演进的分组核心网 EPC (Evolved Packet Core）。从图 9-20 可石出，核心 网 EPC 的用户）只曲和控制层面的划分非常清晰。图中 EPC 的 I·. 半部分是控制层面， 卜平部 分足用户层面。化令的传输在图中用虚线表示，而用户故据的传输用实线长尔。（I移动迪伈 领域经祁才是到的“用户仄血＂，就是找们在第 4 浮中介绍的“数拟层而“。 为［进步提高数枢率， LTE 采用J'以下的一些方认。 我们知道 3G 的 UMTS 的空 I I i史用的是 WCDMA 。如果 LTE 继续仗川 WCDMA, 那么 就很难 l fJ提高数据传输的速率。现在 LTE 无线接入网的下行伈追 (eNB 一 UE) 勹卜行信道 (UE 一 cNB) 采用了不同的复川方式。例如， 下行信逍采用（频分复）ll 与时分复用相结合 的方式，称为正交频分多址 OFDMA 。找们知道，在传统的频分复用 FDM 中的各频道必须 相陆一定的保护频带，以免相互「扰。但 U 交频分复用 OFDM 技术采用了多个f载波井行 传输的力法，利）廿各子载波之间的 11交性，子1言迫的频i许可以相飞E 才飞，但在ftl(. l周时并不产 生千载波间干扰。这就大大提战（频讲利用率。 OFDM 使母个f信逍的故据弁米降低，因曲 们效地减少（由多径效应带来的符弓间 1 ：扰，降低了以比特率。山J峦衍个用户同时采用多个 f信迫片行传输，因此仍然能够获得较屈的数据率。因血现{t LTE 的空 II 使用的带宽足 20 MHz, 比 3G 的 UMTS 空口带宽 5 MHz 提高了很多。 LTE 的川户设备发送的帧长为 10 ms,  母个帧划分为 20 个时隙。因此－个时隙为 0 .5 ms 。 LTE 衍个彼激活的用户设备 11 J以被分配 到个或多个1言迫频率中的一个或多个时隙。用户设各分 nd 到的时隙数越多（不行是在同 敖钜或在不同频率），就 IJ」以获得越高的数据率。在月l 户设备之间，n 新分配时隙的频度可以 是每亳秒进行·次。 LTE 采用j，的阶调制 64QAM ，也就）(; ii: I U1~ 元携悄 6 b11 的 L ，，息、［代。 LTE 还采用了多大 线的多入多出 MIMO 技术，这些枯施对提高数枢率和估迫频讲利用率起［屯要作用。 演进的尤线俀入网 E-UTRAN 勺 3G 的 UTRAN 付很人的 Ix 片 1 J. E-UTRAN 取泊（尤线 网络控制器 RNC, 并把从站称为演进的节点 B. 简马为 c~B (evolved Nodc-8) LTE 的从站 • 430 •"}
{"doc_id": "network", "page": 442, "text": "eNB Jk·fr 3G 中的从站 NB 和儿线网络拧制器 RNC 的功能．是 LTE 中功能垃复杂的设备。 (1~ E-UTRAN 中的从剑， cNB ，迪过图 9-20 所尔的 X2 拔门，勹相邻的－此从站相订迕桵， 自拔｛（输枚扑坏， I(，．，令((t LTE 中、包括 3G 和 2G 在内，所付而要进 h 通估的实休之间．都 们 II ＇，阳明确的拔 11 丿、见记， 卜述的 X2 拔 11 仅）L 许多拔 11 中的个）。这样就使 l·用户设备没 游时的估习切换 E-UTRAN 采用这坤戏少'1,i .1从忙次的扁平结构．是为（简化拔入网的结构 和降低成本． II I」时也加快奻似的传输． 从玑 cNB (j一勹个i··婓构f'I (I) 大线．（2 ）九线校块： 人·]发往宁 11 的信炒，或从宁 I l 才妥 收的伈月．进f 1 调制或解调 （ 3) 数字校块：作为宁 I I l j核心网的按 11. 对经过此校块的所 们百',)进行处」甲 （！控制）山川，从站 eNB 负贞儿线资源的许理，执行由 MME 发起的寻呼信息的调度和 传输，并为 UE 发往服务树入 S-GW 的数据选抒路巾． (t牧据以曲中．从站 eNB(i用户设估 UE 勹核心网之间仕送 IP 数据报 分组数据网络网关（简称为分组网关） P-GW (Packet Data Network Gate Way)是核心网逌 向 I 1: 联网的网关路山器或边界如 11 器， I t GGSN 平滑演进升级曲来，足核心网勺 3GPP 或 lL3GPP 的外沁玫斟网的接门 在现实网络中， 2G/3G 的 GGSN 和 4G 的 P-GW 是一个融合 设备。 P-GW 也足核心网对外的描点(Anchor point). P-GW 负戊给所付川户设备 UE 分配 1P 地 h| 札确保 II1 i分／贞吊QoS 的实施川户设备 UE 的敌躯报在丛站 eNB 封装到 GTP-U 忧近 11 ()司（们心从讨论这个问题），心过令 IP 核心网 EPC ，从 cNB 先到达 S-GW, 内到达 P-GW 。 这种吐迫ji式处有保礼服务质丑QoS 的作川。例如， LTE 网络可保证{1. VE 到 P-GW 之间 的话 l.1 分组时延不超过 100 m、 .ru.r,行分组的丢失华小f l% 。这就保iJf J，在个 IP 网络传 输时．话许j山（心的）争，）i吊仍较好 (t LTE 的网络中不内保切屯出各交换的原闪足，现{t移动通 信流岱中的主流已是数据通信（如用 F 机浏览网贞， I浏i焊饮（比利川微化进行竹祯或视频通 估笘） 为少以的丁机屯话逌（，．，业务而保留屯路父换的构件．将使网络变得史加复朵．会人今 大附加网洛l.1 勺让设成个和运勺．，如小采川全 IP 网络足 LTE 队络结构中的一个，［大变小 服务网关 S-GW (Se1-ving Gat eWa y)是无线桵入网与核心网之间的网关路巾器，由 SGSN 演进而米。在现实网络中， 2G/3G 的 SGSN 和 4G 的 S-GW 是一个融合设备。 S-GW 负贡用 户层训的数拟分组的转发和路山选择，起到路巾器的作用。 S-GW 还负责 eNB 到 S-GW 以 及 S-GW 到 P-GW 的隧道管理。 S-GW 是数据层面中移动性的描点。用户设备 UE 在通信过 程中，可能会在 LTE 系统不同的 eNB 之间切换或漫游到 3GPP 的 4；同接入系统中（如 2G 的 GSM 或 3G 的 UMTS), 如果这些 eNB 以及 2G/3G 的基站都与某 个 S-GW 连拔，这时 UE 所关联的 S-GW 个变，数据流都从同一个 S-GW 流出，再转发到 P-GW. SGW 和 PGW 可以在同个物理竹点或不同物理节点实现。 归屈用户服务器 1 ISS (I lomc Subscriber Server) 是个中心数据库，里面打网络运忖商所 保存的用户J吉本数据 移动性管理实体 MME (Mobility Management En tity)是一个估令实体，负贞基站勹核心 网之间以及 Hl J `I l j核心网之间的所有估令父换 大的核心网盂耍有多个 MME 米处理大风的 估令父换。、 11· 个用户初次拔入到 LTE 网络时，基站 cNB 就＇度与 MME 迪化．以使 MME 和川／叮j七旬名文换鉴别伈息、 MME 必须从 HSS 获得用户的有关伈息吓 在图 9-20 中还省略了，些构件，如策略与计费规则功能 PCRF (Policy and Chargi ng  Rules Func ti on ） l'(t元等，这里就不进行介绍了。 • 431 •"}
{"doc_id": "network", "page": 443, "text": "LTE 必须向后兼容 3G 和 2G 。因此很多手机都标明具有 4G/3G/2G 功能。这及示如果 LTE f-机所在地还没有被 4G 网络栩盖，那么该手机还可使川原来 3G/2G 网络的功能。 最初 LTE 把电话通信业务转交给原先的 3G UMTS 或 2G GSM 的电路交换网络来处理， 以确保屯话迪信的质晶。这叫作电路交换回落 CSFB (Circuit Switched FallBack), 意思是再 退回到 3G/2G 的电路交换的网络来处理电话通信业务。但这种处理方法姑过渡性质的。在 2012 年，基于 IP 的 VoLTE (Voice over LTE) 问世了。 VoLTE 也叫作高消屯话业务，能够提供 叫妇t的电话职，｀，和视频屯话，但 VoLTE 的运行要靠与 P-GW 相连的 IP 多媒体子系统 li\\1S (IP Multimedia Subsys t em) 。 IMS 不屈千 LTE, 而是屈于 IP 服务的范围，是 LTE 之外的 另个分组交换的网络系统。 9.3.2 LTE 网络与互联网的连接 下面讨论 LTE 网络怎样连接到互联网，这需要用到 LTE 协议栈的概念。 、 1,1 片 UE （如手机）开机后，就登记到 LTE 网络，以便使川网络资源来传送 IP 数据业务。在 LTE 网络内的数据路径由两大部分组成，即空LJ尤线链路 (UE 一 cNB) 和核 心网中的隧道 (eNB-S-GW 一 P-GW) 。关于＂隧道”下面还耍详细讲解。图 9-21 是 LTE 的协议栈（用）叮 1 压面），上而说到的数据在隧道中的通信使用 GPRS 隧道协议 GTP (GPRS  Tunneling Pro tocol), 而 GTP-U 砓后的字母 U, 表示所传送的足用户层面 (User p lane) 的数据。 LTE 还使用另一个控制层面的隧道协议 GTP-C 来传输有关的信令（限于篇幅，这部分内容 从略）。、片上下文意思很明确时，也可把 GTP-U 简写为 GTP 。只要用户设备 UE 移动时不超 过 P-GW 的覆盖范围， P-GW 分配给 UE 的 IP 地址就不改变。 PDCP I GTP-U I I GTP-U GTP-U  UDP UDP  RLC I I RLC  IP [P lP  MAC L2 L2 L2  PIIY LI LI LI I  空中接口 eNB S-GW P-GW  白度网站~— UE 发这的 IP 分组一－一； 源地址「1 的地址； OUE研忒如 1 1 [PS=UE|lP 。 =BD 尸 @ eNB 一 S.GW 忧道传送的分纠 C)s.cw- P-Gw  忱边传送的分组 TE.J01 ill;l地址 II 的地址 [Ps = UEIIP0 • BDI G2行部 1UDP 叫 lP、 =eNB| lP。 =S-GW TEIDi 源地址 II 的地址 [Ps=UEI [PD-BDIGTP1 竹引 uDP 八部1lPs=S-GW|lPD 吓GW 图 9-21 LTE 的协议栈（用户层面） 、 1'1 UE 登记亢成后，如果在一段时间（例如， 10~30 秒）没布数掘业务，为f节约宝 • 432 •"}
{"doc_id": "network", "page": 444, "text": "贵的无线频谱资源， UE 和 eNB 之间的空门链路会迅速释放， eNB 和 S-GW 之间的 GTP-U 隧道也会接着释放，从而使 UE 空口进入空闲状态。但是， S-GW 与 P-GW 之间的 GTP-U 隧道以及 UE 的[P地址都仍保持着飞 P-GW 认为该 TP 地址目前暂时归这个lJE使用＇并保 留 UE 有关的信息。 当 UE 处于空口空闲状态时，有两种不同情况，即 UE 有 IP 分组发往互联网，或互联 网有 IP 分组发往 UE 。下面分别进行讨论（关千 UE 之间的打电话呼叫过程不在此讨论）。 (I)假定 UE 要访问互联网中的百度网站 8D 。 首先， UE 应向所在小区的基站 eNB 发送连接请求。当 eNB 收到连接诸求后，就要建 立空口链路和 eNB 一 S-GW 之间的 GTP-U 隧道。诘注意， S-GW-P-GW 之间原有的 GTP-U 隧道仍存在着。然后 UE 就发送 IP 分组，从 IP 层先传送到下面的第 2 层（现在 L2 具有三 个子层）。 L2 的最上层是分组数据汇聚协议 PDCP (Packe t Data Convergence Pro tocol) 子层。 PDCP 子层的主要作用是支持 IP 分组在无线链路更加有效的传输，包括对 IP 首部进行压缩／解压 缩。当 UE 发送一连串的 IP 分组时，每个 lP 分组都有 20 字节的 lP 首部。这些首部中的大 部分字段是重复的。若采用适当的压缩算法对首部进行压缩，就可在传输时节省大挹的无线 信道资源。基站 eNB 的 PDCP 子层收到已压缩首部的 lP 分组后，就进行解压缩。 下一个子层是无线链路控制 RLC (Radio Link Con trol) 子层。 RLC 子层可提供三种不同 可靠性等级的运行方式。例如，对千确认方式 AM (Acknowled ged Mode), 在发送数据时， 对 PDCP 子层传下来的 PDCP 协议数据单元进行分段或拼接，使其长度适合无线信道的传输。 在接收数据时，则进行协议数据单元的亟组，再上传到 PDCP 子层。 RLC 子层还具有分组 重新排序、亟复数据检测以及使用差错检测协议 ARQ进行数据重传的功能。 L2 最下面的是媒体接入控制 MAC 子层，它在 RLC 子层的逻辑估道和下面物理层的传 输信道之间，完成复用和分用的功能。在无线信道质豐较差的环境下， MAC 子层采用混合 自动重传请求 HARQ (Hybrid ARQ)协议，可以有效地减少见传次数＇。此外， MAC 子层还 按照 eNB 调度程序的安排，把无线资源动态分配给 UE, 从而保证了服务质队QoS 。 在发送时，物理层对 MAC 子层传送来的数据进行编码和调制，把比特插入到每一帧中 适当的时隙中，发送出去。在接收时，物理层要进行解调和解码，把收到的比特上传给 MAC 子层。物理层还采用一种自适应调制编码 AMC (Adaptive Modulation and Codi ng)技术。 基站 eNB 根据用户终端反馈的信道状况，动态地调整物理层采用的调制方式(QPSK 或 16 QAM 或 64 QAM) 和编码速率。当无线信道质量较差时，物理信道的传输速率可能会远 小于其峰值速率，以保证无线链路的传输质址。 在图 9-21 中， UE 发送的 IP 分组 O 的目的地址是 8D 的 IP 地址，记为 lPD = BD ; lP  分组 O 的源地址是 UE 的 IP 地址，记为 IPs = UE （后面也都用这样的简单记法）。 当基站 eNB 的 PDCP 把收到的数据解封后，要用协议 GTP-U 进行封装，并把一个 GTP 隧道端点标识符 TE1D (Tunnel Endpoint Iden tifi er) 写入到 GTP 首部中，如图中所示的 TEID1. ＠汴 HAR Q在传统们 ARQ协议的基础上，增加称力从合并(so ft comb i n i n g)的纠错技术。 HAR Q把收到的垃错帧个是工 弃而是缓存起来，井请求发方进行顶但如仍行差错，则继纨缓存和觅传。 HARQ把衍次级仔的帧合井起来进 h解码，提商了 成功解码的概半．因而减少了重传次数． • 433 •"}
{"doc_id": "network", "page": 445, "text": "这时..UE 发达的 IP 分组已经被封装在一个新的 IP 分组 e 电面，在隧道中传输 (eNB-S­ GW) IP 分红le 的目的地址 !Po= S-GW, 源地址 IPs = eNB 。 S-GW 收到 IP 分红l 后，J|］同样的方法韶封，并再次封装成在 GTP-U 隧道中传送的另一 个新的 IP 分组C) (S-GW 一 P-GW), 把另一个 GTP 隧迨端，I炽标识符 TEID2 写入 GTP 首部。 IP 分组 0 的 11 的地址 IP0=P-GW, 源地址叭＝ S-GW 。 我们知迫， eNB 和 S-GW 之间以及在 S-GW 和 P-GW 之间，都会有很多 lP 数据报封装 (I 各 1·1 的 GTP 陡迅中传输。囚此，为了标识不同的隧逆，对应角一个 VE 发往某个目的地 址的隧迫，必须分配一个 GTP 隧道端点标识符 TEID 。这也就是说，给每一个 UE 分配 个 不问的隧迫。接右，这个 UE 发往同 目的地卅的所 hlP 数摒报，都封装在这个隧迨中传 输。对小同的 UE 发这的 IP 奻据报，会分配到不同的 GTP 隧道端点标识符 TEID, 因而在 各臼不同的隧迨中传送。 蚁们， P-GW 把从 GTP-U 隧迫收到的 IP 分组解封，得到 UE 发送的 IP 分组，就转发到 －在联网的百度网站。 为什么 LTE 耍使用协议 GTP 把 UE 的 lP 分组再封装到 GTP 隧道中传输呢？这是因为 LTE 纾窝移动汕伯系统中，用户设备 UE 所关联的基站 eNB, 在 UE 漫游时会经常改变。这 就足说，回一个 UE 在不同时间可能使用不同的 eNB 或不同的 S-GW 。这就使得核心网分组 交换域中的 P-GW/GGSN 和 S-GW/SGSN, 无认根据 UE 的 IP 地址，用仕统的路巾选择协议， 把 IP 分组转发到 UE 。但我们知迫，在 LTE 网络中，所有的 eNB, S-GW 和 P-GW 的地理付 罚邵足 1占1 几：不变的，因而可以让核心网 EPC 只负贵核心网内部的路由选择。由千采用了 GTP 隧迫方式， UE 发送到互联网的 IP 分组，核心网将其封装为新的 lP 分组，在隧逆中传 达到 P-GW 。以后再巾 P-GW 轧发给斤联网中的具他路巾器。同理，从互联网发送给 UE 的 IP 分组， 伴先转发到 P-GW, 甘 I P-GW 负责确定从哪个隧逍转发到 S-GW 和 eNB ，砐后 内从 eNB 轧发到日的 UE 。实 1杯上， GTP 隧道早在 2G 的 GSM 引入 GPRS 时就已经使用了。 我们为」，节省篇幅，就只在讨论 LTE 时才进行介绍 c 个册石出，从 个 UE 发送到白度服务器的往返 IP 分组，共通过 4 段隧迨，两个」－行 隧追，两个下行隧迫。－共要在 GTP 首部中使用 4 个小回的 GTP 隧迫端点标识符 TElD 。 (2) 自度服务器向用户设各 UE 发送数据。 百度服务器并个知道 UE 的空门状态，而只知道 UE 的 IP 地址。百度服务器以 UE 的 IP 地址为 1~I 的地址，构成 IP 分组发送出去。互联网中的路山器根据 IP 分组的目的地址，能 够找到 UE 所驻留的 P-GW （因为 UE 的 lP 地址处 P-GW 分配的，囚此厅联网中的路由器可 以根据 UE 的 IP 地刘找到 P-GW) 。 P-GW 迪过 UE 的 IP 地址就能通过对应的 GTP-U 隧迅，把 IP 分组封装为 GTP-U 分组， 在隧追中轧发给 S-GW 。再往后就有曲种估况： • S-GW 和 cNB 之间的 GTP-U 隧道存在。 这时． S-GW 把 GTP-U 分组通过隧道发送给 eNB 。 eNB 把 GTP-U 分组解封，在空口链 路t和 I J PDCP/RLC/MAC/PHY 层封装，把数据发送给 UE. • SGW 和 eNB 之间的 GTP-U 隧逆不存在。 现在 UE 处千空口空闲状态。这种情况要复杂些，因为 LTE 中的所有基站 eNB 都不知 逆 UEW 什么地方。因此， S-GW 只好先把收到的 IP 分组暂时缓存，并触发移动性管理实 体 MME 进行寻呼 UE （有时称为唤醒 UE) 。那么， MME 怎样才能寻呼到 UE 呢？ • 434 •"}
{"doc_id": "network", "page": 446, "text": "MME 可以在整个的 LTE 网络中广播寻呼 UE, 但这样付出的代价太人。网络运和商（1: 让选 LTE 网络时，就把整个栩盖范围划分为很多的跟踪区 TA (Tracking Area). 网络运背商 赋予每个 TA ｀个跟踪区标识 TAI (Tracking Arca Iden tity)、作为 TA 在令球的唯·标识（这 且包括国家代码、网络运仵曲代砃以及 TA 代砃）。跟跺区 TA 是 LTE 系统中位罚更新和寸 呼的从本单位。－个跟踩区 TA 可以防盖多个小区。当处j奄．待机状态的 UE 必须收听邻近 eNB 的广播，以便知逆自己位千哪个 TA 中。 UE 必须周期性向核心网的 MME 报告自己的 跟踪区标识 TAI, 以使 MME 能够、 1 呼到自己。为j，避免 UE 在 TA 区域间频繁切换时造成 核心网信令负荷过重， MME 就把·组 (I~16 个） TA 马入一个跟踪区列表 TAL (Tracking  Arca Li s t),发送给 UE 。寸1 UE 在这个 TAL 范围内跨 TA 沌游时．就不必向 MME 发送 TA 更新报文。如果这时 MME 面要寻呼 UE, 只需在一个 TAL 的小池 l_bl 内进 1 」.｝，呼。图 9-22 说明f UE 的跟跺 12!-列表 TAL 史新的过程。我们行到，不同的 TA I1［以包含小同数机的小 I x\" 例如， TA1 只包含一个小区，但 TA.i则包含 5 个小区。假定蚁初 UE (t．位罚 O, l出于跟跺 1 又 TA1 。 UE 把这个位置信息报告给 MME, 然后 MME 向 UE 发送个跟跺ix: 列表 TAL1 。图 9-22 指出 TAL1 包含 TA1, TA2 和 TA iJ°t三个跟踪区。凋 UE 漫游到位咒 0 和 OLI 寸，儿位罚仍 在跟跺区列表 TAL1 中，因此 UE 不向 MME 发送 TA 更新报文。但、1'1 UE 漫游到位咒O 时． 发现新到达的 TA4 不在自己的跟踪区列表 TAL1 中，因此就向 MME 发送 TA 更新报义。 MME 接若就把更新的 TAL2 发送给 UE 。这时只耍 UE (1: TAL2 内没游（即在 TA, 和 T心的 范围中），就可以不向 MME 发送 TA 更新报文，这样就减小了对核心网的伈令压力。诸注 忍， 一个跟踪区 TA 可以屈于多个跟踪区列表 TAL ，例如， TA、既在 TAL1 中，也在 TAL2 中。 UEll•J MME'从这 TA 心，祈报义 ', MME 回 U 上发迖史fJr 的 TAL 、 UI·，竹汛让 1 《 {/ljj, IAL  亏三： TA: TA,  已二｛门 ·,1 ,1`/011 寸 化位'JY1'0ll·J (I (J?'ieUl  们叶心时 图 9-22 UE 的跟跺 I-< 列表的更新 囚此， MME 对 UE 进行了呼时，个必在整个 LTE 网络泣山内 l ．播．而只＇，点向 UE 所 A. 的跟跺 18 列« TAL 内数队不太多的基站 eNB 发送 1 呼报义。甘某个从站 eNB 扛·f'到 UE 后， UE 就在小区响应寻呼，触发 eNB 建立与 S-GW 之间的 GTP-U 隧逆。之后， S-GW 把刚才 缓存的 IP 分红 l 转发给 eNB, 内转发给 UE 。 山于分组交换流址的突发性，同时为了节行无线空［ I 资源， UE 经祁会处「空闲状态， 囚此可能会发生频繁的寻呼。 讶用户设备 UE 在空门链路已建立的情况下进行漫游时， UE 就婓在漫游中不断测砒小 ［x廿频信号强度，并将测付结果上报给基站 eNB 。若 eNB 及现有更合适的小区，会触发 UE 进行切换，井在新小区建立空口链路和释放旧小区的空［ l 链路，同时也把 eNB 和 S-GW 之 间的 GTP-U 隧迫从旧小区切换到新小区。巾f S-GW 覆靠范围很大，通常 S-GW 和 P-GW 之间的 GTP-U 隧道并不会重新建立。在切换过桯中，数据迪信不会中断。 • 435 •"}
{"doc_id": "network", "page": 447, "text": "最后还需要指出，前面所讨论的，仅仅足用户）凶血中数耜传送的过程。在控制层面各 节点之间还有非常币要的信令的传送，但这汕议使用不回的协议栈。在 eNB 和 MME 之间， 住 MME 和 HSS 之间，以及在两个 eNB 之间的信令传送，还要用到运输层的第了个协议， 即流控制传输协议 SCTP (Stream Control Transmission Pro tocol) 。协议 SCTP 结合 T UDP 和 TCP 的优点，是面向报文的可靠仕输协议 [FOROIO] [RFC 4960, 建议标准］。但我们没有篇 幅在此进行介绍了。 关于 LTE 的简单介绍就到此为止。 在 4G 无线网络技术中，还钉一个 IEEE 802.16 标准，也就是后米的 Wi MAX 标准。 Wi MAX 是 Worldwi de Interoperability for Microwave Access 的缩马（总思是“全球微波桵入 的互橾作性“，缩马中的 AX 农吓 Access) 。但在流行f若十年后，现什市场士已经很难见 到这种 4G 网络了。因此本书的这 版就取消有关 Wi MAX 的介绍。 2011 年 3GPP 的 RIO （版本 10) 制定 Il勺 LTE-Advanced, 简称为 LTE-A, 达到了 ITU-R 制定的 4G 标准。据 2016 年 6 月的统计，全球投入茼用的 LTE-A 网络已超过 100 个，分布 在 49 个国家和地区。 2015 年 3GPP 的 Rl3 制定了 LTE-A Pro, 吞吐址超过了 3 Gb it/s, 俗称 4.5G, 表示已纾超过 4G 的水半了。 从 2017 年第 4 季度开始， 3GPP 又陆续发布 RI 5 /1 6 等第 5 代蜂窝移动通信系统 5G 标 准的版本（以后还会发布后续的 Rl7) 。这些都是今后的热门技术，对此有兴趣的读者可多 加关注。 9.4 移动 IP 9.4.1 移动 IP 的基本概念 我们知道，手机的一个拈本功能是能够边移动边进行通估。但计符机则不同。在计绊 机网络创建时，就默认了所有的计罚机的位置都是固定不变的。没有人想让笨重的计算机边 移动（如放置在汽车上）边进行通伈。 厄来，便携式的笔记本电脑出现f。现在就出现一种常见的估况。某用户在家中使用 笔记本电脑上网，然后他关机并把笔记本屯脑带到办公卒币新上网。这个电脑在地理上更换 f位置。但川户 0办公生能够很方便地（例如接入到办公室的 Wi -F i)通过动态主机配置协 议 DHCP, 自动获取新的 IP 地卅。虽然电脑＂移动”[,史换J'地点以及所接入的网络， 但这并不是移动 IP 。我们可以石出，这个用户的上网力式，和传统的在固定地点上网相比， 并尤木质上的差异。川户什不向地点上网使用了不同的 lP 地址，但这对用户来说并不重要， 囚为打很多悄况下，用户并不关心他所使用的具体的 IP 地址是什么。 但是，如果我们忐没泊移动中浏览网页，那么移动站所建立的 TCP 连接，在移动站漫 游时，应当一直保持连接，否则移动站勹网站的连桵就会变为断断续续的（因为建立 TCP 连接需要时间，不可能瞬间就建汀女［）。可见，若要使移动站在移动中的 TCP 连接不中断， 就必须使移动站的 IP 地址在移动中保持个变。移动J P (Mobile IP)就是要研究这个间题。 上一节找们已经讨论了了机，怎样在移动时能够保持其 lP 地址不变的工作原理。在计算 机界，怎样使计符机在移动中仍然可以使用它在移动前所使用的 IP 地址，是由C. Perki ns  在 1996 年提出的 [RFC 2002] 。 Perk i ns 在随/J的十儿年把移动 IP 的思路史新了很多，目前最 新的义档是 [RFC 5944, 6275], 都只足建议标准。 下面简单介绍一卜移动 IP 的要点。 • 436 •"}
{"doc_id": "network", "page": 448, "text": "移动 lP 使用了一种方法，和我们几十年前怎样联系同学的做法相似。例如， ·个玑级 的大学生在华业时都将同时走向各自的工作岗位。由于廿先并不知迫l' I 己未来的 l ：作巾付的 准确迪信地址，那么怎样才能继续和这些同学保持联系呢？实际上，、1 ,1时使用的办法也很简 单，就是彼此都留下各自的家庭地址（即永久地址）。若耍和某同学联系，只要＇／j信到该回 学的水久地址，诸其家长把信件转交一下即可。在得知该同学新的地址后，就可使用这个新 地址直接联系仁 移动 IP 使用了如图 9-23 给出的拈本概念 [KUROl7] 。首先，移动站 A 必须付·个原始地 址（相当J一卜面提到的豕庭地址），即永久地址，或归属地址(home address) 。移动站原始迕桵 到的网络 N, 叫作归属网络(home ne tw ork) 。水久地址和们）成网络的关联是不变的。在图 9-23 中，我们可以肴到移动站 A 的永久地址是 13 1. 8.6.7 /1 6, 而其归属网络足 13 1. 8.0.0/16 。 VI 屈网络 N1 131.8.0.0/16  移动站 1 t.,永久地址 1318.67f 16 糖．．．嘈．． 。 I (  ＂屈代理一己乙己了—— 股访网络 N2 15.0.0.0 8  ．．．．．．．纲詈I 憾．．．． 『｀｀“”“匕址 13 1. 8.6. 7/1 6  ＿＿一、、 ｀气 互联网 。 。 通信名 B 包 图 9-23 水久地址与转交地址的作川 为了让地址的改变对互联网的其余部分是透明的，移动 IP 使用了代理。归属代理(home agen t)通常就是连接在归）成网络上的路由器，然而它作为代理的特定功能则是在应川层完成 的。归屈代理既是路由器，也是主机。 当移动站 A 移动到另升个地点，所接入的网络凡称为被访网络(v i s ited ne t work) 或外地 网络(fore ign ne t work) 。被访网络中使用的代理叫作外地代理(fore ig n a gen t),它通常就是连 接在被访网络上的路由器（当然也充当主机）。假定移动站 A 到达的网络是般访网络 15.0.0.0/8 。外地代理的一个任务就是要为移动站 A 创建·个临时地址，叫作转交地址(care­ of address) 。转交地址的网络号显然必须和被访网络一致。我们假定现在 A 的转交地址处 15.5.6.7/8 。外地代理的另一个功能就是及时把移动站 A 的转交地址迪知 A 的归屈代理。 请注意两点：第－·,转交地址是供移动站、归屈代理以及外地代理使用的，各种应川 程序都不使用这种转交地址：第二，转交地址在互联网中并不具有唯一性。这就是说，外地 代理可以给好几个移动站指派同样的转交地址，甚至把自己的 IP 地址指派为移动站的书交 地址。这样做并不会引起混乱。这是闵为当外地代理要向连接在被访网络上的移动站发送数 据报时，并个会像通常那样仗用地址解析协议 ARP, 而足 IT 接使用这个移动站的 MAC 地址 （当移动站首次和外地代理通信时，外地代理就记录下这个移动站的 MAC 地址）。 有时，移动站本身也可以充当外地代理，即移动站和外地代理足同一个设备。这时的 转交地址叫作同址转交地址(co-loca ted care-o f address) 。但是，要这样做，移动站必须能够 接收发送到转交地址的数据报。使用同址转交地址的好处足移动站可以移动到任何网络，而 不必担心外地代理的可用性。但缺点是移动站需耍有额外的软件，使之能够充灯 I,I 己的外地 代狸。 • 437 •"}
{"doc_id": "network", "page": 449, "text": "和1,1 石 个例子。假定在图 9-23 中，迪估者 B'县和移动站 A 进行汕估。 B 并不知道 A 在什么地方。但 B 可以使川 A 的永久地址作为发送的 IP 数据报中的 n 的地址。图中画出了 四个币收步骤： 0 B 发送给 A 的数斟报的目的地址足： 13 1. 8.6.7 。此数据报陂 A 的归屈代狸截获了 （只付、 1'1A 离开丿！屈网络时．”“出代理才能截获发给 A 的数据报）。 0 由于归｝出代理已经知逍f A 的转交地址（后面要讲到），因此肛屈代理把 B 发来的 奻据报进们再封装，新的数摒报的目的地址足： 15.5.6.7, 就足 A 现在的转父地址。 新封装的数据报发送到敬访网络的外地代开！。这出使川的就足以前 4.5.3 节或 4.8.1 节讲过的隧道技术或 IP- i n-IP 。 0 被访网络中的外地代押把收到的封装的数据报进 1 」拆封，取出 B 发送的原始数据 报，然后轧发给移动站 A 。这个数据报的 11 的地址足： 131.8.6.7, 就是 A 的水久地 址。 A 收到 B 发送的原始数据报后．也得到 (B 的 IP 地址。 0 如果现在 A 要向 B 发送数据报，那么估况就比较简，、几。 A 仍然使用自己的水久地 址作为数据报的源地扯，用 B 的 IP 地址作为数摒报的 11 的地址。这个数据报显然 没有必耍在通过 A 的们屈代理进行转发仁 从以上所述可以看出，为f支持移动性．在网络以应当附加以下的．些新功能。 (I) 移动站到外地代理的协议。寸1 移动站接入到骰访网络时，必须向外地代押进行仔记， 以获得 个临时的转父地址。同样地．．l ，1移动站离开该被访网络时，它婓向这个袚访网络注 销其原来的登记。 (2) 外地代理到归属代理的登记协议。外地代押婓向移动站的们屈代则守记移动站的转 交地址。当移动站离开被访网络时，外地代理并不盂攷注销儿在，J I 屈代押登记的轧交地址。 这是囚为、且移动站接入到另，个网络时．这个新的攸访网络的外地代押就会到移动站的归屈 代理仔记该移动站现在的转交地址，这样就取代［原米 Ill 的轧交地址。 (3) 归属代理数据报封装协议。 U I)出代理收到发送给移动站的数据报后，将其 11 j.封装为 一个新的数据报，其 11 的地址为移动站的忱交地址，然后转发 (4) 外地代理拆封协议。外地代理收到门屈代理封装好的数据报后，取出原始数据报， 并将此数据报发送给移动站。 像图 9-23 所小的数据报轧发过程，又称为间接路由选择。这是因为源站并不知逍移动 站的、''1 前地址，而是把数剒报发往移动站的归属网络，以后的、j扯 l 作都巾归屈代理来完成。 现在讨论移动站继续向儿他网络移动时所发牛的估况。 图 9-23 中移动站 A 原先所接入的网络是 N1, 而现在 A 耍从 N1 移动到另一个被访网络 沁去。当 A 移动到凡时，就向 N2 的外地代理登记，凡的外地代理把 A (t凡中的转交地 灶告诉 A 的归屈代理。此后，归屈代押就会把收到的发送给 A 的数据报由封装后转发到 N2 的外地代理。我们注意到，在 A 的这次移动前后，数据报邵足巾相同的们屈代理转发的。 原先转发到 N1, 后来转发到 N20 如图 9-23 所示的这种间倓路由选抒，可能会引起数据报转发的低效，文献中称之为三 角形路由选择问题(tri angle routing p roblem) 。意思是，本来在 B 和 A 之间可能有一条更有效 的路由，但现在要走另外两条路：先要把数据报从 B 发送到 A 的归屈代理，然后再转发给 漫游到被访网络的 A 。设想·个极端的例f。如果 B 所在的网络就是 A 到达的被访网络。 行这种估况下， B 发送数据报给 A 就是仆同一个网络上非，常简便的自接交付，根本不而要 • 438 •"}
{"doc_id": "network", "page": 450, "text": "使用路由器。但由千 B 并不知道 A 的位置，因此只好让发送给 A 的数据报两次穿越广域网． 既浪费了时间，也增加f网上不必要的通信此。 斛决这个问题的一种力法是使用直接路由选择，但这是以增加复杂性为代价的。这种 方法就是让迪估者 B 创建一个通信者代理(corres p onden t agen t),计这个通信者代理向归屈代 理询问到移动站在书趴方网络的转交地址，然后巾通估者代理（而不足由归屈代理）把数据报 用隧迫技术发送到被访网络的外地代开l ．砐后丙由这个外地代理拆封，把数劓报转发给移动 站。 使用这种方法时必须解决以下两个问题： (I) 增加个协议，即移动用户定位协议(mob i le-user location p ro t ocol), 川米仗逌估者 代理向移动站的归屈代理查询移动站的转交地址。 (2) 当移动站再移动到其他网络时，怎样得到移动站的位置信息？关千这个问题，我们 可以川图 9-24 所示的儿个觅耍步骤米说明。 ~ I 屈网洛 购方网络 NI 归卫·· 们从代理一 .. ·彝．． 广域网 。 丁o AE  吻描外地代坪 。 。二N心 、一 新外地代狸 。 @  矶占 B 七一 迪伈片 代PI' 图 9-24 使 Hl1＇［搂路由边扦向移动站发送数据报 B 的迪信者代理从移动站 A 的归属代理得到 A 所漫游到的被访网络凡的外地代理。 我们把移动站首次漫旂到的被访网络的外地代理称为描外地代理(anchor foreign  a g en t)。 通信者代理把 B 发给 A 的故据报再封装后，发送到 A 的铀外地代理。 描外地代理把拆封后的数据报发送给 A 。 A 移动到另·个被访网络 1 '1 2 A 向被访网络 N2 的新外地代理登记。 新外地代理把 A 的新转交地址告诉铀外地代狸。 当铀外地代理收到发给 A 的封装数据报后，就用 A 的新转交地址对数据报进行再 封装，然后发送给被访网络 N2 上的新外地代狸。在拆封后转发给移动站 A 。 同埋，如果移动站再漫游到另·个网络，则这个网络的外地代即将仍然哎和铀外地代 理联系，以使让铀外地代理以后把发给 A 的数据报转发过来。 k 面所讨论的许多问题，都是由移动站在移动时仍然要保持原来的 IP 地址（永久地址） 引起的。我们在文献中常会见到移动性管理（mob i l ity managemen t)这样的术语，这是指十述 的这些新增加的措施和协议。但有时人家更愿使用移动管理这样更加简沾的译名。移动性管 理涉及的面比以上所讨论的问题还要宽些，例如，安全问题也是必须耍解决的。绝对不能容 。 eeoooo  • 439 •"}
{"doc_id": "network", "page": 451, "text": "许不法分f·把别人发送给 A 的数据报，转发到被暗中设定的某个伪造的外地代理。 移动 IP 的实现会遇到很多具体问题。我们知迫，上述的移动 IP 的牡本假定就是移动站 首人必须行一个水久 IP 地址。但哪个运背商会给你的移动设备指派一个水久 IP 地址呢？至 少（1 卜I 1 if［这个问汹｛l．实践中淌未得到解决。限于篇幅，这里不再继续进行讨论了。 9.4.2 移动网络对高层协议的影响 前 1l1 i讲过的儿线网络在移动站漫游时，会经常更换移动用户到无线网络的连接点（即 到移动站相关联的基站）。这样，网络的连接就会发生很短时间的中断。那么，这种情况对 的层协议钉没有影响呢？现在我们简单讨论一下这个问题。 我们知道，在 TCP 迕接中，只要发生报文段的丢失或出错， TCP 就要重传这个丢失或 出错的报义段。在移动川户的悄况下， TCP 报文段的丢失，既可能是由「移动川户切换引 起的令也可能足山「网络发牛了拥塞。 111 f移动用户更新相关联的基站需要一定的时间（即 不可能在数学上的瞬间亢成），这就可能选成 TCP 报文段的丢失。但 TCP 并不知道现在出 现的分组丢失的确切原因。只要出现 TCP 报文段频繁丢失， TCP 的拥塞控制就会采取措施， 杖小其机］寒钳 11 ，从而使 TCP 发送方的报文段发送速率降低。这种措施显然是默认了报文 段上失足山网络拥塞造成的。可见，当无线信道出现严重的比特羌错，或山千切换产生了报 文段丢失．减小 TCP 发送方的拥寒窗口对改善网络性能井不会有仔何好处。 经过研究，发现可以使用三种方法米处理这个问题。 (I) 本地恢复。这是指差错在什么地方出现，就在什么地方改止。例如，在尤线局域网 中使川的自动清求屯传 ARQ协议就屈千本地恢复措施。 (2) 让 TCP 发送方知道什么地方使用了无线链路。只有当 TCP 能够确知，是有线网络 部分发牛（拥寒时， TCP ,1采川拥塞控制的策略。然而要能够区分是在有线网段还是儿线 网段出现报文段 L失，还庙要－·些特殊的技术。 (3) 把含付移动川户的端到端 TCP 迕接拆成两个互相串接的 TCP 连接。从移动用户到 尤线接入点足一个 TCP 连接（这部分使用无线伯逍），而剩下的使用有线网段连接的部分则 足另 个 TCP 迕桵（我们假定 TCP 连接的另一端是有线主机）。已经行人研究过，采川拆 分 TCP 连搂的方法，在使川无线信逆的 TCP 连接 r., 既可以使用标准的 TCP 协议，也可以 使用有选1 t确认的 TCP 协议，其至还可以使用专用的、有差错恢复的 UDP 协议。在蜂窝无 线通（L］网中实验的结果农明，采川拆分 TCP 连接的方法可以使整个性能得到明显的改进。 9.5 移动通信的展望 前而我们已经介绍了移动迪信与计饮机网络关系较密切的若干问题。为便干记忆，蜂 窝移动逌（心从 IG 到 4G 的发展规11i，可以认为大约是十年更新一代。从垃初的 IG （校拟屯 话），发展到 2G （数字电话），然后演进到具有较强数据传输能力的 3G, 冉到可支持高质址 许频和视频传输和，凶速率移动互联网业务的 4G （全 IP 网）。现在又发展到了第五代蜂窝移 动逋伈 5G, 县年连 5.5G 或 6G 也相继被提出了。在我国，工信部已千 2019 年 10 月 31 Fl  宜:{ii 5G 的商川正式启动。下面简要地介绍一下 5G 的要点。 从 IG 到 2G, 通估心必局限在人与人之间的通信。到 (3G 和 4G 时代，年？能手机不仅 能够提供人与人之间通信，而且还发展到 11I 以提供多人参加的视频聊天。此外，还增加了人 • 440 •"}
{"doc_id": "network", "page": 452, "text": "与互联网之间的通信（下载文件、音乐、视频皊）。这种迪估Ji式均可称为人联网。 找们在前而 9. 1. I 节中苦简 1礼地介绍了物联网 IoT. 物联网现孔发展很快，在 4G 时代就 已经有f一些物联网的应用。但 5G 就非常明确地把物联网作为介个非常重要的应用领域。 现在 5G 标准的制定机构 3GPP 把 5G 的传输＼IV 务划分为以下一．大类（在 5G 标准中称 为三大应用场烘），即： (I) 增强型移动宽带 eMBB (enhanced Mobile BroadBand)  (2) 大规模机器类型通信 mMTC (massive Machine Type Communication)  (3) 超高可靠超低时延通信 u R.LLC (ultra Reliable and Low Latency Communication)  第一种应川场炽 cMBB 实际上就丛 4G LTE 的升级版本，它仍然屈干人联网。在这一类 应用场杲中， 5G 要传输的新型、I v.务主＇必是：：：维（即 30) 视频和超高清视频等大流阰移动宽 带业务。 3D 视频包括虚拟现实 VR (Virtual Real ity)和增强现实 AR (Augmented Real ity)。 I潘．面的后两种 I应用场呆 mMTC 和 uRLLC 都屈j'·物联网。 mMTC 又称为海量物联网， 这种应用场烘的数据率较低 H．时延并小枚感，但其迕俀的终端种类却作常广泛，不仅耍求网 络具付超干亿连接的义持能力，而且终瑞成本必须很低而电池片命却疫求很长，例如 10 年 以上。这类应II1 场呆包括智慧城市、秤能家居、钾能屯网、物流跟踪、环境监测等力而。应 用场烘 uRLLC 则使用（f.工业控制、交通安全和控制、远程制造、远程于术以及无人饮驶等 领域。 为了适应卜述三种应用场烘， 5G 制定的标准规足具下行数据峰伯速率为 IO Gbit/s （常 规情况下），而在特定场烘（ VR 和 AR) 时数据率可达 20 Gb it/ s 。 5G 还制定f新的空口标 准 5GNR (5G New Rad i o), 使用户层而无线信逆的单向时延大大缩短（可小到咂秒级），这 就保证了 5G 的整个瑞到端时延均可满足各种应用场烘的需求。 5G 还采用f一些比 4G 更高 的频率，可使用更人的估道带宽，这付助干提高数据的传输速率。 5G 的频讲效率 (UI) 在同 样带宽卜札输的数扑凇）也比 4G 的附加数倍 因此 5G 的特点．可以简单地们纳为：极席的 速率，极大的容护，极低的时延。值得注意的足， 5G Ji非 4G 的简 rl 升级版本，而处在应 用方面有许多崭新的领域，只钉划时代的意义。 在使用的频谱方面， 5G 引入了诅米波，即频率在 30~300 GHz 之间的无线电波，其波 长为 1~10 mm 。这里面还有许多新的技术问题有待千进行研究和解决。 5G 还选用了与 4G 不同的信道编码力式。 5G 的大线也付多方礼i的创新＾例如，采用天线波束赋形技术，并把 多进多出 MIMO 发展到大规十贞 MIMO 系统和江体飞维 MIMO 技术，笘＾夺。 在更高的 I ．作频年下．钳个基站的骰盖范 1111 就缩小丿＇，估l 曲 5G 所架设的丛站必须更加 密集。这显然就增加f 5G 网络的复朵性，也增加f网络运仵商的投资和运仵成本。因此 5G 的发展前从不怕U 足个简中．的学术性或技术水平问题，而是与未米的商业市场密切相关 的。也就是说，上述的三个应川场呆今后究竟会发展到何种水 1,.. n 前还都是未知。我们在 学习 5G 新技术时，对此应f]足够的屯视。 本章的重要概念 • 无线｝｀＇｝域网可分为两大类。第类是付固定基础设施的，第一类是无固定桂础设施的。 • 无线忖域网的标准丛 IEEE 的 802.11 系列。使用 802.11 系列协议的屈域网又称为 Wi -F i。 • 441 •"}
{"doc_id": "network", "page": 453, "text": "• 802.11 尤线以太网杯准使用星形拓扑，具中心叫作桵入点 AP, 它足链路层设各， 扑 I 、,,, j基本服务从内的丛站．但家用的接入点都嵌入［路由器的功能，常称为无线 路Li l~异。 • 应＇＇，打沾儿种不同的接入：固定俀入、移动搂入、便拱接入和游牧接入． • 802.11 无线以太网(t: MAC 层仗ffJ CSMNCA 协议。不能使用 CSMNCD 的原因是： （r 儿线的域网中，并非所付的站．，从都能够听见对方（例如，、11 有冈碍物出现在站，心i 之间时），因此儿法实现碰撞检测。使fl/ CSMA/CA 协议是为了尽坎减小碰撞发牛 的概率，f11 个能几个避免碰撞。 • CSMA/CA 协议的性点足： （ 1) 发送故据有时可不经过争用期，这丛因为（出道在较 长时间足空 lA-J的，很可能这时具他站．，慧个会发送数捉。 (2) 发送数据有时必须经过 争f Ill 阴，这足因为： 0 信逍是从打转到空闲，可能有多个站，I.＼要发送数据，因此耍 公平兑争。＠未收到确认，表明很可能出现了冲突，出传时找公平兑争。 O 连续及 送数.JJ.1;, 队 l 卜一个站．，、I．i.)和断信逆，要公、F 竞争。 (3) 必须等待时间 DIFS 的理由， 足让具有史，们要的帧能够优先发这（如 ACK 帧、 RTS 帧或 CTS 帧＾沁。 • 802.11 九线忖域网在使用 CSMA/CA 的同时，还使用梓止笘；待协议。 • 802.11 杯准规定，所有的站在心戊发送J百，必须再等待一段帧间间隔时间才能发送 卜 ·I帧。帧间间 1补的长知取决！·.该站歧发送的帧的优先级。 . 在 802.11 儿线肋城网的 MAC 帧首部中付一个持续期字段，J廿米拍入在本帧结束后 还歧占用（，·;m 多少时间（以微秒为单位） • 802.11 标准允许找及送数据的站对估逍进行预约，即在发送数据帧之前先发送 RTS 帧i 11J求发达。在收到响应允许发送的 CTS 帧后，就可发送数据帧。 • 802.11 的 MAC 1 j吹）凶：种类坚，即控制帧、数据帧和行］1 凇。盂要让总的是， MAC 帧付四个地址字段 （环固定基础设施的无线J.,j域网中，只使用其中的三个 地址宁段，即源地址、 II 的地址和 AP 地址 BSSID 。 . 儿线个人区域网包括蓝牙系统、 Z ig Bec 和超的速 WPAN 。尤线城域网 Wi MAX 已 很少使fll, • 移心终端已成为现 (I接入到互联网的主要末端设备。视频和数据已在兀联网的流桢 中占 11, 灯t·~地位。 • 迪过儿线忖域网或蜂窝移动迪信网接入到互联网，已经成为桵入到兀联网的主要}j 式． • 第一代i个窝移动迪信网采川校拟技术的电路交换，仪提供话许通信 第一．代蜂窝移 动逋估网以 GSM 为代表，采川数字技术的电路交换，提供话齐通们和短信服务。 • GPRS 和 EDGE 捉必了敌据率，话音迪信使用电路交换，数据通估使用分组交换， l．网能够浏览网丸第．．．代蜂窝移动迪信网以 UMTS 为代农，数据率提翡到可以 进 h 视频迪信和丿「视频会议 • 第四代蜂凶移动迪化网以长）阴演进 LTE 为代表，采用的飞介调制 64QAM, 以及 OFDM 和 MIMO \"!{,技术．使数据牛心启并提高。在结构上，拴制炽血和用户层面（即数据 层仙）分丿|．．，核心网全部 IP 化、大大降低了役资成本和运仵费用。 • 基沽 cNB 到分组网关 P-GW 之间利用 GTP-U 隧逍 <eNB-S-GW 和 S.GW一 P­ GW), 保 ul: f用户设备仆移动时仍能有效地搂入到互联网。 • 442 •"}
{"doc_id": "network", "page": 454, "text": "习题 9-01 无线局域网由哪几部分组成？无线局域网中的固定基础设施对网络的性能有何影 响？接入人忖 AP 是否就是无线局域网中的固定基础设施？ 9-02 Wi -F i与无线局域网 WLAN 是否为同义词？诸简单说明一下。 9-03 服务集标识符 SSIO 与基本服务娸标识符 BSSID 有什么区别？ ESSID 是什么意思？ 9-04 无线局域网中的关联（assoc i a ti on) 的作用是什么？ 9-05 固定接入、移动接入、便携接入和游牧接入的主要特点是什么？ 9-06 无线局域网的物理层主要有哪几种？ 9-07 无线局域网的 MAC 协议有哪些特点？为什么在无线局域网中不能使用 CSMNCD 协 议而必须使用 CSMNCA 协议？ 9-08 为什么无线局域网的站点在发送数据帧时，即使检测到信道空闲也仍然要等待一小 段时间？为什么在发送数据帧的过程中不像以太网那样继续对信迨进行检测？ 9-09 结合隐蔽站问题说明 RTS 帧和 CTS 帧的作用。 RTS/CTS 是强制仗用还是选择仗用？ 请说明理山。 9-10 为什么在无线局域网上发送数据帧后，要求对方必须发回确认帧，而以太网就不需 要对方发回确认帧？ 9-11 无线局域网的 MAC 协议中的 S JF S 和 DIFS 的作用是什么？ 9-12 试解释无线局域网中的名词： BSS, ESS, AP, BSA, DCF, PCF 和 NAY 。 9-13 冻结退避计时器剩余数伯的做法是为了使协议对所有站点更加公平。请进一步解释。 9-14 为什么站点在检测到信道空闲后，在等待时间 DIFS 内还不能立即发送数据？为什么 在等待时间 DIFS 后，有时可立即发送数据，而有时必须执行退避算法？ 9-15 试用简单的例子说明无线局域网的 MAC 帧首部中地址 3 的作用。 9-16 试比较 IEEE 802.3 和 IEEE 802.11 局域网，找出它们之间的主要区别。 9-l7 无线个人区域网 WPAN 的主要特点是什么？现在已经有了什么标准？ 9-l8 试举例说明怎样知道一个用作无线路巾器的接入点 AP 的 SSID 和 BSS JD? 9-19 第二代蜂窝移动通信网与第一代蜂窝移动通信网的主要区别是什么？第三代蜂窝移 动通信网与第二代蜂窝移动通信网的七要区别是什么？ 9-20 第四代蜂窝移动通信网与第三代蜂窝移动通信网的主要区别是什么？ 9-21 我们在第 1 菜中就讲过，电路交换适合于话音通信，分组交换适合千数据通信。为 什么现在第四代蜂窝移动通信网 LTE 全部使用分组交换进行话音通信和数据通信？ 9-22 在图 9-21 的例子中，若从百度网站服务器发送数据分组到用户设备，诮写出每一段 路径的分组甘部中的目的地址和源地址。 9-23 在蜂窝移动通信网中，移动站的漫游所产生的切换，对正在工作的 TCP 连接有什么 影响？ 9-24 某牡馆中有两个 ISP 分别设置了接入点 AP1 和 AP2, 并且都使用 802.llb 协议。两个 ISP 都分别有自己的 IP 地址块。 (I) 假定两个 ISP 在配饥其接入点时都选择了信道 11 。如果有用户 A 和 B 分别仗用 接入点 AP1 和 AP2 ，那么这两个无线网络能够正常工作吗？ (2) 若这两个 AP 一个工作在信道 l ，而另一个工作在信道 ll ，题目的答案有变化吗？ • 443 •"}
{"doc_id": "network", "page": 455, "text": "9-25 为什么采用预约信道的方法可以较好地解决隐蔽站的问题？ 9-26 假定有一个使用 802.l lb 协议的站要发送 1000 字节长的数据帧（已包括了首部和尾 部），并使用 RTS 和 CTS 帧。试计算，从决定发送帧一直到收到确认帧所经历的时 间（以微秒计），忽略传播时间和误码率。 9-27 有如图 9-25 所示的四个站点使用同一无线频率通信。每个站点的无线电覆盖范围都 是图 9-25 所示的椭圆形。也就是说， A 发送时，仅仅 B 能够接收； B 发送时， A 和 C 能够接收； C 发送时， B 和 D 能够接收； D 发送时，仅仅 C 能够接收。 现假定每个站点都有无限多的报文要向每一个其他站点发送。若无法直接发送，则由 中间的站点接收后再转发。例如， A 发送报文给 D 时，就必须是经过 A 一 B, B 一 C 和 C 一 D 这样三次发送和转发。时间被划分成等长的时隙，每个报文的发送时间恰好 等千一个时隙长度。在一个时隙中，一个站点可以做以下事情中的一个： 0 发送一 个报文； O 接收一个发给自己的报文； 0 什么也不做。再假定传输无差错，在无线 电毅盖范围内都能正确接收。 ．．．．．．．．．．．．．．．．．安· · ;:2........:: 、.之::::.. ··.·.:::,-,::::..... ••••·····  沁． 飞- t足，（｀ `_ .、··..... ·.、...^.、森·:．．．：：反·/...9··· · ··· ··• ••  ··············:?..::,..,名．．．．．．：；..,之．．．．．．．．．一：；．、心．．．．．．．········ 图 9-25 习题 9-27 的图 (I) 假定有一个全能的控制器，能够命令各站点的发送或接收。试计算从 C 到 A 的 最大数据报文传输速率（单位为报文／时隙）。 (2) 假定现在 A 向 B 发送报文， D 向 C 发送报文。试计算从 A 到 B 和从 D 到 C 的最 大数据报文传输速率（单位为报文／时隙）。 (3) 假定现在 A 向 B 发送报文， C 向 D 发送报文。试计算从 A 到 B 和从 C 到 D 的 砓大数据报文传输速率（单位为报文／时隙）。 (4) 假定本题中的所有无线链路都换成为有线链路。重做以上的(I) 至(3) 小题。 (5) 现在再回到无线链路的情况。假定在每个目的站点收到报文后都必须向源站点发 回 ACK 报文，而 ACK 报文也要用掉一个时隙。重做以上的(I) 至 (3) 小题。 • 444 •"}
{"doc_id": "network", "page": 456, "text": "附录 A 部分习题的解答 第 1 章 1-10 分组交换时延较电路交换时延小的条件为： (k-I) plb<s, 当 x>> p时 1-11 ~出总时延 D 的表达式，求 D 对p的导数，令其为零。解出 p=[x而可 口 5 DID。 =10 现在的网络时延是最小值的 10 倍。 口 7 (1) 发送时延为 100 S, 传播时延为 5 ms. (2) 发送时延为 I µs, 传播时延为 5 ms 。 若数据长度大而发送速率低，则在总的时延中，发送时延往往大千传播时延。但若数 据长度短而发送速率高，则传播时延就可能是总时延中的主要成分。 1-18  媒体长度 传撸时延 媒体中的比特数 数拭平＝ I Mbil/ s 数挝韦＝ IOGbil/s (I) 0.1 m 4.35x!O一 10 S 4.35x !O_. 4.35  (2) 100 m 4.35xl0-7 s 0.435 4.35xl01  (3) 100 km 4.35xl0_. s 4.3Sxl <r 4.35x!06  (4) 5000 km 0.0217 s 2.17xlO' 2.17x101  1-19 数据长度为 100 字节时，数据传输效率为 63.3% 。数据长度为 1000 字节时，传输效 率为 94.5% 。 1-28 (1) 1.458 s (2) 124.258 s (3) 6.28 s (4) Is  1-29 3.2 Mb it/ s 。如果改为发送 512 字节的分组，则发送速率应为 16.38 Mb it/s 。 1-30 所要画出的图如图 A-1 所示。 20000km  发送速率＝ I kbit/ s~ 100bit = b  把 100b it发送完时，第一个比特正好到达终贞 . 50b it= b  再经过 0.05s, 线路上还剩下 50b it,最后一个比特走到线铭的一半 1-31 所要画出的图如图 A-2 所示。 100bit  发送逑水一 I Mbir/ s JI＝今 .  图 A•I 习题 1-30 的图 20000km  把 IOOb il发送完盯．第一个比特只走了 20km IOObil  n- 再经过 0.05 S, 最后一个比特刚刚走到线路的一半 图 A-2 习题 1-3 I 的图 .  .  • 445 •"}
{"doc_id": "network", "page": 457, "text": "1-32 在以时间为横坐标的图上，每一个比特的宽度是 I ns 。 在以距离为桢坐标的图七，每一个比特的宽度是 20cm 。 1-34 (I) 5 s: 15 s 。 (2) 0.015S: 0.015 S: 5.01 S 。 1-35 (1)2x 104b 止（2) 250 m 。 (3) 50 b it/s 。 1-36 吞吐挔为 500 kb it/s 。传送时间约为 42 s 。 第 2 章 2-06 一个码元不一定对应于一个比特。 2-07 80000 b it/s 。 2-08 SIN= 64.2 dB 是个信噪比很商的信道。 2-09 信噪比应增大到约 100 倍。 如果在此基础上将信噪比 SIN 再增大到 10 倍，最大信息速率只能再增加 18.5 ％左右。 2-11 使用这种双绞线的链路的工作距离＝ 28.6 km.  若 T 作距离增大到 100km, 则衰减应降低到 0.2 dB/km.  2-12 1200 nm 到 1400 nm: 带宽＝ 23.8 THz  1400 nm 到 1600 nm: 带宽＝ 17.86 THz  2-16 A 和 D 发送 l, B 发送 0 ，而 C 未及送数据。 2-18 靠先进的编码，使得每秒传送·个码元就相呏千爵秒传送多个比特。 第 3 章 3-06 PPP 适用于线路从整不太差的悄况下。 PPP 没有编号和确认机制。 3-07 添加的检验序列是 1110 。出现的两种差错都可以发现。仅仅采川了 CRC 检验，数据 链路层的传输还不是可靠的传输。 3-08 余数是 011 。 3-09 7E FE 27 7D 7D 65 7E  3- 10 第个比特串：经过零比特填充后变成 011011111 QI I I I I QOO （加上下划线的 0 是填充 的）。 另·个比特串：删除发送端加入的零比特后变成 000111011111-11111-I IO （连字符表 示删除f O).  3-11 (I) 由」．电话系统的带宽有限，而几还有失贞，囚此电话机两端的输入卢波和输出声 波是有诠异的。在“传送声波”这个意义上讲，f,f通的电话通信并不是透明传输。 但对“听忳说话的总思”来讲，则基本上是透明传输。们有时个别诏音会听错， 如单个的数字 1 和 7 。这就不足透明传输。 (2). 般说来，电子邮件是透明传输的。但有时不是。因为国外有些邮件服务器为了 防止垃圾邮件，对来自某些域名的邮件一伟阻拦棹。这就不是透明传输。有些邮 件的附件在收件人的电脑」：打不丿干。这也不是透明传输。 3-14 当时很可靠的星形拓扑结构较贵。人们都认为无源的总线结构更加可靠。但实践证明， 连接付大城站）队的总线式以太网很容易出现故障，而现在专川的 ASIC 芯片的使Jlj可 以将杞形结构的集线器做得非常可靠。因此现在的以太网一般都使用星形结构的拓扑。 3-16 每秒 20 兆码元。 • 446 •"}
{"doc_id": "network", "page": 458, "text": "3-19 从网络 I ；负载轻重、灵活性以及网络效率等方面进行比较。 网络上的负荷较轻时， CSMNCD 协议很灵活。但网络负荷很重时， TOM 的效率就 很高。 3-20 砐短帧长为 10000 b it,或 1250 字节。 3-21 “比特时间”换绊成“微秒＂必须先知追数据率是多少。如数据率是 10 Mbit/s, 则 100 比特时间等于 10 µs 。 3-22 对于 10 Mb it/s 的以太网，等待时间是 5.12 ms 。 对于 100 Mb it/s 的以太网，等待时间是 512 µs 。 3-23 实标的以太网各站发送数据的时刻是随机的，而以太网的极限信道利用率的得出是假 定以太网使用了特殊的调度方法（已经不再是 CSMNCD 了），使各站点的发送不发 生碰撞。 3-24 设在t = 0 时 A 开始发送。在 I= 516 比特时间，如尤碰撞，则 A 应当发送完毕。 I= 225 比特时间， B 就检测出 A 的信号。只要 B 在 I= 224 比特时间之前发送数据， A 在发送完毕之前就贡定能检测到碰撞，因此 A 不能把自己的数据发送完毕。 如果 A 在发送完毕之前并没有检测到碰掩，那么就能够肯定 A 所发送的帧不会和 B 发送的帧发生碰撞（当然也不会和其他站点发生碰撞）。 3-25 l = 0 时， A 和 B 开始发送数据。 t= 225 比特时间， A 和 B 都检测到碰撞。 t= 273 比特时间， A 和 B 结束干扰信号的传输。 /= 594 比特时间， A 开始发送。 I= 785 比特时间， B 再次检测估道。如空闲，则 B 将在 881 比特时间发送数据。 A 里传的数据在 819 比特时间到达 B, B 先检测到信道忙，因此 B 在预定的 881 比特 时间不发送数据。 3-26 提示：将第 1 次重传失败的概率记为 Pi，显然 P,= (0.5)\", k = min[i, 10]  故第 1 次重传失败的概率 Pi =0.5,  第 2 次屯传失败的概率 P2 = 0.25,  第 3 次重传失败的概率 P3 = 0.125 。 P［传送i次才成功］ =P［第 1 次传送失败］ P［第 2 次传送失败］… P［第i- I 次传送失败］ P［第 1 次传送成功］ 求｛P［传送i次才成功］｝的统计平均值，街出平均业传次数为1.637 。 3-27 (I) 10 个站共享 10 Mb it/s 。 (2) 10 个站共亨 100 Mbit/s 。 (3) 每一个站独占 10 Mbit/s 。 3-30 最大吞吐垃为 1100 Mb it/s 。＝外个系各有－台主机分别访问两个服务器和追过路由器 上网。其他主机在系内通信。 3-31 最大吞吐段为 500 Mbit/s 。每个系是一个碰撞域。 3-32 最大乔叶垃为 100 Mb it/s 。整个系统是一个碰撞域。 3-33  动作 A 发送帧给 D D 发送帧给 A 交换表的状态 写入(A.1) 向哪些接口转发帧 1 说明 略略 ．，才入 (D.4) 略 略 • 447 •"}
{"doc_id": "network", "page": 459, "text": "第 4 章 动作 E 发送帧给 A A 发送帧给 E 王二门 1 ：向哪些接口转发帧 1 ：说明 4-09 好处：转发分组更快。缺点：数据部分出现差错时不能及早发现。 续表 4-10 IP 首部中的源地址也可能变成错误的，要求错误的源地址上的主机重传数据报是没 有意义的。不使用 CRC 可减少路山器进行检验的时间。 4-11 I 000 IO 11 I O 11000 I  4-12 8B81  4-14 在目的站而不是在中间的路由器进行组装是由于： （ I) 路由器处理数据报更简单些； (2) 并非所有的数据报片都经过同样的路由器，因此在每一个中间的路由器进行组装 可能总会缺少几个数据报片： （ 3) 也许分组后面还要经过一个网络，它还要给这些数 据报片划分成更小的片。如果在中间的路由器进行组装就可能会组装多次。 4-15 由于分片，共分为 4 个数据报片，故第二个局域网向上传送 3840 b it。 4-16 (I) 当网络中某个 lP 地址和硬件地址的映射发生变化时， ARP 商速缓存中的相应的 项目就要改变。例如，更换以太网网卡就会发生这样的市件。 10~20 分钟更换一 块网卡是合理的。超时时间太短会使 ARP 诮求和响应分组的通信员太频繁，而 超时时间太长会使更换网卡后的主机迟迟无法和网络上的其他主机通信。 (2) 在源主机的 ARP 高速缓存中已经有了该目的 IP 地址的项目：源主机发送的是广 播分组：源主机和目的主机使用点对点链路。 4-17 6 次。主机用一次，每一个路由器各使用一次。 4-18 (I) 接口 0: (2) R2: (3) 阳 (4) R3: (5) 凡。 牛20 3 个。数据字段长度分别为 1480, 1480 和 1020 字节。片偏移字段的伯分别为 0, 185 和 370 。 MF 字段的值分别为 I, I 和 0 。 4-22 共同前缀是 22 位，即： 11010100 00111000 100001 。聚合的 CIDR 地址块是： 212.56.132.0/22 。 4-23 前一个地址块包含了后一个。写出这两个地址块的二进制表示就可行出。 4-24 答案如图 A-3 所示。 190.16.6.2  三一．未知．－ 180.15.2.5  三－未知··· 图 A-3 习题 4-28 的图 • 448 •"}
{"doc_id": "network", "page": 460, "text": "4-25 分配网络前缀时应先分配地址数较多的前缀。题目没有说 LA凡上有几台主机，但至 少需要三个地址给三个路由器使用。本题的解答有很多种，下面给出两种不同的答案： 策一组答案 第二组答案 LANI 30 138.119.192/29 30.138.118.192/27  LAN2 30.138.119.0/25 30.138.118.0/2 5  LAN) 30.138.118.0/24 30.138.119.0/24  LAN• 30.138.119.200/2 9 30.138.118.224/27  LANs 30.138.119.128/2 6 30 138.l 18.128n7  第一组和第二组答案分别用图 A-4(a) 和 (b) 表示。这样可看得消楚些。图中注明有 LAN 的三角形表示在三角形顶点下面所有的 lP 地址都包含在此局域网的网络前缀中。 30.138.11 8/2 3 ＝的~0 00000000 (2 3 位的网络前缀有下画线） /2: ::.::~飞…．．．．．．·············· A: 512 个 IP 地址 /24..... 气.................. D 0 /25..  126  /27  /28  129  ~G  B: 256 个 IP 地址 D: 128 个 IP 地址 F: 64 个[P地址 J, K: 各 8 个 IP 地址 00 A-4(a)  30.138.118/2 3=00Q111101()0010IOOIIIOlIOOOOOOOOO (23 位的网络前绕有下画线） ~~! :::::::::::~艾~:::::::::::::: ~: ;;; : ;它 /25  /2 6  /27  /28  129  D: 128 个 1P 地址 E.F,G: 各 32 个 IP 地址 图 A-4(b) 4-26 本题的解答有很多种，下面给出其中的一种答案（先选择需求较大的网络前缀）： LAN1: 192.77.33.0/26 。 LAN3: 192.77.33.64/27; LAN6: 192.77.33.96/27; LAN7: 192.77.33.128/2 7:  LANs: 192.77.33.160/27.  LAN2: 192.77.33.192/28; LAN4: 192.77.33.208/2 8.  LAN5: 192.77.33.224/29 （考虑到以太网上可能还要再接几台主机，故留有余地）。 WAN1: 192.77.33.232/30; WAN2: 192.77.33.236/30; WAN3: 192.77.33.240/30 。 4-27 观察地址的第二个字节 Ox32 = 00100000, 前缀 12 位，说明第二字节的前 4 位在前缀中。 给出的四个地址的第二字节的前 4 位分别为： 0010, 0100, 0011 和 0100 。因此只有(l) 是匹配的。 4-28 前缀（ l ）和地址 2.52.90.140 匹配。 • 449 •"}
{"doc_id": "network", "page": 461, "text": "4-29 前缀(4) 和这两个地址都匹配。 4-30 (1)/2; (2)/4; (3) /1 1: (4)/30 。 4-31 最小地址是 140. I 20.80.0/2 0 。 奻大地址是 140.120.85.255/20 。 地址数是 4096 。相当千 16 个 C 类地址。 4-32 砐小地址是 190.87.140.200/29 。 奻大地址是 140.120.85.255/29 。 地址数是 8 。相当于 1/32 个 C 类地址。 4-33 (I) 每个子网前缀 28 位。 (2) 每个了网的地址中有 4 位留给主机用，肉此共有 16 个地址。 (3) 四个子网的地址块以及每个子网分配给主机的最小地址和最大地址是： 第一个地址块 136.23.12.64/28, 可分配给主机使用的 砓小地址： 136.23.12.65 最大地址： 136.23.12.78 第二个地址块 136.23.12.80/28, 可分配给主机使用的 最小地址： 136.23.12.8 I  最大地址： 136.23.12.94 第三个地址块 136.23.12.96/2 8, 可分配给主机使用的 最小地址： 136.23.12.97 最大地址： 136.23.12.110 第四个地址块 136.23.12.11 2/28, 可分配给上机使用的 最小地址： 136.23.12.113 最大地址： 136.23.12.126 4-36 RIP 只和邻站交换信息， UDP 虽不保证可靠交付，但 UDP 开销小，可以满足 RIP 的 要求。 OSPF 使用可靠的洪泛法，并直接使川 IP, 好处是灵活性好和开销更小。 BGP 衙要交换整个的路由表（在开始时）和更新信息， TCP 提供可靠交付以减少带宽的 消耗。 RlP 使用不保证可靠交付的 UDP, 因此必须不断地（周期性地）和邻站交换信息才 能使路由估息及时得到更新。但 BGP 使用保证可靠交付的 TCP, 因此不需要这样做。 4-37 路由器 B 更新后的路出表如下： N, 7 A 尤新信息，不改变。 N2 5 C 相同的下，跳，更新。 N3 9 C 新的项目，添加进来。 凡 5 C 不同的下一跳，距离更短，更新。 沁 4 E 不同的下一跳，距离·样，不改变。 N9 4 F 不同的下－跳，距离更大，不改变。 4-38 (I) eBGP (2) iBGP (3) cBGP (4) iBGP  4-39 (I) 从接门 1 转发。 (2) 从接口 2 转发。 (3) 从接口 1 转发． 4-43 (I) 129.11.11.239 (2) 193.131.27.255 (3) 23 1.219.139.111 (4) 249.155.25 1.15  4-44 1024  • 450 •"}
{"doc_id": "network", "page": 462, "text": "4-45 网络掩码是 255.255.255.224 。网络前缀长度是 27, 网络后缀长度是 5 。网络前缀是 167. 199.170.64/27 。 4-46 地址块的首地址： IO I 00 11 I 11 000111 IO IO IO IO O I 000000  地址块的未地址： I O I 00 I 11 II 000 II I I O l O I O ! 0 0 I O l I II I  地址数： 32 4-47 分配给子网 N1 (/25) 的首地址足 14.24.74.0, 末地址是 14.24.74.127 。 分配给子网 N2 (/26) 的首地址是 14.24.74.128, 未地址是 14.24.74.191 。 分配给子网 N3 (/28) 首地卅是 14.24.74.192, 末地址是 14.24.74.207 。 4-48 (I) 路由器 R 的路山表 网络前缀 下一跳 145.13.0.0'18 l.i搂交付．接 11 mO  145 13.6-1.0 18 fUk'之付．接 11ml 145.13.128.0d!! 叫＆父付，接 11 m2  145.13.192.0'II! IT 杖父付，接 11 m3  0.0.0.0 0 欢认劝由器．搓 11 nl4  (2) 收到的分组从路山器的搂 11 m2 转发。 4-49 根据最长前缀匹配准则，应当选择路由 3 。 4-50 蚊长前缀匹配准则是没有问题的，问题出在主机 H 的 IP 地址。 谓注意，网络 11.1.2.0/24 是网络 11.0.0.0/8 的一个f·网， 1 （1i lP 地址 1 1.1. 2.3 正是子网 11.1.2.0/24 中的一个合法 lP 地址。网络 11.0.0.0/8 在分配本网络的主机号时，不允许 亟复使用f网 11.1.2.0/24 中的任何一个地址。因此，网络 11.0.0.0/8 给它的一台主机 分配 1P 地址 1 1.1. 2.3 足不能允许的。这样做就和网络 11.1.2.0/24 中的 IP 地址 1 1.1. 2.3 贞复，因而引起了地址上的混乱。 4-51 (I) 200.56.168.0/21 = ~000 00000000  上面有下圃线的粗体数字表小网络前缀． (2) 这个 CIDR 地址块包含 8 个 C 类地址块。 4-52 对首部的处理更简单。数据链路层已经将有差错的帧丢釬f，因此网络层可省去这一 步骤。但可能遇到数据链路仄检测刁、出来的经错（此概率极小）。 4-53 在 IP 数据报传送的路径上所有路由器都不需要这·字段的信息，只有目的主机才需 要协议字段。在 1Pv6 使用“卜．一个首部”字段无成 1Pv4 中的＂协议”字段的功能。 4-55 分片与觅装足非常耗时的操作。 1Pv6 把这一功能从路巾器中删除，并移到网络边缘 的主机中，就可以大大加快网络中 IP 数据报的转发速度。 4-56 1Pv6 的地址空间共,ff 2128 个地址，或 3 ,4 X 10380  1 秒分配 10“ 个地址，可分配1. 08 X 101) 年。大约是宇宙年龄的 1000 倍。地址空间的 利用不会足均匀的，但即使只利用整个地址空间的 1 /1 000, 那也是不可能用完的。 4-57 (I) ::F53:6382:AB00:67DB:B827:7332  (2) ::4D:ABCD  (3) ::AF36:7328:0:87 AA:398  (4) 2819:AF::35:CB2:8271  4-58 (I) 0000:0000:0000:0000:0000:0000:0000:0000  • 451 •"}
{"doc_id": "network", "page": 463, "text": "(2) 0000:00AA: 0000:0000:0000:0000:0000:0000  (3) 0000: 1234: 0000:0000:0000:0000:0000:0003  (4) 0123 :0000:0000:0000:0000:0000:000 I :0002  4-63 (1) 路由器 R1 的转发表如下： 前缀匹配 转发接口 123.1.2.16/2 9 4  (2) 无法实现给出的条件。 4-64 (I)  前缀匹配 转发接口 224.0.0.0/1 6 I  224.0.0.0/15 。 224.0.0.0/7 2  224.0.0.0/5 3  其他 3  (2) (a) 接口 2: (b)接口 l: (c) 接口 3 。 4-66  匹配 动作 入端口＝ I: IP 源地址＝ 10 3 •.•: IP 目的地址＝ 10. 1.•.• 转发(2) 入端口＝ 2: IP 源地址＝ 10. 1.*.•: IP 目的地址＝ 10.3.•.• 转发(I) 入端口＝＊： IP 源地址＝ 10.3.•.•: IP 目的地址＝ 10.2.0.3 转发(3) 入端口＝＊： IP 源地址 a 10.3.•.•: IP 目的地址＝ 10.2.0 .4 转发(4) 入端口＝ 3: IP 源地址＝ 10.2.0.3: IP 目的地址＝ 10.2.0 .4 转发(4) 入端口 :4: IP 源地址＝ 102.0.4: IP 目的地址＝ IO2.0.3 转发(3) •••••• ,.....  第 5 章 5-03 都是。这要在不同层次来看。在运输层是面向连接的，在网络层则是无连接的。 5-06 丢弃。 5-11 IP 数据报只能找到目的主机而无法找到目的进程。 UDP 提供对应用进程的复用和分 用功能，并提供对数据部分的差错检验。 5-12 不行。重传时， IP 数据报的标识字段会有另一个标识符。标识符相同的 IP 数据报片 才能组装成一个 IP 数据报。前两个 IP 数据报片的标识符与后两个 IP 数据报片的标 识符不同，因此不能组装成一个 IP 数据报。 5-13 6 个。数据字段的长度：前 5 个是 1480 字节，最后一个是 800 字节。片偏移字段的 值分别是： 0, 185,370,555,740 和 925 。 5-14 源端口为 1586, 目的端口为 69, UDP 用户数据报总长度为 28 字节，数据部分长度为 20 字节。此 UDP 用户数据报是从客户发给服务器的（因为目的端口号 <1023, 是熟 知端口）。服务器程序是 TFTP （从 5. 1.3节表 5-2 的常用熟知端口号的表可查出）。 5-15 UDP 不保证可靠交付，但 UDP 比 TCP 的开销要小很多。因此只要应用程序接受这 样的服务质量就可以使用 UDP 。如果话音数据不是实时播放（边接收边播放）就可 • 452 •"}
{"doc_id": "network", "page": 464, "text": "以使用 TCP, 因为 TCP 传输可靠。接收端用 TCP 将话音数据接收完毕后，可以在以 后的任何时间进行播放。但假定是实时传输，则必须使用 UDP 。 5-18 如图 A-5 所示。 5-19  发送方 发送 M。 d  超时巩传 M。」 发送 M1 发送 M。 接收方 旧的 M。被当成是新的 M。! 图 A-5 习题 5-18 的图 如图 A-6 所示，设发送窗口记为 Wr, 接收窗口记为 WR 。假定用 3 比特进行编号。设 接收窗口正好在 7 号分组处（有阴影的分组）。发送窗口 Wr 的位置不可能比＠更靠 前，也不可能比＠更靠后，也可能不是这种极端位置，如＠。 对千＠和＠的情况，在叽的范围内无重复序号，即 Wr ~ 2” 。 对千＠的情况，在 Wr ＋叽的范围内无重复序号，即肌＋ WR ~ 2n o  现在 WR= 1,故发送窗口的最大值 Wr ~ 2\"-1 。 霄号组 卜—气，T~二叱勹尸 、 hl I I2 h III 勹1|| 『i 1 了11 -j WRI- 向前 图 A-6 习题 5-19 的图 5-20 用相对发送时间实现一个链表（见图 A-7) 。 实时时钟 实时时钟 |12~111 习十 蜇传分组衙要重传分组 经过时间t叩l 后的悄况 经过的时间 的序号 图 A-7 习题 5-20 的图 5-21 (I)序号到 4 为止的分组都已收到。若这些确认都已到达发送方，则发送窗口的范围 是 [5, 7] 。假定所有的确认都丢失了，发送方没有收到这些确认。这时，发送窗口 应为[2, 4] 。因此，发送窗口可以是[2, 4], [3, 5], [4, 6], [5, 7] 中的任何一个。 • 453 •"}
{"doc_id": "network", "page": 465, "text": "(2) 接收方期望收到序号 5 的分组，说明序号为 2, 3, 4 的分组都已收到，并且发送了 确认。对序号为 1 的分组的确认肯定被发送方收到f,否则发送方不可能发送 4 号分组。可见，对序号为 2, 3, 4 的分组的确认有可能仍滞留在网络中。这些确认 用来确认序号为 2,3,4 的分组。 5-22 (I) L 的最大值是 4GB, G=230.  (2) 发送的总字节数是 4489123390 字节。 发送 4489123390 字节所需时间为： 3591.3 秒，即 59.85 分，约 1 小时。 5-23 (I) 第一个报文段的数据序号是 70 到 99, 共 30 字节的数据。 (2) 确认号应为 100 。 (3) 80 字节。 (4) 70 。 5-24 设发送窗口＝ W (bit)。发送端连续发送完窗口内的数据所需的时间＝ T。 有两种悄况（见图 A-8) 。 (a) 接收端在收完一批数据的最后才发出确认，因此发送端经过（256 ms+ 1)后才能发 送下一个窗口的数据。 (b) 接收端每收到一个很小的报文段后就发回确认，因此发送端经过比 256 ms 略多 一些的时间即可再发送数据。因此每经过 256 ms 就能发送一个廊门的数据。 T.L文二二－－－－－「 l－2-8-m-S-r 一一叮尸二二厂飞2-8-m-S- 「 - - - 256 ms  -1-28一勹＿l T  - - • 256 ms  -l-28-?_s-l  (a) (b)  图 A-8 习题 5-24 的图 对千(a): W = 57825.88 b it,约为 7228 字节。 对千(b): W = 30720 bit= 3840 B  5-25 在 ICMP 的差错报文中（见图 4-28) 要包含 lP 首部后面的 8 个字节的内容，而这里 面有 TCP 首部中的源端口和目的端口。当 TCP 收到 ICMP 差错报文时需要用这两个 端门来确定是哪条连接出了差错。 5-26 TCP 首部除固定长度部分外，还有选项，因此 TCP 首部长度是可变的。 UDP 首部长 度是固定的。 5-27 65495 字节。此数据部分加上 TCP 首部的 20 字节，再加上 lP 首部的 20 字节，正好 是 IP 数据报的最大长度。当然，若 1P 首部包含了选择，则 IP 首部长度超过 20 字节， • 454 •"}
{"doc_id": "network", "page": 466, "text": "这时 TCP 报文段的数据部分的长度将小千 65495 字节。 5-28 分别是 n 和 m 。 5-29 还未重传就收到了对更高序号的确认。 5-30 在发送时延可忽略的情况下，砓大数据率＝ 26.2 Mbit/s 。 5-31 最大吞吐矗为 25.5 Mb it/s 。信道利用率为 25 .5/1000 = 2 .5 5% 。 5-33 (I) RTO = 4.5s 。 (2) RTO = 4. 75s 。 5-34 三次算出加权乎均往返时间分别为 29.6 ms, 29.84 ms 和 29.256 ms 。 可以看出， RTT 的样本值变化多达 20％时，加权乎均往返时间 RTis 的变化却很小。 5-35 (I) 10 RTI; (2) 14 RTI: (3) 有效吞吐率＝ 119.8 Mbit/s 。链路带宽利用率＝ 11.98% 。 5-36 拥塞窗口与 RTT 的关系如下（只给出了部分数据）： RTT  拥富窗口(pkt) I ? | :1:1;I I;4 1 厂 1 5-38 拥塞窗口大小分别为： 1,2,4,8,9, 10, 11, 12, 1,2,4,6, 7,8,9 。 5-39 {I) 拥塞窗口与 RTT 的关系曲线如图 A-9 所示。 认确复憤个三 \"  到收、 I 减 勹g .. .. .. .. .. .. .. 尸.. ... ... .. ... .. ... ... ... ... ...  d  ... ...  wn~~~ c.  l.--- t  虹 4440363228242016128 塞值值拥始 h 初 8r  的小hss res 的 h 新 SSI  (8)  慢开始～ 1 ?'` `'`',',i, ` `' '`'` `' ｀尸r1, R1T  0 2 4 6 8 IO 12 14 16 18 20 22 24 26  慢开始 慢开始 阁 A-9 拥寒窗口与 RTT 的关系曲线 (2) 慢开始时间间隔： [RTT = I, RTT = 6] 和 [RTT = 23, RTT = 26] 。 (3) 拥塞避免时间间隔： [RTT = 6, RTT = I 6] 和 [KIT= 17, RTT = 22] 。 (4) 在 RTT = 16 之后发送方通过收到二个亟复的确认检测到丢失了报文段。在 RTT= 22 之后发送方是通过超时检测到丢失了报文段。 (5) 在 RTT= I 发送时，门限 ss t hresh 被设置为 32 。 在 RTT= 18 发送时，门限 ss t hresh 被设置为发生拥塞时的一半，即 21 。 在 RTT=24 发送时，门限 ss t hresh 是 13 。 • 455 •"}
{"doc_id": "network", "page": 467, "text": "(6) 第 70 报文段在 RTT=7 发送出。 (7) 拥塞窗口 cwnd 和门限 ss thresh 应设置为 8 的一半，即 4 。 5-40 例如，当 IP 数据报在传输过程中需要分片，但其中的一个数据报片未能及时到达终 点，而终点组装 IP 数据报已超时，因而只能丢弃该数据报： IP 数据报已经到达终点， 但终点的缓存没有足够的空间存放此数据报：数据报在转发过程中经过一个局域网的 网桥，但网桥在转发该数据报的帧时没有足够的差错空间而只好丢弃。 5-42 如果 B 不再发送数据了，是可以把两个报文段合并成为一个，即只发送 FIN + ACK  报文段。但如果 B 还有数据要发送，而且要发送一段时间，那就不行，因为 A 迟迟 收不到确认，就会以为刚才发送的 FIN 报文段丢失了，就超时重传这个 FIN 报文段， 浪费网络资源。 5-43 当 A 和 B 都作为客户，即同时主动打开 TCP 连接。这时每一·方的状态变迁都是： CLOSED - SYN-SENT - SYN-RCVD - ESTABLISHED  5-47 发送窗口的两种不同情况分别如图 A-IO(a) 和 (b) 所示。根据此图，很容易证明本题。 客户 服务器 客户 服务器 连接请求 k.............. J  切／了;}RTT 连接诸求~,.:.:_·········..... ~  ir，哥:;;;} RTT  nMIR  UR  (a) 当 nM>R (RTI) +M (b) 寸'i 11M< R (RTI) +M  图 A-10 习题 5-47 的图 5-48 8.704 kbit/ s  11MIR  5-49 (1) 52100 (2) 13 (3) 28 字节 (4) 20 字节 （5) 分组是从客户到服务器 (6) Daytime  5-5l (l ）傥为全 0 (2) 全 0 (3) 全 l 5-52 UDP 用户数捉报的检验和既检验 UDP 用户数据报的首部又检验整个的 UDP 用户数 据报的数据部分，而 IP 数据报的检验和仅仅检验 IP 数据报的首部。 UDP 用户数据 报的检验和还增加了伪首部，即还检验了下面的 IP 数据报的源 IP 地址和目的 lP 地 址。 5-53 UDP 的最小长度是 8 字节，奻短 IP 数据报的长度是 28 字节。 5-54 0.667  5-55 0.364  5-56 0.222  5-58 4 秒 • 456 •"}
{"doc_id": "network", "page": 468, "text": "5-59 窗口的变化如图 A-11 所示。 在这之前 的官口 I I  IT 发送窗口－ 1000- I I  ... 区 ••• 区亟］ •••  已发送并收到确认 允许发送的序号 不允许发送 '' , 发送官口一 1000-',  在这之后 的窗口 ... 匡互］ ••• 区亟］ •••  已发送并收到确认 允许发送的序号 图 A-11 习题 5-59 的图 5-65 无法知道应写入什么数值。 不允许发送 5-66 仅在此报文段中仅有 1 个字节的数据时，下一个报文段的序号才是 x+I 。 5-67 TCP 的吞吐伉本来并没有标准的定义， TCP 的吞吐扯可定义为每秒发送的数据字节数。 计贷机内部的数据传送是以每秒多少字节作为单位的，而在通信线路上的数据率则常 用每秒多少比特作为单位。 5-69 取序号字段长度 n= 33 位。但应注意， TCP 的序号字段为 32 位。 5-70 (I) 859 ms (2) 42.7 天 5-73 这种情况是允许的． 第 6 章 6-04 有可能，如果你能够直接使用对方的邮件服务器的 IP 地址。 6-09 404 Not Found 。 6-10 应用层协议需要的是 DNS 。 运输层协议需要的是 UDP (DNS 使用）和 TCP (HTTP 使用）。 6-14 (I) 错误： （2) 正确： （ 3) 错误： （4) 错误。 6-15 解析 IP 地址需要的时间是： RTT1+RTT2+ … +RITn. 建立 TCP 连接和请求万维网文档需要 2RTiwo 需要的总时间是： 2RITw+ RIT1 + RTI户···+ RTTn.  6-16 (l)所需时间＝ RTT1 + RIT2 + ···+ RTTn+ 8RITw 。 (2) 所需时间＝ RTI1+RIT2+ … +RITn+ 4RIT w.  (3) 所需时间＝ RTT1+ RTT2+ …+RITn+3RITw.  6-18 约 1 1. 6 天。 6-26 4200 字节。 6-27 对应的 ASCl1 数据为 zIE4 ，对应的二进制代码为： 0 1111 01 0 0100 100 I O I 000 IO I 00110 I 00 。 6-28 01001 JOO 00111101 00111001010001000011100) 。编码开销为 66.7% 。 6-29 非常困难。例如，人名的书写方法，很多国家（如英、美等西方国家）是先写名再写 姓。但像中国或日本等国家则先写姓再写名。有些国家的一些人还有中间的名。称呼 • 457 •"}
{"doc_id": "network", "page": 469, "text": "也有非常多种类。还有各式各样的头衔。很难有统·的格式。 6-30 有时对方的邮件服务器不 I ：作，邮件就发送不出去。对方的邮件服务器出故陌也会使 邮件丢失。 6-40 整个的编码为 30 18  02 04 00 00 09 29  02 04 00 00 04 D4  02 04 00 00 00 7 A  02 04 00 00 04 D4  6-41 变蜇i cmp l nPannProbs 的对象标识符是 1.3.6.1.2.1.5.5, 加 1·，后缀 \".0” 。 AO lD  02 04 00 0 I 06 14  02 01 00  02 01 00  30 OF  300D  06 09 0 I 03 06 0 I 02 0 I 05 05 00  05 00  6-42 { 1.3.6.1.2.1.6}  6-43 40 04 83 15 OE 02  6-48 NF/u  6-49 [log2(N + I)]Flu  6-50 F/11  6-51 (I) 文件分发时间的最小伯都足 7.5 X J0 3S 。 (2) ．各户－服务器方式 F, 文件分发的垃 小时间是 5 X 105 S 。在 P2P jj式卜．，文件分发的垃小时间是 45.5 X (03 S 。 第 7 章 7-06 the time has come the walrus said to talk of many things of ships and shoes and sealing wax  of cabbages and kings of why the sea is boiling hot and whether pigs have wings but wait a  bit the oysters cried before we have our chat for some of us are out of breath and all of us  are fat no hurry said the carpenter they thanked him much for that  From Tit八mgh the looking glass (Tweedledum and Tweedledee)  第 8 章 8-04 不一样。实时数据往往是等时的数据，但笘时的数据不一定是实时数据。 8-15 (2) 分组在接收端缓存小应增加的时延分别为（中位为 ms): 30, 25, 22, 29, 45, 35, 29,  26,20 和 24 。 (3) 以时间t为横坐杯，分组数 N 为纵坐标。 I < 45, N = 0: 45 ~ t < 60, N = l: 60 ~ t < 70 、 N = 2: 70 ~ I < 73, N = 3: …  • 458 •"}
{"doc_id": "network", "page": 470, "text": "_  t > 165,N = 0 。 8-16 显然， A应小千话音分组长度 10 ms 。如果将A取为 9 ms, 则有： 时钟时间： 0 9 18 27 36 45 54 63 72 81 90 99' I 08 …  计数器值： 0 I 2 3 4 5 6 7 8 9 10 11 12 •••  话音分组每隔 l0ms 产生一个，对应的时间戳值（即计数器值）为： 话音分组产生时间： 0 IO 20 30 40 50 60 70 80 90 I 00 I l O • • •  应加上的时间戳值： 0 I 2 3 4 5 6 7 L___j_Q II 12 …  我们看到时间戳值在 8 到 10 之间缺了｀个。可见将A取为略小于话行分组长度 10 ms  是不行的。 正确的做法是使 2A或 3A等于话音分组长度。节话音分组丢失时，时间戳伯会相比 4A 或 5A ，由此来判定是否发生了分组丢失。 8-17 接收端缓存空间的上限取决千还原播放时所容许的时延．节还原播放时所容许的时延 已确定时，缓存空间的上限与实时数据流的数据率成正比。时延抖动越大，缓存空间 也应更大。 8-21 (1) 可能是 121312131213 …，也可能是 I 123112311231123 …。 (2) 113113113113···.  8-23 T=bl(N-r) 。 8-24 12.5 ms 。当 N = 2500 pkt/s 时， T ＝任意长的时间，漏桶被权标装满后就不再附加权标。 8-26 在图 A-12 中，流 l 的发送速率（即离开 WFQ队列的速率）;?: w1R I (Iw,) 。如果所 有的流的队列中都有分组，那么上面的公式的\";?!: \"就应节取为＂＝＂。如果有的队 列中没有分组， WFQ就跳过这个队列，因此这个流得到的服务时间就会多一些。 现在设： t。＝队列刚刚积累了分组需要排队等待的时刻（从这时起到达的分组就要排队了）， t=流 l 队列处千忙状态， I > lo （队列忙就是队列中有排队的分组）。 兀(to, t) =在时间间隔（t心］内，流 1 发送到网络的分组数。 h1 l r1(1 一 1。) Q1(I)  路由器 分类器 T1(I。,1) IIII  - /.. . . .  图 A-12 习题 8-26 的 OO 显然， T心，t) ~ w1R(t - lo）／（环，） 令Q1(I）＝在时间t时流）在 WFQ队列中排队的分组数。显然 Q 1(/）＝进入 WFQ队列的分组数－离开 WFQ队列的分组数 = b1 + (t - to)[ r1 - w1R I (I 初）］ • 459 •"}
{"doc_id": "network", "page": 471, "text": "因为 r1 < Rw1 I (l:阶） （题目已知），所以Q1( t)< bl ，故流 1 在 WFQ队列中排队的分 组数的最大值是 b i. 这些分组被服务的速率的最小值是 w1R I (l: w,), 因此流 1 中任何分组的最大时延是 b 心w;) I W1R = dmax  8-27 如图 A-13 所示，第二个沥桶的大小是 1 ，权标产生的速卒是p Is 。 注入汹桶的速护 rls 注入汕桶的速平－p Is  丿｝饮笃~Il、 —`}勹1怎品 在任何时间间隔t内准许进入网络的分组数＝ rI+b 图 A-13 习题 8-27 的图 8-32 按题意，此二叉树的叶节点有 2n 个，故二叉树的深度为 11 + I 。每一个节点向其上游 节点发送一个 RESV 报文，故总共发送 2n.. 1 _ I 个 RESV 报文。 8-33 80 kb it/s 。 25% 。 8-34 (2) 3, 4, 6, 7, 8 。 (3) 3 和 6 。 (4) t =IO 。 8-35 (I) 20 kb it/s 。 (2) 5 kbit/s 。 第 9 章 9-24 (I) 一般来说，两个无线网络的名字不会是一样的。如果 A 和 B 只有一个人在通话， 那么是可以的。虽然两个 AP 都能同时收到信号，但共中的一个会丢弃地址错误 的帧。如果两人同时进行通话，由于信道 11 是共同使用的，就必然产生冲突， 两个 AP 无法正常工作。 (2) 两个 AP 可以正常工作。 9-26 总共的时间＝ 974.2 µs.  9-27 (I) l 报文／2 时隙。 (2) 2 报文／ 1 时隙。 (3) I 报文／ 1 时隙． (4) <D I 报文／ 1 时隙。 @2 报文／ 1 时隙． O2 报文／ 1 时隙。 (5) <D I 报文／4 时隙．＠时隙 I: 报文 A 一 B ，报文 D 一 C: 时隙 2: ACK B-A: 时 隙 3: ACK C一 D 。得出 2 报文／3 时隙．＠时隙 I: 报文 C一 D: 时隙 2: ACK D  一 C, 报文 A 一 B ，；时隙 3: ACKB 一 A 。得出 2 报文／3 时隙。 • 460 •"}
{"doc_id": "network", "page": 472, "text": "附录 B 英文缩写词 3GPP (3rd Generation Partnership Proj ec t)第三代移动通信合作伙伴计划 SGNR (SG New Radio) SG 接入网， SG 空口 ACK (ACKnowledgemen t)确认 ADSL (Asymmetric Digital Subscriber Li ne) 非对称数字用户线 AEAD (Authenticated Encryption with Associated Data)带关联数据的鉴别加密 AES (Advanced Encryption S 臼ndard) 先进的加密标准 AF PHB (Assured Forwarding Per-Hop Behav ior) 确保转发每跳行为（也可记为 AF) AH (Authentication Header) 鉴别首部 AJMD (Additive Increase Multiplicative Decrease) 加法增大乘法减小 AM (Acknowled ged Mode) 确认方式 AMC (Adaptive Modulation and Codi n g)自适应调制编码 AN (Access Network) 接入网 ANSI (American National Standards Ins titute) 美国国家标准协会 AP (Access Po i n t)接入点 AP (App l i cati on) 应用程序 API (Application Programming In terface) 应用编程接口 APNIC (Asia Pacific Network Information Cen ter) 亚太网络信息中心 AR (Augmented Real ity)增强现实 ARIN (American Registry for Internet Numbers) 美国互联网号码注册机构 ARP (Address Resolution Protocol) 地址解析协议 ARPA (Advanced Research Project Agency)美国国防部远景研究规划局（高级研究计划署） ARQ (Automatic Repeat reQuest)自动重传请求 AS (Autonomous S y s t em) 自治系统 AS (Authentication Server) 鉴别服务器 ASCH (Amer ican Standard Code for Information Interchan ge) 美国信息交换标准码 ASN (Autonomous System Number) 自治系统号 ASN.1 (Abstract Syntax Notation One) 抽象语法记法 l ATM (Asynchronous Transfer Mode) 异步传递方式 ATU (Access Termination Unit)接入端接单元 ATU-C (Access Termination Unit Central Offi ce) 端局接入端接单元 ATU-R (Access Termination Unit Remote) 远端接入端接单元 AVTWG(Aud对Vi deo Transport Working Grou p)音频视频运输工作组 AWT (Abstract Window Toolk it)抽象窗口工具箱 Bee (Blind carbon co py)订复写副本 BER (Bit Error Ra t e) 误码率，误比特率 • 461 •"}
{"doc_id": "network", "page": 473, "text": "BER (Basic Encoding Rule) 基本编码规则 BGP (Border Gateway Prot ocol) 边界网关协议 BOOTP (BOOTstrap Pro tocol) 引导程序协议 BSA (Basic Service Area) 基本服务区 BSC (Base Station Con t roller) 基站控制器 BSS (Basic Service Se t)基本服务集 BSSID (Basic Service Set JD)从本服务织标识符 BT (B itTorren t)一种 P2P 应用程序 CA (Cen ifi catioa Authority)认证中心 CA (Collision Avo i dance) 碰撞避免 CATV (Commun ity Antenna TV, CAblc TV)有线电视 CBT (Core Based Tree) 基千核心的转发树 Cc (Carbon co py)复丐副本 CCIR (Consul tative Committee, International Rad i o) 国际无线电咨询委员会 CC JTT (Consultative Comm ittee, International Telegraph and Tele p hone) 国际电报电话咨询委员会 COM (Code Division Multip lex in g)码分复用 CDMA (Code Division Multiple Access) 码分多址 CE (Consumer Elec t ron i cs) 悄费电子设各 CFI (Canon ical Fonna t Ind i cat or) 规范格式指示符 CGl (Common Gateway I nter face) 通用网关接口 CHAP (Challenge-Handshake Authentication Pro t ocol) 口令握手鉴别协议 CIDR (Classless lnterDomain Rou ti n g)无分类域间路由选抒 CNAME (Canon ical NAME) 规范名 CNNIC (China Network lnfonnation Cen ter) 中国互联网络信息中心 CRC (Cyclic Redundancy Check) 循环冗余检验 CS-ACE LP (Conjugate-Structure Algebraic-Code-Exc ited Linear Pred i c ti on) 共枙结构代数码激励线性预测 （市码器） CSFB (Circuit Switched Fallback) 电路交换回谘 CSM A/ CA (Carrier Sense Multiple Access/ Collision Avo i dance) 载波监听多点接入／冲突避免 CSM A/ CO (Carrier Sense Multiple Access/ Collision Detec ti on) 载波监听多点接入／冲突检测 CSRC (Contributing SouRCe i den tifi er) 参与源标识符 CSS (Cascad ing Stylc Shee ts) 层叠样式农 CTS (Clear To Send) 允许发送 DACS (Digital Access and Cross-connec t S ystem) 数字交接系统 DARPA (Defense Advanced Research Project Agenc y)美国 1引防部远烘规划局（高级研究署） DCF (Distributed Coord ination Func ti on) 分布协调功能 DDoS (Distributed Denial of Serv i ce) 分布式拒绝服务 DES (Data Encryption S tandard) 数据加密标准 OF (Don' t Fra gmen t)不能分片 OHCP (Dynamic Host Configuration Prot ocol) 动态主机配咒协议 • 462 •"}
{"doc_id": "network", "page": 474, "text": "DiffServ (Differentiated Servi ces) 区分服务 DIFS (Distributed Coordination Function IFS) 分布协调功能帧间间隔 DLCI (Data Link Connection Iden tifi er) 数据链路连接标识符 DMT (Di screte Mul ti -Tone) 离散多音（调制） DNS (Doma in Name S y stem) 域名系统 DOCSIS (Data Over Cable Service Interface S pec ifi ca ti ons) 电缆数据服务接口规约 DoS (Denial of Serv i ce) 拒绝服务 OS (Distribution Sy s t em) 分配系统 OS (Differentiated Serv i ces) 区分服务（也写作 D iffS erv) DSCP (Differentiated Services CodePo i n t)区分服务码点 DSL (Digital Subscriber Li ne) 数字用户线 DSLAM (OSL Access Multip lexer) 数字用户线接入复用器 DSSS (Direct Sequence Spread S pec t rum) 直接序列扩频 DS-WCDMA (Direct Sequence Wideband CDMA) 直接序列宽带码分多址 DVMRP (Distance Vector Multicast Routing Pro tocol) 距哀向量多播路由选抒协议 DWDM (Dense WDM) 密集波分复用 EBCDIC (Extended Binary-Coded Decimal Interchange Code) 扩充的 ...::.I 十进制交换码 ECC (Ellipti c Curve Cryptograph y)椭圆曲线密码 EDFA (Erbium Doped Fiber Amp l ifi er) 掺饵光纤放大器 EDGE (Enhanced Data rate for GSM Evolu ti on) 增强型数据速率 GSM 演进 EFM (Ethernet in the First Mi le) 第一英里的以太网 EF PHB (Expedited Forwarding Per-Hop Behav i or) 迅速转发每跳行为（也可记为 EF) EGP (Extemal Gateway Pro tocol) 外部网关协议 EIA (Electronic Industries Assoc i a ti on) 美国电子工业协会 eMBB (enhanced Mobile BroadBand) 增强型移动宽带 eNB (evolved Node-8) 演进的节点 B EOT (End Of Transm i ss i on) 传输结束 EPC (Evolved Packet Core) 演进的分组核心网 EPON (Ethernet PON) 以太网无源光网络 ESMTP (Extended SMTP) 扩充的简单邮件传送协议 ESP (Eneapsulating Security Pay load) 封装安全有效载荷 ESS (Extended Service Set)扩展的服务集 ETSI (European Telecommun ications Standards Ins titut e) 欧洲电信标准协会 EUI (Extended Unique Iden tifier) 扩展的唯一标识符 E-UTRAN (Evolved-UTRAN) 演进的无线按入网 FC (Fiber Channel) 光纤通道 FCS (Frame Check Seq uence) 帧检验序列 FDDI (Fiber Distributed Data In terface) 光纤分布式数据接口 FDM (Frequency Division Multip lex i n g)频分复用 FDMA (Frequency Division Multiple Access) 频分多址 • 463 •"}
{"doc_id": "network", "page": 475, "text": "FEC (Forward ing Equivalence Class) 转发等价类 FFD (Full-Func tion Dev i ce) 全功能设备 FHSS (Frequency Hopping Spread S pectru m) 跳频扩频 FIFO (First lo First Out)先进先出 FQ (Fair Queuing)公平排队 FTP (File Transfer Protocol) 文件传送协议 FTTB (Fiber To The Bu i ld ing)光纤到大楼 FTTC (Fiber To The Curb) 光纤到路边 FTTO (Fiber To The Door) 光纤到门户 FTTF (Fiber To The Floor) 光纤到楼层 FTTH (Fiber To The Home) 光纤到家 FTTN (Fiber To The Neighbor) 光纤到邻区 FTTO (Fiber To The Offi ce) 光纤到办公室 FTTZ (Fiber To The Zone) 光纤到小区 GGSN (Gateway GPRS Support Node) 网关 GPRS 支持节点 GIF (Graphics Interchange Fonnat)图形交换格式 G/L (Globa l/Local) 全球／本地管理（位） GMSC (Gateway Mobile Swit ching Cen ter) 网关移动交换中心 GMSK (Gaussian filtered Minimum Shift Keyi n g)高斯滤波砐小移频键控 GPON (Gigabit PON) 吉比特无源光网络 GPRS (General Packet Rad.io Serv i ce) 通用分组无线服务 GSM (Global System for Mob i le) 全球移动通信系统， GSM 体制 GTP (GPRS Tunne ling Protocol) GPRS 隧道协议 GTP-U (GPRS Tunnel ing Protocol User plane) GPRS 隧道协议－用户层面 HARQ (Hybrid ARQ)湿合自动顶传请求 HDLC (High-level Data Link Con t rol) 商级数据链路控制 HDSL (High speed DSL) 高速数字用户线 HFC (Hy brid Fiber Coax) 光纤同轴混合（网） IDPPI (Hlgh-Pcrfonnance Parallel In terface) 环性能并行接口 HLR (Home Location Regi s ter) 归屈位置寄存器 HR-DSSS (High Rate Direct Sequence Spread S pec trum)庙速兀接序列扩频 HSPA (High Speed Packet Access) 吓速分组接入 HSPA+ (High Speed Packet Access+) 高速分组接入增强型版本 HSS (Home Subscriber Server) 归屈用户服务常 HSSG (High Speed Study Group)环速研究组 HTML (HyperText Markup Lan gu age) 超文本标记语言 HTTP (HyperText Transfer Prot ocol) 超文本传送协议 lAB (Internet Architecture Board) 互联网体系结构委员会 IANA (Internet Assigned Numbers Aut hority)互联网赋号管理局 ICANN (Internet Corporation for Assigned Names and Numbers) 互联网名字和数字分配机构 • 464 •"}
{"doc_id": "network", "page": 476, "text": "ICMP (]nteme t Control Message Pro tocol) 网际控制报文协议 IDEA (International Data Encryption Al gorithm) 国际数据加密算法 IDS (Intrusion Detection S y st em) 入佼检测系统 IEEE (Institute of Electrical and Electron ic Engineering) （美国）电气和电子工程师学会 IESG (Internet Engineering Steering Group)互联网工程指导小组 IETF (Internet Engineering Task Force) 互联网工程部 IFS (InterFrame S pace) 帧间间隔 I/ G (Indi v i dua l/Group)单个站／组地址（位） IGMP (Internet Group Management Protocol) 网际组管理协议 IGP (Interior Gateway Pro tocol) 内部网关协议 IKE (Internet Key Exchan ge) 互联网密钥交换 IM (Instant Messaging)即时传信 IMAP (1.ntemet Message Access Prot ocol) 网际报文存取协议 IMS (JP Multimeda Subsystem) J P 多媒体子系统 IMT-Advanced (In terna tional Mob ile Telecommun i ca ti ons-Advanced) 高级国际移动通信 IND (l nverse-Ne ighbor心scovery)反向邻站发现 ln tServ (Integrated Serv i ces) 综合服务 IP (Internet Pro t ocol) 网际协议 IPCP (IP Control Protocol) IP 控制协议 IPRA (Internet Policy Registration Authority)互联网政策登记管理机构 (P sec (IP security) IP 安全协议 IPX (Internet Packet Exchange) Novell 公司的一种连网协议 IR (Infra Red) 红外技术 IRSG (Internet Research Steering Grou p)互联网研究指导小组 IRTF (Internet Research Task Force) 互联网研究部 ISAKMP (Internet Secure Association and Key Management Mechan i sm) 互联网安全关联和密钥管理协议 ISDN (Integrated Services Digital Ne twork) 综合业务数字网 ISO (International Organization for S tandard izati on) 国际标准化组织 ISOC (Internet Soc i e ty)互联网协会 ISM (Indus trial, Scientifi c, and Medi cal) 工业、科学与医药（频段） ISP (Internet Service Provi der) 互联网服务提供者 ITU (lntemational Telecommun ication Uni on) 国际电信联盟 ITU-T (ITU Telecommun ication Standard ization Sec tor) 国际电信联盟电信标准化部门 J PEG (Joint Photographic Expert Grou p)联合图像专家组 JVM (Java Virtual Machine) Ja va 虚拟机 KOC (Key Distribution Cen t er) 密钥分配中心 LACNIC (Latin American & Caribbean Network Internet Cen t er) 拉美与加勒比海网络信息中心 LAN (Local Area Ne twork) 局域网 LCP (Link Control Protocol) 链路控制协议 LOP (Label Distribution Protocol) 标记分配协议 • 465 •"}
{"doc_id": "network", "page": 477, "text": "LED (Light Emitti ng D i ode) 发光二极行 LMDS (Local Multipoint Distribution S y s t em) 本地多点分配系统 LLC (Logical Link Con t rol) 逻捐链路控制 LoS (Line of S igh t)视距 LPC (Linear Prediction Cod i n g)线性预测编码 LSP (Label Switched Pa t h) 标记交换路径 LSR (Label Switching Rou ter) 标记交换路山器 LTE (Long-Term Evolu ti on) 长期演进 LTE-A (LTE-Advanced) 般都不翻译，意思是长期演进的后续演进。 MAC (Medium Access Con t rol) 媒体按入控制 MAC (Messa ge Authentication Code) 报文鉴别码 MACA (Mu ltiple Access with Collision Avo i dance) 具有碰撞避免的多点接入 MAGIC (Mob ile multimedia, Anytime/an y-where, Global mobility support, Integrated wireless and Customized  personal servi ce) 移动多媒体、任何时间／地点、支待全球移动性、综合无线和定制的个人服务 MAN (Metropolitan Area Net work) 城域网 MANET (Mob ile Ad-hoc NETworks) 移动自组网络的工作组 MBONE (Mu lticast Backbone On the ln terNE t)多播主干网 MCU (Multipoint Control Un it)多点拉制单兀 MD (Mes顷a ge Dig es t)报文摘要 MF (More Fra gmen t)还有分片 MFTP (Multisourcc File Transfer Pro tocol) 多源文件传输协议 MIB (Mana geme nt Information Base) 管理信息库 MIME (Multipurposc Internet Mail Ex tens i ons) 通用互联网邮件扩充 MIMO (Multiple Input Multiple Ou tp u t)多入多出 MIPS (Million Instructions Per Second) 百万指令每秒 MS (Mas ter Secret) -t密钥 MLD (Multicast Listener Del i very)多播听众交付 MME (Mob 血y Mancgcmcnt En tity)移动性茬理实体 MMUSIC (Mull iparty MUiti media Sess ion Control) 多参与者多媒体会话控制 mMTC (mass ive Machine Type Communi ca ti on) 大规模机器类型通信 MOSPF (Multicast extensions to OSPF) 开放鼓短通路优先的多播扩展 MP3 (MPEG Audio layer-3) 种音频J K 缩标准 MPEG (Mo tion Picture Experts Grou p)活动图像专家组 MPLS (MultiProtocol Label Swit ch i n g)多协议标记交换 MPPS (Million Packets Per Second) 百万分组每秒 MRU (Max imum Receive Un it)砐人接收单兀 MSC (Mob ile Switching Cen t er) 移动交换中心 MSL (Max imum Scgmcnt Lifeti me) 最长报义段九命 MSRN (Mob ile Station Roam ing Number) 移动站漫游号码 MSS (Maximum Segment S i ze) 最长报文段 • 466 •"}
{"doc_id": "network", "page": 478, "text": "MTU (Max imum Trans fer Un it)最大传送单元 NAP (Network Access Po i n t)网络接入点 NAT (Network Address Transla ti on) 网络地址转换 NAV (Network Allocation Vec t or) 网络分配向扭 NB (Node 奄 B) 节点 B NCP (Nct\\ vork Control Pro t ocol) 网络控制协议 ND (Ne ighbor-D i scove ry)邻站发现 NFS (Network File S y s t em) 网络文件系统 NGI (Next Generation In terne t)下一代互联网 NGN (Next Generation Network) 下一代电信网 NIC (Network Inter face Card) 网络接口卡、网卡 NLA (Next-Level Agg reg a ti on) 下一级聚合 NLRI (Network Layer Reachab ility In fo rmati on) 网络层可达性信息 NOC (Network Operations Cen ter) 网络运行中心 NSAP (Network Serv ice Access Po in t)网络层服务访问点 NSF (National Science Foundation) （美国）国家科学基金会 NVT (Necwork Virtual Term inal) 网络虚拟终端 OC (Optical Carri er) 光载波 ODN (Optical Distribution Network) 光配线网 ODN (Optical Distribution Node) 光分配节点 OFDM (Orthogonal Frequency Division Mul tip lex i n g)正交频分复用 OFDMA (Orthogonal Frequency Division Multiple Access) 正交频分多址 OLT (Optical Line Term i nal) 光线路终端 ONU (Optical Network Un it)光网络单元 OSI/ Rl\\1 (Open Systems Interconnec tion Reference Model) 开放系统互连基本参考模型 OSPF (Open Shortest Path F i rst)开放最短通路优先 OUl (Organizationally Unique Identifi er) 机构唯一标识符 P2P (Peer- t o-Peer) 对等方式 PAN (Personal Arca Net work) 个人区域网 PAP (Password Authentication Pro tocol) 口令鉴别协议 PARC (Polo Alto Research Cen ter）（美国施乐公司 (XEROX)的） PARC 研究中心 PAWS (Protect Against Wrapped Sequence numbers) 防止序号绕回 PCA (Policy Certifi cation Author ity)政策认证中心 PCF (Point Coordination Func ti on) 点协调功能 PCM (Pulse Code Modula ti on) 脉码调制 PCMCIA (Personal Com puter Memory Card Interface Ada pt er) 个人计算机存储器卡接口适配器 PCRF (Policy and Charging Rules Functi on) 策略与计费规则功能 PCU (Packet Control Unit)分组控制单元 PDA (l)ersonal D 屯ital Ass i s tant)个人数字助理 PDCP (Packet Data Convergence Pro tocol) 分组数据汇聚协议 • 467 •"}
{"doc_id": "network", "page": 479, "text": "PDF (Portable Documen t Formen t)轻便文档格式 POU (Protocol Data Unit)协议数据单元 PEM (Privacy Enhanced Mai l) 互联网的正式邮件加密标准 PCP (Pretty Good Pri vacy)一种电f邮件加密技术 P-GW (Packet Data Network Ga t eWay)分组故斟网络网关，分组网关 PHB (Per-Ho p Behav i or) 每跳行为 PlFS (Point Coordination Function IFS) 点协调功能帧间间隔 PIM-OM (Protocol Independent Multicast-Dense Mode) 协议无关多播－密渠方式 PL\\1-SM (Protocol Independent Multicast-Sparse Mode) 协议无关多播－稀扰方式 PfNG (Packet lnterNct Groper) 分组网间探测，乒程序， ICMP 的一种应川 PK (Publ ic Key)公钥，公开密钥 PKT (Publ ic Key In fras tructure) 公钥基础结构 PLMN (Publ ic Land Mobile Ne tw ork) 公共陆地移动网络 PMS (Pre-Mas ter Secre t)预主密钥 PON (Pass ive Optical Network) 无源光网络 PoP (Point of Presence) 汇接点 POP (Pos t Office Protocol) 邮局协议 POTS (Plain Old Telephone Serv i ce) 传统电话 PPP (Point-to-Po int Pro t ocol) 点对点协议 PPPoE (Point-to-Po int Protocol over Et hernet)以太网上的点对点协议 PS (POTS S p l i ner) 电话分离器 PTE (Path Terminating Element)路径端接设备 QAM (Quadrature Amplitude Modula ti on) 正交 1幅度调制 QoS (Quality of Serv i ce) 服务质卅 QPSK (Quartemary Phase Shift Ke yi n g或Quadra tu re Phase Shift Keying)正交相移键控 RA (Registration Aut hor ity)注册竹理机构 RARP (Reverse Address Resolution Protoc.ol) 逆地址解析协议 RAS (Registration/ Admi ss i o n/S ta t us) 登记／接纳／状态 RED (Random Early De t ec ti on) 随机早期检测 RED (Random Early Discard, Random 胚l y Drop)随机早则丢弃 RESV (RESerVa ti on) 预留 RFC (Request For Comments) 济求评论 RFD (Reduced-Func tion Devi ce) 精简功能设备 RG (Research Grou p)研究组 RIP (Rou ting Information Protocol) 路由信息协议 RIPE （法文表示的 Euro p ean TP ne twork) 欧洲的 IP 网络 RLC (Rad io Link Con trol) 无线链路控制 RNC (Rad io Network Con troller) 无线网络控制器 RPB (Reverse Path Broadcas ti ng)反向路径广播 RR (Rece iver Re po rt)接收端报告（分组） • 468 •"}
{"doc_id": "network", "page": 480, "text": "RSA (Rivest, Shamir and Adleman) 用三个人名表示的一种公开密钥算法的名称 RSVP (Resource reSerVation Protocol) 资源预留协议 RTCP (Real-time Transfer Control Pro t ocol) 实时传送控制协议 RTO (Retransm ission Ti me-Ou t)超时觅传时间 RTP (Real-time Transport Pro tocol) 实时运输协议 RTS (Request To Send) 诸求发送 RTSP (Real-Time Streaming Pro t ocol) 实时流式协议 RTT (Round-Trip Ti me) 往返时间 SA (Security Assoc i a ti on) 安全关联 SACK (Selective ACK) 选择确认 SAD (Security Association Database) 安全关联数据库 SAP (Service Access Po i n t)服务访问点 SCTP (Stream Control Transmission Pro tocol) 流控制传输协议 SDH (Synchronous Digital Hi erarch y)同步数字系列 SDP (Session Description Pro tocol) 会话描述协议 SDSL (Single-line DSL) I 对线的数字用户线 SDU (Service Data Unit)服务数据单元 SET (Secure Electro nic Transac ti on) 安全电子交易 SGSN (Serving GPRS Support Node) GPRS 服务支持节点 S-GW (Serving GateWay)服务网关 SHA (Secure Hash Alg orithm) 安全散列算法 STFS (Short. IFS) 短帧间间隔 SIM (Subscriber Identity Module) 用户身份识别卡 SIP (Session Initiation Pro t ocol) 会话发起协议 SK (Secret Key)密钥 SKEME (Secure Key Exchange MEchani sm) 安全密钥交换机制 SLA (Service Level Agreement)服务等级协定 SMI (Structure of Management ln fo nnati on) 管理信息结构 SMTP (Simple Mail Transfer Pro tocol) 简单邮件传送协议 SNA (System Network Arch itecture) 系统网络体系结构 SNMP (Simple Network Management Pro t ocol) 简单网络管理协议 SOH (Start Of Header) 首部开始 SONET (Synchronous Optical NETwork) 同步光纤网 SPD (Security Policy Da tabase) 安全策略数据库 SPI (Security Parameter Index) 安全参数索引 SR (Sender Re p o rti ng)发送端报告（分组） SRA (Seamless Rate Ada ptati on) 无缝速率自适应技术 SSID (Service Set IDen tifi er) 服务集标识符 SSL (Secure Socket Layer) 安全插口层，或安全套接层（协议） SSRC (Synchronous SouRCe i den tifi er) 同步源标识符 • 469 •"}
{"doc_id": "network", "page": 481, "text": "STDM (Statistic TDM) 统计时分复用 STM (Synchronous Transfer Module) 同步传递模块 STP (Shielded Twisted Pair)屏蔽双绞线 STS (Synchronous Transport S ign al) 同步传送信号 TA (Tracking Area) 跟踪区 TAI (Tracking Arca Iden tity)踉跺区标识 TAL (Tracking Area L i s t)跟踪区列表 TCB (Transmission Control Block) 传输控制程序块 TCP (Transmission Control Protocol) 传输控制协议 TOM (Time Division Mul tip lex i n g)时分复用 TOMA (Time Division Multiple Access) 时分复用 TD-SCOMA (Time Division-Synchronous CDMA) 时分同步的码分多址 TEID (Tunnel Endpoint !Den tifi er) 隧道端点标识符 TELNET (TELetype NETwork) 电传机网络，一种互联网的应用程序 T盯P (Trivial File Transfer Protocol) 简单文件传送协议 TGS (Ticket-Granting Server) 哎据授予服务器 TIA (Telecommunications Industries Assoc i ati on) 电信行业协会 TLA (Top-Level Agg regati on)顶级聚合 TLD (Top Level Domain) 顶级域名 TLI (Transport Layer In terface) 运输层接口 TLS (Transport Layer Secu rity)运输层安全协议 TLV (Typ e-Length-Value) 类型长度值 TPDU (Transport Protocol Data Unit)运输协议数据单元 TSS (Telecommunication Standardization Sector) 电信标准化部门 TTL (Time To L i ve) 生存时间，或寿命 UA (User Agent)用户代理 UAC (User Agent Cl i en t)用户代理客户 UAS (User Agent Server) 用户代理服务器 UDP (User Datagram Pro tocol) 用户数据报协议 UE (User Eq u ip men t)用户设备 UIB (User Interface Box) 用户接口盒 UMTS (Universal Mobile Telecommun ications Sys tem) 通用移动通信系统 URL (Uniform Resource Loca tor) 统一资源定位符 uRLLC (ultra Reliable and Low Latency Communi cati on) 超高可靠超低时延通信 USIM (Universal Subscriber identity Module) 通用用户身份识别卡 UTP (Unshielded Twisted Pa i r) 无屏蔽双绞线 UTRAN (UMTS Terrestrial Radio Access Net\\vork) 通用移动通信系统陆地无线接入网 UWB (Ultra-Wide Band) 超宽带 VC (Virtual Ci rcu it)虚电路 VCI (Virtual Channel Identifi er) 虚通路标识符 • 470 •"}
{"doc_id": "network", "page": 482, "text": "VDSL (Very high speed DSL) 甚高速数字用户线 VID (VLAN ID) YLAN 标识符 VLAN (Virtual LAN) 虚拟局域网 VLR (Visitor Location Regi s ter) 来访用户位置寄存器 VLSM (Variable Length Subnet Mask) 变长子网掩码 VolP (Voice over J P) 在 IP 上的话者 VON (Voice On the Net)在互联网上的话音 VPI (Virtual Path Iden tifi er) 虚通道标识符 VPN (Virtual Private Network) 虚拟专用网 VR (Virtual Real ity)虚拟现实 VRML (Virtual Reality Modeling Lan g ua g e) 虚拟现实建模语言 VSAT (Very Small Aperture Term i nal) 甚小孔径地球站 W3C (World Wide Web Conso rti um) 万维网联盟 WAN (Wide Area Netw ork) 广域网 WCDMA (Wideband CDMA) 宽带码分多址 WDM (Wavelength Division Multip lex i ng)波分复用 WEP (Wired Equivalent Pri vac y)有线等效保密 WF Q (Weighted Fair Queu i n g)加权公平排队 WG (Working Group)工作组 WGIG (Working Group on Internet Governance) 互联网治理工作组 WiM AX (Worldwide interoperability for Microwave Access) 全球微波接入的互操作性，即 WMAN WISP (Wireless Internet Service Prov i der) 无线互联网服务提供者 WLAN (Wireless Local Area Network) 无线局域网 WMAN (Wireless Metropolitan Area Network) 无线城域网 WPA (Wi-Fi Protected Access) 无线局域网受保护的接入 WPAN (Wireless Personal Area Network) 无线个人区域网 WSN (Wireless Sensor Network) 无线传感器网络 WWW (World Wide Web) 万维网 XHTML (eXtensible HTML) 可扩展超文本标记语言 XML (eXtensible Markup Lang ua ge) 可扩展标记语言 • 471 •"}
{"doc_id": "network", "page": 483, "text": "附录 C 参考文献与网址 1. 值得进一步深入阅读的计算机网络教材 [CHEN07] 陈鸣等．计算机网络实验教程：从原理到实践北京：机械 T．业出版社， 2007. [COME06] Comer, D. /nternetwor/..'ing with TCP/IP. Vol. I, 5ed. Pearson Education, 2006. 中译本：电子工业出 版社， 2006. [COMEI 5) Comer, D. Computer Networks and lnternets, 6ed. Pearson Education, 2015. 中译本：电f工业出版 社， 2015. [FOROIO] Forouzan, 8. A. TCP/JP Protocol Suite, 4ed. McGraw-Hill, 2010. 中译本：清华大学出版社， 201 1. [KOZIOS] Kozierok, C. M. TCP/IP Guide. No Starch Press, 2005.  [KUR017] Kurose, J. F. and Ross, K. W. Computer N,切心rking. A Top-Down Approach Fea turing the Internet,  7ed. Pearson Education, 2017. 中译本 7ed: 陈鸣．机械工业出版社， 2018. [LIUPIS] 刘鹏云计算（第三版）．北京：电子工业出版社， 2015. [PERLOO] Perlman, R. Interconnections: Bridges and Routers, 2ed. Addison-Wesley, 2000. 有中译本：机械工 业出版社， 2000. [PETE 12] Peterson, L. L. and Davie, 8. S. Computer Ne八vorks, A Systems Approach, Sed. Morgan Kaufmann,  2012.  [STEV94] Stevens, W. R. TCP/IP Illustrated, Vol.I. Addison-Wesley, 1994. 中译本：机械工业出版社， 2000. (2012 年已经出版了第二版，全书 1017 页） [STALIO] Stallings, W. Data and Computer Communications, 9ed. Prentice-Hall, 2010. 中译本：电子工业出版 社， 201 1. [TANE 11] Tanenbaum, A. S. Computer Networks, Scd. 2011 机械工业出版社影印版 2. 参考文献 [BELL86) Bell, P. R., et al., \"Review of Point-to-Point Network Routing Algorithms,\" !£££ Commun. Magazine,  Vol.24, No. I, pp.34-38, Jan. 1986.  [COL LO I) Collins, D., Carrier Grade Voice over IP, McGraw-Hill, 200 I ．人民邮电出版社影印版 [COMM90) IEEE Commun. Magazine, Special Issue on SONET/SDH, Vol.28, No.8, Aug. 1990.  [COMM02] Akyildiz, L. F., et. al., \"A Survey on Sensor Networks\", IEEE Commun. Magazine,Vol.40, No.8, Aug.  2002.  [CU丽99) Cunningham, D. G. and Lane, W. G., \"Gigabit Ethernet Neflvorking\", Macmillan Technical Publ i s 血g, 1999, 清华大学出版社影印． [DAVl86] Davies, D. W., \"The Origins of Packet Switching,\" Computer Network Usage: Recent Experiences, Eds.  L. Csaba et al., North-Holland, 1986, pp. I-I 3.  [DENN82) Denning, D. E., Cryptograph and Data Security, Addison-Wesley, 1982.  [DIFF76] Diffic, W. and Hellman, M., \"New Directions in Cryptography\", IEEE Trans., Vol.lT-22, No.6, pp.644- 654, Nov. 1976.  • 472 •"}
{"doc_id": "network", "page": 484, "text": "[GREE82) P. E. Green, Computer Networks Architectures and Protocols, Ed. by P. E. Green, p.4, p.22, Plenum  Press, 1982.  [HUIT95] Huitema, C., Routing in the Internet, Prentice Hall, 1995  [KREN 15) Krentz, D., et. al., \"So tl八vare-Defi ned Networking: A comprehensive Survey,\" Proceed ings of rhe IEEE,  Vol. 103, No. I, pp.14-76. Jan. 2015.  [KAST98) Kastas, T. J., et. al., \"Real-Time Voice Over Packet-Switched Networks,\" IEEE Nenvork, Yol. 12, No.I,  pp.18-27, Jan/Feb 1998.  [KH0Rl9) Khorov,E.,e t.Al., \"A Tu t or i al on IEEE 802.llax Hig h Effi c i enc y WLANs,\"IEEE  COMMUNICA-TJONS SURVEYS & TUTORIALS, Vol. 21, No. I. pp.197-217, First Quarter 2019.  [LAI90) Lai, X., and Massey, J.: \"A Proposal for a New Block Encryption Standard.\" Advances in Cryptology  —Eurocrypt '90 Proceed ings, New York: Springer-Verlag, pp.389-404, 1990  (MAN02] Man Young Rhee, CDMA Cellular Mobile Commun ications and Network Security. Pearson Education,  2002 电子工业出版社影印 [METC76] Metcalfe, R. M., et al., \"Ethernet: Distributed Packet Switching for Local Computer Networks,\"  Commun. ACM, Vol. I 9, No.7, pp.395-404, July 1976  [M爪GCJ 93] 电子学名词，科学出版社， 1994 年 4 月． [M爪GCI94] 计算机科学技术名词，科学出版社， 1994 年 12 月 [MOY98] Moy, J. T., OSPF: Anatomy of an Internet Routing Pro tocol, Addison-Wesley, 1998  [N ET、~88] IEEE Network, Special Issue on Bridges, Vol.2, No. I, Jan. 1988.  [R1VE78) Rivest, R. L., Shamir, A. and Adleman, L., \"A Method for Obtaining Digital Signature and Public Key  Cryptosystems,\" Commun. ACM, Yol.21, No.2, pp.120-126, Feb. 1978  [SHAN49) Shannon, C. E., \"Communication Theory of Secrecy Systems,\" Bell Sysr. Tech. J., Yol.28, pp.656-715,  Oct. 1949.  [SHOC78) Shoch, J. F., \"Inter-network Naming, Addressing, and Routing,\" Compcon, pp.72-79, Fall 1978.  [STOIO!) Stoica, I.,et al, \"Chord: A Scalable Peer-to-peer Lookup service for Internet Applications,\" ACM  SJGCOMM Computer Communication Review Vol 31 (4): 149, 200 I  (WANG05) Xiaoyun Wang and Hongbo Yu (2005). \"How to Break MOS and Other Hash Functions\" (PDF)  Advances in Cryptology - Lecture Notes in Computer Science 3494. pp. 19-35. Retrieved 21  December 2009  [ZHAN93] Zhang Lixia, \"RSVP A New Resource Reserva tion Protocol,\" IEEE Network Magazine, Yol.7, pp.8-18,  Sept/ Oct. 1993.  3. 一些有参考价值的网址 (W-ASN] http://\\vww.iana.org/assignments/as-numbers/as-numbers.xhtml  (W-BACKD] https://en.w 如pedi a.org/叭k i/2011 _PlayStation_ Network_ outage  [W-BLUE) https://www.bluetooth.com/zh-cn  (W-BT] http://www.bittorrent.org/  [W-CNNIC) http://www.cnnic.cn/  [W-DOS] http://krebsonsecur ity.com/2014/ 12/cowards-attack-sony-playstation-microsoft-xbox-networks/  [W-PageRank] https:/ /en. wikipedia.org/wiki/PageRank  • 473 •"}
{"doc_id": "network", "page": 485, "text": "(W-HTML] https://www.w3.org/MarkUp/  [W-IANA) https://www.iana.org/assignments/protocol-numbers/ protocol-numbers.xml  [W-LANA-root] https://www.iana.org/domains/root/db  [W-ICANN] http://www.icann.org/  [W-IEEE802] http://www.ieee802.org/  (W-1 EEE802.3] httpJ/www.ieee802.o rg/3/  [W-IEEE802. l 5] http://grouper.ieee.org/groups/802/I 5/  [W -I EEERA] https:/ /standards. ieee.org/products-services/regautb/index. hi m I  [W-ISOC] https://www.intemetsociety.org/  [W-INTENT] https://developer.android.com/reference/andro id/content/l n1cn1  [W-INTER] ht1p://www.intemetlivestats.com/in1emet-users/  [W-PCH] https://www.pch.net/  (W-ITU] https://www.itu.int/zh/Pagcs/default.aspx  [W-MEDIA-TYPE] https://www.iana.org/assignmcnts/media-1ypes/media-types.xh1ml  [W-REST] https:l/baike.baidu.com/itcm/rest/6330506? fr=aladdin  [W-PGP] https://www.openpgp.org/  [W-RFC] h ttp s://www.r fc-ed itor.org/i n fo/rfc 欢XX [W-RFCS] h1tps://www.rfc-editor.org/standards  [W-RFCX] htlps://www.r fc-editor.org/rfc-index2.html  [W-ROOT] hnp://www.root-servers.org/  [W-SHA3) https://www.nist.gov/news-even ts/news/2015/08/n i st-releases-sha 斗cryp 1o g ra p h i c-hash-s1andard [W-TLD) h ttp ://data. i ana.or泸LD/t lds-al p ha-by -doma i n. txt (W-WiFi] https://www.wi-fi .org/  [W奶k i] https://en. wikipcdia.org/wiki/Li st_of_ln temet_top-level_doma ins  [W-ZigBee] https://zigbeealliance.org/  • 474 •"}
