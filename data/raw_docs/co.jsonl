{"doc_id": "co", "page": 1, "text": "“十二五“普通高等教育本科国家级规划教材 （第3版） 唐朔飞编著 @"}
{"doc_id": "co", "page": 2, "text": "内容提要 本书是“十二五“普通高等教育本科国家级规划教材。本书第1版被列 为“面向21世纪课程教材＂，是教育部高等学校计算机科学与技术教学指导 委员会组织编写的“体系结构—组成原理—微机技术”系列教材之一，是2005 年国家精品课程主讲教材，于2002年获普通高等学校优秀教材二等奖。 本书通过对一台实际计算机的剖析，使读者更深入地理解总线是如何 将计算机各大部件互连成整机的。全书共分为4篇，第1篇（第1 、2章）介 绍计算机的基本组成、发展及应用；第2篇（第3~5章）介绍系统总线、存储 器（包括主存储器、高速缓冲存储器和辅助存储器）和输入输出系统；第3 篇（第6~8章）介绍CPU的特性、结构和功能，包括计算机的算术逻辑单 元、指令系统、指令流水、RISC技术及中断系统；第4篇（第9、10章）介绍控 制单元的功能和设计，包括时序系统以及采用组合逻辑和微程序设计控制 单元的设计思想与实现措施。每章后均附有思考题与习题。 本书概念清楚，通俗易懂，书中举例力求与当代计算机技术相结合，可 作为高等学校计算机专业教材，也可作为其他科技人员的参考书。 图书在版编目(CIP)数据 计算机组成原理／唐朔飞编著．－－3版．－－北京： 高等教育出版社，2020.10 ISBN 978-7-04-054518-0  I.印计...II．印唐...III.句计算机组成原理－高等 学校－教材IV．句TP301 中国版本图书馆CIP数据核字(2020)第114422号 策划编辑时阳 责任校对胡美萍 责任编辑时阳 责任印制刁毅 封面设计于文燕版式设计杨树 出版发行高等教育出版社网址http://www.hep.edu.cn 社址北京市西城区德外大街4号http://www.hep.com.cn  邮政编码100120 网上订购http:// www hepmall.com.cn  印刷河北鹏盛贤印刷有限公司http: II www.hepmall.com  开本787mmx 1092 mm 1/16 http·// www.hepmall.cn  印张27.75版次2000年7月第1版 字数610千字2020年10月第3版 购书热线010 -58581118 印次2020年12月第2次印刷 咨询电话400 -810 0598 定价50.00元 本书如有缺页、倒页、脱页等质量间题，请到所购图书销售部门联系调换 版权所有侵权必究 物料号54518-00"}
{"doc_id": "co", "page": 3, "text": "1篇概论 第1章计算机系统概论…会．．．．．．．．．．．．．．．．．．．．3 1.1 计算机系统简介......……...…….．．3 1.1.1 计算机的软硬件概念…...…...3  1.1.2 计算机系统的层次结构...……3 1.1.3 计算机组成和计算机 体系结构．．．．．．．．．．．．．零餐．．．．．．．．．．．．7 1.2 计算机的基本组成….........….....．8 1.2.1 冯·诺依曼计算机的特点……8 1.2.2 计算机的硬件框图．．．．．．．．．．．．．．．8 1.2.3 计算机的工作步骤……...、..10 1.3 计算机硬件的主要技术指标……16 1.3.1 机器字长........................17  1.3.2 存储容量．．．鳌．．．．．．．．．．．．．．．．．．．．17 1.3卓3运算速度........................17  1.4 本书结构.................................18  习题.................................19  2章计算机的发展及应用......…………20 2  3章统.................霉.．.．.......．．．．41 3.1 ........................ 41  3.2 ．．．．．．．售·蓦．．．．．．．．．．.......偷．．43 3.2.1 片内总线.......................· 43  3.2.2 系统总线........................43  3.2.3 通信总线........................44  2.1 计算机的．．．．．．今........毒命·、.．．．．20  2.1.1 计算机的产生和发展………20 2.1.2 微型计算机的出现和 发展．．．．．．．．鲁........警..鲁噙........23  2.1.3 软件技术的兴起和发展……26 2.2 的应用．．．．．．．．．．．．．．．．．．．．．．．．．．．28 2.2.1 科学计算和数据处理......…28  2.2.2 工业控制和实时控制………29  2.2.3 网络技术的应用...…...……29  2.2.4 虚拟现实........................31  2.2.5 办公自动化和 息系统...........................32  2.2.6 CAD/CAM/CIMS............... 33  2.2参7多媒体技术.................·... 34  2.2.8 人工智能........................34  2.3 计算机的展望...........................35  习题.............................匿.．．38 系统的 3.3 总线特性及性能指标........参．．．．．．45 3.3.1 总线特性........................45  3.3.2 总线性能指标..................46  3.3.3 总线标准........................47  3.4 总线结构.................................52  3.4.1 单总线结构..........食噙金........52"}
{"doc_id": "co", "page": 4, "text": "II  目录 3.4.2 多总线结构.....................52  3.4.3 总线结构举例..................55  3.5 总线控制.................................57  3.5.1 总线判优控制..................57  3.5.2 总线通信控制..................59  习题...................潭.．．．．．．．．．．．．66 第4章存储器.......................................68  4.1 概述.......纂．．．．摹．．．．．．．．．．．．．．．．．．．．．．．．．．68 4.1.1 存储器分类．．．．．．．．．．．．．．．．．．．亭．68 4.1.2 存储器的层次结构…………70  4.2 主存储器.................................72  4.2.1 概述．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．72 4.2.2 半导体存储芯片简介...……74  4.2.3 随机存取存储器……………76  4.2.4 只读存储器.....................88  4.2.5 存储器与CPU的连接………91 4.2.6 存储器的校验．．．．．．．．．．．．．．．．．．100 4.2.7 提高访存速度的措施………103 4.3 高速缓冲存储器…………………109 4.3今1概述．．．篇．．．．．．．．．．．．．．．．．．．．．．．．．．109 4.3.2 Cache—主存地址映射…...117  4.3.3 替换策略．．．．．．．．．．．．．．．．．．．．．．．．122 4.4 辅助存储器...........................123  4.4.1 概述．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．123 4.4.2 磁记录原理和记录方式……125 4.4.3 硬磁盘存储器．．．．．．．．．．．．．．．．．．129 4.4.4 软磁盘存储器．．．．鲁·............137  4.4.5 磁带存储器．．．．．．．．．．．..........141  4.4.6 循环冗余校验码…...…...…144 4.4.7 光盘存储器．．．．．．．．．．．．．．．．．．．．．146 习题...................曹．．．．．．．．．令令．．149 附录4A相联存储器·参....……..参......152  第5章输入输出系统........................…155 5.1 概述...........令．．.........................155  5.1.1 输入输出系统的发展 概况．．．．．．．．．．．．．．．．．．．．．．．霄......155  5.1.2 输入输出系统的组成………157 5.1.3 I/0设备与主机的联系 方式．．．．．．．．．．零...................159  5.1.4 I/0设备与主机信息传 送的控制方式．．．．．．．．．．........161  5.2 1/0设备.................................165  5.2.1 概述．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．165 5.2.2 输入设备．．．．．．．．．．．．．．．．．．．．．．．．166 5.2.3 输出设备．．．．．．．．．．．．．．．．．．．．．．．．170 5.2.4 其他I/0设备．．．．．．．．．．．．．．．．．．181 5.2.5 多媒体技术．．．．．．．．．．．．参........183  5.千31/0接口·鲁·..............................185  5.3.l 概述．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．185 5.3.2 接口的功能和组成．喻........零.186 5.3.3 接口类型鲁.......................188  5.4 程序查询方式......….潭.．．．．．．……189 5.4.1 程序查询流程．．．．．．．．．．．．．．．．．．189 5.4.2 程序查询方式的接口 电路．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．191 5.5 程序中断方式........................192  5.5.1 中断的概念．．．．．．．..............192  5.5.2 I/0中断的产生．．．．．．．．．．．．．．．193 5.5.3 程序中断方式的接口 电路．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．194 5.5.4 I/0中断处理过程．．．………197 5.5.5 中断服务程序的流程………198 5.6 DMA方式..............................200  5.6.1 DMA方式的特点...............200  5.6.2 DMA接口的功能和组成…...202  5.6.3 DMA的工作过程...……...．．.205 5.6.4 DMA接口的类型......………209 习题.................................210  附录5AASCII码........................ 212  附录5BBCD码·· ·拿．．．．．．．．．．．．．．．．．．．．．．．214 5C 奇偶校检码................令膏...215"}
{"doc_id": "co", "page": 5, "text": "目录rn  第6章 6.1  6.1等1 6.1.2  6.2 娄 6.2.1  6.2.2  6.2.3  6.2.4  6.2.5  6.3 庄 6.3.1  6.3.2  6.3.3  6.3.4  6.4  6.4.1  6.4.2  6.4.3  3篇 .................. 219  ............... 219  无符号数．．．．．．．．．．．．．．．．．．．．．．..219  有符号数．．．．．．．．．．．．．．．．．．．．．．．．219 忙＼示和浮点表示...…228  定点表示．．．．．．．．．．．．．．．．．．．．．．．．228 浮点表示．．．．．．．．．．．．．．．．．．．．．．．．229 定点数和浮点数的比较……231 举例．．．．．．．．．．．．．．．．．．．．．．．．．．....231  IEEE 754才示准L••• ••• ••• ••• ••• ••• 233  ................................. 234  移位运算．．．．．．．．．．．．．．．．．．．．．．．．234 加法与减法运算……………237 乘法运算．．．．．．．．．．．．．．．．．．．．．．．．243 除法运算．．．．．．．．．．．．．．．．．．．．．．．．258 r........................ 269  浮点加减运算．．．．．．．．．．．．．．．．．．269 浮点乘除法运算...………...274  浮点运算所需的硬件 配置．．．．．．．．．．．．．．．．．．．．．．．．．．．．．．280 6.5 算术逻辑单元．．．．．．．．．．．．．．．．．．．．萱雹..280  6.5.1 ALU电路．．．．．．．．．．．．．．．．．．．．．．．．281 6.5.2 快速进位链．．．．．．．．．．．．．．．．．·...283  习题..........蓦．．．．．．．．．．．．．．．．．．．．．．289 各种进位制.....................293  6A.1 各种进位制的对应 关系．．．．．．．．．．．．．．．．．．．．．．．．293 6A.2 各种进位制的转换…...293  6B 阵列乘法器和阵列除 .............................. 296  附录6C74181逻辑电路……...…...298 7章指令系统.................................300  7.1 机器指令...........置...．．．．．．．．．.．．．．．．．．300 7.1.1 指令的一般格式．．．．．．．．．．．．．．．300 处 7.1.2 指令字长．．．．．．．．．．．．．．．．．．．．．．．．304 7.2 操作数类型和操作类型...……...304 7.2.1 操作数类型．．．．．．．．．．．．．．．．．．．．．304 7.2.2 数据在存储器中的存 放方式．．．．．．．．．．．．．．．．．．．．．．．．．．．305 7.2.3 操作类型．．．．．．．．．．．．．．．．．．．．．．．．306 7.3 寻址方式.................................309  7.3.1 指令寻址．．．．．．．．．．．．．．．．．．．．．．．．310 7.3.2 数据寻址．．．．．．．．．...............310  7.4 指令格式举例........................319  7.4.1 设计指令格式应考虑的 各种因素．．．．．．．．．．．．亭．．．．．．．．．．寡319 7.4.2 指令格式举例鲁........….．．．．．320 7.4.3 指令格式设计举例………...322  7.5 RISC技术........争．．．．．．．．＊...窖会．．．偷．．．325 7.5.1 RISC的产生和发展…………326 7.5.2 RISC的主要特征...............329  7.5.3 RISC和CISC的比较………332 习题.........................事.．．．．.．334 第8章CPU的结构和功能······ ··· ···...... 337  8.1 CPU的结构...........................337  8.1.1 CPU的功能．．．．．．．．．．．．．．．．．．．．．337 8.1.2 CPU结构框图．．．．．．．．.......…338 8.1.3 CPU的寄存器．．．．．．．．．．．．．．．．．．338 8.1.4 控制单元和中断系统………342 8.2 指令周期.................................342  8.2.1 指令周期的基本概念………342 8.2.2 指令周期的数据流…………344 8.3 指令流水....奄．．．....零．．．．．．．．．．．簪........345  8.3.1 指令流水原理．．．．．．．．．．．．．．．．．．346 8.3.2 影响流水线性能的因素……348 8.3膏3流水线性能．．．．．．．．．．墓．．．．．．．．．．353 8.3.4 流水线中的多发技术………355 8.3.5 流水线结构．．．．．．．．．．嚼．．．．．．．．．．357"}
{"doc_id": "co", "page": 6, "text": "IV 目录 8.4 中断系统.................................358  8.4.1 概述．．．．毒．．．．．．．．．．．．．．．．．．．．．．．．．358 8.4.2 中断请求标记和中断 判优逻辑．．．．．．．．．．．．．．．．．．．．．．．．360 8.4.3 中断服务程序入口地 址的寻找．．．．．．．．．．．．．．．．．．．．．．．．361 8.4.4 中断响应．．．．．．．．．．．．．．．．．．．．．．．．362 8.4.5 保护现场和恢复现场………364 8.4.6 中断屏蔽技术…......….．．...364  习题.................................370  笫4篇控制单 第9章控制单元的功能...…...…......…375 9.1 微操作命令的分析………………375 9.1.1 取指周期．．．．．．．．．．．．．．．．．．．．．．噜．375 9.1.2 间址周期．．．．．．．．．．．．．．．．．．．．．．．．376 9.1.3 执行周期．．．．．．．．．．．．．．．．．．．．．．．．376 9.1.4 中断周期．．．．．．．．．．．．．．．．．．．．．．．．378 9.2 控制单元的功能...…...……..．靡..379 9.2摹1控制单元的外特性……．．．．．．379 9.2.2 控制信号举例．．．．．．．．．．．．．冬．．．．380 9.2.3 多级时序系统．．．．．．．．．．．．．．．．．．385 9.2.4 控制方式．．．．．．．．．．．．．．．．．．．．．．．．387 9.2.5 多级时序系统实例分析…．．．389 习题.................................393  第10章控制单元的设计…………...…..．395 10.1 组合逻辑设计.....................395  10.1.1 组合逻辑控制 框图．．．．．．．．．．.................395  10.1.2 微操作的节拍安排………396 10拿1.3组合逻辑设计步骤……．．．401 10.2 微程序设计．．．．．．．．．．．．．．．．．．．．．．．．403 10.2.1 微程序设计思想的 产生．拿毒拿.......................403  10.2.2 微程序控制 图及工作原理．．．．．．．．．．．．．．．404 10.2.3 微指令的编码方式………407 10.2.4 微指令序列地址的 形成．．．．．．．．．．．．．．．．．．．．．事．．．．．408 10.2.5 微指令格式．．．．．．．．．…......410  10.2.6 静态微程序设计和动 态微程序设计...…···……412 10.2.7 毫微程序设计．．．．．．．．．．．．．．．413 10.2.8 串行微程序控制和并 行微程序控制．．．．．．．．．．．．．．．413 10.2.9 微程序设计举例…···……414  习题.......筹．．．．．．．．．．檐．．．．．．．．．．．420 附录lOAPC整机介绍……………423 lOA.1 主板．．．．．．．．．．．．．．．．．．．．．．．．．．．423 lOA.1.1 主板的主要组成 部件．．．．．．．．．．．．．．．．．．．．．423 lOA.1.2 CPU芯片及插座 （插槽）．．．．．．．．．．．．瑜．．．．．424 lOA.1.3 内存条插槽…···…...424 lOA.1.4 扩展插槽．．．．．．．．．．．．．．．424 lOA.1.5 配套芯片和器件……424 lOA.1.6 主板结构的改进···…424 lOA.2 芯片组．．．．．．．．．．．．．．．．．．．．．．．．425 lOA.2.1 芯片组的功能．拿·· ··…425  lOA.2.2 芯片组的组成………426 参考文献...........................................................................................................................429"}
{"doc_id": "co", "page": 7, "text": "、 本篇主要介绍计算机系统的基本组成、应用与发展，并通过对本书结构的介 绍，指出学习本书的基本思路。"}
{"doc_id": "co", "page": 9, "text": "1  了解， 计算机的组成概貌及工作原理，旨在使读者对计算机总体结构有一个概括的 面各章打下基础。 1.1 机系统简介 机 计算机系统由“硬件”和“软件”两大部分组成。 所谓“硬件”，是指计算机的实体部分，它由看得见摸得着的各种电子元器件，各类光、电、机 设备的实物组成，如主机、外部设备等。 所谓“软件”，它看不见摸不着，由人们事先编制的具有各类特殊功能的 如RAM、ROM、磁带、磁盘、光盘，甚至纸带等），它们 机的主存或辅存内。由于“软件”的发展不仅可以充分发挥机器的“硬件”功能，提高机器的工作 效率，而且已经发展到能局部模拟人类的思维活动，因此在整个计算机系统内，“软件”的地位和 作用已经成为评价计算机系统性能好坏的重要标志。当然，“软件“性能的发挥也必须依托“硬 件”的支撑。因此，概括而言，计算机性能的好坏取决于“软”“硬＂件功能的总和 计算机的软件通常又可以分为两大类：系统软件和应用软件。 统软件又称为系统程序，主要用来管理整个计算机系统，监视服务，使系统资源得到合理 。它包括：标准程序库、语言处理程序（如将汇编语言翻译成机器语言的汇编 统（如批处理系统、分时系统、实时系统）、 服务程序（如诊断程序、询试程序、连接程序等）、数据库管理系统、网络软件等。 应用软件又称为应用程序，它是用户根据任务需要所编制的各种程序，如科学计算程序、数 、过程控制程序 现代计算机的解题过程如下。"}
{"doc_id": "co", "page": 10, "text": "4  第1篇概论 通常由用户用高级语言编写程序（称为源程序），然后将它和数据一起送入计算机内，再由 计算机将其翻译成机器能识别的机器语言程序（称为目标程序），机器自动运行该机器语 序，并将计算结果输出。其过程如图1.1口1小。 图1.1 实际上，早期的计算机只有机器语言（用0、1代码表示的语言），用户必须用二进制代码(0、 1)来编写程序（即机器语言程序）。这就要求程序员对他们所使用的计算机硬件及其指令系统 十分熟悉，编写程序难度很大，操作过程也极容易出错。但用户编写的机器语言程序可以 机器上执行。直接执行机器语言的机器称为实际机器Ml，如图1.2所示。 M1上执行 图1.2实际机器Ml 20世纪50年代开始出现了符号式的程序设计语言，即汇编语言。它用符号ADD、SUB、 MUL、DIV等分别表示加、减、乘、除等操作，并用符号表示指令或数据所在存储单元的地址，使程 以不再使用繁杂而又易错的二进制代码来编写程序。但是，实际上没有一种机器能直接 识别这种汇编语言程序，必须先将汇编语言程序翻译成机器语言程序，然后才能被机器接受并自 动运行。这个翻译过程是由机器系统软件中的汇编程序来完成的。如果把具有翻译功能的汇编 程序的计算机看作一台机器M2，那么，可以认为队在Ml之上，用户可以利用汇的 接向队输入汇编语言程序，而队又会将翻译后的机器语言程序输入给Ml,M1执行后将结果输 出。因此，凡并不是一台实际机器，它只是人们感到存在的一台具有翻译功能的机器，称这类机 器为虚拟机。这样，整个计算机系统便具有两级层次结构，如图1.3 第二级 第一级 实际机器M1 （机器语言机器）M1上执行 图1.3具有两级层次结构的计算机系统"}
{"doc_id": "co", "page": 11, "text": "第1章统概论 5  尽管有了虚拟机队使用户编程更为方便，但从本质上看，汇编语言仍是一种面向实际机器 ，它的每一条语旬都与机器语言的某一条语旬(0、1代码）一一对应。因此，使用汇编语言 时，仍要求程序员对实际机器M的内部组成和指令系统非常熟悉， 必须经过专门的训练，否则是无法操作计算机的。另一方面，由于汇编语言摆脱不了实际机器的 统，因此，汇编语言没有通用性，每台机器必须有一种与之相对应的汇编语言。这使得程 同机器的指令系统，不利于计算机的广泛应用和发展。 20世纪60年代开始先后出现了各种面向问题的高级语言，如FORTRAN、BASIC、Pascal、C 。这类高级语言对问题的描述十分接近人们的习惯，并且还具有较强 不必了解、掌握实际机器Ml的机型、内部的具体组成及其指令系统，只 语法和语义，便可直接用这种高级语言来编程，这给程序员带来了极大的 本身是不能识别高级语言的，因此，在进入机器Ml运行前， （或其他中间语言程序），然后再将其翻译成机器语言程序；也可以将 接翻译成机器语言程序。这些工作都是由虚拟机器队来完成的，对程序员 这个翻译过程。由此又可得出具有三级层次结构的计算机系统，如图1.4所示 （虚高拟级机语器言机M器3) 1将再在高级M语2、言M 程1序（或先直翻接译到成汇M编1)语上执言行程序 第二级1（虚汇拟编语机器言机M器2) 1将语汇言编程语序言，再程在序M先1翻上译执成行机器 机器语言程序直接在Ml上执行 第一级1 图1.4的计算机系统 通常，将高级语言程序翻译成机器语言程序的软件称为翻译程序。翻译程序有两种：一种是 ，另一种是解释程序。编译程序是将用户编写的高级语言程序（源程序）的全部语旬 次全部翻译成机器语言程序，而后再执行机器语言程序。因此，只要源程序不变，就无须再次进 行翻译。例如，FORTRAN、Pascal等语言就是用编译程序来完成翻译的。解 的一条语旬翻译成对应于机器语言的一条语旬，并且立即执行这条语旬，接着翻译源程序的下一 ，并执行这条语旬，如此重复直至完成源程序的全部翻译任务。它的特点是翻译一次执行 一次，即使下一次重复执行该语旬时，也必须重新翻译。例如，BASIC语言的翻译就有解 和编译程序两种。 从上述介绍中不难看出，由于软件的发展，使实际机器M向上延伸构成了各级虚拟机器。 同理，机器Ml内部也可向下延伸而形成下一级的微程序机器M。。机器凡是直接将机器M中 的每一条机器指令翻译成一组微指令，即构成一个微程序。机器M。每执行完对应于一条机器"}
{"doc_id": "co", "page": 12, "text": "6  第1篇概论 ，便由机器Ml中的下一条机器指令使机器M。自动进入与其相对应的另 个微程序的执行。由此可见，微程序机器M。可看作是对实际机器M的分解，即用队的微程序 解释并执行Ml的每一条机器指令（有关微程序机器的介绍，详见第10章）。由于机器M。 ，因此，为了区别于Ml，通常又将Ml称为传统机器，将队称为微程序机器。 统具有四级层次结构，如图1.5口1小。 第二级＇陑妇宝今扫佥l用汇编程序翻译成机器语言程序 传统机器M 第一级1（机器语言机器） l 1用微程序解释机器指令 微程序机器M。 （微指令系统）1由硬件直接执行微指令 图1.5具有四级层次结构 四级层次结构的系统中，实际上在实际机器Ml与虚拟机器队之间还有一级虚拟机 系统软件构成的。操作系统提供了在汇编语言和高级语言的使用和 ，还起到控制并管理计算机系统全部硬件和软件资源的作用，为用户 算机系统提供极为方便的条件。操作系统 的五级计算机系统的层次结构。 虚拟机器队还可向上延伸，构成应用语言虚拟机。这一级是为使计算机满足某种用途而 门设计的，该级所用的语言是各种面向问题的应用语言，如用于人工智能和计算机设计等方面 的程序一般由应用程序包翻译到虚拟机器M4上0 统的多级层次结构来看，可以将硬件研究的主要对象归结为传统机器M和 程序机器M。。软件的研究对象主要是操作系统级以上的各级虚拟机。值得指出的是， 的划分并不是一成不变的。随着超大规模集成电路技术的不断发展，一部分软件功能将 由硬件来实现，例如，目前操作系统已实现了部分固化（把软件永恒地存千只读存储器中），称为 固件等。可见，软硬件交界界面变化的趋势正沿着图1.6所示的方向向上发展。 本书主要讨论传统机器M和微程序机器汇的组成原理及设计思想，其他各级虚拟机的内 容均由相应的软件课程讲授。"}
{"doc_id": "co", "page": 13, "text": "第1章计算机系统概论 7  （虚高拟级机语器言机M器4）1用成编汇译编程语序言翻程译序 （虚汇拟编机语器言机队器）1用成汇机器编程语序言翻程译序 （虚操拟作机系器统机M器2) I用机器语言解释操作系统 （传机统器语机器言机M器l) 1用微程序解释机器指令 微程序机器系统M）。 （微指令系 由硬件直接执行微指令 图1.6多级层次结构的计算机系统 计机组成和计机体结构 在学习计算机组成时，应当注意如何区别计算机体系结构与计算机组成这两个基本概念。 计算机体系结构是指那些能够被程序员所见到的计算机系统的属性，即概念性的结构与 功能特性。计算机系统的属性通常是指用机器语言编程的程序员（也包括汇编语言程序设计 者和汇编程序设计者）所看到的传统机器的属性，包括指令集、数据类型、存储器寻址技术、I/ 0机理等，大都属千抽象的属性。由于计算机系统具有多级层次结构，因此，站在不同层次 上编程的程序员所看到的计算机属性也是各不相同的。例如，用高级语言编程的程序员可 以把IBMPC与RS6000两种机器看成是同一属性的机器。可是，对使用汇编语言编程的程 序员来说，IBMPC与RS6000是两种截然不同的机器。因为程序员所看到的这两种机器的 属性，如指令集、数据类型、寻址技术等，都完全不同，因此，认为这两种机器的结构是各不 相同的。 计算机组成是指如何实现计算机体系结构所体现的属性，它包含了许多对程序员来说是透 明的硬件细节。例如，指令系统体现了机器的属性，这是属千计算机结构的问题。但指令的实 现，即如何取指令、分析指令、取操作数、运算、送结果等，这些都属于计算机组成问题。因此，当 两台机器指令系统相同时，只能认为它们具有相同的结构。至千这两台机器如何实现其指令的 功能，完全可以不同，则它们的组成方式是不同的。例如，一台机器是否具备乘法指令的功能，这 是一个结构问题，可是，实现乘法指令采用什么方式，则是一个组成问题。实现乘法指令可以采"}
{"doc_id": "co", "page": 14, "text": "8  第1篇概论 用一个专门的乘法电路，也可以采用连续相加的加法电路来实现，这两者的区别就是计算机组成 的区别。究竟应该采用哪种方式来组成计算机，要考虑到各种因素，如乘法指令使用的频度、两 种方法的运行速度、两种电路的体积、价格、可靠性等。 不论是过去还是现在，区分计算机结构与计算机组成这两个概念都是十分重要的。例如，许 多计算机制造商向用户提供一系列体系结构相同的计算机，而它们的组成却有相当大的差别，即 使是同一系列不同型号的机器，其价格和性能也是有极大差异的。因此，只知其结构，不知其组 成，就选不好性能价格比最合适的机器。此外，一种机器的体系结构可能维持许多年，但机器的 组成却会随着计算机技术的发展而不断变化。例如，1970年首次推出了IBMSystem/370结构， 它包含了许多机型。一般需求的用户可以买价格便宜的低速机型；对需求高的用户，可以买一台 升级的价格稍贵的机型，而不必抛弃原来已开发的软件。许多年来，不断推出性能更高、价格更 低的机型，新机型总归保留着原来机器的结构，使用户的软件投资不致浪费。 本书主要研究计算机的组成，有关计算机体系结构的内容将在“计算机体系结构”课程 中讲述。 1.2 计算机的基本组成 1  依机 1945年，数学家冯·诺依曼(vonNeumann)在研究EDVAC机时提出了“存储程序”的概念。 以此概念为基础的各类计算机通称为冯·诺依曼机。它的特点可归结如下： 0计算机由运算器、存储器、控制器、输入设备和输出设备五大部件组成。 0指令和数据以同等地位存放千存储器内，并可按地址寻访。 ·指令和数据均用二进制数表示。 ·指令由操作码和地址码组成，操作码用来表示操作的性质，地址码用来表示操作数在存 储器中的位置。 ·指令在存储器内按顺序存放。通常，指令是顺序执行的，在特定条件下，可根据运算结果 或根据设定的条件改变执行顺序。 0机器以运算器为中心，输入输出设备与存储器间的数据传送通过运算器完成。 计算机的框图 典型的冯·诺依曼计算机是以运算器为中心的，如图1.7所示。 现代的计算机已转化为以存储器为中心，如图1.8所示。"}
{"doc_id": "co", "page": 15, "text": "第1章计算机系统概论 9  --数据线 --才空制线和反馈线 图1.7典型的冯·诺依曼计算机结构框图 －控制线 ---反馈线 ＝令数据线 图1.8以存储器为中心的计算机结构框图 图中各部件的功能如下： 0运算器用来完成算术运算和逻辑运算，并将运算的中间结果暂存在运算器内。 0存储器用来存放数据和程序。 0控制器用来控制、指挥程序和数据的输入、运行以及处理运算结果。 0输入设备用来将人们熟悉的信息形式转换为机器能识别的信息形式，常见的有键盘、鼠 标等。 0输出设备可将机器运算结果转换为人们熟悉的信息形式，如打印机输出、显示器输 出等。 计算机的五大部件（又称五大子系统）在控制器的统一指挥下，有条不紊地自动工作。 由千运算器和控制器在逻辑关系和电路结构上联系十分紧密，尤其在大规模集成电路制作 工艺出现后，这两大部件往往集成在同一芯片上，因此，通常将它们合起来统称为中央处理器 (Central Processing Unit, CPU)。把输入设备与输出设备简称为I/0设备(Input/OutputEquip- ment)。 这样，现代计算机可认为由三大部分组成：CPU、I/0设备及主存储器(MainMemory, MM),  如图1.9所示。CPU与主存储器合起来又可称为主机，I/0设备又可称为外部设备。"}
{"doc_id": "co", "page": 16, "text": "10 第1篇概论 主机—---控制线 VO  －－一反馈线 ＝字＞数据线 砉篡 |亡vi|弃小六罚霄丿I.JII 设 I I 怡.¢11凶于I I I 工1备 图1.9现代计算机的组成框图 图1.9中的主存储器是存储器子系统中的一类，用来存放程序和数据，可以直接与CPU交 换信息。另一类称为辅助存储器，简称辅存，又称外存，其功能参阅4.4节。 算术逻辑单元(ArithmeticLogic Unit, ALU)简称算逻部件，用来完成算术逻辑运算。控制单 元(ControlUnit, CU)用来解释存储器中的指令，并发出各种操作命令来执行指令。ALU和CU 是CPU的核心部件。 1/0设备也受CU控制，用来完成相应的输入、输出操作。 可见，计算机有条不紊地自动工作都是在控制器统一指挥下完成的。 1.2。3计算机的工作步骤 用计算机解决一个实际问题通常包含两大步骤。一个是上机前的各种准备，另一个是上机 运行。 1.上机前的准备 在许多科学技术的实际问题中，往往会遇到许多复杂的数学方程组，而数字计算机通常只能 执行加、减、乘、除四则运算，这就要求在上机解题前，先由人工完成一些必要的准备工作。这些 工作大致可归纳为：建立数学模型、确定计算方法和编制解题程序3个步骤。 (1)建立数学模型 有许多科技问题很难直接用物理模型来模拟被研究对象的变化规律，如地球大气环流、原子 反应堆的核裂变过程、航天飞行速度对飞行器的影响等。不过，通过大量的实验和分析，总能找 到一系列反映研究对象变化规律的数学方程组。通常，将这类方程组称为被研究对象变化规律 的数学模型。一旦建立了数学模型，研究对象的变化规律就变成了解一系列方程组的数学问题， 这便可通过计算机来求解。因此，建立数学模型是用计算机解题的第一步。 (2)确定计算方法 由于数学模型中的数学方程式往往是很复杂的，欲将其变成适合计算机运算的加、减、乘、除 四则运算，还必须确定对应的计算方法。 例如，欲求sinx的值，只能采用近似计算方法，用四则运算的式子来求得（因计算机内部没"}
{"doc_id": "co", "page": 17, "text": "第1章计算机系统概论 有直接完成三角函数运算的部件）。 3 5 7 9  X X X X  sin x =x---+—-—-+---...  3 ! 5 ! 7 ! 9 !  又如，计算机不能直接求解开方x，但可用迭代公式： Yn+l＝石＝寸勹(n=0,1,2,…） 通过多次迭代，便可求得相应精度的五值：0 (3)编制解题程序 11  程序是适合于机器运算的全部步骤，编制解题程序就是将运算步骤用一一对应的机器指令 描述。 例如，计算ax2+bx+c可分解为以下步骤。 叩将x取至运算器中。 ＠乘以x，得x2，存于运算器中。 ＠再乘以a，得ax2，存千运算器中。 ＠将ax2送至存储器中。 ＠取b至运算器中。 ＠乘以x，得bx，存于运算器中。 ＠将ax2从存储器中取出与bx相加，得ax2+bx，存于运算器中。 ＠再取c与ax2+bx相加，得ax2+bx+c，存千运算器中。 可见，不包括停机、输出打印共需8步。若将上式改写成：（ax+b)x+c，则其步骤可简化为以 下5步。 心将x取至运算器中。 ＠乘以a，得ax，存于运算器中。 ＠加b，得ax+b，存于运算器中。 ＠乘以x，得（ax+b)x，存于运算器中。 ＠加c，得（ax+b)x+c，存千运算器中。 将上述运算步骤写成某计算机一一对应的机器指令，就完成了运算程序的编写。 设某机的指令字长为16位，其中操作码占6位，地址码占10 位，如图1.10所示。1 操作码1 地址码1  操作码表示机器所执行的各种操作，如取数、存数、加、减、乘、I--6位」-10位-| 除、停机、打印等。地址码表示参加运算的数在存储器内的位置。 图1.10某机器指令格式 机器指令的操作码和地址码都采用0、1代码的组合来表示。表1.1 列出了某机与上例有关的各条机器指令的操作码及其操作性质的对应关系。"}
{"doc_id": "co", "page": 18, "text": "12 第1篇概论 表1.1操作码与操作性质的对应表 \\ ,  操作码操作性质具体内容 000001 取数 将指令地址码指示的存储单元中的操作数取到运算器的累加器 ACC中 000010 存数将ACC中的数存至指令地址码指示的存储单元中 000011 加 将ACC中的数与指令地址码指示的存储单元中的数相加，结果 存于ACC中 000100 乘 将ACC中的数与指令地址码指示的存储单元中的数相乘，结果 存于ACC中 000101 打印将指令地址码指示的存储单元中的操作数打印输出 000110 停机 此例中所用到的数a、b、C、X，事先需存入存储器的相应单元内。 按ax2+bx+c的运算分解，可用上述机器指令编写出一份运算的程序清单，如表1.2所列。 表1.2计算ax2+bx+c程序清单 指令和数据存于指人屋 主存单元的地址 注释 操作码地址码 。000001 0000001000 取数x至ACC 1 000100 0000001001 乘a得ax，存千ACC中 2 000011 0000001010 加b得ax+b，存于ACC中 3 000100 0000001000 乘x得(ax+b)x，存于ACC中 4 000011 0000001011 加c得ax2+bx+c，存于ACC中 5 000010 0000001100 存数，将ax2+bx+c存于主存单元 6 000101 0000001100 打印 7 000110 停机 8 X 原始数据x 9 a 原始数据a 10 b 原始数据b 11 C 原始数据c 12 存放结果"}
{"doc_id": "co", "page": 19, "text": "第1章计算机系统概论13  以上程序编完后，便可进入下一步上机。 2.计算机的工作过程 为了比较形象地了解计算机的工作过程，首先分析一个比图1.9更细化的计算机组成框图， 如图1.11所示。 1!,li!|'|!|·— .1  器－制． －三－勹二 PU 厂—lii· — ,li', C 「 I· —·|·|·—.—i! 一言 I- 丁卢芦 l IIO 设备 图1.11细化的计算机组成框图 (1)主存储器 主存储器（简称主存或内存）包括存储体M、各种逻辑部件及控制电路等。存储体由许多存 储单元组成，每个存储单元又包含若干个存储元件（或称存储基元、存储元），每个存储元件能寄 存一位二进制代码“0”或“1”。可见，一个存储单元可存储一串二进制代码，称这串二进制代码 为一个存储字，这串二进制代码的位数称为存储字长。存储字长可以是8位、16位或32位等。 一个存储字可代表一个二进制数，也可代表一串字符，如存储字为0011011001111101，既可表示 为由十六进制字符组成的367DH（有关十六进制数制详见附录6A)，又可代表16位的二进制 数，此值对应十进制数为13949，还可代表两个ASCII码：＂6”和“}＂（参见附录5AASCII编码 表）。一个存储字还可代表一条指令（参阅表1.2)。 如果把一个存储体看作一幢大楼，那么每个存储单元可看作大楼中的每个房间，每个存储元 可看作每个房间中的一张床位，床位有人相当于“1”，无人相当于“0”。床位数相当于存储字长。 显然，每个房间都需要有一个房间编号，同样可以赋予每个存储单元一个编号，称为存储单元的 地址号。 主存的工作方式就是按存储单元的地址号来实现对存储字各位的存（写入）、取（读出）。这种 存取方式称为按地址存取方式，即按地址访间存储器（简称访存）。存储器的这种工作性质对计算 机的组成和操作是十分有利的。例如，人们只要事先将编好的程序按顺序存入主存各单元，当运行 程序时，先给出该程序在主存的首地址，然后采用程序计数器加1的方法，自动形成下一条指令所 在存储单元的地址，机器便可自动完成整个程序的操作。又如，由于数据和指令都存放在存储体内 各自所占用的不同单元中，因此，当需要反复使用某个数据或某条指令时，只要指出其相应的单元 地址号即可，而不必占用更多的存储单元重复存放同一个数据或同一条指令，大大提高了存储空间"}
{"doc_id": "co", "page": 20, "text": "14 第1篇概论 的利用率。此外，由于指令和数据都由存储单元地址号来反映，因此，取一条指令和取一个数据的 操作完全可视为是相同的，这样就可使用一套控制线路来完成两种截然不同的操作。 为了能实现按地址访间的方式，主存中还必须配置两个寄存器MAR和MDR。MAR (Memory Address Register)是存储器地址寄存器，用来存放欲访间的存储单元的地址，其位数对 应存储单元的个数（如MAR为10位，则有210= 1 024个存储单元，记为1K)。MDR(Memory Data Register)是存储器数据寄存器，用来存放从存储体某单元取出的代码或者准备往某存储单 元存入的代码，其位数与存储字长相等。当然，要想完整地完成一个取或存操作，CPU还得给主 存加以各种控制信号，如读命令、写命令和地址译码驱动信号等。随着硬件技术的发展，主存都 制成大规模集成电路的芯片，而将MAR和MDR集成在CPU芯片中（参阅图4.5)。 早期计算机的存储字长一般和机器的指令字长与数据字长相等，故访问一次主存便可取一 条指令或一个数据。随着计算机应用范围的不断扩大，解题精度的不断提高，往往要求指令字长 是可变的，数据字长也要求可变。为了适应指令和数据字长的可变性，其长度不由存储字长来确 定，而由字节的个数来表示。1个字节(Byte)被定义为由8位(bit)二进制代码组成。例如，4字 节数据就是32位二进制代码；2字节构成的指令字长是16位二进制代码。当然，此时存储字 长指令字长、数据字长三者可各不相同，但它们必须是字节的整数倍。 (2)运算器 运算器最少包括3个寄存器（现代计算机内部往往设有通用寄存器组）和一个算术逻辑单 元(ALU)。其中ACC(Accumulator)为累加器，MQ(Multiplier-Quotient Register)为乘商寄存器，X 为操作数寄存器。这3个寄存器在完成不同运算时，所存放的操作数类别也各不相同。表1.3 列出了寄存器存放不同类别操作数的情况。 表1.3各寄存器所存放的各类操作数 :  加法减法乘法除法 ACC 被加数及和被减数及差乘积高位被除数及余数 MQ 乘数及乘积低位商 X 加数减数被乘数除数 不同机器的运算器结构是不同的。图1.11所示的运算器可将运算结果从ACC送至存储器 中的MDR；而存储器的操作数也可从MDR送至运算器中的ACC、MQ或X。有的机器用MDR取 代X寄存器。 下面简要地分析一下这种结构的运算器加、减、乘、除四则运算的操作过程。 设：M表示存储器的任一地址号，［M］表示对应M地址号单元中的内容；X表示X寄存器， [X]表示X寄存器中的内容；ACC表示累加器，［ACC]表示累加器中的内容；MQ表示乘商寄存"}
{"doc_id": "co", "page": 21, "text": "第1章计算机系统概论 器，［MQ]表示乘商寄存器中的内容。 假设ACC中已存有前一时刻的运算结果，并作为下述运算中的一个操作数，则 ·加法操作过程为 [M]一X [ACC] +[X]-+ACC  15  即将[ACC]看作被加数，先从主存中取一个存放在M地址号单元内的加数[M]，送至运算器的 X寄存器中，然后将被加数[ACC]与加数[X]相加，结果（和）保留在ACC中。 0减法操作过程为 [M]-+X  [ACC]-[X]-+ACC  即将[ACC]看作被减数，先取出存放在主存M地址号单元中的减数[M]并送入X，然后[ACC] -[X]，结果（差）保留在ACC中。 0乘法操作过程为 [M]-+MQ  [ACC]一X 0-+ACC  [X]x[MQ]-+ACC//MQ心 即将[ACC]看作被乘数，先取出存放在主存M号地址单元中的乘数[M]并送入乘商寄存器 MQ，再把被乘数送入X寄存器，并将ACC清“0”，然后[X]和[MQ]相乘，结果（积）的高位保 留在ACC中，低位保留在MQ中。 ＠除法操作过程为 [M]-+X  [ ACC] +[ X]-+MQ  余数R在ACC中 即将[ACC]看作被除数，先取出存放在主存M号地址单元内的除数[M]并送至X寄存器，然 后[ACC]除以[X]，结果（商）暂留千MQ,[ACC]为余数R。若需要将商保留在ACC中，只需 做一步[MQ]-+ACC即可。 (3)控制器 控制器是计算机的神经中枢，由它指挥各部件自动、协调地工作。具体而言，它首先要命令 存储器读出一条指令，称为取指过程（也称取指阶段）。接着，它要对这条指令进行分析，指出该 指令要完成什么样的操作，并按寻址特征指明操作数的地址，称为分析过程（也称分析阶段）。 最后根据操作数所在的地址以及指令的操作码完成某种操作，称为执行过程（也称执行阶段）。 心／／表示两个寄存器串接。"}
{"doc_id": "co", "page": 22, "text": "16 第1篇概论 以上就是通常所说的完成一条指令操作的取指、分析和执行3个阶段。 控制器由程序计数器(ProgramCounter, PC)、指令寄存器(InstructionRegister, IR)以及控制 单元(CU)组成。PC用来存放当前欲执行指令的地址，它与主存的MAR之间有一条直接通路， 且具有自动加1的功能，即可自动形成下一条指令的地址。IR用来存放当前的指令，IR的内容 来自主存的MDR。IR中的操作码(OP(IR)）送至CU，记作OP(IR)-+CU，用来分析指令；其地 址码(Ad(IR)）作为操作数的地址送至存储器的MAR，记作Ad(IR) -+ MAR。CU用来分析当前 指令所需完成的操作，并发出各种微操作命令序列，用以控制所有被控对象。 (4) I/0  I/0子系统包括各种I/0设备及其相应的接口。每一种I/0设备都由I/0接口与主机联 系，它接收CU发出的各种控制命令，并完成相应的操作。例如，键盘（输入设备）由键盘接口电 路与主机联系；打印机（输出设备）由打印机接口电路与主机联系。 下面结合图1.11进一步深入领会计算机工作的全过程。 首先按表1.2所列的有序指令和数据，通过键盘输入到主存第0号至第12号单元中，并置 PC的初值为0（令程序的首地址为0)。启动机器后，计算机便自动按存储器中所存放的指令顺 序有序地逐条完成取指令、分析指令和执行指令，直至执行到程序的最后一条指令为止。 例如，启动机器后，控制器立即将PC的内容送至主存的MAR（记作PC-+MAR)，并命令存 储器做读操作，此刻主存“0”号单元的内容“0000010000001000\"（表1.2所列程序的第一条指 令）便被送入MDR内。然后由MDR送至控制器的IR（记作MDR-+IR)，完成了一条指令的取指 过程。经CU分析（记作OP(IR)-+CU)，操作码“000001”为取数指令，于是CU又将IR中的地 址码“0000001000“送至MAR（记作Ad(IR)-+MAR)，并命令存储器做读操作，将该地址单元中 的操作数x送至MDR，再由MDR送至运算器的ACC（记作MDR-+ACC)，完成此指令的执行过 程。此刻，也即完成了第一条取数指令的全过程，即将操作数x送至运算器ACC中。与此同时， PC完成自动加1的操作，形成下一条指令的地址”1”号。同上所述，由PC将第二条指令的地址 送至MAR，命令存储器做读操作，将“0001000000001001“送入MDR，又由MDR送至IR。接着 CU分析操作码“000100\"为乘法指令，故CU向存储器发出读命令，取出对应地址为 \"0000001001“单元中的操作数a，经MDR送至运算器MQ,CU再向运算器发送乘法操作命令，完 成ax的运算，并把运算结果ax存放在ACC中。同时PC又完成一次(PC)+l-+PC，形成下一条 指令的地址“2”号。依次类推，逐条取指、分析、执行，直至打印出结果。最后执行完停机指令 后，机器便自动停机。 1.3 计算机硬件的主要技术指标 衡量一台计算机性能的优劣是根据多项技术指标综合确定的。其中，既包含硬件的各种性 能指标，又包括软件的各种功能。这里主要讨论硬件的技术指标。"}
{"doc_id": "co", "page": 23, "text": "第1章计算机系统概论17  1 机器 机器字长是指CPU一次能处理数据的位数，通常与CPU的寄存器位数有关。字长越长，数的表 示范围越大，精度也越高。机器的字长也会影响机器的运算速度。倘若CPU字长较短，又要运算位数 较多的数据，那么需要经过两次或多次的运算才能完成，这样势必影响机器的运算速度。 机器字长对硬件的造价也有较大的影响。它将直接影响加法器（或ALU)、数据总线以及存 储字长的位数。所以机器字长的确定不能单从精度和数的表示范围来考虑。 存储容 存储器的容量应该包括主存容量和辅存容量。 主存容量是指主存中存放二进制代码的总位数。即 存储容量＝存储单元个数X存储字长 图1.11中MAR的位数反映了存储单元的个数，MDR的位数反映了存储字长。例如，MAR为 16位，根据216= 65 536，表示此存储体内有65536个存储单元（即64K个存储字，1K = 1 024 = 2 10) ;  而MDR为32位，表示存储容量为216x32=221=2M位(1M=2气。 现代计算机中常以字节数来描述容量的大小，因一个字节已被定义为8位二进制代码，故用 字节数便能反映主存容量。例如，上述存储容量为2M位，也可用218字节表示，记作218B或 256 KB (B用来表示一个字节）。 辅存容量通常用字节数来表示，例如，某机辅存（如硬盘）容量为80GB (1 G = 1 024 M =  沪x220= 230)。 计算机的运算速度与许多因素有关，如机器的主频、执行什么样的操作、主存本身的速度 （主存速度快，取指、取数就快）等都有关。早期用完成一次加法或乘法所需的时间来衡量运算 速度，即普通法，显然是很不合理的。后来采用吉普森(Gibson)法，它综合考虑每条指令的执行 时间以及它们在全部操作中所占的百分比，即 几＝三fltl 其中，TM为机器运行速度；f,为第i种指令占全部操作的百分比数；tl为第i种指令的执行时间。 现在机器的运算速度普遍采用单位时间内执行指令的平均条数来衡量，并用MIPS(Million In­ struction Per Second，百万条指令每秒）作为计量单位。例如，某机每秒能执行200万条指令，则记作 2 MIPS。也可以用CPI(CyclePer Instruction)即执行一条指令所需的时钟周期（机器主频的倒数）"}
{"doc_id": "co", "page": 24, "text": "18 第1篇概论 数，或用FLOPS(FloatingPoint Operation Per Second，浮点运算次数每秒）来衡量运算速度。 1.4 本书结构 本书介绍计算机组成原理，其内容安排如下： 第1篇：概论，介绍计算机系统的基本组成、应用与发展。 第2篇：计算机系统的硬件结构，引导读者自顶向下了解计算机系统的硬件结构，包括中央 处理器、存储器、I/0等主要部件以及连接它们的系统总线。其中，除中央处理器比较复杂放在 第3篇单独讲述外，其他各部件均在此篇介绍。 第3篇：中央处理器(CPU)，本篇讲述CPU的功能和结构，并对影响CPU特性、结构和功能 的算逻单元及其运算方法、指令系统、指令流水、中断系统等进行详细分析。有关控制单元(CU) 在第4篇单独介绍。 第4篇：控制单元(CU)，本篇在详细分析时序系统以及微操作命令节拍安排的基础上，分别 介绍如何用组合逻辑控制及微程序控制两种方法设计和实现控制单元。 总之，全书按自顶向下、由表及里的层次结构，向读者展示计算机的组成及其工作原理，目的 是使读者能先从整体上对计算机有一个粗略的认识，然后，逐步深入到机器内核，从而更容易形 成计算机的整体概念。图1.12形象地描述了上述各章节之间的联系。 图1.12全书各章节之间的关系"}
{"doc_id": "co", "page": 25, "text": "第1章计算机系统概论 1.1 什么是计算机系统、计算机硬件和计算机软件？硬件和软件哪个更重要？ 1.2 如何理解计算机系统的层次结构？ 1.3 说明高级语言、汇编语言和机器语言的差别及其联系。 1.4 如何理解计算机组成和计算机体系结构？ 1.5 冯·诺依曼计算机的特点是什么？ 1.6 画出计算机硬件组成框图，说明各部件的作用及计算机硬件的主要技术指标。 19  1.7 解释概念：主机、CPU、主存、存储单元、存储元件、存储基元、存储元、存储字、存储字长、存储容量、机器 字长指令字长。 1.8 解释英文代号：CPU、PC、IR、CU、ALU、ACC、MQ、X、MAR、MDR、I/0、MIPS、CPI、FLOPS。 1.9 画出主机框图，分别以存数指令“STAM”和加法指令“ADDM\" (M均为主存地址）为例，在图中按序标 心 出完成该指令（包括取指阶段）的信息流程（如一—>）。假设主存容量为256Mx32位，在指令字长、存储字长、机 器字长相等的条件下，指出图中各寄存器的位数。 1.10 根据迭代公式压＝了（卢f:-)，设初态y。=1，要求精度为8，试编制求石的解题程序（指令系统自 定），并结合所编程序简述计算机的解题过程。 1.11 指令和数据都存千存储器中，计算机如何区分它们？ 1.12 什么是指令？什么是程序？"}
{"doc_id": "co", "page": 26, "text": "本章简要介绍计算机的发展史以及它的应用领域，旨在使读者对计算机有一个感性的认识。 最后，本章展望计算机的未来。 1 计算机的发展史 谁也不曾想到，当初只是当作军事计算工具应用的电子计算机，在半个世纪中竟然会成为改 变社会结构，乃至促使人们的工作和生活方式发生惊人变化的宠儿，真可谓20世纪下半世纪科 技发展最有影响的发明，并且它还将继续影响着未来世界的变化，使数千年人类文明史中曾有过 的各种神话般的幻想逐渐变为现实。 计算机的和发展 1.第一代电子管计算机 1943年，第二次世界大战进入后期，因战争的需要，美国国防部批准了由Pennsyivania大学 John Mauchly教授和JohnPresper Eckert工程师提出的建造一台用电子管组成的电子数字积分 机和计算机(ElectronicNumerical Integrator And Computer, ENIAC)的计划，用它来解决当时国防 部弹道研究实验室(BRL)开发新武器的射程和检测模拟运算表的难题。当时，由千运算能力不 足，该实验室无法在规定的时间内拿出准确的运算表，严重影响了新武器的制作。 ENIAC于1946年交付使用，其首要任务就是完成了一系列测定氢弹可靠性的复杂运算。 ENIAC采用十进制运算，电路结构十分复杂，使用18000多个电子管，运行时耗电量达150千 瓦，体积庞大，重量达30吨，占地面积为1500平方英尺，而且需用手工搬动开关和拔、插电缆来 编制程序，使用极不方便，但它比任何机械计算机快得多，每秒可进行5000多次加法运算。 ENIAC的出现不但实现了制造一台通用计算机的目标，而且标志计算工具进入了一个崭新 的时代，是人类文明发展史中的一个里程碑。仅仅半个世纪，计算机巳经使人类社会从工业化社 会发展到了信息化社会。虽然ENIAC千1955年正式退役，并陈列千美国国立博物馆供人们参 观，但它的丰功伟绩将永远记载在人类的文明史册中。 1945年，ENIAC的顾问、数学家冯·诺依曼在为一台新的计算机EDVAC（电子离散变量计 算机）所制定的计划中首次提出了存储程序的概念，即将程序和数据一起存放在存储器中，使编"}
{"doc_id": "co", "page": 27, "text": "第2章计算机的发展及应用21  程更加方便。这个思想几乎同时被科学家图灵(Turing)想到了。 1946年，冯·诺依曼与他的同行们在PrincetonInstitute进行高级研究时，设计了一台存储程 序的计算机IAS，可惜因种种原因直到1952年IAS也未能 问世。但IAS的总体结构从此得到了认可，并成为后来通 用计算机的原型，图2.1就是IAS计算机的总体结构示意 图。它由几部分组成：一个同时存放指令和数据的主存储 器、一个二进制的算逻运算部件、一个解释存储器中的指令 并能控制指令执行的程序控制部件以及由控制部件操作的 主存储器I/0  设 备 I/0设备。 图2.1IAS计算机结构 20世纪50年代，美国出现了Sperry和IBM两大制造计算机的公司，后来又从SpenT公司分 离出了UNIVAC子公司，他们控制着计算机市场。 1947年，Eckert和Mauchly共同建立了生产商用计算机的计算机公司，他们第一个成功的产 品是UNIVAC I (Universal Automatic Computer)，后来Eckert..:Mauchly公司成为从Sperry-Rand公 司分离出来的UNIVAC子公司，并继续制造了一系列产品，如UNIVACII及UNIVAC1100系列产 品，它们成为科学和商用计算机的主流产品。同时IBM公司在1953年推出了首台存储程序的 计算机701机，1955年又推出了702机，使之更适用于科学计算和商业应用，后来形成了700/ 7000系列，使IBM成为计算机制造商的绝对权威。 自从ENIAC问世后，人类为提高电子计算机性能的欲望从未减退过，并在20世纪50年代 初，除美国外，英、法、苏联、日本、意大利等国都相继研制出本国的第一台电子计算机，我国也于 1958年研制成自己的第一台电子计算机。可是在这十多年的时间里，计算机的性能并未出现奇 迹般的提高，它的运算速度每秒仅在数千次至上万次左右，其体积虽然不像ENIAC那样庞大，但 也占了相当大的空间，耗电量也很大。直到20世纪50年代末，计算机技术迎来了第一次大飞跃 的发展机遇，其性能出现了数十倍以至几百倍的提高，这就是用晶体管替代电子管的重大变革。 2.第二代晶体管计算机 1947年在贝尔实验室成功地用半导体硅作为基片，制成了第一个晶体管，它的小体积、低耗 电以及载流子高速运行的特点，使真空管望尘莫及。进入20世纪50年代后，全球出现了一场以 晶体管替代电子管的革命，计算机的性能有了很大的提高。以IBM700/7000系列为例，晶体管 机7094(1964年）与电子管机701(1952年）相比，其主存容量从2K字增加到32K字；存储周期 从30µ,s下降到1.4µ,s；指令操作码数从24增加到185；运算速度从每秒上万次提高到每秒50 万次。7094机还采用了数据通道和多路转换器等在当时看来是最新的技术。 尽管用晶体管代替电子管巳经使电子计算机的面貌焕然一新，但是随着对计算机性能越来 越高的追求，新的计算机所包含的晶体管个数已从一万个左右骤增到数十万个，人们需要把晶体 管、电阻、电容等一个个元件都焊接到一块电路板上，再由一块块电路板通过导线连接成一台计 算机。其复杂的工艺不仅严重影响制造计算机的生产效率，更严重的是，由几十万个元件产生几 百万个焊点导致计算机工作的可靠性不高。"}
{"doc_id": "co", "page": 28, "text": "22 第1篇概论 随着1958年微电子学的深入研究，特别是新的光刻技术和设备的成熟，为计算机的发展又 开辟了一个崭新时代集成电路时代。 3.第三代集成电路计算机 仔细分析就会发现，计算机的数据存储、数据处理、数据传送以及各类控制功能基本上都是 由具有布尔逻辑功能的各类门电路完成的，而大量的门电路又都是由晶体管、电阻、电容等搭接 而成，因此，当集成电路制造技术出现后，可以利用光刻技术把晶体管、电阻、电容等构成的单个 电路制作在一块极小（如几个平方微米）的硅片上。进一步发展，实现了将成百上千个这样的门 电路全部制作在一块极小（如几个平方毫米）的硅片上，并引出与外部连接的引线，这样，一次便 能制作成成百上千个相同的门电路，又一次大大地缩小了计算机的体积，大幅度下降了耗电量， 极大地提高了计算机的可靠性。这就是人们称为小规模集成电路(SSI)和中等规模集成电路 (MSI)的第三代计算机，其典型代表为IBM的System/360和DEC的PDP-8。 1964年，IBM推出了一个新的计算机系列System/360，打破了7000系列在体系结构方面的 一些约束。为了推动集成电路技术，改进原来的结构，IBM投入了大量的人力和物力进行技术开 发，作为回报，它最终占领了大约70％的市场份额，成为计算机制造的最大制造商。 System/360系列中有不同的机型，但它们又都是互相兼容的，即在某种机型上运行的程序可 以在这一系列中的另一种机型上运行。它们具有类似或相同的指令系统（该系列中低档机的指 令系统可以是高档机指令系统的一个子集），各机型有类似或相同的操作系统，而且随着机器档 次的提高，机器的速度、存储器的容量、I/0端口的数量以及价格都有所增长。 另一种有代表性的机器是DEC的PDP-8，它采用总线结构，有迷你机之称。它以低价格、 小体积吸引了不少用户，售价仅16000美元，而当时System/360大型机的售价为数十万美元。 PDP-8使DEC迅速发展起来，使其成为继IBM之后的第二大计算机制造商。 从1946年的ENIAC到1964年的IBMSystem/360，历时不到20年，计算机的发展经历了电 子管—晶体管—集成电路3个阶段，通常称为计算机的3代。显然，早期计算机的更新换代主要 集中体现在组成计算机基本电路的元器件（电子管、晶体管、集成电路）上。 第三代计算机之后，人们没有达成定义新一代计算机的一致意见。 表2.1列出了硬件技术对计算机更新换代的影响。 表2.1硬件技术对计算机更新换代的影响 发展阶段时间硬件技术 ' 1946—1957 电子管 1958—1964 晶体管 1965—1971 中、小规模集成电路 四1972—1977 大规模集成电路 五1978年到现在超大规模集成电路 速度／（次／秒） 40 000  200 000  1 000 000  10 000 000  100 000 000  '  进入到20世纪70年代后，把计算机当作高级计算工具的狭隘观念已被人们逐渐摒弃，计算"}
{"doc_id": "co", "page": 29, "text": "第2章计算机的发展及应用23  机成为一门独立的学科而迅猛发展，并且影响、改变着人类的生活方式，这是由千微处理器的出 现（采用大规模和超大规模集成电路）、软件技术的完善及应用范围的不断拓宽所带来的必 然结果。 1  集成电路技术把计算机的控制单元和算逻单元集成到一个芯片上，制成了微处理器芯片。 1971年，美国Intel公司31岁的工程师霍夫研制成世界上第一个4位的微处理器芯片4004，集成 了2300个晶体管。随后，微处理器经历了4位、8位、16位、32位和64位几个阶段的发展，芯片 的集成度和速度都有很大的提高。与此同时，半导体存储器的研制也正在进行，1970年， Fairchild制作了第一个存储芯片，该芯片大约只有一个磁心这么大，却能保存256位二进制信 息，但是每位的价格高千磁心。1974年后，随着半导体存储器价格的迅速下降，位密度的不断提 ，存储芯片的容量经历了1K位，4K位，16K位，64K位，256K位，1M位，4M位，16M位， 64 M位，…，1G位这几个阶段，每个新的阶段都比过去提高到4倍的容量，而价格和访间时间都 有所下降。 总之，芯片集成度不断提高，从在一个芯片上集成成百上于个晶体管的中、小规模集成电路， 逐渐发展到能集成成千上万个晶体管的大规模集成电路(LSI)和能容纳百万个以上晶体管的超 大规模集成电路(VLSI)。微芯片集成晶体管的数目验证了Intel公司的缔造者之－Gordon Moore提出的“微芯片上集成的晶体管数目每3年翻两番＂的规律，这就是人们常说的Moore（摩 尔）定律。 微处理器芯片和存储器芯片出现后，微型计算机也随之问世。例如，1971年用4004微处理 器制成了MCS-4微型计算机。20世纪70年代中期，8位微处理器8008、8080、R6502、M6800、 Z80等相继出现，并用R6502制成了AppleII微型计算机，用Z80制成了CROMEMCO80微型计 算机等。 最值得一提的是世界上第一大微处理器的制造商Intel，其典型产品如下。 • 8080：世界上第一个8位通用的微处理器，1974年问世。 • 8086: 16位，2.9万个晶体管，地址20位，采用6个字节指令队列，指令系统与8088完全 兼容，1978年问世。 • 8088：集成度达2.9万个晶体管，主频4.77MHz，字长16位（外部8位），又称准16位，地 址20位，采用4个字节指令队列，被IBM首台微型计算机(IBMPC)选用，1979年问世。 • 80286: 16位，13.4万个晶体管，6MHz，地址24位，可用实际内存16MB和虚拟内存 1 GB, 1982年问世。 • 80386:32位，27.5万个晶体管，12.5MHz、33MHz，地址32位，4GB实际内存，64TB  (1 TB= 240 B)虚拟内存，其性能可与几年前推出的小型机和大型机相比，1985年问世。 • 80486:32位，120万个晶体管，25MHz、33MHz、50MHz,4 GB实际内存，64TB虚拟内"}
{"doc_id": "co", "page": 30, "text": "24 第1篇概论 存，引用更加复杂的Cache技术和指令流水技术，速度比80386快一倍，性能指标比80386高出 3~4倍，1989年问世。 • Pentium: 32位，310万个晶体管，66MHz、100MHz,4 GB实际内存，64TB虚拟内存，采用 超标量技术，使多条指令可并行执行，速度比80486高出6~8倍，1993年问世。 • Pen ti um Pro : 64位，550万个晶体管，133MHz、150MHz、200MHz,64 GB实际内存，64TB  虚拟内存，采用动态执行RISC/CISC技术、分支预测、指令流分析、推理性执行和二级Cache等 技术，1995年问世。 • Pentium II : 64位，750万个晶体管，200~ 300 MHz, 64 GB实际内存，64TB虚拟内存，融 入了专门用于有效处理视频、音频和图形数据的IntelMMX技术，1997年问世。 • Pentium皿：64位，950万个晶体管，450~ 600 MHz, 64 GB实际内存，64TB虚拟内存，融 入了新的浮点指令，以支持三维图形软件，1999年问世。 • Pentium 4: 64位，4200万个晶体管，1.3~ 1.8 GHz, 64 GB实际内存，64TB虚拟内存，包括 另外的浮点和其他多媒体应用的增强，2000年问世。 显然，从20世纪70年代初至今，微型计算机的发展在很大程度上取决千微处理器的发展， 而微处理器的发展又依赖于芯片集成度和处理器主频的提高。从2000年IntelPentium 4问世至 今的发展历程看，处理器的架构变化不大，主要从提高处理器的主频、增加扩展指令集、增加流水 线、提高生产工艺水平（晶体管的线宽从180nm-+130 nm一90nm-+65 nm)等几方面来不断改进 处理器的性能。但制造工艺的缺陷，导致了处理器功耗持续上升。大量研究表明，每推出一代新 型处理器，它的功耗是上一代处理器功耗的2倍，倘若芯片集成度达10亿个，处理器的自身功耗 将会使人们一筹莫展。可见，有效解决微处理器的功耗和散热问题已成为当务之急。事实上一 味追求微芯片集成度的提高，除了引发功耗、散热问题外，还会出现更多的问题，如线延迟问题、 软误码率现象等。 为了提高计算机的性能，除了提高微处理器的性能外，人们还努力通过开发指令级并行性来 实现。可是在指令级并行性应用中，又受到数据预测精度有限、指令窗口不能过大以及顺序程序 固有特性的限制等，使得依靠开发指令级并行性来提高计算机的性能又有很大的局限性。 虽然很多因素阻碍了微型计算机性能的不断提高，可是随着计算机的广泛应用，尤其是网络 技术的迅猛发展，人们依然在追求着机器性能的完美。例如，当前网络的环境基本上是让计算机 处于桌面固定的状态，而人们更希望机器能围绕人们的需求转，越来越方便地使用计算机，不希 望机器局限千固定的桌面式应用，让机器以手持式或穿戴式以及其他形式，使之更具人性化，能 和谐地融合于人们的生活和工作之中。与此相适应的移动计算技术便应运而生。 移动计算模式迫切要求微处理器具有响应实时性、处理流式数据类型的能力、支持数据级和 线程级并行性、更高的存储和I/0带宽、低功耗、低设计复杂性和设计的可伸缩性。 当前主流商用处理器大部分都是超标量结构，是一种在一个时钟周期内同时发射多条标量 指令到多个功能部件以提高处理器性能的体系结构，若每周期发送4条指令，巳不能满足日渐庞 大的应用程序对高性能的需求。而继续开发更大发射带宽的超标量结构将会导致处理器的逻辑"}
{"doc_id": "co", "page": 31, "text": "第2章计算机的发展及应用25  设计复杂度大幅增加，正确性验证变得越来越困难。人们开始寻找新的体系结构来适应新的市 场和不断变化的应用需要。 从20世纪微处理器的发展来看，几乎每3年处理器的性能就能提高4~5倍，但是计算机中 一些其他部件性能的提高速度达不到这个水平。因此，必须不断调整计算机的组成和结构，以弥 补不同部件性能的不匹配问题。影响它们之间不匹配的主要因素是处理器与主存之间的接口和 处理器与外设之间的接口。 处理器与主存之间的接口是整个计算机最重要的通路，因为它要负责在主存与处理器之间 传送指令和数据，如果主存或主存与处理器之间的传送跟不上处理器的要求，就会使处理器处于 等待的状态。为此，可加宽数据总线的宽度，在主存和处理器之间设置高速缓冲存储器(Cache) 并发展成片内Cache和分级Cache，采用高速总线和分层总线来缓冲和分流数据，从而提高处理 器和存储器之间的连接带宽。 处理器和外设之间也存在大量的数据传输要求，可通过各种缓冲机制、加上高速互连总线以 及更精致的总线结构来解决它们之间传输速率的不匹配问题。 因此，计算机的设计者们必须不断平衡处理器、主存、I/0设备和互连结构之间的数据吞吐 率和数据处理的需要，使计算机的性能越来越好。 从21世纪初来看，当前通用微处理器的发展重点将在以下几方面。 心进一步提高复杂度来提高处理器性能。这种方法沿袭传统的指令级并行方法加速单线 程应用，组织更宽的超标量，采用更多的功能部件、多级Cache和激进的数据、控制以及指令轨迹 预测，达到使用尽可能多的指令级并行(Instruction-LevelParallelism, ILP)。例如，先进超标量处 理器(AdvancedSuperscalar Processor)、超前瞻处理器(SuperspeculativeProcessor)、多标量处理器 (Multiscalar Processor)、数据标量处理器(DatascalarProcessor)和踪迹处理器(Trace Processor)等。 ＠通过线程／进程级并行性的开发提高处理器的性能，即通过开发线程级并行性(Thread­ Level Parallelism, TLP)或进程级并行性(Process-LevelParallelism, PLP)来提高性能，简化硬件设 计。例如，多处理器(Multiprocessor)、单芯片处理器CMP(On-chip Multiprocessor)、多线程处理器 (Multi-Threaded Processor)以及同时多线程处理器(SimultaneousMulti-Threading Processor)、动态 多线程处理器(Dynamic-MultithreadedProcessor)和多路径多线程处理器(ThreadedMultipath Pro­ cessor)等。 ＠将存储器集成到处理器芯片内来提高处理器性能。采用ILP、TLP、PLP能大大提高处理 器内部指令执行的并行度，而指令和数据的供应是充分发挥这些技术的关键问题。传统上以处 理器为中心的设计思想导致处理器把大量的复杂性花在解决访存延迟的问题上。然而处理器和 存储器性能的差距仍在以每年50％的速度增大，使得访存速度将成为未来提高处理器性能的主 要瓶颈。基千此，PIM(Processor In MemOI'\"J)技术提出将处理器和存储器集成在同一个芯片上， 这样可使访存延时减少5~ 10倍，存储器带宽可增加50~ 100倍。大多数情况下，整个应用在运 行期间都可放到片上存储器里。将存储器集成到处理器芯片上后，原来用千增加处理器—存储"}
{"doc_id": "co", "page": 32, "text": "26 第1篇概论 器带宽的大量存储总线引脚可以被节省下来用千增加I/0带宽，这将有利千提高未来大量的网 络应用归片，并且能减少对片外存储器的访问，使处理器的功耗大大降低。 ＠发展嵌入式处理器。由于嵌入式应用需求的广泛性，以及大部分应用功能单一、性质确 定的特点，决定了嵌入式处理器实现高性能的途径与通用处理器有所不同。目前嵌入式处理器 大多是针对专门的应用领域进行专门设计来满足高性能、低成本和低功耗的要求。例如，视频游 戏控制需要很高的图形处理能力；手持、掌上、移动和网络PC要求具备虚存管理和标准的外围 设备；手机和个人移动通信设备要求在具有高性能和数字信号处理能力的同时具有超低功耗；调 制解调器、传真机和打印机要求低成本的处理器；机顶盒和DVD则要求高度的集成性；数字相机 要求既有通用性又有图像处理能力。 目前嵌入式处理器的高性能和低成本技术发展趋势是：体系结构需要在新技术与产品、市场 和应用需求之间取得平衡；设计方法趋向于走专用、定制和自动化的道路。 计算机刚刚问世时，还未建立“软件”这一概念，随着计算机的发展及应用范围的扩大，逐渐 形成了软件系统。 在早期的计算机中，使用者必须根据机器自身能识别的语言机器语言（机器指令）按解 题要求编写出机器可直接运行的程序。由于机器不同，机器语言也不同，因此人们在不同的机器 上编程，就需要熟悉不同机器的机器指令，使用极不方便，写出的程序很难读懂。20世纪50年 代后，逐渐形成了符号语言和汇编语言，这种语言虽然可以不用0/1代码编程，改善了程序的可 读性，但它们仍是面向机器的，即不同的机器各自有不同的汇编语言。为了使这种符号语言转变 成机器能识别的语言，人们又创造了汇编程序，用于把汇编语言翻译成机器语言。 为了摆脱对具体机器的依赖，在汇编语言之后又出现了面向问题的高级语言。使用高级语 言编程可以不了解机器的结构，高级语言的语旬通常是一个或一组英语词汇，词义本身反映出命 令的功能，它比较接近人们习惯用的自然语言和数学语言，使程序具有很强的可读性。高级语言 的发展经历了几个阶段。第一阶段的代表语言是1954年间世的FORTRAN，它主要面向科学计 算和工程计算。第二阶段可视为结构化程序设计阶段，其代表是1968年问世的Pascal语言，它 定义了一个真正的标准语言，按严谨的结构化程序编程，具有丰富的数据类型，写出的程序易读 懂、易查错。第三阶段是面向对象程序设计阶段，其代表语言是C++。近年来随着网络技术的 不断发展，又出现了更适应网络环境的面向对象的Java语言，而且随着Internet技术的发展和应 用，Java语言越来越受到人们普遍欢迎。 为了使高级语言描述的算法在机器上执行，同样需要有一个翻译系统，千是产生了编译程序 和解释程序，它们能把高级语言翻译成机器语言。 可见，随着各种语言的出现，汇编程序、编译程序、解释程序的产生，逐渐形成了软件系统。 随着计算机应用领域的不断扩大，外部设备的增多，为了使计算机资源让更多用户共享，又"}
{"doc_id": "co", "page": 33, "text": "第2章计算机的发展及应用27  出现了操作系统。操作系统能协调管理计算机中各种软件、硬件及其他信息资源，并能调度用户 的作业程序，使多个用户能有效地共用一套计算机系统。操作系统的出现使计算机的使用效率 成倍地提高，并且为用户提供了方便的使用手段和令人满意的服务质量。例如，DOS、UNIX和 Windows等。 此外，一些服务性程序，如装配程序、调试程序、诊断程序和排错程序等，也逐渐形成。特别 是随着计算机在信息处理、情报检索及各种管理系统中应用的发展，要求大量处理某些数据，建 立和检索大量的表格。这些数据和表格按一定的规律组织起来，使用户使用更方便，千是出现了 数据库。数据库和数据管理软件一起便组成了数据库管理系统。而且随着网络的发展，又产生 了网络软件等。 以上所述的各种软件均属千系统软件，而软件发展的另一个主要内容就是应用软件。应用 软件种类繁多，它是用户在各自的行业中开发和使用的各种程序。如各种财务软件、办公用的文 字处理和排版软件、帮助管理日常业务工作和图文报表的“电子表格”和“数据库“软件、帮助工 程设计的CAD软件以及各种实用的网络通信软件等。 软件发展有以下几个特点。 (1)开发周期长 研制一个软件往往因其规模庞大而需较长的开发周期。例如，美国穿梭号宇宙飞船的软件 包含4000万行目标代码，倘若一个人一年开发一万行程序，则需集中4000人花一年时间才能 完成，而且要做到4000人的默契配合，涉及种种技术问题的协调，如分析方法、设计方法、形式 说明方法、版本标准等都得有严格的规范，其难度远远超过自动化程度极高的硬件制造。 (2)制作成本昂贵 超大规模集成电路技术给硬件制造业带来巨大利益，使硬件的价格不断下降，使一台普通的 微型计算机的价格与一台彩色电视机的价格相当，而且还在下降。可是软件的开发完全依赖于 人工，致使软件开发成本不断上涨，在美国，软件成本约占计算机系统总成本的90%，已成为司 空见惯的现象。 (3)检测软件产品质量的特殊性 一种软件在刚开始推出时，主要实现其面向领域所需的核心功能，之后逐步集成大量的附加 功能。也就是说，要完善一个软件产品，必须在应用过程中不断加以修改、补充。只有使用了 定时间后，才能对软件产品质量进行确定。 尽管软件技术兴起和发展比硬件晚，而且其发展速度没有硬件快（如微处理器的性能以 Moore定律所述的几何级数增长），但是仍可以说，如果没有当今的软件技术，计算机系统和应用 的发展也不会有今天这样的成就。客观地说，软件的发展不断激励着微处理器和存储器性能的 增长。 世界各国当前都十分重视软件人才的培养和软件产业的形成，但实际上它们都很难与当前 计算机应用普及的广度和深度相适应。也正因为如此，有些软件开发商瞄准了特定的市场，一旦 在性能质量占到上风时，就会很快积聚财富，成为新的世界级富商。例如，美国微软公司十来年"}
{"doc_id": "co", "page": 34, "text": "28 第1篇概论 的发展就超过传统工业（如汽车制造业），同样微软公司的组建者也很快成为现代世界最大富 商之一。 在二三十年软件开发的实践中，人们对软件开发也逐渐有了较深刻的认识，逐渐体会到软件 不是简单地编写程序，欲开发成一个优良的软件，和开发其他产品一样，必须明确开发要求，然后 做可行性分析，确定基本方法，进行需求分析，再深入用户核准需求，取得一致意见后才能进入软 件设计阶段。因此，程序只是完成整个软件产品的一个组成部分，软件生存周期的各个阶段都是 以文档资料形式存在。正如著名软件工程专家Boehm曾经指出：＂软件是程序以及开发、使用和 维护程序需要的所有文档。”可见软件开发不是某种个体劳动的神秘技巧，它是一个组织良好、 管理严密、各类人员协同配合共同完成软件工程的全过程。只有这样才能保证软件工程的顺利 完成，并能节省大量开发费用；否则将会陷入事倍功半、长期无法正常运行的困境。 2.2 计算机的应用 自 ENIAC问世后将近30余年的时间里，计算机一直被作为大学和研究机构的娇贵设备。 在20世纪70年代中后期，大规模集成工艺日趋成熟，微芯片上集成的晶体管数一直按每3年翻 两番的Moore定律增长，微处理器的性能也按此几何级数提高，而价格也以同样的几何级数下 降，以至于以前需花数百万美元的机器（如80MFLOPS的CRAY)变得价值仅为数千美元（而此 类机器的性能可达200MFLOPS)，至于对性能不高的微处理器芯片而言，仅花数美元就可购到。 因此，人们终千使计算机走出了实验室而渗透到各个领域，乃至走进普通百姓的家中。当然，除 了计算机的价格迅速降低以外，计算机软件技术日趋完臻也是计算机获得广泛应用的重要原因。 尤其是近年来计算机技术和通信技术相互融合，出现了沟通全球的Internet，使计算机的应用范 围从科学计算、数据处理等传统领域扩展到办公自动化、多媒体、电子商务、虚拟工厂、远程教育 等，遍及社会、政治、经济、军事、科技以及个人文化生活和家庭生活的各个角落。 科和数据 1.科学计算 科学计算一直是计算机的重要应用领域之一。其特点是计算量大和数值变化范围大。在天 文学、量子化学、空气动力学和核物理学等领域都要依靠计算机进行复杂的运算。例如，人们日 常生活难以摆脱的天气预报，要知道第二天的气候变化，采用1MIPS的计算机顷刻间便可获得。 倘若想预报一个月乃至一年的气候变化，使各地提前做好防汛、防旱等工作，则100MIPS或更高 的计算机才能满足。现代的航空、航天技术，如超音速飞行器的设计、人造卫星和运载火箭轨道 的计算，也都离不开高速运算的计算机。 此外，计算机在其他学科和工程设计方面，诸如数学、力学、晶体结构分析、石油勘探、桥梁设"}
{"doc_id": "co", "page": 35, "text": "第2章计算机的发展及应用29  计建筑、土木工程设计等领域内，都得到了广泛的应用。 2.数据处理 数据处理也是计算机的重要应用领域之一。早在20世纪五六十年代，人们就把大批复杂的 事务数据交给了计算机处理，如政府机关公文、报表和档案。大银行、大公司、大企业的财务、人 事、物料，包括市场预测、情报检索、经营决策、生产管理等大量的数据信息，都由计算机收集、存 储、整理、检索、统计、修改、增删等，并由此获得某种决策数据或趋势，供各级决策指挥者参考。 通过各种传感器获得的各种物理信号经转换为可测可控的数字信号后，再经计算机运算，根 据偏差，驱动执行机构来调整，便可达到控制的目的。这种应用已被广泛用于冶金、机械、纺织、 化工、电力、造纸等行业中。 目前的工业控制远比20世纪六七十年代先进得多。新型的工业自动控制系统以标准的工 业计算机软、硬件平台构成集成系统，取代了传统的封闭式系统，具有更强的适应性，更好的开放 性，更易千扩展，更经济、更短的开发周期等显著优点。通常将工控系统分为3层：控制层、监控 层和管理层。控制层是最下层，它是通过各种传感器来获得各种有效信号的。监控层下连控制 层，上连管理层，它不但实现对现场的实时监测与控制，而且常在自动控制系统中完成上传下达， 组态开发的重要作用。特别是组态软件的出现，使数据采集、过程控制变得十分简单，它为用户 提供良好的开发界面和简捷的使用方法，使用各种软件模块可以非常容易地实现和完成监控层 的各种功能。就目前发展趋势而言，工业控制的应用已经向控管一体化方向发展，利用网络技 术，通过传感技术和多媒体技术，操作者可以在控制室内通过大屏幕显示，了解各车间、各工位、 各部门的生产运行情况，并可直接由控制室发出各种控制命令，指挥全厂正常工作。 在军事上，导弹的发射及飞行轨道的计算控制、先进的防空系统等现代化军事设施，通常也 都是由计算机构成的控制系统，其中包括雷达、地面设施、海上装备等。例如，将计算机嵌入导弹 的弹头内，利用卫星定位系统，将飞行目标和飞行轨迹事先存储在弹载计算机内，导弹在飞行中 对实际飞行轨迹进行不断修正，直接袭击目标，其命中率几乎接近100%。美国在海湾战争以及 后来的军事冲突中，计算机实时控制技术发挥了极为突出的作用。 此外，2003年和2005年我国发射的载人宇宙飞船都属于实时控制的应用范畴。 促使计算机网络诞生的最早动机在千实现硬件资源的共享。当时计算机十分昂贵，人们希 望能远距离利用计算机，因此在1954年第一次实现了将穿孔卡上的数据从电话线发送到远方的 计算机来完成运算，这可以说是计算机网络的雏形，可见网络技术的基础是计算机技术与通信技 术的结合。"}
{"doc_id": "co", "page": 36, "text": "30 第1篇概论 1992年美国政府提出了“国家信息基础设施计划”,1993年西方七国提出“全球信息基础设 施计划”，整个世界随着通信技术和计算机技术的结合，在21世纪到来前，一个崭新的全球性的 Internet正在形成，并正以更新的姿态扢立在世界的顶端。由千全球网络化消除了人们之间因时 间、距离和地理界限所形成的障碍，从而使各国人们在技术交流、商品交换、文化传递、感情沟通 等方面变得十分迅捷，十分方便。如果再有性能良好的语言翻译机（实际上目前已经有翻译机 了儿那么原有的隔闵和障碍可能会全部消失。正因如此，Internet的发展规模和速度达到了惊人 的程度，人们称之为新Moore定律，全球入网量每6个月翻一番。据2007年1月国外网站统计， 全世界上网的计算机已超过4.3亿台，上网人数已达11亿。据中国互联网发展状况2007年1月 的统计报告，至2006年年底，我国网民人数达1.37亿，比2005年增加2600万，增长率为23.4%, 上网计算机达5940万台，比2005年增加990万台，增长率为20%。如果从有Internet开始计 ，仅4年的时间网上计算机达5000万台，相比之下，全世界5000万用户拥有电视机却花了13 年，拥有收音机经历了38年，拥有电话的时间就更长了。可见网络的发展速度大大超过了电视 机、收音机和电话。可以断言，全球网络化不仅改变着商务经济、工业生产、科技发展，还必将影 响人们的工作、娱乐和生活，它正在改变着整个世界。 网络应用涉及方方面面，在此仅举几个例子。 1.电子商务 电子商务的含义是任何一个组织机构可利用Internet来改变他们与客户、供应商、业务伙伴 和内部员工的交流，也可以认为是消费者、销售者和结算部门之间利用Internet完成商品采购和 支付的过程。例如：某企业可以通过在Internet上的网页向全球发布推出的商品，并向他的各地 代理商发出各种指令；当某客户欲购此商品时，他可以通过网上直接与生产企业联络，也可与各 地代理商联系，进一步了解该商品的性能，并将其姓名、地址、个人电子账号及送货要求等告诉卖 主。企业或经销商通过Internet与银行联络，查询核实该客户的资金状况，并通过协定的支付方 式由银行实行电子支付，而商品则由企业经销商直接送到客户手中。这种简捷、可靠的商品销售 方式可从根本上改变传统的销售方式。它可以不要传统意义上的店铺，而直接用电子店铺来取 代；可以一夜之间将自己的品牌通告全世界；可以实现公平竞争，小企业不必害怕大企业的广告 效应，大企业也不必顾虑小企业的快速应变能力，各自都可以通过网上信息进行竞争；可以取消 纸币交易的各种弊端，完全实现电子货币交换；可以减少很多中间环节，以最高效率、最省人力、 最广泛的市场实现商品的全球交换。目前世界各国都在蓬勃发展电子商务，我国的电子商务也 在各种城市陆续展开。 2.网络教育 传统的老师讲、学生听的课堂授教模式随着全球网络化的发展，将会在“知识爆炸＂小时代逐 渐被淘汰或更新。旧教学模式的最大缺点是，作为受知主体的学生在教学过程中自始至终处千 心英国技术预测专家詹姆斯·马丁测算结果表明：人类知识到19世纪50年代增加了1倍；20世纪初是每10年增加1 倍；20世纪70年代则是每5年增加1倍；近10年大约每3年增加1倍，故称为“知识爆炸”。"}
{"doc_id": "co", "page": 37, "text": "第2章计算机的发展及应用31  受灌输的被动地位，其主动性、积极性难以发挥，学生无法主动探索，主动发现社会上、国际上的 信息资源，很难培养具有“信息能力”的劳动者。因此，不利于创新能力的形成和创新型人才的 成长。此外，这种模式受场地、空间的限制，投资大，受众有限，不能适应各种学科的终身教育和 全面教育。 通过教育网络，学生受教可以不受时间、空间和地域的限制，通过网络伸展到全球的每个角 落，建立真正意义上的开放式的虚拟学校，每个学生可以在任意时间、任意地点通过网络自由地 学习。不论学生的贫富贵贱都可以＂聆听”一流老师的指导，都可以向世界最权威的专家请教， 都可以从世界任何角落获取最新的信息和资料。到那时可以说，任何人都享有高等教育和终身 教育的可能。这种基于网络的教育模式，不仅美、英、日等发达国家在积极实施，我国在有条件的 地区和省市也正在加速启动建设教育网络，实现由传统教育体制、教学模式向全新教育体制、教 学模式的转变，实现教育的重大革新，满足21世纪人才培养的需求。 3.敏捷制造 随着全球信息网络技术的发展，对制造业的制造模式和企业的组成及管理模式也产生了极 大影响，新的被称为21世纪制造模式的敏捷制造由此而生。敏捷制造由两部分组成：敏捷制造 的基础结构和敏捷制造的虚拟企业。前者为形成虚拟企业提供环境和条件，后者对市场不可预 期的变化做出迅速响应。 当出现某种市场机遇时，由敏捷制造基础结构所形成的虚拟企业通过网上联络若干个具有 核心资格的组织者，他们以各自的资金、技术、厂房、设备等优势，通过国家的法律和彼此的合同， 组建成一个虚拟企业。该企业不必有集中的办公场地和固定的组织机构，完全通过网络实现产 品的技术设计、制造、网上销售和网上服务，充分发挥各自的优势，以最优化的组合、最低的成本 获取最大的利润。这种虚拟企业是在敏捷制造基础结构环境下形成的独立的、实体性的、社会性 的团体，同时又是一个动态的联盟，他们可以根据市场的变化和要求，解散原来的虚拟企业，而与 新的伙伴组成新的虚拟企业。可见，网络技术的发展对社会原来的固定企业结构形式构成了严 峻的挑战。 以上仅就几个方面列举了全球网络化对整个社会经济、文化、教育、工业制造等方面的影响。 实际上，由于网络技术的发展，现在已经形成了虚拟图书馆、虚拟医院、虚拟商场、虚拟娱乐场所 等。事实上Internet早已从对经济的干预发展到对政治的干预。例如，美国前总统克林顿，从他 的绯闻到国会弹劾，直至幸免弹劾，都与网民的直接参与分不开。又如非洲尼日利亚总统大选， 两名主要的候选人都为选举分别建立了各自的网站。再如在英国戴安娜王妃和英国王室的众多 网站上，充满政治性的窃窃私语已司空见惯。可以说全球的网络化必将进一步改变整个世界。 虚拟现实是利用计算机生成的一种模拟环境，通过多种传感设备使用户“投入”到该环境 中，达到用户与环境直接进行交互的目的。这种模拟环境是用计算机构成的具有表面色彩的立"}
{"doc_id": "co", "page": 38, "text": "32 第1篇概论 体图形，它可以是某一特定现实世界的真实写照，也可以是纯粹构想出来的世界。这类技术虽然 早在20世纪60年代初就开始研究，但只有在计算机技术迅速发展的今天，各种传感设备以及计 算机价格的不断降低，软件系统的日趋完善，如实时三维图形生成及显示、三维声音定位与合成、 环境建模等技术的发展，才有可能使虚拟现实技术获得迅速发展和广泛应用。虚拟现实在军事、 教育、航天、航空、娱乐、生活中的应用不仅会改变人们的思维方式和生活方式，还必将导致一场 重大的技术革命。 下面列举两个例子以示虚拟现实的巨大魅力。 虚拟演播室近年来已成为影视制作的热点，它综合运用现代计算机图形和图像处理、计算机 视觉和现代影视技术，将摄像机拍摄的图像实时地与计算机三维虚拟背景或另一地点实拍的背 景，按统一的三维透视成像关系进行合成，从而形成一种新的影视节目，其效果是传统影视制作 无可比拟的。在虚拟演播室里，演员可以在没有任何道具的舞台上演戏，然后根据剧情需要用计 算机制作的画面进行合成。不仅如此，演员也可以是虚拟的，可以根据事先拍好的演员镜头，利 用演技数据，用计算机图形学技术制作演员的特定动作，这对于一些特技的制作格外重要。这种 在虚拟演播室制作的影视剧大大降低了制作成本，缩短了制作时间，并且可以制作更有魅力的艺 术作品。 飞行员与汽车驾驶员的仿真训练系统也都广泛应用了虚拟现实技术。在飞行仿真训练系统 中，要形成真实的飞行环境和飞行员的真实感觉。例如，在环境图像生成中，以50Hz的频率生 成彩色图像，而且具有纹理，还有亮点、透明、天气效果（如雾、雨、雪、晴、云等）、非线性图像映 射、碰撞检测、高山地形、细节模拟等。飞机着陆时跑道灯应按飞机着陆角度不同而变换颜色，并 能确认飞机与跑道上其他飞机甚至建筑物的相互距离。又如在虚拟现实仿真中，飞行员必须体 验到真实飞行的感觉，犹如在一个真实飞机的机舱里，每个仪表都必须像在真实环境下工作，油 表指示必须反映虚拟引擎对油的使用率，并且还必须精确地反映动力和温度。在飞机接触跑道 时，还必须有真实的冲击感和震动感。显然对千价值数千万美元的飞机来说，让飞行员在仿真训 练系统中训练，既不会危及人的生命安全，又不会损坏飞机，也不会造成公害，而且大大降低了训 练成本，所以各类仿真模拟训练器都已被广泛应用。 和 统 顾名思义，办公自动化是利用计算机及自动化的办公设备来替代＂笔、墨、纸、砚”及办公人 员的部分脑力、体力劳动，从而提高了办公的质量和效率。例如，利用计算机来起草文件；利用计 算机来安排日常的各类公务活动，包括会议、会客、外出购票；利用计算机来收集各类信息，将各 类信息以电子数字形式存千数据库内，并可随时进行查询、检索及修改。一个完整的办公自动化 系统将包括文秘、财务、人事、资料、后勤等各项管理工作。近年来由于Internet的应用，将计算 机、自动化办公设备与通信技术相结合，使办公自动化向更高层次发展。例如，电子邮件的收发、 远距离会议或电视会议、高密度的电子文件、多媒体的信息处理等将会获得普遍应用。"}
{"doc_id": "co", "page": 39, "text": "第2章计算机的发展及应用33  与办公自动化相应的信息管理系统是企业管理信息系统。由于信息技术的飞速发展造就了 一个统一的全球市场，导致世界范围市场的激烈竞争。占领并主宰市场的关键在于如何不断开 发独占性的产品，不断降低成本，以质优价廉的产品投入市场。实现这个目标离不开信息管理， 通过信息的获取、分析，开发独占性产品；通过优化的信息管理，实现质优价廉产品的生产。目前 世界各国的企业都充分利用信息技术与现代化管理相结合来产生最优化的生产模式、管理模式、 设计技术和制造技术。 在企业建立一个管理信息系统，对内完成Intranet的建立，对外实现与Internet相连。通过 外部可以迅速了解市场需求和展开全球销售活动，对内可以实现物资采购、生产调度、能耗控制、 质量监控等，以最少的库存、最低的能源消耗、最快的生产周期、最佳的售后服务来提高企业的竞 争力，并合理地组织各类人才，做出科学的决策，实现企业利润的最大化。 20世纪70年代中期，在现代工业生产领域中，已经开始利用计算机来参与产品辅助设计、 产品辅助工艺设计、产品模拟样机、产品辅助制造，直至产品制造系统。到了20世纪80年代，这 类计算机辅助技术（统称为CAX)有了更高速的发展，目前可以说在机械、电子、航空、船舶、汽 车、纺织、服装、化工、建筑等各行各业中，CAX获得了极其广泛的应用，不仅提高了产品设计生 产自动化的程度，而且给传统性的生产发展带来了革命性的变化。 1. CAD  计算机辅助设计(ComputerAided Design, CAD)按设计任务书的要求，可进行各种设计方案 的比较，确定产品结构、外形尺寸、材料选择、模拟组装；再对模拟整机进行各种性能测试，包括强 度分析、振动分析、运动状态分析等；并任意修正，从性能的先进性、经济的合理性、加工的可行性 等方面进行论证，获得最终的设计产品；然后将其分解为零件、分装部件，并给出零件图、分部装 配图、总体装配图等。上述全部工作都可以由计算机来完成，大大降低了产品设计的成本，缩短 了产品设计的周期，最大限度地降低了产品设计的风险。因此CAD技术已被各制造业广泛应 用。目前，随着计算机软、硬件技术的发展，已经可以利用计算机实现产品创意设计，设计者可以 提出一个朦胧的思想，在计算机上进行概念设计，并进行不断修改与完善，最后确定一种新颖的 产品。 2. CAM  计算机辅助制造(ComputerAided Manufacturing, CAM)是以数控机床为主体，利用存有全部 加工资料的数据库（如刀具、夹具和各种零件的加工程序，以及在加工过程中的自动换刀及加工 数据的控制），实现对产品加工的自动化。目前人们已经将数控、物料流控制及存储、机器人、柔 性制造、生产过程仿真等计算机相关控制技术统称为计算机辅助制造。 利用计算机参与人脑的辅助工作非常普遍，而且还在不断开拓新的领域，如计算机辅助工艺 规划(ComputerAided Process Planning, CAPP)、计算机辅助工程(ComputerAided Engineering,"}
{"doc_id": "co", "page": 40, "text": "34 第1篇概论 CAE)及计算机辅助教学(ComputerAssisted Instruction, CAI)等都得到越来越广泛的应用。 3. CIMS  计算机集成制造系统(ComputerIntegrated Manufacturing System, CIMS)是利用信息技术和现 代管理技术改造传统制造业、加强新兴制造业、提高企业市场竞争能力的一种生产模式。具体而 言，以企业选定的产品为龙头，在产品设计过程、管理决策过程、加工制造过程、产品质量管理和 控制等过程中，采用各种计算机辅助技术和先进的科学管理方法，在计算机网络和数据库的支持 下，实现信息集成，进而优化企业运行，达到产品上市快、质量好、成本低、服务好的目的，以此提 高产品的市场占有率和企业的市场竞争能力。显然，要形成计算机集成制造系统的企业，必须广 泛地采用CAD/CAE/CAPP/CAM，并且已经建立了企业的管理信息系统(ManagementInformation  System,MIS)，只有通过生产、经营各个环节的信息集成，支持技术集成，并由技术集成进入技术、 经营管理和人员组织的集成，最终达到物流、信息流、资金流的集成并优化运行，才能提高企业的 市场竞争能力和应变能力。 媒体 多媒体技术是计算机技术和视频、音频及通信等技术相结合的产物。它是用来实现人和计 算机交互地对各种媒体（如文字、图形、影像、音频、视频、动画等）进行采集、传输、转换、编辑、存 储、管理，并由计算机综合处理为文字、图形、动画、音响、影像等视听信息而有机合成的新媒体。 因此它可以将原来仅能体现或保存一种媒体的设备或手段转换为由计算机集成。例如，传统的 音响设备只能录音、放音；档案库只能存档文件；图书馆只能收藏书籍；电视只能提供音频和视频 信息；电话只能传递语音等。而今用多媒体技术可以使声、图、文合成后全部集成到计算机中。 同时，利用计算机还可以制作、创造新的媒体信息，如合成音乐、电子动画等。它不但使社会显得 格外绚丽多彩，生活显得格外富有幻想，而且会对政治、经济、军事、工业、环境等都产生巨大的影 响，例如，飞行仿真训练系统、虚拟演播室等都离不开多媒体技术。它的深远意义还会影响未来 计算机人工智能技术的发展。因此，有关多媒体技术的研究和应用也是当前计算机技术的热点 之一。 匕匕公目 人工智能是专门研究如何使计算机来模拟人的智能的技术。尽管经过了近半个世纪的努 力，被人们称为“电脑”的计算机与人脑相比，仍无法相提并论。例如，集成度达1亿个晶体管的 处理器芯片仍然无法与人类的1011~ 1012个神经元相比，因为每个神经元远不是一个晶体管，很 可能相当于一台高速运行的处理器。可见“电脑“要真正模拟人脑，特别是要使“电脑”具有人的 经验知识以及通过联想、比拟、推断来做出决策的功能，至少从目前来看还有相当距离。 尽管如此，人们还是想尽一切办法，赋予“电脑”一部分人脑的智力，并且还在不断扩大和增"}
{"doc_id": "co", "page": 41, "text": "第2章计算机的发展及应用35  强这种智力。近年来在模式识别、语音识别、专家系统和机器人制作方面都取得了很大的成就。 模式识别是指对某些感兴趣的客体进行定量的或结构的描述，研究一种自动生成技术，由计 算机自动地把待识别的模式分配到各自的模式类中。由此技术派生的图像处理技术和图像识别 技术已被广泛应用。例如，对人体细胞显微图像分析，可确定内脏是否发生病变；对动、植物细胞 显微图像分析，可确定环境是否被污染；对地表植物经遥感图像分析，可判断作物的长势等；还包 括公安系统的指纹分辨及身份、证件、凭证鉴别等。 文字／语音识别、语言翻译是人工智能的又一重要应用领域。自计算机问世后，人们就企图 让计算机来承担文字、语言的翻译工作，实际上让计算机正确认识文字和语音，正确理解自然语 言，实现正确的语言翻译还是十分困难的。虽然经过几十年的努力，目前已有了很大的进展，如 手写体的计算机输入系统已被广泛使用，语音录入计算机的软件也开始在市场上问世，当然它的 正确识辨率还有待进一步提高。此外，在自然语言理解的基础上研制成的文字／语言翻译机也在 陆续问世，但离人们的实用要求还有一定距离，不过这些技术的突破是指日可待的，使计算机会 听、会看、会说的时代已经不是很遥远了。 专家系统是人工智能的另一重要应用领域。它是利用计算机构成存储量极大的知识库，把 各类专家丰富的知识和经验，以数据形式存储于知识库内，通过专用软件，根据用户输入查询的 要求，向用户做出所要求的解答。这种系统早已被广泛应用在医学、工程、军事、法律等领域，尤 其是Internet的出现，更可以构成远程虚拟医疗、虚拟课堂、虚拟考试等。 机器人的出现也是人工智能领域的一项重要应用。通常人们让机器人做一些重复性的劳 动，特别是在一些不适宜人们工作的劳动场所，机器人的应用显得格外重要。例如，海底探测，人 在海底的时间是非常有限的，如果让机器人进行海底探测就方便多了。可以让机器人配上摄像 机，构成它的眼睛；配上双声道的声音接收器，变成它的耳朵；再配上合适的机械装置，使它可以 活动、触摸、承受各种信息并直接送到计算机进行处理，这样它就可以模仿人完成海底探测。现 在还有一些更高级的“智能机器人＂，具有一定的感知和识别能力，还能简单地说话和回答问题。 总之，随着科学技术的不断发展，更高级的机器人将会不断出现。 3  机的展望 从1946年ENIAC问世至今，70多年来计算机技术的进步推动了计算机的发展和广泛的应 用，使计算机在人类的全部活动领域里占有极为重要的地位。从超级巨型机到心脏起搏器，从电 话网络到汽车的汽化器无处不在，无所不及，几乎能填补甚至取代各类信息处理器，成为人类最 得力的助手。 世界上不少科学家预言，到了2046年人类社会几乎所有的知识和信息将全部融入于计算机 空间，而任何人在任何地方任何时间都可以通过网络，对所有的知识和信息进行在线获取。这个 预测是大家所希望的，也是必定会实现的。计算机空间将会为崭新的信息方式、娱乐方式和教育"}
{"doc_id": "co", "page": 42, "text": "36 第1篇概论 方式提供基础，并会提供新层次的个人服务和健康保健，最大的受益将是人们可以在远距离与他 人进行全感知的交流。这种计算机应该具有类似人脑的一些超级智能，具有类似人脑的自组织、 自适应、自联想、自修复的能力。人脑的这种功能要求信息处理的计算机速度至少达每秒10气 存储容量至少为1013字节，当然还需要相应的软件支持。倘若计算机的计算速度和存储容量达 不到这个指标，那么所谓超级智能计算机只能是一种幻想。因此，尽管20世纪七八十年代，人工 智能的研究曾一度出现高潮，特别是日本投入了大量的资金，做了很大的努力，但超级智能计算 机的实现远比想像的要艰难得多。 显然，欲实现上述目标，首当其冲的应该是努力提高处理器的主频。硅芯片微处理器主频与 其集成度紧密相关，但是实现起来并非易事。其一，硅芯片的集成度又受其物理极限的制约，集 成度不可能无止境地提高，当集成电路的线宽达到仅为单个分子大小的物理极限时，意味着硅芯 片的集成度已到了穷途末路的境地。其二，由千硅芯片集成度提高时，其制作成本也在不断提 高，即在微电子工艺发展中还遵循另一规律：＂每代芯片的成本大约为前一代芯片成本的两倍\"。 一般来说，建造一个生产0.25µrn工艺芯片的车间大约需20~25亿美元，而使用0.18µrn工艺 时，费用将跃升到30~40亿美元。按几何级数递增的制作成本情况发展，数年内该费用将达100 亿美元，致使企业无法承受。其三，正如前述，随着集成度的提高，微处理器内部的功耗、散热、线 延迟等一系列问题将难以解决。因此Intel公司工程师保罗·帕肯在近年来发表了骇人听闻的 预测，认为硅芯片技术10年后将走到尽头并非偶然。 尽管如此，人类对美好愿望的追求是无止境的，决不会因硅芯片的终结而放弃超级智能计算 机的研制。 那么究竟谁能接过传统硅芯片发展的接力棒呢？多年来，科学家们把眼光都凝聚在光计算 机、生物计算机和量子计算机上，而量子计算机被寄托了极大的希望。 光计算机利用光子取代电子进行运算和存储，用不同波长的光代表不同数据，可快速完成复 杂计算。然而要想制造光计算机，需开发出可用一条光束控制另一条光束变化的光学晶体管。 现有的光学晶体管庞大而笨拙，用其制造台式计算机将有一辆汽车那么大。因此，光计算机短期 内难以进入实用阶段。 DNA（脱氧核糖核酸）生物计算机是美国南加州大学阿德拉曼博士1994年提出的奇思妙 想，它通过控制DNA分子间的生化反应完成运算。但目前流行的DNA计算技术必须将DNA溶 千试管液体中。这种计算机由一堆装有有机液体的试管组成，虽然看起来很神奇，但很笨拙。这 一问题得不到解决，DNA计算机在可预见的未来将难以取代硅芯片计算机。 与前两者相比，量子计算机的前景尤为光明。量子这种常人难以理解的特性，使得具有 5 000个量子位的量子计算机能在约30s内解决传统硅芯片超级计算机要在100亿年才能解决 的大数因子分解问题。 量子计算机是利用原子所具有的量子特性进行信息处理的一种全新概念的计算机。原子会 旋转，而且不是向上就是向下，正好与数位科技的“0”与“1“完全吻合。既然原子可以同时向上 并向下旋转，如果把一群原子聚在一起，它们不会像现在的计算机进行线性运算，而是可以同时"}
{"doc_id": "co", "page": 43, "text": "第2章计算机的发展及应用37  进行所有可能的运算。只要有40个原子一起计算，就可达到相当于现在一部超级计算机的同等 性能。专家们认为，如果有一个包含全球电话号码的资料库，找出一个特定的电话号码，一部量 子计算机只要27min，而同样的工作交付给10台IBM“深蓝“超级计算机同时运作，也至少需要 几个月的时间才能完成。量子计算机以处于量子状态的原子作为中央处理器和内存，其运算能 力比目前的硅芯片为电路基础的传统计算机要快几亿倍。 当利用高速运行的量子计算机后，再结合现代计算机采用高并行度的体系结构，通过大量高 速处理器的高宽带局域网的连接，使它具有类似人脑的高并行性的本质。预计人类级的智能所 需的硬件可能在21世纪的前1/4的时间内实现，与20世纪70年代只够得上“昆虫级“智能的计 算机硬件能力相比，显然人们对超级智能计算机的研制更充满信心。 超级智能计算机不仅需要有硬件支撑，而且还必须有软件支持。模拟大脑功能创建超级智 能计算机，除了通过足够的硬件能力和适应计算机学习的软件外，还需有足够的初始体系结构和 丰富的感官输入流。当前的技术对后者巳经很容易满足，如采用视觉照相机、扬声器和各类触觉 传感器，能保证特定的实时世界信息流流入计算机。而前者则更难实现，因为大脑并非一开始就 是一片空白。它有一个遗传可编码的初始结构，存在着神经皮层可塑性、大脑皮层的相似性及进 化的论点。这些问题的解决必须随着神经科学的进一步发展，在对人脑的神经结构和它的学习 算法了解得足够多的前提下，在具有很强计算能力的计算机上实现复制。科学家估计大约在今 后10多年内，采用当前的设备支持输入输出渠道，对人脑继续研究，发现新的计算机学习方法和 对新神经科学的深入研究，超级智能计算机的出现是势不可挡的必然趋势，只是时间问题。 21世纪除了人们继续追求超级智能计算机的问世外，更引起人们注目的是价格低廉、使用 方便、体积更小、外形多变、具有人性化的计算机的研究和应用。 虽然计算机强大的功能使它能处理相当多的事务，但至今还存在不尽如人意的缺点。因此， 普及面仍未达到应有的程度。其原因主要在千对绝大多数人而言，还不能非常方便地对它进行 操作，而且很难适应各种场合的需要。因此，除了继续提高芯片主频外，在输入输出方式上应有 更多的性能突破。输入输出方式将更多样化和更人性化。除了手写分辨率和速度进一步提高 外，语音输入输出将随时可见，包括汽车、家电、电话、电视、玩具、手表等。而且还可用人的手势、 表情、眼睛瞳孔的位置，甚至利用人体的气味、体温来控制输入。三维图像输出将能实时地合成 真实的视频图像，包括完整的戏剧电影，还允许计算机合成的图像和人面对面交谈。平面液晶显 示器将可以像眼镜一般戴在脸上，构成可移动的计算机。 计算机的外形及尺寸大小将随着不同的对象和环境而变化，甚至朝着个人化量体定做的方 向发展。特别是嵌入式的计算机，可以遍及汽车、房间、车站、机场及各种建筑场，使用者利用随 身携带的信息操作器具，无须做任何连接方式，利用红外线传输方式，随时从公共场所服务器主 机上接收所需的信息，包括个人的电子邮件等。尤其是个人身上穿戴的计算机连同身上网络，可 以随时随地照顾用户健康、安全，并帮助用户在复杂的物理空间环境中工作，如汽车、飞机 驾驶等。 在普及型的计算机发展同时，大型系统也将获得巨大发展，将来由低价、通用的多处理机组"}
{"doc_id": "co", "page": 44, "text": "38 第1篇概论 成的群机系统来替代单一的大型系统。在这个群机系统中，每个计算机通过快速的系统级网络 (SAN)和其他计算机通信。群机系统可以扩展到上千个结点，对千数据库和即时事务处理 (OLTP)的应用，群机能像单机一样运转。群机能开发隐含在处理并行多用户中或在处理包含 在多个存储设备的大型查询中的并行性。一个具有几十个结点的PC群机系统，每天可执行10 亿多次事务处理，比目前最大的大型机吞吐量还大。科学计算将在高度专用、类似CRAY的多 向量结构的计算机上运行。 前面提到的网络带宽问题，到2046年，每光波长携带几个GB的光纤将会很普遍地进入广 大家庭用户中，那时带宽将不再是问题。它们将为电话、可视电话、电视、网络访问、安全监控、家 庭能源管理以及其他各种设备服务。 虽然不能对未来的计算机预知得那么清晰、那么准确，但是，仅就上述的描述，也就可以想象 几十年后，计算机给人类带来的绚丽多彩的生活和人类社会的美好僮憬绝不是幻想。 2.1 通常，计算机的更新换代以什么为依据？ 2.2 举例说明专用计算机和通用计算机的区别。 2.3 什么是摩尔定律？该定律是否永远生效？为什么？ 2.4 举3个实例，说明网络技术的应用。 2.5 举例说明人工智能方面的应用有哪些。 2.6 举例说明哪些计算机的应用需采用多媒体技术。 2.7 设想一下计算机的未来。 题"}
{"doc_id": "co", "page": 45, "text": "计算机硬件系统由中央处理器、存储器、1/0系统以及连接它们的系统总线组 成。本篇介绍系统总线、存储器和1/0系统三部分，中央处理器将在第3篇单 独讲述。"}
{"doc_id": "co", "page": 47, "text": "岁 本章着重介绍系统总线的基本概念及其分类、结构和总线控制逻辑。要求读者能对系统总 线在计算机硬件结构中的地位和作用有所了解。 3.1 总线的基本概念 计算机系统的五大部件之间的互连方式有两种，一种是各部件之间使用单独的连线，称为分 散连接；另一种是将各部件连到一组公共信息传输线上，称为总线连接。 早期的计算机大多数用分散连接方式，如图1.7所示。它是以运算器为中心的结构，其内部 连线十分复杂，尤其是当1/0与存储器交换信息时，都需经过运算器，致使运算器停止运算，严 重影响了CPU的工作效率。后来，虽然改进为以存储器为中心的如图1.8所示的分散连接结 构，1/0与主存交换信息可以不经过运算器，又采用了中断、DMA等技术，使CPU工作效率得到 很大的提高，但是仍无法解决1/0设备与主机之间连接的灵活性。随着计算机应用领域的不断 扩大，1/0设备的种类和数量也越来越多，人们希望随时增添或减撤设备，用分散连接方式简直 是一筹莫展，由此出现了总线连接方式。 总线是连接多个部件的信息传输线，是各部件共享的传输介质。当多个部件与总线相连时， 如果出现两个或两个以上部件同时向总线发送信息，势必导致信号冲突，传输无效。因此，在某 一时刻，只允许有一个部件向总线发送信息，而多个部件可以同时从总线上接收相同的信息。 总线实际上是由许多传输线或通路组成，每条线可一位一位地传输二进制代码，一串二进制 代码可在一段时间内逐一传输完成。若干条传输线可以同时传输若干位二进制代码，例如，16 条传输线组成的总线可同时传输16位二进制代码。 采用总线连接的计算机结构，如图3.1所示，它是以CPU为中心的双总线结构。 其中一组总线连接CPU和主存，称为存储总线(M总线）；另一组用来建立CPU和各1/0设 备之间交换信息的通道，称为输入输出总线(1/0总线）。各种1/0设备通过1/0接口挂到1/0 总线上，更便千增删设备。这种结构在1/0设备与主存交换信息时仍然要占用CPU，因此还会 影响CPU的工作效率。 倘若将CPU、主存和1/0设备（通过1/0接口）都挂到一组总线上，便形成单总线结构的计 算机，如图3.2所示。 图3.2与图3.1相比，最明显的特点是当1/0设备与主存交换信息时，原则上不影响CPU的"}
{"doc_id": "co", "page": 48, "text": "42 第2篇计算机系统的硬件结构 JJO总线 图3.1面向CPU的双总线结构框图 图3.2单总线结构框图 工作，CPU仍可继续处理不访问主存或1/0设备的操作，这就使CPU工作效率有所提高。但是， 因只有一组总线，当某一时刻各部件都要占用总线时，就会发生冲突。为此，必须设置总线判优 逻辑，让各部件按优先级高低来占用总线，这也会影响整机的工作速度。PDP-11和国产DJS183 机均采用这种结构。 还有一种以存储器为中心的双总线结构，如图3.3所示。 存储总线 CPU  图3.3以存储器为中心的双总线结构框图"}
{"doc_id": "co", "page": 49, "text": "第3章系统总线43  它是在单总线基础上又开辟出的一条CPU与主存之间的总线，称为存储总线。这组总线速 度高，只供主存与CPU之间传输信息。这样既提高了传输效率，又减轻了系统总线的负担，还保 留了I/0设备与存储器交换信息时不经过CPU的特点。国产DJS184机采用这种结构。 现代计算机大多数采用各类总线结构。 3.2 总线的分类 总线的应用很广泛，从不同角度可以有不同的分类方法。按数据传送方式可分为并行传输 总线和串行传输总线。在并行传输总线中，又可按传输数据宽度分为8位、16位、32位、64位等 传输总线。若按总线的使用范围划分，则又有计算机（包括外设）总线、测控总线、网络通信总线 等。下面按连接部件不同，介绍三类总线。 1 片内 片内总线是指芯片内部的总线，如在CPU芯片内部，寄存器与寄存器之间、寄存器与算逻单 元ALU之间都由片内总线连接。 系统总线是指CPU、主存、1/0设备（通过1/0接口）各大部件之间的信息传输线。由千这些 部件通常都安放在主板或各个插件板（插卡）上，故又称板级总线（在一块电路板上各芯片间的 连线）或板间总线。 按系统总线传输信息的不同，又可分为三类：数据总线、地址总线和控制总线。 1.数据总线 数据总线用来传输各功能部件之间的数据信息，它是双向传输总线，其位数与机器字长、存 储字长有关，一般为8位、16位或32位。数据总线的位数称为数据总线宽度，它是衡量系统性 能的一个重要参数。如果数据总线的宽度为8位，指令字长为16位，那么，CPU在取指阶段必须 两次访问主存。 2.地址总线 地址总线主要用来指出数据总线上的源数据或目的数据在主存单元的地址或1/0设备的地 址。例如，欲从存储器读出一个数据，则CPU要将此数据所在存储单元的地址送到地址线上。 又如，欲将某数据经1/0设备输出，则CPU除了需将数据送到数据总线外，还需将该输出设备的 地址（通常都经1/0接口）送到地址总线上。可见，地址总线上的代码是用来指明CPU欲访问的 存储单元或1/0端口的地址，由CPU输出，单向传输。地址线的位数与存储单元的个数有关，如"}
{"doc_id": "co", "page": 50, "text": "44 第2篇计算机系统的硬件结构 地址线为20根，则对应的存储单元个数为2气 3.控制总线 由千数据总线、地址总线都是被挂在总线上的所有部件共享的，如何使各部件能在不同时刻 占有总线使用权，需依靠控制总线来完成，因此控制总线是用来发出各种控制信号的传输线。通 常对任一控制线而言，它的传输是单向的。例如，存储器读／写命令或I/0设备读／写命令都是由 CPU发出的。但对于控制总线总体来说，又可认为是双向的。例如，当某设备准备就绪时，便向 CPU发中断请求；当某部件（如DMA接口）需获得总线使用权时，也向CPU发出总线请求。此 外，控制总线还起到监视各部件状态的作用。例如，查询该设备是处于＂忙”还是＂闲＂，是否出错 等。因此对CPU而言，控制信号既有输出，又有输入。 常见的控制信号如下。 0时钟：用来同步各种操作。 ·复位：初始化所有部件。 0总线请求：表示某部件需获得总线使用权。 ·总线允许：表示需要获得总线使用权的部件已获得了控制权。 ·中断请求：表示某部件提出中断请求。 ·中断响应：表示中断请求已被接收。 ·存储器写：将数据总线上的数据写至存储器的指定地址单元内。 0存储器读：将指定存储单元中的数据读到数据总线上。 • I/0读：从指定的I/0端口将数据读到数据总线上。 • I/0写：将数据总线上的数据输出到指定的I/0端口内。 ·传输响应：表示数据已被接收，或已将数据送至数据总线上。 通信 这类总线用千计算机系统之间或计算机系统与其他系统（如控制仪表、移动通信等）之间的 通信。由千这类联系涉及许多方面，如外部连接、距离远近、速度快慢、工作方式等，差别极大，因 此通信总线的类别很多。但按传输方式可分为两种：串行通信和并行通信。 串行通信是指数据在单条1位宽的传输线上，一位一位地按顺序分时传送。如1字节的数 据，在串行传送中，1字节的数据要通过一条传输线分8次由低位到高位按顺序逐位传送。 并行通信是指数据在多条并行1位宽的传输线上，同时由源传送到目的地。如1字节的数 据，在并行传送中，要通过8条并行传输线同时由源传送到目的地。 并行通信适宜于近距离的数据传输，通常小于30m；串行通信适宜于远距离传送，可以从几 米到数千千米。而且，串行和并行通信的数据传送速率都与距离成反比。在短距离内，并行数据 传送速率比串行数据传送速率高得多。随着大规模和超大规模集成电路的发展，逻辑器件的价 格趋低，而通信线路费用趋高，因此对远距离通信而言，采用串行通信费用远比并行通信费用低"}
{"doc_id": "co", "page": 51, "text": "第3章系统总线45  得多。此外串行通信还可利用现有的电话网络来实现远程通信，降低了通信费用。 3.3 总线特性及性能指标 从物理角度来看，总线由许多导线直接印制在电路板上，延伸到各个部件。图3.4形象地表 示了各个部件与总线之间的物理摆放位置。 U 板 CP 插 存板主插0板V 插 /  图3.4总线结构的物理实现 图中CPU、主存、I/0这些插板（又称插卡）通过插头与水平方向总线插槽（按总线标准用印 刷电路板或一束电缆连接而成的多头插座）连接。为了保证机械上的可靠连接，必须规定其机 械特性；为了确保电气上正确连接，必须规定其电气特性；为保证正确地连接不同部件，还需规定 其功能特性和时间特性。随着计算机的发展，Pentiumill以上的微型计算机已将CPU芯片直接 安置在主板上，而且很多插卡己做成专用芯片，减少了插槽，使其结构更合理。 总线特性包括以下几项。 (1)机械特性 机械特性是指总线在机械连接方式上的一些性能，如插头与插座使用的标准，它们的几何尺 寸、形状、引脚的个数以及排列的顺序，接头处的可靠接触等。 (2)电气特性 电气特性是指总线的每一根传输线上信号的传递方向和有效的电平范围。通常规定由 CPU发出的信号称为输出信号，送入CPU的信号称为输入信号。例如，地址总线属于单向输出 线，数据总线属于双向传输线，它们都定义为高电平为“1\"，低电平为“0\"。控制总线的每一根都 是单向的，但从整体看，有输入，也有输出。有的定义为高电平有效，也有的定义为低电平有效， 必须注意不同的规格。大多数总线的电平定义与TTL是相符的，也有例外，如RS-232C（串行总 线接口标准），其电气特性规定低电平表示逻辑“1\"，并要求电平低于－3V；用高电平表示逻辑"}
{"doc_id": "co", "page": 52, "text": "46 第2篇计算机系统的硬件结构 \"0\"，还要求高电平需高于＋3V，额定信号电平为－10V和＋10V左右。 (3)功能特性 功能特性是指总线中每根传输线的功能，例如，地址总线用来指出地址码；数据总线用来传 递数据；控制总线发出控制信号，既有从CPU发出的，如存储器读／写、1/0设备读／写，也有1/0 设备向CPU发来的，如中断请求、DMA请求等。由此可见，各条线的功能不同。 (4)时间特性 时间特性是指总线中的任一根线在什么时间内有效。每条总线上的各种信号互相存在一种 有效时序的关系，因此，时间特性一般可用信号时序图来描述。 性能指标 总线性能指标如下。 心总线宽度：通常是指数据总线的根数，用bit（位）表示，如8位、16位、32位、64位（即8 根、16根、32根、64根）。 ＠总线带宽：总线带宽可理解为总线的数据传输速率，即单位时间内总线上传输数据的位 数，通常用每秒传输信息的字节数来衡量，单位可用MBps（兆字节每秒）表示。例如，总线工作 频率为33MHz，总线宽度为32位(4B)，则总线带宽为33x(32+8)=132 MBps。 ＠时钟同步／异步：总线上的数据与时钟同步工作的总线称为同步总线，与时钟不同步工作 的总线称为异步总线。 ＠总线复用：一条信号线上分时传送两种信号。例如，通常地址总线与数据总线在物理上 是分开的两种总线，地址总线传输地址码，数据总线传输数据信息。为了提高总线的利用率，优 化设计，特将地址总线和数据总线共用一组物理线路，在这组物理线路上分时传输地址信号和数 据信号，即为总线的多路复用。 ＠信号线数：地址总线、数据总线和控制总线三种总线数的总和。 ＠总线控制方式：包括突发工作、自动配置、仲裁方式、逻辑方式、计数方式等。 ＠其他指标：如负载能力、电源电压（是采用5V还是3.3V)、总线宽度能否扩展等。 总线的负载能力即驱动能力，是指当总线接上负载后，总线输入输出的逻辑电平是否能保持 在正常的额定范围内。例如，PC总线的输出信号为低电平时，要吸入电流，这时的负载能力即指 当它吸收电流时，仍能保持额定的逻辑低电平。总线输出为高电平时，要输出电流，这时的负载 能力是指当它向负载输出电流时，仍能保持额定的逻辑高电平。由千不同的电路对总线的负载 是不同的，即使同一电路板在不同的工作频率下，总线的负载也是不同的，因此，总线负载能力的 指标不是太严格的。通常用可连接扩增电路板数来反映总线的负载能力。 表3.1列出了几种流行的微机总线性能，可供参考。"}
{"doc_id": "co", "page": 53, "text": "第3章系统总线47  表3.1几种流行的微型计算机总线性能 ISA VESA  名称EISA STD MCA PCI  (PC-AT) (VL-BUS)  适用 Z-80、V20、 IBM个人机 P5个人机、 80286、386、386、486、586i486、PC-AT PowerPC、 V40  机型486系列机IBM系列机 IBM PC系列机 兼容机与工作站 Alpha工作站 最大 266 MBps  133 MBps  传输率 15 MBps 33 MBps 2 MBps 40 MBps  或266MBps  总线宽度16位32位8位32位32位32位 总线工作33 MHz  8 MHz 8.33 MHz 2 MHz 66 MHz 10 MHz  频率66 MHz  同步方式同步异步同步 仲裁方式集中集中集中集中 地址宽度24 32 20 32/64  负载能力8 6 无限制6 无限制3  信号线数143 90 109 49  64位扩展不可无规定不可可可可 并发工作可可 引脚使用非多路复用非多路复用非多路复用非多路复用多路复用 注：表中缺项待查。 总线是在计算机系统模块化的发展过程中产生的，随着计算机应用领域的不断扩大，计算机 系统中各类模块（特别是I/0设备所带的各类接口模块）品种极其繁杂，往往一种模块要配一种 总线，很难在总线上更换、组合各类模块或设备。20世纪70年代末，为了使系统设计简化，模块 生产批量化，确保其性能稳定、质量可靠，实现可移化，便千维护等，人们开始研究如何使总线建 立标准，在总线的统一标准下，完成系统设计、模块制作。这样，系统、模块、设备与总线之间不适 应、不通用及不匹配的问题就迎刃而解了。"}
{"doc_id": "co", "page": 54, "text": "48 第2篇计算机系统的硬件结构 所谓总线标准，可视为系统与各模块、模块与模块之间的一个互连的标准界面。这个界面对 它两端的模块都是透明的，即界面的任一方只需根据总线标准的要求完成自身一方接口的功能 要求，而无须了解对方接口与总线的连接要求。因此，按总线标准设计的接口可视为通用接口。 采用总线标准可以为计算机接口的软硬件设计提供方便。对硬件设计而言，使各个模块的接口 芯片设计相对独立；对软件设计而言，更有利于接口软件的模块化设计。 目前流行的总线标准有以下几种。 1. ISA总线 ISA (Industrial Standard Architecture)总线是IBM为了采用全16位的CPU而推出的，又称 AT总线，它使用独立于CPU的总线时钟，因此CPU可以采用比总线频率更高的时钟，有利于 CPU性能的提高。由于ISA总线没有支持总线仲裁的硬件逻辑，因此它不能支持多台主设备 （不支持多台具有申请总线控制权的设备）系统，而且ISA上的所有数据的传送必须通过CPU或 DMA（直接存储器存取）接口来管理，因此使CPU花费了大量时间来控制与外部设备交换数据。 ISA总线时钟频率为8MHz，最大传输率为16MBps，数据线为16位，地址线为24位。 2. EISA总线 EISA (Extended Industrial Standard Architecture)是一种在ISA基础上扩充开放的总线标准， 与ISA可以完全兼容，从CPU中分离出了总线控制权，是一种具有智能化的总线，能支持多个总 线主控器和突发方式（总线上可进行成块的数据传送）的传输。EISA总线的时钟频率为8MHz,  最大传输率可达33MBps，数据总线为32位，地址总线为32位，扩充DMA访问范围达2气 3. VESA(VL-BUS)总线 VESA总线是由VESA(Video Electronic Standard Association，视频电子标准协会）提出的局部 总线标准，又称为VL-BUS(LocalBUS)总线。所谓局部总线，是指在系统外为两个以上模块提供 的高速传输信息通道。VL-BUS是由CPU总线演化而来的，采用CPU的时钟频率达33MHz、数 据线为32位，可通过扩展槽扩展到64位，配有局部控制器，最大传输率达133MBps。通过局部 总线控制器，将高速I/0设备直接挂在CPU上，实现CPU与高速I/0设备之间的高速数据交换 （参见图3.12)。 4. PCI总线 随着图形用户界面(GraphicalUser Inte1face, GUI)和多媒体技术在PC系统中的广泛应用， ISA总线和EISA总线由于受带宽的限制，已不能适应系统工作的要求，成为整个系统的主要瓶 颈。因此对总线提出了更高的性能要求，促使总线技术进一步发展。 1991年下半年，Intel公司首先提出PCI(Peripheral Component Interconnect，外围部件互连） 总线的概念，并联合IBM、Compaq、Apple、DEC、AST、HP等计算机业界大户，成立了PCI集团 PCISIG (PCI Special Interest Group, PCI专门权益组织），千1992年6月22日推出了PCI1.0版， 1995年和1999年又先后推出了2.1版和2.2版，PCI总线已成为现代计算机中最常用的总线之 一，它的主要特点如下所述。 心高性能。PCI总线是一种不依附千某个具体处理器的局部总线。它为系统提供了一个"}
{"doc_id": "co", "page": 55, "text": "第3章系统总线49  高速的数据传输通道，与CPU时钟频率无关，自身采用33MHz和66MHz的总线时钟，数据线为 32位，可扩展到64位，传输速率从132MBps(33 MHz时钟，32位数据通路）可升级到528MBps  (66 MHz时钟，64位数据通路）。它支持突发工作方式，这种方式是指若被传送的数据在主存中 连续存放，则在访问此组数据时，只需给出第一个数据的地址，占用一个时钟周期，其后每个数据 的传送各占一个时钟周期，不必每次给出各个数据的地址，因此可提高传输速率。 ＠良好的兼容性。PCI总线部件和插件接口相对于处理器是独立的，它支持所有的目前和 将来不同结构的处理器，因此具有相对长的生命周期。PCI总线与ISA、EISA总线均可兼容，可 以转换为标准的ISA、EISA。 ＠支持即插即用(Plugand Play)，即任何扩展卡只要插入系统便可工作。PCI设备中配有 存放设备具体信息的寄存器，这些信息可供BIOS（基本输入输出系统）和操作系统层的软件自动 配置PCI总线部件和插件，使系统使用方便，无须进行复杂的手动配置。 ＠支持多主设备能力。主设备即对总线有控制权的设备，PCI支持多主设备，即允许任何 主设备和从设备（对总线没有控制权的设备）之间实现点到点对等存取，体现了接纳设备的高度 灵活性。 ＠具有与处理器和存储器子系统完全并行操作的能力。PCI总线可视为CPU与外设之间 的一个中间层，它通过PCI桥路(PCI控制器）与CPU相连。PCI桥路有多级缓冲，可把一批数 据快速写入缓冲器中，在这些数据不断写入PCI设备过程中，可真正实现与处理器／存储器子系 统的安全并发工作。 ＠提供数据和地址奇偶校验功能，保证了数据的完整和准确。 ＠支持两种电压标准：5V和3.3V。3.3~5V的组件技术可以使电压平滑过渡。3.3V电 压的PCI总线可用于便携式微型计算机中。 ＠可扩充性好。当PCI总线驱动能力不足时，可以采用多层结构（参见图3.14)。 ＠软件兼容性好。PCI部件可以完全兼容现有的驱动程序和应用程序。设备驱动程序可 被移植到各类平台上。 叨采用多路复用技术，减少了总线引脚个数。 上述各类总线的实例将在3.4.3节中介绍。 随着网络的高速发展以及其他周边设备的技术革新，诸如千兆网卡之类的设备对PCI总 线提出了更高要求。Intel公司近年来又推出了PCI-Express总线，它采用了类似网络传输 TCP/IP协议的分层结构和数据帧逐层传递的模式。有关这方面的内容，读者可进一步查找 相关资料。 5. AGP总线 随着多媒体计算机的普及，对三维技术的应用也越来越广。处理三维数据不仅要求有惊人 的数据量，而且要求有更宽广的数据传输带宽。例如，对640x480像素的分辨率而言，以每秒75 次画面更新率计算，要求全部的数据带宽达370MBps；若分辨率提高到800X600像素时，总带宽 高达580MBps。因此PCI总线成为传输瓶颈。为了解决此问题，Intel公司于1996年7月又推"}
{"doc_id": "co", "page": 56, "text": "50 第2篇计算机系统的硬件结构 出了AGP(Accelerated Graphics Port，加速图形端口），这是显示卡专用的局部总线，基于PCI2.1  版规范并进行扩充修改而成，它采用点对点通道方式，以66.7MHz的频率直接与主存联系，以 存作为帧缓冲器，实现了高速存取。最大数据传输率（数据宽度为32位）为266MBps，是传统 PCI总线带宽的2倍。AGP还定义了一种“双激励\"(DoublePumping)的传输技术，能在一个时 钟的上、下沿双向传递数据，这样，AGP实现的传输频率为66.7MHzx2，即133MHz，最大数据传 输率可增为533MBps。后来又依次推出了AGP2X,AGP4X, AGP8X多个版本，数据传输速率可 达2.1GBps。 6. RS-232C总线 RS-232C (RS即RecommendedStandard的缩写，232为标识号，C表示修改次数）是由美 国电子工业协会EIA(Electronic Industries Association)推荐的一种串行通信总线标准，它是 应用千串行二进制交换的数据终端设备(DTE)和数据通信设备(DCE)之间的标准接口，如 图3.5所示。 I  沸／串 计｝转换IRS-232  算＇及 机 I  谭／并 l转换 I  DTE  Modem 通信线路Modem  DCE DCE  图3.5串行通信系统 I  并／串l RS-232 I转换｝计 及1算 串／并l机 转换l I  I  I  DTE  在图3.5中，DTE(Data Terminal Equipment)是数据终端设备，它是产生二进制信号的数据 源，也是接收信息的目的地，是由数据发生器或接收器或兼具两者组成的设备，它可以是一台计 算机。DCE(Data Communication Equipment)是数据通信设备，它实质是一个信号的匹配器，既能 满足DTE的要求，又能使传输信号符合线路要求。它具有提供数据终端设备与通信线路之间通 信的建立、维持和终止连接等功能，同时还执行信号变换与编码。它可以是一个Modem（调制解 调器）。DTE与DCE之间传输的是“0”或“1”的数据，通过RS-232C接口规定的各种控制信号， 可实现两者之间的协调配合。 众所周知，计算机之间通信传送的是数字信号，它要求传送的频带很宽，而计算机远程通信 通常是通过载波电话传送的，不可能有这样宽的频带。如果数字信号直接进行通信，经过传输线 后，必然会产生畸变。因此在发送端必须通过调制器将数字信号转换成模拟信号，即对载波电话 线上载波进行调制；而在接收端又必须用解调器检出从发送端来的模拟信号，并恢复为原来的数 字信号。 值得注意的是：RS-232C规定的逻辑电平与计算机系统中TTL和MOS电平不一样。在计算 机系统中，以＋5V代表逻辑“1\"，接地电压代表逻辑“0”。而RS-232C的电气特征规定低电 示逻辑“1\"，并要求低电平为－15~ -3 V；用高电平表示逻辑“0\"，并要求高电平为＋3~ + 15 V，因"}
{"doc_id": "co", "page": 57, "text": "第3章系统总线5l  此使用RS-232C时，必须实现两种电平的转换。 随着计算机网络的发展，现代计算机之间的远距离通信可直接由网卡经网线(8根，双绞线） 传输。 7. USB总线 USB (Universal Serial Bus)通用串行总线是Compaq、DEC、IBM、Intel,Microsoft、NEC(日本）和 Northern Telecom（加拿大）等七大公司于1994年11月联合开发的计算机串行接口总线标准， 1996年1月颁布了USB1.0版本。它基千通用连接技术，实现外设的简单快速连接，达到方便用 户、降低成本、扩展PC接连外设范围的目的。用户可以将几乎所有的外设装置，包括显示器、键 盘、鼠标、打印机、扫描仪、数码相机、U盘、词制解调器等直接插入标准USB插口。还可以将一 些USB外设进行串接，使一大串设备共用PC上的端口。它的主要特点是： 叩具有真正的即插即用特征。用户可以在不关机的情况下很方便地对外设实行安装和 拆卸，主机可按外设的增删情况自动配置系统资源，外设装置驱动程序的安装、删除均自动 实现。 ＠具有很强的连接能力。使用USBHUB(USB集线器）实现系统扩展，最多可链式连接127 个外设到同一系统。图3.6是典型的USB系统拓扑结构。标准USB电缆长度为3m，低速传输 方式时可为5m，通过HUB或中继器可使传输距离达30m。 根层 1层 2层 图3.6典型的USB系统拓扑结构 ＠数据传输率(USB1.0版）有两种，即采用普通无屏蔽双绞线，速度可达1.5Mbps，若用带 屏蔽的双绞线，速度可达12Mbps。USB2.0版的数据传输率最高可达480Mbps。 ＠标准统一。USB的引入减轻了对目前PC中所有标准接口的需求，如串口的鼠标、键盘，"}
{"doc_id": "co", "page": 58, "text": "52 第2篇计算机系统的硬件结构 并口的打印机、扫描仪，IDE接口的硬盘，都可以改成以统一的USB标准接入系统，从而减少了 对PC插槽的需求，节省空间。 ＠连接电缆轻巧，电源体积缩小。USB使用的4芯电缆中的2条用于信号连接，2条用千电 源／地，可为外设提供＋5V的直流电源，方便用户。 ＠生命力强。USB是一种开放性的不具有专利版权的工业标准，它是由一个标准化组织 \"USB实施者论坛＂（该组织由150多家企业组成）制定出来的，因此不存在专利版权问题，USB 规范具有强大的生命力。 3.4 总线结构 总线结构通常可分为单总线结构和多总线结构两种。 1  图3.2是单总线结构的示意，它是将CPU、主存、I/0设备（通过I/0接口）都挂在一组总线 上，允许I/0设备之间、I/0设备与CPU之间或I/0设备与主存之间直接交换信息。这种结构 简单，也便于扩充，但所有的传送都通过这组共享总线，因此极易形成计算机系统的瓶颈。它也 不允许两个以上的部件在同一时刻向总线传输信息，这就必然会影响系统工作效率的提高。这 类总线多数被小型计算机或微型计算机所采用。 随着计算机应用范围不断扩大，其外部设备的种类和数量越来越多，它们对数据传输数量和 传输速度的要求也就越来越高。倘若仍然采用单总线结构，那么，当I/0设备量很大时，总线发 出的控制信号从一端逐个顺序地传递到第n个设备，其传播的延迟时间就会严重地影响系统的 工作效率。在数据传输需求量和传输速度要求不太高的情况下，为克服总线瓶颈问题，尽可能采 用增加总线宽度和提高传输速率来解决；但当总线上的设备，如高速视频显示器、网络传输接口 等，其数据量很大和传输速度要求相当高的时候，单总线结构则不能满足系统工作的需要。因 此，为了根本解决数据传输速率，解决CPU、主存与I/0设备之间传输速率的不匹配，实现CPU 与其他设备相对同步，不得不采用多总线结构。 图3.7是双总线结构的示意图。 双总线结构的特点是将速度较低的I/0设备从单总线上分离出来，形成主存总线与I/0总 线分开的结构。图中通道是一个具有特殊功能的处理器，CPU将一部分功能下放给通道，使其 对I/0设备具有统一管理的功能，以完成外部设备与主存储器之间的数据传送，其系统的吞吐能"}
{"doc_id": "co", "page": 59, "text": "第3章系统总线53  主存总线 CPU 主存通道 I/0总线 图3.7双总线结构 力可以相当大。这种结构大多用于大、中型计算机系统。 如果将速率不同的I/0设备进行分类，然后将它们连接在不同的通道上，那么计算机系统的 工作效率将会更高，由此发展成多总线结构。 图3.8是三总线结构的示意图。 I/0总线 图3.8三总线结构 图3.8中主存总线用于CPU与主存之间的传输；I/0总线供CPU与各类I/0设备之间传递 信息；DMA总线用千高速I/0设备（磁盘、磁带等）与主存之间直接交换信息。在三总线结构中， 任一时刻只能使用一种总线。主存总线与DMA总线不能同时对主存进行存取，I/0总线只有在 CPU执行I/0指令时才能用到。 图3.9是另一种三总线结构的示意图。 由图可见，处理器与Cache（详见4.3节）之间有一条局部总线，它将CPU与Cache或与更多 的局部设备连接。Cache的控制机构不仅将Cache连到局部总线上，而且还直接连到系统总线 上，这样Cache就可通过系统总线与主存传输信息，而且I/0设备与主存之间的传输也不必通过 CPU。还有一条扩展总线，它将局域网、小型计算机接口(SCSI)、调制解调器(Modem)以及串行"}
{"doc_id": "co", "page": 60, "text": "54 第2篇计算机系统的硬件结构 图3.9三总线结构的又一形式 接口等都连接起来，并且通过这些接口又可与各类I/0设备相连，因此它可支持相当多的I/0设 备。与此同时，扩展总线又通过扩展总线接口与系统总线相连，由此便可实现这两种总线之间的 信息传递，可见其系统的工作效率明显提高。 为了进一步提高I/0设备的性能，使其更快地响应命令，又出现了四总线结构，如图 3. 10所示。 扩展总线 图3.10四总线结构 在这里又增加了一条与计算机系统紧密相连的高速总线。在高速总线上挂接了一些高速 I/0设备，如高速局域网、图形工作站、多媒体、SCSI等。它们通过Cache控制机构中的高速总线 桥或高速缓冲器与系统总线和局部总线相连，使得这些高速设备与CPU更密切。而一些较低速 的设备如图文传真FAX、调制解调器及串行接口仍然挂在扩展总线上，并由扩展总线接口与高 速总线相连。"}
{"doc_id": "co", "page": 61, "text": "第3章系统总线55  这种结构对高速设备而言，其自身的工作可以很少依赖CPU，同时它们又比扩展总线上的 设备更贴近CPU，可见对于高性能设备与CPU来说，各自的效率将获得更大的提高。在这种结 构中，CPU、高速总线的速度以及各自信号线的定义完全可以不同，以至各自改变其结构也不会 影响高速总线的正常工作，反之亦然。 图3.11是传统微型计算机的总线结构示意图。 系统总线 33MHz的32位数据通路 标准总线控制器 图3.11传统微型计算机的总线结构 由图3.11中可见，不论高速局域网、高性能图形还是低速的FAX、Modem都挂接在ISA或 EISA总线上，并通过ISA或EISA总线控制器与系统总线相连，这样势必出现总线数据传输的瓶 颈。只有将高速、高性能的外设，如高速局域网卡、高性能图形卡等尽量靠近CPU本身的总线， 并与CPU同步或准同步，才可能消除瓶颈问题。这就要求改变总线结构来提高数据传送速率， 为此，出现了图3.12的VL-BUS局部总线结构。 由图3.12中可见，将原先挂在ISA总线上的高速局域网卡、多媒体卡、高性能图形卡等从 ISA总线卸下来，挂到局部总线VL-BUS上，再与系统总线相连。而将打印机、FAX、Modem等低 速设备仍挂在ISA总线上。局部总线VL-BUS就相当千在CPU与高速1/0设备之间架上了高速 通道，使CPU与高性能外设得到充分发挥，满足了图形界面软件的要求。 由于VL-BUS是从CPU总线演化而来的，与CPU的关系太紧密（实际上这种总线与486配 合最佳），以致很难支持功能更强的CPU，因此出现了PCI总线。"}
{"doc_id": "co", "page": 62, "text": "56 第2篇计算机系统的硬件结构 系统总线 VL-BUS  图3.12VL-BUS局部总线结构 图3.13是PCI总线结构的示意图。 系统总线 图3.13PCI总线结构 由图3.13可见，PCI总线是通过PCI桥路（包括PCI控制器和PCI加速器）与CPU总线相 连。这种结构使CPU总线与PCI总线互相隔离，具有更高的灵活性，可以支持更多的高速运行 设备，而且具有即插即用的特性。当然，挂在PCI总线上的设备都要求数据传输速率高的设备， 如多媒体卡、高速局域网适配器、高性能图形卡等，与高速CPU总线是相匹配的。至于低速的 FAX、Modem、打印机仍然挂在ISA、EISA总线上。 PCI总线驱动能力不足时，可采用多层结构，如图3.14所示。"}
{"doc_id": "co", "page": 63, "text": "第3章系统总线57  存储器总线 第一级桥 I  PCI总线4 PCI设备 第二级桥PCI总线5 PCI总线0 PCI总线3 PCI总线l 第三级桥标准总线回 PCI总线2 图3.14多层PCI总线结构 3.5 总线控制 由于总线上连接着多个部件，什么时候由哪个部件发送信息，如何给信息传送定时，如何防 止信息丢失，如何避免多个部件同时发送，如何规定接收信息的部件等一系列问题都需要由总线 控制器统一管理。它主要包括判优控制（或称仲裁逻辑）和通信控制。 1 制 总线上所连接的各类设备，按其对总线有无控制功能可分为主设备（模块）和从设备（模块） 两种。主设备对总线有控制权，从设备只能响应从主设备发来的总线命令，对总线没有控制权。 总线上信息的传送是由主设备启动的，如某个主设备欲与另一个设备（从设备）进行通信时，首 先由主设备发出总线请求信号，若多个主设备同时要使用总线时，就由总线控制器的判优、仲裁 逻辑按一定的优先等级顺序确定哪个主设备能使用总线。只有获得总线使用权的主设备才能开 始传送数据。 总线判优控制可分集中式和分布式两种，前者将控制逻辑集中在一处（如在CPU中），后者 将控制逻辑分散在与总线连接的各个部件或设备上。 常见的集中控制优先权仲裁方式有以下三种。 (1)链式查询 链式查询方式如图3.15(a)所示。图中控制总线中有3根线用千总线控制(BS总线"}
{"doc_id": "co", "page": 64, "text": "58 第2篇计算机系统的硬件结构 忙、BR总线请求、BG总线同意），其中总线同意信号BG是串行地从一个I/0接口送到下 一个I/0接口。如果BG到达的接口有总线请求，BG信号就不再往下传，意味着该接口获 得了总线使用权，并建立总线忙BS信号，表示它占用了总线。可见在链式查询中，离总线 控制部件最近的设备具有最高的优先级。这种方式的特点是：只需很少几根线就能按一定 优先次序实现总线控制，并且很容易扩充设备，但对电路故障很敏感，且优先级别低的设备 可能很难获得请求。 BS  数据线 地址线 总线控制部件 BR  (a)链式查询方式 总线控制部件 腔 BR  数据线 地址线 设备地址线 (b)计数器定时查询方式 总线控制部件BGn  B凡 地址线 数据线 图3.15 (c)独立请求方式 集中控制的三种优先权仲裁方式 (2)计数器定时查询 计数器定时查询方式如图3.15(b)所示。与图3.15(a)相比，多了一组设备地址线，少了一 根总线同意线BG。总线控制部件接到由BR送来的总线请求信号后，在总线未被使用(BS=0)"}
{"doc_id": "co", "page": 65, "text": "第3章系统总线59  的情况下，总线控制部件中的计数器开始计数，并通过设备地址线，向各设备发出一组地址信号。 当某个请求占用总线的设备地址与计数值一致时，便获得总线使用权，此时终止计数查询。这种 方式的特点是：计数可以从“0“开始，此时一旦设备的优先次序被固定，设备的优先级就按 0, 1,…，n的顺序降序排列，而且固定不变；计数也可以从上一次计数的终止点开始，即是一种循 环方法，此时设备使用总线的优先级相等；计数器的初始值还可由程序设置，故优先次序可以改 变。这种方式对电路故障不如链式查询方式敏感，但增加了控制线（设备地址）数，控制也较 复杂。 (3)独立请求方式 独立请求方式如图3.15(c)所示。由图中可见，每一台设备均有一对总线请求线BR;和总 线同意线BGi。当设备要求使用总线时，便发出该设备的请求信号。总线控制部件中有一排队 电路，可根据优先次序确定响应哪一台设备的请求。这种方式的特点是：响应速度快，优先次序 控制灵活（通过程序改变），但控制线数量多，总线控制更复杂。链式查询中仅用两根线确定总 线使用权属千哪个设备，在计数器查询中大致用log2n根线，其中n是允许接纳的最大设备数，而 独立请求方式需采用2n根线。 制 众多部件共享总线，在争夺总线使用权时，应按各部件的优先等级来解决。在通信时间 上，则应按分时方式来处理，即以获得总线使用权的先后顺序分时占用总线，即哪一个部件获 得使用权，此刻就由它传送，下一部件获得使用权，接着下一时刻传送。这样一个接一个轮流 交替传送。 通常将完成一次总线操作的时间称为总线周期，可分为以下4个阶段。 心申请分配阶段：由需要使用总线的主模块（或主设备）提出申请，经总线仲裁机构决定下 一传输周期的总线使用权授于某一申请者。 ＠寻址阶段：取得了使用权的主模块通过总线发出本次要访问的从模块（或从设备）的地址 及有关命令，启动参与本次传输的从模块。 ＠传数阶段：主模块和从模块进行数据交换，数据由源模块发出，经数据总线流入目 的模块。 ＠结束阶段：主模块的有关信息均从系统总线上撤除，让出总线使用权。 对于仅有一个主模块的简单系统，无须申请、分配和撤除，总线使用权始终归它占有。对千 包含中断、DMA控制或多处理器的系统，还需要有其他管理机构来参与。 总线通信控制主要解决通信双方如何获知传输开始和传输结束，以及通信双方如何协调如 何配合。通常用四种方式：同步通信、异步通信、半同步通信和分离式通信。 1.同步通信 通信双方由统一时标控制数据传送称为同步通信。时标通常由CPU的总线控制部件发出，"}
{"doc_id": "co", "page": 66, "text": "60 第2篇计算机系统的硬件结构 送到总线上的所有部件；也可以由每个部件各自的时序发生器发出，但必须由总线控制部件发出 的时钟信号对它们进行同步。 图3.16表示某个输入设备向CPU传输数据的同步通信过程。 总线传输周期 时钟 |--T1 -1 _T2 _| _-T3 _ 1 -- T4 -I  I I I I  地址孜' I I 》任乡 I I  读命令厂777对!  I I  数据／ 图3.16同步式数据输入传输 图中总线传输周期是连接在总线上的两个部件完成一次完整且可靠的信息传输时间，它包 含4个时钟周期Tl、T心兀、T吓 CPU在兀上升沿发出地址信息；在兀的上升沿发出读命令；与地址信号相符合的输入设备 按命令进行一系列内部操作，且必须在兀的上升沿到来之前将CPU所需的数据送到数据总线 上；CPU在兀时钟周期内，将数据线上的信息送到其内部寄存器中；CPU在兀的上升沿撤销读 命令，输入设备不再向数据总线上传送数据，撤销它对数据总线的驱动。如果总线采用三态驱动 电路，则从兀起，数据总线呈浮空状态。 同步通信在系统总线设计时，对Tl、T2、T\"兀都有明确、唯一的规定。 对于读命令，其传输周期如下： 兀主模块发地址。 兀主模块发读命令。 兀从模块提供数据。 兀主模块撤销读命令，从模块撤销数据。 对于写命令，其传输周期如下： 仇主模块发地址。 兀主模块提供数据。 兀主模块发出写命令，从模块接收到命令后，必须在规定时间内将数据总线上的数据写到 地址总线所指明的单元中。 兀主模块撤销写命令和数据等信号。 写命令传输周期的时序如图3.17所示。"}
{"doc_id": "co", "page": 67, "text": "第3章系统总线61  总线传输周期 时钟 一二1_-T2 -1二T3_-I -- T4二1 I I  地址次1 1 1 泛今乡 数据／4 }  写命令V/／/／，Z\\} I  ｝元元刁 图3.17同步式数据输出传输 这种通信的优点是规定明确、统一，模块间的配合简单一致。其缺点是主、从模块时间配合 属千强制性”同步”，必须在限定时间内完成规定的要求。并且对所有从模块都用同一限时，这 就势必造成，对各不相同速度的部件而言，必须按最慢速度的部件来设计公共时钟，严重影响总 线的工作效率，也给设计带来了局限性，缺乏灵活性。 同步通信一般用千总线长度较短、各部件存取时间比较一致的场合。 在同步通信的总线系统中，总线传输周期越短，数据线的位数越多，直接影响总线的数据传 输率。 例3.1假设总线的时钟频率为100MHz，总线的传输周期为4个时钟周期，总线的宽度为 32位，试求总线的数据传输率。若想提高一倍数据传输率，可采取什么措施？ 解：根据总线时钟频率为100MHz，得 1个时钟周期为1/100MHz= 0.01 µs  总线传输周期为0.01µsx4 = 0.04 µs  由于总线的宽度为32位＝4B（字节） 故总线的数据传输率为4B/(0.04 µs)= 100 MBps  若想提高一倍数据传输率，可以在不改变总线时钟频率的前提下，将数据线的宽度改为64 位，也可以仍保持数据宽度为32位，但使总线的时钟频率增加到200MHz。 2.异步通信 异步通信克服了同步通信的缺点，允许各模块速度的不一致性，给设计者充分的灵活性和选 择余地。它没有公共的时钟标准，不要求所有部件严格的统一操作时间，而是采用应答方式（又 称握手方式），即当主模块发出请求(Request)信号时，一直等待从模块反馈回来“响应”(Ac­ knowledge)信号后才开始通信。当然，这就要求主、从模块之间增加两条应答线（握手交互信号 线Handshaking)。 异步通信的应答方式又可分为不互锁、半互锁和全互锁三种类型，如图3.18所示。 (1)不互锁方式 主模块发出请求信号后，不必等待接到从模块的回答信号，而是经过一段时间，确认从模块"}
{"doc_id": "co", "page": 68, "text": "62 第2篇计算机系统的硬件结构 二：：丁1回青：三产了1回青：：： (a)不互锁(b)半互锁(c)全互锁 图3.18异步通信中请求与回答的互锁 巳收到请求信号后，便撤销其请求信号；从模块接到请求信号后，在条件允许时发出回答信号，并 且经过一段时间（这段时间的设置对不同设备而言是不同的）确认主模块已收到回答信号后，自 动撤销回答信号。可见通信双方并无互锁关系。例如，CPU向主存写信息，CPU要先后给出地 址信号、写命令以及写入数据，即采用此种方式。 (2)半互锁方式 主模块发出请求信号，必须待接到从模块的回答信号后再撤销其请求信号，有互锁关系； 而从模块在接到请求信号后发出回答信号，但不必等待获知主模块的请求信号已经撤销，而 是隔一段时间后自动撤销其回答信号，无互锁关系。由千一方存在互锁关系，一方不存在互 锁关系，故称半互锁方式。例如，在多机系统中，某个CPU需访问共享存储器（供所有CPU访 问的存储器）时，该CPU发出访存命令后，必须收到存储器未被占用的回答信号，才能真正进 行访存操作。 (3)全互锁方式 主模块发出请求信号，必须待从模块回答后再撤销其请求信号；从模块发出回答信号，必须 待获知主模块请求信号已撤销后，再撤销其回答信号。双方存在互锁关系，故称为全互锁方式。 例如，在网络通信中，通信双方采用的就是全互锁方式。 异步通信可用千并行传送或串行传送。异步并行通信可参见图5.6，图中“Ready”和 \"Strobe”就是联络信号。异步串行通信时，没有同步时钟，也不需要在数据传送中传送同步信 号。为了确认被传送的字符，约定字符格式为：1个起始位（低电平）、5~8个数据位（如ASCII 码为7位）、1个奇偶校验位（作检错用）、1或1.5或2个终止位（高电平）。传送时起始位后 面紧跟的是要传送字符的最低位，每个字符的结束是一个高电平的终止位。起始位至终止位 构成一帧，两帧之间的间隔可以是任意长度的。图3.19是两种数据传输率的异步串行传送格 式，其中图3.19(a)两帧之间有空闲位（高电平），而图3.19(b)两帧之间无空闲位，故数据传 输率更高。 异步串行通信的数据传送速率用波特率来衡量。波特率是指单位时间内传送二进制数据的 位数，单位用bps（位／秒）表示，记作波特。 例3.2在异步串行传输系统中，假设每秒传输120个数据帧，其字符格式规定包含1个起 始位、7个数据位、1个奇校验位、1个终止位，试计算波特率。 解：根据题目给出的字符格式，一帧包含1+7+1+1=10位"}
{"doc_id": "co", "page": 69, "text": "第3章系统总线 一帧，第n个字符第(n+l)个字符 MARK  终止位或1起终起 下一个字符 空闲位?§ 8位数据晶心盎空闲位：—— 勹lI叫叫叫叫叫叫oi仆叫 一位时间取低位高位下降沿指出下 决于波特率（先）（后）一字符的开始 第(n-l)个字符..  终起 晶点1嚣 低位 (a)小千最高数据传送率 第n个字符第(n+l)个字符 晶：『 高位下降沿指出下 一字符的开始 (b)最高数据传送率 图3.19两种传输率的异步串行传送字符格式 故波特率为(1+ 7 + 1 + 1) X 120 = 1 200 bps = 1 200波特 63  例3.3画图说明用异步串行传输方式发送十六进制数据95H。要求字符格式为：1位起始 位、8位数据位、1位偶校验位、1位终止位。 解：异步串行传送在起始位之后传输的是数据位的最低位(95H的最低位D。=1)，而且数据 位的最高位(95H的最高位几＝1）传输之后传输校验位，最后是终止位。数据95H的偶校验位 为0，其波形图如图3.20所示。 起 I始ID。IDl I D2 |趴|D4I D5 I D6 ID  校停 位 I D6 I D7 Ii I止 位位 图3.20数据95H的传送波形 由千异步串行通信字符格式中包含若千附加位，如起始位、终止位、校验位，而且终止位又有 1位、1.5位、2位之分，若只考虑有效数据位，可用比特率来衡量异步串行通信的数据传输速率， 即单位时间内传送二进制有效数据的位数，单位用bps表示。"}
{"doc_id": "co", "page": 70, "text": "64 第2篇计算机系统的硬件结构 为了提高速度，将异步串行传送中这些附加位去掉，就可以采用同步传送，在同步传送时，数 拟块开始处要用同步字符SYN来指明，如图3.21所示。 讥I-1圆＿厂皿叩皿工 仁l SYN字符1SYN字符2数据 图3.21同步串行传送格式 同步串行传送速度高千异步串行传送速度，可达500千波特，而异步通信传送一般为50~ 19 200波特。 例3.4在异步串行传输系统中，若字符格式为：1位起始位、8位数据位、1位奇校验位、1位 终止位。假设波特率为1200 bps，求这时的比特率。 解：根据题目给出的字符格式，有效数据位为8位，而传送一个字符需1+8+1+1=11位，故 比特率为 1 200x (8/11) = 872.72 bps  3.半同步通信 半同步通信既保留了同步通信的基本特点，如所有的地址、命令、数据信号的发出时间，都严 格参照系统时钟的某个前沿开始，而接收方都采用系统时钟后沿时刻来进行判断识别；同时又像 异步通信那样，允许不同速度的模块和谐地工作。为此增设了一条”等待\"(WAIT)响应信号线， 采用插入时钟（等待）周期的措施来协调通信双方的配合问题。 仍以输入为例，在同步通信中，主模块在兀发出地址，在兀发出命令，在兀传输数据，在T4 结束传输。倘若从模块工作速度较慢，无法在兀时刻提供数据，则必须在兀到来前通知主模 块，给出WAIT（低电平）信号。若主模块在兀到来时刻测得wAIT为低电平，就插入一个等待 周期八（其宽度与时钟周期一致），不立即从数据线上取数。若主模块在下一个时钟周期到来时 刻又测得wAIT为低，就再插入一个兀等待，这样一个时钟周期、一个时钟周期地等待，直到 主模块测得wAIT为高电平时，主模块即把此刻的下一个时钟周期当作正常周期T3，即时获取 数据，兀结束传输。 插入等待周期的半同步通信数据输入过程如图3.22所示。 由图中可见，半同步通信时序可为以下形式。 仇主模块发出地址信息。 兀主模块发出命令。 八当WAIT为低电平时，进入等待，八的宽度与T的宽度一致。"}
{"doc_id": "co", "page": 71, "text": "第3章系统总线65  总线传输周期 时钟 |--Tl --T2 _| _-Tw -1 -TW _-I -T3 -I -T4」 地址爷《I I I I l 习壬笠 读命令厂777讨l l l /)/z///）/／饥 WAIT  数据 图3.22半同步通信数据输入过程 兀从模块提供数据。 兀主模块撤销读命令，从模块撤销数据。 半同步通信适用于系统工作速度不高但又包含了由许多工作速度差异较大的各类设备组成 的简单系统。半同步通信控制方式比异步通信简单，在全系统内各模块又在统一的系统时钟控 制下同步工作，可靠性较高，同步结构较方便。其缺点是对系统时钟频率不能要求太高，故从整 体上来看，系统工作的速度还不是很高。 4.分离式通信 以上三种通信方式都是从主模块发出地址和读写命令开始，直到数据传输结束。在整个传 输周期中，系统总线的使用权完全由占有使用权的主模块和由它选中的从模块占据。进一步分 析读命令传输周期，发现除了申请总线这一阶段外，其余时间主要花费在如下3个方面。 叩主模块通过传输总线向从模块发送地址和命令。 ＠从模块按照命令进行读数据的必要准备。 ＠从模块经数据总线向主模块提供数据。 由＠可见，对系统总线而言，从模块内部读数据过程并无实质性的信息传输，总线纯属空闲 等待。为了克服和利用这种消极等待，尤其在大型计算机系统中，总线的负载巳处于饱和状态， 充分挖掘系统总线每瞬间的潜力，对提高系统性能起到极大作用。为此人们又提出了“分离式” 的通信方式，其基本思想是将一个传输周期（或总线周期）分解为两个子周期。在第一个子周期 中，主模块A在获得总线使用权后将命令、地址以及其他有关信息，包括该主模块编号（当有多 个主模块时，此编号尤为重要）发到系统总线上，经总线传输后，由有关的从模块B接收下来。 主模块A向系统总线发布这些信息只占用总线很短的时间，一旦发送完，立即放弃总线使用权， 以便其他模块使用。在第二个子周期中，当B模块收到A模块发来的有关命令信号后，经选择、 译码、读取等一系列内部操作，将A模块所需的数据准备好，便由B模块申请总线使用权，一 旦获准，B模块便将A模块的编号、B模块的地址、A模块所需的数据等一系列信息送到总线"}
{"doc_id": "co", "page": 72, "text": "66 第2篇计算机系统的硬件结构 上，供A模块接收。很明显，上述两个传输子周期都只有单方向的信息流，每个模块都变成了 主模块。 这种通信方式的特点如下： 心各模块欲占用总线使用权都必须提出申请。 ＠在得到总线使用权后，主模块在限定的时间内向对方传送信息，采用同步方式传送，不再 等待对方的回答信号。 ＠各模块在准备数据的过程中都不占用总线，使总线可接受其他模块的请求。 ＠总线被占用时都在做有效工作，或者通过它发送命令，或者通过它传送数据，不存在空闲 等待时间，充分地利用了总线的有效占用，从而实现了总线在多个主、从模块间进行信息交叉重 叠并行式传送，这对大型计算机系统是极为重要的。 当然，这种方式控制比较复杂，一般在普通微型计算机系统很少采用。 题与习题 3.1 什么是总线？总线传输有何特点？为了减轻总线的负载，总线上的部件都应具备什么特点？ 3.2 总线如何分类？什么是系统总线？系统总线又分为几类，它们各有何作用，是单向的，还是双向的，它 们与机器字长、存储字长、存储单元有何关系？ 3.3 常用的总线结构有几种？不同的总线结构对计算机的性能有什么影响？举例说明。 3.4 为什么要设置总线判优控制？常见的集中式总线控制有几种，各有何特点，哪种方式响应时间最快， 哪种方式对电路故障最敏感？ 3.5 解释概念：总线宽度、总线带宽、总线复用、总线的主设备（或主模块）、总线的从设备（或从模块）、总线 的传输周期、总线的通信控制。 3.6 试比较同步通信和异步通信。 3.7 画图说明异步通信中请求与回答有哪几种互锁关系。 3.8 为什么说半同步通信同时保留了同步通信和异步通信的特点？ 3.9 分离式通信有何特点？主要用于什么系统？ 3.10 什么是总线标准？为什么要设置总线标准？目前流行的总线标准有哪些？什么是即插即用，哪些总 线有这一特点？ 3.11 画一个具有双向传送功能的总线逻辑图。 3.12 设数据总线上接有A、B、C、D4个寄存器，要求选用合适的74系列芯片，完成下列逻辑设计： (1)设计一个电路，在同一时间实现D一A、D----+B和D----+C寄存器间的传送。 (2)设计一个电路，实现下列操作。 兀时刻完成D----+总线。 兀时刻完成总线----+A。 兀时刻完成A----+总线。 兀时刻完成总线----+B。 3.13 什么是总线的数据传送速率，它与哪些因素有关？"}
{"doc_id": "co", "page": 73, "text": "第3章系统总线67  3.14 设总线的时钟频率为8MHz，一个总线周期等于一个时钟周期。如果一个总线周期中并行传送16位 数据，试间总线的带宽是多少？ 3.15 在一个32位的总线系统中，总线的时钟频率为66MHz，假设总线最短传输周期为4个时钟周期，试 计算总线的最大数据传输率。若想提高数据传输率，可采取什么措施？ 3.16 在异步串行传送系统中，字符格式为：1个起始位、8个数据位、1个校验位、2个终止位。若要求每秒 传送120个字符，试求传送的波特率和比特率。"}
{"doc_id": "co", "page": 74, "text": "本章重点介绍主存储器的分类、工作原理、组成方式以及与其他部件（如CPU)的联系。此 外还介绍了高速缓冲存储器、磁表面存储器等的基本组成和工作原理。旨在使读者真正建立起 如何用不同的存储器组成具有层次结构的存储系统的概念。 4.1 概述 存储器分 存储器是计算机系统中的记忆设备，用来存放程序和数据。随着计算机发展，存储器在系统 中的地位越来越重要。由千超大规模集成电路的制作技术，使CPU的速度变得惊人的高，而存 储器的取数和存数的速度与它很难适配，这使计算机系统的运行速度在很大程度上受存储器速 度的制约。此外，由于I/0设备不断增多，如果它们与存储器交换信息都通过CPU来实现，这将 大大降低CPU的工作效率。为此，出现了I/0与存储器的直接存取方式(DMA)，这也使存储器 的地位更为突出。尤其在多处理机的系统中，各处理机本身都需与其主存交换信息，而且各处理 机在互相通信中，也都需共享存放在存储器中的数据。因此，存储器的地位就更为显要。可见， 从某种意义而言，存储器的性能已成为计算机系统的核心。 当今，存储器的种类繁多，从不同的角度对存储器可作不同的分类。 1.按存储介质分类 存储介质是指能寄存“O\"\"1”两种代码并能区别两种状态的物质或元器件。存储介质主要 有半导体器件、磁性材料和光盘等。 (1)半导体存储器 存储元件由半导体器件组成的存储器称为半导体存储器。现代半导体存储器都用超大规模 集成电路工艺制成芯片，其优点是体积小、功耗低、存取时间短。其缺点是当电源消失时，所存信 息也随即丢失，它是一种易失性存储器。近年来已研制出用非挥发性材料制成的半导体存储器， 克服了信息易失的弊病。 半导体存储器又可按其材料的不同，分为双极型(TTL)半导体存储器和MOS半导体存储器 两种。前者具有高速的特点；后者具有高集成度的特点，并且制造简单，成本低廉，功耗小，故"}
{"doc_id": "co", "page": 75, "text": "第4章存储器69  MOS半导体存储器被广泛应用。 (2)磁表面存储器 磁表面存储器是在金属或塑料基体的表面上涂一层磁性材料作为记录介质，工作时磁层随 载磁体高速运转，用磁头在磁层上进行读／写操作，故称为磁表面存储器。按载磁体形状的不同， 可分为磁盘、磁带和磁鼓。现代计算机已很少采用磁鼓。由千用具有矩形磁滞回线特性的材料 作磁表面物质，它们按其剩磁状态的不同而区分“0”或“1”，而且剩磁状态不会轻易丢失，故这类 存储器具有非易失性的特点。 (3)磁芯存储器 磁芯是由硬磁材料做成的环状元件，在磁芯中穿有驱动线（通电流）和读出线，这样便可进 行读／写操作。磁芯属磁性材料，故它也是不易失的永久记忆存储器。不过，磁芯存储器的体积 过大、工艺复杂、功耗太大，故20世纪70年代后，逐渐被半导体存储器取代，目前几乎已不被 采用。 (4)光盘存储器 光盘存储器是应用激光在记录介质（磁光材料）上进行读／写的存储器，具有非易失性的特 点。由千光盘记录密度高、耐用性好、可靠性高和可互换性强等特点，光盘存储器越来越被用于 计算机系统。 2.按存取方式分类 按存取方式可把存储器分为随机存储器、只读存储器、顺序存取存储器和直接存取存储器。 (1)随机存储器(RandomAccess Memory, RAM)  RAM是一种可读／写存储器，其特点是存储器的任何一个存储单元的内容都可以随机存取， 而且存取时间与存储单元的物理位置无关。计算机系统中的主存都采用这种随机存储器。由于 存储信息原理的不同，RAM又分为静态RAM（以触发器原理寄存信息）和动态RAM（以电容充 放电原理寄存信息）。 (2)只读存储器(ReadOnly Memol'y-, ROM)  只读存储器是能对其存储的内容读出，而不能对其重新写入的存储器。这种存储器一旦存 入了原始信息后，在程序执行过程中，只能将内部信息读出，而不能随意重新写入新的信息去改 变原始信息。因此，通常用它存放固定不变的程序、常数和汉字字库，甚至用于操作系统的固化。 它与随机存储器可共同作为主存的一部分，统一构成主存的地址域。 早期只读存储器的存储内容根据用户要求，厂家采用掩模工艺，把原始信息记录在芯片中， 一旦制成后无法更改，称为掩模型只读存储器(MaskedROM, MROM)。随着半导体技术的发展 和用户需求的变化，只读存储器先后派生出可编程只读存储器(ProgrammableROM, PROM)、 可擦除可编程只读存储器(ErasableProgrammable ROM, EPROM)以及电擦除可编程只读存储器 (Electrically -Erasable Programmable ROM, EEPROM)。近年来还出现了闪速存储器Flash Memory，它具有EEPROM的特点，而速度比EEPROM快得多。"}
{"doc_id": "co", "page": 76, "text": "70 第2篇计算机系统的硬件结构 (3)串行访问存储器 如果对存储单元进行读／写操作时，需按其物理位置的先后顺序寻找地址，则这种存储器称 为串行访问存储器。显然这种存储器由千信息所在位置不同，使得读／写时间均不相同。例如， 磁带存储器，不论信息处在哪个位置，读／写时必须从其介质的始端开始按顺序寻找，故这类串行 访间的存储器又称为顺序存取存储器。还有一种属千部分串行访问的存储器，如磁盘。在对磁 盘读／写时，首先直接指出该存储器中的某个小区域（磁道），然后再顺序寻访，直至找到位置。 故其前段是直接访间，后段是串行访问，称为直接存取存储器。 3.按在计算机中的作用分类 按在计算机系统中的作用不同，存储器主要分为主存储器、辅助存储器、缓冲存储器。 主存储器（简称主存）的主要特点是它可以和CPU直接交换信息。辅助存储器（简称辅存） 是主存储器的后援存储器，用来存放当前暂时不用的程序和数据，它不能与CPU直接交换信息。 两者相比，主存速度快、容量小、每位价格高；辅存速度慢、容量大、每位价格低。缓冲存储器（简 称缓存）用在两个速度不同的部件之中，例如，CPU与主存之间可设置一个快速缓存（有关内容 将在4.3节中讲述），起到缓冲作用。 综上所述，存储器分类如图4.1所示。 存储器 RAMRAMOMMOMROM 归麟 MRPROEPREEP IIfl  匐 类 叩分 』 g 器器器 储 em  储储 存 M sh 盘带盘 存存 la 磁磁光 机读随只 CF{Q1i h4 ac 图 ＼器 储 CC 存 存速存存主闪辅缓 存储器有3个主要性能指标：速度、容量和每位价格（简称位价）。一般来说，速度越高， 位价就越高；容量越大，位价就越低，而且容量越大，速度必越低。人们追求大容量、高速度、 低位价的存储器，可惜这是很难达到的。图4.2形象地反映了上述三者的关系。图中由上至 下，位价越来越低，速度越来越慢，容量越来越大，CPU访问的频度也越来越少。最上层的寄 存器通常都制作在CPU芯片内。寄存器中的数直接在CPU内部参与运算，CPU内可以有十 几个、几十个寄存器，它们的速度最快，位价最高，容量最小。主存用来存放将要参与运行的"}
{"doc_id": "co", "page": 77, "text": "第4章存储器71  程序和数据，其速度与CPU速度差距较大，为了使它们之间速度更好地匹配，在主存与CPU 之间插入了一种比主存速度更快、容量更小的高速缓冲存 储器Cache，显然其位价要高千主存。以上三类存储器都 是由速度不同、位价不等的半导体存储材料制成的，它们 都设在主机内。现代计算机将Cache也制作在CPU内。 磁盘、磁带属于辅助存储器，其容量比主存大得多，大都用 来存放暂时未用到的程序和数据文件。CPU不能直接访/ 磁带 间辅存，辅存只能与主存交换信息，因此辅存的速度可以图4.2存储器速度、容量和 比主存慢得多。位价的关系 实际上，存储系统层次结构主要体现在缓存－主存和主 存－辅存这两个存储层次上，如图4.3所示。显然，CPU和缓存、主存都能直接交换信息；缓存能 直接和CPU、主存交换信息；主存可以和CPU、缓存、辅存交换信息。 图4.3缓存－主存层次和主存－辅存层次 缓存－主存层次主要解决CPU和主存速度不匹配的间题。由千缓存的速度比主存的速度 高，只要将CPU近期要用的信息调入缓存，CPU便可以直接从缓存中获取信息，从而提高访存速 度。但由千缓存的容量小，因此需不断地将主存的内容调入缓存，使缓存中原来的信息被替换 掉。主存和缓存之间的数据调动是由硬件自动完成的，对程序员是透明的。 主存－辅存层次主要解决存储系统的容量问题。辅存的速度比主存的速度低，而且不能和 CPU直接交换信息，但它的容量比主存大得多，可以存放大量暂时未用到的信息。当CPU需要 用到这些信息时，再将辅存的内容调入主存，供CPU直接访问。主存和辅存之间的数据调动是 由硬件和操作系统共同完成的。 从CPU角度来看，缓存－主存这一层次的速度接近于缓存，高于主存；其容量和位价却接近 千主存，这就从速度和成本的矛盾中获得了理想的解决办法。主存－辅存这一层次，从整体分 析，其速度接近于主存，容量接近千辅存，平均位价也接近千低速、廉价的辅存位价，这又解决了 速度、容量、成本这三者的矛盾。现代的计算机系统几乎都具有这两个存储层次，构成了缓存、主 存、辅存三级存储系统。 在主存－辅存这一层次的不断发展中，逐渐形成了虚拟存储系统。在这个系统中，程序员 编程的地址范围与虚拟存储器的地址空间相对应。例如，机器指令地址码为24位，则虚拟存 储器存储单元的个数可达16M。可是这个数与主存的实际存储单元的个数相比要大得多，称"}
{"doc_id": "co", "page": 78, "text": "72 第2篇计算机系统的硬件结构 这类指令地址码为虚地址（虚存地址、虚拟地址）或逻辑地址，而把主存的实际地址称为物理 地址或实地址。物理地址是程序在执行过程中能够真正访问的地址，也是实实在在的主存地 址。对具有虚拟存储器的计算机系统而言，程序员编程时，可用的地址空间远远大于主存 空间，使程序员以为自己占有一个容量极大的主存，其实这个主存并不存在，这就是将其称 为虚拟存储器的原因。对虚拟存储器而言，其逻辑地址变换为物理地址的工作是由计算机 系统的硬件和操作系统自动完成的，对程序员是透明的。当虚地址的内容在主存时，机器 便可立即使用；若虚地址的内容不在主存，则必须先将此虚地址的内容传递到主存的合适 单元后再为机器所用。有关这些方面的内容，读者可在”计算机体系结构”和“操作系统” 课程中学到。 4.2 主存储器 1 概述 主存储器（简称主存）的基本结构已在第1章介绍过，如图1.11所示。实际上，根据 MAR中的地址访问某个存储单元时，还需经过地址译码、驱动等电路，才能找到所需访问 的单元。读出时，需经过读出放大器，才能将被选中单元的存储字送到MDR。写入时， MDR中的数据也必须经过写入电路才能真正写入被选中的单元中。可见，主存的实际结 构如图4.4所示。 图4.4主存的基本组成"}
{"doc_id": "co", "page": 79, "text": "第4章存储器73  现代计算机的主存都由半导体集成电路构成，图中的驱动器、译码器和读写电路均制作在存 储芯片中，而MAR和MDR制作在CPU芯片内。存储芯 片和CPU芯片可通过总线连接，如图4.5所示。 当要从存储器读出某一信息字时，首先由CPU将 该字的地址送到MAR，经地址总线送至主存，然后发I CPU I 写] 主存 出读命令。主存接到读命令后，得知需将该地址单元 的内容读出，便完成读操作，将该单元的内容读至数 据总线上，至于该信息由MDR送至什么地方，这已不图4.5主存和CPU的联系 是主存的任务，而是由CPU决定的。若要向主存存 入一个信息字时，首先CPU将该字所在主存单元的地址经MAR送到地址总线，并将信息 字送入MDR，然后向主存发出写命令，主存接到写命令后，便将数据线上的信息写入对应 地址线指出的主存单元中。 l．主存中存储单元地址的分配 主存各存储单元的空间位置是由单元地址号来表示的，而地址总线是用来指出存储单元地 址号的，根据该地址可读出或写入一个存储字。不同的机器存储字长也不同，为了满足字符处理 的需要，常用8位二进制数表示一个字节，因此存储字长都取8的倍数。通常计算机系统既可按 字寻址，也可按字节寻址。例如IBM370机的字长为32位，它可按字节寻址，即它的每一个存储 字包含4个可独立寻址的字节，其地址分配如图4.6(a)所示。字地址是用该字高位字节的地址 来表示，故其字地址是4的整数倍，正好用地址码的末两位来区分同一字的4个字节的位置。但 对PDP-11机而言，其字长为16位，字地址是2的整数倍，它用低位字节的地址来表示字地址， 如图4.6(b)所示。 字节地址 字地址 。 4  8  尸 址 024 地 字 (a) IBM370  图4.6字节寻址的主存地址分配 (b) PDP-11  由图4.6(a)所示，对24位地址线的主存而言，按字节寻址的范围是16M，按字寻址的范围 为4M。由图4.6(b)所示，对24位地址线而言，按字节寻址的范围仍为16M，但按字寻址的范 围为8M。 2.主存的技术指标 主存的主要技术指标是存储容量和存储速度。"}
{"doc_id": "co", "page": 80, "text": "74 第2篇计算机系统的硬件结构 (1)存储容量 存储容量是指主存能存放二进制代码的总位数，即 存储容量＝存储单元个数X存储字长 它的容量也可用字节总数来表示，即 存储容量＝存储单元个数X存储字长／8 目前的计算机存储容量大多以字节数来表示，例如，某机主存的存储容量为256MB，则按字 节寻址的地址线位数应对应28位。 (2)存储速度 存储速度是由存取时间和存取周期来表示的。 存取时间又称为存储器的访问时间(MemoryAccess Time)，是指启动一次存储器操作（读或 写）到完成该操作所需的全部时间。存取时间分读出时间和写入时间两种。读出时间是从存储 器接收到有效地址开始，到产生有效输出所需的全部时间。写入时间是从存储器接收到有效地 址开始，到数据写入被选中单元为止所需的全部时间。 存取周期(MemoryCycle Time)是指存储器进行连续两次独立的存储器操作（如连续两次读 操作）所需的最小间隔时间，通常存取周期大千存取时间。现代MOS型存储器的存取周期可达 100 ns；双极型TTL存储器的存取周期接近于10ns。 (3)存储器带宽 与存取周期密切相关的指标为存储器带宽，它表示单位时间内存储器存取的信息量，单位可 用字／秒或字节／秒或位／秒表示。如存取周期为500ns，每个存取周期可访问16位，则它的带宽 为32M位／秒。带宽是衡量数据传输率的重要技术指标。 存储器的带宽决定了以存储器为中心的机器获得信息的传输速度，它是改善机器瓶颈的 个关键因素。为了提高存储器的带宽，可以采用以下措施： 心缩短存取周期。 ＠增加存储字长，使每个存取周期可读／写更多的二进制位数。 ＠增加存储体（详见4.2.7节）。 片简介 l．半导体存储芯片的基本结构 半导体存储芯片采用超大规模集成电路制造工艺，在一个芯片内集成具有记忆功能的存储 矩阵、译码驱动电路和读／写电路等，如图4.7所示。 译码驱动能把地址总线送来的地址信号翻译成对应存储单元的选择信号，该信号在读／写电 路的配合下完成对被选中单元的读／写操作。 读／写电路包括读出放大器和写入电路，用来完成读／写操作。 存储芯片通过地址总线、数据总线和控制总线与外部连接。"}
{"doc_id": "co", "page": 81, "text": "第4章存储器75  勹勹＼线 地址线选 片 存储矩阵 线 制 控 /  数据线写 ＼—\\~卖尸丿＼ 图4.7存储芯片的基本结构 地址线是单向输入的，其位数与芯片容量有关。 数据线是双向的（有的芯片可用成对出现的数据线分别作为输入或输出），其位数与芯片可 读出或写入的数据位数有关。数据线的位数与芯片容量有关。 地址线和数据线的位数共同反映存储芯片的容量。例如，地址线为10根，数据线为4根，则 芯片容量为210x4=4K位；又如地址线为14根，数据线为1根，则其容量为16K位。 控制线主要有读／写控制线与片选线两种。不同存储芯片的读／写控制线和片选线可以不 同。有的芯片的读／写控制线共用1根（如2114)，有的分用两根（如6264)；有的芯片的片选线 用1根（如2114)，有的用2根（如6264)。读／写控制线决定芯片进行读／写操作，片选线用来选 择存储芯片。由千半导体存储器是由许多芯片组成的，为此需用片选信号来确定哪个芯片被选 中。例如，一个64Kx8位的存储器可由32片16Kxl位的存储芯片组成，如图4.8所示。但每 次读出一个存储字时，只需选中8片。 16KX1位16KX1位16KX1位16KX1位 8片8片8片8片 图4.864 Kx8位的存储器 2.半导体存储芯片的译码驱动方式 半导体存储芯片的译码驱动方式有两种：线选法和重合法，如图4.9和图4.10所示。 图4.9是一个16X1字节线选法存储芯片的结构示意图。它的特点是用一根字选择线（字 线），直接选中一个存储单元的各位（如一个字节）。这种方式结构较简单，但只适千容量不大的 存储芯片。如当地址线A3A2A1A。为1111时，则第15根字线被选中，对应图4.9中的最后一行8 位代码便可直接读出或写入。 图4.10是一个1Kxl位重合法结构示意图。显然，只要用64根选择线(X、Y两个方向 各32根），便可选择32X32矩阵中的任一位。例如，当地址线为全0时，译码输出X。和凡有 效，矩阵中第0行、第0列共同选中的那位即被选中。由千被选单元是由X、Y两个方向的地"}
{"doc_id": "co", "page": 82, "text": "76 第2篇计算机系统的硬件结构 址决定的，故称为重合法。当欲构成1Kx 1字节的存储器时，只需用8片如图4.10所示的芯 片即可。 广·—·—·—·—·—·—· A3AZAl 约 字广·—·—·—·—·—·—·1 线10, 0…O,7.  地°, 址·, . 16X8矩阵!  译：I : ; 1  认1气］…罕：-- 读／写选通读／写控制电路 心丛 A2Al 约 X 地址译码器 Y地址译码器 D。D1Dz D7  图4.916X 1字节线选法结构示意图 A9丛A7A6 As  图4.101 Kxl位重合法结构示意图 随机存 随机存取存储器按其存储信息的原理不同，可分为静态RAM和动态RAM两大类。 1.静态RAM(Static RAM, SRAM)  (1)静态RAM基本单元电路 存储器中用千寄存“0”和“1”代码的电路称为存储器的基本单元电路，图4.11是一个由6 个MOS管组成的基本单元电路。 图中Tl～兀是一个由MOS管组成的触发器基本电路，T`兀犹如一个开关，受行地址选择 信号控制。由Tl～兀这6个MOS管共同构成一个基本单元电路。T7、兀受列地址选择控制，分 别与位线A'和A相连，它们并不包含在基本单元电路内，而是芯片内同一列的各个基本单元电 路所共有的。 假设触发器巳存有“1“信号，即A点为高电平。当需读出时，只要使行、列地址选择信号均 有效，则使T5、T心兀、兀均导通，A点高电平通过兀后，再由位线A通过兀作为读出放大器的 输入信号，在读选择有效时，将“1“信号读出。 由千静态RAM是用触发器工作原理存储信息的，因此即使信息读出后，它仍保持其原状 态，不需要再生。但电源掉电时，原存信息丢失，故它属易失性半导体存储器。 写入时不论触发器原状态如何，只要将写入代码送至图4.11的DIN端，在写选择有效时，经 两个写放大器，使两端输出为相反电平。当行、列地址选择有效时，使T\"兀、兀、兀导通，并将A"}
{"doc_id": "co", "page": 83, "text": "第4章存储器77  ,  位线A'I兀:二兀＿} 位线A 行地址选择｀ 列地址选择 写入DIN 图4.11静态RAM的基本单元电路 与A'点置成完全相反的电平。这样，就把欲写入的信息写入该基本单元电路中。如欲写入“1\"'  即凡＝1，经两个写放大器使位线A为高电平，位线A'为低电平，结果使A点为高，A＇点为低，即 写入了“1“信息。 (2)静态RAM芯片举例 Intel 2114芯片的基本单元电路由6个MOS管组成，图4.12是一个容量为1Kx4位的2114 外特性示意图。 图中，A9~A。为地址输入端；I/01~ I/04为数据 输入输出端；正；为片选信号（低电平有效）；《E为写A。 允许信号（低电平为写，高电平为读）；Vee为电源端； GND为接地端。 2114 RAM芯片的结构示意图如图4.13所示。 图中存储矩阵由64x64个基本单元电路组成，列 I/0电路即读／写电路。10根地址线分为行地址 A8～儿和列地址A心儿、Al、A。,4根数据线为 A1  A9  WE 枣 Vee GND  图4.12Intel 2114外特性示意图 I/01  I/02  I/03  I/04  I/04 ~ I/01，它们是受输入输出三态门控制的双向总线。当CS和WE均为低电平时，输入三 态门打开，I/04~ I/01上的数据即写入指定地址单元中。当正已勾低电平、WE为高电平时， 输出三态门打开，列I/0电路的输出经片内总线输出至数据线I/04~ I/01上。 2114 RAM芯片内的存储矩阵结构如图4.14所示。其中每一个小方块均为一个由6个MOS 管组成的基本单元电路，排列成64x64矩阵，64列对应64对T7、兀管。又将64列分成4组，每 组包含16列，并与一个读／写电路相连，读／写电路受《E和正汀空制，4个读／写电路对应4根数"}
{"doc_id": "co", "page": 84, "text": "78 第2篇计算机系统的硬件结构 4321 0000 IIIIIIII  A8A7A6A5A4A3  苍 泗 图4.132114 RAM芯片结构示意图 据线I/01~ I/04。由图中可见，行地址经译码后可选中某一行；列地址经译码后可选中4组中 的对应列，共4列。 当对某个基本单元电路进行读／写操作时，必须被行、列地址共同选中。例如，当A9~A。为 全0时，对应行地址A厂儿为000000，列地址A9、A｀八、从也为0000，则第0行的第0、16、32、 48这4个基本单元电路被选中。此刻，若做读操作，则正；为低电平，《E为高电平，在读／写电 路的输出端I/01~I／见便输出第0行的第0、16、32、48这4个基本单元电路所存的信息。若做 写操作，将写入信息送至I/01~I/04端口，并使飞5为低电平、《E为低电平，同样这4个输入信 息将分别写入第0行的第0、16、32、48这4个单元之中。 (3)静态RAM读／写时序 l)读周期时序 图4.15是2114RAM芯片读周期时序，在整个读周期中\\飞始终为高电平（故图中省略）。 读周期tRC是指对芯片进行两次连续读操作的最小间隔时间。读时间tA表示从地址有效到数据 稳定所需的时间，显然读时间小千读周期。图中tco是从片选有效到输出稳定的时间。可见只有 当地址有效经tA后，且当片选有效经tco后，数据才能稳定输出，这两者必须同时具备。根据tA 和tco的值，便可知当地址有效后，经tA -tco时间必须给出片选有效信号，否则信号不能出现在数 据线上。"}
{"doc_id": "co", "page": 85, "text": "第4章 存储 器79  。 行地址译码器 A8A7 怂 A5A4A32  62  63  A9  A2  A1  A。 列地址译码器 01 … 5 l  w  CS  图4.142114 RAM矩阵结构示意图 地址有效t RC  地址失效 tA  A  忘 图4.152114 RAM的读周期时序 需注意一点，从片选失效到输出高阻需一段时间tOTD，故地址失效后，数据线上的有效数据 有一段维持时间tOHA，以保证所读的数据可靠。 2)写周期时序 图4.16是2114RAM写周期时序。"}
{"doc_id": "co", "page": 86, "text": "80 第2篇计算机系统的硬件结构 地址有效地址失效 A  图4.162114 RAM的写周期时序 写周期twc是对芯片进行连续两次写操作的最小间隔时间。写周期包括滞后时间tAW、 入时间tw和写恢复时间tWR。在有效数据出现前，RAM的数据线上存在着前一时刻的数据 D。UT（如图4.15所示的维持时间），故在地址线发生变化后，压、《E均需滞后tAW再有效，以避 免将无效数据写入RAM的错误。但写允许\\飞失效后，地址必须保持一段时间，称为写恢复 时间。此外，RAM数据线上的有效数据（即CPU送至RAM的写入数据DIN)必须在G;、《E 失效前的tDW时刻出现，并延续一段时间tDH（此刻地址线仍有效，tWR> tDH)，以保证数据可靠 写入。 己制成的RAM芯片读写时序关系已被确定，因此，将它与CPU连接时，必须注意它们相互 间的时序匹配关系，否则RAM将无法正常工作。具体RAM芯片的读／写周期时序可查看相 关资料。 值得注意的是，不论是对存储器进行读操作还是写操作，在读周期和写周期内，地址线上的 地址始终不变。 2.动态RAM(Dynamic RAM, DRAM)  (1)动态RAM的基本单元电路 常见的动态RAM基本单元电路有三管式和单管式两种，它们的共同特点都是靠电容存储 电荷的原理来寄存信息。若电容上存有足够多的电荷表示存”1\"，电容上无电荷表示存“0”。电 容上的电荷一般只能维持1~ 2 ms，因此即使电源不掉电，信息也会自动消失。为此，必须在 2 ms内对其所有存储单元恢复一次原状态，这个过程称为再生或刷新。由千它与静态RAM相 比，具有集成度更高、功耗更低等特点，目前被各类计算机广泛应用。 图4.17示意了由Tl、T心兀这3个MOS管组成的三管MOS动态RAM基本单元电路。 读出时，先对预充电管兀置一预充电信号（在存储矩阵中，每一列共用一个兀管），使读数 据线达高电平VDD。然后由读选择线打开T2，若兀的极间电容cg存有足够多的电荷（被认为原"}
{"doc_id": "co", "page": 87, "text": "第4章存储器81  读选择线 写选择线 VDD  预充电信号 写数据线读数据线 图4.17三管MOS动态RAM基本单元电路 存“1”)，使兀导通，则因T心兀导通接地，使读数据线降为零电平，读出“0“信息。若cg没有足 够电荷（原存“0”)，则兀截止，读数据线为高电平不变，读出“1“信息。可见，由读出线的高低电 平可区分其是读“l\"，还是读“0”，只是它与原存信息反相。 写入时，将写入信号加到写数据线上，然后由写选择线打开T3，这样，cg便能随输入信息充 电（写“1”)或放电（写“O”)。 为了提高集成度，将三管电路进一步简化，去掉Tl，把信息存在电容cs上，将T公兀合并成 一个管子T，便得到单管MOS动态RAM基本单元电路，如图4.18所示。 读出时，字线上的高电平使T导通，若cs有电荷，经T管在数据 线上产生电流，可视为读出“1\"。若cs无电荷，则数据线上无电流，可 视为读出“0\"。读操作结束时，cs的电荷已释放完毕，故是破坏性读 出，必须再生。 写入时，字线为高电平使T导通，若数据线上为高电平，经T管对 CS充电，使其存”l\"；若数据线为低电平，则cs经T放电，使其无电荷 而存“O\"o 字线 数据线 CS ＿上 (2)动态RAM芯片举例 l)三管动态RAM芯片 三管动态RAM芯片结构的示意图如图4.19所示。 图4.18单管MOS动态RAM 基本单元电路 这是一个1Kxl位的存储芯片，图中每一小方块代表由3个MOS管组成的动态RAM基本 单元电路。它们排列成32x32的矩阵，每列都有一个刷新放大器（用来形成再生信息）和一个预 充电管（图中未画），芯片有10根地址线，采用重合法选择基本单元电路。 读出时，先置以预充电信号，接着按行地址A9～凡经行译码器给出读选择信号，同时由列地 址A4~A。经列译码器给出列选择信号。只有在行、列选择信号共同作用下的基本单元电路才能 将其信息经读数据线送到读／写控制电路，并从数据线D输出。"}
{"doc_id": "co", "page": 88, "text": "82 第2篇计算机系统的硬件结构 A9  A8  A7  A6  A5  01  1 … 1 3  行地址译码器 预充电信号 读选择线 2  A4 A3 A2 A1 A。 图4.19lKxl位三管MOS动态RAM结构示意图 写入时，在受行地址控制的行译码器给出的写选择信号的作用下，选中芯片的某一行，并在 列地址的作用下，由列译码器的输出控制读／写控制电路，只将数据线D的信息送到被选中列的 写数据线上，信息即被写入行列共同选中的基本单元电路中。 2)单管动态RAM芯片 单管动态RAM芯片结构的示意图如图4.20所示。这是一个16Kx 1位的存储芯片，按理 应有14根地址线，但为了减少芯片封装的引脚数，地址线只有7根。因此，地址信息分两次 传送，先送7位行地址保存到芯片内的行地址缓存器内，再送7位列地址保存到列地址缓存 器中。芯片内有时序电路，它受行地址选通瓦8、列地址选通CAS以及写允许信号 五控制。 16 Kx 1位的存储芯片共有16K个单管MOS基本单元电路，它们排列成128x128的矩 阵，如图4.21所示。图中的行线就是图4.18中的字线，列线就是图4.18中的数据线。128 行分布在读放大器的左、右两侧（左侧为0~ 63行，右侧为64~ 127行）。每根行选择线与 128个MOS管的栅极相连。128列共有128个读放大器，它的两侧又分别与64个MOS管 相连，每根列线上都有一个列地址选择管。128个列地址选择管的输出又互相并接在一起 与I/0缓冲器相连，I/0缓冲器的一端接输出驱动器，可输出数据；另一端接输入器，供数据 输入。 读出时，行、列地址受RAS和CAS控制，分两次分别存入行、列地址缓存器。行地址经行译 码后选中一行，使该行上所有的MOS管均导通，并分别将其电容CS上的电荷反映到128个读放 大器的某一侧（第0~63行反映到读放大器的左侧，第64~ 127行反映到读放大器的右侧）。读"}
{"doc_id": "co", "page": 89, "text": "第4章存储器83  行时钟 列时钟 写时钟 言髻二 出大控译器 」 译器行码读放器制行码 图4.204116动态RAM(16Kxl位）芯片的结构 放大器的工作原理像一个跷跷板电路，类似千一个触发器，其左右两侧电平相反。此外列地址经 列译码后选中某一列，该列上的列地址选择管导通，即可将读放大器右侧信号经读／写线、1/0缓 冲器输出至D。UT端。例如，选中第63行、第0列的单管MOS电路，若其Cs有电荷为“1”状态，则 反映到第0列读放大器的左侧为“1\"，右侧为“0\"，经列地址选择管输出至D。UT为0，与原存信息 反相。同理，第0~62行经读放大器至输出线D。UT的信息与原存信息均反相。而读出第64~127  行时，因它们的电容C8上的电荷均反映到读放大器的右侧，故经列地址选择管输出至D。UT的信 息均同相。 写入时，行、列地址也要分别送入芯片内的行、列地址缓存器，经译码可选中某行、某列。输 入信息凡通过数据输入器，经1/0缓冲器送至读／写线上，但只有被选中的列地址选择管导通， 可将读／写线上的信息送至该列的读放大器右侧，破坏了读放大器的平衡，使读放大器的右侧与 输入信息同相，左侧与输入信息反相，读放大器的信息便可写入选中行的CS中。例如，选中第 64行、第127列，输入信息为“1\"，则第127列地址选择管导通，将“1“信息送至第127列的读放 大器的右侧。虽然第64行上的128个MOS管均导通，但唯有第64行、第127列的MOS管能将 读放大器的右侧信息”1”对CS充电，使其写入“1”。值得注意的是，写入读放大器左侧行的信息 与输入信息都是反相的，而由读出过程分析又知，对读放大器左侧行进行读操作时，读出的信息 也是反相的，故最终结果是正确的。 (3)动态RAM时序 由图4.20可知，动态RAM的行、列地址是分别传送的，因此分析其时序时，应特别注意 RAS、石与地址的关系，即 0先由正G将行地址送入行地址缓存器，再由CAS将列地址送入列地址缓存器，因此，"}
{"doc_id": "co", "page": 90, "text": "84 第2篇计算机系统的硬件结构 列地址选择管 ..L  。 飞＝CI三~I 尸竺I|  1' 128  列选择 厂；勹＇陕瓜人窃`11 』」勹I  尸；TlT  .: . : I : I 121  H  工工丁I工 。 63 64... 127  128根行线 图4.2116 Kx 1位4116动态RAM存储矩阵示意图 CAS滞后于RAS的时间必须要超过其规定值。 • RAS和CG正、负电平的宽度应大于规定值，以保证芯片内部正常工作。 ·行地址对RAS的下降沿以及列地址对石5的下降沿应有足够的地址建立时间和地址保 持时间，以确定行、列地址均能准确写入芯片。 l)读时序 在读工作方式时（写允许WE=l)，读工作周期是指动态RAM完成一次“读”所需的最短时 间tCRD，也是RAS的一个周期。如图4.22所示，为了确保读出数据无误，必须要求写允许WE=l 在列地址送入前（即CAS下降沿到来前）建立，而WE=l的撤除应在CAS失效后（即CAS上升 沿后）；还要求读出数据应在RAS有效后一段时间ta因且CAS有效后一段时间ta声时出现，而数 据有效的撤除时间应在CG失效后一段时间th声－OUTo"}
{"doc_id": "co", "page": 91, "text": "第4章存储器85  t CRD  页 啤 w  D OUT  t a运 图4.22动态RAM读工作方式时序图 2)写时序 在写工作方式时（写允许WE=O),RAS的一个周期tcWR即为写工作周期，如图4.23 所示。 为了确保写入数据准确无误，WE=O应先于CAS=0，而且数据的有效存在时间应与CAS及 而的有效相对应，即写入数据应在CAS有效前的一段时间tSUDIN一声出现，它的保持时间应为CAS 有效后的一段时间t这是因为数据的写入实际上是由CAS的下降沿激发而成的。可见， hDIN－石\\S' 为了保证正常写入，WE、CAS有效均要大于数据DIN有效的时间。 酗一了 CWR  产 D IN  D OUT  图4.23动态RAM写工作方式时序图 此外，动态RAM还有读－改写工作方式和页面工作方式，本书不再赘述。 (4)动态RAM的刷新 刷新的过程实质上是先将原存信息读出，再由刷新放大器形成原信息并重新写入的再生过 程（图4.19中的刷新放大器及图4.21中的读放大器均起此作用）。"}
{"doc_id": "co", "page": 92, "text": "86 第2篇计算机系统的硬件结构 由于存储单元被访问是随机的，有可能某些存储单元长期得不到访问，不进行存储器的 读／写操作，其存储单元内的原信息将会慢慢消失。为此，必须采用定时刷新的方法，它规定在一 定的时间内，对动态RAM的全部基本单元电路必作一次刷新，一般取2ms，这个时间称为刷新 周期，又称再生周期。刷新是一行行进行的，必须在刷新周期内，由专用的刷新电路来完成对基 本单元电路的逐行刷新，才能保证动态RAM内的信息不丢失。通常有三种方式刷新：集中刷 新、分散刷新和异步刷新。 1)集中刷新 集中刷新是在规定的一个刷新周期内，对全部存储单元集中一段时间逐行进行刷新，此刻必 须停止读／写操作。例如，对128x128矩阵的存储芯片进行刷新时，若存取周期为0.5µ,s，刷新周 期为2ms（占4000个存取周期），则对128行集中刷新共需64µ,s（占128个存取周期），其余的 1 936 µ,s（共3872个存取周期）用来读／写或维持信息，如图4.24所示。由于在这64µ,s时间内 不能进行读／写操作，故称为“死时间”，又称访存“死区”，所占比率为128/4ooox 100% = 3.2%,  称为死时间率。 周期序号3870 3872 !39991 o I 1  tc  地址序号一』：厂勹了I V-I-W-I-0-I\\ | 扂 3 872个周期(l936µ9|-128个周期(64µs)二1刷新序号 刷新时间间隔(2ms) 图4.24集中刷新时间分配示意图 2)分散刷新 分散刷新是指对每行存储单元的刷新分散到每个存取周期内完成。其中，把机器的存取周 期tc分成两段，前半段tM用来读／写或维持信息，后半段tR用来刷新，即tc=tM+tR。若读／写周 期为0.5µ,s，则存取周期为1µ,s。仍以128X 128矩阵的存储芯片为例，刷新按行进行，每隔 128 µ,s就可将存储芯片全部刷新一遍，如图4.25所示。这比允许的间隔2ms要短得多，而且也 不存在停止读／写操作的死时间，但存取周期长了，整个系统速度降低了。 3)异步刷新 异步刷新是前两种方式的结合，它既可缩短“死时间”，又充分利用最大刷新间隔为2ms的 特点。例如，对于存取周期为0.5µ,s，排列成128X128的存储芯片，可采取在2ms内对128行各"}
{"doc_id": "co", "page": 93, "text": "第4章存储器87  W/R VY/八W/R VV/K w/R VV I八w/RI 1W/RI 1W/R  REF REF REF REF  。126 127 ...  tM tR  tc  刷新间隔128个存取周期 图4.25分散刷新时间分配示意图 刷新一遍，即每隔15.6µ,s(2000 µ,s+128=15.6 µ,s)刷新一行，而每行刷新的时间仍为0.5µ,s，如 图4.26所示。这样，刷新一行只停止一个存取周期，但对每行来说，刷新间隔时间仍为2ms，而 “死时间＂缩短为0.5µ,s。 W/RIW/R IW/RIW/R  tc I o.s  µs  15.6 µs  REF IW/RIW/RIW/RIW/R  0.5|化 µs  15.6 µs  图4.26异步刷新时间分配示意图 如果将动态RAM的刷新安排在CPU对指令的译码阶段，由于这个阶段CPU不访问存储 器，所以这种方案既克服了分散刷新需独占0.5µs用于刷新，使存取周期加长且降低系统速度 的缺点，又不会出现集中刷新的访存“死区”问题，从根本上提高了整机的工作效率。 3.动态RAM与静态RAM的比较 目前，动态RAM的应用比静态RAM要广泛得多。其原因如下： 叩在同样大小的芯片中，动态RAM的集成度远高千静态RAM，如动态RAM的基本单元电 路为一个MOS管，静态RAM的基本单元电路可为4~6个MOS管。 ＠动态RAM行、列地址按先后顺序输送，减少了芯片引脚，封装尺寸也减少。 ＠动态RAM的功耗比静态RAM小。 ＠动态RAM的价格比静态RAM的价格便宜。当采用同一档次的实现技术时，动态RAM 的容量大约是静态RAM容量的4~8倍，静态RAM的存取周期比动态RAM的存取周期快 8 ~ 16倍，但价格也贵8~16倍。 随着动态RAM容量不断扩大，速度不断提高，它被广泛应用于计算机的主存。 动态RAM也有缺点： 叩由千使用动态元件（电容），因此它的速度比静态RAM低。 ＠动态RAM需要再生，故需配置再生电路，也需要消耗一部分功率。通常，容量不大的高"}
{"doc_id": "co", "page": 94, "text": "88 第2篇计算机系统的硬件结构 速缓冲存储器大多用静态RAM实现。 读存储器 按ROM的原始定义，一旦注入原始信息即不能改变，但随着用户的需要，总希望能任意修 改ROM内的原始信息。这便出现了PROM、EPROM和EEPROM等。 对半导体ROM而言，基本器件为两种：MOS型和TTL型。 1.掩模ROM 图4.27所示为MOS型掩模ROM，其容量为lKxl位，采用重合法驱动，行、列地址线分别经 行、列译码器，各有32根行、列选择线。行选择线与列选择线交叉处既可有耦合元件MOS管，也 可没有。列选择线各控制一个列控制管，32个列控制管的输出端共连一个读放大器。当地址为 全“0”时，第0行、0列被选中，若其交叉处有耦合元件MOS管，因其导通而使列线输出为低电 平，经读放大器反相为高电平，输出“1”。当地址A4~A。为11111,A9 ~ A5为00000时，即第31 行、第0列被选中，但此刻行、列的交叉处无MOS管，故0列线输出为高电平，经读放大器反相为 \"0”输出。可见，用行、列交叉处是否有耦合元件MOS管，便可区分原存“1”还是存“0”。当然， 此ROM制成后不可能改变原行、列交叉处的MOS管是否存在，所以，用户是无法改变原始状 态的。 八 A1  A2  A3  A4  。 X 行地址译码 31  选通 A5  图4.27 A6 A7 A8 A9  1 Kxl位的MOS管掩模ROM"}
{"doc_id": "co", "page": 95, "text": "第4章 存储 器89  2. PROM  PROM是可以实现一次性编程的只读存储器，图4.28示意一个由双极型电路和熔丝构成的 基本单元电路。在这个电路中，基极由行线控制，发射极与列线 之间形成一条铢铭合金薄膜制成的熔丝（可用光刻技术实现）， 集电极接电源Vee。熔丝断和未断可区别其所存信息是 \" 1”或“0”。 图4.29是由图4.28所示基本单元电路构成的16Xl位双极 型铢铭熔丝式PROM芯片。用户在使用前，可按需要将信息存 入行、列交叉的耦合元件内。若欲存“0\"，则置耦合元件一大电 流，将熔丝烧掉。若欲存”1\"，则耦合处不置大电流，熔丝不断。 当被选中时，熔丝断掉处将读出“0\"，熔丝未断处将读出“1”。 例如，当地址A3~A。为0000时，第0行、第0列被选中，此刻行、图4.28双极型锦馅熔丝 列交叉的耦合元件熔丝未断，故读出D=l；若A3~A。=0001，则式单元电路 第1行、第0列被选中，此刻行、列交叉的耦合元件熔丝已断，读出D=O。当然，已断的熔丝是无 法再恢复的，故这种ROM往往只能实现一次编程，不得再修改。 行线 列线 Vee  A。 A1  A2  A3  X 行地址译码 Y 列地址译码 3  熔丝未断为1 熔丝烧断为0 苍 D  图4.2916x 1位双极型锦铅熔丝式PROM"}
{"doc_id": "co", "page": 96, "text": "90 第2篇计算机系统的硬件结构 3. EPROM  EPROM是一种可擦除可编程只读存储器。它可以由用户对其所存信息作任意次的改写。 目前用得较多的EPROM是由浮动栅雪崩注入型MOS管构成的，又称FAMOS型EPROM，如图 4.30所示。 G D 浮动栅 图4.30N型沟道浮动栅MOS电路 图中所示的N型沟道浮动栅MOS电路，在漏端D加上正电压（如25V、50ms宽的正脉 冲），便会形成一个浮动栅，它阻止源S与湍D之间的导通，致使此MOS管处于“0”状态。若对 D端不加正电压，则不能形成浮动栅，此MOS管便能正常导通，呈“1”状态。由此，用户可按需要 对不同位置的MOS管D端施正电压或不施正电压，便制成了用户所需的ROM。一旦用户需重 新改变其状态，可用紫外线照射，驱散浮动栅，再按需要将不同位置的MOS管D端重新置于正电 ，又得出新状态的ROM，故称之为EPROM。 图4.31为2716型EPROM的逻辑图和引脚图。 DO。 叩 阿/Pr哩数据缓冲区 CS  Y控制 128X 128  存储矩阵 (a)逻辑图 A7计124卜－Vee ~p  否 A10  丙泗rogr D07  6 1 7 2  2 1  .. 1  T s s v  A1 约 0°01O2DDD  (b)引脚图 图4.312716型EPROM逻辑图及引脚图 这类芯片的外引脚除地址线、数据线外，还有两个电源引出头Vee和VPP。其中Vee接＋5V;  Vpp平时接＋5V，当其接＋25V时用来完成编程。Vss为地。正豆勾片选端，读出时为低电平，编程"}
{"doc_id": "co", "page": 97, "text": "第4章存储器91  写入时为高电平。PD/Progr是功率下降／编程输入端，在读出时为低电平；当此端为高电平时， 可以使EPROM功耗由525mW降至132mW；当需编程时，此端需加宽度为50~55ms、+5V的 脉冲。 EPROM的改写可用两种方法，一种用紫外线照射，但擦除时间比较长，而且不能对个别 需改写的单元进行单独擦除或重写。另一种方法用电气方法将存储内容擦除，再重写。甚至 在联机条件下，用字擦除方式或页擦除方式，既可局部擦写，又可全部擦写，这种EPROM就是 EEPROM。 进入到20世纪80年代，又出现了一种闪速存储器(FlashMemory)，又称快擦型存储器，它 是在EPROM和EEPROM工艺基础上产生的一种新型的、具有性能价格比更好、可靠性更高的 可擦写非易失性存储器。它既有EPROM的价格便宜、集成度高的优点，又有EEPROM电可擦 除重写的特性。它具有整片擦除的特点，其擦除、重写的速度快。一块lM位的闪速存储芯片的 擦除、重写时间小于5µs，比一般标准的EEPROM快得多，已具备了RAM的功能，可与CPU直 接连接。它还具有高速编程的特点，例如，采用快速脉冲编程算法对28F256闪速存储芯片每字 节的编程时间仅需100µs。此外，该器件具有存储器访问周期短，功耗低及与计算机接口简单等 优点。 在需要周期性地修改存储信息的应用场合，闪速存储器是一个极为理想的器件，因为它至少 可以擦写／编程10000次，这足以满足用户的需要。它比较适合于作为一种高密度、非易失的数 据采集和存储器件，在便携式计算机、工控系统及单片机系统中得到大量应用，近年来已用千微 型计算机中存放输入输出驱动程序和参数等。 非易失性、长期反复使用的大容量闪速存储器还可替代磁盘，例如，在笔记本手掌型袖珍计 算机中都大量采用闪速存储器做成固态盘替代磁盘，使计算机平均无故障时间大大延长，功耗更 低，体积更小，消除了机电式磁盘驱动器所造成的数据瓶颈。 1.存储容量的扩展 由于单片存储芯片的容量总是有限的，很难满足实际的需要，因此，必须将若干存储芯片连 在一起才能组成足够容量的存储器，称为存储容量的扩展，通常有位扩展和字扩展。 (1)位扩展 位扩展是指增加存储字长，例如，2片1Kx4位的芯片可组成1Kx8位的存储器，如图4.32 所示。图中2片2114的地址线A9~A。(5、《E都分别连在一起，其中一片的数据线作为高4 位D1~D4，另一片的数据线作为低4位D3~D。。这样，便构成了一个1Kx8位的存储器。 又如，将8片16Kxl位的存储芯片连接，可组成一个16Kx8位的存储器，如图4.33所示。 (2)字扩展 字扩展是指增加存储器字的数量。例如，用2片1Kx8位的存储芯片可组成一个2Kx8位"}
{"doc_id": "co", "page": 98, "text": "92 第2篇计算机系统的硬件结构 丛…约 DJ:04 … Do_cs-WE  图4.32由2片1Kx4位的芯片组成1Kx8位的存储器 1312 … A1 怂 AA  76 DD  Do-cs-WE  图4.33由8片16Kx 1位的芯片组成16Kx8位的存储器 的存储器，即存储字增加了一倍，如图4.34所示。 在此，将A10用作片选信号。由于存储芯片的片选输入端要求低电平有效，故当A10为低电 平时，石；。有效，选中左边的1Kx 8位芯片；当A10为高电平时，反相后正~1有效，选中右边 的1Kx8位芯片。 (3)字、位扩展 字、位扩展是指既增加存储字的数量，又增加存储字长。图4.35示意用8片1Kx4位的芯 片组成4Kx8位的存储器。"}
{"doc_id": "co", "page": 99, "text": "第4章 存储器 93  AlO 丛 A。 7 D …  Do-WE  图4.34由2片1Kx8位的芯片组成2Kx8位的存储器 1110A9 丛…怂 AA  D7  CS2  CS3  CS 。 CS 1  Do-WE  图4.35由8片1Kx4位的芯片组成4Kx8位的存储器 由图中可见，每2片构成一组1Kx8位的存储器，4组便构成4Kx8位的存储器。地址线 All、丛经片选译码器得到4个片选信号CS。、cs1、cs2、CS3，分别选择其中1Kx8位的存储芯片。 吓为读／写控制信号。 2.存储器与CPU的连接 存储芯片与CPU芯片相连时，特别要注意片与片之间的地址线、数据线和控制线的连接。 (1)地址线的连接 存储芯片的容量不同，其地址线数也不同，CPU的地址线数往往比存储芯片的地址线数多。"}
{"doc_id": "co", "page": 100, "text": "94 第2篇计算机系统的硬件结构 通常总是将CPU地址线的低位与存储芯片的地址线相连。CPU地址线的高位或在存储芯片扩 充时用，或做其他用途，如片选信号等。例如，设CPU地址线为16位Al5~A。,1Kx4位的存储芯 片仅有10根地址线A9~A。，此时，可将CPU的低位地址A9~A。与存储芯片地址线A9~A。相 连。又如，当用16Kx 1位存储芯片时，则其地址线有14根A13~A。，此时，可将CPU的低位地址 A13~A。与存储芯片地址线A13~A。相连。 (2)数据线的连接 同样，CPU的数据线数与存储芯片的数据线数也不一定相等。此时，必须对存储芯片扩位， 使其数据位数与CPU的数据线数相等。 (3)读／写命令线的连接 CPU读／写命令线一般可直接与存储芯片的读／写控制端相连，通常高电平为读，低电平为 写。有些CPU的读／写命令线是分开的，此时CPU的读命令线应与存储芯片的允许读控制端相 连，而CPU的写命令线则应与存储芯片的允许写控制端相连。 (4)片选线的连接 片选线的连接是CPU与存储芯片正确工作的关键。存储器由许多存储芯片组成，哪一片 被选中完全取决千该存储芯片的片选控制端正汀邑否能接收到来自CPU的片选有效信号。 片选有效信号与CPU的访存控制信号MREQ（低电平有效）有关，因为只有当CPU要求访 存时，才需选择存储芯片。若CPU访问I/0，则MREQ为高电平，表示不要求存储器工作。此 外，片选有效信号还和地址有关，因为CPU的地址线往往多千存储芯片的地址线，故那些未与存 储芯片连上的高位地址必须和访存控制信号共同产生存储芯片的片选信号。通常需用到一些逻 辑电路，如译码器及其他各种门电路，来产生片选有效信号。 (5)合理选择存储芯片 合理选择存储芯片主要是指存储芯片类型(RAM或ROM)和数量的选择。通常选用ROM 存放系统程序、标准子程序和各类常数等。RAM则是为用户编程而设置的。此外，在考虑芯片 数量时，要尽量使连线简单方便。 在实际应用CPU与存储芯片时，还会遇到两 者时序的配合、速度、负载匹配等问题，下面用一 个实例来剖析CPU与存储芯片的连接方式。 例4.1设CPU有16根地址线、8根数据 线，并用MREQ作为访存控制信号（低电平有 效），用《五作为读／写控制信号（高电平为读，低 电平为写）。现有下列存储芯片：1Kx4位RAM、 4 Kx8位RAM、8Kx8位RAM、2Kx8位ROM、 4 Kx8位ROM、8Kx 8位ROM及74138译码器 和各种门电路，如图4.36所示。画出CPU与存 储器的连接图，要求如下： 74138译码器 任 -`- Y6  0  图4.36 G1、石2A、百2B为控制端 C、B、A为变量输入端 B  。 -Y 克，…，立为变量输出端 毛毛 译码器和门电路"}
{"doc_id": "co", "page": 101, "text": "心主存地址空间分配： 6000H ~ 67FFH为系统程序区。 6800H ~ 6BFFH为用户程序区。 第4章存储器 ＠合理选用上述存储芯片，说明各选几片。 ＠详细画出存储芯片的片选逻辑图。 解：第一步，先将十六进制地址范围写成二进制地址码，并确定其总容量。 A15 \"• A12 All •\" Ag A7 • • • A4 A3'• • A。 0 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0}系统程序区 2 Kx8位 0110 011111111111  0110 1000 0000 0000  用户程序区 O l l O l O l l l l l l l l l l}lkx8位 第二步，根据地址范围的容量以及该范围在计算机系统中的作用，选择存储芯片。 95  根据6000H~ 67FFH为系统程序区的范围，应选择l片2Kx8位的ROM，若选择4Kx8位或 8 Kx8位的ROM，都超出了2Kx8位的系统程序区范围。 根据6800H~ 6BFFH为用户程序区的范围，选2片1Kx4位的RAM芯片正好满足1Kx8位 的用户程序区要求。 第三步，分配CPU的地址线。 将CPU的低11位地址A10~A。与2Kx 8位的ROM地址线相连；将CPU的低10位地址 A9~A。与2片1Kx4位的RAM地址线相连。剩下的高位地址与访存控制信号MREQ共同产生 存储芯片的片选信号。 第四步，片选信号的形成。 由图4.36给出的74138译码器输入逻辑关系可知，必须保证控制端Gl为高电平，G2A与G2B 为低电平，才能使译码器正常工作。根据第一步写出的存储器地址范围得出，A15始终为低电平， 丛始终为高电平，它们正好可分别与译码器的豆从低）和Gl（高）对应。而访存控制信号MREQ （低电平有效）又正好可与C2B（低）对应。剩下的A13、A12、All可分别接到译码器的C、B、A输入 端。其输出Y4有效时，选中1片ROM;Y5与A10同时有效均为低电平时，与门输出选中2片 RAM，如图4.37所示。图中ROM芯片的面)/Progr端接地，以确保在读出时低电平有效。RAM 芯片的读写控制端与CPU的读写命令端《h相连。ROM的8根数据线直接与CPU的8根数据 线相连，2片RAM的数据线分别与CPU数据总线的高4位和低4位相连。 例4.2假设CPU及其他芯片同例4.1，画出CPU与存储器的连接图。要求主存的地址空 间满足下述条件：最小8K地址为系统程序区，与其相邻的16K地址为用户程序区，最大4K地 址空间为系统程序工作区。详细画出存储芯片的片选逻辑并指出存储芯片的种类及片数。 解：第一步，根据题目的地址范围写出相应的二进制地址码。"}
{"doc_id": "co", "page": 102, "text": "96 第2篇计算机系统的硬件结构 A14  A15  MREQ A1.:l| 忙|立 A12  All  A10  八 ..  八 Df04D.:Do-WR  图4.37例4.1CPU与存储芯片的连接图 A15 · · · A12 A11 · · · A8 A7 · · · A4 A3 · · · A。 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0  ｝最小8Kx8位 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 系统程序区 0 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0  O O l l l l l l l l l l l l l l}相邻l6KX8位 0100 0000 0000 0000用户程序区 0 1 0 1 1 1 1 1 1 1 1 1 1 1 1 1"}
{"doc_id": "co", "page": 103, "text": "第4章 存储 器97  A1s, ·· · A12 Au · · · As A7 · · · A4 A3 · · · A。 1111 00,00 0000 0000  最大4Kx8位 』系统程序工作 l l l l 1 1 l l l l l l 1 l  第二步，根据地址范围的容量及其在计算机系统中的作用，确定最小8KB系统程序区选择 1片8Kx8位ROM；与其相邻的16KB用户程序区选择2片8Kx8位RAM；最大4KB系统程序 工作区选择l片4Kx8位RAM。 第三步，分配CPU地址线。 将CPU的低13位地址线A12~A。与1片8Kx8位ROM和2片8Kx8位RAM的地址线相 连；将CPU的低12位地址线A11~A。与1片4Kx8位RAM的地址线相连。 第四步，形成片选信号。 将74138译码器的控制端G1接＋5V'G2A和G2B接MREQ，以保证译码器正常工作。CPU的 A1sA14从分别接在译码器的C、B、A端，作为变量输入，则其输出Y。、Yl、Y2分别作为ROM、 RAM1和RA凡的片选信号。此外，根据题意，最大4K地址范围的A12为高电平，故经反相后再 与Y7相”与＂，其输出作为4Kx8位RAM的片选信号，如图4.38所示。 酮 2lO AlA1 … A  70 D … D  颐 图4.38例4.2CPU与存储芯片的连接图 例4.3设CPU有20根地址线和16根数据线，并用IO/“作为访存控制信号玉h为读命"}
{"doc_id": "co", "page": 104, "text": "98 第2篇计算机系统的硬件结构 令，WR为写命令。CPU可通过BHE和A。来控制按字节或字两种形式访存（如表4.1所示）。 要求采用图4.39所示的芯片，门电路自定。试回答： (1) CPU按字节访问和按字访问的地址范围各是多少？ (2) CPU按字节访问时需分奇偶体，且最大64KB为系统程序区，与其相邻的64KB为用 户程序区。写出每片存储芯片所对应的二进制地址码。 (3)画出对应上述地址范围的CPU与存储芯片的连接图。 表4.1例4.3CPU访问形式与BHE和丛的关系 BHE  。 。 1  1  64KX8位 32KX8位 32 KX 16位 A。 。 1  。 1  64KX8位 32KX8位 32 KX 16位 图4.39例4.3芯片 访问形式 字 奇字节 偶字节 不访问 74138  解：（1)CPU按字节访问的地址范围为1M,CPU按字访间的地址范围是512K。 (2)由千CPU按字节访存时需区分奇偶体，并且还可以按字访问，因此如果选择64Kx8位 的芯片，按字节访间时体现不出奇偶分体；如果选择32Kx 16位的芯片，虽然能按字访问，但不 能满足以字节为最小单位。故一律选择32Kx8位的存储芯片，其中系统程序区64KB选择2片 32 Kx8位ROM，用户程序区64KB选择2片32Kx 8位RAM。它们对应的二进制地址范围 如下： A19... Al6从．．．A12A11.. · A8 A7.. · A4 A3.. · A。 l l l l l l l l l l l 1 1 1 1 1 1 1 1 1}64 KX8位ROM, 其中1片32Kx8位（奇） 1 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 OJ 1片32Kx8位（偶）"}
{"doc_id": "co", "page": 105, "text": "第4章 存储 器99  A19.. · A16 A1s.. · A12 Au.. · As A1.. · A4 A3.. · A。 l l l O l l l l l l l l l l l l l l 1 1}64 KX8位RAM, 其中1片32Kx8位（奇） 0 0 0 OJ 1片32Kx8位（偶） l l 1 0 0 0 0 0 0 0 0 0 0 0 0 0  该题的难点在于片选逻辑。由千CPU按字访问还是按字节访问受BHE和A。的控制，因此 可用BHE和A。分别控制74138译码器的输入端B和A，而Al5~ Al与存储芯片的地址线相连， 余下的A16接74138译码器的输入端C。A19、A18、A17作为与门的输入端，与门输出接至74138译 码器的队端，G2A和G2B与IO/“相连，以确保74138译码器正常工作。具体连接图如图4.40 所示。 图中译码器输出Y4有效时，同时选择ROM1和ROM2,CPU以字形式访问；Y5有效时选择 ROMl（奇体），y6有效时选择ROM2（偶体），CPU以字节形式访问。同理，译码器输出Y。控制 CPU可按字形式访问RAM1和RAM20YI和Y2分别按字节访问RAM1（奇体）和RAM2（偶体）。 CPU的读命令面}直接和ROM、RAM的＂；（允许输出端）相连，CPU的写命令《h直接和 RAM芯片的《E（允许写输入端）相连。ROM芯片的PGM端低电平时可编程，接高电平Vee时 可按只读方式工作,CE为片信号，分别与不同的译码输出端相连。 -IMA19A18A17 。 I  A 16  BHE  A。 A1s  A1  CPU  587 lDD D  Do-RD-WR  图4.40例4.3CPU与存储芯片的连接图"}
{"doc_id": "co", "page": 106, "text": "100 第2篇计算机系统的硬件结构 的校验 在计算机运行过程中，由于种种原因致使数据在存储过程中可能出现差错。为了能及时发 现错误并及时纠正错误，通常可将原数据配成汉明编码。 1.汉明码的组成 汉明码是由RichardHanming于1950年提出的，它具有一位纠错能力。 由编码纠错理论得知，任何一种编码是否具有检测能力和纠错能力，都与编码的最小距离有关。 所谓编码最小距离，是指在一种编码系统中，任意两组合法代码之间的最少二进制位数的差异。 根据纠错理论得 L-l=D+C且D~C 即编码最小距离L越大，则其检测错误的位数D越大，纠正错误的位数C也越大，且纠错能力恒 小于或等千检错能力。例如，当编码最小距离L=3时，这种编码可视为最多能检错二位，或能检 错一位、纠错一位。可见，倘若能在信息编码中增加若干位检测位，增大L，显然便能提高检错和 纠错能力。汉明码就是根据这一理论提出的具有一位纠错能力的编码。 设欲检测的二进制代码为n位，为使其具有纠错能力，需增添K位检测位，组成n+k位的代 码。为了能准确对错误定位以及指出代码没错，新增添的检测位数K应满足： 2k~n+k+l  由此关系可求得不同代码长度n所需检测位的位数K，如表4.2所示。 表4.2代码长度与检测位位数的关系 n k（最小） 1 2  2~4 3  5~ 11 4  12~26 5  27~57 6  58 ~ 120 7  k的位数确定后，便可由它们所承担的检测任务设定它们在被传送代码中的位置及它们的取值。 设n+k位代码自左至右依次编为第1,2,3,…，n+k位，而将K位检测位记作C;(i=l,2,4, 8,…），分别安插在n+k位代码编号的第1,2, 4, 8, · · ·, 2 k-l位上。这些检测位的位置设置是为了 保证它们能分别承担n+k位信息中不同数位所组成的“小组”的奇偶检测任务，使检测位和它所 负责检测的小组中1的个数为奇数或偶数，具体分配如下： 凡检测的gl小组包含1,3,5,7,9,11,…位。 凡检测的g2小组包含2,3, 6, 7, 10, 11, 14, 15,…位。"}
{"doc_id": "co", "page": 107, "text": "第4章存储器101  凡检测的g3小组包含4,5,6,7,12,13,l4,15,…位。 立检测的g4小组包含8,9, 10, 11, 12, 13, 14, 15, 24,…位。 其余检测位的小组所包含的位也可类推。这种小组的划分有如下特点： 心每个小组gl有一位且仅有一位为它所独占，这一位是其他小组所没有的，即gl小组独占 第2l-1位(i=l,2,3,…）。 ＠每两个小组gl和gj共同占有一位是其他小组没有的，即每两小组g和gj共同占有第 2l-l +2j4位(i,j=1, 2,…)。 ＠每3个小组gl、gj和gz共同占有第2l-l+2j-l+2[-1位，是其他小组所没有的。 依次类推，便可确定每组所包含的各位。 例如，欲传递信息为b山山九(n= 4)，根据2k~n+k+l，可求出配置成汉明码需增添检测 位k=3，且它们位置的安排如下： 勹；序号1 ;1 :2 :4 :4 : : :l  如果按配偶原则来配置汉明码，则凡应使l、3、5、7位中的“1”的个数为偶数；化应使2、3、 6、7位中的“1”的个数为偶数；立应使4、5、6、7位中的“1”的个数为偶数。 故凡应为3位05位EB7位，即c1=h4 EB b3 EB h1；化应为3位EB6位面7位，即C2_=b4(f) b2 EB bl；凡应为5位EB6位EB7位，即C4=b3令b2EB bl o  令b4b3b九＝0101，则 cl =h4 EB h3 EB h1 =O EB 1 EB 1=0  立＝b4EB b2邑bl=0 EBO EB 1 = 1  立＝63EB h2 EB bl= 1 EB O EB 1 = 0  故0101的汉明码应为cl亿凡立扒h2h1，即0100101。 2.汉明码的纠错过程 汉明码的纠错过程实际上是对传送后的汉明码形成新的检测位P;(i=l,2,4,8,…），根据P, 的状态，便可直接指出错误的位置。E的状态是由原检测位C，及其所在小组内“1”的个数确定 的。倘若按配偶原则配置的汉明码，其传送后形成新的检测位P，应为0，否则说明传送有错，并 且还可直接指出出错的位置。由千E与C1有对应关系，故P1可由下式确定： P1=1EB3EB5EB7，即pl=Cl EB h4 EB b3 EB bl  P2=2 EB 3 EB 6 EB 7，即P2 = c2 EB h4 EB h2 EB h1  P4=4 EB 5 EB 6 EB 7，即凡＝C4EB b3 EB h2 EB bl  设已知传送的正确汉明码（按配偶原则配置）为0100101，若传送后接收到的汉明码为 0100111，其出错位可按下述步骤确定。 令"}
{"doc_id": "co", "page": 108, "text": "102 第2篇计算机系统的硬件结构 二进制序号1 2 3 4 5 6 7  正确的汉明码。1 。。1 。1  接收到的汉明码。1 。。1 1 1  则新的检测位为 贮＝4Ef)5Ef>6Ef)7，即P4=0Ef> 1 Ef> 1 Ef> 1=1  P2=2EB3EB6令7，即P2=lEBO EB 1 EB 1=1  P1=1EB3令5O7，即P1=0EBO令14)1=0 由此可见，传送结果凡和p2均不呈偶数，显然出了差错。那么，错在哪一位呢？仔细分析 发现，只有第6位出错才会同时使贮和P2不呈偶数。同时，P4、P2..,P 1所构成的二进制值恰恰 是出错的位置，即P4P2P1= 110，表示第6位出错。发现错误后，计算机便自动将错误的第6位 \" 1\"纠正为“O\"。 又如，若收到按偶配置的汉明码为1100101，则经检测得 贮＝4邑5面6EB 7，即P4=0EBlEBO令1=0 贮＝2Ef)3Ef)6Ef)7，即P2=lEBOEBOEB 1=0  P1=1EB3EB5EB7，即P1=lEBO EB 1 EB 1=1  即P4P 2P 1 = 001，表示第1位出错。由于第1位不是欲传送的信息位，而是检测位，而检测位 不参与运算，故在一般情况下可以不予纠正。 以上均以n=4为例，其实对任意不同n位的信息，均可按上述步骤配置汉明码，即先求出需 增加的检测位位数K，再确定Ci的位置，然后，按奇或偶原则配置C1各位的值即可。值得注意的 是：按奇配置与按偶配置所求得的C，值正好相反，而新的检测位E的取值与奇偶配置原则是相 对应的，读者可自行分析。 汉明码常常被用在纠错一位的场合，若欲实现检错两位，实用时还得再增添一位检测位。 例4.4已知接收到的汉明码为0110101（按配偶原则配置），试问欲传送的信息是什么？ 解：由于要求出欲传送的信息，必须是正确的信息，因此不能简单地从接收到的7位汉明 码中去掉Cl、立、立这3位检测位来求得。首先应该判断收到的信息是否出错。纠错过 程如下： P1=1EB3EB5令7=1 P2 =2令3Ef)6Ef)7=1 贮＝4邑5令6Ef)7=0 所以，P4贮P1=011，第3位出错，可纠正为0100101，故欲传送的信息为0101。 例4.5按配奇原则配置1100101的汉明码。 解：根据1100101，得n=7。根据2k~n+k+l，可求出需增添k=4位检测位，各位的安 排如下："}
{"doc_id": "co", "page": 109, "text": "第4章存储器103  一进制序号 汉明码 按配奇原则配置，则 C 1 = 3Et)5(:87邑9Et)ll= 1  立＝3Et)6面7面lOEE)ll=l 立＝5Et)6(:87= 0  C8 =9Et)10(:811 = 1  故新配置的汉明码为11101001101。 1 2 3 4 5 6 7 8 9 10 11  cl c2 1 c4 1 · o o cs 1 o 1  随着计算机应用领域的不断扩大，处理的信息量越来越多，对存储器的工作速度和容量要求 也越来越高。此外，因CPU的功能不断增强，I/0设备的数量不断增多，致使主存的存取速度已 成为计算机系统的瓶颈。可见，提高访存速度也成为迫不及待的任务。为了解决此问题，除了寻 找高速元件和采用层次结构以外，调整主存的结构也可提高访存速度。 1.单体多字系统 由于程序和数据在存储体内是连续存放的，因此CPU访存取出的信息也是连续的，如果可 以在一个存取周期内，从同一地址取出4条指令，然后再逐条将指令送至CPU执行，即每隔1/4 存取周期，主存向CPU送一条指令，这样显然增大了存储器的带宽，提高了单体存储器的工作速 度，如图4.41所示。 主存控制器 地址寄存器 数据寄存器 存储体 图4.41单体四字结构存储器 图中示意了一个单体四字结构的存储器，每字W位。按地址在一个存取周期内可读出4xW 位的指令或数据，使主存带宽提高到4倍。显然，采用这种办法的前提是：指令和数据在主存内 必须是连续存放的，一旦遇到转移指令，或者操作数不能连续存放，这种方法的效果就不明显。"}
{"doc_id": "co", "page": 110, "text": "104 第2篇计算机系统的硬件结构 2.多体并行系统 多体并行系统就是采用多体模块组成的存储器。每个模块有相同的容量和存取速度，各模 块各自都有独立的地址寄存器(MAR)、数据寄存器(MDR)、地址译码、驱动电路和读／写电路， 它们能并行工作，又能交叉工作。 并行工作即同时访问N个模块，同时启动，同时读出，完全并行地工作（不过，同时读出的N 个字在总线上需分时传送）。图4.42是适合于并行工作的高位交叉编址的多体存储器结构示意 图，图中程序因按体内地址顺序存放（一个体存满后，再存入下一个体），故又有顺序存储之称。 显然，高位地址可表示体号，低位地址为体内地址。按这种编址方式，只要合理调动，使不同的请 求源同时访问不同的体，便可实现并行工作。例如，当一个体正与CPU交换信息时，另一个体可 同时与外部设备进行直接存储器访问，实现两个体并行工作。这种编址方式由于一个体内的地 址是连续的，有利于存储器的扩充。 地址M。M1 M2 M3  厂·一一 }  匕归二＿i产＿＿归一气气＿一气芒n 1--- }  图4.42高位交叉编址的多体存储器 图4.43是按低位交叉编址的多体模块结构示意图。由于程序连续存放在相邻体中，故又有 交叉存储之称。显然低位地址用来表示体号，高位地址为体内地址。这种编址方法又称为模M 编址(M等千模块数），表4.3列出了模4交叉编址的地址号。一般模块数M取2的方幕，使硬 件电路比较简单。有的机器为了减少存储器冲突，采用质数个模块，例如，我国银河机的M为 31，其硬件实现比较复杂。 表4.3模4交叉编址地址表 体号体内地址序号最低两位地址 M。0,4,8,12,…,4i+O 00  Ml 1,5,9,13,···,4i+l 01  M2 2,6,10,14,…,4i+2 10  M3 3, 7, 11, 15,.. ·, 4i+ 3 11"}
{"doc_id": "co", "page": 111, "text": "第4章 存储器 105  M。M1 M2  l---  l i4n-3  I  一一一今一一一一一 37 M3  l  ln -4 rllIIIl  体号 图4.43低位交叉编址的多体存储器 多体模块结构的存储器采用交叉编址后，可以在不改变每个模块存取周期的前提下，提高存 储器的带宽。图4.44示意了CPU交叉访问4个存储体的时间关系，负脉冲为启动每个体的工作 信号。虽然对每个体而言，存取周期均未缩短，但由于CPU交叉访问各体，使4个存储体的读／ 写过程重叠进行，最终在一个存取周期的时间内，存储器实际上向CPU提供了4个存储字。如 果每个模块存储字长为32位，则在一个存取周期内（除第一个存取周期外），存储器向CPU提供 了32x4=128位二进制代码，大大增加了存储器的带宽。 时间 启动存储体0 启动存储体3 l单体访存周期1单体访存周期 l -－l工 I I I I I I I I I I I I I l  丿 I I  勹 I I  i l  ! l  I I  } I  I I I  l l  ___  T1111  ___  1  12 体体储储存存动动启启 图4.444个存储体交叉访问的时间关系 假设每个体的存储字长和数据总线的宽度一致，并假设低位交叉的存储器模块数为n，存取 周期为T，总线传输周期为T，那么当采用流水线方式（如图4.44所示）存取时，应满足T=nr。为 了保证启动某体后，经m时间再次启动该体时，它的上次存取操作已完成，要求低位交叉存储器 的模块数大于或等千n。以四体低位交叉编址的存储器为例，采用流水方式存取的示意图如图 4.45所示。"}
{"doc_id": "co", "page": 112, "text": "106 第2篇计算机系统的硬件结构 可见，对千低位交叉的存储器，连续读取n个字所需的时间tl为 t1 =T+(n-l)r  若采用高位交叉编址，则连续读取n个字所需的 时间t2为 t2 =nT  字i体号 例4.6设有4个模块组成的四体存储器结构，每 个体的存储字长为32位，存取周期为200ns。假设数 据总线宽度为32位，总线传输周期为50ns，试求顺序 存储和交叉存储的存储器带宽。 解：顺序存储（高位交叉编址）和交叉存储（低位交 叉编址）连续读出4个字的信息量是32X4=128位。 顺序存储存储器连续读出4个字的时间是 200 nsX4 = 800 ns = 8x 10-7 s  玑队M2MI玑咒咒咒 Wlwo 时间 图4.45四体低位交叉编址存储器流 水线工作方式示意图 交叉存储存储器连续读出4个字的时间是 200 ns+50 nsx(4-1)= 350 ns=3.5x10-7 s  顺序存储器的带宽是 128/(8x10-7)= 16xl07 bps  交叉存储器的带宽是 128/(3.Sxl0-7)= 37xl07 bps  多体模块存储器不仅要与CPU交换信息，还要与辅存、I/0设备，乃至I/0处理机交换信 息。因此，在某一时刻，决定主存究竟与哪个 部件交换信息必须由存储器控制部件（简称存 控）来承担。存控具有合理安排各部件请求访 问的顺序以及控制主存读／写操作的功能。图 4.46是一个存控基本结构框图，它由排队器、 控制线路、节拍发生器及标记触发器等组成。 (1)排队器 由于要求访存的请求源很多，而且访问都 是随机的，这样有可能在同一时刻出现多个请· 义 求源请求访问同一个存储体。为了防止发生来自各个请求源 两个以上的请求源同时占用同一存储体，并防图4.46存控基本结构框图 止将代码错送到另一个请求源等各种错误的 发生，在存控内需设置一个排队器，由它来确定请求源的优先级别。其确定原则如下： CD对易发生代码丢失的请求源，应列为最高优先级，例如，外设信息最易丢失，故它的级 别最高。 控制信号 主脉冲"}
{"doc_id": "co", "page": 113, "text": "第4章存储器107  ＠对严重影响CPU工作的请求源，给予次高优先级，否则会导致CPU工作失常。 例如，写数请求高于读数，读数请求高千读指令。若运算部件不能尽快送走已算出的结果， 会严重影响后续指令的执行，因此，发生这种情况时，写数的优先级比读数、读指令都高。若没有 操作数参与运算，取出更多的指令也无济千事，故读数的优先级又应比读指令高。 (2)存控标记触发器CM 它用来接受排队器的输出信号，一旦响应某请求源的请求，臼被置“1\"，以便启动节拍发生器工作。 (3)节拍发生器 它用来产生固定节拍，与机器主脉冲同步，使控制线路按一定时序发出信号。 (4)控制线路 由它将排队器给出的信号与节拍发生器提供的节拍信号配合，向存储器各部件发出各种控 制信号，用以实现对总线控制及完成存储器读／写操作，并向请求源发出回答信号，表示存储器已 响应了请求等。 3.高性能存储芯片 采用高性能存储芯片也是提高主存速度的措施之一。DRAM集成度高，价格便宜，广泛应用 于主存。其发展速度很快，几乎每隔3年存储芯片的容量就翻两番。为了进一步提高DRAM的 性能，人们开发了许多对基本DRAM结构的增强功能，出现了SDRAM、RDRAM和CDRAM。 (1) SDRAM (Synchronous DRAM，同步DRAM) SDRAM与常用的异步DRAM不同，它与处理器的数据交换同步千系统的时钟信号，并且以 处理器－存储器总线的最高速度运行，而不需要插入等待状态。典型的DRAM中，处理器将地址 和控制信号送至存储器后，需经过一段延时，供DRAM执行各种内部操作（如输入地址、读出数 据等），才能将数据从存储器中读出或将数据写入存储器中。此时，如果CPU的速度与DRAM 匹配，那么这个延时不会影响CPU的工作速度；如果CPU的速度更高，那么在这段时间内，CPU 只能”等待＂，降低了CPU的执行速度。而SDRAM能在系统时钟的控制下进行数据的读出和写 入，CPU给出的地址和控制信号会被SDRAM锁存，直到指定的时钟周期数后再响应。此时CPU 可执行其他任务，无须”等待＂。例如，系统的时钟周期为10ns，存储器接到地址后需50ns读出 数据。对于异步工作的DRAM,CPU要”等待“50ns获得数据，而对同步工作的SDRAM而言， CPU只需把地址放入锁存器中，在存储器进行读操作期间去完成其他操作。当CPU计时到5个 时钟周期后，便可获得从存储器读出的数据。 SDRAM还支持猝发访问模式，即CPU发出一个地址就可以连续访问一个数据块（通常为 32字节）。SDRAM芯片内还可以包含多个存储体，这些体可以轮流工作，提高访问速度。现在 又出现了双数据速率的SDRAM(Double Data Rate SD RAM, DDR-SDRAM)，它是SDRAM的增强 型版本，可以每周期两次向处理器送出数据。 (2) RD RAM (Rambus DRAM)  由Rambus开发的RDRAM采用专门的DRAM和高性能的芯片接口取代现有的存储器接 口。它主要解决存储器带宽的问题，通过高速总线获得存储器请求（包括操作时所需的地址、操"}
{"doc_id": "co", "page": 114, "text": "108 第2篇计算机系统的硬件结构 作类型和字节数），总线最多可寻址320块RDRAM芯片，传输率可达1.6GBps。它不像传统的 DRAM采用RAS、CAS和《妇言号来控制，而是采用异步的面向块的传输协议传送地址信息和 数据信息。一个RDRAM芯片就像一个存储系统，通过一种新的互连电路RamLink，将各个 RDRAM芯片连接成一个环，数据通信在主存控制器的控制下进行，数据交换以包为单位。图 4.47示意了RarnLink体系结构。 主存控制器 图4.47 RamLink体系结构 (3)带Cache的DRAM(CD RAM)  带Cache的DRAM是在通常的DRAM芯片内又集成了一个小的SRAM，又称增强型的 DRAM(EDRAM)。图4.48是1Mx4位的CDRAM，其中SRAM为512x4位，DRAM排列成2048x 512X4位的阵列。 列译码器 512X4位SRAM Cache（最后读出行）I/0控制ID3~D。 晶 锁存器1数据 读出放大和列写选择 通 S 新F 选 RA 刷RE 行 行译1DRAM阵列 码2048X512X4位 器 写命令 读命令 片选中 图4.481 Mx4位CDRAM芯片结构框图 由图中可见，地址引脚线只有11根(A10~A。)，而1Mx4位的存储芯片对应20位地址，此 20位地址需分时送入芯片内部。首先在行选通信号作用下，高11位地址经地址引脚线输入，分 别保存在行地址锁存器中和最后读出行地址锁存器中。在DRAM的2048行中，此指定行地址"}
{"doc_id": "co", "page": 115, "text": "第4章存储器109  的全部数据512x4位被读到SRAM中暂存。然后在列选通信号作用下，低9位地址经地址引脚 线输入，保存到列地址锁存器中。在读命令有效时，512个4位组的SRAM中某一4位组被这个 列地址选中，经数据线D3~D。从芯片输出。 下一次读取时，输入的行地址立即与最后读出行锁存器的内容进行11位比较。若比较相 符，说明该数据在SRAM中，再由输入列地址选择某一4位组输出；若比较不相符，则需驱动 DRAM阵列更新SRAM和最后读出行地址锁存器中的内容，并送出指定的4位组。 由此可见，以SRAM保存一行内容的方法，当对连续高11位地址相同（属千同一行地址）的 数据进行读取时，只需连续变动9位列地址就可使相应的4位组连续读出，这被称为猝发式读 取，对成块传送十分有利。 从图4.48所示的结构可见，芯片内的数据输出路径（由SRAM到I/0)与数据输入路径（由 I/0到读放大器和列写选择）是分开的，这就允许在写操作完成的同时启动同一行的读操作。此 外，在SRAM读出期间可同时对DRAM阵列进行刷新。 3 高速缓冲存储器 1.问题的提出 在多体并行存储系统中，由于I/0设备向主存请求的级别高于CPU访存，这就出现了CPU 等待I/0设备访存的现象，致使CPU空等一段时间，甚至可能等待几个主存周期，从而降低了 CPU的工作效率。为了避免CPU与I/0设备争抢访存，可在CPU与主存之间加一级缓存（参见 图4.3)，这样，主存可将CPU要取的信息提前送至缓存，一旦主存在与I/0设备交换时，CPU可 直接从缓存中读取所需信息，不必空等而影响效率。 从另一角度来看，主存速度的提高始终跟不上CPU的发展。据统计，CPU的速度平均每年 改进60%，而组成主存的动态RAM速度平均每年只改进7%，结果是CPU和动态RAM之间的速 度间隙平均每年增大50%。例如，100MHz的Pentium处理器平均每10ns就执行一条指令，而 动态RAM的典型访问时间为60~ 120 ns。这也希望由高速缓存Cache来解决主存与CPU速度 的不匹配问题。 Cache的出现使CPU可以不直接访问主存，而与高速Cache交换信息。那么，这是否可能 呢？通过大量典型程序的分析，发现CPU从主存取指令或取数据，在一定时间内，只是对主存局 部地址区域的访问。这是由于指令和数据在主存内都是连续存放的，并且有些指令和数据往往 会被多次调用（如子程序、循环程序和一些常数），即指令和数据在主存的地址分布不是随机的， 而是相对的簇聚，使得CPU在执行程序时，访存具有相对的局部性，这就称为程序访问的局部性"}
{"doc_id": "co", "page": 116, "text": "110 第2篇计算机系统的硬件结构 原理。根据这一原理，很容易设想，只要将CPU近期要用到的程序和数据提前从主存送到 Cache，那么就可以做到CPU在一定时间内只访问Cache。一般Cache采用高速的SRAM制作， 其价格比主存贵，但因其容量远小于主存，因此能很好地解决速度和成本的矛盾。 2. Cache的工作原理 图4.49是Cache－主存存储空间的基本结构示意图。 主存由2n个可编址的字组成，每个字有唯一的n位地址。为了与Cache映射，将主存与缓 存都分成若干块，每块内又包含若干个字，并使它们的块大小相同（即块内的字数相同）。这就 将主存的地址分成两段：高m位表示主存的块地址，低b位表示块内地址，则2m=M表示主存的 块数。同样，缓存的地址也分为两段：高c位表示缓存的块号，低b位表示块内地址，则2c= C表 示缓存块数，且C远小千M。主存与缓存地址中都用b位表示其块内字数，即B=2b反映了块的 大小，称B为块长。 主存主存块号标记Cache 缓存块号 2111-1  字块0 字块1 字块M-1 。 2C-l  字块0 字块1 字块C-1 n位 m位Ib位 主存块号1块内地 M块B个字言 图4.49Cache－主存存储空间的基本结构 任何时刻都有一些主存块处在缓存块中。CPU欲读取主存某字时，有两种可能：一种是 所需要的字巳在缓存中，即可直接访问Cache(CPU与Cache之间通常一次传送一个字）；另 种是所需的字不在Cache内，此时需将该字所在的主存整个字块一次调入Cache中(Cache与 主存之间是字块传送）。如果主存块已凋入缓存块，则称该主存块与缓存块建立了对 应关系。"}
{"doc_id": "co", "page": 117, "text": "第4章存储器lll  上述第一种情况为CPU访问Cache命中，第二种情况为CPU访问Cache不命中。由于缓存 的块数C远小于主存的块数M，因此，一个缓存块不能唯一地、永久地只对应一个主存块，故每 个缓存块需设一个标记（参见图4.49)，用来表示当前存放的是哪一个主存块，该标记的内容相 当于主存块的编号。CPU读信息时，要将主存地址的高m位（或m位中的一部分）与缓存块的 标记进行比较，以判断所读的信息是否已在缓存中（参见图4.54)。 Cache的容量与块长是影响Cache效率的重要因素，通常用”命中率”来衡量Cache的效率。 命中率是指CPU要访问的信息已在Cache内的比率。 在一个程序执行期间，设NC为访问Cache的总命中次数，凡为访问主存的总次数，则命中 率h为 h=队 凡＋Nm 设tc为命中时的Cache访问时间，tm为未命中时的主存访问时间，1-h表示未命中率，则 Cache－主存系统的平均访问时间t”为 ta= htc + (1-h) tm  当然，以较小的硬件代价使Cache－主存系统的平均访问时间ta越接近于tc越好。用e表示 访问效率，则有 e=_:_Xl00%=~X100% ta --.. ht c + (1 -h) t m  可见，为提高访问效率，命中率h越接近1越好。 例4.7假设CPU执行某段程序时，共访问Cache命中20 00次，访问主存50次。已知 Cache的存取周期为50ns，主存的存取周期为200ns。求Cache－主存系统的命中率、效率和平 均访问时间。 解：（1)Cache的命中率为 2000/ (2000+50) = 0.97  (2)由题可知，访问主存的时间是访问Cache时间的4倍(200/50= 4)。 设访问Cache的时间为t，访问主存的时间为4t,Cache－主存系统的访问效率为e，则 访问Cache的时间 X100%  (3)平均访问时间为 e =  平均访问时间 X 100% = 91. 7% 0. 97Xt+ (1-0. 97) X4t  50 nsX0.97 +200 nsX (1-0.97) = 54.5 ns  一般而言，Cache容量越大，其CPU的命中率就越高。当然容量也没必要太大，太大会增加 成本，而且当Cache容量达到一定值时，命中率已不因容量的增大而有明显的提高。因此，Cache 容量是总成本价与命中率的折中值。例如，80386的主存最大容量为4GB，与其配套的Cache容"}
{"doc_id": "co", "page": 118, "text": "112 第2篇计算机系统的硬件结构 量为16KB或32KB，其命中率可达95％以上0 块长与命中率之间的关系更为复杂，它取决千各程序的局部特性。当块由小到大增长时，起 初会因局部性原理使命中率有所提高。由局部性原理指出，在已被访问字的附近，近期也可能被 访问，因此，增大块长，可将更多有用字存入缓存，提高其命中率。可是，倘若继续增大块长，命中 率很可能下降，这是因为所装入缓存的有用数据反而少千被替换掉的有用数据。由于块长的增 大，导致缓存中块数的减少，而新装入的块要覆盖旧块，很可能出现少数块刚刚装入就被覆盖，因 此命中率反而下降。再者，块增大后，追加上的字距离已被访问的字更远，故近期被访问的可能 性会更小。块长的最优值是很难确定的，一般每块取4至8个可编址单位（字或字节）较好，也 可取一个主存周期所能调出主存的信息长度。例如，CRAY-1的主存是16体交叉，每个体为单 字宽，其存放指令的Cache块长为16个字。又如，IBM370/168机主存是4体交叉，每个体宽为 64位(8个字节），其Cache块长为32个字节。 3.· Cache的基本结构 Cache的基本结构原理框图如图4.50所示。 地址总线 主存地址1块号1块内地址 访问主存 替换C 主 存 访问主存装入Cachei  I Y  直接通路 Cache地址， 块号1块内地址 CPU  数据总线 图4.50Cache的基本结构原理框图 它主要由Cache存储体、地址映射变换机构、Cache替换机构几大模块组成。 (1) Cache存储体 Cache存储体以块为单位与主存交换信息，为加速Cache与主存之间的调动，主存大多采用 多体结构，且Cache访存的优先级最高。 (2)地址映射变换机构 地址映射变换机构是将CPU送来的主存地址转换为Cache地址。由千主存和Cache的块 大小相同，块内地址都是相对千块的起始地址的偏移量（即低位地址相同），因此地址变换主要"}
{"doc_id": "co", "page": 119, "text": "第4章存储器113  是主存的块号（高位地址）与Cache块号间的转换。而地址变换又与主存地址以什么样的函数 关系映射到Cache中（称为地址映射）有关，这些内容可详见4.3.2节。 如果转换后的Cache块已与CPU欲访问的主存块建立了对应关系，即已命中，则CPU可 直接访问Cache存储体。如果转换后的Cache块与CPU欲访问的主存块未建立对应关系，即 不命中，此刻CPU在访问主存时，不仅将该字从主存取出，同时将它所在的主存块一并调入 Cache，供CPU使用。当然，此刻能将主存块调入Cache内，也是由千Cache原来处于未被装 满的状态。反之，倘若Cache原来已被装满，即已无法将主存块调入Cache内时，就得采用替 换策略。 (3)替换机构 当Cache内容已满，无法接受来自主存块的信息时，就由Cache内的替换机构按一定的替换 算法来确定应从Cache内移出哪个块返回主存，而把新的主存块调入Cache。有关替换算法详见 4.3.3节。 特别需指出的是，Cache对用户是透明的，即用户编程时所用到的地址是主存地址，用户根 本不知道这些主存块是否已调入Cache内。因为，将主存块调入Cache的任务全由机器硬件自 动完成。 (4) Cache的读写操作 读操作的过程可用流程图4.51来描述。当CPU发出主存地址后，首先判断该存储字是否 在Cache中。若命中，直接访问Cache，将该字送至CPU；若未命中，一方面要访问主存，将该字 传送给CPU，与此同时，要将该字所在的主存块装入Cache，如果此时Cache已装满，就要执行替 换算法，腾出空位才能将新的主存块调入。 CPU发出访问地址 访问Cache 取出信息送CPU N  访问主存取出 信息送CPU 图4.51Cache的读数操作流程"}
{"doc_id": "co", "page": 120, "text": "114 第2篇计算机系统的硬件结构 写操作比较复杂，因为对Cache块内写入的信息，必须与被映射的主存块内的信息完全一 致。当程序运行过程中需对某个单元进行写操作时，会出现如何使Cache与主存内容保持一致 的问题。目前主要采用以下几种方法。 少写直达法(Write-through)，又称为存直达法（Store-through)，即写操作时数据既写入 Cache又写入主存。它能随时保证主存和Cache的数据始终一致，但增加了访存次数。 ＠写回法(Write-back)，又称为拷回法(Copy-back)，即写操作时只把数据写入Cache而不 写入主存，但当Cache数据被替换出去时才写回主存。可见写回法Cache中的数据会与主存中 的不一致。为了识别Cache中的数据是否与主存一致，Cache中的每一块要增设一个标志位，该 位有两个状态：“清＂（表示未修改过，与主存一致）和＂浊＂（表示修改过，与主存不一致）。在 Cache替换时，“清＂的Cache块不必写回主存，因为此时主存中相应块的内容与Cache块是一致 的。在写Cache时，要将该标志位设置为＂浊＂，替换时此Cache块要写回主存，同时要使标志位 为“清”。 写回法和写直达法各有特色。在写直达法中，由于Cache中的数据始终和主存保持一致， 在读操作Cache失效时，只需选择一个替换的块（主存块）调入Cache，被替换的块(Cache块） 不必写回主存。可见读操作不涉及对主存的写操作。因此这种方法更新策略比较容易实现。 但是在写操作时，既要写入Cache又要写入主存，因此写直达法的”写“操作时间就是访问主 存的时间。 在写回法中，写操作时只写入Cache，故”写“操作时间就是访问Cache的时间，因此速度快。 这种方法对主存的写操作只发生在块替换时，而且对Cache中一个数据块的多次写操作只 次写入主存，因此可减少主存的写操作次数。但在读操作Cache失效时要发生数据替换，引起被 替换的块写回主存的操作，增加了Cache的复杂性。 对千有多个处理器的系统，各自都有独立的Cache，且都共享主存，这样又出现了新问题。 即当一个缓存中数据被修改时，不仅主存中相对应的字无效，连同其他缓存中相对应的字也无效 （当然恰好其他缓存也有相应的字）。即使通过写直达法改变了主存的相应字，而其他缓存中数 据仍然无效。显然，解决系统中Cache一致性的问题很重要。当今研究Cache一致性问题非常 活跃，想进一步了解可查阅有关资料。 4. Cache的改进 Cache刚出现时，典型系统只有一个缓存，近年来普遍采用多个Cache。其含义有两方面：一 是增加Cache的级数；二是将统一的Cache变成分立的Cache。 (1)单一缓存和两级缓存 所谓单一缓存，是指在CPU和主存之间只设一个缓存。随着集成电路逻辑密度的提高，又 把这个缓存直接与CPU制作在同一个芯片内，故又称为片内缓存（片载缓存）。片内缓存可以提 高外部总线的利用率，因为将Cache制作在芯片内，CPU直接访问Cache不必占用芯片外的总线 （系统总线），而且片内缓存与CPU之间的数据通路很短，大大提高了存取速度，外部总线又可更 多地支持I/0设备与主存的信息传输，增强了系统的整体效率。例如，Intel80486 CPU芯片内就"}
{"doc_id": "co", "page": 121, "text": "第4章存储器115  含8KB的片内缓存。 可是，由千片内缓存在芯片内，其容量不可能很大，这就可能致使CPU欲访问的信息不在缓 存内，势必通过系统总线访问主存，访问次数多了，整机速度就会下降。如果在主存与片内缓存 之间再加一级缓存，称为片外缓存，由比主存动态RAM和ROM存取速度更快的静态RAM组 成。而且不使用系统总线作为片外缓存与CPU之间的传送路径，使用一个独立的数据路径，以 减轻系统总线的负担。那么，从片外缓存调入片内缓存的速度就能提高，而CPU占用系统总线 的时间也就大大下降，整机工作速度有明显改进。这种由片外缓存和片内缓存组成的Cache称 为两级缓存，并称片内缓存为第一级，片外缓存为第二级。随着芯片集成度的提高，已有一些处 理器将第二级Cache结合到处理器芯片上，改善了性能。 (2)统一缓存和分立缓存 统一缓存是指指令和数据都存放在同一缓存内的Cache；分立缓存是指指令和数据分别存 放在两个缓存中，一个称为指令Cache，另一个称为数据Cache。两种缓存的选用主要考虑如下 两个因素。 其一，它与主存结构有关，如果计算机的主存是统一的（指令、数据存储在同一主存内），则 相应的Cache采用统一缓存；如果主存采用指令、数据分开存储的方案，则相应的Cache采用分 立缓存。 其二，它与机器对指令执行的控制方式有关。当采用超前控制或流水线控制方式时，一般都 采用分立缓存。 所谓超前控制，是指在当前指令执行过程尚未结束时就提前将下一条准备执行的指令取 出，称为超前取指或指令预取。所谓流水线控制实质上是多条指令同时执行（详见第8章）， 又可视为指令流水。当然，要实现同时执行多条指令，机器的指令译码电路和功能部件也需 多个。超前控制和流水线控制特别强调指令的预取和指令的并行执行，因此，这类机器必须 将指令Cache和数据Cache分开，否则可能出现取指和执行过程对统一缓存的争用。如果此 刻采用统一缓存，则在执行部件向缓存发出取数请求时，一旦指令预取机构也向缓存发出取 指请求，那么统一缓存只能先满足执行部件请求，将数据送到执行部件，而让取指请求暂时等 待，显然达不到预取指令的目的，从而影响指令流水的实现。可见，这类机器将两种缓存分立 尤为重要。 图4.52为Pentium4处理器框图。 图中有两级共3个Cache，其中一级Cache分Ll指令Cache和Ll数据Cache，另外还有一个 二级12Cache。"}
{"doc_id": "co", "page": 122, "text": "116 第2篇计算机系统的硬件结构 L1指令Cache (12 KB µops)  L1数据Cache(8KB)  图4.52Pentium 4处理器框图 图4.53是PowerPC620处理器的示意图。 整数1整数1整数 ALU I ALU I ALU  图4.53PowerPC 620处理器框图 系统总线 图中也有两个Cache。数据Cache通过存／取单元支持整数和浮点操作；指令Cache为只读 存储器，支持指令单元。执行部件是3个可并行操作的整数ALU和一个浮点运算部件（有独 的寄存器和乘、加、除部件）。"}
{"doc_id": "co", "page": 123, "text": "第4章存储器117  由主存地址映射到Cache地址称为地址映射。地址映射方式很多，有直接映射（固定的映射 关系）、全相联映射（灵活性大的映射关系）、组相联映射（上述两种映射的折中）。 1.直接映射 图4.54示出了直接映射方式主存与缓存中字块的对应关系。 ＊假设Cache字块地址字段 的内容为00…01 t位Cache主存 *  I I  标记1字块2e-ll 不命中 主存地址I主存字块ICache I 字块 标记字块地址内地址 t位c位b位 —丿m位 图4.54直接映射 图中每个主存块只与一个缓存块相对应，映射关系式为 i=j mod C或i=jmod 2c  其中，i为缓存块号，j为主存块号，C为缓存块数。映射结果表明每个缓存块对应若干个主存块， 如表4.4所示。 缓存块 表4。4直接映射方式主存块和缓存块的对应关系 主存块 。 0, C,.. ·, 2m -C  1, C + 1,.. ·, 2\"'-C + 1  C -1 C-1,2C-1,.. ·,2\"'-1  这种方式的优点是实现简单，只需利用主存地址的某些位直接判断，即可确定所需字块是否 在缓存中。由图4.54可见，主存地址高m位被分成两部分：低c位是指Cache的字块地址，高t 位(t= m-c)是指主存字块标记，它被记录在建立了对应关系的缓存块的”标记”位中。当缓存接"}
{"doc_id": "co", "page": 124, "text": "118 第2篇计算机系统的硬件结构 到CPU送来的主存地址后，只需根据中间c位字段（假设为00…01)找到Cache字块1，然后根 据字块l的”标记”是否与主存地址的高t位相符来判断，若符合且有效位为“1”（有效位用来识 别Cache存储块中的数据是否有效，因为有时Cache中的数据是无效的，例如，在初始时刻Cache 应该是“空”的，其中的内容是无意义的），表示该Cache块巳和主存的某块建立了对应关系（即 己命中），则可根据b位地址从Cache中取得信息；若不符合，或有效位为“0\"（即不命中），则从 主存读入新的字块来替代旧的字块，同时将信息送往CPU，并修改Cache”标记＂。如果原来有效 位为“0”，还得将有效位置成“1”。 直接映射方式的缺点是不够灵活，因每个主存块只能固定地对应某个缓存块，即使缓存内还 空着许多位置也不能占用，使缓存的存储空间得不到充分的利用。此外，如果程序恰好要重复访 间对应同一缓存位置的不同主存块，就要不停地进行替换，从而降低命中率。 2.全相联映射 全相联映射允许主存中每一字块映射到Cache中的任何一块位置上，如图4.55所示。这种 映射方式可以从已被占满的Cache中替换出任一旧字块。显然，这种方式灵活，命中率也更高， 缩小了块冲突率。与直接映射相比，它的主存字块标记从t位增加到t+c位，这就使Cache”标 记＂的位数增多，而且访问Cache时主存字块标记需要和Cache的全部“标记”位进行比较，才能 判断出所访问主存地址的内容是否已在Cache内。这种比较通常采用”按内容寻址”的相联存 储器（见附录4A)来完成。 Cache  m=t+c  主存地址 I主存字块标记1字块内地址1 m=t+c位b位 图4.55全相联映射 主存 总之，这种方式所需的逻辑电路甚多，成本较高，实际的Cache还要采用各种措施来减少地 址的比较次数。"}
{"doc_id": "co", "page": 125, "text": "第4章存储器119  3.组相联映射 组相联映射是对直接映射和全相联映射的一种折中。它把Cache分为Q组，每组有R块， 并有以下关系： i =j mod Q  其中，i为缓存的组号，j为主存的块号。某一主存块按模Q将其映射到缓存的第i组内，如图 4.56所示。 2  C一,. 组Cache(r=l) :I ::: I::：I:：5|：二： -l 标记1字块2c-21标记1字块2c-1 主存地址 主存字块标记1组地址I字块内地址 s=t+r位q=c-r位b位 m位 图4.56组相联映射 主存 组相联映射的主存地址各段与直接映射（参见图4.54)相比，还是有区别的。图4.54中 Cache字块地址字段由c位变为组地址字段q位，且q=c-r，其中2c表示Cache的总块数，2q表示 Cache的分组个数，2r表示组内包含的块数。主存字块标记字段由t位变为s= t+r位。为了便于 理解，假设c=5,q=4，则r=c-q=l。其实际含义为：Cache共有2c= 32个字块，共分为2q= 16组， 每组内包含2r= 2块。组内2块的组相联映射又称为二路组相联。 根据上述假设条件，组相联映射的含义是：主存的某一字块可以按模16映射到Cache某组 的任一字块中。即主存的第0,16,32…字块可以映射到Cache第0组2个字块中的任一字块；主 存的第15,31,47…字块可以映射到Cache第15组中的任一字块。显然，主存的第j块会映射到 Cache的第i组内，两者之间一一对应，属直接映射关系；另一方面，主存的第j块可以映射到 Cache的第i组内中的任一块，这又体现出全相联映射关系。可见，组相联映射的性能及其复杂 性介千直接映射和全相联映射两者之间，当r= 0时是直接映射方式，当r=c时是全相联映 射方式。"}
{"doc_id": "co", "page": 126, "text": "120 第2篇计算机系统的硬件结构 例4.8假设主存容量为512KB, Cache容量为4KB，每个字块为16个字，每个字32位。 (1) Cache地址有多少位？可容纳多少块？ (2)主存地址有多少位？可容纳多少块？ (3)在直接映射方式下，主存的第几块映射到Cache中的第5块（设起始字块为第1块）？ (4)画出直接映射方式下主存地址字段中各段的位数。 解：（1)根据Cache容量为4KB(212=4 K),Cache地址为12位。由于每字32位，则Cache 共有4KB/4 B= 1 K字。因每个字块16个字，故Cache中有1K/16 = 64块。 (2)根据主存容量为512KB (2 19 = 512 K)，主存地址为19位。由于每字32位，则主存共有 512 KB/4 B = 128 K字。因每个字块16个字，故主存中共128K/16 = 8 192块。 (3)在直接映射方式下，由于Cache共有64块，主存共有8192块，因此主存的5,64+5,  2x64+5,…,213 -64+5块能映射到Cache的第5块中。 (4)在直接映射方式下，主存地址字段的各段位数分配如图4.57所示。其中字块内地址为 6位(4位表示16个字，2位表示每字32位），缓存共64块，故缓存字块地址为6位，主存字块标 记为主存地址长度与Cache地址长度之差，即19-12=7位。 主存字块标记1 缓存字块地址1 字块内地址 7位16位16位 图4.57例4.8主存地址各字段的分配 例4.9假设主存容量为512Kx16位，Cache容量为4096x 16位，块长为4个16位的字，访 存地址为字地址。 (1)在直接映射方式下，设计主存的地址格式。 (2)在全相联映射方式下，设计主存的地址格式。 (3)在二路组相联映射方式下，设计主存的地址格式。 (4)若主存容量为512KX32位，块长不变，在四路组相联映射方式下，设计主存的地 址格式。 解：（1)根据Cache容量为4096 = 212字，得Cache字地址为12位。根据块长为4，且访存地 址为字地址，得字块内地址为2位，即b=2，且Cache共有4096/4= 1 024=210块，即c=10。根据 主存容量为512K = 219字，得主存字地址为19位。在直接映射方式下，主存字块标记为 19-12=7。主存的地址格式如图4.58(a)所示。 (2)在全相联映射方式下，主存字块标记为19-b=19-2= 17位，其地址格式如图4.58(b) 所示。 (3)根据二路组相联的条件，一组内有2块，得Cache共分1024/2 = 512 = 2q组，即q=9，主 存字块标记为19-q-b= 19-9-2 = 8位，其地址格式如图4.58(C)所示。"}
{"doc_id": "co", "page": 127, "text": "第4章存储器121  (4)若主存容量改为512Kx32位，即双字宽存储器，块长仍为4个16位的字，访存地址仍 为字地址，则主存容量可写为1024 Kx 16位，得主存地址为20位。由四路组相联，得Cache共 分1024/4 = 256 = 2q组，即q=8。对应该条件下，主存字块标记为20-8-2=10位，其地址格式如 图4.58(d)所示。 主存字块标记Cache字块地址1字块内地址 7 10 I 2  (a)直接映射方式主存地址格式 ,\"'  主存字块标记 17  三 (b)全相联映射方式主存地址格式 主存字块标记组地址字块内地址 8 9 2  (c)二路组相联映射方式主存地址格式 主存字块标记组地址字块内地址 10 8 2  (d)四路组相联映射方式双字宽主存地址格式 图4.58例4.9主存地址格式 例4.10假设Cache的工作速度是主存的5倍，且Cache被访问命中的概率为95%，则采用 Cache后，存储器性能提高多少？ 解：设Cache的存取周期为t，主存的存取周期为5t，则系统的平均访问时间为 ta= 0.95Xt+0.05X5t= 1.2t  性能为原来的5t/l.2t=4.17倍，即提高了3.17倍。 例4.11设某机主存容量为16MB, Cache的容量为8KB。每字块有8个字，每字32位。 设计一个四路组相联映射的Cache组织。 (1)画出主存地址字段中各段的位数。 (2)设Cache初态为空，CPU依次从主存第0,1,2,…，99号单元读出100个字（主存一次读 出一个字），并重复此次序读10次，间命中率是多少？"}
{"doc_id": "co", "page": 128, "text": "122 第2篇计算机系统的硬件结构 (3)若Cache的速度是主存速度的5倍，试间有Cache和无Cache相比，速度提高多少倍？ (4)系统的效率为多少？ 解：（1)根据每个字块有8个字，每个字32位，得出主存地址字段中字块内地址字段为5 位，其中3位为字地址，2位为字节地址。 根据Cache容量为8KB = 213 B，字块大小为25B，得Cache共有28块，故C= 8。根据四路 组相联映射2r=4，得r= 2，则q= c-r = 8-2 = 6位。 根据主存容量为16MB = 224 B，得出主存地址字段中主存字块标记为24-6-5= 13位。 主存地址字段各段格式如图4.59所示。 主存字块标记组地址字块内地址 13位6位5位 图4.59例4.10主存地址字段 (2)由千每个字块中有8个字，而且初态Cache为空，因此CPU读第0号单元时，未命中， 必须访问主存，同时将该字所在的主存块调入Cache第0组中的任一块内，接着CPU读1~7号 单元时均命中。同理，CPU读第8,16,…，96号单元时均未命中。可见CPU在连续读100个字 中共有13次未命中，而后9次循环读100个字全部命中，命中率为 lOOxl0-13 = 0.987 lOOxlO  (3)根据题意，设主存存取周期为St,Cache的存取周期为t，没有Cache的访问时间为5tX 1 000，有Cache的访问时间为t(1 000 -13) + 5 t X 13，则有Cache和没有Cache相比，速度提高的 倍数为 Stx 1 000 -1=3.75 t(l 000-13)+5tX13  (4)根据(2)求得的命中率0.987，主存的存取周期为St,Cache的存取周期为t，得系统的效 率为 替换策略 t  x100%=95% 0.987Xt+(1-0.987) X5t  当新的主存块需要调入Cache并且它的可用空间位置又被占满时，需要替换掉Cache的数 据，这就产生了替换策略（算法）问题。在直接映射的Cache中，由于某个主存块只与一个Cache 字块有映射关系，因此替换策略很简单。而在组相联和全相联映射的Cache中，主存块可以写入"}
{"doc_id": "co", "page": 129, "text": "第4章存储器123  Cache中若干位置，这就有一个选择替换掉哪一个Cache字块的问题，即所谓替换算法间题。理 想的替换方法是把未来很少用到的或者很久才用到的数据块替换出来，但实际上很难做到。常 用的替换算法有先进先出算法、近期最少使用算法和随机法。 1.先进先出(First-In-First-Out,FIFO)算法 FIFO算法选择最早调入Cache的字块进行替换，它不需要记录各字块的使用情况，比较容 易实现，开销小，但没有根据访存的局部性原理，故不能提高Cache的命中率。因为最早调入的 信息可能以后还要用到，或者经常要用到，如循环程序。 2.近期最少使用(LeastRecently Used, LRU)算法 LRU算法比较好地利用访存局部性原理，替换出近期用得最少的字块。它需要随时记录 Cache中各字块的使用情况，以便确定哪个字块是近期最少使用的字块。它实际是一种推测的 方法，比较复杂，一般采用简化的方法，只记录每个块最近一次使用的时间。LRU算法的平均命 中率比FIFO的高。 3.随机法 随机法是随机地确定被替换的块，比较简单，可采用一个随机数产生器产生一个随机的被替 换的块，但它也没有根据访存的局部性原理，故不能提高Cache的命中率。 4.4 辅助存储器 概述 1.辅助存储器的特点 辅助存储器作为主存的后援设备又称为外部存储器，简称外存，它与主存一起组成了存储器 系统的主存－辅存层次。与主存相比，辅存具有容量大、速度慢、价格低、可脱机保存信息等特 点，属“非易失性”存储器。而主存具有速度快、成本高、容量小等特点，而且大多由半导体芯片 构成，所存信息无法永久保存，属“易失性”存储器。 目前，广泛用于计算机系统的辅助存储器有硬磁盘、软磁盘、磁带、光盘等。前三种均属磁表 面存储器。 磁表面存储器是在不同形状（如盘状、带状等）的载体上涂有磁性材料层，工作时，靠载磁 体高速运动，由磁头在磁层上进行读／写操作，信息被记录在磁层上，这些信息的轨迹就是磁 道。磁盘的磁道是一个个同心圆，如图4.60(a)所示，磁带的磁道是沿磁带长度方向的直线， 如图4.60(b)所示。"}
{"doc_id": "co", "page": 130, "text": "124 第2篇计算机系统的硬件结构 磁道磁道 (a)磁盘中的磁道(b)磁带中的磁道 图4.60磁盘和磁带的磁道示意图 2.磁表面存储器的主要技术指标 (1)记录密度 记录密度通常是指单位长度内所存储的二进制信息量。磁盘存储器用道密度和位密 度表示；磁带存储器则用位密度表示。磁盘沿半径方向单位长度的磁道数为道密度，单位 是tpi(Track Per Inch，道每英寸）或tpm（道每毫米）。为了避免干扰，磁道与磁道之间需保 持一定距离，相邻两条磁道中心线之间的距离称为道距，因此道密度DI等于道距P的倒 数，即 DI=— p  单位长度磁道能记录二进制信息的位数，称为位密度或线密度，单位是bpi(Bits Per Inch,  位每英寸）或bpm（位每毫米）。磁带存储器主要用位密度来衡量，常用的磁带有800bpi、 1 600 bpi、6250 bpi等。对于磁盘，位密度几可按下式计算： Db=  ft  1Tdmin  其中，j为每道总位数，dmin为同心圆中的最小直径。 在磁盘各磁道上所记录的信息量是相同的，而位密度不同，一般泛指磁盘位密度时，是指最 内圈磁道上的位密度（最大位密度）。 (2)存储容量 存储容量是指外存所能存储的二进制信息总数量，一般以位或字节为单位。以磁盘存储器 为例，存储容量可按下式计算： C=nXkXs  其中，C为存储总容量，n为存放信息的盘面数，k为每个盘面的磁道数，s为每条磁道上记录的二 进制代码数。 磁盘有格式化容量和非格式化容量两个指标。非格式化容量是磁表面可以利用的磁化单元 总数。格式化容量是指按某种特定的记录格式所能存储信息的总量，即用户可以使用的容量，它"}
{"doc_id": "co", "page": 131, "text": "第4章存储器125  一般为非格式化容量的60%~70%。 (3)平均寻址时间 由存取方式分类可知，磁盘采取直接存取方式，寻址时间分为两个部分，其一是磁头寻找目 标磁道的找道时间t8，其二是找到磁道后，磁头等待欲读／写的磁道区段旋转到磁头下方所需要 的等待时间tw。由于从最外圈磁道找到最里圈磁道和寻找相邻磁道所需时间是不等的，而且磁 头等待不同区段所花的时间也不等，因此，取其平均值，称为平均寻址时间Ta，它是平均找道时 间t迎和平均等待时间twa之和： t +t. t +t,  T  smax smIn wmax wmm  =t +t = + a sa wa 2 2  平均寻址时间是磁盘存储器的一个重要指标。硬磁盘的平均寻址时间比软磁盘的平均寻址 时间短，所以硬磁盘存储器比软磁盘存储器速度快。 磁带存储器采取顺序存取方式，磁头不动，磁带移动，不需要寻找磁道，但要考虑磁头寻 找记录区段的等待时间，所以磁带寻址时间是指磁带空转到磁头应访问的记录区段所在位 的时间。 (4)数据传输率 数据传输率队是指单位时间内磁表面存储器向主机传送数据的位数或字节数，它与记录密 度仄和记录介质的运动速度V有关： Dr=Dbxv  此外，辅存和主机的接口逻辑应有足够快的传送速度，用来完成接收／发送信息，以便主机与 辅存之间正确无误地传送。 (5)误码率 误码率是衡量磁表面存储器出错概率的参数，它等于从辅存读出时，出错信息位数和 读出信息的总位数之比。为了减少出错率，磁表面存储器通常采用循环冗余码来发现并纠 正错误。 1.磁记录原理 磁表面存储器通过磁头和记录介质的相对运动完成读／写操作。 写入过程如图4.61所示。 写入时，记录介质在磁头下方匀速通过，根据写入代码的要求，对写入线圈输入一定方向和 大小的电流，使磁头导磁体磁化，产生一定方向和强度的磁场。由千磁头与磁层表面间距非常 小，磁力线直接穿透磁层表面，将对应磁头下方的微小区域磁化（称为磁化单元）。可以根据写 入驱动电流的不同方向，使磁层表面被磁化的极性方向不同，以区别记录“0”或“1”。"}
{"doc_id": "co", "page": 132, "text": "126 第2篇计算机系统的硬件结构 写线圈写线圈 铁芯 磁通 子 局部磁化单元 』－尸 二二 (a)写入“O\" 图4.61 尸— 局部磁化单元 (b)写入“1\" 磁表面存储器写入原理 读出时，记录介质在磁头下方匀速通过，磁头相对于一个个被读出的磁化单元作切割磁力线 帅 的运动，从而在磁头读线圈中产生感应电势e，且e=-n—-(n为读出线圈匝数），其方向正好和磁 dt  通的变化方向相反。由于原来磁化单元的剩磁通中的方向不同，感应电势方向也不同，便可读 出“1”或“0”两种不同信息，如图4.62所示。 读线圈读线圈 中 } I  l尸一－运动方向 I I-—－运动方向 I I  小 e  s  e  s  图4.62磁表面存储器读出原理 2.磁表面存储器的记录方式 磁记录方式又称为编码方式，它是按某种规律将一串二进制数字信息变换成磁表面相应的 磁化状态。磁记录方式对记录密度和可靠性都有很大影响，常用的记录方式有六种，如图4.63 所示。"}
{"doc_id": "co", "page": 133, "text": "第4章 存储 器127  位周期 IT I  I二工1 数据序列！O!l!l!l!O!O!O!l!O RZ  NRZ  NRZl  PM  FM  MFM  图4.63六种磁记录方式的写入电流波形 图中波形既代表了磁头线圈中的写入电流波形，也代表磁层上相应位置所记录的理想的磁 通变化状态。 (1)归零制(RZ) 归零制记录”1”时，通以正向脉冲电流，记录“0”时，通以反向脉冲电流。这样使其在磁 表面形成两个不同极性的磁饱和状态，分别表示“1”和“0”。由于两位信息之间驱动电流归 零，故称为归零制记录方式。这种方式在写入信息时很难覆盖原来的磁化区域，所以为了重 新写入信息，在写入前，必须先抹去原存信息。这种记录方式原理简单，实施方便，但由千两 个脉冲之间有一段间隔没有电流，相应的该段磁介质未被磁化，即该段空白，故记录密度不 高，目前很少使用。 (2)不归零制(NRZ) 不归零制记录信息时，磁头线圈始终有驱动电流，不是正向，便是反向，不存在无电流状 态。这样，磁表面层不是正向被磁化，就是反向被磁化。当连续记录”1”或“0”时，其写电流 向不变，只有当相邻两信息代码不同时，写电流才改变方向，故称为“见变就翻＂的不 归零制。 (3)“见l就翻＂的不归零制(NRZl) “见l就翻＂的不归零制在记录信息时，磁头线圈也始终有电流。但只有在记录”1”时电流 改变方向，使磁层磁化方向发生翻转；记录“0”时，电流方向保持不变，使磁层的磁化方向也维持 原来状态，因此称为“见1就翻＂的不归零制。 (4)调相制(PM) 调相制又称为相位编码(PE)，其特点是记录”1”或“0”的相位相反。如：记录“0”时，写电流 由负变正；记录“1”时，写电流由正变负（也可以相反定义），而且电流变化出现在一位信息记录 时间的中间时刻，它以相位差为180°的磁化翻转方向来表示“1”和“0”。因此，当连续记录相同"}
{"doc_id": "co", "page": 134, "text": "l28 第2篇计算机系统的硬件结构 信息时，在每两个相同信息的交界处，电流方向都要变化一次；若相邻信息不同，则两个信息位的 交界处电流方向维持不变。调相制在磁带存储器中用得较多。 (5)调频制(FM) 调频制的记录规则是：以驱动电流变化的频率不同来区别记录”1”还是“0”。当记录“0\" 时，在一位信息的记录时间内电流保持不变；当记录”1”时，在一位信息记录时间的中间时刻，使 电流改变一次方向。而且无论记录“0”还是“1\"，在相邻信息的交界处，线圈电流均变化一次。 因此，写“1”时，在位单元的起始和中间位置都有磁通翻转；在写“0”时，仅在位单元起始位置有 翻转。显然，记录”1\"的磁翻转频率为记录“0”的两倍，故又称为倍频制。调频制记录方式被广 泛应用在硬磁盘和软磁盘中。 (6)改进型调频制(MFM) 这种记录方式基本上同调频制，即记录“0”时，在位记录时间内电流不变；记录”1”时，在位 记录时间的中间时刻电流发生一次变化。两者不同之处在于，改进型调频制只有当连续记录两 个或两个以上的“0”时，才在每位的起始处改变一次电流，不必在每个位起始处都改变电流方 向。由于这一特点，在写入同样数据序列时，MFM比FM磁翻转次数少，在相同长度的磁层上可 记录的信息量将会增加，从而提高了磁记录密度。FM制记录一位二进制代码最多是两次磁翻 转，MFM制最多只要一次翻转，记录密度提高了一倍，故又称为倍密度记录方式。倍密度软磁盘 即采用MFM记录方式。 此外还有一种二次改进的调频制(M2FM)，它是在MFM基础上改进的，其记录规则是：当连 续记录“0”时，仅在第1个位起始处改变电流方向，以后的位交界处电流方向不变。 3.评价记录方式的主要指标 评价一种记录方式的优劣标准主要反映在编码效率和自同步能力等方面。 (1)编码效率 编码效率是指位密度与磁化翻转密度的比值，可用记录一位信息的最大磁化翻转次数来表 示。例如，FM、PM记录方式中，记录一位信息最大磁化翻转次数为2，因此编码效率为50%；而 MFM、NRZ、NRZl三种记录方式的编码效率为100%，因为它们记录一位信息磁化翻转最 多一次。 (2)自同步能力 自同步能力是指从单个磁道读出的脉冲序列中所提取同步时钟脉冲的难易程度。从磁表面 存储器的读出可知，为了将数据信息分离出来，必须有时间基准信号，称为同步信号。同步信号 可以从专门设置用来记录同步信号的磁道中取得，这种方法称为外同步，如NRZl制。图4.64 画出了NRZl制驱动电流、记录磁通、感应电势、同步脉冲、读出代码等几种波形的理想对应关系 （图中未反映磁通变化的滞后现象）。读出时将读线圈获得的感应信号放大（负波还要反相）、整 形，这样，对千每个记录的“1”都会得到一个正脉冲，再将它们与同步脉冲相”与＂，即可得读出代 码波形。 对千高密度的记录系统，可直接从磁盘读出的信号中提取同步信号，这种方法称为自同步。"}
{"doc_id": "co", "page": 135, "text": "第4章存 储器129  自同步能力可用最小磁化翻转间隔和最大磁 化翻转间隔之比值R来衡量。R越大，自同步能力 也越强。例如，NRZ和NRZl方式在连续记录“0\" 时，磁层都不发生磁化磁转，而NRZ方式在连续记 录”1”时，磁层也不发生磁化翻转，因此，NRZ和 NRZl都没有自同步能力。而PM、FM、MFM记录 方式均有自同步能力。FM记录方式的最大磁化翻 转间隔是T(T为一位信息的记录时间），最小磁化 翻转间隔是T/2，所以RFM= 0.5。 影响记录方式的优劣因素还有很多，如读分辨 力、信息独立性（即某一位信息读出时出现误码而不影响后续其他信息位的正确性）、频带 宽度、抗干扰能力以及实现电路的复杂性等。 除上述所介绍的6种记录方式外，还有成组编码记录方式，如GCR(5.4)编码，它广泛用千 磁带存储器，游程长度受限码(RLL码）是近年发展起来的用千高密度磁盘上的一种记录方式， 在此均不详述。 数据序列O.l.1.0.0.1,0 I L_____J I I  驱动电流｝} } } }  磁通变化lI I l l I l l  I I  I I 厂勹I I I I  感应电势 同步脉冲 读出代码 I I I I I I I I  I I I I I  图4.64NRZl的读出代码波形 硬磁盘存储器是计算机系统中最主要的外存设备。第一个商品化的硬磁盘是由美国IBM 公司于1956年研制而成的。60多年来，无论在结构还是在性能方面，磁盘存储器有了很大的发 展和改进。 1.硬磁盘存储器类型 硬磁盘存储器的盘片是由硬质铝合金材料制成的，其表面涂有一层可被磁化的硬磁特性材 料。按磁头的工作方式可分为固定磁头磁盘存储器和移动磁头磁盘存储器；按磁盘是否具有 换性又可分为可换盘磁盘存储器和固定盘磁盘存储器。 固定磁头的磁盘存储器，其磁头位置固定不动，磁盘上的每一个磁道都对应一个磁头，如图 4.65 (a)所示，盘片也不可更换。其特点是省去了磁头沿盘片径向运动所需寻找磁道的时间，存 取速度快，只要磁头进入工作状态即可进行读写操作。 移动磁头的磁盘存储器在存取数据时，磁头在盘面上做径向运动，这类存储器可以由一个盘 片组成，如图4.65(b)所示。也可由多个盘片装在一个同心主轴上，每个记录面各有一个磁头， 如图4.65(C)所示。 图4.65(c)中含有6个盘片，除上下两外侧为保护面外，共有10个盘面可作为记录面， 并对应10个磁头（有的磁盘组最外两侧盘面也可作为记录面，并分别与一个磁头对应）。 所有这些磁头连成一体，固定在一个支架上可以移动，任何时刻各磁头都位千距圆心相等 距离的磁道上，这组磁道称为一个柱面。目前，这类结构的硬磁盘存储器应用最广泛。最"}
{"doc_id": "co", "page": 136, "text": "130 第2篇计算机系统的硬件结构 (a)固定磁头(b)移动磁头单盘片磁盘 T 磁头运动方向 主轴 (c)移动磁头多盘片磁盘 图4.65固定头和移动头磁盘 典型的就是温切斯特磁盘。 可换盘磁盘存储器是指盘片可以脱机保存。这种磁盘可以在互为兼容的磁盘存储器之间交 换数据，便千扩大存储容量。盘片可以只换单片，如在4片盒式磁盘存储器中，3片磁盘固定，只 有1片可换。也可以将整个磁盘组（如6片、11片、12片等）换下。 固定盘磁盘存储器是指磁盘不能从驱动器中取下，更换时要把整个头盘组合体一起更换。 温切斯特磁盘是一种可移动磁头固定盘片的磁盘存储器，简称温盘。它是目前用得最 广，最有代表性的硬磁盘存储器。它于1973年首先应用在IBM3340硬磁盘存储器中。其特 点是采用密封组合方式，将磁头、盘片、驱动部件以及读／写电路等制成一个不能随意拆卸的 整体，称为头盘组合体。因此，它的防尘性能好，可靠性高，对环境要求不高。过去有些普通 的硬磁盘存储器要求在超净环境中应用，往往只能用在特殊条件的大中型计算机系统中。 2.硬磁盘存储器的结构 硬磁盘存储器由磁盘驱动器、磁盘控制器和盘片3大部分组成，如图4.66所示。 主 机 磁盘驱动器 磁盘控制器 盘 片 图4.66磁盘存储器基本结构示意 (1)磁盘驱动器 磁盘驱动器是主机外的一个独立装置，又称磁盘机。大型磁盘驱动器要占用一个或几个 机柜，温盘只是一个比砖还小的小匣子。驱动器主要包括主轴、定位驱动及数据控制3部分。"}
{"doc_id": "co", "page": 137, "text": "第4章存储器131  图4.67示意了磁盘驱动器的主轴系统和定位驱动系统。 磁盘主轴磁头 测速输出 III|  _____  J  -_  ，一 ，一 二 1 由磁盘控制 器送来的目 标磁道信号 闭环自动控制系统 图4.67磁盘驱动器结构及定位驱动系统的示意图 图中主轴上装有6片磁盘，主轴受传动机构控制，可使磁盘组作高速旋转运动。磁盘组共有 10个有效记录面，每一面对应一个磁头。10个磁头分装在读／写臂上，连成一体，固定在小车上， 犹如一把梳子。在音圈电机带动下，小车可以平行移动，带着磁头作盘的径向运动，以便找到目 标磁道。磁头还具备浮动的特性，即当盘面作高速旋转时，依靠盘面形成的高速气流将磁头微微 “托”起，使磁头与盘面不直接接触形成微小的气隙。 整个驱动定位系统是一个带有速度和位置反馈的闭环调节自控系统。由位置检测电路测得 磁头的即时位置，并与磁盘控制器送来的目标磁道位置进行比较，找出位差；再根据磁头即时平 移的速度求出磁头正确运动的方向和速度，经放大送回给线性音圈电机，以改变小车的移动方向 和速度，由此直到找到目标磁道为止。 数据控制部分主要完成数据转换及读／写控制操作。在写操作时，首先接收选头选址信号， 用以确定道地址和扇段地址。再根据写命令和写数据选定的磁记录方式，并将其转化为按一定 变化规律的驱动电流注入磁头的写线圈中。按4.4.2节所述的工作原理，便可将数据写入指定 磁道上。读操作时，首先也要接收选头选址信号，然后通过读放大器以及译码电路，将数据脉冲 分离出来。 (2)磁盘控制器 磁盘控制器通常制作成一块电路板，插在主机总线插槽中。其作用是接收由主机发来的命 令，将它转换成磁盘驱动器的控制命令，实现主机和驱动器之间的数据格式转换和数据传送，并 控制驱动器的读／写。可见，磁盘控制器是主机与磁盘驱动器之间的接口。其内部又包含两个接 口，一个是对主机的接口，称为系统级接口，它通过系统总线与主机交换信息；另一个是对硬盘 （设备）的接口，称为设备级接口，又称为设备控制器，它接收主机的命令以控制设备的各种操"}
{"doc_id": "co", "page": 138, "text": "132 第2篇计算机系统的硬件结构 作。一个磁盘控制器可以控制一台或几台驱动器。图4.68是磁盘控制器接口的示意图。 ST506接口 !  ESDI接口 SMD接口 l  _|  __  C) 器 动 驱 数据分离器 ____  C)  格式控制 SCSI接口 i  磁盘数据控制器 ——  __  C)  图4.68磁盘控制器接口的示意图 磁盘控制器与主机之间的界面比较清晰，只与主机的系统总线打交道，即数据的发送 或接收都是通过总线完成的。磁盘存储器属快速外部设备，它与主机交换信息通常采用直 接存储器访问(DMA)的控制方式（详见5.6节），图中所示的SCSI标准接口即可与系统总 线相连。 磁盘控制器与驱动器的界面可设在图4.68的A处，则驱动器只完成读写和放大，如 ST506接口就属于这种类型。如果将界面设在B处，则将数据分离电路和编码、解码电路划入 驱动器内，磁盘控制器仅完成串／并（或并／串）转换、格式控制和DMA控制等逻辑功能，如 SMD和ESDI等接口就属于这种类型。如果界面设在C处，则磁盘控制器的功能全部转入设 备之中，主机与设备之间便可采用标准通用接口，如SCSI接口。现在的发展趋势是后两类， 增强了设备的功能，使设备相对独立。图4.69(a)是采用了SCSI接口的系统结构示意图，其 接口信号线如图4.69(b)所示。 (3)盘片 盘片是存储信息的载体，随着计算机系统的不断小型化，硬盘也在朝着小体积和大容量的方 向发展。十几年来商品化的硬盘盘面的记录密度巳增长了10倍以上。表4.5列出了1991年以 来正在研制或投产的各种硬盘某些主要指标所达到的水平（实际上这些指标都高于商品化硬盘 指标）。 表4.5几种硬盘的某些指标 2.5 1.8  驱动器容量3.7 GB 1.4 GB 181.3 MB 20 MB  数据传输率／MBps20 14.5 6 2  平均存取时间／ms11 8.5 14.5 20"}
{"doc_id": "co", "page": 139, "text": "-- 二最接设可个多8备 第4章存储器 翡詹接 (50口)芯 ,  u.l::S。数据总线第0位 DB1数据总线第1位 D见数据总线第2位 DB3数据总线第3位 D队数据总线第4位 DB5数据总线第5位 D队数据总线第6位 DB7数据总线第7位 DBP数据校验位 ACK认可（对REQ的确认） REQ请求 （对发 A送TN信应息答的确认） RST复位外设 SEL选择外设 BSY忙 CID命令／数据 I/0输入输出 MSG信息字节 (a) SCSI接口系统结构图(b) SCSI接口信号线 图4.69SCSI接口系统结构和接口信号线 3.硬磁盘存储器的发展动向 (1)半导体盘 133  '  半导体盘是用半导体材料制成的“盘”，它既没有盘，也没有其他运动部件，它是以半导体芯 片为核心，加上接口电路和其他控制电路，在功能上模拟硬盘，即按硬盘的工作方式存取数据。 如EEPROM，它可用电信号改写，断电时其原存信息也不被丢失，因此，它就可以做成半导体盘， 其存取速度比硬盘要快得多，大约在0.1ms以下。 Flash Mem01'-y是在EPROM和EEPROM基础上产生的一种新型的、具有性能价格比和可靠性 更高的可擦写、非易失性的存储器。大容量的FlashMemo1'Y既能长期反复使用，又不丢失信息，因 此它可以用来替代磁盘。2006年韩国三星电子公司开发的Flash存储芯片的容量已达32GB。 (2)提高磁盘记录密度 为提高磁盘记录密度，通常可采用以下技术。 0采用高密度记录磁头。 0采用先进的信息处理技术，克服由高密度带来的读出信号减弱和信号干扰比下降 的缺点。"}
{"doc_id": "co", "page": 140, "text": "134 第2篇计算机系统的硬件结构 0降低磁头浮动高度和采用高性能磁头浮动块。 0改进磁头伺服跟踪技术。 0采用高性能介质和基板的磁盘。 0改进编码方式。 (3)提高磁盘的数据传输率和缩短平均存取时间 为实现磁盘高速化，可采用如下措施。 0提高主轴转速，从过去的2400 rpm、3600 rpm提高到4400 rpm、4500 rpm、5400 rpm  和6300 rpm。例如，美国MaxtorCorp开发的MXT-1240S型的3.5英寸硬盘，主轴转速为 6 300 rpm，旋转等待时间为4.76ms，平均存取时间为8.5ms。 0采用超高速缓冲存储器Cache芯片作为读／写操作控制电路。例如，IBM3990型14英寸 硬盘以及Quantum、Conner、日立制作所的3.5英寸硬盘的Cache容量已达256KB。 (4)采用磁盘阵列RAID 尽管磁盘存储器的速度有了很大的提高，但与处理器相比，差距仍然很大。这种状态使磁盘 存储器成了整个计算机系统功能提高的瓶颈。于是又出现了磁盘阵列RAID(Redundant Array of  Independent Disks)。它的基本原理是将并行处理技术引入磁盘系统。使用多台小型温盘构成同 步化的磁盘阵列，将数据展开分放在多台盘上，而这些盘又能像一台盘那样操作，使数据传输时 间为单台盘的lln(n为并行驱动器个数）。有关RAID的内容，读者可在”计算机体系结构”课 程中重点学习。 4.硬磁盘的磁道记录格式 盘面的信息串行排列在磁道上，以字节为单位，若干相关的字节组成记录块，一系列的记录 块又构成一个“记录”，一批相关的＂记录”组成了文件。为了便千寻址，数据块在盘面上的分布 遵循一定规律，称为磁道记录格式。常见的有定长记录格式和不定长记录格式两种。 (1)定长记录格式 一个具有n个盘片的磁盘组，可将其n个面上同一半径的磁道看成一个圆柱面，这些磁道存 储的信息称为柱面信息。在移动磁头组合盘中，磁头定位机构一次定位的磁道集合正好是一个 柱面。信息的交换通常在圆柱面上进行，柱面个数正好等千磁道数，故柱面号就是磁道号，而磁 头号则是盘面号。 盘面又分若干扇区，每条磁道被分割成若干个扇段，数据在盘片上的布局如图4.70所示。 扇段是磁盘寻址的最小单位。在定长记录格式中，当台号决定后，磁盘寻址定位首先确定柱面， 再选定磁头，最后找到扇段。因此寻址用的磁盘地址应由台号、磁道号、盘面号、扇段号等字段组 成，也可将扇段号用扇区号代替。 CDC 6639型、7637型、ISOT-1370型等磁盘都采用定长记录格式。ISOT-1370型磁盘的磁道 记录格式如图4.71所示。 ISOT盘共有12个扇区，每个扇段内只记录一个数据块，每个扇段开始由扇区标志盘读出一 个扇标脉冲，标志一个扇段的开始，0扇区标志处再增加一个磁道标志，指明是起始扇区。"}
{"doc_id": "co", "page": 141, "text": "第4章存储器135  扇区0 I台号1磁道号1盘面号1扇段号1 磁盘地址 图4.70数据在盘片上的分布及磁盘地址定位 扇区标志0扇区 扇区 和磁道标志标志1标志2 Ro I RI I R2  II  扇标脉冲／ 门 扇区 标志11尸 -、身、 ---- 、 ~ -- 、 、 运动方向 ------~~  ----------、厂 头空I序标1数据(512B) I检验字段1尾空 一个扇段（记录块）下一扇段 图4.71ISOT型磁盘的磁道记录格式 每个扇段的头部是空臼段，起到隧道清除作用。序标段以某种约定代码作为数据块的引导。 数据段可写入512B，若不满512B，该扇段余下部分为空白；若超过512B，则可占用几个扇段。 检验字段写一个校验字，常用循环冗余码(CRC)检验，尾空臼段为全0或空白区以示数据结束。 这种记录格式结构简单，可按磁道号（柱面号）、盘面号、扇段号进行直接寻址，但记录区的 利用率不高。 例4.12假设磁盘存储器共有6个盘片，最外两侧盘面不能记录，每面有204条磁道，每条"}
{"doc_id": "co", "page": 142, "text": "136 第2篇计算机系统的硬件结构 磁道有12个扇段，每个扇段有512B，磁盘机以7200 rpm速度旋转，平均定位时间为8ms。 (1)计算该磁盘存储器的存储容量。 (2)计算该磁盘存储器的平均寻址时间。 解：（1)6个盘片共有10个记录面，磁盘存储器的总容量为512Bxl2X204x10=  12 533 760 B  (2)磁盘存储器的平均寻址时间包括平均寻道时间和平均等待时间。其中，平均寻道时间 即平均定位时间为8ms，平均等待时间与磁盘转速有关。根据磁盘转速为7200 rpm，得磁盘每 转一周的平均时间为 [60 s/(7 200 rpm) ]x0.5=4.165 ms  故平均寻址时间为 8 ms+4.165 ms= 12.165 ms  例4.13一个磁盘组共有11片，每片有203道，数据传输率为983040 Bps，磁盘组转速为 3 600 rpm。假设每个记录块有1024 B，且系统可挂16台这样的磁盘机，计算该磁盘存储器的总 容量并设计磁盘地址格式。 解：（1)由千数据传输速率＝每一条磁道的容量X磁盘转速，且磁盘转速为3600 rpm=  60 rps，故每一磁道的容量为983040 Bps/60 rps= 16 384 B。 (2)根据每个记录块（即扇段）有1024 B，故每个磁道有16384 B/1 024 B = 16个扇段。 (3)磁盘地址格式如图4.72所示。其中；台号4位，表示有16台磁盘机；磁道号8位，能反 映203道；盘面号5位，对应11个盘片共有20个记录面；扇段号4位，对应16个扇段。 三 8  磁道号 5 I 4  盘面号扇段号 图4.72例4.13磁盘地址格式 例4.14对于一个由6个盘面组成的磁盘存储器，若某个文件长度超过一个磁道的容量，应 将它记录在同一个存储面上，还是记录在同一个柱面上？ 解：如果文件长度超过一个磁道的容量，应将它记录在同一柱面上，因为不需要重新找道，寻 址时间减少，数据读／写速度快。 (2)不定长记录格式 在实践应用中，信息常以文件形式存入磁盘。若文件长度不是定长记录块的整数倍 时，往往造成记录块的浪费。不定长记录格式可根据需要来决定记录块的长度。例如，IBM 2311、2314等磁盘驱动器采用不定长记录格式，图4.73是IBM2311盘不定长度磁道记录 格式的示意图。 图中ID是起始标志，又称索引标志，表示磁道的起点。间隙凡是一段空白区，占36~72个 字节长度，其作用是使连续的磁道分成不同的区，以利于磁盘控制器与磁盘机之间的同步和定"}
{"doc_id": "co", "page": 143, "text": "第4章存储器 常贯IID|Gl l HA | G2 | 凡)| G3 | R1 | G2 | … |凡| 起始间隙磁道地址块间隙磁道胚识块侗隙数据块间隙、数据块 标志 --  --  --  ---- --  --- 数据块1个替臂列赞刘吁1愿fI飞仅帛『IC 计数区关键字区 图4.73IBM 2311盘不定长度磁道记录格式的示意图 数据区 137  位。磁道地址块HA又称为标识地址或专用地址，占7个字节，用来表明4部分的状况：磁道是 否完好、柱面逻辑地址号、磁头逻辑地址号和校验码。间隙化占18~ 38个字节长度。凡是磁 道标识块，用来说明本磁道的状况，不作为用户数据区。间隙也包含一个以专用字符表示的地 址标志，指明后面都是数据记录块。数据记录块凡由计数区、关键字区和数据区3段组成，这3 段都有循环校验码。一般要求一个记录限千同一磁道内，若设有专门的磁道溢出手段，则允许继 续记录到同一柱面的另一磁道内。数据区长度不定，实际长度由计数区的DL给定，通常为1~64  KB。从主存调出数据时，常常带有奇偶校验位，在写入磁盘时，则由磁盘控制器删去奇偶校验 位，并在数据区结束时加上循环校验位。当从磁盘读出数据时，需进行一次校验操作，并恢复原 来的奇偶校验位。可见，在磁盘数据区中，数据是串行的，字节之间没有间隙，字节后面没有校 验位。 1.概述 软磁盘存储器与硬磁盘存储器的存储原理和记录方式是相同的，但在结构上有较大差 别：硬盘转速高，存取速度快；软盘转速低，存取速度慢。硬盘有固定磁头、固定盘、盘组等结 构；软盘都是活动头，可换盘片结构。硬盘是靠浮动磁头读／写，磁头不接触盘片；软盘磁头 接接触盘片进行读／写。硬盘系统及硬盘片价格比较贵，大部分盘片不能互换；软盘价格便 宜，盘片保存方便、使用灵活、具有互换性。硬盘对环境要求苛刻，要求采用超净措施；软盘对 环境的要求不苛刻。因此，软盘在微小型计算机系统中获得了广泛的应用，甚至有的大中型 计算机系统中也配有软盘。 软磁盘存储器的种类主要是按其盘片尺寸不同而区分的，现有8英寸、5.25英寸、3.5英寸和 2.5英寸几种。软盘尺寸越小，记录密度就越高，驱动器也越小。从内部结构来看，若按使用的 磁记录面（磁头个数）不同和记录密度不同，又可分为单面单密度、单面双密度、双面双密度等多 种软盘存储器。"}
{"doc_id": "co", "page": 144, "text": "138 第2篇计算机系统的硬件结构 世界上第一台软盘机是美国IBM公司千1972年制成的IBM3740数据录入系统。它是8英 寸单面单密度软盘，容量只有256KB。1976年出现了5.25英寸软盘，20世纪80年代又出现了 3.5英寸和2.5英寸的微型软盘，其容量可达1MB以上。由于软盘价格便宜，使用灵活，盘片保 管方便，20世纪八九十年代曾作为外存的主要部件。 软盘存储器除主要用作外存设备外，还可以和键盘一起构成脱机输入装置，其作用是给程序 员提供输入程序和数据，然后再输入主机上运行，这样使输入操作不占用主机工作时间。 2.软磁盘盘片 软磁盘盘片的盘基是由厚约为76µ,m的聚酣薄膜制成，其两面涂有厚约为2.3~ 3 µ,m的磁 层。盘片装在塑料封套内，套内有一层无纺布，用来防尘，保护盘面不受碰撞，还起到消除静电的 作用。盘片连封套一起插入软盘机中，盘片在塑料套内旋转，磁头通过槽孔和盘片上的记录区接 触，无纺布消除因盘片转动而产生的静电，保证信息可以正常读／写。 塑料封套均为正方形，其上有许多孔，例如，用来装卡盘片的中心孔、用于定位的索引孔、用 于磁头读／写盘片的读／写孔，以及写保护缺口(8英寸盘）或允许写缺口(5.25英寸盘）等。图 4.74所示为软磁盘盘片及其外形示意图。 8英寸软盘有77个磁道，从外往里依次为00道到76道。5.25英寸软盘有40个和80个磁 道两种。 与硬磁盘相同，软磁盘盘面也分为若干个扇区（参见图4.70)，每条磁道上的扇段数是相同 的，记录同样多的信息。由于靠里的磁道圆周长小于外磁道的圆周长，因此，里圈磁道的位密度 比外圈磁道的位密度高。至于一个盘面分成几个扇区，则取决千它的记录方式。区段的划分一 般采用软分段方式，由软件写上的标志实现。 索引孔可作为旋转一圈开始或结束的标志，通常在盘片和保护套上各打有小孔。当盘片上 的小孔转到与保护套上的小孔位置重合时，通过光电检测元件测出信号，即标志磁道已到起点或 已为结束点。 3.5英寸盘的盘片装在硬塑料封套内，它们的基本结构与8英寸盘和5.25英寸盘类似。 按软盘驱动器的性能区分，有单面盘和双面盘。前者驱动器只有一个磁头，盘片只有一个面 可以记录信息。双面盘的驱动器有两个磁头，盘片有两个记录面。 按记录密度区分，有单密度和双密度两种。前者采用FM记录方式，后者采用MFM记 录方式。 综上所述，软盘分为单面单密度(ss、SD)、双面单密度(DS、SD)、单面双密度(ss、DD)、双面 双密度(DS、DD)四种。对于5.25英寸和3.5英寸的磁盘机而言，均采用双面双密度及高密度 （四倍密度）的记录方式。 3.软磁盘的记录格式 软磁盘存储器采用软分段格式，软分段格式有IBM格式和非IBM格式两种。IBM格式被国 际标准化组织(ISO)确定为国际标准。下面以IBM3740的8英寸软盘为例，介绍其软分段格 式，如图4.75所示。"}
{"doc_id": "co", "page": 145, "text": "第4章 存 储 器 139  m56.SEIIIA  (日日 OOZ).Jiw 8 腰型读勹孔门中心 孔 写保护缺口 8英寸(200mm) (a) 8英寸单面软盘外形(b) 8英寸软盘盘片 :D  5.25英寸(130mm)  (C) 5.25英寸软盘外形 图4.74软磁盘盘片及外形 软分段的磁道由首部、扇区部和尾部3部分组成。当磁盘驱动器检查到索引孔时，标志磁道 的起始位已找到。首部是一段空隙，是为避免由于不同软盘驱动器的索引检测器和磁头机械尺 寸误差引起读／写错误而设置的。尾部是依次设置在首部和各扇区后所剩下的间隙，起到转速变 化的缓冲作用。首部和尾部之间的弧被划分成若干扇区，又称为扇段。 图4.75(a)中索引孔信号的前沿标志磁道开始，经46个字节的间隙后，有一个字节的软索 引标志，后面再隔26个字节的间隙后，便是26个扇区（每个扇区188个字节），最后还有247个 字节的间隙，表示一个磁道结束。 图4.75(b)中标出了一个扇区的188个字节的具体分配。前13个字节是地址区，详细内容 可见图4.75(c)。其中地址信息占4个字节，分别指明磁道号、磁头号、区段号和记录长度。地"}
{"doc_id": "co", "page": 146, "text": "140 第2篇计算机系统的硬件结构 字节数国辈皇二卢言 \\  (a)/~迁个磁道的数据记录 / \\  / \\  /  \\  / \\  字节数6::|，三276 (b)一个扇区的数据记录格式 同步（全“0\")I 厚譬碍I地址ICRC  (6) I (1) I (4) I (2)  - 乡 , ,z  , /  /'  , ,  夕 - ,  /  乙 -Z ，一 ,  / ,  /'  1  \\  ',  `  \\  1,  1L  磁道号1磁头号1区段号1记录长度 00~4C I 00 I Ol~lA I 00  (c)地址区内容 图4.75IBM 3740软分段格式 址区字段的最后2个字节是CRC循环冗余校验码。此外，一个扇区内还有131个字节的数据 区，它由数据标志、数据、CRC校验码3部分组成。在地址区和数据区后各自都有一段间隙。 对图4.75所示的单面单密度软盘而言，其格式化容量为 磁道数／盘片X扇区数／磁道X数据字节数／扇区＝77x26x128 = 256 KB  不同规格的软盘，每磁道究竟分成多少区段，IBM格式都有明确规定。例如，5.25英寸软盘， 每磁道区段数为15、9或8三种，每个区段字节数均为512个。 出厂后未使用过的盘片称为白盘，需格式化后才能使用。采用统一的标准记录格式是为了 达到盘片互换及简化系统设计的目的。但是软件生产厂家为了保护软件的产权，常用改变盘片 上的数据格式来达到软件不被盗版的目的。因为通过对磁盘控制器编程，可以方便地指定每条 磁道上的扇区数和所采用的记录格式，甚至可以调整间隙长度，改变磁盘地址的安排顺序等。经 过这些处理，使用通用软件就不能正确复制磁盘文件」o 4.软磁盘驱动器和控制器 软磁盘存储器也由软磁盘驱动器、软磁盘控制器和软磁盘盘片3部分组成。软磁盘驱动器 是一个相对独立的装置，又称软盘机，主要由驱动机构、磁头及定位机构和读／写电路组成。软磁"}
{"doc_id": "co", "page": 147, "text": "第4章存储器141  盘控制器的功能是解释来自主机的命令，并向软磁盘驱动器发出各种控制信号，同时还要检测驱 动器的状态，按规定的数据格式向驱动器发出读／写数据命令等。具体操作如下。 叩寻道操作：将磁头定位在目标磁道上。 ＠地址检测操作：主机将目标地址送往软磁盘控制器，控制器从驱动器上按记录格式读取 地址信息，并与目标地址进行比较，找到欲读（写）信息的磁盘地址。 ＠读数据操作：首先检测数据标志是否正确，然后将数据字段的内容送入主存，最后用CRC 校验。 ＠写数据操作：写数据时，不仅要将原始信息经编码后写入磁盘，同时要写上数据区标志和 CRC校验码以及间隙。 ＠初始化：在盘片上写格式化信息，对每个磁道划分区段。 上述所有操作都是由软磁盘控制器完成的，为此设计了软磁盘控制器芯片，将许多功能集成 在一块芯片上，如FD1771、FD1991、µPD765等。这些芯片都是可编程的，将磁盘最基本的操作 用这些芯片的指令编程，便可实现对驱动器的控制。 软磁盘控制器发给驱动器的信号有：驱动器选择信号（表示某台驱动器与控制器接通）、马 达允许信号（表示驱动器的主轴电机旋转或停止）、步进信号（使所选驱动器的磁头按指定方向 移动，一次移一道）、步进方向（磁头移动的方向）、写数据与写允许信号、选头信号（选择“0“面 还是“1“面的磁头）。 驱动器提供给控制器的信号有：读出数据信号、写保护信号（表示盘片套上是否贴有写保护 标志，如果贴有标记，则发写保护信号）、索引信号（表示盘片旋转到索引孔位置，表明一个磁道 的开始）、0磁道信号（表示磁头正停在0号磁道上）。 图4.76是IBMPC上的软盘控制器逻辑框图。 磁带存储 1.概述 磁带存储器也属于磁表面存储器，记录原理和记录方式与磁盘存储器是相同的。但从存取 方式来看，磁盘存储器属于直接存取设备，即只要知道信息所在盘面、磁道和扇区的位置，磁头便 可直接找到其位置并读／写。磁带存储器必须按顺序进行存取，即磁带上的文件是按磁带头尾顺 序存放的。如果某文件存在磁带尾部，而磁头当前位置在磁带首部，那么必须等待磁带走到尾部 时才能读取该文件，因此磁带存取时间比磁盘长。但由千磁带容量比较大，位价也比磁盘的低， 而且格式统一，便千互换，因此，磁带存储器仍然是一种用千脱机存储的后备存储器。 磁带存储器由磁带和磁带机两部分组成。磁带按长度分，有2400英尺、1200英尺、600英 尺几种；按宽度分，有1/4英寸、1/2英寸、1英寸、3英寸几种；按记录密度分，有800bpi、 1 600 bpi、6250 bpi等几种；按磁带表面并行记录信息的道数分，有7道、9道、16道等；按磁带外形 分，有开盘式磁带和盒式磁带两种。现在计算机系统较广泛使用的两种标准磁带为：1/2英寸开盘"}
{"doc_id": "co", "page": 148, "text": "142 第2篇计算机系统的硬件结构 软盘驱动器 NEC  软盘控制器 雪 霹 顽丽窗口 道 彗卢荨 0 A 马达允许 译码器 BCDA  图4.76 B  C  D  软盘控制器逻辑框图 式和1/4英寸盒式。 磁带机又有很多种类，按磁带机规模分有标准半英寸磁带机、海量宽带磁带机(Mass Storage)和盒式磁带机三种。按磁带机走带速度分，有高速磁带机（4~ 5 rn/s)、中速磁带机 (2~3 rn/s)和低速磁带机(2rn/s以下）。磁带机的数据传输率取决于记录密度和走带速度。在 记录密度相同的情况下，带速越快，传输率就越高。按装卸磁带机构分，有手动装卸式和自动装 卸式；按磁带传动缓冲机构分，有摆杆式和真空式；按磁带的记录格式分，有启停式和数据流式。 数据流磁带机已成为现代计算机系统中主要的后备存储器，其位密度可达8000 bpi。它用千资 料保存、文件复制，作为脱机后备存储装置，特别是当温盘出现故障时，用以恢复系统。 磁带机正朝着提高传输率、提高记录密度、改善机械结构、提高可靠性等方向发展。 2.数据流磁带机 数据流磁带机是将数据连续地写到磁带上，每个数据块后有一个记录间隙，使磁带机在数据 块间不启停，简化了磁带机的结构，用电子控制替代了机械启停式控制，降低了成本，提高了 可靠性。"}
{"doc_id": "co", "page": 149, "text": "第4章存储器143  数据流磁带机有1/2英寸开盘式和1/4英寸盒式两种。盒式磁带的结构类似录音带和录像 带。盒带内装有供带盘和收带盘，磁带长度有450英尺和600英尺两种，容量分别为45MB和 60 MB。容量高达1GB和1.35GB的1/4英寸盒式数据流磁带机也已问世。当采用数据压缩技 术时，1/4英寸盒式数据流磁带机容量可达2GB或2.7GB。 数据流磁带机与传统的启停式磁带机的多位并行读／写不同，它采用类似磁盘的串行读／写 方式，记录格式与软盘类似。 以4道数据流磁带机为例，4个磁道的排列次序如图4.77所示。在记录信息时，先在第0道 上从磁带首端BOT记到磁带末端EOT，然后在第1道上反向记录，即从EOT到BOT，第2道又从 BOT到EOT,第3道从EOT到BOT。读出信息时，也是这个顺序。这种方式称为蛇形 (Serpentine)记录。9道1/4英寸数据流磁带记录格式也与此相同，偶数磁道从BOT到EOT，奇 数磁道从EOT到BOT，依次首尾相接。 l道 3道 0道 2道 图4.774道1/4英寸磁带蛇形串行记录方式 盒式数据流磁带机与主机的接口是标准的通用接口，可用小型计算机系统接口SCSI与主机 相连，也可以通过磁带控制器与主机相连。磁带控制器的作用类似千磁盘控制器，控制主机与磁 带机之间进行信息交换。 3.磁带的记录格式 磁带上的信息可以以文件形式存储，也可以按数据块存储。磁带可以在数据块之间启停，进 行数据传输。按数据块存储的磁带互换性更好。 磁带机与主机之间进行信息传送的最小单位是数据块或称为记录块(Block)，记录块的长度 可以是固定的，也可以是变化的，由操作系统决定。记录块之间有空白间隙，作为磁头停靠的地 方，并保证磁带机停止或启动时有足够的惯性缓冲。记录块尾部有几行特殊的标记，表示数据块 结束接着便是校验区。图4.78示意了磁带机上的数据格式。 店且覆甘志数据记尾标录志校验码块间间隙I 记录块 记录块 图4.78磁带的数据格式"}
{"doc_id": "co", "page": 150, "text": "144 第2篇计算机系统的硬件结构 磁带信息的校验属千多重校验，由奇偶校验、循环冗余校验和纵向冗余校验共同完成。以9 道磁带为例，横向可以并排记录9位二进制信息（称为一行），其中8位是数据磁道，存储一个字 节，另一位是这一字节的奇偶校验位，称为横向奇偶校验码。在每一个数据块内，沿纵向（走带 方向）每一磁道还配有CRC校验码。此外对每一磁道上的信息（包括CRC在内），又有一个纵向 奇偶校验码。纠错的原理是用循环冗余码的规律和专门线路，指出出错的磁道(CRC可发现一 个磁道上的多个错误码），然后用横向校验码检测每一行是否有错，纵横交错后就可指明哪行哪 道有错，如有错就立即纠正。 循环冗余校验 磁表面存储器由于磁介质表面的缺陷、尘埃等原因，致使出现多个错误码。循环冗余校验 (Cyclic Redundancy Check, CRC)码可以发现并纠正信息在存储或传送过程中连续出现的多位错 误代码。因此，CRC校验码在磁介质存储器和计算机之间通信方面得到广泛应用。 CRC码是基千模2运算而建立编码规律的校验码。模2运算的特点是不考虑进位和借位的 运算，其规律如下： 叩模2加和模2减的结果是相等的，即0玑＝1,0士O=0, 1土O=1, 1土l=O。可见，两个相 同数的模2和恒为0。 ＠模2乘是按模2和求部分积之和。 ＠模2除是按模2减求部分余数。每求一位商应使部分余数减少一位。上商的原则是：当 部分余数的首位为1时，上商l；当部分余数的首位为0时，上商0。当部分余数的位数小于除数 的位数时，该余数即为最后余数。 ＠和＠的实例如下： 101---－商 101荨 1010 101  X 101 010  1010 000  0000 100  1010 101  100010 01 ---－余数 @ @  1. CRC码的编码方法 设待编的信息码组为Dn-1Dn-2…D2D1D。，共n位，它可用多项式M(x)表示："}
{"doc_id": "co", "page": 151, "text": "第4章存储器145  M(X) = D n-1 x\"-1 + Dn_zXn-2+…＋Dl矿＋D。XO 将信息码组左移K位，得M(x)· x\".，即成n+k位信息码组： Dn-1 +kDn-2 +k\" • \"• D2 +kDl +kD。丑．三 k位 空出的K位用来拼接k位校验位。 CRC码就是用多项式M(x)· xk除以生成多项式G(x)（即产生校验码的多项式），所得余数 作为校验位。为了得到K位余数（校验位），G(x)必须是k+l位。 设所得余数为R(x)，商为Q(x)，则有 M(X) · xk=Q(x) · G(x)+R(x)  将余数拼接在左移了K位后的信息位后面，就构成了这个有效信息的CRC码。这个CRC 码用多项式表示为 M (x) • xk + R (x) = [ Q (x) • G (x) + R (x) ] + R (x)  = [ Q(x) · G(x)] +[R(x) +R(x)]  =Q(x) · G(x)（模2和） 因此，所得CRC码是一个可被生成多项式G(x)除尽的数码。如果CRC码在传输过程中不 出错，其余数必为0；如果传输过程中出错，则余数不为0，再由该余数指出哪一位出错，即可 纠正。 例4.15已知有效信息为1100，试用生成多项式G(x)=1011将其编成CRC码。 解：有效信息M(x)= 1100 =x3 +x2  由 旦寸41  (n= 4)  G(x)= 101l=x3+x+l  k+l =4  所以k=3  将有效信息左移3位后再被G(x)模2除，即 M(x) · x3 = 1100000＝汒＋x5 M (x) x 3 1100000... ~. 010 = ~= 1110+（模2除） G(x) 1011 - -1011  所以M(x) · x 3 + R (x) = 1100000 + 010 = 1100010为CRC码。 总的信息位为7位，有效信息位为4位，故上述1100010码又称(7,4)码。这里的(7,4)码 即为码制，还可以有(7,3)码制和(7,6)码制等。 2. CRC码的译码和纠错 将收到的循环校验码用约定的生成多项式G(x)去除，如果无错，则余数应为0，如果某一 位出错，则余数不为0。不同的出错位其余数也不同，表4.6列出了对应G(x)=1011的出错 模式。"}
{"doc_id": "co", "page": 152, "text": "146 第2篇计算机系统的硬件结构 表4.6对应G(x)= 1011的(7,4)循环的出错模式 序号NI N2 N3 N4 N5 N6 N? 余数出错位 正确1 1 。。。1 。000 无 1 1 。。。1 1 001 7  1 1 。。。。。010 6  1 1 。 。1 1 。100 5  错 1 1 。1 。1 。011 4  陕、口 1 1 1 。。1 。110 3  1 。。。。1 。111 2  。1 。。。1 。101 1  可以证明，更换不同的待测码字，余数和出错位的对应关系不变，只与码制和生成多项式有 关。表4.6给出的关系只对应G(x)=1011的(7,4)码，对于其他码制或选用其他生成多项式，出 错模式将发生变化。 如果循环码有一位出错，被G(x)模2除将得到一个不为0的余数。如果对余数补0继续除 下去，将发现各次所得余数将按表4.6顺序循环。例如，第7位出错，其余数为001，补0后再除， 第二次余数为010，以后依次为100,011…，反复循环，这就是＂循环码”的名称由来。这个特点正 好用来纠错，即当出现不为零的余数后，一方面对余数补0继续做模2除，另一方面将被检测的 校验码字循环左移。由表4.6可知，当出现余数为101时，出错位也移到了Nl位置。可通过异 或门将其纠正后在下一次移位时送回N7。这样当移满一个循环［对(7,4)码共移7次］后，就得 到一个纠正后的码字。 值得指出的是，并不是任何一个(k+l)位多项式都可以作为生成多项式。从检错和纠错的 要求出发，生成多项式应满足以下要求： 心任何一位发生错误，都应该使余数不为零。 ＠不同位发生错误应使余数不同。 ＠对余数继续做模2除，应使余数循环。 达到上述要求的数学关系比较复杂，读者若有兴趣可查阅有关资料。 1.概述 光盘(OpticalDisk)是利用光学方式进行读／写信息的圆盘。光盘存储器是在激光视频唱 片和数字音频唱片基础上发展起来的。应用激光在某种介质上写入信息，然后再利用激光读 出信息，这种技术称为光存储技术。如果光存储使用的介质是磁性材料，即利用激光在磁记"}
{"doc_id": "co", "page": 153, "text": "第4章存储器147  录介质上存储信息，就称为磁光存储。通常把采用非磁性介质进行光存储的技术称为第一代 光存储技术，它不能把内容抹掉重写新内容。磁光存储技术是在光存储技术基础上发展起来 的，称为第二代光存储技术，主要特点是可擦除重写。根据光存储性能和用途的不同，光盘存 储器可分为三类。 (1)只读型光盘(CD-ROM) 这种光盘内的数据和程序是由厂家事先写入的，使用时用户只能读出，不能修改或写入新的 内容。它主要用于电视唱片和数字音频唱片，可以获得高质量的图像和高保真的音乐。在计算 机领域里，主要用千检索文献数据库或其他数据库，也可用于计算机的辅助教学等。因它具有 ROM特性，故称为CD-ROM(CompactDisk-ROM)。 (2)只写一次型光盘(WORM) 这种光盘允许用户写入信息，写入后可多次读出，但只能写入一次，而且不能修改，故称其为 ”写一次型”(WriteOnce Read Many, WORM)，主要用于计算机系统中的文件存档，或写入的信 息不再需要修改的场合。 (3)可擦写型光盘 这种光盘类似磁盘，可以重复读／写。从原理上来看，目前仅有光磁记录（热磁反转）和相变 记录（晶态－非晶态转变）两种。它是很有前途的辅助存储器。1989年下半年可擦写型5.25英 寸的光盘，双面格式化的容量达到500~650MB。2004年索尼公司的ProDATA光盘单面容量已 高达25GB，读取速度每秒11MB，刻录速度每秒9MB。 2.光盘的存取原理 光盘存储器利用激光束在记录表面上存储信息，根据激光束和反射光的强弱不同，可以 实现信息的读／写。由千光学读／写头和介质保持较大的距离，因此，它是非接触型读／写的 存储器。 对千只读型和只写一次型光盘而言，写入时，将光束聚焦成直径为小于1µm的微小光点， 使其能量高度集中，在记录的介质上发生物理或化学变化，从而存储信息。例如，激光束以其热 作用熔化盘表面的光存储介质薄膜，在薄膜上形成小凹坑，有坑的位置表示记录”l\"，没坑的位 置表示“0”。又比如，有些光存储介质在激光照射下，使照射点温度升高，冷却后晶体结构或晶 粒大小会发生变化，从而导致介质膜光学性质发生变化（如折射率和反射率），利用这一现象便 可记录信息。 读出时，在读出光束的照射下，在有凹处和无凹处反射的光强是不同的，利用这种差别， 可以读出二进制信息。由于读出光束的功率只有写入光束的1/10，因此不会使盘面熔出新的 凹坑。 可擦写光盘利用激光在磁性薄膜上产生热磁效应来记录信息（称为磁光存储）。其原理 是：在一定温度下，对磁介质表面加一个强度高于该介质矫顽力的磁场，就会发生磁通翻转， 便可用千记录信息。矫顽力的大小是随温度而变的。倘若设法控制温度，降低介质的矫顽 力，那么外加磁场强度便很容易高于此矫顽力，使介质表面磁通发生翻转。磁光存储就是根"}
{"doc_id": "co", "page": 154, "text": "148 第2篇计算机系统的硬件结构 据这一原理来存储信息的。它利用激光照射磁性薄膜，使其被照处温度升高，矫顽力下降，在 外磁场HR作用下，该处发生磁通翻转，并使其磁化方向与外磁场 HR一致，就可视为寄存”1”。不被照射处或HR小于矫顽力处可 视为寄存“0”。通常把这种磁记录材料因受热而发生磁性变化的现 象称为热磁效应。 图4.79(a)表示在记录方向外加一个小千矫顽力的磁场HR，其 介质表面不发生翻转；图4.79 (b)表示激光照射处温度上升，外加 的磁场HR大于矫顽力，而使其发生磁通翻转；图4.79(C)表示照射 后，将磁通翻转保持下来，即写入了信息。 擦除信息和记录信息原理一样，擦除时外加一个和记录方向相 反的磁场HR，对已写入的信息用激光束照射，并使HR大于矫顽 力，那么，被照射处又发生反方向磁化，使之恢复为记录前的状态。 这种利用激光的热作用改变磁化方向来记录信息的光盘称为 磁光盘。 3．光盘存储器的组成 光盘存储器与磁盘存储器很相似，它也由盘片、驱动器和控制 器组成。驱动器同样有读／写头、寻道定位机构、主轴驱动机构等。 除了机械电子机构外，还有光学机构。图4.80是写一次型光盘的光 学系统的示意图。 图4.80写一次型光盘光学系统的示意图 (a)  、\\ , 光源 (b)  l l f l l  (c)  图4.79磁光记录原理 图中激光器产生的光束经分离器分离后，其中90％的光束用作记录光束，10％的光束作为读 出光束。记录光束经调制器，由聚焦系统向光盘记录信息。读出光束经几个反射镜射到光盘盘 片，读出光信号再经光电二极管输出。 光盘盘片的形状与磁盘盘片类似，但记录材料不同。只读型光盘与只写一次型光盘都是三"}
{"doc_id": "co", "page": 155, "text": "第4章存储器149  层式结构。第一层为基板，第二层为涂覆在基板上的一层铝质反射层，最上面一层为很薄的金属 膜。反射层和金属薄膜的厚度取决于激光源的波长入，两者厚度之和为入／4。金属膜的材料一 般是谛(Te)的合金组成，这种材料在激光源的照射下会熔成一个小凹坑，用以表示“1”或“0”。 4．光盘存储器与其他辅助存储器的比较 光盘、硬盘、软盘、磁带在记录原理上很相似，都属于表面介质存储器。它们都包括头、精 密机械、马达及电子线路等。在技术上都可采用自同步技术、定位和校正技术。它们都包含 盘片、控制器、驱动器等。但由于它们各自的特点和功能不同，使其在计算机系统中的应用各 不相同。 光盘是非接触式读／写信息，光学头与盘面的距离几乎比磁盘的磁头与盘面的间隙大1万 倍，互不摩擦，介质不会被破坏，大大提高了光盘的耐用性，其使用寿命可长达数十年以上。 光盘可靠性高，对使用环境要求不高，机械振动的问题甚少，不需要采取特殊的防震和防尘 措施。 由于光盘是靠直径小千1µm的激光束写入每位信息，因此记录密度高，可达108位／cm2，约 为磁盘的10~100倍。 光盘记录头分量重，体积大，使寻道时间长约30~100 ms。写入速度低，约为0.2s，平均存取 时间为100~500ms，与主机交换信息速度不匹配。因此，它不能代替硬盘，只能作为硬盘的后备 存储器。 光盘的介质互换性好，存储容量大，可用于文献档案、图书管理、多媒体等方面的应用。但由 千目前价格比较贵，故尚不能替代磁带机。 硬磁盘存储器容量大，数据传输率比光盘高（采用磁盘阵列，数据传输率可达100Mbps)，等 待时间短。它作为主存的后备存储器，用以存放程序的中间和最后结果。 软磁盘存储器容量小，数据传输率低，平均寻道时间长，而且是接触式存取，盘片不固定在驱 动器中，运行时有大量的灰尘进入盘面，易造成盘面磨损或出现误码，不易提高位密度。近年来 软盘已逐渐被淘汰。 磁带存储器的历史比磁盘更久，20世纪60年代后期逐渐被磁盘取代。它的数据传输率更 低，采用接触式记录，容量也很大，每兆字节价格较低，记录介质也容易装卸、互换和携带，可用作 硬盘的后备存储器。据统计，80％的磁带被用作磁盘的后备存储器，20％的磁带用作计算机的输 入输出数据和文件的存储。 4.1 解释概念：主存、辅存、Cache、RAM、SRAM、DRAM、ROM、PROM、EPROM、EEPROM、CDROM、Flash Memory。 4.2 计算机中哪些部件可用于存储信息，按其速度、容量和价格／位排序说明。 4.3 存储器的层次结构主要体现在什么地方，为什么要分这些层次，计算机如何管理这些层次？"}
{"doc_id": "co", "page": 156, "text": "150 第2篇计算机系统的硬件结构 4.4 说明存取周期和存取时间的区别。 4.5 什么是存储器的带宽？若存储器的数据总线宽度为32位，存取周期为200ns，则存储器的带宽 是多少？ 4.6 某机字长为32位，其存储容量是64KB，按字编址其寻址范围是多少？若主存以字节编址，试画出主 存字地址和字节地址的分配情况。 4.7 一个容量为16Kx32位的存储器，其地址线和数据线的总和是多少？当选用下列不同规格的存储芯 片时，各需要多少片？ 1 Kx4位，2Kx8位，4Kx4位，16Kxl位，4Kx8位，8Kx8位 4.8 试比较静态RAM和动态RAM。 4.9 什么叫刷新？为什么要刷新？说明刷新有几种方法。 4.10 半导体存储器芯片的译码驱动方式有几种？ 4.11 一个8Kx8位的动态RAM芯片，其内部结构排列成256x256形式，读／写周期为0.1µ,s。试问采用集 中刷新、分散刷新及异步刷新三种方式的刷新间隔各为多少？ 4.12 画出用1024X4位的存储芯片组成一个容量为64Kx8位的存储器逻辑框图。要求将64K分成4个 页面0，每个页面分16组，共需多少片存储芯片？ 4.13 设有一个64Kx8位的RAM芯片，试问该芯片共有多少个基本单元电路（简称存储基元）？欲设计一 种具有上述同样多存储基元的芯片，要求对芯片字长的选择应满足地址线和数据线的总和为最小，试确定这种 芯片的地址线和数据线，并说明有几种解答。 4.14 某8位微型计算机地址码为18位，若使用4Kx4位的RAM芯片组成模块板结构的存储器，试问： (1)该机所允许的最大主存空间是多少？ (2)若每个模块板为32Kx8位，共需几个模块板？ (3)每个模块板内共有几片RAM芯片？ (4)共有多少片RAM? (5) CPU如何选择各模块板？ 4.15 设CPU共有16根地址线，8根数据线，并用MREQ（低电平有效）作访存控制信号，R／《作读／写命令 信号（高电平为读，低电平为写）。现有这些存储芯片：ROM(2Kx8位，4Kx4位，8Kx8位），RAM(1Kx4位， 2 Kx8位，4Kx8位）及74138译码器和其他门电路（门电路自定）。 试从上述规格中选用合适的芯片，画出CPU和存储芯片的连接图。要求如下： (1)最小4K地址为系统程序区，4096~ 16383地址范围为用户程序区。 (2)指出选用的存储芯片类型及数量。 (3)详细画出片选逻辑。 4.16 CPU假设同上题，现有8片8Kx8位的RAM芯片与CPU相连。 (1)用74138译码器画出CPU与存储芯片的连接图。 (2)写出每片RAM的地址范围。 (3)如果运行时发现不论往哪片RAM写入数据，以AOOOH为起始地址的存储芯片都有与其相同的数据， 分析故障原因。 0 将存储器分成若干个容量相等的区域，每一个区域可看作一个页面。"}
{"doc_id": "co", "page": 157, "text": "第4章存储器 (4)根据(1)的连接图，若出现地址线A13与CPU断线，并搭接到高电平上，将出现什么后果？ 4.17 写出1100、1101、1110、1111对应的汉明码。 151  4.18 已知接收到的汉明码（按配偶原则配置）为1100100、1100111、1100000、1100001，检查上述代码是否 出错？第几位出错？ 4.19 已知接收到下列汉明码，分别写出它们所对应的欲传送代码。 1100000（按偶性配置） 1100010（按偶性配置） 1101001（按偶性配置） 0011001（按奇性配置） 1000000（按奇性配置） 1110001（按奇性配置） 4.20 欲传送的二进制代码为1001101，用奇校验来确定其对应的汉明码，若在第6位出错，说明纠错过程。 4.21 为什么在汉明码纠错过程中，新的检测位P4P2P1的状态即指出了编码中错误的信息位？ 4.22 某机字长为16位，常规的存储空间为64K字，若想不改用其他高速的存储芯片，而使访存速度提高 到8倍，可采取什么措施？画图说明。 4.23 设CPU共有16根地址线，8根数据线，并用M／而作为访问存储器或I/0的控制信号（高电平为访 存，低电平为访I/0)，而五（低电平有效）为写命令，面｝（低电平有效）为读命令。设计一个容量为64KB的采用 低位交叉编址的8体并行结构存储器。现有右图所示的存储芯片及 74138译码器。 画出CPU和存储芯片（芯片容量自定）的连接图，并写出图中每个 存储芯片的地址范围（用十六进制数表示）。 4.24 一个4体低位交叉的存储器，假设存取周期为T,CPU每隔 1/4存取周期启动一个存储体，试问依次访问64个字需多少个存取 周期？ 4.25 什么是程序访问的局部性？存储系统中哪一级采用了程序 访问的局部性原理？ Ai A。 DII D。 沉允许读 WE允许写 茬片选 4.26 计算机中设置Cache的作用是什么？能不能把Cache的容量扩大，最后取代主存，为什么？ 4.27 Cache制作在CPU芯片内有什么好处？将指令Cache和数据Cache分开又有什么好处？ 4.28 设主存容量为256K字，Cache容量为2K字，块长为4。 (1)设计Cache地址格式，Cache中可装入多少块数据？ (2)在直接映射方式下，设计主存地址格式。 (3)在四路组相联映射方式下，设计主存地址格式。 (4)在全相联映射方式下，设计主存地址格式。 (5)若存储字长为32位，存储器按字节寻址，写出上述三种映射方式下主存的地址格式。 4.29 假设CPU执行某段程序时共访问Cache命中4800次，访问主存200次，已知Cache的存取周期是 30 ns，主存的存取周期是150ns，求Cache的命中率以及Cache－主存系统的平均访问时间和效率，试问该系统的 性能提高了多少？ 4.30 一个组相联映射的Cache由64块组成，每组内包含4块。主存包含4096块，每块由128字组成，访"}
{"doc_id": "co", "page": 158, "text": "152 第2篇计算机系统的硬件结构 存地址为字地址。试问主存和Cache的地址各为几位？画出主存的地址格式。 4.31 设主存容量为1MB，采用直接映射方式的Cache容量为16KB，块长为4，每字32位。试问主存地址 为ABCDEH的存储单元在Cache中的什么位置？ 4.32设某机主存容量为4MB,Cache容量为16KB，每字块有8个字，每字32位，设计一个四路组相联映 射（即Cache每组内共有4个字块）的Cache组织。 (1)画出主存地址字段中各段的位数。 (2)设Cache的初态为空，CPU依次从主存第0,1,2,…,89号单元读出90个字（主存一次读出一个字），并 重复按此次序读8次，间命中率是多少？ (3)若Cache的速度是主存的6倍，试问有Cache和无Cache相比，速度约提高多少倍？ 4.33 简要说明提高访存速度可采取的措施。 4.34 反映主存和外存的速度指标有何不同？ 4.35 画出RZ、NRZ、NRZl、PE、FM写入数字串1011001的写电流波形图。 4.36 以写入10010110为例，比较调频制和改进调频制的写电流波形图。 4.37 画出调相制记录01100010的驱动电流、记录磁通、感应电势、同步脉冲及读出代码等几种波形。 4.38 磁盘组有6片磁盘，最外两侧盘面可以记录，存储区域内径22cm，外径33cm，道密度为40道／cm，内 层密度为400位／cm，转速3600 r/min。 (1)共有多少存储面可用？ (2)共有多少柱面？ (3)盘组总存储容量是多少？ (4)数据传输率是多少？ 4.39 某磁盘存储器转速为3000 r/min，共有4个记录盘面，每毫米5道，每道记录信息12288字节，最小 磁道直径为230mm，共有275道，求： (1)磁盘存储器的存储容量。 (2)最高位密度（最小磁道的位密度）和最低位密度。 (3)磁盘数据传输率。 (4)平均等待时间。 4.40采用定长数据块记录格式的磁盘存储器，直接寻址的最小单位是什么？寻址命令中如何表示磁 盘地址？ 4.41 设有效信息为110，试用生成多项式G(x)= 11011将其编成循环冗余校验码。 4.42 有一个(7,4)码，生成多项式G(x)= x3 + x + 1，写出代码1001的循环冗余校验码。 4.43 磁表面存储器和光盘存储器记录信息的原理有何不同？ 4.44 试从存储容量、存取速度、使用寿命和应用场合方面比较磁盘、磁带和光盘存储器。 附 相联存储器既可按地址寻址，又可按内容（通常是某些字段）寻址，为与传统存储器区别，又 称为按内容寻址的存储器。"}
{"doc_id": "co", "page": 159, "text": "第4章存储器153  相联存储器的每个字由若干字段组成，每个字段描述了一个对象的属性，也称一个内 容。例如，在存储学生信息的相联存储器中，可分为学号、姓名、年龄、班号、成绩等字段（参 见图4.82)。 相联存储器的基本组成如图4.81所示。 | x | x | x|x|x | x | x|…|x | x | CR  0 I I I I I I I I • • •  11 I I I I I I I • • •  2 I I I I I I I I • • •  存储体 ...  w-1  1 2 3 4  --l  [  I 代码寄存器1 l  '--------------------------------.J  图4.81相联存储器基本组成框图 图中检索寄存器CR用来存放检索字，其位数与相联存储器的字长相等。屏蔽寄存器 MR用来存放屏蔽码，其位数与检索寄存器位数相同，其内容与需要检索的字段有关。如需 检索CR的高6位字段（称为检索项），则MR的高6位为“1\"，其余各位为“O\"，即把CR中 的第7~n位屏蔽掉，也即这些位不参加比较。比较线路是把检索项和所有存储单元的相应 位进行比较，如果比较结果相等，就将符合寄存器RR的相应位置“1”。RR又称为查找结 果寄存器，其位数等于相联存储器的字数。如果比较结果第i个字满足要求，则RR的第i 位为“1\"，其余各位为“0”；如果同时有5个字都满足要求，则RR中就有5位为“1”。有的 相联存储器还设有字选择寄存器WSR，用来确定哪些存储字参与检索。若WSR某位为 \" 1 \"，则表示对应的存储字参与检索，而对应WSR某位为“0\"的存储字则不参与检索。可 见WSR的位数与存储器字数相同。代码寄存器用来存放从存储体中读出的代码，或存放 写至存储体中的代码。 相联存储器有三种基本操作：读、写、检索（比较）。读、写操作与传统存储器相同，检索只 能按内容进行。例如，某系学生的考试成绩巳存入相联存储器中，如图4.82所示。要求列出 总分在580~ 600分范围内的学生名单，可通过两次查找来完成。第一次找出总分大于579的 学生名单，第二次找出总分小于601的学生名单。可见总分字段是关键字，故需要将MR中对 应的位置成“1\"，其他字段置成“0\"。第一次查找时，CR中的“总分”字段是579(二进制表"}
{"doc_id": "co", "page": 160, "text": "154 第2篇计算机系统的硬件结构 示），查找结果送入RR。第二次查找时，将CR中“总分”字段改为“601”，并且将RR的内容 送至WSR，这样，第二次查找只需查WSR中对应”1\"的各个存储字。最后将查找结果送入 RR，此时RR中为“1\"的各位所对应的学生，其成绩便在580~ 600分之间。通过打印机将名 单打印出来。 CR（第一次查找的内容） | o...o |。.．．o| o...o |0· • ·o |。.．．o| 11 • • • l I MR  1 赵XX男17 985101 586  2 钱XX女18 985101 607  3 孙XX男18 985102 582  4 李XX女19 985103 570  ..  n 丁XX女19 985105 590  学号姓名性别年龄班号总分RR WSR  图4.82相联存储器检索举例 这里需要特别指出的是，相联存储器每次查找是将所有存储字的相关字段与检索项同时进 行比较，这是由相联存储器的具体电路实现的。如果是按地址访问的存储器，查找时则必须一次 读出一个存储字，逐一与检索项进行比较。如果设存储器有M个单元，那么按地址访问的存储 器检索出某一单元，平均需进行M/2次操作，而相联存储器仅需进行一次检索操作。由此可见， 相联存储器大大提高了处理速度。 相联存储器还可以进行各种比较，如大于、小于、相等、不等、求最大值、求最小值、相似、接近 以及其他各种类型的逻辑检索。因此，相联存储器的每个单元不仅能存储，还要能进行逻辑运 算，需增加很多逻辑电路，所以也称为分布逻辑存储器。显然，其电路比一般存储器复杂得多，故 相联存储芯片比一般存储芯片昂贵。随着大规模集成电路集成度的提高，相联存储芯片巳由4K 位、8K位发展到20K位，商品化容量巳经达到256x48位。 相联存储器的原理在Cache中得到应用。例如，在Cache中将主存的字块标记同时与每个 缓存字块的”标记”进行比较，就可迅速判断出该主存字块是否”命中＂。若比较相等，表示命中， 即可从缓存中读出信息；若不等，即不命中，则需将新的主存块调入缓存。 此外，相联存储器还广泛应用于虚拟存储器中，还常用于数据库和知识库中。近年来，相联 存储器在语音识别、图像处理、数据流计算机和Prolog机中也都有所应用。"}
{"doc_id": "co", "page": 161, "text": "二 除了CPU和存储器两大模块外，计算机硬件系统的第三个关键部分是输入输出模块，又称 输入输出系统。随着计算机系统的不断发展，应用范围的不断扩大，I/0设备的数量和种类也越 来越多，它们与主机的联络方式及信息的交换方式也各不相同。因此，输入输出系统涉及的内容 极其繁杂，既包括具体的各类I/0设备，又包括各种不同的I/0设备如何与主机交换信息。本章 重点分析I/0设备与主机交换信息的三种控制方式（程序查询、中断和DMA)及其相应的接口功 能和组成，对几种常用的I/0设备也进行简单介绍，旨在使读者对输入输出系统有一个较清晰的 认识，进一步加深对整机工作的理解。 5.1 概述 1  输概 输入输出系统的发展大致可分为4个阶段。 1.早期阶段 早期的I/0设备种类较少，I/0设备与主存交换信息都必须通过CPU，如图5.1所示。 图5.1I/0设备通过CPU与主存交换信息 这种交换方式延续了相当长的时间。当时的I/0设备具有以下几个特点。 ＠每个I/0设备都必须配有一套独立的逻辑电路与CPU相连，用来实现I/0设备与主机 之间的信息交换，因此线路十分散乱、庞杂。 0输入输出过程是穿插在CPU执行程序过程之中进行的，当I/0设备与主机交换信息时， CPU不得不停止各种运算，因此，I/0设备与CPU是按串行方式工作的，极浪费时间。 0每个I/0设备的逻辑控制电路与CPU的控制器紧密构成一个不可分割的整体，它们彼 此依赖，相互牵连，因此，欲增添、撤减或更换I/0设备是非常困难的。"}
{"doc_id": "co", "page": 162, "text": "156 第2篇计算机系统的硬件结构 在这个阶段中，计算机系统硬件价格十分昂贵，机器运行速度不高，配置的I/0设备不多， 机与I/0设备之间交换的信息量也不大，计算机应用尚未普及。 2.接口模块和DMA阶段 这个阶段I/0设备通过接口模块与主机连接，计算机系统采用了总线结构，如图5.2所示。 图5.2I/0设备通过接口与主机交换信息 通常，在接口中都设有数据通路和控制通路。数据经过接口既起到缓冲作用，又可完成串－ 并变换。控制通路用以传送CPU向I/0设备发出的各种控制命令，或使CPU接受来自I/0设 备的反馈信号。许多接口还能满足中断请求处理的要求，使I/0设备与CPU可按并行方式工 作，大大地提高了CPU的工作效率。采用接口技术还可以使多台I/0设备分时占用总线，使多 台I/0设备互相之间也可实现并行工作方式，有利于整机工作效率的提高。 虽然这个阶段实现了CPU和I/0设备并行工作，但是在主机与I/0设备交换信息时，CPU 要中断现行程序，即CPU与I/0设备还不能做到绝对的并行工作。 为了进一步提高CPU的工作效率，又出现了直接存储器存取(DirectMemory Access, DMA)  技术，其特点是I/0设备与主存之间有一条直接数据通路，I/0设备可以与主存直接交换信息， 使CPU在I/0设备与主存交换信息时能继续完成自身的工作，故资源利用率得到了进一步 提高。 3．具有通道结构的阶段 在小型和微型计算机中，采用DMA方式可实现高速I/0设备与主机之间成组数据的交换， 但在大中型计算机中，I/0设备配置繁多，数据传送频繁，若仍采用DMA方式会出现一系列 问题。 心如果每台I/0设备都配置专用的DMA接口，不仅增加了硬件成本，而且为了解决众多 DMA接口同时访问主存的冲突问题，会使控制变得十分复杂。 (2) CPU需要对众多的DMA接口进行管理，同样会 占用CPU的工作时间，而且因频繁地进入周期挪用阶 段，也会直接影响CPU的整体工作效率（详见5.6节）。 因此在大中型计算机系统中，采用I/0通道的方式 来进行数据交换。图5.3所示为具有通道结构的计算 机系统。 图5.3I/0设备通过通道与 主机交换信息"}
{"doc_id": "co", "page": 163, "text": "第5章输入输出系统157  通道是用来负责管理I/0设备以及实现主存与I/0设备之间交换信息的部件，可以视为一 种具有特殊功能的处理器。通道有专用的通道指令，能独立地执行用通道指令所编写的输入输 出程序，但不是一个完全独立的处理器。它依据CPU的I/0指令进行启动、停止或改变工作状 态，是从属于CPU的一个专用处理器。依赖通道管理的I/0设备在与主机交换信息时，CPU不 直接参与管理，故提高了CPU的资源利用率。 4.具有I/0处理机的阶段 输入输出系统发展到第四阶段，出现了I/0处理机。I/0处理机又称为外围处理机(Per­ ipheral Processor)，它基本独立千主机工作，既可完成I/0通道要完成的I/0控制，又可完成码制 变换，格式处理，数据块检错、纠错等操作。具有I/0处理机的输入输出系统与CPU工作的并行 性更高，这说明I/0系统对主机来说具有更大的独立性。 本章主要介绍第二阶段的输入输出系统，有关通道及I/0处理机管理I/0系统的内容将在 ”计算机体系结构”课程中讲述。 输的 输入输出系统由1/0软件和1/0硬件两部分组成。 1. 1/0软件 输入输出系统软件的主要任务如下： 少将用户编制的程序（或数据）输入主机内。 ＠将运算结果输送给用户。 ＠实现输入输出系统与主机工作的协调等。 不同结构的输入输出系统所采用的软件技术差异很大。一般而言，当采用接口模块方式时， 应用机器指令系统中的1/0指令及系统软件中的管理程序便可使1/0设备与主机协调工作。当 采用通道管理方式时，除1/0指令外，还必须有通道指令及相应的操作系统。即使都采用操作系 统，不同的机器其操作系统的复杂程度差异也是很大的。 (1) 1/0指令 1/0指令是机器指令的一类，其指令格式与其他指令既有相似之处，又有所不同。1/0指令 可以和其他机器指令的字长相等，但它还应该能反映CPU与I/0 设备交换信息的各种特点，如它必须反映出对多台I/0设备的选1操作码1命令码1设备码1 择，以及在完成信息交换过程中，对不同设备应做哪些具体操作 图5.4I/0指令的一般格式 等。图5.4示意了1/0指令的一般格式。 图中的操作码字段可作为1/0指令与其他指令（如访存指令、算逻指令、控制指令等）的判 别代码；命令码体现1/0设备的具体操作；设备码是多台1/0设备的选择码。 1/0指令的命令码一般可表述如下几种情况。 0将数据从I/0设备输入主机。例如，将某台设备接口电路的数据缓冲寄存器中的数据读"}
{"doc_id": "co", "page": 164, "text": "158 第2篇计算机系统的硬件结构 入CPU的某个寄存器（如累加器ACC)。 ·将数据从主机输出至I/0设备。例如，将CPU的某个寄存器（如ACC)中的数据写入某 台设备接口电路的数据缓冲寄存器内。 ·状态测试。利用命令码检测各个I/0设备所处的状态是＂忙\"(Busy)还是“准备就绪＂ (Ready)，以便决定下一步是否可进入主机与I/0设备交换信息的阶段。 0形成某些操作命令。不同I/0设备与主机交换信息时，需要完成不同的操作。例如，磁 带机需要正转、反转、读、写、写文件结束等；对千磁盘驱动器，需要读扇区、写扇区、找磁道、扫描 记录标识符等。这里值得注意的是，在第4章中，按磁盘机和磁带机的功能来看，它们都被视为 存储系统的一部分；但从管理角度来看，调用这些设备与调用其他I/0设备又有共同之处。因 此，本章又将它们视为I/0设备。 I/0指令的设备码相当于设备的地址。只有对繁多的I/0设备赋以不同的编号，才能准确 选择某台设备与主机交换信息。 (2)通道指令 通道指令是对具有通道的I/0系统专门设置的指令，这类指令一般用以指明参与传送（ 入或读取）的数据组在主存中的首地址；指明需要传送的字节数或所传送数据组的末地址；指明 所选设备的设备码及完成某种操作的命令码。这类指令的位数一般较长，如IBM370机的通道 指令为64位。 通道指令又称为通道控制字(ChannelControl Word, CCW)，它是通道用于执行I/0操作的 指令，可以由管理程序存放在主存的任何地方，由通道从主存中取出并执行。通道程序即由通道 指令组成，它完成某种外围设备与主存之间传送信息的操作。例如，将磁带记录区的部分内容送 到指定的主存缓冲区内。 通道指令是通道自身的指令，用来执行I/0操作，如读、写、磁带走带及磁盘找道等。而I/0 指令是CPU指令系统的一部分，是CPU用来控制输入输出操作的指令，由CPU译码后执行。在 具有通道结构的计算机中，I/0指令不实现I/0数据传送，主要完成启、停I/0设备，查询通道和 I/0设备的状态及控制通道所做的其他操作。具有通道指令的计算机，一旦CPU执行了启动 I/0设备的指令，就由通道来代替CPU对I/0设备的管理。 2. I/0硬件 输入输出系统的硬件组成是多种多样的，在带有接口的I/0系统中，一般包括接口模块及 I/0设备两大部分。图5.2中的接口电路实际上包含许多数据传送通路和有关数据，还包含控 制信号通路及其相应的逻辑电路（详见5.3节）。 图5.5是具有通道的I/0系统的示意图。 一个通道可以和一个以上的设备控制器相连，一个设备控制器又可以控制若干台同一类型 的设备。例如，IBM360系统的一个通道可以连接8个设备控制器，一个设备控制器又与8台设 备相连，因此，一个通道可以管理64台设备。如果一台计算机有6个通道，便可带动384台设 备。当然，实际上由千设备利用率和通道的频带影响，主机不可能带动这么多的设备。"}
{"doc_id": "co", "page": 165, "text": "第5章输入输出系统159  。主．主主i 图5.5具有通道的I/0系统 I/0设备与主机交换信息和CPU与主存交换信息相比，有许多不同点。例如，CPU如何对 I/0设备编址；如何寻找I/0设备号；信息传送是逐位串行还是多位并行；I/0设备与主机以什 么方式进行联络，使它们彼此都知道对方处于何种状态；I/0设备与主机是怎么连接的，等等。 这一系列问题统称为I/0设备与主机的联系方式。 1. I/0设备编址方式 通常将I/0设备码看作地址码，对I/0地址码的编址可采用两种方式：统一编址或不统一编 址。统一编址就是将I/0地址看作存储器地址的一部分。例如，在64K地址的存储空间中，划 出8K地址作为I/0设备的地址，凡是在这8K地址范围内的访问，就是对I/0设备的访问，所 用的指令与访存指令相似。不统一编址就是指I/0地址和存储器地址是分开的，所有对I/0设 备的访问必须有专用的I/0指令。显然统一编址占用了存储空间，减少了主存容量，但无须专用 的I/0指令。不统一编址由千不占用主存空间，故不影响主存容量，但需设I/0专用指令。因 此，设计机器时，需根据实际情况权衡考虑选取何种编址方式。 当设备通过接口与主机相连时，CPU可以通过接口地址来访问I/0设备。 2.设备寻址 由千每台设备都赋予一个设备号，因此，当要启动某一设备时，可由I/0指令的设备码字段"}
{"doc_id": "co", "page": 166, "text": "160 第2篇计算机系统的硬件结构 直接指出该设备的设备号。通过接口电路中的设备选择电路，便可选中要交换信息的设备。 3.传送方式 在同一瞬间，n位信息同时从CPU输出至I/0设备，或由I/0设备输入CPU，这种传送方式 称为并行传送。其特点是传送速度较快，但要求数据线多。例如，16位信息并行传送需要16根 数据线。 若在同一瞬间只传送一位信息，在不同时刻连续逐位传送一串信息，这种传送方式称为串行 传送。其特点是传送速度较慢，但只需一根数据线和一根地线。当I/0设备与主机距离很远时， 采用串行传送较为合理，例如远距离数据通信。 不同的传送方式需配置不同的接口电路，如并行传送接口、串行传送接口或串并联用的传送 接口等。用户可按需要选择合适的接口电路。 4.联络方式 不论是串行传送还是并行传送，I/0设备与主机之间必须互相了解彼此当时所处的状态，如 是否可以传送、传送是否已结束等。这就是I/0设备与主机之间的联络问题。按I/0设备工作 速度的不同，可分为三种联络方式。 (1)立即响应方式 对于一些工作速度十分缓慢的I/0设备，如指示灯的亮与灭、开关的通与断、AID转换器缓 变信号的输入等，当它们与CPU发生联系时，通常都已使其处于某种等待状态，因此，只要CPU 的I/0指令一到，它们便立即响应，故这种设备无须特殊联络信号，称为立即响应方式。 (2)异步工作采用应答信号联络 当I/0设备与主机工作速度不匹配时，通常采用异步工作方式。这种方式在交换信息前， I/0设备与CPU各自完成自身的任务，一旦出现联络 信号，彼此才准备交换信息。图5.6示意了并行传送 的异步联络方式。 如图5.6所示，当CPU将数据输出到I/0接口 后，接口立即向I/0设备发出一个“Ready\"（准备就 绪）信号，告诉I/0设备可以从接口内取数据。I/0图5.6异步并行“应答“联络方式 设备收到“Ready“信号后，通常便立即从接口中取出数据，接着便向接口回发一个“Strobe“信 号，并让接口转告CPU，接口中的数据已被取走，CPU还可继续向此接口送数据。同理，倘若 I/0设备需向CPU传送数据，则先由I/0设备向接口送数据，并向接口发“Strobe“信号，表明 数据已送出。接口接到联络信号后便通知CPU可以取数，一旦数据被取走，接口便向I/0设 备发“Ready“信号，通知I/0设备，数据已被取走，尚可继续送数据。这种一应一答的联络方 式称为异步联络。 图5.7示意了串行传送的异步联络方式。 I/0设备与CPU双方设定一组特殊标记，用”起始”和“终止”来建立联系。图中9.09ms的 低电平表示“起始”，又用2x9.09ms的高电平表示“终止”。"}
{"doc_id": "co", "page": 167, "text": "第5章输入输出系统161  2X9.09 ms  图5.7异步串行联络方式 (3)同步工作采用同步时标联络 同步工作要求I/0设备与CPU的工作速度完全同步。例如，在数据采集过程中，若外部数 据以2400 bps的速率传送至接口，则CPU也必须以1/2400 s的速率接收每一位数。这种联络 互相之间还得配有专用电路，用以产生同步时标来控制同步工作。 5. I/0设备与主机的连接方式 I/0设备与主机的连接方式通常有两种：辐射式和总线式。图 5.8和图5.2分别示意了这两种方式。 采用辐射式连接方式时，要求每台I/0设备都有一套控制线路 和一组信号线，因此所用的器件和连线较多，对I/0设备的增删都 比较困难。这种连接方式大多出现在计算机发展的初级阶段。 图5.2所示的是总线连接方式，通过一组总线（包括地址线、数 据线、控制线等），将所有的I/0设备与主机连接。这种连接方式是 现代大多数计算机系统所采用的方式。 图5.8I/0设备与主机的 辐射式连接示意图 I/0设备与主机交换信息时，共有5种控制方式：程序查询方式、程序中断方式、直接存储器 存取方式(DMA)、I/0通道方式、I/0处理机方式。本节主要介绍前3种方式，后两种方式在 5.1.1节已进行了一般介绍，更详尽的内容将由”计算机体系结构”课程讲述。 1.程序查询方式 程序查询方式是由CPU通过程序不断查询I/0设备是否己做好准备，从而控制I/0设备与 主机交换信息。采用这种方式实现主机和I/0设备交换信息，要求I/0接口内设置一个能反映 I/0设备是否准备就绪的状态标记，CPU通过对此标记的检测，可得知I/0设备的准备情况。图 5.9所示为CPU从某一I/0设备读数据块（例如从磁带上读一记录块）至主存的查询方式流程。 当现行程序需启动某I/0设备工作时，即将此程序流程插入运行的程序中。由图中可知，CPU 启动I/0设备后便开始对I/0设备的状态进行查询。若查得I/0设备未准备就绪，就继续查询； 若查得I/0设备准备就绪，就将数据从I/0接口送至CPU，再由CPU送至主存。这样一个字一 个字地传送，直至这个数据块的数据全部传送结束，CPU又重新回到原现行程序。"}
{"doc_id": "co", "page": 168, "text": "162 第2篇计算机系统的硬件结构 现行程序 CPU向J/0设备 发读指令CPU-1/0设备 1/0设备-►CPU 出错 Y I  从I/0接口中读 一个字到CPUI/0设备-CPU 从CPU向主存 写入一个字CPU-主存 N  图5.9 现行程序 程序查询方式流程 由这个查询过程可见，只要一启动I/0设备，CPU便不断查询I/0设备的准备情况，从而终 止了原程序的执行。CPU在反复查询过程中，犹如就地＂踏步”。另一方面，I/0设备准备就绪 后，CPU要一个字一个字地从I/0设备取出，经CPU送至 主存，此刻CPU也不能执行原程序，可见这种方式使CPU 和I/0设备处于串行工作状态，CPU的工作效率不高。 2.程序中断方式 倘若CPU在启动I/0设备后，不查询设备是否已准 备就绪，继续执行自身程序，只是当I/0设备准备就绪并 向CPU发出中断请求后才予以响应，这将大大提高CPU 的工作效率。图5.10示意了这种方式。 由图中可见，CPU启动I/0设备后仍继续执行原程 序，在第K条指令执行结束后，CPU响应了I/0设备的请 求，中断了现行程序，转至中断服务程序，待处理完后又返回到原程序断点处，继续从第K+l条 指令往下执行。由于这种方式使原程序中断了运行，故称为程序中断方式。 图5.11示意了采用程序中断方式从I/0设备读数据块到主存的程序流程。 K  K+l  中断服务程序 图5.10程序中断方式示意图"}
{"doc_id": "co", "page": 169, "text": "第5章输入输出系统 CPU向I/0设备I­ 发读指令 -－--CPU-I/0设备 「I l I lCPU做其他事情l j I  L__________l  I  CPU读I/0卜中断请求1  设备的状态－－ii6顽荔二五泊 出错 VO设备-CPU CPU-主存 图5.11程序中断方式流程 163  由图中可见，CPU向I/0设备发读指令后，仍在处理其他事情（如继续在算题），当I/0设备 向CPU发出请求后，CPU才从I/0接口读一个字经CPU送至主存（这是通过执行中断服务程序 完成的）。如果I/0设备的一批数据（一个数据块的全部数据）尚未传送结束时，CPU再次启动 I/0设备，命令I/0设备再做准备，一旦又接收到I/0设备中断请求时，CPU重复上述中断服务 过程，这样周而复始，直至一批数据传送完毕。 显然，程序中断方式在I/0设备进行准备时，CPU不必时刻查询I/0设备的准备情况，不出 现＂踏步“现象，即CPU执行程序与I/0设备做准备是同时进行的，这种方式和CPU与I/0设备 是串行工作的程序查询方式相比，CPU的资源得到了充分的利用。图5.12(a)、（b)分别示意了 这两种方式CPU的工作效率。 当然，采用程序中断方式，CPU和I/0接口不仅在硬件方面需增加相应的电路，而且在软件 方面还必须编制中断服务程序，这方面内容将在5.3和5.5节中详细讲述。"}
{"doc_id": "co", "page": 170, "text": "164  3. DMA方式 CPU  I/0设备 第2篇计算机系统的硬件结构 CPU执行 现行程序 启动1/0设备 CPU执行 CPU查询等待并传送1/0设备数据I现行程序 I/0设备准备及传送 (a)程序查询方式 CPU执行现行程序 CPU  指令执行周期结束 矗I/0设备l中断请求 I/0设备J/0设备准备 CPU处理中断服务程序， 实现I/0设备与主机之间的传送 (b)程序中断方式 CPU执行现行程序CPU执行现行程序 CPU  l  启动VO设 VO设备 存取周期结束 DMA请求 1/0设备准备]T~—-1/0设备准备 实现1/0设备与主存之间的传送 (c) DMA方式 图5.12三种方式的CPU工作效率比较 虽然程序中断方式消除了程序查询方式的＂踏步“现象，提高了CPU资源的利用率，但是 CPU在响应中断请求后，必须停止现行程序而转入中断服务程序，并且为了完成I/0设备与主 存交换信息，还不得不占用CPU内部的一些寄存器，这同样是对CPU资源的消耗。如果I/0设 备能直接与主存交换信息而不占用CPU，那么，CPU的资源利用率显然又可进一步提高，这就出 现了直接存储器存取(DMA)的方式。 在DMA方式中，主存与I/0设备之间有一条数据通路，主存与I/0设备交换信息时，无须 调用中断服务程序。若出现DMA和CPU同时访问主存，CPU总是将总线占有权让给DMA, 通常把DMA的这种占有称为窃取或挪用。窃取的时间一般为一个存取周期，故又把DMA占 用的存取周期窃取周期或挪用周期。而且，在DMA窃取存取周期时，CPU尚能继续做内部操 作（如乘法运算）。可见，与程序查询和程序中断方式相比，DMA方式进一步提高了CPU的资"}
{"doc_id": "co", "page": 171, "text": "第5章输入输出系统165  源利用率。 图5.12(C)示意了DMA方式的CPU效率。当然，采用DMA方式时，也需要增加必要的 DMA接口电路。有关DMA方式的详细内容将在5.6节讲述。 5.2 I/0设备 概述 中央处理器和主存构成了主机，除主机外的大部分硬件设备都可称为1/0设备或外部设备， 或外围设备，简称外设。计算机系统没有输入输出设备，就如计算机系统没有软件一样，是毫无 意义的。 随着计算机技术的发展，1/0设备在计算机系统中的地位越来越重要，其成本在整个系统 中所占的比重也越来越大。早期的计算机系统主机结构简单、速度慢、应用范围窄，配置的 1/0设备种类有限，数量不多，1/0设备价格仅占整个系统价格的几个百分点。现代的计算机 系统1/0设备向多样化、智能化方向发展，品种繁多，性能良好，其价格往往已占到系统总价 的80％左右。 1/0设备的组成通常可用图5.13点画线框内的结构来描述。 图5.13中的设备控制器用来控制1/0设备的 具体动作，不同的1/0设备完成的控制功能也不同。 机、电、磁、光部件与具体的1/0设备有关，即1/0设 备的具体结构大致与机、电、磁、光的工作原理有关。 本节主要介绍有关设备控制器的内容，要求读者能 ·—·—·—·—·—. 7  :  '. 1/V以亩I  L.—·—·—·—·—·-」 理解I/0设备的工作原理。现代的I/0设备一般还图5.13I/0设备的结构框图 通过接口与主机联系，至千接口的详细内容将在5.3 节中讲述。 I/0设备大致可分为三类。 (1)人机交互设备 它是实现操作者与计算机之间互相交流信息的设备，能将人体五官可识别的信息转换成机 器可识别的信息，如键盘、鼠标、手写板、扫描仪、摄像机、语音识别器等。反之，另一类是将计算 机的处理结果信息转换为人们可识别的信息，如打印机、显示器、绘图仪、语音合成器等。 (2)计算机信息的存储设备 系统软件和各种计算机的有用信息，其信息量极大，需存储保留起来。存储设备多数可作为 计算机系统的辅助存储器，如磁盘、光盘、磁带等。"}
{"doc_id": "co", "page": 172, "text": "166 第2篇计算机系统的硬件结构 (3)机－机通信设备 它是用来实现一台计算机与其他计算机或与其他系统之间完成通信任务的设备。例如，两 台计算机之间可利用电话线进行通信，它们可以通过调制解调器(Modem)完成。用计算机实现 实时工业控制，可通过DIA、AID转换设备来完成。计算机与计算机及其他系统还可通过各种 设备实现远距离的信息交换。 表5.1列出了现代常用的I/0设备的名称及用途。 表5.1常用的1/0设备 输入设备 输入输出设备 键盘 图形输入设备（鼠标、图形板、跟踪球、操纵杆、光笔） 图像输入设备（摄像机、扫描仪、传真机） 条形码阅读器 光学字符识别 语音和文字输入设备 输出设备显示器（字符、汉字、图形、图像） 打印设备（点阵式打印机、激光打印机、喷墨打印机） 绘图仪（平板式、滚筒式） 音箱 终端设备（键盘＋显示器） 汉字处理设备 AID、DIA转换设备 多媒体设备 脱机输入输出设备（软磁盘数据站） 本节主要介绍人机交互设备，可分为输入设备和输出设备两种，并且有的设备既具有输入功 能，又具有输出功能。关于存储设备已在第4章介绍过，有关机－机通信设备将在“计算机网络” 课程中讲述。 输入设 输入设备完成输入程序、数据和操作命令等功能。当实现人工输入时，往往与显示器联用， 以便检查和修正输入时的错误。也可以利用软盘、磁带等脱机录入的介质进行输入。目前已可 以实现语音直接输入。 1.键盘 键盘是应用最普遍的输入设备。可以通过键盘上的各个键，按某种规范向主机输入各种信"}
{"doc_id": "co", "page": 173, "text": "第5章输入输出系统167  息，如汉字、外文、数字等。 键盘由一组排列成阵列形式的按键开关组成，如图5.14所示。键盘上的按键分字符键和控 制功能键两类。字符键包括字母、数字和一些特殊符号键；控制功能键是产生控制字符的键（由 软件系统定义功能），还有控制光标移动的光标控制键以及用于插入或消除字符的编辑键等。 功能键编辑键状态灯 仁l口口口ID口口 口口口口口口口口口口口口口 亡］口口口口口口口口口口口口□1000口口口 二口口口口口工工工二口口口D 口口口口口口口口亡二］＿厂L一口口口 口口 字母、数字、特殊符号键 图5.14计算机键盘示意图 键盘输入信息分为以下3个步骤。 CD按下一个键。 ＠查出按下的是哪个键。 光标控制键 ＠将此键翻译成ASCII码（参见附录5A)，由计算机接收。 数字小键盘 按键是由人工操作的，确认按下的是哪一个键可用硬件或软件的方法来实现。 采用硬件确认哪个键被按下的方法称为编码键盘法，它由硬件电路形成对应被按键的唯一 编码信息。为了便千理解，下面以8x8键盘为例，说明硬件编码键盘法是如何通过对键盘扫描 来识别按键所对应的ASCII码的，其原理如图5.15所示。 图5.15中的6位计数器经两个八选一的译码器对键盘扫描。若键未按下，则扫描将随着计 数器的循环计数而反复进行。一旦扫描发现某键被按下，则键盘通过一个单稳电路产生一个脉 冲信号。该信号一方面使计数器停止计数，用以终止扫描，此刻计数器的值便与所按键的位置相 对应，该值可作为只读存储器(ROM)的输入地址，而该地址中的内容即为所按键的ASCII码。 可见只读存储器存储的内容便是对应各个键的ASCII码。另一方面，此脉冲经中断请求触发器 向CPU发中断请求，CPU响应请求后便转入中断服务程序，在中断服务程序的执行过程中，CPU 通过执行读入指令，将计数器所对应的ROM地址中的内容，即所按键对应的ASCII码送入CPU 中。CPU的读入指令既可作为读出ROM内容的片选信号，而且经一段延迟后，又可用来清除中 断请求触发器，并重新启动6位计数器开始新的扫描。 采用软件判断键是否按下的方法称为非编码键盘法，这种方法利用简单的硬件和一套专用"}
{"doc_id": "co", "page": 174, "text": "168 第2篇计算机系统的硬件结构 8X8键盘 图5.15带只读存储器的编码键盘原理图 键盘编码程序来判断按键的位置，然后由CPU将位置码经查表程序转换成相应的编码信息。这 种方法结构简单，但速度比较慢。 在按键时往往会出现键的机械抖动，容易造成误动。为了防止形成误判，在键盘控制电路中 专门设有硬件消抖电路，或采取软件技术，以便有效地消除因键的抖动而出现的错误。 此外，为了提高传输的可靠性，可采用奇偶校验码（见附录5C)来验证信息的准确性。 随着大规模集成电路技术的发展，厂商已提供了许多种可编程键盘接口芯片，如Intel8279  就是可编程键盘／显示接口芯片，用户可以随意选择。近年来又出现了智能键盘，如IBMPC的 键盘内装有Intel8048单片机，用它可完成键盘扫描、键盘监测、消除重键、自动重发、扫描码的缓 冲以及与主机之间的通信等任务。 2.鼠标 鼠标(Mouse)是一种手持式的定位设备，由千它拖着一根长线与接口相连，外形有点像老 鼠，故取名为鼠标。常用的鼠标有两种：一种是机械式的，它的底座装有一个金属球，球在光 滑表面上摩擦使球转动，球与4个方向的电位器接触，可测得上下左右4个方向的相对位移 量，通过显示器便可确定欲寻求的方位。另一种是光电式鼠标，它需要与一块画满小方格的 长方形金属板配合使用。安装在鼠标底部的光电转换器可以确定坐标点的位置，同样由显示 器显示器所寻找的方位。光电式鼠标比机械式鼠标可靠性高，但需要增加一块金属板。机械 式鼠标可以直接在光滑的桌面上摩擦，但往往因桌面上的灰尘随金属球滚动带入鼠标内，致 使金属球转动不灵。"}
{"doc_id": "co", "page": 175, "text": "第5章输入输出系统169  3.触摸屏 触摸屏是一种对物体的接触或靠近能产生反应的定位设备。按原理的不同，触摸屏大致可 分为5类：电阻式、电容式、表面超声波式、扫描红外线式和压感式。 电阻式触摸屏由显示屏上加一个两层高透明度的、并涂有导 电物质的薄膜组成。在两层薄膜之间由绝缘支点隔开，其间隙为 0.000 1英寸，如图5.16所示。 当用户触摸塑料薄膜片时，涂有金属导电物质的第一层塑料 片与挨着玻璃罩上的第二层塑料片（也涂有金属导电物质）接触， 这样根据其接触电阻的大小求得触摸点所在的x和y坐标位置。 电容式触摸屏是在显示屏幕上加一个内部涂有金属层的玻 璃罩。当用户触摸此罩表面时，与电场建立了电容耦合，在触摸 点产生小电流到屏幕4个角，然后根据4个电流大小计算出触摸图5.16电阻式触摸屏原理 点的位置。 表面超声波式触摸屏是由一个透明的玻璃罩组成的。在罩的x和y轴方向都有一个发射和 接收压电转换器和一组反射器条，触摸屏还有一个控制器发送5MHz的触发信号给发射、接收 转换器，让它转换成表面超声波，此超声波在屏幕表面传播。当用手指触摸屏幕时，在触摸位置 上的超声波被吸收，使接收信号发生变化，经控制分析和数字转换为x和y的坐标值。 可见，任何一种触摸屏都是通过某种物理现象来测得人手触及屏幕上各点的位置，从而通过 CPU对此做出响应，由显示屏再现所需的位置。由于物理原理不同，体现出各类触摸屏的不同 特点及其适用的场合。例如，电阻式能防尘、防潮，并可戴手套触摸，适用千饭店、医院等。电容 式触摸屏亮度高，清晰度好，也能防尘、防潮，但不可戴手套触摸，并且易受温度、湿度变化的影 响，因此，它适合于游戏机及供公共信息查询系统使用。表面超声波式触摸屏透明、坚固、稳定， 不受温度、湿度变化的影响，是一种抗恶劣环境的设备。 4.其他输入设备 在此主要介绍图形、图像的输入设备，有关语音和文字的输入设备不做介绍。 (1)光笔 光笔(LightPen)的外形与钢笔相似，头部装有一个透镜系统，能把进入的光会聚成一个光 点。光笔的后端用导线连到计算机输入电路上。光笔头部附有开关，当按下开关时，进行光检 测，光笔便可拾取显示屏上的绝对坐标。光笔与屏幕的光标配合，可使光标跟踪光笔移动，在屏 幕上画出图形或修改图形，类似人们用钢笔画图的过程。 (2)画笔与图形板 产厂了 ，口rlfl,t[ ：,＠ ti 点 勹勹』 画笔(Stylus)同样为笔状，但必须配合图形板(Tablet)使用。当画笔接触到图形板上的某一 位置时，画笔在图形板上的位置坐标就会自动传送到计算机中，随着画笔在板上的移动可以画出 图形。图形板和画笔构成二维坐标的输入设备，主要用于输入工程图等。将图纸贴在图形板上， 画笔沿着图纸上的图形移动，即可输入工程图。"}
{"doc_id": "co", "page": 176, "text": "170 第2篇计算机系统的硬件结构 图形板是一种二维的AID变换器，又称为数字化板。坐标的测量方法有电阻式、电容式、电 磁感应式和超声波式几种。 画笔与光笔都是输入绝对坐标，而鼠标只能输入相对坐标。 (3)图像输入设备 最直接的图像输入设备是摄像机(Camera)，它能摄取任何地点、任何环境下的自然景物和 各类物体，经数字量化后变成数字图像存入磁带或磁盘。 如果图像巳记录在某种介质上，则可用读出装置来读出图像。例如，记录在录像带上的图像 可用录放机读出，再将视频信号经图像板量化输入计算机中。记录在数字磁带上的遥感图像可 直接从磁带输入计算机中。如果把纸上的图像输入计算机内，则可用摄像机直接摄入，或用装有 CCD（电荷耦合器件）的图文扫描仪(Scanner)或图文传真机送入计算机。还有一种专用的光机 扫描鼓，也可把纸上的图像直接转换成数字图像存入计算机。 输出设备 1.显示设备 (1)概述 以可见光的形式传递和处理信息的设备称为显示设备。它是应用最广的人机通信设备。显 示设备种类繁多，按显示器件划分，有阴极射线管(CathodeRay Tube, CRT)显示器、液晶显示器 (Liquid Crystal Display, LCD)、等离子显示器(PD)等；按显示内容分有字符显示器、图形显示器 和图像显示器；按显示器功能分有普通显示器和显示终端（终端是由显示器和键盘组成的一套 独立完整的输入输出设备，它可以通过标准接口连接到远程主机，其结构比显示器复杂得多）两 类。在CRT显示器中，按扫描方式不同，可分为光栅扫描和随机扫描两种；按分辨率不同，又可 分为高分辨率和低分辨率的显示器。 CRT是目前应用最广泛的显示器件，既可作为字符显示器，又可作为图像、图形显示器。 CRT是一个洞斗形的电真空器件，由电子枪、荧光屏及偏转装置组成，如图5.17所示。 昌笫岱譬 栅、^  极熘; 巨 ) I I I I  灯丝I) 1111  ;  I I I I  区 ,''.  子枪电极阴第一第三 极阳极阳 图5.17CRT结构示意图"}
{"doc_id": "co", "page": 177, "text": "第5章输入输出系统171  电子枪包括灯丝、阴极、控制（栅）极、第一阳极（加速阳极）、第二阳极（聚焦极）和第三阳 极。当灯丝加热后，阴极受热而发射电子，电子的发射量和发射速度受控制极控制。电子经加 速、聚焦而形成电子束，在第三阳极形成的均匀空间电位作用下，使电子束高速射到荧光屏上，荧 光屏上的荧光粉受电子束的轰击产生亮点，其亮度取决于电子束的轰击速度、电子束电流强度和 荧光粉的发光效率。电子束在偏转系统控制下，可在荧光屏的不同位置产生光点，由这些光点可 以组成各种所需的字符、图形和图像。 彩色CRT的原理与单色CRT的原理是相似的，只是对彩色CRT而言，通常用3个电子枪发 射的电子束，经定色机构，分别触发红、绿、蓝三种颜色的荧光粉发光，按三基色迭加原理形成彩 色图像。 CRT荧光屏尺寸大小是按屏幕对角线长度表示，普通字符显示器的CRT有12英寸和14英 寸两种，图形、图像显示器的CRT有15英寸、17英寸和19英寸，目前还出现了21英寸大屏 幕CRT。 分辨率和灰度等级是CRT的两个重要技术指标。分辨率是指显示屏面能表示的像素点数， 分辨率越高，图像越清晰。灰度等级是指显示像素点相对亮暗的级差，在彩色显示器中它还表现 为色彩的差别。 CRT荧光屏发光是由电子束轰击荧光粉产生的，其发光亮度一般只能维持几十毫秒。为了 使人眼能看到稳定的图像，电子束必须在图像变化前不断地进行整个屏幕的重复扫描，这个过程 称为刷新。每秒刷新的次数称为刷新频率，一般刷新频率大千30次／秒时，人眼就不会感到闪 烁。在显示设备中，通常都采用电视标准，每秒刷新50帧(Frame)图像。 为了不断地刷新，必须把瞬时图像保存在存储器中，这种存储器称为刷新存储器，又称帧存 储器或视频存储器(VRAM)。刷新存储器的容量由图像分辨率和灰度等级决定。分辨率越高， 灰度等级越多，需要的刷新存储器容量就越大。例如，分辨率为512x512像素，灰度等级为256 的图像，其刷新存储器的容量需达512x512x8h，即为256KB。此外，刷新存储器的存取周期必 须与刷新频率相匹配。 计算机的显示器大多采用光栅扫描方式。所谓光栅扫描，是指电子束在荧光屏上按某种轨 迹运动，光栅扫描是从上至下顺序扫描，可分为逐行扫描和隔行扫描两种。一般CRT都采用与 电视相同的隔行扫描，即把一帧图像分为奇数场（由1、3、5等奇数行组成）和偶数场（由0、2、4、6 等偶数行组成），一帧图像需扫描625行，则奇数场和偶数场各扫描312.5行。扫描顺序是先扫 描偶数场，再扫描奇数场，交替进行，每秒显示50场。 (2)字符显示器 字符显示器是计算机系统中最基本的输出设备，它通常由CRT控制器和显示器(CRT)组 成，图5.18示意了它的原理框图。 l)显示存储器（刷新存储器）VRAM 显示存储器存放欲显示字符的ASCII码，其容量与显示屏能显示的字符个数有关。如显示 屏上能显示80列x25行＝2000个字符，则显示存储器的容量应为2oooxs（字符编码7位，闪烁"}
{"doc_id": "co", "page": 178, "text": "172 第2篇计算机系统的硬件结构 主机 图5.18字符显示器原理框图 1位），每个字符所在存储单元的地址与字符在荧光屏上的位置一一对应，即显示存储器单元的 地址顺序与屏面上每行从左到右，按行从上到下的显示器位置对应。 2)字符发生器 由千荧光屏上的字符由光点组成，而显示存储器中存放的是ASCII码，因此，必须有一个 部件能将每个ASCII码转变为一组5x7或7x9的光点矩阵信息。具有这种变换功能的部件 称为字符发生器，它实质是一个ROM。图5.19是一个对应7X9光点矩阵的字符发生器原理 框图。 ASCII码 L 列地址译码 行地址译码 行地址选择采自 CRT 控制器) 并－串变换移位寄存器 123456789  图5.19对应7X9光点矩阵的字符发生器原理图 图中ROM,的个数与显示器所能显示的字符种类有关，例如，能显示97个字符，则i=1 ~97。 每个ROM,共有9个单元（对应9行），每个单元中存放7位光点代码。如“C”的9个单元中，所 存储的9组光点代码分别为0111110、1000001、1000000、1000000、1000000、1000000、1000000、 1000001、0111110（设“1”对应亮点，“0”对应暗点）。字符发生器工作时，由显示存储器输出的 ASCII码作为ROM的高位地址（列地址），而ROM的低位地址（行地址）来自CRT控制器的光栅 地址计数器。ROM的输出并行加载到移位寄存器中，然后在点阵时钟控制下，移位输出形成视"}
{"doc_id": "co", "page": 179, "text": "第5章输入输出系统173  频信号，作为CRT的亮度控制信号。显示器在水平同步、垂直同步（来自CRT控制器）和视频信 号（来自字符发生器）的共同作用下，连续不断地进行屏幕刷新，就能显示稳定而不消失的字符 图像。 3) CRT控制器 CRT控制器通常都做成专用芯片，它可接收来自CPU的数据和控制信号，并给出访问显 示存储器的地址和访问字符发生器的光栅地址，还能给出CRT所需的水平同步和垂直同步信 号等。该芯片的定时控制电路要对显示每个字符的点（光点）数、每排（字符行）字(7x9点 阵）数、每排行（光栅行）数和每场排数计数。因此，芯片中需配置点计数器、字计数器（水平 地址计数器）、行计数器（光栅地址计数器）和排计数器（垂直地址计数器），这些计数器用来 控制显示器的逐点、逐行、逐排、逐屏的刷新显示，还可以控制对显示存储器的访问和屏幕间 扫描的同步。 点计数器记录每个字的横向光点，因每个字符占7个光点，字符间留一个光点作间隙，共占 8个光点，故点计数器为模8计数器，计满8个点向字计数器进位。字计数器用来记录屏幕上每 排的字数，若每排能显示80个字，考虑到屏幕两边失真较大，各空出5个字符位置，再加上光栅 回扫消隐时间（此段时间屏幕不显示）的需要，占20个显示字符的时间，总共80+10+20 = 110，则 字计数器计满110就归零，并向行计数器进位。行计数器用来记录每个字(7x9点阵）的9行光 栅地址，外加每排字的3行间隔，总共9+ 3 = 12，即行计数器计满12归零，并向排计数器进位。 排计数器用来记录每屏字符的排数，若能显示25排，再考虑到屏幕上下失真空一排，则共26排， 即排计数器计满26归零，表示一场扫描结束。 字计数器反映了光栅扫描的水平方向，排计数器反映了光栅扫描的垂直方向，将这两个方向 的同步信号输至CRT的x和y偏转线圈，便可达到按指定位置进行显示的要求。 值得注意的是，CRT的扫描方式不是一个字符一个字符地扫描，而是每次对一排字符中所 有字符的同一行进行扫描，并显示亮点。例如，某排字符为WELCOME，其显示次序是：先从显示 存储器中读出“W”字符，送至字符发生器，并从字符发生器中扫描选出“W”字符的第一行光点 代码，于是屏幕上显示出“W”字符第一行的7个光点代码；再从显示存储器中读出“E”字符并送 字符发生器，又选出“E”字符的第一行7个光点代码...…直到最后一个字符“E\"的第一行7个光 点代码显示完毕。接着进行每个字符点阵的第二行7个光点代码的扫描...…直到该排每个字符 的第9行光点代码扫描完毕，则屏幕上完整地显示出WELCOME字符。 (3)图形显示器 图形显示器是用点、线（直线和曲线）、面（平面和曲面）组合成平面或立体图形的显示设备， 并可作平移、比例变化、旋转、坐标变换、投影变换（把三维图形变为二维图形）、透视变换（由一 个三维空间向另一个三维空间变换）、透视投影（把透视变换和投影变换结合在一起）、轴侧投影 （三面图）、单点透视、两点或三点透视以及隐线处理（观察物体时把看不见的部分去掉）等操作。 主要用于计算机辅助设计(CAD)和计算机辅助制造(CAM)，如汽车、飞机、舰船、土建以及大规 模集成电路板等的设计制造。"}
{"doc_id": "co", "page": 180, "text": "174 第2篇计算机系统的硬件结构 图形显示器经常配有键盘、光笔、鼠标及绘图仪等。 利用CRT显示器产生图形有两种方法：一种是随机扫描法，另一种是光栅扫描法。 随机扫描法在随机扫描时，电子束产生图形的过程和人用笔在纸上画图的过程相似，任何图 形的线条都被认为是由许多微小的首尾相接的线段来逼近的，这些微小的线段称为矢量，故这种 方法又称为矢量法。与此法相对应的显示器称为随机扫描图形显示器，其缺点是在显示复杂图 形时，会出现闪烁现象。 与光栅扫描法对应的显示器称为光栅扫描图形显示器。其特点是把对应于屏幕上的每个像 素信息都存储在刷新存储器中。光栅扫描时，读出这些像素来调制CRT的灰度，以便控制屏幕 上像素的亮度。同样也需不断地对屏幕进行刷新，使图形稳定显示。图5.20示意了光栅扫描图 形显示器的硬件结构框图。 图5.20光栅扫描图形显示器的硬件结构框图 图5.20中的程序段缓存用来存储计算机送来的显示文件和图形操作命令，如图形的局部放 大、平移、旋转、比例变换以及图形的检索等。这些操作直接由显示处理器完成。刷新存储器存 放一帧图形的形状信息，它与屏幕上的像素一一对应。例如，屏幕的分辨率为1024x 1 024像 素，且像素的灰度为256级，则刷新存储器就需要有1024x 1 024个单元，每个单元的字长为8 位。可见刷新存储器的容量与分辨率、灰度都有关。 图5.20中的DDA(Digital Difference Analyses)是数字差分分析器，它能将显示文件变换成图 形形状，是一种完成数据插补的部件，能够根据显示文件给出的曲线类型和坐标值，生成直线、 圆、抛物线甚至更复杂的曲线。插补后的数据存入刷新存储器用于显示。此外，对于数字化的图 像数据也可直接输入刷新存储器，不经DDA等图形控制部分便可用来显示图像。 光栅扫描显示器的通用性强，灰度层次多，色调丰富，显示复杂图形时无闪烁，所形成的图形 可以有消除隐藏面、阴影效应和涂色等功能。 (4)图像显示器 图形显示器所显示的图形是由计算机用一定的算法形成的点、线、面、阴影等，来自主观世 界，故又称为主观图像或计算机图像。 图像显示器所显示的图像（如遥感图像、医学图像、自然景物、新闻照片等）通常来自客观世 界，故又称为客观图像。图像显示器是把由计算机处理后的图像（称为数字图像）以点阵的形式 显示出来。通常采用光栅扫描方式，其分辨率为256x256像素或512x512像素，也可与图形显"}
{"doc_id": "co", "page": 181, "text": "第5章输入输出系统175  示器兼容，其分辨率可达1024x 1 024像素，灰度等级可达64至256级。 图像显示器除了能存储从计算机输入的图像并在显示屏幕上显示外，还具有灰度变换、窗口 技术、真彩色和伪彩色显示等图像增强技术功能。 ·灰度变换：可使原始图像的对比度增强或改变。 0窗口技术：在图像存储器中，每个像素有2048级灰度值，而人的肉眼只能分辨到40级。 如果从2048级中开一个小窗口，并把这窗口范围内的灰度级取出，使之变换为64级显示灰度， 就可以使原来被掩盖的灰度细节充分显示出来。 0真彩色和伪彩色：真彩色是指真实图像色彩显示，采用色还原技术，如彩色电视；伪彩色 处理是一种图像增强技术。通常肉眼能分辨黑白色只有几十级灰度，但却能分辨出上千种色彩。 利用伪彩色技术可以人为地对黑白图像进行染色，例如，把水的灰度染成蓝色，把植物的灰度染 成绿色，把土地的灰度染成黄色等。 此外，图像显示器还具有几何处理功能，如图像放大（按2、4、8倍放大）、图像分割或重叠、 图像滚动等。 图5.21示意了一种简单的图像显示器原理框图。 图5.21简单的图像显示器原理框图 简单的图像显示器只显示由计算机送来的数字图像，图像处理操作在主机中完成，显示器不 做任何处理。其中I/0接口、刷新存储器、AID、DIA转换等组成单独的一部分，称为视频数字化 仪(VideoDigitizer)或图像输入控制板（简称图像板），其功能是实现连续的视频信号与离散的数 字量之间的转换。视频数字化仪接收摄像机的视频输入信号，经AID变换为数字量存入刷新存 储器用于显示，并可传送到主机进行图像处理操作。操作后的结果送回刷新存储器，又经DIA 变为视频信号输出，由监视器(Monitor)显示输出。监视器只包括扫描、视频放大等有关的显示 电路和显像管。也可接至电视机的视频输入端，用电视机代替监视器。一般通用计算机配置一 块图像板和监视器便能组成一个图像处理系统。 (5) IBM PC系列微型计算机的显示标准 IBM PC系列微型计算机配套的显示系统有两大类。一类是基本显示系统，用千字符／图形 显示；另一类是专用显示系统，用于高分辨率图形或图像显示。这里仅介绍几种显示标准。 1) MDA (Monochrome Display Adapter)标准 MDA是单色字符显示标准，采用9X14点阵的字符窗口，满屏显示80列、25行字符，对应分 辨率为720x350像素。MDA不能兼容图形显示。"}
{"doc_id": "co", "page": 182, "text": "176 第2篇计算机系统的硬件结构 2) CGA (Color Graphics Adapter)标准 CGA是彩色图形／字符显示标准，可兼容字符和图形两种显示方式。在字符方式下，字符窗 口为8x8点阵，故字符质量不如MDA，但字符的背景可以选择颜色。在图形方式下，可以显示 640X200两种颜色或320x200四种颜色的图形。 3) EGA (Enhanced Graphics Adapter)析示准 EGA标准集中了MDA和CGA两个显示标准的优点，并有所增强。其字符窗口为8xl4点 阵，字符显示质量优于CGA而接近MDA。图形方式下分辨率为640x350像素，有16种颜色，彩 色图形的质量优于CGA，且兼容原CGA和MDA的各种显示方式。 4) VGA (Video Graphics Array)标准 VGA标准在字符方式下，字符窗口为9x16点阵，在图形方式下分辨率为640X48Q像素、16 种颜色，或320x200像素、256种颜色，还有720X400像素的文本模式。 近年来显示标准有了很大发展，改进型的VGA，如SVGA(Super VGA)标准，分辨率为800x 600像素、16种颜色（每像素4位）。XGA(Extended Graphics Array)支持1024X768像素的分辨 率、256种颜色（每像素8位），或者640x480像素的分辨率（每像素16位，或称高色）。XGA-2 进一步支持1024X768像素的分辨率（高色，更高视频）和1360x 1 024像素的分辨率（每像素4 位，16种颜色可选）。SXGA(Super XGA)分辨率达1280Xl 024像素，每个像素用32位表示（本 色）。UXGA(UltraXGA)分辨率已达1600xl 200像素，每个像素32位表示（本色）。 最近笔记本计算机开始流行显示纵横比为16:9的XGA格式，又称为WXGA(Wide XGA)标 准，其分辨率为1280x720像素。而WUXGA(Wide Ultra XGA)标准是一种分辨率为1920x  1 200像素、纵横比为16:10的UXGA格式，这种纵横比在高档15英寸和17英寸笔记本计算机 上越来越流行。 2.打印设备 打印设备可将计算机运行结果输出到纸介质上，并能长期保存，是一种硬拷贝设备。相比之 下，显示器在屏幕上的信息是无法长期保存的，故它不属于硬拷贝设备。 (1)打印设备的分类 打印设备的种类有很多种划分方法。 按印字原理划分，有击打式和非击打式两大类。击打式打印机是利用机械动作使印字机构 与色带和纸相撞击而打印字符，其特点是设备成本低、印字质量较好，但噪声大、速度慢。击打式 打印机又分为活字打印机和点阵针式打印机两种。活字打印机是将字符刻在印字机构的表面 上，印字机构的形状有圆柱形、球形、菊花瓣形、鼓轮形、链形等，现在用得越来越少。点阵打印机 的字符是点阵结构，它利用钢针撞击的原理印字，目前仍用得较普遍。非击打式打印机采用电、 磁、光、喷墨等物理和化学方法来印刷字符，如激光打印机、静电打印机、喷墨打印机等，它们速度 快，噪声低，印字质量比击打式的好，但价格比较贵，有的设备需用专用纸张进行打印。 按工作方式分，有串行打印机和行式打印机两种。前者是逐字打印，后者是逐行打印，故行 式打印机比串行打印机速度快。"}
{"doc_id": "co", "page": 183, "text": "第5章输入输出系统177  此外，按打印纸的宽度还可分宽行打印机和窄行打印机，还有能输出图的图形／图像打印机， 具有色彩效果好的彩色打印机等。 (2)点阵针式打印机 点阵针式打印机结构简单、体积小、重量轻、价格低、字符种类不受限制、较易实现汉字打印， 还可打印图形和图像，是目前应用最广泛的一种打印设备。一般在微型、小型计算机中都配有这 类打印机。 点阵针式打印机的印字原理是由打印针（钢针）印出nXm个点阵来组成字符或图形。点越多、 越密，字形质量越高。西文字符点阵通常采用5x7、7x7、7X9、9X9几种，汉字的点阵采用16x16、24x 24、32x32和48x48多种。图5.22是7X9点阵字符的打印格式和打印头的示意图。 打印头中的钢针数与打印机型号有关，有7针、9针，也有双列14(2X7)针或双列24(2x12) 针。打印头固定在托架上，托架可横向移动。图5.22中为7根钢针，对应垂直方向的7点，由千 受机械安装的限制，这7点之间有一定的间隙。水平方向各点的距离取决千打印头移动的位置， 故可密集些，这对形成斜形或弧形笔画非常有利。字符的形成是按字符中各列所包含的点逐列 形成的。例如，对于字符E，先打印第2列的1~7个点，再打印第4、6、8列的第1、4、7三点，最后 打第10列的1、7两个点。可见每根针可以单独驱动。打印一个字符后，空出3列（第11、0、1 列）作为间隙。 衔铁霆二打印针色带打印纸 针管导板＼勹 筐oo ooo ooo  11 __  ooooooo  (a)打印头(b)点阵字符的打印格式 图5.22针式打印头和打印格式的示意图 针式打印机由打印头、横移机构、输纸机构、色带机构和相应的控制电路组成，如图5.23 所示。 打印机被CPU启动后，在接收代码时序器控制下，功能码判别电路开始接收从主机送来的 欲打印字符的字符代码(ASCII码）。首先判断该字符是打印字符码还是控制功能码（如回车、换 行、换页等），若是打印字符码，则送至缓冲存储器，直到把缓冲存储器装满为止；若是控制功能 码，则打印控制器停止接收代码并转入打印状态。打印时首先启动打印时序器，并在它控制下， 从缓冲存储器中逐个读出打印字符码，再以该字符码作为字符发生器ROM的地址码，从中选出"}
{"doc_id": "co", "page": 184, "text": "178 第2篇计算机系统的硬件结构 ·—.—.—·— 'l1  构构构一 头机机机－一印－图 框 一构 结 卢－一一机 一印 勹丿`门]打 式 _—·—·—·|」针 、丿 a (  打印头 (b)针式打印机控制电路框图 图5.23针式打印机的组成 对应的字符点阵信息（字符发生器可将ASCII码转换成打印字符的点阵信息）。然后在列同步 脉冲计数器控制下，将一列列读出的字符点阵信息送至打印驱动电路，驱动电磁铁带动相应的钢 针进行打印。每打印一列，固定钢针的托架就要横移一列距离，直到打印完最后一列，形成nXm 点阵字符。当一行字符打印结束或换行打印或缓存内容已全部打印完毕时，托架就返回到起始 ，并向主机报告，请求打印新的数据。 图5.23(a)中的输纸机构受步进电机驱动，每打印完一行字符，按给定要求走纸。色带的作 用是供给色源，如同复写纸的作用。如图5.22(a)所示，钢针撞击在色带上，就可将颜色印在纸 上，色带机构可使色带不断移动，以改变受击打的位置，避免色带的破损。 的点阵针式打印机内部配有一个独立的微处理器，用来产生各种控制信号，完成复杂的打 印任务。 上面介绍的针式打印机是串行点阵针式打印机，打印速度每秒100个字符左右，在微型计算 机系统广泛采用。在大型、中型通用计算机系统中，为提高打印速度，通常配备行式点阵打印机， 它是将多根打印针沿横向排成一行，安装在一块形似梳齿状的梳形板上，每根针各由一个电磁铁 驱动。打印时梳形板可向左右移动，每移动一次印出一行印点。当梳形板改变移动方向时，走纸 机构使纸移动一个印点间距，如此重复多次即可打印出一行字符。例如，44针行式打印，沿水平 方向均匀排列44根打印针，每根针负责打印3个字符，打印行宽为44x3= 132列字符。如果每 根针负责打印两个字符，则可采用66针结构。"}
{"doc_id": "co", "page": 185, "text": "第5章输入输出系统179  (3)激光打印机 激光打印机采用了激光技术和照相技术，由于它的印字质量好，在各种计算机系统中广泛采 用。激光打印机的工作原理如图5.24所示。 广..—·—·—' I  I  ［三I i激光扫描系统，I  l.—·  广·—·一·—·—·—·—·—·—.i  纸！ 1荨 口＾尸识1 I  荨］主纸二I | ＝＝纸I . 电子照相系统 I L.—·一一·—·—·—·—·—·—·—· 计算机 图5.24激光打印机原理框图 激光打印机由激光扫描系统、电子照相系统、字形发生器和接口控制器几部分组成。接口控 制器接收由计算机输出的二进制字符编码及其他控制信号；字形发生器可将二进制字符编码转 换成字符点阵脉冲信号；激光扫描系统的光源是激光器，该系统受字符点阵脉冲信号的控制，能 输出很细的激光束，该激光束对做圆周运动的感光鼓进行轴向（垂直于纸面）扫描。感光鼓是电 子照相系统的核心部件，鼓面上涂有一层具有光敏特性的感光材料，主要成分为硒，故感光鼓又 称为硒鼓。感光鼓在未被激光扫描之前，先在黑暗中充电，使鼓表面均匀地沉积一层电荷，扫描 时激光束对鼓表面有选择地曝光，被曝光的部分产生放电现象，未被曝光的部分仍保留充电时的 电荷，这就形成了＂潜像”。随着鼓的圆周运动，“潜像”部分通过装有碳粉盒的显像系统，使“潜 像”部分（实际上是具有字符信息的区域）吸附上碳粉，达到“显影”的目的。当鼓上的字符信息 区和打印纸接触时，由纸的背面施以反向的静电电荷，则鼓面上的碳粉就会被吸附到纸面上，这 就是“转印”或“转写“过程。最后经过定影系统就将碳粉永久性地粘在纸上。转印后的鼓面还 留有残余的碳粉，故先要除去鼓面上的电荷，经清扫系统将残余碳粉全部清除，然后重复上述充 电、曝光、显形、转印、定影等一系列过程。 激光打印机可以使用普通纸张打印，输出速度高，一般可达10000行／分（高速的可达 70 000行／分），印字质量好，普通激光打印机的印字分辨率可达300dpi（每英寸300个点）或 400 dpi。字体字形可任意选择，还可打印图形、图像、表格、各种字母、数字和汉字等字符。 激光打印机是非击打式硬拷贝输出设备，是逐页输出的，故又有＂页式输出设备”之称。普 通击打式打印机是逐字或逐行输出的。页式输出设备的速度以每分钟输出的页数(PagesPer  Minute,PPM)来描述。高速激光打印机的速度在100ppm以上，中速为30~60ppm，它们主要用 于大型计算机系统。低速激光打印机的速度为10~20ppm或10ppm以下，主要用千办公室自"}
{"doc_id": "co", "page": 186, "text": "180 第2篇计算机系统的硬件结构 动化系统和文字编辑系统。 (4)喷墨打印机 喷墨打印机是串行非击打式打印机，印字原理是将墨水喷射到普通打印纸上。若采用红、 绿、蓝三色喷墨头，便可实现彩色打印。随着喷墨打印技术的不断提高，其输出效果接近千激光 打印机，而价格又与点阵针式打印机相当，因此也得到广泛应用。 图5.25(a)是一种电荷控制式喷墨打印机的原理框图，主要由喷头、充电电极、墨水供应、过 滤回收系统及相应的控制电路组成。 偏转电极 压电陶瓷喷墨头充电电极二\\_勹:．．．|／纸 •• ••  ••••••••  7654321  墨滴偏转方向 I  叶。不带电墨滴 射入回收器中 (a)印刷原理 图5.25电荷控制式喷墨打印机原理框图 喷墨头移动方向 (b)字符形成过程 喷墨头后部的压电陶瓷受振荡脉冲激励，使喷墨头喷出具有一定速度的一串不连续、不带电 的墨水滴。墨水滴通过充电电极时被充上电荷，其电荷量的大小由字符发生器控制。字符发生 器可将字符编码转换成字符点阵信息。由千各点的位置不同，充电电极所加的电压也不同，电压 越高，充电电荷越多，墨滴经偏转电极后偏移的距离也越大，最后墨滴落在印字纸上。图中只有 一对垂直方向的偏转电极，因此墨滴只能在垂直方向偏移。若垂直线段上某处不需喷点（对应 字符在此处无点阵信息），则相应墨滴不充电，在偏转电场中不发生偏转，而射入回收器中。横 向没有偏转电极，靠喷头相对于记录纸作横向移动来完成横向偏转。图5.25(h)示意了H字符 由5x7点阵组成。墨滴的运动轨迹如图中所示的数字顺序，可见字符中的每个点都要一个个地 进行控制，故字符发生器的输出必须是一个点一个点的信息。这与点阵针式打印机的字符发生 器一次输出一列上的7个点信息，分5次打印一个字符是完全不同的（参见图5.22)。 喷墨打印机还有很多种，如电场控制型连续式喷墨打印机、随机式喷墨打印机以及具有多个 喷头的喷墨打印机（如日本EPSON公司的TSQ-4800喷墨打印机有48个喷头）等，在此不做 详述。 (5)几种打印机的比较 以上介绍的三种打印机都配有一个字符发生器，它们的共同点是都能将字符编码信息变为"}
{"doc_id": "co", "page": 187, "text": "第5章输入输出系统181  点阵信息，不同的是这些点阵信息的控制对象不同。点阵针式打印机的字符点阵用于控制打印 针的驱动电路；激光打印机的字符点阵脉冲信号用于控制激光束；喷墨打印机的字符点阵信息控 制墨滴的运动轨迹。 此外，点阵针式打印机属于击打式打印机，可以逐字打印，也可以逐行打印；喷墨打印机只能 逐字打印；激光打印机属千页式输出设备。后两种都属于非击打式打印机。 不同种类的打印机性能和价格差别很大，用户可根据不同需要合理选用。要求印字质量高 的场合可选用激光打印机；要求价格便宜的或只需具有文字处理功能的个人用计算机，可配置串 行点阵针式打印机；要求处理的信息量很大，速度又要快，应该配行式打印机或高速激光打印机。 计算机的I/0设备中有一类既是输入设备，又是输出设备，如磁盘、终端、AID或DIA转换 器以及汉字处理设备等。 1.终端设备 终端是由显示器和键盘组成的一套独立完整的I/0设备，它可以通过标准接口接到远离 机的地方使用。终端与显示器是两个不同的概念，终端的结构比显示器复杂，它能完成显示控制 与存储、键盘管理及通信控制等，还可完成简单的编辑操作。 2. AID与DIA转换器 当计算机用千过程控制时，其控制信号是模拟量，而计算机仅能处理数字量，这就要用 AID、DIA转换器来完成模拟量与数字量之间的相互转换任务。 AID转换器是模拟／数字转换器，它能将模拟批转换成数字量，是计算机的输入设备。AID 转换器均已制成各种规格的芯片。 DIA转换器是数字／模拟转换器，它能将计算机输出的数字量转换成控制所需的模拟量，以 便控制被控对象或直接输出模拟信号，它是计算机的输出设备。DIA转换器现在也均已制成各 种规格的芯片。 AID与DIA转换器均属于过程控制设备，往往还需要配置其他设备，如传感器、放大电路、 执行机构以及开关量I/0设备等，与计算机共同完成对对象的过程控制。 3.汉字处理设备 计算机进行汉字信息处理时，必须将汉字代码化，即对汉字进行编码。汉字编码可分为输入 码、内码和字形码三大类。输入码是解决汉字的输入和识别问题的；内码是由输入码转换而成 的，只有内码才能在计算机内进行加工处理；字形码能显示或打印输出。汉字处理设备包括汉字 输入、汉字存储和汉字输出三部分。 (1)汉字的输入 采用西文标准键盘输入汉字时，必须对汉字进行编码，以便用字母、数字串替代汉字输入。 汉字编码方法主要有三类：数字编码、拼音编码和字形编码。"}
{"doc_id": "co", "page": 188, "text": "182 第2篇计算机系统的硬件结构 ·数字编码就是用数字串代表一个汉字的输入，常用的是国标区位码，也有的用电报码。 使用区位码输入汉字时，必须根据国标GB2312《信息交换用汉字编码字符集一基本集》，先查 出汉字对应的代码，然后才能输入。这种编码输入的优点是无重码，而且输入码和内码的转换比 较方便，但每个汉字的编码都是一串等长的数字，很难记忆。 ·拼音码是以汉语读音为基础的，由于汉字同音字太多，输入重码率很高，因此按拼音输入 后还必须进行同音字的选择，影响了输入速度。 ·字形编码是以汉字形状确定的，由于汉字都是由一笔一画构成的，而笔画又是有限的，而 且汉字的结构（又称为部件）也可以归结为几类，因此，把汉字的笔画和部件用字母和数字编码 后，再按笔画书写顺序依次输入，就能表示出一个汉字。常用的有五笔字型编码。目前这种编码 输入方法的效率是最高的。 上面介绍的汉字输入方法均为“手动”操作，主要用键盘输入。为了提高输入速度，又发展 了词组输入、联想输入等输入方法。随着计算机技术的不断发展，利用语音或图像识别技术，直 接将汉语或文本输入计算机，使计算机既能识别汉字，又能听懂汉语，并将其自动转换成机内代 码。近年来有关语音识别、文字识别、自然语言理解及机器视觉等学科的研究都巳有了不少好的 成果，读者可查阅有关资料进一步了解。 (2)汉字的存储 汉字的存储包括汉字内码存储和字形码的存储。 汉字内码是汉字信息在机内存储、交换、检索等过程中所使用的机内代码，通常用两个字节 表示。使用汉字内码字符时，应注意和英文字符区别开。英文字符的机内代码是7位ASCII码， 字节的最高位为“0”，而汉字内码的两个字节最高位均为“1\"。以汉字操作系统CCDOS中的汉 字内码为例，汉字国标码“兵“用十六进制表示为“3224H\"，每个字节最高位加“1”后，便得汉字 内码为“B2A4H\"（参见附录6A中的6A.1)。当使用编辑程序输入汉字时，存储到磁盘上的文件 就是用机内码表示汉字的。有些机器把字节的最高位用作奇偶校验位，这时汉字内码需用3个 字节表示。 汉字字形码是用点阵表示汉字字形的代码，也称 字模码，它是汉字的输出形式。简易型的汉字为16x 16点阵，高精度的汉字用24x24点阵或32X32点阵表 示。字模点阵的信息量很大，以16X16点阵为例，存放 一个汉字就要占用32个字节。国标给出的常用汉字 o­ 。 5  有6763个，大约占256K字节，因此必须单设字模点 阵库来存储每个汉字的点阵代码。当显示输出时，需10  检索字库，输出字模点阵，最后得到字形。图5.26是 汉字“次”字的字形点阵及编码。 (3)汉字的输出 汉字输出有打印输出和显示输出两种形式。针式 7 8  15  . . . . . . . •• •• •• •• .. . . .. . .. . . . . . . •• .. . .. . . . . . . . . . •• ••  80如 80,80,FE,02 ，庄战 40AOAO ，妞 10,08 ，阳 03, 0000159A0,OOO112C 0021100011622220  5 l  图5.26汉字字形点阵及编码"}
{"doc_id": "co", "page": 189, "text": "第5章输入输出系统183  汉字打印机有24针和16针两种，前者印字质量较高。也可采用9针的西文打印机，当用9针打 印机打印汉字时，需用软件控制把一行汉字分成两次打印，即每次打印8个点，第一次打印一行 汉字的上半部，第二次打印一行汉字的下半部，拼在一起构成16x16的点阵汉字。 汉字显示可用通用显示器，在主机内由汉字显示控制板（简称汉卡）或通用的图形显示板形 成点阵码，再将点阵码送至显示设备。只要设备具有输出点阵的能力，就可以输出汉字。此外， 汉字显示终端除了显示汉字外，还可作为人机通信设备。 1.多媒体的定义 多媒体是“Multimedia\"的汉译，而“Multimedia”一词是由“Multi”和“Media”两个词构成的复 合词，直译即为“多媒体”。 多媒体一词的核心词是媒体。所谓媒体，是指信息传递和存储的最基本的技术和手段。日 常生活中最常用的媒体包括音乐、语言、图片、文件、书籍、电视、广播、电话等。人们可以通过媒 体获取他（她）们所需的信息，同时也可以利用这些媒体将有用信息传送出去或保存起来。 然而，传统的媒体设施、工具和手段大多是单一功能的。例如，音响设备只能录音或放音；电 视只能提供音频和视频信息；报纸只能提供文字和图像图表信息等。由于都是单功能媒体，而且 各自均独立分散，为此人们希望能有一个集多种功能的多媒体系统，这就是应用领域向计算机科 学与技术和计算机工业提出的迫切要求。 此外，计算机本身的发展也提出了同样的要求。回顾一下计算机的发展史，不难发现，计算 机与某一信息形式结合便可以开拓一个新的应用领域。在20世纪50年代，计算机局限千处理 数字，应用领域也限制在求解复杂的数学问题。到了20世纪60年代，计算机与字符处理、文本 处理相结合，就出现了信息管理系统。后来计算机与图形结合，产生了CAD。计算机与照相技 术相结合，又产生了图像（静）处理等。20世纪80年代曾是人工智能研究领域的高潮时代，首先 是日本提出了以研究具有高度智能的第五代计算机为目标的FGCS计划，给世界计算机技术形 成了一次冲击，可是经过了10年含辛茹苦地探索，人们才发现研制人工智能第五代计算机的时 代远未成熟，只有在计算机科学理论和信息处理技术的高度发展以及知识库体系自我完备的基 础上，第五代人工智能计算机的研制才有可能成为现实。人们在认识世界和对某一事物做出判 断时，绝不是或不仅仅是用某种单一媒体上的信息或孤立地利用某一时刻的信息。人脑首先是 具有高度的信息融合能力，其次是具有历史和环境提供的启示信息，以减少推理搜索空间的能 力。目前的计算机还远远不具备人脑的这种能力，因此，人工智能也很难取得突破性的进展。 研究多媒体计算机技术，就是要强调计算机与声音、活动图像和文字相结合。例如，将录像 内容输到计算机内（如果需要可进行处理），在播放时，可与多种其他媒体信息（如文字、声音）混 合在一起，形成一个多媒体的演示系统。又如，将计算机产生的图形或动画与摄像机摄得的图像 叠加在一起等。此外，采用人机对话方式，对计算机存储的各种信息进行查找、编辑以及实现同"}
{"doc_id": "co", "page": 190, "text": "184 第2篇计算机系统的硬件结构 时播放，使多媒体系统成为一个交互式的系统。可见，多媒体计算机可作为研制高度智能计算机 系统的一个平台。 2.多媒体计算机的关键技术 (1)视频和音频数据的压缩与解压缩技术 多媒体计算机的关键问题是如何实时综合处理声、图和文字信息，需要将每幅图像从模拟量 转换成数字量，然后进行图像处理，与图形、文字复合后存放在机器中。数字化图像和声音的信 息量是非常大的。以一般彩色电视信号为例，设代表光强、色彩和色饱和度的YIQ色空间中各 分量的带宽分别为4.2MHz、1.5MHz和0.5MHz。根据采样原理，仅当采样频率大千等千2倍的 原始信号的频率时，才能保证采样后信号不失真地恢复为原始信号。再设各分量均被数字化为 8位，从而1秒钟的电视信号的数据总量应为 (4.2+ 1.5 +0.5) X2X8 = 99.2 Mb  也就是说，彩色电视节目信号的数据量每秒约为100Mb，因而一个容量为1GB的CD-ROM仅能 存放约一分钟的原始电视数据（每字节后面附有2位校验位），很显然电视信号数字化后直接保 存的方法是令人难以接受的。 对于语音的数据也一样，一般人类语音的带宽为4kHz，同样依据采样定理，并设数字化精 度为8位，则一秒钟的数据量约为4Kx2x8 = 64 K位，因此在上述采样条件下，讲一分钟话的数 据量约为480KB。 由此可见，电视图像、彩色图像、彩色静图像、文件图像以及语音等数据量是相当大的。特别 是电视图像的数据量，在相同条件下要比语音数据量大1000倍。再加上计算机总线的传输速 率的局限，因此，必须对信息进行压缩和解压缩。所谓图像压缩，是指图像从像素存储的方式经 过图像变换、量化和高效编码等处理，转换成特殊形式的编码，从而大大降低计算机所需存储和 实时传送的数据量。例如，Intel公司的交互式数字视频系统DVI能将动态图像数据压缩到 135 KBps的传送速度。 信息编码方式很多，应选用符合国际标准的，并能用计算机或VLSI芯片快速实现的编码 方法。 (2)多媒体专用芯片 由千多媒体计算机承担大量与数据信号处理、图像处理、压缩与解压缩以及解决多媒体之间 关系等有关的问题，而且要求处理速度快，因此需研制专用芯片。一般多媒体专用芯片有两种类 型：固定功能的和可编程的。 (3)大容量存储器 多媒体计算机需要存储的信息量极大，因此研制大容量的存储器仍是多媒体计算机系统的 关键技术。 (4)适用于多媒体技术的软件 图5.27示意了多媒体系统的层次结构。 最底层为计算机硬件，还可配置电视机、录像机及音像设备等。其上层是多媒体实时压缩和"}
{"doc_id": "co", "page": 191, "text": "第5章输入输出系统 解压缩层，它将视频和音频信号压缩后存储在磁盘上， 播放时要解压缩，而且要求处理速度快，通常采用以专 用芯片为基础的电路卡。 多媒体输入输出控制及接口层与多媒体设备打交 道，驱动控制这些硬件设备，并提供与高层软件的接口。 多媒体核心系统层是多媒体操作系统，Intel、IBM、 Microsoft和Apple等公司都开发了这层软件。 创作系统层是为方便用户开发应用系统而设置的， 具有编辑和播放等功能。 应用系统层包括厂家或用户开发的应用软件。 应用系统 创作系统 多媒体核心系统 多媒体输入输出控制及接口 多媒体实时压缩与解压缩 计算机硬件 图5.27多媒休系统的层次结构 以上除最底层的硬件层外，其他层次都包含适用于多媒体技术的软件。 5.3 I/0接口 1  185  接口可以看作两个系统或两个部件之间的交接部分，它既可以是两种硬设备之间的连接 电路，也可以是两个软件之间的共同逻辑边界。I/0接口通常是指主机与I/0设备之间设置 的一个硬件电路及其相应的软件控制。由图5.13可知，不同的I/0设备都有其相应的设备控 制器，而它们往往都是通过I/0接口与主机取得联系的。主机与I/0设备之间设置接口的理 由如下： 心一台机器通常配有多台I/0设备，它们各自有其设备号（地址），通过接口可实现I/0设 备的选择。 @I/0设备种类繁多，速度不一，与CPU速度相差可能很大，通过接口可实现数据缓冲，达 到速度匹配。 ＠有些I/0设备可能串行传送数据，而CPU一般为并行传送，通过接口可实现数据串－并 格式的转换。 @I/0设备的输入输出电平可能与CPU的输入输出电平不同，通过接口可实现电平转换。 @ CPU启动I/0设备工作，要向I/0设备发各种控制信号，通过接口可传送控制命令。 @I/0设备需将其工作状态（如“忙＂”就绪”“错误”“中断请求”等）及时向CPU报告，通过 接口可监视设备的工作状态，并可保存状态信息，供CPU查询。 值得注意的是，接口(Interface)和端口(Port)是两个不同的概念。端口是指接口电路中的一 些寄存器，这些寄存器分别用来存放数据信息、控制信息和状态信息，相应的端口分别称为数据"}
{"doc_id": "co", "page": 192, "text": "186 第2篇计算机系统的硬件结构 端口、控制端口和状态端口。若干个端口加上相应的控制逻辑才能组成接口。CPU通过输入指 令，从端口读入信息，通过输出指令，可将信息写入端口中。 和 1.总线连接方式的I/0接口电路 图5.28所示为总线结构的计算机，每一台I/0设备都是通过I/0接口挂到系统总线上的。 图中的I/0总线包括数据线、设备选择线、命令线和状态线。 1/0总线 设备选择线 图5.28I/0总线和接口部件 (1)数据线 数据线是I/0设备与主机之间数据代码的传送线，其根数一般等于存储字长的位数或字符 的位数，它通常是双向的，也可以是单向的。若采用单向数据总线，则必须用两组才能实现数据 的输入和输出功能，而双向数据总线只需一组即可。 (2)设备选择线 设备选择线是用来传送设备码的，它的根数取决千I/0指令中设备码的位数。如果把设备 码看作地址号，那么设备选择线又可称为地址线。设备选择线可以有一组，也可以有两组，其中 一组用于主机向I/0设备发送设备码，另一组用千I/0设备向主机回送设备码。当然设备选择 线也可采用一组双向总线代替两组单向总线。 (3)命令线 命令线主要用以传输CPU向设备发出的各种命令信号，如启动、清除、屏蔽、读、写等。它是 一组单向总线，其根数与命令信号多少有关。"}
{"doc_id": "co", "page": 193, "text": "第5章输入输出系统187  (4)状态线 状态线是将I/0设备的状态向主机报告的信号线，例如，设备是否准备就绪，是否向CPU发 出中断请求等。它也是一组单向总线。 现代计算机中大多采用三态逻辑电路来构成总线。 2.接口的功能和组成 根据上述设置接口的理由，可归纳出接口通常应具有以下几个功能以及相应的硬件配置。 (1)选址功能 由于I/0总线与所有设备的接口电路相连，但CPU究竟选择哪台设备，还得通过设备选择 线上的设备码来确定。该设备码将送至所有设备的接口，因此，要求每个接口都必须具有选址功 能，即当设备选择线上的设备码与本设备码相符时，应发出设备选中信号SEL，这种功能可通过 接口内的设备选择电路来实现。 图5.29所示为接口1和接口2的设备选择电路。这两个电路的具体线路可以不同，它们分 别能识别出自身的设备码，一旦某接口设备选择电路有输出时，它便可控制这个设备通过命令 线、状态线和数据线与主机交换信息。 (2)传送命令的功能 当CPU向I/0设备发出命令时，要求I/0设备能做出响应，如果I/0接口不具备传送命令 信息的功能那么设备将无法响应，故通常在I/0接口中设有存放命令的命令寄存器以及命令译 码器，如图5.30所示。 设备选择线 广—·—·—·—·—·—. L | v三气1: ·一·—·—·—·—·」 气 ［三三』 命令线 厂一·—·—·—·—·—·- ，入1设备选笆巴巴」j  SELl i  三1 L.—·—·—·—·— 接口1l ·-·  图5.29设备选择电路框图图5.30 广一恤—·—·—·—·—---, I 设备选笆巴巴」1  SEL2 i  L三兰］I 接口2j -----嗣--·恤 命令寄存器和命令译码器 命令寄存器用来存放1/0指令中的命令码，它受设备选中信号控制。命令线和所有接口电 路的命令寄存器相连，只有被选中设备的SEL信号有效，命令寄存器才可接受命令线上的命 令码。"}
{"doc_id": "co", "page": 194, "text": "188 第2篇计算机系统的硬件结构 (3)传送数据的功能 既然接口处于主机与1/0设备之间，因此数据必须通过接口才能实现主机与1/0设备之间 的传送。这就要求接口中具有数据通路，完成数据传送。这种数据通路还应具有缓冲能力，即能 将数据暂存在接口内。接口中通常设有数据缓冲寄存器(DataBuffer Register, DBR)，它用来暂 存1/0设备与主机准备交换的信息，与1/0总线中的数据线是相连的。 每个接口中的数据缓冲寄存器的位数可以各不相同，这取决千各类1/0设备的不同需要。 例如，键盘接口的DBR定为8位，因为ASCII码为7位（见附录5A)，再加一位奇偶校验位，故为 8位。又如磁盘这类外设，其DB.R的位数通常与存储字长的位数相等，而且还要求具有串－并转 换能力，既可将从磁盘中串行读出的信息并行送至主存，又可将从主存中并行读出的信息串行输 至磁盘。 (4)反映1/0设备工作状态的功能 为了使CPU能及时了解各1/0设备的工作状态，接口内必须设置一些反映设备工作状态的 触发器。例如，用完成触发器D和工作触发器B来标志设备所处的状态。 当D=O,B=O时，表示1/0设备处千暂停状态。 当D=l,B=O时，表示1/0设备已经准备就绪。 当D=O,B=l时，表示1/0设备正处千准备状态。 由于现代计算机系统中大多采用中断技术，因此接口电路中一般还设有中断请求触发器 INTR，当其为“1”时，表示该1/0设备向CPU发出中断请求。接口内还有屏蔽触发器MASK，它 与中断请求触发器配合使用，完成设备的屏蔽功能（有关内容将在8.4节讲述）。 所有的状态标志触发器都与1/0总线中的状态线相连。此外，不同的1/0设备的接口电路 中还可根据需要增设一些其他状态标志触发器，如“出错＂触发器、“数据迟到“触发器，或配置一 些奇偶校验电路、循环码校验电路等。随着大规模集成电路制作工艺的不断进步，目前大多数 1/0设备所共用的电路都制作在一个芯片内，作为通用接口芯片。另一些1/0设备专用的电路， 制作在1/0设备的设备控制器中。本节所讲述的接口功能及组成均是指通用接口所具备的。图 5.31所示为1/0接口的基本组成。 I/0接口按不同方式分类有以下几种。 叩按数据传送方式分类，有并行接口和串行接口两类。并行接口是将一个字节（或一个字） 的所有位同时传送（如Intel8255)；串行接口是在设备与接口间一位一位传送（如Intel8251)。 由于接口与主机之间是按字节或字并行传送，因此对串行接口而言，其内部还必须设有串－并转 换装置。 ＠按功能选择的灵活性分类，有可编程接口和不可编程接口两种。可编程接口的功能及操 作方式可用程序来改变或选择（如Intel8255、Intel8251)；不可编程接口不能由程序来改变其功"}
{"doc_id": "co", "page": 195, "text": "第5章输入输出系统189  '.—·—·—·—·—· －一·—·—·—· I I/0接口1  CPU  l.—·—·—·—·—·—·—·—·—. !  2 设备 图5.31I/0接口的基本组成 能，但可通过硬连线逻辑来实现不同的功能（如Intel8212)。 ＠按通用性分类有通用接口和专用接口。通用接口可供多种I/0设备使用，如Intel8255、 Intel 8212；专用接口是为某类外设或某种用途专门设计的，如Intel8279可编程键盘／显示器接 口；Intel8275可编程CRT控制器接口等。 ＠按数据传送的控制方式分类，有程序型接口和DMA型接口。程序型接口用于连接速度 较慢的I/0设备，如显示终端、键盘、打印机等。现代计算机一般都可采用程序中断方式实现主 机与I/0设备之间的信息交换，故都配有这类接口，如Intel8259。DMA型接口用千连接高速 I/0设备，如磁盘、磁带等，如Intel8237。有关这两类接口，将在5.5和5.6节中讲述它们的基本 组成原理。 5.4  询 1  由5.1.4节已知，程序查询方式的核心问题在千每时每刻需不 断查询I/0设备是否准备就绪。图5.32是单个I/0设备的查询 流程。 当I/0设备较多时，CPU需按各个I/0设备在系统中的优先级「一飞百五据 别进行逐级查询，其流程图如5.33所示。图中设备的优先顺序按1 至N降序排列。图5.32单个I/0设备的 为了正确完成这种查询，通常要执行如下3条指令。查询流程"}
{"doc_id": "co", "page": 196, "text": "190 第2篇计算机系统的硬件结构 少测试指令，用来查询I/0设备是否准备就绪。 ＠传送指令，当I/0设备已准备就绪时，执行传送指令。 ＠转移指令，若I/0设备未准备就绪，执行转移指令，转至测试指令，继续测试I/0设备的 状态。 图5.34所示为单个I/0设备程序查询方式的程序流程。当需要启动某一I/0设备时，必须 将该程序插入现行程序中。该程序包括如下几项，其中心～＠为准备工作。 处理J/0设备1 检查状态标志2 保护寄存器内容 设置计数值 处理VO飞百可 检查状态标志3 Y-1处理1/0艺色且 IY  ;N 传送一个数据 !  检查状态标志NII 修改主存地址 !  修改计数值 Y ,  结束I/0传送 图5.33多个I/0设备的查询流程图5.34程序查询方式的程序流程 叩由于这种方式传送数据时要占用CPU中的寄存器，故首先需将寄存器原内容保护起来 （若该寄存器中存有有用信息）。 ＠由于传送往往是一批数据，因此需先设置1/0设备与主机交换数据的计数值。 ＠设置欲传送数据在主存缓冲区的首地址。"}
{"doc_id": "co", "page": 197, "text": "第5章输入输出系统191  @CPU启动I/0设备。 ＠将I/0接口中的设备状态标志取至CPU并测试I/0设备是否准备就绪。如果未准备就 绪，则等待，直到准备就绪为止。当准备就绪时，接着可实现传送。对输入而言，准备就绪意味着 接口电路中的数据缓冲寄存器已装满欲传送的数据，称为输入缓冲满，CPU即可取走数据；对输 出而言，准备就绪意味着接口电路中的数据已被设备取走，故称为输出缓冲空，这样CPU可再次 将数据送到接口，设备可再次从接口接收数据。 @CPU执行I/0指令，或从I/0接口的数据缓冲寄存器中读出一个数据，或把一个数据写 入I/0接口中的数据缓冲寄存器内，同时将接口中的状态标志复位。 ＠修改主存地址。 ＠修改计数值，若原设置计数值为原码，则依次减l；若原设置计数值为负数的补码，则依次 加1（有关原码、补码的概念可参阅6.1节）。 ＠判断计数值。若计数值不为0，表示一批数据尚未传送完，重新启动外设继续传送；若计 数值为0，则表示一批数据已传送完毕。 吩结束I/0传送，继续执行现行程序。 由程序查询流程和5.3.2节所述的接口功能及组成，得出程序查询方式接口电路的基本组 成，如图5.35所示。 「一—-－－一一—星一—· !C5> 数据线孕邑＝＝＝＝斗数据缓冲寄存器伈气＝＝输入数据 准备就绪见）！I I i@-启动设备 I  启动命令一.Ql: o. I 地址线＝于~1；；择电路1 |  j_ ·—·—·—·—·—·—·—·—.1  设备工作结束 图5.35程序查询方式接口电路（输入）的基本组成 图中设备选择电路用以识别本设备地址，当地址线上的设备号与本设备号相符时，SEL有 效，可以接收命令；数据缓冲寄存器用于存放欲传送的数据；D是完成触发器，B是工作触发器， 其功能如5.3.2节所述。 以输入设备为例，该接口的工作过程如下： 心当CPU通过I/0指令启动输入设备时，指令的设备码字段通过地址线送至设备选择 电路。"}
{"doc_id": "co", "page": 198, "text": "192 第2篇计算机系统的硬件结构 ＠若该接口的设备码与地址线上的代码吻合，其输出SEL有效。 @I/0指令的启动命令经过”与非“门将工作触发器B置”1\"，将完成触发器D置“O”。 ＠由B触发器启动设备工作。 ＠输入设备将数据送至数据缓冲寄存器。 ＠由设备发设备工作结束信号，将D置”1\",B置“0”，表示外设准备就绪。 (J) D触发器以“准备就绪＂状态通知CPU，表示“数据缓冲满”。 @ CPU执行输入指令，将数据缓冲寄存器中的数据送至CPU的通用寄存器，再存入主存相 关单元。 例5.1在程序查询方式的输入输出系统中，假设不考虑处理时间，每一次查询操作需要 100个时钟周期，CPU的时钟频率为50MHz。现有鼠标和硬盘两个设备，而且CPU必须每秒对 鼠标进行30次查询，硬盘以32位字长为单位传输数据，即每32位被CPU查询一次，传输率为 2 MBps。求CPU对这两个设备查询所花费的时间比率，由此可得出什么结论？ 解：（1)CPU每秒对鼠标进行30次查询，所需的时钟周期数为 100 X 30= 3 000  根据CPU的时钟频率为50MHz，即每秒sox106个时钟周期，故对鼠标的查询占用CPU的 时间比率为 [ 3 000/ (so·x 10勹］X100% = 0.006%  可见，对鼠标的查询基本不影响CPU的性能。 (2)对于硬盘，每32位被CPU查询一次，故每秒查询 2MB/4B=512K次 则每秒查询的时钟周期数为 100 X 512 X 1 024 = 52.4 X 106  故对磁盘的查询占用CPU的时间比率为 [ (52.4X 10勹／（50Xl0勹］X100% = 105%  可见，即使CPU将全部时间都用千对硬盘的查询也不能满足磁盘传输的要求，因此CPU 般不采用程序查询方式与磁盘交换信息。 5.5 程序中断方式 1 中断的概念 计算机在执行程序的过程中，当出现异常情况或特殊请求时，计算机停止现行程序的运行， 转向对这些异常情况或特殊请求的处理，处理结束后再返回到现行程序的间断处，继续执行原程"}
{"doc_id": "co", "page": 199, "text": "第5章输入输出系统193  序，这就是“中断＂（参见图5.10)。中断是现代计算机能有效合理地发挥效能和提高效率的一个 十分重要的功能。通常又把实现这种功能所需的软硬件技术统称为中断技术。 断 在I/0设备与主机交换信息时，由于设备本身机电特性的影响，其工作速度较低，与CPU 无法匹配，因此，CPU启动设备后，往往需要等待一段时间才能实现主机与I/0设备之间的信 息交换。如果在设备准备的同时，CPU不做无谓的等待，而继续执行现行程序，只有当I/0设 备准备就绪向CPU提出请求后，再暂时中断CPU现行程序转入I/0服务程序，这便产生了I/ 0中断。 图5.36所示为由打印机引起的I/0中断时，CPU与打印机并行工作的时间示意图。 执行主程序继续执行主程序继续执行主程序 J77J7  启动传送传送 打印机数据数据 I I I  准备发 i饕岱 空闲 图5.36CPU与打印机并行工作的时间示意图 其实，计算机系统引入中断技术的原因不仅仅是为了适应I/0设备工作速度低的问题。例 如，当计算机正在运行中，若出现突然掉电这种异常情况，将会导致CPU中的全部信息丢失。倘 若能在突然掉电的瞬间立即启动另一个备份电源，并迅速进行一些必要的处理，例如，将有用信 息送至不受电源影响的存储系统内，待电源恢复后接着使用，这种处理技术也要用中断技术来实 现。又如，在实时控制领域中，要求CPU能即时响应外来信号的请求，并能完成相应的操作，也 都要求采用中断技术。总之，为了提高计算机的整机效率，为了应付突发事件，为了实时控制的 需要，在计算机技术的发展过程中产生了“中断”技术。为了实现“中断＂，计算机系统中必须配 有相应的中断系统或中断机构。本节着重介绍I/0中断处理的相关内容，有关中断的其他内容 将在第8章中讲述。"}
{"doc_id": "co", "page": 200, "text": "194 第2篇计算机系统的硬件结构 程 断 的接路 为处理I/0中断，在I/0接口电路中必须配置相关的硬件线路。 1.中断请求触发器和中断屏蔽触发器 台外部设备都必须配置一个中断请求触发器INTR，当其为“1”时，表示该设备向CPU提 出中断请求。但是设备欲提出中断请求时，其设备本身必须准备就绪，即接口内的完成触发器D 的状态必须为“1”。 由千计算机应用的范围越来越广泛，向CPU提出中断请求的原因也越来越多，除了各种 I/0设备外，还有其他许多突发性事件都是引起中断的因素，为此，把凡能向CPU提出中断请求 的各种因素统称为中断源。当多个中断源向CPU提出中断请求时，CPU必须坚持一个原则，即 在任何瞬间只能接受一个中断源的请求。所以，当多个中断源同时提出请求时，CPU必须对各 中断源的请求进行排队，且只能接受级别最高的中断源的请求，不允许级别低的中断源中断正在 运行的中断服务程序。这样，在I/0接口中需设置一个屏蔽触发器MASK，当其为“1”时，表示被 屏蔽，即封锁其中断源的请求。可见中断请求触发器和中断屏蔽触发器在I/0接口中是成对出 现的。有关屏蔽的详细内容将在8.4.6节中讲述。 此外，CPU总是在统一的时间，即每条指令执行阶段的最后时刻，查询所有的设备是否有中 断请求。 综合上述各因素，可得出接口电路中的完成触 发器D、中断请求触发器INTR、中断屏蔽触发器 MASK和中断查询信号的关系如图5.37所示。可 见，仅当设备准备就绪(D= 1)，且该设备未被屏蔽 (MASK= 0)时，CPU的中断查询信号可将中断请求 触发器置“1\"(INTR = 1)。 2.排队器 如上所述，当多个中断源同时向CPU提出请求 时，CPU只能按中断源的不同性质对其排队，给予不 同等级的优先权，并按优先等级的高低予以响应。 来自CPU的 中断查询信号 图5.37接口电路中D、INTR、MASK 和中断查询信号的关系 就I/0中断而言，速度越高的I/0设备，优先级越高，因为若CPU不及时响应高速I/0的请求， 其信息可能会立即丢失。 设备优先权的处理可以采用硬件方法，也可采用软件方法（详见8.4.2节）。硬件排队器的 实现方法很多，既可在CPU内部设置一个统一的排队器，对所有中断源进行排队（详见图 8.25)，也可在接口电路内分别设置各个设备的排队器，图5.38所示是设在各个接口电路中的排 队器电路，又称为链式排队器。 图5.38中下面的一排门电路是链式排队器的核心。每个接口中有一个反相器和一个”与"}
{"doc_id": "co", "page": 201, "text": "第5章输入输出系统195  Li!|2  INTR 1 INTR 2 INTR3 INTR 4  图5.38链式排队器 非“门（如图中点画线框内所示），它们之间犹如链条一样串接在一起，故称为链式排队器。该电 路中级别最高的中断源是1号，其次是2号、3号、4号。不论是哪个中断源（一个或多个）提出 中断请求，排队器输出端INTP;只有一个高电平。 当各中断源均无中断请求时，各个INTR;为高电平，其INTP仁INTP;、INTP伈·均为高电平。 一旦某个中断源提出中断请求时，就迫使比其优先级低的中断源INTP:变为低电平，封锁其 发中断请求。例如，当2号和3号中断源同时有请求时(INTR2= 0, INTR3 = 0)，经分析可知 INTP~和INTP;均为高电平，INTP;及往后各级的INTP:均为低电平。各个INTP'.再经图中 上面一排两个输入头的”与非“门，便可保证排队器只有INT贮为高电平，表示2号中断源排 队选中。 3.中断向量地址形成部件（设备编码器） CPU一旦响应了I/0中断，就要暂停现行程序，转去执行该设备的中断服务程序。不同的 设备有不同的中断服务程序，每个服务程序都有一个入口地址，CPU必须找到这个入口地址。 入口地址的寻找也可用硬件或软件的方法来完成，这里只介绍硬件向量法。所谓硬件向量 法，就是通过向量地址来寻找设备的中断服务程序入口地址，而且向量地址是由硬件电路产生 的，如图5.39所示。 中断向量地址形成部件的输入是来自排队器的输出INTP1, INTP 2,…，INTP\"，它的输出是 中断向量（二进制代码表示），其位数与计算机可以处理中断源的个数有关，即一个中断源对 应一个向量地址。可见，该部件实质上是一个编码器。在I/0接口中的编码器又称为设备编 码器。 这里必须分清向量地址和中断服务程序的入口地址是两个不同的概念，图5.40是通过向量 地址寻找入口地址的一种方案。其中12H、13H、14H是向量地址，200、300分别是打印机服务程 序和显示器服务程序的入口地址。"}
{"doc_id": "co", "page": 202, "text": "196 第2篇计算机系统的硬件结构 主存 HHH 121314 {  址 地 量 向 中断向量入口地址200  中断向量地址 形成部件 入口地址300  INTP1 INTP n  JMP 200  JMP 300  JMP 400  打印机服务程序 ..  显示器服务程序 图5.39中断向量地址形成部件框图图5.40通过向噩地址寻找入口地址 4.程序中断方式接口电路的基本组成 综合5.3.2节对一般接口电路的分析以及上述对实现程序中断方式所需增设硬件的介绍， 以输入设备为例，程序中断方式接口电路的基本组成如图5.41所示。 中断响应 INTA  向量地址五二二二二———] 中断请求 启动命令 地址线 数据线 至低一级 的排队器 来自高一级 的排队器 中断查询 启动设备 设备工作结束 尸输入数据 '—·—·—·一·—·—·—·—·—·」 图5.41程序中断方式接口电路的基本组成 例5.2现有3个设备A、B、C，它们的优先级按降序排列。此3个设备的向量地址分别是 001010、001011、001100。设计一个链式排队线路和产生3个向量地址的设备编码器。"}
{"doc_id": "co", "page": 203, "text": "第5章输入输出系统197  解：链式排队线路和设备编码器如图5.42所示。图中INTR;(i= A, B, C)为中断请求信号， 有请求时INTR;= 1（即INTR;= 0), INTP ;(i = A, B, C)为排队器输出，INTA为中断响应信号。点 画线框内为设备编码器。当中断响应信号INTA有效时，被选中的排队信号INTP，通过设备编码 器形成的向量地址可通过数据总线送至CPU。 001010 001011 001100  数据总线 |  L ·—·—·—·—·—·—·—·—  ·—-7  设i 备， ;:  ·—·—·一·—·—·—－书—·—·—·—__j  INTA  INTRA 酰B 图5.42例5.2电路图 IN兀 断 1. CPU响应中断的条件和时间 CPU响应I/0设备提出中断请求的条件是必须满足CPU中的允许中断触发器EINT为 “l\"。该触发器可用开中断指令置位（称为开中断）；也可用关中断指令或硬件自动使其复位（称 为关中断）。 由图5.37分析可知，I/0设备准备就绪的时间（即D=l)是随机的，而CPU是在统一的时刻 （每条指令执行阶段结束前）向接口发中断查询信号，以获取I/0的中断请求。因此，CPU响应 中断的时间一定是在每条指令执行阶段的结束时刻。 2. I/0中断处理过程 下面以输入设备为例，结合图5.41，说明I/0中断处理的全过程。当CPU通过I/0指令的"}
{"doc_id": "co", "page": 204, "text": "198 第2篇计算机系统的硬件结构 地址码选中某设备后，则 心由CPU发启动I/0设备命令，将接口中的B置“1\",D置“O”。 ＠接口启动输入设备开始工作。 ＠输入设备将数据送入数据缓冲寄存器。 ＠输入设备向接口发出“设备工作结束“信号，将D置”1\",B置“O”，标志设备准备就绪。 ＠当设备准备就绪(D= 1)，且本设备未被屏蔽(MASK=0)时，在指令执行阶段的结束时 刻，由CPU发出中断查询信号。 ＠设备中断请求触发器INTR被置“1”，标志设备向CPU提出中断请求。与此同时，INTR 送至排队器，进行中断判优。 (J)若CPU允许中断(EINT=1)，设备又被排队选中，即进入中断响应阶段，由中断响应信号 INTA将排队器输出送至编码器形成向量地址。 ＠向量地址送至PC，作为下一条指令的地址。 ＠由于向量地址中存放的是一条无条件转移指令（参见图5.40)，故这条指令执行结束后， 即无条件转至该设备的服务程序入口地址，开始执行中断服务程序，进入中断服务阶段，通过输 入指令将数据缓冲寄存器的输入数据送至CPU的通用寄存器，再存入主存相关单元。 叨中断服务程序的最后一条指令是中断返回指令，当其执行结束时，即中断返回至原程序 的断点处。至此，一个完整的程序中断处理过程即告结束。 综上所述，可将一次中断处理过程简单地归纳为中断请求、中断判优、中断响应、中断服务和 中断返回5个阶段。至于为什么能准确返回至原程序断点，CPU在中断响应阶段除了将向量地 址送至PC外，还做了什么其他操作等问题，将在8.4节详细介绍。 中断服务程序的流程 不同设备的服务程序是不相同的，可它们的程序流程又是类似的，一般中断服务程序的流程 分四大部分：保护现场、中断服务、恢复现场和中断返回。 1.保护现场 保护现场有两个含义，其一是保存程序的断点；其二是保存通用寄存器和状态寄存器的内 容。前者由中断隐指令完成（详见8.4.4节），后者由中断服务程序完成。具体而言，可在中断服 务程序的起始部分安排若干条存数指令，将寄存器的内容存至存储器中保存，或用进栈指令 (PUSH)将各寄存器的内容推入堆栈保存，即将程序中断时的“现场“保存起来。 2.中断服务（设备服务） 这是中断服务程序的主体部分，对千不同的中断请求源，其中断服务操作内容是不同的，例 如，打印机要求CPU将需打印的一行字符代码，通过接口送入打印机的缓冲存储器中（参见图 5.23)以供打印机打印。又如，显示设备要求CPU将需显示的一屏字符代码通过接口送入显示 器的显示存储器中（参见图5.18)。"}
{"doc_id": "co", "page": 205, "text": "第5章输入输出系统199  3.恢复现场 这是中断服务程序的结尾部分，要求在退出服务程序前，将原程序中断时的“现场＂恢复到 原来的寄存器中。通常可用取数指令或出栈指令(POP)，将保存在存储器（或堆栈）中的信息送 回到原来的寄存器中。 4.中断返回 中断服务程序的最后一条指令通常是一条中断返回指令，使其返回到原程序的断点处，以便 继续执行原程序。 计算机在处理中断的过程中，有可能出现新的中断请求，此时如果CPU暂停现行的中断服 务程序，转去处理新的中断请求，这种现象称为中断嵌套，或多重中断。倘若CPU在执行中断服 务程序时，对新的中断请求不予理睬，这种中断称为单重中断。这两种处理方式的中断服务程序 略有区别。图5.43(a)和图5.43(b)分别为单重中断和多重中断服务程序流程。比较图5.43(a)  和图5.43(b)可以发现，其区别在千“开中断＂的设置时间不同。 中断服务程序中断服务程序 (a)单重中断 图5.43 (b)多重中断 中断和多重中断服务程序流程"}
{"doc_id": "co", "page": 206, "text": "200 第2篇计算机系统的硬件结构 CPU一旦响应了某中断源的中断请求后，便由硬件线路自动关中断，即中断允许触发器 EINT被置“0\"（详见图8.30)，以确保该中断服务程序的顺利执行。因此如果不用“开中断”指令 将EINT置”1\"，则意味着CPU不能再响应其他任何一个中断源的中断请求。对千单重中断，开 中断指令设置在最后”中断返回”之前，意味着在整个中断服务处理过程中，不能再响应其他中 断源的请求。对于多重中断，开中断指令提前至“保护现场”之后，意味着在保护现场后，若有级 别更高的中断源提出请求（这是实现多重中断的必要条件），CPU也可以响应，即再次中断现行 的服务程序，转至新的中断服务程序，这是单重中断与多重中断的主要区别。有关多重中断的详 细内容参见8.4.6节。 综上所述，从宏观上分析，程序中断方式克服了程序查询方式中的CPU\"踏步“现象，实现 了CPU与I/0的并行工作，提高了CPU的资源利用率。但从微观操作分析，发现CPU在处理中 断服务程序时仍需暂停原程序的正常运行，尤其是当高速I/0设备或辅助存储器频繁地、成批地 与主存交换信息时，需不断地打断CPU执行主程序而执行中断服务程序。图5.44是主程序和 服务程序抢占CPU的示意图。为此，人们探索出使CPU效率更高的DMA控制方式。 CPU  I/0  5.6 DMA方式 主程序 继续执行主程序继续执行主程序 启动外设服务程序 （传送数据） 服务程序 （传送数据） 准备工作 准备工作准备工作 发中断请求发中断请求 图5.44主程序和服务程序抢占CPU的示意图 的特 图5.45示意了DMA方式与程序中断方式的数据通路。 由图中可见，由于主存和DMA接口之间有一条数据通路，因此主存和设备交换信息时，不 通过CPU，也不需要CPU暂停现行程序为设备服务，省去了保护现场和恢复现场，因此工作速度 比程序中断方式的工作速度高。这一特点特别适合于高速I/0或辅存与主存之间的信息交换。"}
{"doc_id": "co", "page": 207, "text": "第5章输入输出系统201  DMA方式数据传送通路 图5.45DMA和程序中断两种方式的数据通路 因为高速I/0设备若每次申请与主机交换信息时，都要等待CPU做出中断响应后再进行，很可 能因此使数据丢失。 值得注意的是，若出现高速I/0（通过DMA接口）和CPU同时访问主存，CPU必须将总线 （如地址线、数据线）占有权让给DMA接口使用，即DMA采用周期窃取的方式占用一个存取 周期。 在DMA方式中，由于DMA接口与CPU共享主存，这就有可能出现两者争用主存的冲突。 为了有效地分时使用主存，通常DMA与主存交换数据时采用如下三种方法。 (1)停止CPU访问主存 当外设要求传送一批数据时，由DMA接口向CPU发一个停止信号，要求CPU放弃地址线、 数据线和有关控制线的使用权。DMA接口获得总线控制权后，开始进行数据传送，在数据传送 结束后，DMA接口通知CPU可以使用主存，并把总线控制权交回给CPU，图5.46(a)是该方式的 时间示意图。 这种方式的优点是控制简单，适用千数据传输率很高的I/0设备实现成组数据的传送。缺 点是DMA接口在访间主存时，CPU基本上处于不工作状态或保持原状态。而且即使I/0设备 高速运行，两个数据之间的准备间隔时间也总大千一个存取周期，因此，CPU对主存的利用率并 没得到充分的发挥。如软盘读一个8位二进制数大约需要32µ,s，而半导体存储器的存取周期远 小千1µ,s，可见在软盘准备数据的时间内，主存处千空闲状态，而CPU又暂停访问主存。为此在 DMA接口中，一般设有一个小容量存储器（这种存储器是用半导体芯片制作的），使I/0设备首 先与小容量存储器交换数据，然后由小容量存储器与主存交换数据，这便可减少DMA传送数据 时占用总线的时间，即可减少CPU的暂停工作时间。 (2)周期挪用（或周期窃取） 在这种方法中，每当I/0设备发出DMA请求时，I/0设备便挪用或窃取总线占用权一个或 几个主存周期，而DMA不请求时，CPU仍继续访问主存。 I/0设备请求DMA传送会遇到三种情况。一种是CPU此时不需要访问主存（如CPU正在"}
{"doc_id": "co", "page": 208, "text": "202 第2篇计算机系统的硬件结构 执行乘法指令，由于乘法指令执行时间较长，此时CPU不需要访间主存），故I/0设备与CPU不 发生冲突。第二种情况是I/0设备请求DMA传送时，CPU正在访问主存，此时必须待存取周期 结束，CPU才能将总线占有权让出。第三种情况是I/0设备要求访问主存时，CPU也要求访问 主存，这就出现了访间冲突。此刻，I/0访存优先于CPU访问主存，因为I/0不立即访问主存就 可能丢失数据，这时I/0要窃取一两个存取周期，意味着CPU在执行访问主存指令过程中插入 了DMA请求，并挪用了一两个存取周期，使CPU延缓了一两个存取周期再访间主存。图5.46 (b)示意了DMA周期挪用的时间对应关系。 与CPU暂停访存的方式相比，这种方式既实现了I/0传送，又较好地发挥了主存与CPU的 效率，是一种广泛采用的方法。 应该指出，I/0设备每挪用一个主存周期都要申请总线控制权、建立总线控制权和归还总线 控制权。因此，尽管传送一个字对主存而言只占用一个主存周期，但对DMA接口而言，实质上 要占2~5个主存周期（由逻辑线路的延迟特性而定）。因此周期挪用的方法比较适合千I/0设 备的读／写周期大于主存周期的情况。 (3) DMA与CPU交替访间 这种方法适合千CPU的工作周期比主存存取周期长的情况。例如，CPU的工作周期为 1.2 µ,s，主存的存取周期小千0.6µ,s，那么可将一个CPU周期分为C和立两个分周期，其中Cl 专供DMA访存，立专供CPU访存，如图5.46(C)所示。 这种方式不需要总线使用权的申请、建立和归还过程，总线使用权是通过凡和c2分别控制 的。CPU与DMA接口各自有独立的访存地址寄存器、数据寄存器和读／写信号。实际上总线变 成了在凡和立控制下的多路转换器，其总线控制权的转移几乎不需要什么时间，具有很高的 DMA传送速率。在这种工作方式下，CPU既不停止主程序的运行也不进入等待状态，即完成了 DMA的数据传送。当然其相应的硬件逻辑变得更为复杂。 接口的功能和组成 1. DMA接口的功能 利用DMA方式传送数据时，数据的传输过程完全由DMA接口电路控制，故DMA接口又有 DMA控制器之称。DMA接口应具有如下几个功能。 叩向CPU申请DMA传送。 ＠在CPU允许DMA工作时，处理总线控制权的转交，避免因进入DMA工作而影响CPU正 常活动或引起总线竞争。 ＠在DMA期间管理系统总线，控制数据传送。 ＠确定数据传送的起始地址和数据长度，修正数据传送过程中的数据地址和数据长度。 ＠在数据块传送结束时，给出DMA操作完成的信号。"}
{"doc_id": "co", "page": 209, "text": "第5章输入输出系统203  主存工作时间 I  I  CPU控制lI  并使用主存I l  DMA控制匕－DMA不工作 并使用主存lI  CPU不执行程序 DMA工作 r D MA 不工作 (a)停止CPU访问主存 主存工作时间,  I  CPU控制I  并使用主存「－ !  DMA控制l 并使用主存｝ l  (b)周期挪用 主存工作时间 I  I  DMA控制I  并使用主存「一 !  CPU控制I 并使用主存｝ I  |  _____  l 「 [  lll1  __  「 [  — lll11 「 [  __  llll 「 CPU工作周期 Cl  C2  地址和控制总线 数据总线 （写） 数据总线 （读） (c) DMA与CPU交替访问 图5.46DMA的三种传送方式"}
{"doc_id": "co", "page": 210, "text": "204 第2篇计算机系统的硬件结构 2. DMA接口基本组成 最简单的DMA接口组成原理如图5.47所示，它由以下几个逻辑部件组成。 主存 CPU  DMA 控制逻辑 ',',','  口一 7  接． A M D  图5.47简单的DMA接口组成原理图 (1)主存地址寄存器(AR) AR用千存放主存中需要交换数据的地址。在DMA传送数据前，必须通过程序将数据在主 存中的首地址送到主存地址寄存器。在DMA传送过程中，每交换一次数据，将地址寄存器内容 加1，直到一批数据传送完毕为止。 (2)字计数器(WC) WC用于记录传送数据的总字数，通常以交换字数的补码值预置。在DMA传送过程中，每 传送一个字，字计数器加1，直到计数器为0，即最高位产生进位时，表示该批数据传送完毕（若交 换字数以原码值预置，则每传送一个字，字计数器减l，直到计数器为0时，表示该批数据传送结 束）。于是DMA接口向CPU发中断请求信号。 (3)数据缓冲寄存器(BR) BR用于暂存每次传送的数据。通常DMA接口与主存之间采用字传送，而DMA与设备之 间可能是字节或位传送。因此DMA接口中还可能包括有装配或拆卸字信息的硬件逻辑，如数 据移位缓冲寄存器、字节计数器等。 (4) DMA控制逻辑 DMA控制逻辑负责管理DMA的传送过程，由控制电路、时序电路及命令状态控制寄存器等 组成。每当设备准备好一个数据字（或一个字传送结束），就向DMA接口提出申请(DREQ), DMA控制逻辑便向CPU请求DMA服务，发出总线使用权的请求信号(HRQ)。待收到CPU发 出的响应信号HLDA后， DMA控制逻辑便开始负责管理DMA传送的全过程，包括对主存地址寄"}
{"doc_id": "co", "page": 211, "text": "第5章输入输出系统205  存器和字计数器的修改、识别总线地址、指定传送类型（输入或输出）以及通知设备已经被授予 一个DMA周期(DACK)等。 (5)中断机构 当字计数器溢出（全“0”)时，表示一批数据交换完毕，由＂溢出信号“通过中断机构向CPU 提出中断请求，请求CPU作DMA操作的后处理。必须注意，这里的中断与5.5节介绍的1/0中 断的技术相同，但中断的目的不同，前面是为了数据的输入或输出，而这里是为了报告一批数据 传送结束。它们是1/0系统中不同的中断事件。 (6)设备地址寄存器(DAR) DAR存放1/0设备的设备码或表示设备信息存储区的寻址信息，如磁盘数据所在的区号、 盘面号和柱面号。具体内容取决千设备的数据格式和地址的编址方式。 作过 1. DMA传送过程 DMA的数据传送过程分为预处理、数据传送和后处理3个阶段。 (1)预处理 在DMA接口开始工作之前，CPU必须给它预置如下信息。 0给DMA控制逻辑指明数据传送方向是输入（写主存）还是输出（读主存）。 0向DMA设备地址寄存器送入设备号，并启动设备。 ·向DMA主存地址寄存器送入交换数据的主存起始地址。 0对字计数器赋予交换数据的个数。 上述工作由CPU执行几条输入输出指令完成，即程序的初始化阶段。这些工作完成后， CPU继续执行原来的程序，如图5.48(a)所示。 当I/0设备准备好发送的数据（输入）或上次接收的数据已经处理完毕（输出）时，它便通过 DMA接口向CPU提出占用总线的申请，若有多个DMA同时申请，则按轻重缓急由硬件排队判 优逻辑决定优先等。待I/0设备得到主存总线的控制权后，数据的传送便由该DMA接口进 行管理。 (2)数据传送 DMA方式是以数据块为单位传送的，以周期挪用的DMA方式为例，其数据传送的流程如图 5.48 (b)所示。 结合图5.47，以数据输入为例，具体操作如下。 叩当设备准备好一个字时，发出选通信号，将该字读到DMA的数据缓冲寄存器(BR)中，表 示数据缓冲寄存器“满＂（如果I/0设备是面向字符的，则一次读入一个字节，组装成一个字）。 ＠与此同时设备向DMA接口发请求(DREQ)。 @ DMA接口向CPU申请总线控制权(HRQ)。"}
{"doc_id": "co", "page": 212, "text": "206 第2篇计算机系统的硬件结构 CPU  预处理： 主存起始地址一DMA 设备地址---+-DMA 传送数据个数一DMA 启动设备 数据传送： 继续执行主程序 同时完成一批数据的传送 后处理： 中断服务程序 做DMA结束处理 继续执行主程序 (a) DMA传送过程 DMA请求 Y  主存地址送总线 数据送I/0设备（或主存） 修改主存地址 修改字计数器 工— 向CPU申请 程序中断 (b)数据传送阶段的细化 图5.48DMA传送过程示意图 @CPU发回HLDA信号，表示允许将总线控制权交给DMA接口。 ＠将DMA主存地址寄存器中的主存地址送地址总线，并命令存储器写。 ＠通知设备已被授予一个DMA周期(DACK)，并为交换下一个字做准备。 ＠将DMA数据缓冲寄存器的内容送数据总线。 ＠主存将数据总线上的信息写至地址总线指定的存储单元中。 ＠修改主存地址和字计数值。 叨判断数据块是否传送结束，若未结束，则继续传送；若已结束，（字计数器溢出），则向 CPU申请程序中断，标志数据块传送结束。 若为输出数据，则应完成以下操作： 少当DMA数据缓冲寄存器已将输出数据送至I/0设备后，表示数据缓冲寄存器已“空”。 ＠设备向DMA接口发请求(DREQ)。 @DMA接口向CPU申请总线控制权(HRQ)。 @CPU发回HLDA信号，表示允许将总线控制权交给DMA接口使用。 ＠将DMA主存地址寄存器中的主存地址送地址总线，并命令存储器读。 ＠通知设备已被授予一个DMA周期(DACK)，并为交换下一个字做准备。 ＠主存将相应地址单元的内容通过数据总线读入DMA的数据缓冲寄存器中。 ＠将DMA数据缓冲寄存器的内容送到输出设备，若为字符设备，则需将其拆成字符输出。"}
{"doc_id": "co", "page": 213, "text": "第5章输入输出系统207  ＠修改主存地址和字计数值。 叨判断数据块是否已传送完毕，若未完毕，继续传送；若已传送完毕，则向CPU申请程序 中断。 (3)后处理 当DMA的中断请求得到响应后，CPU停止原程序的执行，转去执行中断服务程序，做一些 DMA的结束工作，如图5.48(a)的后处理部分。这包括校验送入主存的数据是否正确；决定是否 继续用DMA传送其他数据块，若继续传送，则又要对DMA接口进行初始化，若不需要传送，则 停止外设；测试在传送过程中是否发生错误，若出错，则转错误诊断及处理错误程序。 例5.3一个DMA接口可采用周期窃取方式把字符传送到存储器，它支持的最大批量为 400个字节。若存取周期为100ns，每处理一次中断需5µs，现有的字符设备的传输率为 9 600 bps。假设字符之间的传输是无间隙的，若忽略预处理所需的时间，试问采用DMA方式每 秒因数据传输需占用处理器多少时间？如果完全采用中断方式，又需占用处理器多少时间？ 解：根据字符设备的传输率为9600 bps，则每秒能传输 9 600/8 = 1 200 B(1 200个字符） 若采用DMA方式，传送1200个字符共需1200个存取周期，考虑到每传400个字符需中断 处理一次，因此DMA方式每秒因数据传输占用处理器的时间是 0.1 µs x 1200 + 5 µs x(l 200/400)= 135 µs  若采用中断方式，每传送一个字符要申请一次中断请求，每秒因数据传输占用处理器的时 间是 5 µs X 1 200 = 6 000 µs  例5.4假设磁盘采用DMA方式与主机交换信息，其传输速率为2MBps，而且DMA的预处 理需1000个时钟周期，DMA完成传送后处理中断需500个时钟周期。如果平均传输的数据长 度为4KB，试问在硬盘工作时，50MHz的处理器需用多少时间比率进行DMA辅助操作（预处理 和后处理）？ 解：DMA传送过程包括预处理、数据传送和后处理3个阶段。传送4KB的数据长度需 (4 KB)/ (2 MBps) = 0.002 s  如果磁盘不断进行传输，每秒所需DMA辅助操作的时钟周期数为 (1 000 + 500) /0.002 = 750 000  故DMA辅助操作占用CPU的时间比率为 [750 000 /(50 X 106)] X100% = 1.5%  2. DMA接口与系统的连接方式 DMA接口与系统的连接方式有两种，如图5.49所示。 图5.49(a)为具有公共请求线的DMA请求方式，若干个DMA接口通过一条公用的DMA请 求线向CPU申请总线控制权。CPU发出响应信号，用链式查询方式通过DMA接口，首先选中的 设备获得总线控制权，即可占用总线与主存传送信息。"}
{"doc_id": "co", "page": 214, "text": "208 第2篇计算机系统的硬件结构 图5.49(b)是独立的DMA请求方式，每一个DMA接口各有一对独立的DMA请求线和 DMA响应线，它由CPU的优先级判别机构裁决首先响应哪个请求，并在响应线上发出响应信 号，被获得响应信号的DMA接口便可控制总线与主存传送数据。 DMA响应 (a)具有公共请求线的DMA请求 I/0总线 DMA请求3 二 DMA响应3 DMA请求2 二 CPU IDMA响应2 (b)独立的DMA请求 数据线 地址线 图5.49DMA接口与系统的连接方式 3. DMA小结 与程序中断方式相比，DMA方式有如下特点。 心从数据传送看，程序中断方式靠程序传送，DMA方式靠硬件传送。 ＠从CPU响应时间看，程序中断方式是在一条指令执行结束时响应，而DMA方式可在指 令周期内的任一存取周期结束时响应。 ＠程序中断方式有处理异常事件的能力，DMA方式没有这种能力，主要用于大批数据的传 送，如硬盘存取、图像处理、高速数据采集系统等，可提高数据吞吐量。 ＠程序中断方式需要中断现行程序，故需保护现场；DMA方式不中断现行程序，无须保护 现场。 @DMA的优先级比程序中断的优先级高。"}
{"doc_id": "co", "page": 215, "text": "第5章输入输出系统 的类型 现代集成电路制造技术已将DMA接口制成芯片，通常有选择型和多路型两类。 1.选择型DMA接口 209  这种类型的DMA接口的基本组成如图5.47所示，它的主要特点是在物理上可连接多个设 备，在逻辑上只允许连接一个设备，即在某一段时间内，DMA接口只能为一个设备服务，关键是 在预处理时将所选设备的设备号送入设备地址寄存器。图5.50是选择型DMA接口的逻辑框 图。选择型DMA接口特别适用千数据传输率很高的设备。 系统总线 DMA接口 字计数器 主存地址寄存器 主存IICPUI |1数据缓冲寄存器II选择线 控制状态寄存器 设备地址寄存器 时序电路 图5.50选择型DMA接口的逻辑框图 2.多路型DMA接口 多路型DMA接口不仅在物理上可以连接多个设备，而且在逻辑上也允许多个设备同时工 作，各个设备采用字节交叉的方式通过DMA接口进行数据传送。在多路型DMA接口中，为每 个与它连接的设备都设置了一套寄存器，分别存放各自的传送参数。图5.5l(a)和(b)分别是链 式多路型DMA接口和独立请求多路型DMA接口的逻辑框图。这类接口特别适合于同时为多 个数据传输率不十分高的设备服务。 图5.52是多路型DMA接口工作原理示意图。图中磁盘、磁带、打印机同时工作。磁盘、磁 带、打印机分别每隔30µs、45µ,s、150µs向DMA接口发DMA请求，磁盘的优先级高于磁带，磁 带的优先级高千打印机。 假设DMA接口完成一次DMA数据传送需5µs，由图5.52可见，打印机首先发请求，故 DMA接口首先为打印机服务(Tl)；接着磁盘、磁带同时又有DMA请求，DMA接口按优先级别先 响应磁盘请求(T2)，再响应磁带请求(T3)，每次DMA传送都是一个字节。这样，在90多微秒的 时间里，DMA接口为打印机服务一次(Tl)，为磁盘服务4次(T心兀、T心兀），为磁带服务3次 (T3、T｀兀）。可见DMA接口还有很多空闲时间，可再容纳更多的设备。"}
{"doc_id": "co", "page": 216, "text": "210 第2篇计算机系统的硬件结构 (a)链式多路型DMA接口 (b)独立请求多路型DMA接口 图5.51多路型DMA接口的逻辑框图 DMA请求DMA请求DMA请求DMA请求 磁盘 1..30 µs _ I | I 歹 t  DMAI_ 请求45 µs DMA请求DMA请求 磁带 DMA请求 打印机I  5 µs  机为打服务印~  望产 倡今带匡匡匡 图5.52多路型DMA接口工作原理示意图 思考题与习题 5.1 I/0设备有哪些编址方式，各有何特点？ 5.2 简要说明CPU与I/0设备之间传递信息可采用哪几种联络方式，它们分别用于什么场合。 5.3 I/0设备与主机交换信息时，共有哪几种控制方式？简述它们的特点。 5.4 试比较程序查询方式、程序中断方式和DMA方式对CPU工作效率的影响。 5.5 图形显示和图像显示有何区别？"}
{"doc_id": "co", "page": 217, "text": "第5章输入输出系统 5.6 字符显示器的接口电路中配有缓冲存储器和只读存储器，各有何作用？ 5.7 试比较针式打印机、激光打印机和喷墨打印机的特点。 211  5.8 某计算机的I/0设备采用异步串行传送方式传送字符信息。字符信息的格式为1位起始位、7位数据 位、1位检验位和1位停止位。若要求每秒钟传送480个字符，那么该设备的数据传送速率为多少？ 5.9 什么是多媒体技术？简要说明研制多媒体计算机的关键技术。 5.10 什么是I/0接口，它与端口有何区别？为什么要设置I/0接口？I/0接口如何分类？ 5.11 简述I/0接口的功能和基本组成。 5.12 结合程序查询方式的接口电路，说明其工作过程。 5.13 说明中断向量地址和入口地址的区别和联系。 5.14 在什么条件下，I/0设备可以向CPU提出中断请求？ 5.15 什么是中断允许触发器？它有何作用？ 5.16 在什么条件和什么时间，CPU可以响应I/0的中断请求？ 5.17 某系统对输入数据进行取样处理，每抽取一个输入数据，CPU就要中断处理一次，将取样的数据存至 存储器的缓冲区中，该中断处理需P秒。此外，缓冲区内每存储N个数据，主程序就要将其取出进行处理，这个 处理需Q秒。试问该系统可以跟踪到每秒多少次中断请求？ 5.18 试以键盘设备为例，结合中断接口电路，说明其工作过程。 5.19 在程序中断方式中，磁盘申请中断的优先级高于打印机。当打印机正在进行打印时，磁盘申请中断 请求。试问是否要将打印机输出停下来，等磁盘操作结束后，打印机输出才能继续进行？为什么？ 5.20 试比较单重中断和多重中断服务程序的处理流程，说明它们不同的原因。 5.21 中断向量通过什么总线送至什么地方？为什么？ 5.22 程序查询方式和程序中断方式都是通过“程序”传送数据，两者的区别是什么？ 5.23 调用中断服务程序和调用子程序有何区别？ 5.24 试分析图5.33所示对多个设备的查询流程，说明这种处理方式存在的问题以及如何改进。 5.25 根据以下要求设计一个产生3个设备向量地址的电路。 (1) 3个设备的优先级按A-+B-+C降序排列。 (2) A、B、C的向量地址分别为110100、010100、000110。 (3)排队器采用链式排队电路。 (4)当CPU发来中断响应信号INTA时，可将向量地址取至CPU。 5.26 什么是多重中断？实现多重中断的必要条件是什么？ 5.27 DMA方式有何特点？什么样的I/0设备与主机交换信息时采用DMA方式，举例说明。 5.28 CPU对DMA请求和中断请求的响应时间是否相同？为什么？ 5.29 结合DMA接口电路说明其工作过程。 5.30 在DMA的工作方式中，CPU暂停方式和周期挪用方式的数据传送流程有何不同，画图说明。 5.31 假设某设备向CPU传送信息的最高频率是40000次／秒，而相应的中断处理程序执行时间为40µs,  试问该外设是否可用程序中断方式与主机交换信息，为什么？ 5.32 设磁盘存储器转速为3000 r/min，分8个扇区，每扇区存储1KB，主存与磁盘存储器数据传送的宽度 为16位（即每次传送16位）。假设一条指令最长执行时间是25µs，是否可采用一条指令执行结束时响应DMA 请求的方案，为什么？若不行，应采取什么方案？"}
{"doc_id": "co", "page": 218, "text": "212 第2篇计算机系统的硬件结构 5.33 试从下面7个方面比较程序查询、程序中断和DMA三种方式的综合性能。 (1)数据传送依赖软件还是硬件。 (2)传送数据的基本单位。 (3)并行性。 (4)主动性。 (5)传输速度。 (6)经济性。 (7)应用对象。 5.34 解释周期挪用，分析周期挪用可能会出现的几种情况。 5.35 试从5个方面比较程序中断方式和DMA方式的区别。 附录SAASCII码 表5.2列出的ASCII码(AmericanStandard Code for Information Interchange,美国信息交换标 准码）是美国信息交换标准委员会制定的7位二进制码，共有128种字符，其中包括32个通用控 制字符、10个十进制数码、52个英文大写与小写字母、34个专用符号（如＄、％、七＝等）。除了 32个控制字符不打印外，其余96个字符全部可以打印。 ASCII码由b7b6凡b4b3h2凡这7个二进制位组成，书写上可用两位十六进制数表示，如“A\" 可用41H表示，“7”可用37H表示。为了提高信息传输的可靠性，通常增加一位凡做校验位，这 样一个字符就可用8位二进制代码表示。 表5.2ASCH码b7b6b5b4b3b2b1 b7b6b5  b4b3h2h1  000 001 010 011 100 101 110 111  0000 NUL DLE SP 。@ p ` p  0 0 0 1 SOH DCl ! 1 A Q a q  0 0 1 0 STX DC2 \" 2 B R h r  0 0 1 1 ETX DC3 # 3 C s C s  0 1 0 0 EOT DC4 $ 4 D T d t  0 1 0 1 ENQ NAK % 5 E u e u  0 1 1 0 ACK SYN & 6 F V f V  0 1 1 1 BEL ETB , 7 G w g w  1 0 0 0 BS CAN ( 8 H X h X  1 0 0 1 HT EM ) 9 I Y 1 . y  1 0 1 0 LF SUB * : J z j z  1 0 1 1 VT ESC + , . K [ k {"}
{"doc_id": "co", "page": 219, "text": "第5章输入输出系统213  续表 b7b6b5  b4b3b2b1  000 001 010 011 100 101 110 111  1 1 0 0 FF FS , < L / 1 I  1 1 0 1 CR GS = M ] m }  1 1 1 0 so RS > N f n ~  1 1 1 1 SI VS / ? 。。DEL  注： NUL 空行VT 纵向制表SYN 同步空转 SOH 标题开始FF 改换格式ETB 信息组传送结束 STX 文件开始CR 回车CAN 作废 ETX 文件结束so 移出EM 记录媒体结束 EOT 传送结束SI 移入SUB 代替 ENQ 询问DEL 删除ESC 脱离 ACK 回答DCI 设备控制lFS 字段分隔 BEL 报警DC2 设备控制2GS 字组分隔 LF 换行NAK 否定回答 用ASCII码可方便地表示十进制数串。十进制数串在计算机内主要有两种表示形式：非压 缩型和压缩型。 (1)非压缩型 非压缩型的十进制数每一个字符占一个字节，又根据符号位的不同位置，将其分为前分隔式 和后嵌入式两种。 前分隔式的符号位占一个字节，并且放在数字位之前，用2B(即字符”+＂的ASCII码）表 示正号，用2D(即字符”-\"的ASCII码）表示负号。每个十进制位均用对应的ASCII码表示， 例如： +427 表示为2B 34 32 37  -427 表示为2D 34 32 37  后嵌入式的符号位不占一个字节，而是将符号嵌入最低一位数字中，其规则是：如果是负数， 就将最低位十进制数的ASCII码加上40H；如果是正数则不变。例如： +427 表示为34 32 37  -427 表示为34 32 77  可见最低一个字节既表示数值，又表示符号。 用非压缩型表示的十进制数进行算术运算很不方便，因为每个字节占8位，只有其低4位的 值才表示数值，高4位值在算术运算时无数值意义，这种表示主要用于非数值计算的有关领 域中。"}
{"doc_id": "co", "page": 220, "text": "214 第2篇计算机系统的硬件结构 (2)压缩型 如果采用一个字节存放两个十进制的数位，就成了压缩型的十进制数。这种方式比非压缩 型节省了存储空间，又便于完成十进制数的算术运算。压缩型十进制数的每个数位可用数字符 ASCII码的低4位表示，或用BCD码表示。 附 码 BCD (Binary Coded Decimal)码又称二－十编码，它用4位二进制代码表示一位十进制数。最 常见的BCD码是8421码，又称NBCD(Natural Binary Coded Decimal)码。由于8421码每位的权 与二进制数完全相同，而4位二进制代码共有16种组合，因此1010~1111这6种代码是无效的。 NBCD码与十进制数的对应关系如表5.3所示。 表5.38421码与十进制数对照表 十进制数8421码8421奇校验码8421偶校验码 。0000 1 0 0 0 0 00000  1 0 0 0 1 0 0 0 0 1 1 0 0 0 1  2 0 0 1 0 0 0 0 1 0 1 0 0 1 0  3 0 0 1 1 1 0 0 1 1 0 0 0 1 1  4 0 1 0 0 0 0 1 0 0 1 0 1 0 0  5 0 1 0 1 1 0 1 0 1 0 0 101  6 0 1 1 0 1 0 1 1 0 0 0 1 1 0  7 0 1 1 1 0 0 1 1 1 1 0 1 1 1  8 1000 0 1 0 0 0 1 1 0 0 0  9 1 0 0 1 1 1 0 0 1 0 1 0 0 1  采用BCD码所表示的十进制数，再用十六进制数C表示“+”号，用十六进制数D表示“-“ 号，而且均放在数字串的最后，就可表示有符号的十进制数。例如： +427 表示为0100 0010 0111 1100  -427 表示为0100 0010 0111 1101  当十进制数串为偶数时，在第一个字节的高4位补“0\"，即 +42 表示为 -42 表示为 0000 0100 0010 1100  0000 0100 0010 1101"}
{"doc_id": "co", "page": 221, "text": "第5章输入输出系统215  附录5C奇偶校检码 为了校验编码的正确性，在被传送的n位代码上增加一位检验位，并使其配置后的n+l位 代码中“1\"的个数为奇数，则称其为奇校验；若配置后“l”的个数为偶数，则称其为偶校验。例 如，在十进制数的8421码的前面加上一位校验位，组成5位代码，若5位二进制代码配置结果 “1\"的个数为奇数，就称为奇校验码；若配置结果”1”的个数为偶数，就称为偶校验码，如表5.3 所示。对表中奇校验码而言，倘若传送过程中5位代码中“1”的个数不为奇数，则表明传送出 错，可见奇校验码具有检错能力。同理，偶校验码也具有检错能力。 奇偶校验码通常用于I/0设备，例如，键盘输入时使用ASCII码，再配一位校验位，组成8位 的奇偶校验码，正好占一个字节。在传送过程中如果出现一位错，便能检测出来，但由于不知出 错位的位置，故无法纠错。此外，一旦传送过程中出现两位错，奇偶性不变，也无法判断是否 出错。"}
{"doc_id": "co", "page": 223, "text": "以上各章节基本上把CPU看作一个“黑匣子”，并且分析了它通过总线与存 储器和1/0部件之间的相互关系。本篇将剖析其内部结构，讲述CPU的功能，包 括计算机的运算、指令系统、指令流水、时序系统、中断系统及控制单元。除时序 系统和控制单元将在笫4篇单独讲述外，其余部分均在此篇介绍。"}
{"doc_id": "co", "page": 225, "text": "计算机的应用领域极其广泛，但不论其应用在什么地方，信息在机器内部的形式都是一致 的，即均为0和1组成的各种编码。本章主要介绍参与运算的各类数据（包括无符号数和有符号 数、定点数和浮点数等），以及它们在计算机中的算术运算方法。使读者进一步认识到计算机在 自动解题过程中数据信息的加工处理流程，从而进一步加深对计算机硬件组成及整机工作原理 的理解。有关逻辑运算以及计算机中采用的各种进位制均在前修课中介绍过，本章只在附录中 给出了各种进位制及其相互转换的关系（可参阅附录6A)。至千计算机中的字符编码以及校验 码，读者可分别参阅本书附录5A、附录5B、附录5C、4.2.6节和4.4.6节等。 6.1 无符号数和有符号数 在计算机中参与运算的数有两大类：无符号数和有符号数。 计算机中的数均放在寄存器中，通常称寄存器的位数为机器字长。所谓无符号数，即没有符 号的数，在寄存器中的每一位均可用来存放数值。当存放有符号数时，则需留出位置存放符号。 因此，在机器字长相同时，无符号数与有符号数所对应的数值范围是不同的。以机器字长为16 位为例，无符号数的表示范围为0~65535，而有符号数的表示范围为－32768 ~ +32 767（此数值 对应补码表示，详见6.1.2节）。 1.机器数与真值 对有符号数而言，符号的“正”“负“机器是无法识别的，但由千“正”“负＂恰好是两种截然不 同的状态，如果用“0”表示“正＂，用“l”表示“负＂，这样符号也被数字化了，并且规定将它放在有 效数字的前面，即组成了有符号数。 例如，有符号数（小数）:"}
{"doc_id": "co", "page": 226, "text": "220 第3篇中央处理器 + 0. 1011 在机器中表示为耳严 小数点位置 -0.1011 在机器中表示为匡尸严 小数点位置 又如，有符号数（整数）： +1100 在机器中表示为匠巨亘芞 小数点位置 -1100 在机器中表示为匡巨亘芞 小数点位置 把符号“数字化”的数称为机器数，而把带”+”或“-”符号的数称为真值。一旦符号数字化 后，符号和数值就形成了一种新的编码。在运算过程中，符号位能否和数值部分一起参加运算？ 如果参加运算，符号位又需作哪些处理？这些问题都与符号位和数值位所构成的编码有关，这些 编码就是原码、补码、反码和移码。 2.原码表示法 原码是机器数中最简单的一种表示形式，符号位为0表示正数，符号位为1表示负数，数值 位即真值的绝对值，故原码表示又称为带符号的绝对值表示。上面列举的4个真值所对应的机 器数即为原码。为了书写方便以及区别整数和小数，约定整数的符号位与数值位之间用逗号隔 开；小数的符号位与数值位之间用小数点隔开。例如，上面4个数的原码分别是0.1011、1.1011、 0, 1100和1,1100。由此可得原码的定义。 整数原码的定义为 [x]原＝广'-xx 式中，x为真值，n为整数的位数。 例如： x=+lllO时，［x]原＝0,1110  2n>x;;::O  O;;::x>-2n  当x=-1110时，［x压＝24-(-1110)=1,1110  t  用逗号将符号位和数值部分隔开 小数原码的定义为 [x压＝｛ 式中，x为真值。 例如： 当x=0.1101时，［x]原＝0.1101 X  1-x  l>x~O  O~x>-l"}
{"doc_id": "co", "page": 227, "text": "第6章计算机的运算方法 当x=-0.1101时，［x]原＝1-(-0.1101)=1.1101  根据定义，已知真值可求原码，反之已知原码也可求真值。例如： 当[x归＝1.0011时，由定义得 x=l-[x]原＝1-1.0011=-0.0011 当[x压＝1,1100时，由定义得 x=2n-[x]原＝24 -1, 1100 = 10000-11100 = -1100  当[x]原＝0.1101时，x=0.1101 当x=O时 [ +0.0000]原＝0.0000 [ -0.0000]原＝1-(0. 0000) = 1. 0000  可见[+0压不等千[-0]原，即原码中的“零”有两种表示形式。 221  原码表示简单明了，并易于和真值转换。但用原码进行加减运算时，却带来了许多麻烦。例 如，当两个操作数符号不同且要做加法运算时，先要判断两数绝对值大小，然后将绝对值大的数 减去绝对值小的数，结果的符号以绝对值大的数为准。运算步骤既复杂又费时，而且本来是加法 运算却要用减法器实现。那么能否在计算机中只设加法器，只做加法操作呢？如果能找到一个 与负数等价的正数来代替该负数，就可把减法操作用加法代替。而机器数采用补码时，就能满足 此要求。 3.补码表示法 (1)补数的概念 在日常生活中，常会遇到“补数”的概念。例如，时钟指示6点，欲使它指示3点，既可按顺 时针方向将分针转9圈，又可按逆时针方向将分针转3圈，结果是一致的。假设顺时针方向转为 正，逆时针方向转为负，则有 6 6  -3 + 9  3 15  由千时钟的时针转一圈能指示12个小时，这“12”在时钟里是不被显示而自动丢失的，即 15-12=3，故15点和3点均显示3点。这样－3和＋9对时钟而言其作用是一致的。在数学上称 12为模，写作mod12，而称＋9是－3以12为模的补数，记作 -3=+9 (mod 12)  或者说，对模12而言，－3和＋9是互为补数的。同理有 -4=+8 (mod 12)  -5 = + 7 (mod 12)  即对模12而言，＋8和＋7分别是－4和－5的补数。可见，只要确定了“模\",就可找到一个与 负数等价的正数（该正数即为负数的补数）来代替此负数，这样就可把减法运算用加法实现。 例如："}
{"doc_id": "co", "page": 228, "text": "222  设A=9,B=5，求A-B(mod12)。 解： 第3篇中央处理器 A-B=9-5=4 （作减法） 对模12而言，－5可以用其补数＋7代替，即 -5圭＋7(mod 12)  所以A-B=9+7=16 （作加法） 对模12而言，12会自动丢失，所以16等价于4，即4=16(mod 12)。 进一步分析发现，3点、15点、27点……在时钟上看见的都是3点，即 3= 15兰27(mod 12)  也即3三3+12圭3+24=3(mod 12)  这说明正数相对于“模＂的补数就是正数本身。 上述补数的概念可以用到任意“模”上，如 -3三＋7(mod 10)  +7圭＋7(mod 10)  -3三＋97(mod 10勹 +97 == +97 (mod 10勹 -1011圭＋0101(mod 2勹 +0101三＋0101(mod 2勹 -0.1001圭＋1.0111(mod 2)  +0.1001 = +0.1001 (mod 2)  由此可得如下结论。 ·一个负数可用它的正补数来代替，而这个正补数可以用模加上负数本身求得。 ·一个正数和一个负数互为补数时，它们绝对值之和即为模数。 ·正数的补数即该正数本身。 将补数的概念用到计算机中，便出现了补码这种机器数。 (2)补码的定义 整数补码的定义为 O,x  [x]补＝｛厂＋x 2n>x~O  O>x~ -2n (mod 2n+I)  式中，x为真值，n为整数的位数。 例如： 当x=+lOlO时， [x]补＝0,1010  f  用逗号将符号位和数值部分隔开"}
{"doc_id": "co", "page": 229, "text": "第6章计算机的运算方法223  当x=-1101时， [x]补＝2n+1+x=100000-1101= 1,0011  f  用逗号将符号位和数值部分隔开 小数补码的定义为 [ ]  X 1>彦0 x补＝｛2＋x0>x>－1(mod2)  式中，x为真值。 例如： 当x=0.1001时， [x]补＝0.1001 当X= -0.0110时， [x]补＝2+x= 10.0000 -0.0110 = 1.1010  当x=O时， [ +0.0000]补＝0.0000 [ -0.0000]补＝2+(-0.0000)= 10.0000 -0.0000=0.0000  显然[+0压＝［－0]*~ = 0.0000，即补码中的“零“只有一种表示形式。 对千小数，若x=-1，则根据小数补码定义，有[x压＝2+x=10.0000 -1.0000= 1.0000。可见， -1本不属千小数范围，但却有[-1]补存在（其实在小数补码定义中已指明），这是由于补码中的 零只有一种表示形式，故它比原码能多表示一个\"-l”。此外，根据补码定义，已知补码还可以求 真值，例如： 若[x]补＝1.0101 则则 x= [x]补－2= 1.0101 -10. 0000 = -0. 1011  若[x压＝1,1110  若[x]补＝0.1101 X = [ X]补－24+1= 1'1110 -100000 = -0010  则x=[x]补＝0.1101 同理，当模数为4时，形成了双符号位的补码。如X= -0.1001，对（mod2勹而言 [x]补＝22+x=100.0000 -0.1001 = 11.0111  这种双符号位的补码又称为变形补码，它在阶码运算和溢出判断中有其特殊作用，后面有关 章节中将详细介绍。 由上讨论可知，引入补码的概念是为了消除减法运算，但是根据补码的定义，在形成补码的 过程中又出现了减法。例如： x=-1011  [x]补＝24+1+x=100000 -1011 = 1,0101 (6.1)"}
{"doc_id": "co", "page": 230, "text": "224 第3篇中央处理器 若把模24+1改写成25= 100000 = 11111 +00001时，则式(6.1)可写成 [x]补＝25+x=lllll+OOOOl+x (6.2)  又因x是负数，若x用－X1X2X3X4表示，其中x;(i=l,2,3,4)不为0则为1，千是式(6.2)可 写成 [x]补＝25+x=lllll+00001-x1x产凸 = 1 x x x 1 2 3 X, +00001 4  因为任一位”1“减去x,即为豆！，所以式(6.3)成立。 (6.3)  由于负数－X1X产贷4的原码为1,x心产抖4，因此对这个负数求补，可以看作对它的原码除符号 位外，每位求反，末位加1，简称“求反加1”。这样，由真值通过原码求补码就可避免减法运算。 同理，对于小数也有同样的结论，读者可以自行证明。 ”由原码除符号位外，每位求反，末位加1求补码”这一规则同样适用于由[x片求[x]原。而 对于一个负数，若对其原码除符号位外，每位求反（简称“每位求反”)，或是对其补码减去末位的 1，即得机器数的反码。 4.反码表示法 反码通常用来作为由原码求补码或者由补码求原码的中间过渡。反码的定义如下： 整数反码的定义为 [x]反＝｛勹＋1-1)+x  式中，x为真值，n为整数的位数。 例如： 当x=+llOl时， [x]反＝0,1101 f  用逗号将符号位和数值部分隔开 当x=-1101时， 2n>x~O  O~x>-2n  [x]反＝(24+1 -1) +x = 11111-1101 = 1, 0010  t  (mod(2n+I_l))  用逗号将符号位和数值部分隔开 小数反码的定义为 X  [x]反＝｛（2-r\")+x 0艺x>-1 l>x~O  (mod(2-2勹） 式中，x为真值，n为小数的位数。 例如： 当x=+0.0110时，"}
{"doc_id": "co", "page": 231, "text": "(  第6章计算机的运算方法 [x]反＝0.0110 当X= -0.0110时， [x]反＝(2-2-4) +x = 1.1111 -0. 0110 = 1.1001  当x=O时， [ +0.0000]反＝0.0000 [ -0.0000]反＝(10.0000 -0.0001) -0.0000= 1.1111  可见[+0压不等于[-0]反，即反码中的“零”也有两种表示形式。 225  实际上，反码也可看作是mod(2-2勹（对千小数）或mod(2n+l_l)（对于整数）的补码。与补 码相比，仅在末位差l，因此有些书上称小数的补码为2的补码，而称小数的反码为1的补码。 综上所述，三种机器数的特点可归纳如下： ·三种机器数的最高位均为符号位。符号位和数值部分之间可用“.\"（对千小数）或“,＂（对 于整数）隔开。 0当真值为正时，原码、补码和反码的表示形式均相同，即符号位用“0”表示，数值部分与真 值相同。 0当真值为负时，原码、补码和反码的表示形式不同，但其符号位都用“1”表示，而数值部分 有这样的关系，即补码是原码的“求反加1”，反码是原码的“每位求反”。 下面通过实例来进一步理解和掌握三种机器数的表示。 例6.1设机器数字长为8位（其中1位为符号位），对千整数，当其分别代表无符号数、原 码、补码和反码时，对应的真值范围各为多少？ 解：表6.1列出了8位寄存器中所有二进制代码组合与无符号数、原码、补码和反码所代表 的真值的对应关系。 表6.1例6.1对应的真值范围 二进制代码 无符号数原码对应补码对应反码对应 对应的真值的真值的真值的真值 00000000 。+0 土0+0  00000001 1 +l +1 +l  00000010 2 +2 +2 +2  :  0 1 1 1 1 1 1 0 126 +126 +126 +126  0 1 1 1 1 1 1 1 127 +127 +127 +127  10000000 128 -0 -128 -127  10000001 129 -1 -127 -126  10000010 130 -2 -l26 -125  1 1 1 1 1 1 0 1 253 -125 -3 -2  1 1 1 1 1 1 1 0 254 -126 -2 -1  1 1 1 1 1 1 1 1 255 127 -1 -0"}
{"doc_id": "co", "page": 232, "text": "226 第3篇中央处理器 由此可得出一个结论：由于“零”在补码中只有一种表示形式，故补码比原码和反码可以多 表示一个负数。 例6.2已知[y]补，求[-y]沪 解：设[y]补＝y。.兀Y2…Yn 第一种情况[y]补＝O,Y1Y2\"'Yn 所以y= O,Y1Y2'\"Y,.  故－y=-O·Y1Y2…y,'  (6.4)  则[ -y]补＝1．仇兄...兄＋2一\"(6.5)  比较式(6.4)和式(6.5)，发现由[y]补连同符号位在内每位取反，末位加1，即可得[-y]贮 第二种情况[y压＝Lr1Y2'\"Y,.(6.6)  所以[y]原＝1．仇兄...兄＋2－n 得y=-(0元兄..无＋2-n) 故－y=O元元...兄＋2-n 则[ -y]补＝0．仇兄..无＋2-\"(6.7)  比较式(6.6)、式(6.7)，发现由［y压连同符号位在内每位取反，末位加1，即可得[-y]贮 可见，不论真值是正（第一种情况）或负（第二种情况），由[y压求［－y压都是采用“连同符 号位在内，每位取反，末位加1”的规则。这一结论在补码减法运算时将经常用到（详见6.3节有 关内容）。 有符号数在计算机中除了用原码、补码和反码表示外，在一些通用计算机中还用另一种机器 数——移码表示，由于一些突出的优点，目前它巳被广泛采用。 5.移码表示法 当真值用补码表示时，由千符号位和数值部分一起编码，与习惯上的表示法不同，因此人们 很难从补码的形式上直接判断其真值的大小，例如： 十进制数x=2l，对应的二进制数为＋10101，则［x］补＝0,10101 十进制数x=-21，对应的二进制数为－10101，则［x］补＝1,01011 十进制数x=31，对应的二进制数为＋11111，则［X] f~ = 0, 11111  十进制数x=-31，对应的二进制数为－11111，则［x］补＝1,00001 上述补码表示中的\",“在计算机内部是不存在的，因此，从代码形式看，符号位也是一位二 进制数。按这6位二进制代码比较大小的话，会得出101011>010101, 100001>011111，其实恰恰 相反。 如果对每个真值加上一个2n(n为整数的位数），情况就发生了变化。例如： X = 10101加上25可得10101+ 100000 = 110101  x=-10101加上25可得－10101+ 1000_00 = 001011  x=lllll加上25可得11111+ 100000 = 111111"}
{"doc_id": "co", "page": 233, "text": "第6章计算机的运算方法227  x=-11111加上25可得－11111+ 100000 = 000001  比较它们的结果可见，110101>001011, 111111 >000001。这样一来，从6位代码本身就可看 出真值的实际大小。 由此可得移码的定义 [x]移＝2n+x(2n>x;:::-2n)  式中，x为真值，n为整数的位数。 其实移码就是在真值上加一个常数2n。在数轴上移码所表示的范围恰好对应于真值在数 轴上的范围向轴的正方向移动2n个单元，如图6.1所示，由此而得移码之称。 0 2n 2n+1_ 1  [x]移码 一2nO 2n-1  真值 图6.1移码在数轴上的表示 例如：X= 10100  [x]移＝25+ 10100 = 1, 10100  用逗号将符号位和数值部分隔开 X = -10100  [x]移＝25 -10100 = 0, 01100  用逗号将符号位和数值部分隔开 当x=O时 [ +0]移＝25 + 0 = 1, 00000  [ -0]移＝25 -0 = 1'00000  可见[+0压等千[-0]移，即移码表示中零也是唯一的。 此外，由移码的定义可见，当n= 5时，其最小的真值为X= -2 5 = -100000,则 [ -100000]移＝25+x = 100000 -100000 = 0, 00000，即最小真值的移码为全0，这符合人们的习 惯。利用移码的这一特点，当浮点数的阶码用移码表示时，就能很方便地判断阶码的大小（详 见6.2.4节）。 进一步观察发现，同一个真值的移码和补码仅差一个符号位，若将补码的符号位由“0”改 为“1\"，或从“1”改为“0\"，即可得该真值的移码。表6.2列出了真值、补码和移码的对应 关系。"}
{"doc_id": "co", "page": 234, "text": "228 第3篇中央处理器 表6.2真值、补码和移码对照表 真值x[x]补[x]移 ［尤压对应的 十进制整数 -100000 100000 000000 。 -11111 1 0 0 0 0 1 000001 1  -11110 1 0 0 0 1 0 000010 2  -00001 1l'l11 1 0 1 1 1 1 1 31  土00000000000 100000 32  +00001 000001 1 0 0 0 0 1 33  +00010 000010 1 0 0 0 1 0 34  +11110 011110 1 1 1 1 1 0 62  +11111 0 1 1 1 1 1 1 1 1 1 1 1 63  6.2 数的定点表示和浮点表示 在计算机中，小数点不用专门的器件表示，而是按约定的方式标出，共有两种方法表示小数 点的存在，即定点表示和浮点表示。定点表示的数称为定点数，浮点表示的数称为浮点数。 定点表不 小数点固定在某一位置的数为定点数，有以下两种格式。 言［三已 小数点位置小数点位置 当小数点位于数符和第一数值位之间时，机器内的数为纯小数；当小数点位于数值位之后 时，机器内的数为纯整数。采用定点数的机器称为定点机。数值部分的位数n决定了定点机中 数的表示范围。若机器数采用原码，小数定点机中数的表示范围是－（1-2-n)~ (1-2-n,)，整数定 点机中数的表示范围是－（2n-1) ~ (2n -1)。 在定点机中，由千小数点的位置固定不变，故当机器处理的数不是纯小数或纯整数时，必须 乘上一个比例因子，否则会产生＂溢出”。"}
{"doc_id": "co", "page": 235, "text": "第6章计算机的运算方法229  实际上计算机中处理的数不一定是纯小数或纯整数（如圆周率3.1416)，而且有些数据的数 值范围相差很大（如电子的质量9X10-28 g，太阳的质量2xl033g)，它们都不能直接用定点小数或 定点整数表示，但均可用浮点数表示。浮点数即小数点的位置可以浮动的数，如 352.47 = 3. 5247X 102  = 3524. 7X 10-1  =0.35247Xl03  显然，这里小数点的位置是变化的，但因为分别乘上了不同的10的方幕，故值不变。 通常，浮点数被表示成 N=SXr1  式中，S为尾数（可正可负），j为阶码（可正可负），r是基数（或基值）。在计算机中，基数可取2, 4、8或16等。 以基数r=2为例，数N可写成下列不同的形式： N = 11.0101  =0.110101x210  = 1.10101 X21  = 1101.0lx2-10  = 0.00110101 x2100  为了提高数据精度以及便于浮点数的比较，在计算机中规定浮点数的尾数用纯小数形式，故 上例中o.110101x210和0.00110101 X2100形式是可以采用的。此外，将尾数最高位为1的浮点数 称为规格化数，即N=0.110101x210为浮点数的规格化形式。浮点数表示成规格化形式后，其精 度最高。 1.浮点数的表示形式 浮点数在机器中的形式如下所示。采用这种数据格式的机器称为浮点机。 j s  jlj2...jIII sf S1S2…Sn  `  数阶值码、Y部的分胄数尾值数Y部的分 小数点位置 浮点数由阶码j和尾数S两部分组成。阶码是整数，阶符和阶码的位数m合起来反映浮点 数的表示范围及小数点的实际位置；尾数是小数，其位数n反映了浮点数的精度；尾数的符号sf"}
{"doc_id": "co", "page": 236, "text": "230 第3篇中央处理器 代表浮点数的正负。 2.浮点数的表示范围 以通式N=SX尸为例，设浮点数阶码的数值位取m位，尾数的数值位取n位，当浮点数为非 规格化数时，它在数轴上的表示范围如图6.2所示。 负数区1下溢I正数区 -2(2”'一l)x(11-2-n)I.1 2<2m一l)X(l-2一\") -2一(2\"，一l)X2一112一(2m一l)X2一11 图6.2浮点数在数轴上的表示范围 由图中可见，其最大正数为2(2'\"-l)X (1 -2-n)；最小正数为2-c2m-1)X 2-n;最大负数为 -2-(2m-1) x2飞最小负数为－2c2m-1)x(1-2-n)。当浮点数阶码大于最大阶码时，称为上溢，此时机 器停止运算，进行中断溢出处理；当浮点数阶码小千最小阶码时，称为下溢，此时溢出的数绝对值 很小，通常将尾数各位强置为零，按机器零处理，此时机器可以继续运行。 一旦浮点数的位数确定后，合理分配阶码和尾数的位数，直接影响浮点数的表示范围和精 度。通常对于短实数（总位数为32位），阶码取8位（含阶符1位），尾数取24位（含数符1位）； 对于长实数（总位数为64位），阶码取11位（含阶符1位），尾数取53位（含数符l位）；对千临 时实数（总位数为80位），阶码取15位（含阶符1位），尾数取65位（含数符1位）。 3.浮点数的规格化 为了提高浮点数的精度，其尾数必须为规格化数。如果不是规格化数，就要通过修改阶码并 同时左右移尾数的办法，使其变成规格化数。将非规格化数转换成规格化数的过程称为规格化。 对千基数不同的浮点数，因其规格化数的形式不同，规格化过程也不同。 当基数为2时，尾数最高位为1的数为规格化数。规格化时，尾数左移一位，阶码减1（这种 规格化称为向左规格化，简称左规）；尾数右移一位，阶码加1（这种规格化称为向右规格化，简 称右规）。图6.2所示的浮点数规格化后，其最大正数为2c2m-1)X (1 -2-n)，最小正数为 2-(2m-l) X2-1；最大负数为－2－（沪－l）X2-1，最小负数为－2c2m-1) X (1-2-n)。 当基数为4时，尾数的最高两位不全为零的数为规格化数。规格化时，尾数左移两位，阶码 减l；尾数右移两位，阶码加1。 当基数为8时，尾数的最高三位不全为零的数为规格化数。规格化时，尾数左移三位，阶码 减l；尾数右移三位，阶码加1。 同理类推，不难得到基数为16或2n时的规格化过程。 浮点机中一旦基数确定后就不再变了，而且基数是隐含的，故不同基数的浮点数表示形式完 全相同。但基数不同，对数的表示范围和精度等都有影响。一般来说，基数r越大，可表示的浮 点数范围越大，而且所表示的数的个数越多。但r越大，浮点数的精度反而下降。如r=16的浮"}
{"doc_id": "co", "page": 237, "text": "第6章计算机的运算方法231  点数，因其规格化数的尾数最高三位可能出现零，故与其尾数位数相同的r=2的浮点数相比，后 者可能比前者多三位精度。 定点数和浮点数可从如下几个方面进行比较。 心当浮点机和定点机中数的位数相同时，浮点数的表示范围比定点数的大得多。 ＠当浮点数为规格化数时，其相对精度远比定点数高。 ＠浮点数运算要分阶码部分和尾数部分，而且运算结果都要求规格化，故浮点运算步骤比 定点运算步骤多运算速度比定点运算的低运算线路比定点运算的复杂。 ＠在溢出的判断方法上，浮点数是对规格化数的阶码进行判断，而定点数是对数值本身进行 判断。例如，小数定点机中的数，其绝对值必须小于1，否则＂溢出＂，此时要求机器停止运算，进行 处理。为了防止溢出，上机前必须选择比例因子，这个工作比较麻烦，给编程带来不便。而浮点数 的表示范围远比定点数大，仅当“上溢”时机器才停止运算，故一般不必考虑比例因子的选择。 总之，浮点数在数的表示范围、数的精度、溢出处理和程序编程方面（不取比例因子）均优于 定点数。但在运算规则、运算速度及硬件成本方面又不如定点数。因此，究竟选用定点数还是浮 点数，应根据具体应用综合考虑。一般来说，通用的大型计算机大多采用浮点数，或同时采用定、 浮点数；小型、微型及某些专用机、控制机则大多采用定点数。当需要做浮点运算时，可通过软件 实现，也可外加浮点扩展硬件（如协处理器）来实现。 例6.3设浮点数字长16位，其中阶码5位（含1位阶符），尾数11位（含1位数符），将十 13  进制数＋——写成二进制定点数和浮点数，并分别写出它在定点机和浮点机中的机器数形式。 128  13  解：令x=＋—— 128  其二进制形式X = 0.0001101000  定点数表示X = 0.0001101000  浮点数规格化表示X = 0. 1101000000 X 2 -l l  定点机中[x]原＝［x压＝［x］反＝0.0001101000 浮点机中 [x]原：1 1 |0011 || o 1 ll01000000 1或写成1,0011;0. 1101000000  [x]补：I 1 | ll01 || o | llOlOOOOOO 1或写成1,1101;0.1101000000  [x]反：I 1 | 1100 || o | 1101000000 1或写成1,1100 ;0. 1101000000"}
{"doc_id": "co", "page": 238, "text": "232 第3篇中央处理器 例6.4将十进制数－54表示成二进制定点数和浮点数，并写出它在定点机和浮点机中的机 器数形式（其他要求同上例）。 解：令x=-54 其二进制形式 定点数表示 浮点数规格化表示 定点机中 浮点机中 x=-110110  X = -0000110110  X = -(0.1101100000) X2 llO  [x]原＝1,0000110110  [x压＝1,1111001010 [x]反＝1,1111001001 [x压＝0,0110; 1.1101100000  [x]补＝0,0110; 1.0010100000  [x]反＝0,0110; 1.0010011111  例6.5写出对应图6.2所示的浮点数的补码形式。设图中n=l0,m=4，阶符、数符各取 1位。 解：真值补码 最大正数 最小正数 最大负数 21sx(1-2-10)  2-15X2-10  -2-15X2-lO  0, 1111 ; 0. 1111111111  1,0001; 0.0000000001  1, 0001 ; 1. 1111111111  最小负数-2 15 X (1-2-10) 0. 1111 : 1.0000000001  计算机中浮点数的阶码和尾数可以采用同一种机器数表示，也可采用不同的机器数表示。 例6.6设浮点数字长为16位，其中阶码为5位（含1位阶符），尾数为11位（含1位数 53  符），写出－—－对应的浮点规格化数的原码、补码、反码和阶码用移码，尾数用补码的形式。512  53  解：设x=－—-＝-0.000110101= 2-ll X (-0.1101010000) 512  [x]原＝1,0011; 1.1101010000  [x]补＝1,1101 ; 1. 0010110000  [x]反＝1,1100 ; 1.0010101111  [x]阶移，尾补＝0,1101; 1.0010110000  值得注意的是，当一个浮点数尾数为0时，不论其阶码为何值；或阶码等于或小千它所能表 示的最小数时，不管其尾数为何值，机器都把该浮点数作为零看待，并称之为“机器零＂。如果浮 点数的阶码用移码表示，尾数用补码表示，则当阶码为它所能表示的最小数2-m（式中m为阶码 的位数）且尾数为0时，其阶码（移码）全为0，尾数（补码）也全为0，这样的机器零为000…0000,"}
{"doc_id": "co", "page": 239, "text": "第6章计算机的 法 233  全零表示有利千简化机器中判“0“电路。 标 现代计算机中，浮点数一般采用IEEE制定的国际标准，这种标准形式如下： 叩尾数 数符小数点位置 按IEEE标准，常用的浮点数有三种： 符号位S阶码尾数总位数 短实数1 8 23 32  长实数1 11 52 64  临时实数15 64 80  其中，S为数符，它表示浮点数的正负，但与其有效位（尾数）是分开的。阶码用移码表示，阶码的 真值都被加上一个常数（偏移量），如短实数、长实数和临时实数的偏移量用十六进制数表示分 别为7FH、3FFH和3FFFH（见附录6A.1)。尾数部分通常都是规格化表示，即非“0”的有效位最 高位总是“1”，但在IEEE标准中，有效位呈如下形式。 1. ffff · · · · · ·fff  其中人表示假想的二进制小数点。在实际表示中，对短实数和长实数，这个整数位的1省略，称 隐藏位；对千临时实数不采用隐藏位方案。表6.3列出了十进制数178.125的实数表示。 表6.3实数178.125的几种不同表示 实数表示 原始十进制数 一进制数 一进制浮点表示 数值 178.125  10110010.001  1.0110010001 x2111  短实数表示 符号_ 偏移的阶码 00000111+01111111  = 10000110  _  有效值 01100100010000000000000  勹＾（隐含的）"}
{"doc_id": "co", "page": 240, "text": "234 第3篇中央处理器 3 定点运算 定点运算包括移位、加、减、乘、除几种。 1.移位的意义 移位运算在日常生活中常见。例如，15m可写成1500 cm，单就数字而言，1500相当于数 15相对于小数点左移了两位，并在小数点前面添了两个0；同样15也相当千1500相对千小数 点右移了两位，并删去了小数点后面的两个0。可见，当某个十进制数相对千小数点左移n位 时，相当于该数乘以10飞右移n位时，相当于该数除以lOn0  计算机中小数点的位置是事先约定的，因此，二进制表示的机器数在相对于小数点作n位左 移或右移时，其实质就是该数乘以或除以2n(n=l,2,…,n)。 移位运算称为移位操作，对计算机来说，有很大的实用价值。例如，当某计算机没有乘（除） 法运算线路时，可以采用移位和加法相结合，实现乘（除）运算。 计算机中机器数的字长往往是固定的，当机器数左移n位或右移n位时，必然会使其n位低 位或n位高位出现空位。那么，对空出的空位应该添补0还是1呢？这与机器数采用有符号数 还是无符号数有关。对有符号数的移位称为算术移位。 2.算术移位规则 对千正数，由千[x]原＝［x压＝［x压＝真值，故移位后出现的空位均以0添之。对于负数，由 于原码、补码和反码的表示形式不同，故当机器数移位时，对其空位的添补规则也不同。表6.4 列出了三种不同码制的机器数（整数或小数均可），分别对应正数或负数移位后的添补规则。必 须注意的是：不论是正数还是负数，移位后其符号位均不变，这是算术移位的重要特点。 表6.4不同码制机器数算术移位后的空位添补规则 真值码制添补代码 正数原码、补码、反码。 原码。 左移添0 负数补码 右移添l 反码1  由表6.4可得出如下结论。"}
{"doc_id": "co", "page": 241, "text": "第6章计算机的运算方法235  心机器数为正时，不论是左移还是右移，添补代码均为0。 ＠由于负数的原码数值部分与真值相同，故在移位时只要使符号位不变，其空位均添 0即可。 ＠由千负数的反码各位除符号位外与负数的原码正好相反，故移位后所添的代码应与原码 相反，即全部添l。 ＠分析任意负数的补码可发现，当对其由低位向高位找到第一个“1”时，在此“1“左边的各 位均与对应的反码相同，而在此“1“右边的各位（包括此“1”在内）均与对应的原码相同。故负 数的补码左移时，因空位出现在低位，则添补的代码与原码相同，即添0；右移时因空位出现在高 位，则添补的代码应与反码相同，即添l。 例6.7设机器数字长为8位（含1位符号位），若A＝士26，写出三种机器数左、右移一位和 两位后的表示形式及对应的真值，并分析结果的正确性。 解：(1) A=+26=(+11010)二 则[A]原＝［A压＝［A］反＝0,0011010 移位结果如表6.5所示。 表6.5对A=+26移位后的结果 机器数 移位操作 [A]原＝［A］补＝［A］反 移位前0,0011010  左移一位0,0110100  左移两位0,1101000  右移一位0, 0 0 0 1 1 0 1  右移两位0,0000110  对应的真值 +26  +52  +104  +13  +6  可见，对千正数，三种机器数移位后符号位均不变，左移时最高数位丢l，结果出错；右移时 最低数位丢l，影响精度。 (2) A=-26=(-11010)二 三种机器数移位结果如表6.6所示。 表6.6对A=-26移位后的结果 移位操作机器数对应的真值 移位前1, 0 0 1 1 0 1 0 -26  左移一位原1,0110100 -52  左移两位1, 1 1 0 1 0 0 0 -104  右移一位码1, 0 0 0 1 1 0 1 -13  右移两位1,0000110 -6"}
{"doc_id": "co", "page": 242, "text": "236 第3篇中央处理器 续表 移位操作机器数对应的真值 移位前1, 1 1 0 0 1 1 0 -26  左移一位补1, 1 0 0 1 1 0 0 -52  左移两位1,0011000 -104  右移一位码1, 1 1 1 0 0 1 1 -13  右移两位1, 1 1 1 1 0 0 1 -7  移位前1, 1 1 0 0 1 0 1 -26  左移一位反1, 1 0 0 1 0 1 1 -52  左移两位1, 0 0 1 0 1 1 1 -104  右移一位码1, 1 1 1 0 0 1 0 -13  右移两位1, 1 1 1 1 0 0 1 -6  可见，对千负数，三种机器数算术移位后符号位均不变。负数的原码左移时，高位丢l，结果 出错；右移时，低位丢l，影响精度。负数的补码左移时，高位丢0，结果出错；右移时，低位丢1, 影响精度。负数的反码左移时，高位丢0，结果出错；右移时，低位丢0，影响精度。 图6.3示意了机器中实现算术左移和右移操作的硬件框图。其中，图6.3(a)为真值为正的 三种机器数的移位操作；图6.3(b)为负数原码的移位操作；图6.3(C)为负数补码的移位操作；图 6.3(d)为负数反码的移位操作。 干詈三干三尸 尸f尸尸于(a)真值为正(b)负数原码(c) 负数补码(d) 负数反码 图6.3实现算术左移和右移操作的硬件示意图 3.算术移位和逻辑移位的区别 有符号数的移位称为算术移位，无符号数的移位称为逻辑移位。逻辑移位的规则是：逻辑左 移时，高位移丢，低位添0；逻辑右移时，低位移丢，高位添0。例如，寄存器内容为01010011，逻辑 左移为10100110，算术左移为00100110（最高数位”1\"移丢）。又如，寄存器内容为10110010，逻 辑右移为01011001，若将其视为补码，算术右移为11011001。显然，两种移位的结果是不同的。 上例中为了避免算术左移时最高数位丢1，可采用带进位(Cy)的移位，其示意图如图6.4所示。 算术左移时，符号位移至Cy，最高数位就可避免移丢。"}
{"doc_id": "co", "page": 243, "text": "第6章计算机的 法 237  回升。101 0 0 1 11移位前 曰I 1 0 l O O l l OI算术移位后 图6.4用带进位的移位实现算术左移 加减法运算是计算机中最基本的运算，因减法运算可看作被减数加上一个减数的负值，即 A -B=A +(-B)，故在此将机器中的减法运算和加法运算合在一起讨论。现代计算机中都采用 补码作加减法运算。 1.补码加减运算的基本公式 补码加法的基本公式如下： 整数[A压＋［B］补＝［A+B]补(mod2n+l)  小数[A压＋［B］补＝［A+B]补(mod2)  即补码表示的两个数在进行加法运算时，可以把符号位与数值位同等处理，只要结果不超出 机器能表示的数值范围，运算后的结果按2n+l取模（对于整数）或按2取模（对千小数），就能得 到本次加法的运算结果。 读者可根据补码定义，按两个操作数的四种正负组合情况加以证明。 对于减法，因A-B=A +(-B)  则[A-B丘＝［A+(-B)］补 由补码加法基本公式可得 整数[A-B压＝［A压＋［－B］补(mod2n+l)  小数[A-B]补＝［A］补＋［－B］补(mod2)  因此，若机器数采用补码，当求A-B时，只需先求[-B]补（称[-B]补为“求补”后的减数）， 就可按补码加法规则进行运算。而[-BJ,i+由[B片连同符号位在内，每位取反，末位加1而得。 例6.8已知A=0.1011,B = -0.0101，求［A+B]补。 解：因为A=0.1011,B=-0.0101  所以[A]补＝0.1011,[B]补＝1.1011 则[A]补+［BJ补＝0.1011  + 1. 1011  』0.0110= [A +B]补 丢掉"}
{"doc_id": "co", "page": 244, "text": "238 第3篇中央处理器 按模2的意义，最左边的1丢掉，故[A+B压＝0.0110，结果正确。 例6.9巳知A=-1001,B = -0101，求［A+B]补。 解：因为A= -1001,B = -0101  所以[A压＝1,0111,[B压＝1,1011  则[A]补＋［B］补＝1,0111 +l, 1011  』1,0010= [A +B]补 丢掉 按模24+1的意义，最左边的1丢掉。 例6.10设机器数字长为8位（含1位符号位），若A= + 15, B = + 24，求［A-B丘并还原成 真值。 解：因为A = + 15 = + 0001111, B = + 24 = + 0011000  所以[A压＝0,0001111, [ B]补＝0,0011000, [ -B]补＝1,1101000  则[A-B压＝［A］补＋［－B压＝0,0001111  + 1, 1101000  1, 1110111  所以[A-B压＝1,1110111  故A-B= -0001001 = -9  可见，不论操作数是正还是负，在做补码加减法时，只需将符号位和数值部分一起参加运算， 并且将符号位产生的进位自然丢掉即可。 例6.11设机器数字长为8位，其中1位为符号位，令A=-93,B = +45，求［A-B]们 解：由A=-93=-1011101，得［A]补＝1,0100011  由B= +45 = +0101101，得［B］补＝0,0101101,[ -B]补＝1,1010011 [A]补＝1,0100011 +[-B]补＝1,1010011  [A]补＋［一；二0,1110110= [A -B]补 按模2n+l的意义，最左边的“1“自然丢掉，故[A-Bl1+= o, 1110110，还原成真值得A-B=118,  结果出错，这是因为A-B=-138超出了机器字长所能表示的范围。在计算机中，这种超出机器 字长的现象叫溢出。为此，在补码定点加减运算过程中，必须对结果是否溢出做出明确的判断。 2.溢出判断 补码定点加减运算判断溢出有两种方法。"}
{"doc_id": "co", "page": 245, "text": "第6章的运算方法239  (1)用一位符号位判断溢出 对千加法，只有在正数加正数和负数加负数两种情况下才可能出现溢出，符号不同的两个数 相加是不会溢出的。 对于减法，只有在正数减负数或负数减正数两种情况下才可能出现溢出，符号相同的两个数 相减是不会溢出的。 下面以机器字长为4位（含1位符号位）为例，说明机器是如何判断溢出的。 机器字长为4位的补码所对应的真值范围为－8~ +7，运算结果一旦超过这个范围即为溢 出。表6.7列出了四种溢出情况。 由于减法运算在机器中是用加法器实现的，因此可得出如下结论：不论是作加法还是减法， 只要实际参加操作的两个数（减法时即为被减数和“求补”以后的减数）符号相同，结果又与原操 作数的符号不同，即为溢出。 得 所以 表6.7补码定点运算溢出判断举例 真值 A =5  +B =4  A+B=9>7  A= -5  +B = -4  溢出 A+B=-9<-8 溢出 A =5  -B= -4  A-B=9>1 溢出 A= -5  -B = +4  A-B=-9<-8 溢出 11 7  例6.12已知A=－—B=－—，求［A+B]补。 16'-16  11 7  解：由A=－—=-0.1011,B=－—=－0.0111 16, 16  [A]补＝1.0101,[B]补＝1.1001 [A +B]补＝［A］补＝1.0101  +[BJ补＝1.1001  丢掉 』0.1110  补码运算 [A]补＝0,101 +[B]补＝0,100 [A +B]补＝1,001 [A压＝1,011 +[B]补＝1,100 [A +B]补＝10,111 [A]补＝0,101 +[-B]补＝0,100 [A -B压＝1,001 [A压＝1,011 +[-B]补＝1,100 [A-B]补＝10,111"}
{"doc_id": "co", "page": 246, "text": "240 第3篇中央处理器 两操作数符号均为1，结果的符号为0，故为溢出。 例6.13已知A=-0.1000,B = -0.1000，求［A+B]补。 解：由A=-0.1000,B = -0.1000  得 所以 [A]补＝1.1000,[ B]补＝1.1000 [A +B压＝［A压＝1.1000  +[BJ补＝1.1000  丢掉』］1.0000  结果的符号同原操作数符号，故未溢出。 由[A+B]补＝1.0000，得A+B=-1，由此可见，用补码表示定点小数时，它能表示－1的值。 计算机中采用1位符号位判断时，为了节省时间，通常用符号位产生的进位与最高有效位产 生的进位异或操作后，按其结果进行判断。若异或结果为1，即为溢出；异或结果为0，则无溢出。 例6.12中符号位有进位，最高有效位无进位，即1EE)O = 1，故溢出。例6.13中符号位有进位，最高 有效位也有进位，即lEE)l=O，故无溢出。 (2)用两位符号位判断溢出 在6.1.2节中已提到过2位符号位的补码，即变形补码，它是以4为模的，其定义为 x l>x;:::=O  x]补'={4+x0>x乏－1(mod 4)  在用变形补码作加法时，2位符号位要连同数值部分一起参加运算，而且高位符号位产生的 进位自动丢失，便可得正确结果，即 [x]补，＋［y]补'=[x+y]补'(mod4)  变形补码判断溢出的原则是：当2位符号位不同时，表示溢出，否则；无溢出。不论是否发生 溢出，高位（第1位）符号位永远代表真正的符号。 11 3  例6.14设x=＋—y=＋—，试用变形补码计算x+y。 16 16  11 3  解：因为x=+—=0.1011,y=+—=0.0011 16 16  所以[x]补＇＝00.1011,[ y]补'=00.0011 则［x]补'+[y]补'=00.1011  + 00. 0011  00. 1110  故[x+y]补＇＝00.1110 x+y=0.1110"}
{"doc_id": "co", "page": 247, "text": "第6章计算机的运算方法241  11 7  例6.15设x=＋—y=+－，试用变形补码计算x+y。 16 16  11 7  解：因为x=+—=0.1011,y= +~= 0.0111 16 16  所以［x]补'=00.1011,[y]补 '=00.0111 则［x]补'+[y]补'=00.1011  +00. 0111  第1位符号位-醮:0010 溢出 此时，符号位为“01\"，表示溢出，又因第1位符号位为“O”，表示结果的真正符号为正，故 \"01”表示正溢出。 11 7  例6.16设x=－—y=-—用变形补码计算x+y。 16 16'  11 7  x=-—= -0.1011,y=-—= -0.0111 16 16  [x]补'=11.0101,[y]补'=11.1001 [x]补'+[y]补'=11.0101  + 11. 1001  丢掉 卫10.1110  符号位为“10\"，表示溢出。由千第1位符号位为1，则表示负溢出。 上述结论对于整数也同样适用。在浮点机中，当阶码用两位符号位表示时，判断溢出的原则 与小数的完全相同。 这里需要说明一点，采用双符号位方案时，寄存器或主存中的操作数只需保存一位符号位即 可。因为任何正确的数，两个符号位的值总是相同的，而双符号位在加法器中又是必要的，故在 相加时，寄存器中一位符号的值要同时送到加法器的两位符号位的输入端。 3.补码定点加减法所需的硬件配置 图6.5是实现补码定点加减法的基本硬件配置框图。 图中寄存器A、X、加法器的位数相等，其中A存放被加数（或被减数）的补码，X存放加数 （或减数）的补码。当作减法时，由“求补控制逻辑“将又送至加法器，并使加法器的最末位外来 进位为1，以达到对减数求补的目的。运算结果溢出时，通过溢出判断电路置”1\"溢出标记V。 凡为加法标记，化为减法标记。 4.补码加减运算控制流程 解：因为 以 所则 补码加减运算控制流程如图6.6所示。"}
{"doc_id": "co", "page": 248, "text": "242 第3篇中央处理器 曰 。 X n  图6.5补码定点加减法硬件配置 准备 相加 被加（减）数（补码）-A 加（减）数（补码）-x (A)+(X).........A  (mod2或mod2n+1) 判溢出 图6.6补码加减运算控制流程 由图可见，加（减）法运算前，被加（减）数的补码在A中，加（减）数的补码在X中。若是加 法，直接完成(A)+(X)-+A(mod2或mod2n+l)的运算；若是减法，则需对减数求补，再和A寄存 器的内容相加，结果送A。最后完成溢出判断。"}
{"doc_id": "co", "page": 249, "text": "第6章计算机的运算方法243  在计算机中，乘法运算是一种很重要的运算，有的机器由硬件乘法器直接完成乘法运算， 的机器内没有乘法器，但可以按机器做乘法运算的方法，用软件编程实现。因此，学习乘法运算 方法不仅有助千乘法器的设计，也有助于乘法编程。 下面从分析笔算乘法入手，介绍机器中用到的几种乘法运算方法。 1.分析笔算乘法 设A=0.1101,B=0.1011，求AxB。 笔算乘法时，乘积的符号由两数符号心算而得：正正得正。其数值部分的运算如下： 0. 1 1 0 1  X 0. 1 0 1 1  1 1 0 1.................. AX 2° A不移位 1 1 0 1 .................. AX 21 A左移1位 0 0 0 0 ......'..,簪........Qx22 0左移2位 1 1 0 1 .................,AX 23 A左移3位 0. 1 0 0 0 1 1 1 1  所以AxB = +0.10001111  可见，这里包含着被乘数A的多次左移，以及4个位积的相加运算。 若计算机完全模仿笔算乘法步骤，将会有两大困难：其一，将4个位积一次相加，机器难以实 现；其二，乘积位数增长了一倍，这将造成器材的浪费和运算时间的增加。为此，对笔算乘法进行 改进。 2.笔算乘法的改进 A · B =A · 0.1011  = O. lA +0.00A +0.00lA +0.000lA  = O. lA +0. OOA +0. 001 (A +0. lA)  = O.lA+O.Ol[OA+O.l(A+O.lA)]  =0.1 jA+O.l[OA+O.l(A+O.lA)] f  = 2 ~ 1 l A+ 2 -l [ OA + 2 -l (A+ 2 -l A) ] f  = 2-1 j A+ 2 -1 [ OA + 2 -l (A+ 2-1 (A+ 0)) ] l (6.. 8)  由式(6.8)可见，两数相乘的过程，可视为加法和移位（乘2-1相当于做一位右移）两种运算， 这对计算机来说是非常容易实现的。 从初始值为0开始，对式(6.8)作分步运算，则 第一步：被乘数加零 第二步：右移一位，得新的部分积 A +0 = 0.1101 +0.0000 = 0.1101  2-1(A+O)= 0.01101"}
{"doc_id": "co", "page": 250, "text": "244 第3篇中央处理器 第三步：被乘数加部分积A +2-1(A +O) = 0. 1101+0.01101 = 1.00111  第四步：右移一位，得新的部分积2-1[A+2-1(A+O)] =0.100111  第五步：0 • A+2-1[A+2-1(A+O)] =0.100111  第六步：2 -1 l O. A+ 2 -1 [ A+ 2 -l (A+ 0) ] l = 0. 0100111  第七步：A+ 2 -1 l O. A+ 2 -1 [A+ 2-1 (A+ 0) ] l = 1.0001111  第八步：2-1 jA+2-1[0 · A+2-1(A+2-1(A+O))] l =0.10001111  表6.8列出了式(6.8)的全部运算过程。 表6.8式(6.8)的运算过程 部分积乘数说明 0.0000 1 0 1 1 初始条件，部分积为0 + 0.1101 乘数为1，加被乘数 0.1101  0.0110 1 1 0 1 ------+l位，形成新的部分积；乘数同时-1位 + 0.1101 乘数为1，加被乘数 1.0011 1  0.1001 1 1 1 0 -+1位，形成新的部分积；乘数同时-+l位 + 0.0000 乘数为0，加上0 0.1001 1 1  0.0100 1 1 1 1 -+1位，形成新的部分积；乘数同时-+l位 + 0.1101 乘数为1，加被乘数 1.0001 1 1 1  0.1000 1 1 1 1 -+1位，形成最终结果 上述运算过程可归纳如下： 心乘法运算可用移位和加法来实现，两个4位数相乘，总共需要进行4次加法运算和4次 移位。 ＠由乘数的末位值确定被乘数是否与原部分积相加，然后右移一位，形成新的部分积；同 时，乘数也右移一位，由次低位作新的末位，空出最高位放部分积的最低位。 ＠每次做加法时，被乘数仅仅与原部分积的高位相加，其低位被移至乘数所空出的高 位位置。 计算机很容易实现这种运算规则。用一个寄存器存放被乘数，一个寄存器存放乘积的高位， 另一个寄存器存放乘数及乘积的低位，再配上加法器及其他相应电路，就可组成乘法器。又因加 法只在部分积的高位进行，故不但节省了器材，而且还缩短了运算时间。 3.原码乘法 由于原码表示与真值极为相似，只差一个符号，而乘积的符号又可通过两数符号的逻辑异或"}
{"doc_id": "co", "page": 251, "text": "第6章计算机的运算方法 求得，因此，上述讨论的结果可以直接用千原码一位乘，只需加上符号位处理即可。 (1)原码一位乘运算规则 以小数为例： 设[x]原气。．X1X2\"'Xn [y]原＝y。．Y1Y2'\"Yn 则[x]原．［y]原气。EBY。.（0.x1x2．．飞）（0．yly2· · ·yn)  式中，O.x1x2…x,，为x的绝对值，记作x*;O,Y1Y2…Y\"为y的绝对值，记作y*0  原码一位乘的运算规则如下： 心乘积的符号位由两原码符号位异或运算结果决定。 ＠乘积的数值部分由两数绝对值相乘，其通式为 x* • y* =x* (0. Y1Y2'\"YJ  =x* (y12-1 +r22-2 +…+y/12 -11)  =2-1(y1x* +2-1(Y2X* +2一1(…＋2-1(Yn-lx*+2-1(y几x*+O))…)))  Z。 z n -l  z n  再令zl表示第i次部分积，式(6.9)可写成如下递推公式。 Z。=0  Z1 =2-l(Yn. x* +z。) Z2 = 2-l (Yn-1。x*气） z;=2-l(Yn-i+I. x* +z;-1)  zn=2-l(Y1. x*+zn-1)  例6.17已知x=-0.1110,y=-0.1101，求［x·y]原。 解：因为x=-0.1110  所以[x压＝1.1110，矿＝0.1110（为绝对值），x。＝1  又因为y= -0.1101  所以[y压＝1.1101,y*=0.1101（为绝对值），y。＝1  z2  按原码一位乘运算规则，［x·y压的数值部分计算如表6.9所示。 z1  245  (6.9)  (6. 10)"}
{"doc_id": "co", "page": 252, "text": "246 第3篇中央处理器 表6.9例6.17数值部分的计算 部分积乘数说明 0.0000 1 1 0 1 开始部分积z。=0 +0.1110 乘数为1，加上矿 0.1110  0.0111 0 1 1 0 --+l位得z!，乘数同时--+1位 +0.0000 乘数为0，加上0 0.0111 。 0. 0011 1 0 1 1 一1位得Z2，乘数同时--+1位 +0.1110 乘数为1，加上矿 1.0001 1 0  0. 1000 1 1 0 1 -1位得Z3，乘数同时-1位 +0.1110 乘数为1，加上矿 1.0110 1 1 0  0.1011 0 1 1 0 --+l位得Z4，乘数巳全部移出 即x*• y* =0.10110110  乘积的符号位为x。EBY。=1令1=0 故[X • y]原＝0.10110110 值得注意的是，这里部分积取n+l位，以便存放乘法过程中绝对值大千或等千1的值。此 外，由千乘积的数值部分是两数绝对值相乘的结果，故原码一位乘法运算过程中的右移操作均为 逻辑右移。 (2)原码一位乘所需的硬件配置 图6.7是实现原码一位乘运算的基本硬件配置框图。 。Q  右移 移位和加控制 控制门 。 X n I曰三口曰 图6.7原码一位乘运算基本配置"}
{"doc_id": "co", "page": 253, "text": "第6章计算机的运算方法247  图中A、X、Q均为n+l位的寄存器，其中X存放被乘数的原码，Q存放乘数的原码。移位和 加控制电路受末位乘数Qn的控制（当Qn= l时，A和X内容相加后，A、Q右移一位；当Qn=O时， 只作A、Q右移一位的操作）。计数器C用千控制逐位相乘的次数。S存放乘积的符号。归为 乘法标记。 (3)原码一位乘控制流程 原码一位乘控制流程如图6.8所示。 乘法运算前，A寄存器被清零，作为初始部分积，被乘数原码在X中，乘数原码在Q中，计数 器C中存放乘数的位数n。乘法开始后，首先通过异或运算，求出乘积的符号并存千S，接着将被 乘数和乘数从原码形式变为绝对值。然后根据Qn的状态决定部分积是否加上被乘数，再逻辑 右移一位，重复n次，即得运算结果。 ｛贮A 准备被乘数（原码）-x 乘数（原码）-Q n-c  求积符1X。@Q。-s 二工 变为绝对值1o-x。,O-Q。 相乘<IA、Q同时逻辑右移一位 (C)-1-C  N  图6.8原码一位乘控制流程 上述讨论的运算规则同样可用千整数原码。为了区别于小数乘法，书写上可将表6.9中的 \"．”改为\",”。 为了提高乘法速度，可采用原码两位乘。 (4)原码两位乘 原码两位乘与原码一位乘一样，符号位的运算和数值部分是分开进行的，但原码两位乘是用"}
{"doc_id": "co", "page": 254, "text": "248 第3篇中央处理器 两位乘数的状态来决定新的部分积如何形成，因此可提高运算速度。 两位乘数共有四种状态，对应这四种状态可得表6.10。 乘数Yn-1几 00  0 1  1 0  1 1  表6.10两位乘数所对应的新的部分积 新的部分积 新部分积等千原部分积右移两位 新部分积等千原部分积加被乘数后右移两位 新部分积等于原部分积加2倍被乘数后右移两位 新部分积等于原部分积加3倍被乘数后右移两位 中2倍被乘数可通过将被乘数左移一位实现，但3倍被乘数的获得较难。此刻可将3视 为4-1(11=100-l)，即把乘以3分两步完成，第一步先完成减1倍被乘数的操作，第二步完成加 4倍被乘数的操作。而加4倍被乘数的操作实际上是由比“11“高的两位乘数代替完成的，可看 作是在高两位乘数上加“1\"。这个“1”可暂存在CJ触发器中。机器完成CJ置”1\"，即意味着对 高两位乘数加1，也即要求高两位乘数代替本两位乘数”11”来完成加4倍被乘数的操作。由此 可得原码两位乘的运算规则如表6.11所示。 表6.11原码两位乘的运算规则 乘数判断位y曰几标志位CJ操作内容 00 。z -+2位，y．-+2位，CJ保持“O\" 0 1 。z+x*--+2位，y*--+2位，Cj保持“O\" 1 0 。z+2矿-+2位，y*-+2位，C1保持“O\" 1 1 。z-x * -+2位，y＊-+2位，CJ置”1\" 00 1 z+x • -+2位，y*-+2位，CJ置“O\" 0 1 1 z+2x * ----+2位，y.----+2位，Cj置“O\" 1 0 1 z-x * ----+2位，y* ----+ 2位，Cj保持“1\" 1 1 1 z-+2位，y＊-+2位，C,保持“1\" ,  表中z表示原有部分积，矿表示被乘数的绝对值，了表示乘数的绝对值，一2表示右移两位， 当进行－矿运算时，一般都采用加[-x *丘来实现。这样，参与原码两位乘运算的操作数是绝对 值的补码，因此运算中右移两位的操作也必须按补码右移规则完成。尤其应注意的是，乘法过程 中可能要加2倍被乘数，即＋［2矿］补，使部分积的绝对值大于2。为此，只有对部分积取3位符 号位，且以最高符号位作为真正的符号位，才能保证运算过程正确无误。"}
{"doc_id": "co", "page": 255, "text": "第6章计算机的运算方法249  此外，为了统一用两位乘数和一位CJ共同配合管理全部操作，与原码一位乘不同的是，需在 乘数（当乘数位数为偶数时）的最高位前增加两个0。这样，当乘数最高两个有效位出现“11\" 时，需将CJ置”1\"，再与所添补的两个0结合呈001状态，以完成加矿的操作（此步不必移位）。 例6.18设x=0.111111,y=-0.111001，用原码两位乘求[x。y]贮 解：少数值部分的计算如表6.12所示，其中 X * = 0.111111, [ -x * ]补=l.000001,2x*= 1.111110,y* =0.111001  表6.12例6.18原码两位乘数值部分的运算过程 部分积乘数fCJ . 说明 000.000000 0 0 1 1 1 0 0 1 。开始，部分积为0,Cj= O  +000.111111 根据Yn-1Y凡＝010，加矿，保持Cj=O 000.111111  000.001111 1 1 0 0 1 1 1 0 。-+2位，得新的部分积，乘数同时-+2位 +001.111110 根据“100“加2矿，保持Cj=O 010.001101 1 1  000.100011 01110011 。-2位，得新的部分积，乘数同时一2位 +111.000001 根据“110“减矿（即加[-x.压），cj置”1\" 111.100100 0 1 1 1  111.111001 0 0 0 1 1 1 0 0 1 -+2位，得新的部分积，乘数同时-+2位 +000.111111 根据“001“加X*, C1置“O\" 000.111000 0 0 0 1 1 1 形成最终结果 ＠乘积符号的确定： X。@y。=OEF)l=l 故[X • y]原＝1.111000000111  不难理解，当乘数为偶数时，需做n/2次移位，最多做n/2+1次加法。当乘数为奇数时，乘 数高位前可只增加一个“0”，此时需做n/2+1次移位（最后一步移一位），最多需做n/2+1  次加法。 虽然两位乘法可提高乘法速度，但它仍基千重复相加和移位的思想，而且随着乘数位数的增 加，重复次数增多，仍然影响乘法速度的进一步提高。采用并行阵列乘法器可大大提高乘法速 度。有关阵列乘法器的内容可参见附录6B。 原码乘法实现比较容易，但由千机器都采用补码做加减运算，倘若做乘法前再将补码转换成 原码，相乘之后又要将负积的原码变为补码形式，这样增添了许多操作步骤，反而使运算复杂。 为此，有不少机器直接用补码相乘，机器里配置实现补码乘法的乘法器，避免了码制的转换，提高 了机器效率。"}
{"doc_id": "co", "page": 256, "text": "250 第3篇中央处理器 4.补码乘法 (1)补码一位乘运算规则 设被乘数[x]补气。．X1X2…xn 乘数[y]补＝y。．Y1Y2…Yn 1)被乘数x符号任意，乘数y符号为正 [ X J补气。．X1X2\"'Xn=2+x=2n+l+x (mod 2)  [ y J补＝O,Y1Y2'\"Yn=y  则[x]补．［y]补＝[ x]补．y=(2n+l+X)• y=2n+l • y+xy  由千y=O,Y1Y2…Yn=三Y;2-＇，则2n+l•y=2三Y;2n-'，且三y，了是一个大千或等于1的正 整数，根据模运算的性质，有2n+ 1 · y = 2 (mod 2)，故 [x]补．［y]补＝2n+l• y+xy = 2+xy = [ X馨y]补(mod2)  即[x.y]补＝[ x］补．［y］补＝［x]补．y 对照原码乘法式(6.9)和式(6.10)可见，当乘数y为正数时，不管被乘数x符号如何，都可按 原码乘法的规则运算，即 则 巨。］补＝0 匡］补＝2-1(yJx]补＋［z。]补） 己］补＝2-l(Yn-l[x]补＋［Z1]补） 巨］补＝2-l(Yn－叶1[ X]补＋［zi-1]补） [x. y]补＝[zn J补＝2-l(y1[X]补＋［zn-1]补） 当然这里的加和移位都必须按补码规则运算。 2)被乘数x符号任意，乘数y符号为负 [x]补=x。.X1X2···xn [ y]补＝LY1Y2…yn = 2+y (mod 2)  y=[y]补－2=1.r1Y2·..y\"-2=0·Y1Y2·.. y\"-1  x • y=x(O,Y1Y2.. ·Yn-l)  =x(O.y1Y2'... YJ -x  故[X • y]补＝［x(O,Y1Y2..'Yn)］补＋［－x]补 将上式O,Y1Y2…Yn视为一个正数，正好与上述情况相同。 则[x(O,Y1Y2'\"Yn)］补＝［x ]补(O.y1Y2'\"YJ (6. 11)  所以[ X • y]补＝［x]补(O.y1Y2…yJ+[ -x]补(6.12)  由此可得，当乘数为负时是把乘数的补码［y归去掉符号位，当成一个正数与［x压相乘，然"}
{"doc_id": "co", "page": 257, "text": "第6章计算机的运算方法 后加上［－X]i~进行校正，也称校正法，用递推公式表示如下： [z。］补＝0 [ Z1]补＝2－l(yn[x］补＋三］补） 己］补＝2-1(Yn-1[x]补＋匡］补） [ Z;]补＝2-l(Yn－计1[ X]补＋［Z;-1]补） [zn ］补＝2－l趴[x]补＋［Zn-I]补） [ X • y]补＝[zn ］补＋［－x]补 251  (6. 13)  比较式(6.13)与式(6.11)可见，乘数为负的补码乘法与乘数为正时类似，只需最后加上一项 校正项［－x压即可。 例6.19巳知[x]补＝1.0101,[y]补＝0.1101，求［x·y]补。 解：因为乘数y>O，所以按原码一位乘的算法运算，只是在相加和移位时按补码规则进行，如 表6.13所示。考虑到运算时可能出现绝对值大于1的情况（但此刻并不是溢出），故部分积和被 乘数取双符号位。 表6.13例6.19的运算过程 部分积乘数说明 00.0000 1 1 0 1 初值[z。压＝0 + 11.0101 y4=l,+[x]补 11.0101  11.1010 1 1 1 0 ----+ 1位，得[zl]补，乘数同时----+1位 11.1101 0 1 1 1 Y3 =O，~1位，得[Z2]补，乘数同时一1位 + 11.0101 Yz=l,+[x]补 11.0010 0 1  11.1001 0 0 11 --+1位，得[Z3]补，乘数同时-+1位 + 11.0101 y1=1,+[x]补 10.1110 0 0 1  11.0111 0 0 0 1 -+l位，得[Z4]补 故乘积[x.y压＝1.01110001 例6.20已知[x]补＝0.1101,[ y]补＝1.0101，求［X• y]补。 解：因为乘数y<O，故先不考虑符号位，按原码一位乘的运算规则运算，最后再加上[-x]补， 如表6.14所示。"}
{"doc_id": "co", "page": 258, "text": "252 第3篇中央处理器 表6.14例6.20的运算过程 部分积乘数说明 00.0000 0 1 0 1 初值[z。]补＝0 + 00.1101 y4=1,+[x]补 00.1101  00.0110 1 0 1 0 --+ 1位，得[zl]补，乘数同时--+l位 00.0011 0 1 0 1 Y3 =O，-+1位，得[Z2]补 + 00.1101 Y2=l,+[x]补 01.0000 0 1  00.1000 0010 -+l位，得[Z3]补，乘数同时-+l位 00.0100 0 0 0 1 Y1=0,-+l位，得[Z4]补 + 11.0011 +[-x压进行校正 11.0111 0 0 0 1 得最后结果[x.y]补 故乘积[X • y]补＝1.01110001 由以上两例可见，乘积的符号位在运算过程中自然形成，这是补码乘法和原码乘法的 要区别。 上述校正法与乘数的符号有关，虽然可将乘数和被乘数互换，使乘数保持正，不必校正，但当 两数均为负时必须校正。总之，实现校正法的控制线路比较复杂。若不考虑操作数符号，用统一 的规则进行运算，就可采用比较法。 3)被乘数x和乘数y符号均为任意 比较法是Booth夫妇首先提出来的，故又称Booth算法。它的运算规则可由校正法导出。 设[x]补气。．X1X2…xn [y]补=y。.y心·\"Yn  按补码乘法校正法规则，其基本算法可用一个统一的公式表示为 [ X • y]补＝［x]补(O,Y1Y2\"·yJ-[x]补．y。 当y。=0时，表示乘数y为正，无须校正，即 [ X • y]补＝［x]补(O,Y1Y2\"'Yn)  当y。=1时，表示乘数y为负，则 [x. y]补＝［x]补(O,Y1Y2\"'YJ - [ x]补 (6. 14)  (6.15)  (6.16)"}
{"doc_id": "co", "page": 259, "text": "第6章计算机的运算方法253  比较式(6.12)和式(6.16)，在mod2的前提下，［－x压＝－［X]f~成立气所以式(6.15)和式(6. 16)表达的算法与校正法的结论完全相同，故式(6.14)可以改写为 [x. y]补＝[ x]补仇2-l+y22-2+· ·· + yn了）- ［x]补．y。 =[x]补(-y。+Y12-1+y22-2+…+Yn了） = [x]补[-y。+（Y1-yl了）＋（Y2了－Y22-2)＋…＋（Yn2-(n-l)-Yn了）]  =[x]补[(yl-y。)+(Y2-Y1) 2-1+…+(Yn-Yn-1) 2一(11-1)+(0-yn) 2-n J  =[x]补[(Y1 -y。)+(Y2-Y1)2-1+…+(Yn+l -yJ 2-n J  其中，Yn+I= Q。 这样，可得如下递推公式。 曰］补＝0 匡］补＝2-1l [ z。］补＋（Yn+1-rJ[ X]补｝ 己］补＝2-1l[z1]补＋（Yn-Yn-I)[x]补｝ [ Z;]补＝2-1l [zi-1 J补＋（Yn-i+2-Yn-i+l)[x]补｝ [zn ］补＝2-lj[zn-l]补＋（Y2-yl) [ X]补｝ [x. y]补＝［z,.+1]补=［z,.］补＋（y1-y。)［x]补 (6.17)  (6. 18)  由此可见，开始时Yn+l= 0，部分积初值[z。]补为0，每一步乘法由(Yi+l-y;) (i = 1'2,…，n)决 定原部分积加［x压或加［－x压或加0，再右移一位得新的部分积，以此重复n步。第n+l步由 (y1-y。)决定原部分积加［x\\或加[-x片或加0，但不移位，即得[x.y]沪 这里的(Yi+l-y,）之差值恰恰与乘数末两位y，及Yi+l的状态对应，对应的操作如表6.15所示。 当运算至最后一步时，乘积不再右移。这样的运算规则计算机很容易实现。 CD证明：［－x压＝－［x］补(mod 2)  (1)若[x]补＝O,X1X2…x,.(2)若[x]补＝l.x1X2…x,' 则x=O.x1x2 \"'X,. 则x=-(0元马..无＋2－n) 所以－x=-0.x1x2…xn所以－x=O．记马…凡＋2－n 故[-x]补＝l.正马…元＋2一”(mod2)(a) 故［－x]补＝0元乌…凡＋2-n(mod 2) (c)  又因为[X]补＝O.x1x2…x,l 所以－［x]补＝-O,X1X2…xn  = 2-0.x1 x2…xn(mod 2)  =I．记记·· ·凡＋2-n(b)  比较(a)、（b)两式可得 [ -x]补＝－［x]补 (mod2)  证毕 又因为［x]补＝l．x产2…xn 圭－（0．无马…元＋r\")(mod 2)  所以－［x]补＝0．记马…凡＋2-n 比较(c)、(d)两式可得 [ -x]补＝－［x]补(mod2)  证毕 (d)"}
{"doc_id": "co", "page": 260, "text": "254 第3篇中央处理器 表6.15Y;Y;+1的状态对操作的影响 YiYi+I yi+1-yi 操作 00 。部分积右移一位 0 1 1 部分积加[x]补，再右移一位 1 0 -1 部分积加[-x]补，再右移一位 1 1 。部分积右移一位 应该注意的是，按比较法进行补码乘法时，像补码加、减法一样，符号位也一起参加运算。 例6.21已知[x]补＝0.1101,[y]补＝0.1011，求［x·y]补。 解：表6.16列出了例6.21的求解过程。 表6.16例6.21求[x.y]补的过程 部分积乘数凡附加位yn+1说明 00.0000 0 1 0 1 1 。初值[z。压＝0 + 11.0011 YnY11+l = 10，部分积加[-x]补 11.0011  11.1001 1 0 1 O 1 1 --+1位，得[zl]补 11.1100 1 1 0 1 0 1 YnYn+l = 11，部分积-+1位，得[Z2]补 + 00.1101 YnYn+l = 01，部分积加[x]补 00.1001 1 1  00.0100 1 1 1 0 1 。--+l位，得[Z3]补 + 11.0011 YnYn+l = 10，部分积加[-x]补 11.0111 1 1 1  11.1011 1 1 1 1 0 1 -+1位，得[Z4]补 + 00.1101 YnY11+l = 01，部分积加[x]补 00.1000 1 1 1 1 最后一步不移位，得[x.y]补 故[X • y]补＝0.10001111 由表6.16可见，与校正法（参见表6.13和表6.14)相比，Booth算法的部分积仍取双符号位， 乘数因符号位参加运算，故多取1位。 例6.22已知[x]补＝1.0101,[y]补＝1.0011，求［x·y]补。 解：表6.17列出了例6.22的求解过程。"}
{"doc_id": "co", "page": 261, "text": "第6章计算机的运算方法255  表6.17例6.22求[X • y]补的过程 部分积乘数Yn附加位仇，＋1说明 00.0000 1 0 0 1 1 。 + 00.1011 YnYn+l = 10，部分积加[-x]补 00.1011  00.0101 1 1 0 0 1 1 -+1位，得[Z1]补 00.0010 1 1 1 0 0 1 YnYn+l = 11，部分积-+1位，得[Z2]补 + 11.0101 YnYn+l = 01，部分积加[x]补 11.0111 1 1  11.1011 1 1 1 1 0 。--+1位，得[Z3]补 11.1101 1 1 1 1 1 。YnYn+I = 00，部分-+1位，得[Z4]补 + 00.1011 YnY11+1 = 10，部分积加[-x]补 00.1000 1 1 1 1 最后一步不移位，得[x.y]补 故[X • y]补＝0.10001111 由于比较法的补码乘法运算规则不受乘数符号的约束，因此，控制线路比较简明，在计算机 中普遍采用。 (2)补码比较法(Booth算法）所需的硬件配置 图6.9是实现补码一位乘比较法乘法运算的基本硬件配置框图。 。 。 X n+l 曰丿 图6.9补码比较法运算基本硬件配置 图中A、X、Q均为n+2位寄存器，其中X存放被乘数的补码（含两位符号位），Q存放乘数的 补码（含最高1位符号位和最末1位附加位），移位和加控制逻辑受Q寄存器末2位乘数控制。 当其为01时，A、X内容相加后A、Q右移一位；当其为10时，A、X内容相减后A、Q右移一位。"}
{"doc_id": "co", "page": 262, "text": "256 第3篇中央处理器 计数器C用于控制逐位相乘的次数，归为乘法标记。 (3)补码比较法(Booth算法）控制流程 补码一位乘比较法的控制流程图如图6.10所示。乘法运算前A寄存器被清零，作为初始部 分积。Q寄存器末位清零，作为附加位的初态。被乘数的补码存在X中（双符号位），乘数的补 码在Q高n+l位中，计数器C存放乘数的位数n。乘法开始后，根据Q寄存器末两位Qn、Qn+l的 状态决定部分积与被乘数相加还是相减，或是不加也不减，然后按补码规则进行算术移位，这样 重复n次。最后，根据Q的末两位状态决定部分积是否与被乘数相加（或相减），或不加也不减， 但不必移位，这样便可得到最后结果。补码乘法乘积的符号位在运算中自然形成。 需要说明的是，图中(A)-(X)--+A实际是用加法器实现的，即(A)＋（又＋1)--+A。同理， Booth运算规则也适用千整数补码。 Jl  备 准 O-A, O-Qn+1  被乘数（补码）-x 乘数（补码）-Q n-C  A、Q同时算术右移一位 相乘 图6.10补码一位乘比较法控制流程图 为了提高乘法的运算速度，可采用补码两位乘。 (4)补码两位乘 补码两位乘运算规则是根据补码一位乘的规则，把比较YnYn+l的状态应执行的操作和比较"}
{"doc_id": "co", "page": 263, "text": "第6章计算机的运算方法257  Y n-lY n的状态应执行的操作合并成一步得出的。 例如，Yn-1YnYn+l为011，则第一步由YnYn+l= 11得出只作右移，即2-1[ z,]补，第二步由 Yn-lYn=Ql得出需作2勹2-1[z！压＋［x]补｝的操作，可改写为2勹[z,]补＋2[x]补｝，即最后结论为 当Yn-1几Yn+l为011时，完成2勹[z！压＋2[x]补｝操作，同理可分析其余7种情况。表6.18列出了 补码两位乘的运算规则。 表6.18补码两位乘的运算规则 判断位 操作内容 几一1YnYn+l 000 [z计l]补＝2-2[ Z;]补 0 0 1 [ Zi+l]补＝2-21[z;]补＋［x]补｝ 0 1 0 [z计l]补＝2-2l[z;]补＋［x]补｝ 0 1 1 [z计l]补＝2-2 ｛五］补＋2[x]补｝ 1 0 0 [z计1]补＝2-2l [ Z;］补＋2[-x]补｝ 1 0 1 [ Z;+J]补＝2-2l[z;]补＋［－x]补｝ 1 1 0 [z计l]补＝2-2 { [zl ]补＋［－x]补｝ 1 1 1 [z计1]补＝2-2[ Z;]补 由表6.18可见，操作中出现加2[x厅和加2[-x]补，故除右移两位的操作外，还有被乘数左 移一位的操作；而加2[ X] fr和加2[-x片都可能因溢出而侵占双符号位，故部分积和被乘数采用 3位符号位。 例6.23已知[x]补＝0.0101,[y]补＝1.0101，求［X• y]补。 解：表6.19列出了此例的求解过程。其中，乘数取2位符号位，外加1位附加位（初态为 0)，即11. 01010, [ -x ] *r = 1. 1 O 11取3位符号位为111.1011。 表6.19例6.23补码两位乘求[x。y]补的过程 部分积乘数说明 000.0000 1 1 0 1 0 1 0  + 000.0101 判断位为010，加［x］补 000.0101  000.0001 0111010 -+2位 + 000.0101 判断位为010，加［x］补 000.0110 0 1  000.0001 1 0 0 1 1 1 0 ----+ 2位 + 111.1011 判断位为110，加［－x］补 111.1100 1 0 0 1 最后一步不移位，得[x.y]补"}
{"doc_id": "co", "page": 264, "text": "258 第3篇中央处理器 故[X • y]补＝1.11001001 由表6.19可见，与补码一位乘相比（参见表6.16和表6.17)，补码两位乘的部分积多取1位 符号位（共3位），乘数也多取1位符号位（共2位），这是由于乘数每次右移2位，且用3位判 断，故采用双符号位更便千硬件实现。可见，当乘数数值位为偶数时，乘数取2位符号位，共需作 n/2次移位，最多作n/2+1次加法，最后一步不移位；当n为奇数时，可补0变为偶数位，以简化 逻辑操作。也可对乘数取1位符号位，此时共进行n/2+1次加法运算和n/2+1次移位（ 步移一位）。 对千整数补码乘法，其过程与小数补码乘法完全相同。为了区别千小数乘法，在书写上将符 号位和数值位中间的\".”改为\",”即勹0 除法运算 1.分析笔算除法 以小数为例，设x=-0.1011,y=0.1101，求x/y。 笔算除法时，商的符号心算而得：负正得负。其数值部分的运算如下面的竖式所示。 0. 1101  0. 1101}o.iouo  0. 01101 2 -l. y  0.010010  0. 001101 2 -z. y  0.00010100  0. 00001101 24. y  0.00000111  所以商x/y=-0.1101，余数＝0.00000111 其特点可归纳如下： 叩每次上商都是由心算来比较余数（被除数）和除数的大小，确定商为“1”还是“0”。 ＠每做一次减法，总是保持余数不动，低位补0，再减去右移后的除数。 ＠上商的位置不固定。 ＠商符单独处理。 如果将上述规则完全照搬到计算机内，实现起来有一定困难，主要问题如下： 心机器不能“心算“上商，必须通过比较被除数（或余数）和除数绝对值的大小来确定商值， 即lxl-lyl，若差为正（够减）上商l，差为负（不够减）上商0。 ＠按照每次减法总是保持余数不动低位补0，再减去右移后的除数这一规则，则要求加法器 的位数必须为除数的两倍。仔细分析发现，右移除数可以用左移余数的方法代替，其运算结果是 一样的，但对线路结构更有利。不过此刻所得到的余数不是真正的余数，只有将它乘上2一1'才是"}
{"doc_id": "co", "page": 265, "text": "第6章计算机的运算方法259  真正的余数。 ＠笔算求商时是从高位向低位逐位求的，而要求机器把每位商直接写到寄存器的不同位置 也是不可取的。计算机可将每一位商直接写到寄存器的最低位，并把原来的部分商左移一位，这 样更有利于硬件实现。 则 综上所述便可得原码除法运算规则。 2.原码除法 原码除法和原码乘法一样，符号位是单独处理的，下面以小数为例。 设[x]原气。．X1X2…xn [y]原＝y。．Y1Y2'\"Yn [-;l,=(x。霆）．0．xlx2· · ·xn  原O,Y1Y2'\"Yn 式中，O.X1X2…xn为x的绝对值，记作x*;O,Y1Y2…Yn为y的绝对值，记作y*0  即商符由两数符号位进行异或运算求得，商值由两数绝对值相除(x* /y*）求得。 小数定点除法对被除数和除数有一定的约束，即必须满足下列条件： 0<1被除数I::::; I除数1 实现除法运算时，还应避免除数为0或被除数为0。前者结果为无限大，不能用机器的有限 位数表示；后者结果总是0，这个除法操作没有意义，浪费了机器时间。商的位数一般与操作数 的位数相同。 原码除法中由千对余数的处理不同，又可分为恢复余数法和不恢复余数法（加减交替 法）两种。 (1)恢复余数法 恢复余数法的特点是：当余数为负时，需加上除数，将其恢复成原来的余数。 由上所述，商值的确定是通过比较被除数和除数的绝对值大小，即X* -y＊实现的，而计算机 内只设加法器，故需将矿－y＊操作变为[X *压＋［－y*归的操作。 X  例6.24已知X= -0.1011,y= -0.1101，求［—］。 y原 解：由X= -0.1011,y= -0.1101  得[x]原＝1.1011,x* = 0.1011  [y]原＝1.1101,y*=0.1101, [-y*］补＝1.0011 表6.20列出了例6.24商值的求解过程。 表6.20例6.24恢复余数法的求解过程"}
{"doc_id": "co", "page": 266, "text": "260  被除数（余数） 1.1110  + 0.1101  0.1011  1.0110  + 1.0011  0.1001  1.0010  + 1.0011  0.0101  0.1010  + 1.0011  1.1101  + 0.1101  0.1010  1.0100  + 1.0011  0.0111  故商值为0.1101 商的符号位为 第3篇中央处理器 商 。 。 0 1  0 1  0 1 1  0 1 1  0 1 1 0  0 1 1 0  0 1 1 0 1  X。@y。=1(:81=0 所以厂］＝0.1101 y原 续表 六 说明 余数为负，上商“O\" 恢复余数＋［了］补 被恢复的被除数 仁1位 +[ -y•压（减去除数） 余数为正，上商”1\" +--1位 +[ -y*压（减去除数） 余数为正，上商”1\" 七1位 +[ -y*压（减去除数） 余数为负，上商“O\" 恢复余数＋［y*］补 被恢复的余数 +--1位 +[ -y*压（减去除数） 余数为正，上商”1\" 由此例可见，共左移（逻辑左移）4次，上商5次，第一次上的商在商的整数位上，这对小数除 法而言，可用它作溢出判断。即当该位为“1”时，表示此除法溢出，不能进行，应由程序进行处 理；当该位为“0”时，说明除法合法，可以进行。 在恢复余数法中，每当余数为负时，都需恢复余数，这就延长了机器除法的时间，操作也很不 规则，对线路结构不利。加减交替法可克服这些缺点。 (2)加减交替法 加减交替法又称不恢复余数法，可以认为它是恢复余数法的一种改进算法。"}
{"doc_id": "co", "page": 267, "text": "第6章计算机的运算方法261  分析原码恢复余数法得知： 当余数凡＞0时，可上商”1\"，再对凡左移一位后减除数，即2R;-y勹 当余数凡<0时，可上商“O”，然后先做凡＋厂，即完成恢复余数的运算，再做2(R;+y*)- y*，即2Rl＋广。 可见，原码恢复余数法可归纳如下： 当凡＞0，商上“1\"，做2R厂广的运算。 当R;<O，商上“0\"，做2R主广的运算。 这里已经看不出余数的恢复问题了，而只是做加广或减y*，因此，一般将其称为加减交替 法或不恢复余数法。 例6.25已知x=-0.1011,y=0.1101，求［—]。 y原 解：由x=-0.1011,y=0.1101 得[x]原＝1.1011,x*=0.1011  [y]原＝0.1101,y*=0.1101,[-y*]补＝1.0011 表6.21列出了此例商值的求解过程。 表6.21例6.25加减交替法的求解过程 被除数（余数）商说 0.1011 0.0000  +1.0011 +[ -y才，压（减除数） 1.1110 。余数为负，上商“O\" 1.1100 。+--1位 +0.1101 +[y*压（加除数） 0.1001 ,0 1 余数为正，上商”1\" 1.0010 0 1 七一1位 +1.0011 +[ 压（减除数） 0.0101 0 1 1 余数为正，上商”1\" 0.1010 0 1 1 +--1位 +1.0011 +[-y*]补（减除数） 1.1101 0 1 1 0 余数为负，上商“O\" 1.1010 0 1 1 0 一1位 +0.1101 +[y*厅（加除数） 0.0111 0 1 1 0 1 余数为正，上商”1\" 明"}
{"doc_id": "co", "page": 268, "text": "262 第3篇中央处理器 商的符号位为 X。EBY。=lEB0=1  所以厂］＝1.1101 y原 分析此例可见，n位小数的除法共上商n+l次（第一次商用来判断是否溢出），左移（逻辑左 移）n次，可用移位次数判断除法是否结束。倘若比例因子选择恰当，除法结果不溢出，则第一次 商肯定是0。如果省去这位商，只需上商n次即可，此时除法运算一开始应将被除数左移一位减 去除数，然后再根据余数上商。读者可以自己练习。 需要说明一点，表6.21中操作数也可采用双符号位，此时移位操作可按算术左移处理，最高 符号位是真正的符号，次高位符号位在移位时可被第一数值位占用。 (3)原码加减交替法所需的硬件配置 图6.11是实现原码加减交替法运算的基本硬件配置框图。 。 控制门 。 X n I巳三巨巨工勹 图6.11原码加减交替法运算的基本硬件配置 图中A、X、Q均为n+l位寄存器，其中A存放被除数的原码，X存放除数的原码。移位和加 控制逻辑受Q的末位见控制(Qn= 1做减法，Qn= 0做加法），计数器C用于控制逐位相除的次 数n,GD为除法标记，V为溢出标记，S为商符。 (4)原码加减交替法控制流程 图6.12为原码加减交替法控制流程图。 除法开始前，Q寄存器被清零，准备接收商，被除数的原码放在A中，除数的原码放在X中， 计数器C中存放除数的位数n。除法开始后，首先通过异或运算求出商符，并存于S。接着将被 除数和除数变为绝对值，然后开始用第一次上商判断是否溢出。若溢出，则置溢出标记V为1, 停止运算，进行中断处理，重新选择比例因子；若无溢出，则先上商，接着A、Q同时左移一位，然 后再根据上一次商值的状态，决定是加还是减除数，这样重复n次后，再上最后一次商（共上商 n+l次），即得运算结果。"}
{"doc_id": "co", "page": 269, "text": "第6章计算机的运算方法 准备｛被除除数数（on原（-一原码Qc 码）-）-xA  求商符A。@X。-s 变为绝对值O-A。,o-况 !  (A)一 (X)-A A、Q同时左移一位 (C)一1-c (A)+(X)-A  相除 (A)+(X)--A (A)一(X)-A N  图6.12原码加减交替法控制流程图 对千整数除法，要求满足以下条件： 0 < I除数I~ I被除数1 263  因为这样才能得到整数商。通常在做整数除法前，先要对这个条件进行判断，若不满足上述"}
{"doc_id": "co", "page": 270, "text": "264 第3篇中央处理器 条件，机器发出出错信号，程序要重新设定比例因子。 上述讨论的小数除法完全适用于整数除法，只是整数除法的被除数位数可以是除数的两倍， 且要求被除数的高n位要比除数(n位）小，否则即为溢出。如果被除数和除数的位数都是单字 长，则要在被除数前面加上一个字的0，从而扩展成双倍字长再进行运算。 为了提高除法速度，可采用阵列除法器，有关内容参见附录6B。 3.补码除法 与补码乘法类似，也可以用补码完成除法操作。补码除法也分恢复余数法和加减交替法，后 者用得较多，在此只讨论加减交替法。 (1)补码加减交替法运算规则 补码除法的符号位和数值部分是一起参加运算的，因此在算法上不像原码除法那样直观， 要需要解决3个问题：心如何确定商值；＠如何形成商符；＠如何获得新的余数。 心欲确定商值，必须先比较被除数和除数的大小，然后才能求得商值。 0比较被除数（余数）和除数的大小 补码除法的操作数均为补码，其符号又是任意的，因此要比较被除数［x压和除数[y]补的大 小就不能简单地用［x丘减去[y]补。实质上比较［x压和［y五的大小就是比较它们所对应的 绝对值的大小。同样在求商的过程中，比较余数[R，压与除数［YJ ir的大小，也是比较它们所对 应的绝对值的大小。这种比较的算法可归纳为以下两点。 第一，当被除数与除数同号时，做减法，若得到的余数与除数同号，表示＂够减＂，否则表示 “不够减＂。 第二，当被除数与除数异号时，做加法，若得到的余数与除数异号，表示＂够减＂，否则表示 “不够减＂。 此算法如表6.22所示。 表6.22比较算法表 比较[x]补与[y压的符号求余数比较[R山卜与[y压的符号 同号[x]补－［y]补同号，表示＂够减＂ 异号[x压＋［y］补异号，表示＂够减＂ ·商值的确定 补码除法的商也是用补码表示的，如果约定商的末位用＂恒置l\"的舍入规则，那么除末位商 外，其余各位的商值对正商和负商而言，上商规则是不同的。因为在负商的情况下，除末位商以 外，其余任何一位的商与真值都正好相反。因此，上商的算法可归纳为以下两点。 第一，如果［x压与［y压同号，商为正，则＂够减”时上商”1”,“不够减”时上商“0\"（按原码规 则上商）。"}
{"doc_id": "co", "page": 271, "text": "第6章计算机的运算方法265  第二，如果[x]补与[y]补异号，商为负，则＂够减”时上商“O”,“不够减”时上商”1\"（按反码规 则上商）。 结合比较规则与上商规则，便可得商值的确定方法，如表6.23所示。 表6.23商值的确定 [x]补与[y]补商[R]补与[y]补商值 同号，表示＂够减\"1  同号正 异号，表示“不够减＂。 异号表示＂够减＂。 异号负 同号，表示“不够减＂1  进一步简化，商值可直接由表6.24确定。 表6.24简化的商值确定 [R]补与[y]补商值 同号 异号 。 ＠在补码除法中，商符是在求商的过程中自动形成的。 在小数定点除法中，被除数的绝对值必须小于除数的绝对值，否则商大于1而溢出。因此， 当［x压与［y压同号时，［x］补－［y压所得的余数[R。]补必与[y]补异号，上商“O\"，恰好与商的符 号（正）一致；当［x压与［y压异号时，［x］补＋［y＼所得的余数[R。归必与［y压同号，上商”l\"，这 也与商的符号（负）一致。可见，商符是在求商值过程中自动形成的。 此外，商的符号还可用来判断商是否溢出。例如，当[x]补与［y压同号时，若[R。]补与[y]补 同号，上商”1\"，即溢出。当[x]补与［y厅异号时，若[R。]补与［y压异号，上商“O”，即溢出。 当然，对于小数补码运算，商等千”-l“应该是允许的，但这需要特殊处理，为简化问题，这里 不予考虑。 ＠新余数[R计1]补的获得方法与原码加减交替法极相似，其算法规则如下： 当[R，压与［y压同号时，商上“1\"，新余数 [Ri+l压＝2[R;]补－［y]补＝2[R,]补＋［－y]补 当[R;压与［y压异号时，商上“O\"，新余数 [R计1]补＝2[R」补＋［y]补 将此算法列于表6.25中。"}
{"doc_id": "co", "page": 272, "text": "266 第3篇中央处理器 表6.25新余数的算法 如果对商的精度没有特殊要求，一般可采用＂末位恒置l“法，这种方法操作简单，易于实现， 而且最大误差仅为2勹 例6.26已知x=0.1001,y=0.1101，求［f]补。 解：由X= 0.1001,y= 0.1101  得[x]补＝0.1001,[y]补＝0.1101,[ -y]补＝1.0011 其运算过程如表6.26所示。 表6.26例6.26的运算过程 被除数（余数） 0.1001  +1.0011  1.1100  1.1000  +0.1101  0.0101  0.1010  +1.0011  1.1101  1.1010  +0.1101  0.0111  0.1110  X  所以[—] =0.1011  y补 商 0.0 0 0 0  。 。 0 1  0 1  0 1 0  0 1 0  0 1 0 1  0 1 0 1 1  X  例6.27已知x= -0. l 001, y = + 0. 1101，求门。 y补 解：由X= -0.1001,y= +0.1101  得[x]补＝1.0111,[y]补＝0.1101,[-y]补＝1.0011 其运算过程如表6.27所示。 说明 [x]补与［y压同号，＋［－y］补 [R]补与［y压异号，上商“O\" +--1位 +[y]补 [R]补与［y压同号，上商”1\" 亡1位 +[-y]补 [R]补与[y]补异号，上商“O\" +--1位 +[y]补 [R]补与［y压同号，上商”1\" +-1位，末位商恒置”1\""}
{"doc_id": "co", "page": 273, "text": "第6章计算机的运算方法267  表6.27例6.27的运算过程 被除数（余数）商说明 1.0111 0.0000  +0.1101 [x]补与［y压异号，＋［y］补 0.0100 1 [R]补与［y压同号，上商”1\" 0.1000 1 +--1位 +1.0011 +[-y]补 1.1011 1 0 [R]补与［y压异号，上商“O\" 1.0110 1 0 仁－1位 +0.1101 +[y] 补 0.0011 1 0 1 [R]补与［y压同号，上商”1\" 0.0110 1 0 1 +--1位 +1.0011 +[ -y]补 1.1001 1 0 1 0 [R]补与［y压异号，上商“O\" 1.0010 1 0 1 0 1 七－1位，末位商恒置”1\" 所以厂］＝1.0101 y补 可见，n位小数补码除法共上商n+l次（末位恒置”1”)，第一次商可用来判断是否溢出。共 移位n次，并用移位次数判断除法是否结束。 (2)补码加减交替法所需的硬件配置 补码加减交替法所需的硬件配置基本上与图6.11相似，只是图6.11中的S触发器可以省 掉，因为补码除法的商符在运算中自动形成。此外，在寄存器中存放的均为补码。 例6.28设X、Y、Z均为n+l位寄存器(n为最低位），机器数采用1位符号位。若除法开 始时操作数已放在合适的位置，试分别描述原码和补码除法商符的形成过程。 解：设X、Y、Z均为n+l位寄存器，除法开始时被除数在X中，除数在Y中，S为触发器，存放 商符，Z寄存器存放商。原码除法的商符由两操作数（原码）的符号位进行异或运算获得，记作 X。(±)Y。-+S。 补码除法的商符由第1次上商获得，共分两步。 第一步，若两操作数符号相同，则被除数减去除数（加上“求补”以后的除数），结果送X寄存 器；若两操作数符号不同，则被除数加上除数，结果送X寄存器，记作 X凇Y。.（X+Y+l)+(X。@Y。)．（X+Y尸X 第二步，根据结果的符号和除数的符号确定商值。若结果的符号X。与除数的符号Y。同号， 则上商”l\"，送至Zn保存；若结果的符号X。与除数的符号Y。异号，则上商“O\"，送至Zn保存， 记作"}
{"doc_id": "co", "page": 274, "text": "268 第3篇中央处理器 X。@Y。-+Zn 如果机器数采用补码，实现乘法和除法均用补码运算，那么，为了与补码乘法取得相同的寄 存器位数，表6.26和表6.27中的被除数（余数）可取双符号位，整个运算过程与取1位符号位完 全相同（见例6.34下的表6.31)。 (3)补码加减交替法的控制流程 补码加减交替法的控制流程如图6.13所示。 J\\ — \\J\\_\\  昙数，做除号是 备归肆准判数加o-Q  被除数（补码）-A 除数（补码）-x n-c  相除 1一Q,i A、Q同时左移一位 (A)一(X)-A o-Qn  A、Q同时左移一位 (A)+(X)-A  末位恒置1 图6.13补码加减交替法控制流程 除法开始前，Q寄存器被清零，准备接收商，被除数的补码在A中，除数的补码在X中，计数 器C中存放除数的位数n。除法开始后，首先根据两操作数的符号确定是做加法还是减法，加 （或减）操作后，即上第一次商（商符），然后A和Q同时左移一位，再根据商值的状态决定加或 减除数，这样重复n次后，再上一次末位商“1\"（恒置“1“法），即得运算结果。"}
{"doc_id": "co", "page": 275, "text": "第6章计算机的运算方法269  补充说明几点： 叩图中未画出补码除法溢出判断的内容。 ＠按流程图所示，多做一次加（或减）法，其实在末位恒置”1“前，只需移位而不必做加（或 减）法。 ＠与原码除法一样，图中均未指出对0进行检测。实际上在除法运算前，先检测被除数和 除数是否为0。若被除数为0，结果即为0；若除数为0，结果为无穷大。这两种情况都无须继续 做除法运算。 ＠为了节省时间，上商和移位操作可以同时进行。 以上介绍了计算机定点四则运算方法，根据这些运算规则，可以设计乘法器和除法器。有些 机器的乘、除法可用编程来实现。分析上述运算方法对理解机器内部的操作过程和编制乘、除法 运算的标准程序都是很有用的。 6.4 浮点四则运算 从6.2节浮点数的讨论可知，机器中任何一个浮点数都可写成 x=S • rlx  的形式。其中，S厂为浮点数的尾数，一般为绝对值小于1的规格化数（补码表示时允许为－l），机 器中可用原码或补码表示；人为浮点数的阶码，一般为整数，机器中大多用补码或移码表示；r为 浮点数的基数，常用2、4、8或16表示。以下以基数为2进行讨论。 1  设两个浮点数 x = S. rk  y=S)'· rj)'  由于浮点数尾数的小数点均固定在第一数值位前，所以尾数的加减运算规则与定点数的完 全相同。但由千其阶码的大小又直接反映尾数有效值小数点的实际位置，因此当两浮点数阶码 不等时，因两尾数小数点的实际位置不一样，尾数部分无法直接进行加减运算。为此，浮点数加 减运算必须按以下几步进行。 心对阶，使两数的小数点位置对齐。 ＠尾数求和，将对阶后的两尾数按定点加减运算规则求和（差）。 ＠规格化，为增加有效数字的位数，提高运算精度，必须将求和（差）后的尾数规格化。 ＠舍入，为提高精度，要考虑尾数右移时丢失的数值位。 ＠溢出判断，即判断结果是否溢出。"}
{"doc_id": "co", "page": 276, "text": "270 第3篇中央处理器 1.对阶 对阶的目的是使两操作数的小数点位置对齐，即使两数的阶码相等。为此，首先要求出阶 差，再按小阶向大阶看齐的原则，使阶小的尾数向右移位，每右移一位，阶码加1，直到两数的阶 码相等为止。右移的次数正好等千阶差。尾数右移时可能会发生数码丢失，影响精度。 例如，两浮点数x=0.1101X2°1,y=(-0.1010) X211，求x+y。 首先写出x,y在计算机中的补码表示。 [x]补＝00,01 ; 00.1101, [ y]补＝00,11 ; 11. 0110  在进行加法前，必须先对阶，故先求阶差： ［心］补＝［ixJ补－［jy]补＝00,01 + 11, 01 = 11, 10  即6.j=-2，表示x的阶码比y的阶码小，再按小阶向大阶看齐的原则，将x的尾数右移两位，其阶 码加2, 得[xJ;卜＝00,11; 00.0011  此时，6.j=0，表示对阶完毕。 2.尾数求和 将对阶后的两个尾数按定点加（减）运算规则进行运算。 如上例中的两数对阶后得 则[S尤＋Sy压为 即 3.规格化 [xJ;卜＝00,11; 00. 0011  [ y]补＝00,11 ; 1 1.0110  0 0.0 0 1 1 [SJ;卜 + 1 1.0 1 1 o [ s)']补 11.100 1 [Sx+SYJ;卜 [x+y]补＝00,11 ; 11. 1001  由6.2.2节可知，当基值r=2时，尾数S的规格化形式为 1  —冬ISl<l 2  如果采用双符号位的补码，则 当S>O时，其补码规格化形式为 [SJ补＝00.lxx...x  当S<O时，其补码规格化形式为 (6.19)  (6.20)  [SJ补＝11.0XX···X(6.21)  可见，当尾数的最高数值位与符号位不同时，即为规格化形式，但对S<O时，有两种情况需 特殊处理。"}
{"doc_id": "co", "page": 277, "text": "第6章计算机的运算方法271  心S=－—，则［S］补＝11.100…0。此时对千真值－—而言，它满足式(6.19)，对于补码 2 2  ([S压）而言，它不满足于式(6.21)。为了便于硬件判断，特规定－—不是规格化的数（对补码而言）。2  (2) S=-1，则［S］补＝11.00···0，因小数补码允许表示－l，故－1视为规格化的数。 当尾数求和（差）结果不满足式(6.20)或式(6.21)时，则需规格化。规格化又分左规和右规 两种。 (1)左规 当尾数出现oo.oxx…X或11.1xx…X时，需左规。左规时尾数左移一位，阶码减l，直到符合 式(6.20)或式(6.21)为止。 则 如上例求和结果为 [x+y]补＝00,11 ; 11. 1001  尾数的第一数值位与符号位相同，需左规，即将其左移一位，同时阶码减l，得 [x+y]补＝00,10 ; 1 1.0010  x+y=(-O.lllO)x210  (2)右规 当尾数出现01.xx…X或10.xx…X时，表示尾数溢出，这在定点加减运算中是不允许的，但 在浮点运算中这不算溢出，可通过右规处理。右规时尾数右移一位，阶码加1 。 例6.29已知两浮点数x=0.1101x210,y=0.10llx2°1，求x+y。 解：X、y在机器中以补码表示为 [x]补＝00,10; 00.1101  [y]补＝00,01; 00.1011  叩对阶： ［心］补＝［jx]补－[j)? ］补 = 00, 10 + 11, 11 = 00, 01  即L::,.j=1，表示y的阶码比x的阶码小l，因此将y的尾数向右移一位，阶码相应加1，即 [y]'补＝00,10; 00.0101  这时[y]＇补的阶码与［x五的阶码相等，阶差为0，表示对阶完毕。 ＠求和： 0 0.1 1 0 1 [ SJ补 +0 0. 0 1 0 1 [Sy]'补 0 1.0 0 1 0 [Sx+S>,]'补 即[x+y]补＝00,10; 01.0010"}
{"doc_id": "co", "page": 278, "text": "272 第3篇中央处理器 ＠右规： 运算结果两符号位不等，表示尾数之和绝对值大千l，需右规，即将尾数之和向右移一位，阶 码加1，故得 则 4.舍入 [x+y]补＝00,11; 00.1001  x+y = 0.1001 X211  在对阶和右规的过程中，可能会将尾数的低位丢失，引起误差，影响精度。为此可用舍入法 来提高尾数的精度。常用的舍入方法有以下两种。 (1) \"O舍l入“法 \"0舍l入“法类似千十进制数运算中的“四舍五入“法，即在尾数右移时，被移去的最高数 值位为0，则舍去；被移去的最高数值位为1，则在尾数的末位加1。这样做可能使尾数又溢出， 此时需再做一次右规。 (2)\"恒置l“法 尾数右移时，不论丢掉的最高数值位是“1”或“0\"，都使右移后的尾数末位恒置”1”。这种 方法同样有使尾数变大和变小的两种可能。 综上所述，浮点加减运算经过对阶、尾数求和、规格化和舍入等步骤。与定点加减运算相比， 显然要复杂得多。 例6.30设x=2-101x(-0.101000),y=2一100X (+ 0. 111011)，并假设阶符取2位，阶码的数值 部分取3位，数符取2位，尾数的数值部分取6位，求x-y。 解：由x=2-101x(-0.101000),y=2-100x(+0.111011)  得[x]补＝11,011 ; 11.011000, [ y]补＝11,100;00.111011  心对阶： ［心］补＝［人］补－［j)＇］补＝11,011 + 00, 100 = 11, 111  即h.j=-l，则x的尾数向右移一位，阶码相应加1，即 [x]'补＝11,100 ; 11. 101100  ＠求和： [ sx]＇补－［Sy ]'补＝［s.\"]＇补＋［－Sr]补 = 11. 101100 + 11. 000101  = 10.110001  即[x-y]补＝11,100;10.110001  尾数符号位出现“10”，需右规。 ＠规格化： 右规后得[x-y]补＝11,101 ; 1 1.011000 (!]  ＠舍入处理： 采用“0舍1入“法，其尾数右规时末位丢l，则有"}
{"doc_id": "co", "page": 279, "text": "第6章计算机的运算方法 所以[x-y]补＝11,101;11. 011001  5.溢出判断 1 1.0 1 1 0 0 0  11.011001  273  与定点加减法一样，浮点加减运算最后一步也需判断溢出。在浮点规格化中已指出，当尾数 之和（差）出现01.xx…X或10.xx…X时，并不表示溢出，只有将此数右规后，再根据阶码来判断 浮点运算结果是否溢出。 若机器数为补码，尾数为规格化形式，并假设阶符取2位，阶码的数值部分取7位，数符取2 位，尾数的数值部分取n位，则它们能表示的补码在数轴上的表示范围如图6.14所示。 上溢A对应下溢对应 z/////1 负浮点数a o b 正浮点数B上溢 r ///////1  00, 1111111; 11.00· · ·O 00,1111111 ;00.11.. ·1  11,0000000; 11.011 ···1 11,0000000; 00.100.. ·0  图6.14补码在数轴上的表示 图中A、B、a、b的坐标均为补码表示，分别对应最小负数、最大正数、最大负数和最小正数。 它们所对应的真值如下： A最小负数2+121x(-l)  B最大正数2+127 X (1-2勹 a最大负数2 -128 X (-2 -1 -2勹 b最小正数2-128 X2-1  注意，由于图6.14所示的A、B、a、b均为补码规格化的形式，故其对应的真值与图6.2所示 的结果有所不同。 在图6.14中a、b之间的阴影部分对应的阶码小于－128，这种情况称为浮点数的下溢。下溢 时，浮点数值趋千零，故机器不做溢出处理，仅把它作为机器零。 在图6.14中A、B两侧的阴影部分对应的阶码大千＋127，这种情况称为浮点数的上溢。此 刻，浮点数真正溢出，机器需停止运算，做溢出中断处理。一般说浮点溢出，均是指上溢。 可见，浮点机的溢出与否可由阶码的符号决定，即 阶码[j五＝01,xx…X为上溢。 阶码[j压＝10,xx…X为下溢，按机器零处理。 当阶符为“01”时，需做溢出处理。 例6.30经舍入处理后得[x-y] 1~ = 11, 101 ; 11.011001，阶符为\"11\"，不溢出，故最终结果为 x-y = 2-ou X (-0.100111)"}
{"doc_id": "co", "page": 280, "text": "274 第3篇中央处理器 例6.31设机器数字长16位，阶码5位（含1位阶符），基值为2，尾数11位（含1位数符）。 对千两个阶码相等的数按补码浮点加法完成后，由于规格化操作可能出现的最大误差的绝对值 是多少？ 解：两个阶码相等的数按补码浮点加法完成后，仅当尾数溢出需右规时会引起误差。右规时 尾数右移一位，阶码加1，可能出现的最大误差是末尾丢l，例如： 结果为00, 1110 ; 01. XX XX XX XX X 1  右规后得00, 1111; 00.1 xxxxxxxxx 1  考虑到最大阶码是15，最后得最大误差的绝对值为(10000)二＝2勹 当计算机中阶码用移码表示时，移码运算规则参见浮点乘除运算。 最后可得浮点加减运算的流程。 例6.32要求用最少的位数设计一个浮点数格式，必须满足下列要求。 (1)十进制数的范围：负数－1038~ -10-38；正数＋10-38~ 10气 (2)精度：7位十进制数据。 解：（1)由210>103 可得(210)飞（10勹12，即2120>1036  又因为27 > 102  所以27X2120>102Xl036，即2127> 1038  同理2-127 < 10-38  故阶码取8位（含1位阶符），当其用补码表示时，对应的数值范围为－128~ +127。 (2)因为107=223，故尾数的数值部分可取23位。加上数符，最终浮点数取32位，其中阶 码8位（含1位阶符），尾数24位（含1位数符）。 6.浮点加减运算流程 图6.15为浮点补码加减运算的流程图。 两个浮点数相乘，乘积的阶码应为相乘两数的阶码之和，乘积的尾数应为相乘两数的尾数之 积。两个浮点数相除，商的阶码为被除数的阶码减去除数的阶码，尾数为被除数的尾数除以除数 的尾数所得的商，可用下式描述。 设两浮点数x=S · r坛 y= s)'. rj)'  则X. y= (Sx. S)') xrix切 X Sx —-=—. r左jy y Sy"}
{"doc_id": "co", "page": 281, "text": "第6章计算机的运算方法 对阶：小阶的尾数右移j位 右规：尾数右移一位， 大阶加l 舍入(0舍l入） 尾数加（减） 左规：尾数左移K位， 直到满足要求为止， 大阶减k 图6.15浮点补码加减运算流程 在运算中也要考虑规格化和舍入问题。 1.阶码运算 275  若阶码用补码运算，乘积的阶码为[jx压＋［jy]补，商的阶码为[jx压－［jy压。两个同号的阶 码相加或异号的阶码相减可能产生溢出，此时应做溢出判断。 若阶码用移码运算，则 因为[jx压＝2n吐－2飞ix<2n(n为整数的位数） [j)，压＝2n+jy -2n冬ix<2\"(n为整数的位数） 所以[jx ］移＋［jy］移＝2n玑＋2n+jy"}
{"doc_id": "co", "page": 282, "text": "276 第3篇中央处理器 = 2n + [2n +（jx玑）]  =2\"+[jx+jy]移 可见，直接用移码求阶码和时，最高位多加了一个2n，要得到移码形式的结果，必须减去2勹 由于同一个真值的移码和补码数值部分完全相同，而符号位正好相反，即 [j) ］补＝2n+l十jr(mod 2n+l)  因此，求阶码和可用下式完成 [jx ］移＋［j)']补＝2n让＋2n+l+jy  则直接可得移码形式。 =2n+l+[2飞(j习）]  = [f. +jy]移(mod2\"+1)  同理，当做除法运算时，商的阶码可用下式完成 [jx ］移＋［－j)＇］补＝[jx -jy]移 可见进行移码加减运算时，只需将移码表示的加数或减数的符号位取反（即变为补码），然 后进行运算，就可得阶和（或阶差）的移码。 阶码采用移码表示后又如何判断溢出呢？如果在原有移码符号位的前面（即高位）再增加1 位符号位，并规定该位恒用“0”表示，便能方便地进行溢出判断。溢出的条件是运算结果移码的 最高符号位为1。此时若低位符号位为0，表示上溢；低位符号位为1，表示下溢。如果运算结果 移码的最高符号位为0，即表明没有溢出。此时若低位符号位为1，表明结果为正；低位符号位为 0，表示结果为负。 例如，若阶码取3位（不含符号位），则对应的真值范围是－8~+7。 当jx=+lOl,jy=+lOO时，则有 [jx ］移＝01,101; [jy]补＝00,100  故[j立I.）＇]移＝［jx］移＋［jy]补＝01,101 + 00, 100 = 10, 001 结果上溢 [jX-j)压＝［jx]移＋［－j)＇］补＝01,101 + 11, 100 = 01, 001 结果为＋1 当jx = -101,jy = -100时，则有 ［jJ移＝00,011,[j)']补=11,100 故[j:．＋j)，压＝［jx]移＋［jy]补＝00,011 + 11, 100 = 11, 111 结果下溢 [jX-j)r]移＝［jx]移＋［－j)＇］补＝00,011 + 00, 100 = 00, 111 结果为－l 2.尾数运算 (1)浮点乘法尾数运算 两个浮点数的尾数相乘，可按下列步骤进行。 CD检测两个尾数中是否有一个为0，若有一个为0，乘积必为0，不再做其他操作；如果两尾 数均不为0，则可进行乘法运算。 ＠两个浮点数的尾数相乘可以采用定点小数的任何一种乘法运算来完成。相乘结果可能"}
{"doc_id": "co", "page": 283, "text": "第6章计算机的运算方法277  要进行左规，左规时调整阶码后如果发生阶下溢，则作机器零处理；如果发生阶上溢，则作溢出处 理。此外，尾数相乘会得到一个双倍字长的结果，若限定只取1倍字长，则乘积的若干低位将会 丢失。如何处理丢失的各位值，通常有两种方法。 其一，无条件地丢掉正常尾数最低位之后的全部数值，这种方法称为截断处理，处理简单，但 影响精度。 其二，按浮点加减运算讨论的两种舍入原则进行舍入处理。对千原码，采用0舍1入法时， 不论其值是正数或负数，“舍“使数的绝对值变小，“入“使数的绝对值变大。对于补码，采用0舍 l入法时，若丢失的位不是全0，对正数来说，＂舍”“入＂的结果与原码分析正好相同；对负数来 说，＂舍”“入＂的结果与原码分析正好相反，即“舍“使绝对值变大，“入“使绝对值变小。为了使 原码、补码舍入处理后的结果相同，对负数的补码可采用如下规则进行舍入处理。 心当丢失的各位均为0时，不必舍入。 ＠当丢失的各位数中的最高位为0时，且以下各位不全为0，或丢失的各位数中的最高位为 l，且以下各位均为0时，则舍去被丢失的各位。 ＠当丢失的各位数中的最高位为1，且以下各位又不全为0时，则在保留尾数的最末位加l 修正。 例如，对下列4个补码进行只保留小数点后4位有效数字的舍入操作，如表6.28所示。 表6.28补码舍入操作实例 [x]补舍入前舍入后对应真值x 1.01110000 1.0111（不舍不入）-0. 1 0 0 1  1.01111000 1.0111（舍）-0. 1 0 0 1  1.01110101 1.0111（舍）-0. 1 0 0 1  1:01111100 1. 1000（入）-0. 1 0 0 0  如果将上述4个补码变成原码后再舍入，其结果列千表6.29中。 表6.29原码舍入操作实例 [x压舍入前舍入后对应真值冗 1.10010000 1.1001（不舍不入）-0. 1 0 0 1  1.10001000 1.1001（入）-0. 1 0 0 1  1.10001011 1.1001(入）-0. 1 0 0 1  1.10000100 1.1000（舍）-0. 1 0 0 0  比较表6.28和表6.29可见，按照上述的约定对负数的补码进行舍入处理，与对其原码进行 舍入处理后的真值是一样的。"}
{"doc_id": "co", "page": 284, "text": "278 第3篇中央处理器 下面举例说明浮点乘法运算的全过程。 设机器数阶码取3位（不含阶符），尾数取7位（不含数符），要求阶码用移码运算，尾数用补 码运算，最后结果保留1倍字长。 例6.33巳知x=2-101x0.0110011,y=2°11x(-O.lllOOlO)，求x·y。 解：由X= 2-lOl X0.0110011,y = 2°11 X (-0.1110010)  得[x]补＝11,011;00.0110011  [y]补＝00,011 ; 1 1. 0001110  少阶码运算： [j\" ］移＝00,011, [jy]补＝00,011 [jx+j), J移＝[jx ]移＋[jy ]补 = 00, 011 + 00, 011  = 00, 110对应真值－2 ＠尾数相乘（采用Booth算法）： 其过程如表6.30所示。 表6.30例6.33尾数相乘过程 部分积乘数Yn+I  00.0000000 1.0 0 0 1 1 1 0 。 00.0000000 01000111 。 + 11.1001101  11.1001101 。 11.1100110 1 0 1 0 0 0 1 1 1  11.1110011 0 1 0 1 0 0 0 1 1  11.1111001 1 0 1 0 1 0 0 0 1  + 00.0110011  00.0101100 1 0 1 0  00.0010110 01010100 。 00.0001011 00101010 。 00.0000101 1 0 0 1 0 1 0 1 。 + 11.1001101  11.1010010 1 0 0 1 0 1 0  ＠规格化： 说明 --+1位 +[ -sx]补 -+1位 -+1位 ---+ 1位 +[ sx]补 -+1位 --+1位 -+1位 + [ -Sx ］补"}
{"doc_id": "co", "page": 285, "text": "第6章计算机的运算方法 尾数相乘结果为[S九·.Sy压＝11.10100101001010，需左规，即 左规后 ＠舍入处理： [x. y]补＝11,110;11.10100101001010  [x. y]补＝11,101 ; 11. 01001010010100  279  尾数为负，按负数补码的舍入规则，取1倍字长，丢失的7位为0010100，应＂舍＂，故最终结 果为 [x. y]补＝11,101;11. 0100101  X • y=2-o11X(-0.1011011)  (2)浮点除法尾数运算 两个浮点数的尾数相除，可按下列步骤进行。 心检测被除数是否为0，若为0，则商为0；再检测除数是否为0，若为0，则商为无穷大，另作 处理。若两数均不为0，则可进行除法运算。 ＠两浮点数尾数相除同样可采取定点小数的任何一种除法运算来完成。对已规格化的尾 数，为了防止除法结果溢出，可先比较被除数和除数的绝对值，如果被除数的绝对值大于除数的 绝对值，则先将被除数右移一位，其阶码加1，再作尾数相除。此时所得结果必然是规格化的定 点小数。 例6.34按补码浮点运算步骤，计算［了x(+~)]7[ 2'x(－\\）]。 解：令x=[ 2'x(+~)] = 21°'x(0.1001)  r=[23x(  13 飞）］=2°11 X (-0.1101)  所以[ x li~ = 00, 101; 00.1001  [ y]补＝00,011 ; 1 1. 0011, [ -s r ]补＝00.1101 心阶码相减： [jx ］补－［j）r]补＝00,101 -00, 011 = 00, 101 + 11, 101 = 00, 010  ＠尾数相除（采用补码除法）： 其过程如表6.31所示。表中被除数（余数）采用双符号位，与采用一位符号位结果一致。 表6.31例6.34尾数相除过程 被除数（余数）商说明 00.1001 0.0000  + 1 1. 0 0 1 1 [ sx压与[S)］补异号，＋［SJ]补 11.1100 1 [R压与[S)，压同号，上商”1\" 11.1000 1 仁1位 + 00.1101 +[ -Sy]补"}
{"doc_id": "co", "page": 286, "text": "280 第3篇中央处理器 续表 被除数（余数）商说明 00.0101 1 0 [R压与[S)'厅异号，上商“O\" 00.1010 1 0 +--1位 + 11.0011 +[Sr]补 11.1101 1 0 1 [R压与[S)，压同号，上商”1\" 11.1010 1 0 1 +--1位 + 00.1101 +[ -s)］补 00.0111 1 0 1 0 [R]补与[S)压异号，上商“O\" + 00.1110 1 0 1 0 1 仁1位，末位商恒置”1\" 所以［勹＝1.0101 ), 衣卜 所以 则 ＠规格化： 尾数相除结果已为规格化数。 厂］＝00,010; 11.0101  y补 [ ~] =2010x(-0.1011)= [ 2'x(-¼)]  一学、、 I 算所需的硬件配置 由千浮点运算分阶码和尾数两部分，因此浮点运算器的硬件配置比定点运算器的复杂。分 析浮点四则运算发现，对于阶码只有加减运算，对于尾数则有加、减、乘、除四种运算。可见浮点 运算器主要由两个定点运算部件组成。一个是阶码运算部件，用来完成阶码加、减，以及控制对 阶时小阶的尾数右移次数和规格化时对阶码的调整；另一个是尾数运算部件，用来完成尾数的四 则运算以及判断尾数是否巳规格化，此外，还需有判断运算结果是否溢出的电路等。 现代计算机可把浮点运算部件做成独立的选件，或称协处理器，用户可根据需要选择，不用 选件的机器，也可用编程的方法来完成浮点运算，不过这将会影响机器的运算速度。 例如，Intel80287是浮点协处理器，它可与Intel80286或80386微处理器配合处理浮点数的 算术运算和多种函数计算。 6.5 算术逻辑单元 针对每一种算术运算，都必须有一个相对应的基本硬件配置，其核心部件是加法器和寄存"}
{"doc_id": "co", "page": 287, "text": "第6章计算机的运算方法281  器。当需要完成逻辑运算时，势必需要配置相应的逻辑电路，而ALU电路是既能完成算术运算 又能完成逻辑运算的部件。 1  路 图6.16所示是ALU框图。图中A;和B;为输入变量；化为控制信号，化的不同取值可决定 该电路做哪一种算术运算或哪一种逻辑运算；E是输出函数。 现在ALU电路己制成集成电路芯片，例如，74181是能完成4位二进制代码的算逻运算部 件，外特性如图6.17所示。 F3 F2 F1 F。F3 F2 F1 F。 Ai B. 1  Fi  图6.16ALU框图 廿 BGP cn 仁74181  4位ALU B3B2B1B。A3A2A1A。C_l (a)正逻辑 图6.17 岛 82SlSoM叫 BGP cn 仁74181  4位ALU 8382SlSoM  KI  B3B2B1B。A3A2A1A。C一1 (b)负逻辑 74181外特性示意图 74181有两种工作方式，即正逻辑和负逻辑，分别如图6.17(a)和图6.17(b)所示。 列出了其算术／逻辑运算功能，逻辑电路参见附录6C的图6.30。 6.32  表6.3274181 ALU的算术／逻辑运算功能表 功 能表 负逻辑输人或输出正逻辑输入或输出 工作方式选择 输入S心SIS。逻辑运算算术运算逻辑运算算术运算 (M= 1) (M=O) (C_1 =O) (M= 1) (M=O)(C_1=1)  0000 A减1A A A  0 0 0 1 AB AB减lA+B A+B  0 0 1 0 A+B AB减lAB A+B  0 0 1 1 逻辑l减l逻辑0减l 0 1 0 0 A加(A+B) A+B AB A加AB 0 1 0 1 B AB加(A+B)B (A+B)加AB 0 1 1 0 A减B减lAEBB A减B减l AEBB"}
{"doc_id": "co", "page": 288, "text": "282 第3篇中央处理器 续表 功能表 负逻辑输入或输出正逻辑输入或输出 工作方式选择 输入S3S2S1S。逻辑运算算术运算逻辑运算算术运算 (M= 1) (M=O)(G_1=0) (M= 1) (M=O)(C一I=1)  0 1 1 1 A+B A+B AB AB减l 1 0 0 0 AB A加(A+B)A+B A加AB 1 0 0 1 AE9B A加BAEBB A加B 1 0 1 0 B AB加(A+B)B (A+B)加AB 1 0 1 1 A+B A+B AB AB减1 1 1 0 0 逻辑0A加A*逻辑lA加A* 1 1 0 1 AB AB加AA+B (A+B)加A 1 1 1 0 AB AB加AA+B (A+B)加A 1 1 1 1 A A A A减1 少1＝高电平，0＝低电平；＠＊表示每一位均移到下一个更高位，即A*=2A。 以正逻辑为例，B3～队和A尸儿是两个操作数，F3～凡为输出结果。C_l表示最低位的外来 进位，cn+4是74181向高位的进位；P、G可供先行进位使用（有关P、G的具体含义参见6.5.2节）。 M用于区别算术运算还是逻辑运算；S3~S。的不同取值可实现不同的运算。例如，当M=l,S3~ S。=0110时，74181做逻辑运算A令B；当M=O,S3~S。=0110时，74181做算术运算。由表6.32可 见，在正逻辑条件下，M=O,S3~S。=0110，且C_l= 1时，完成A减B减l的操作。若想完成A减 B运算，可使C_l=O。注意，74181的算术运算是用补码实现的，其中减数的反码是由内部电路形 成的，而末位加“1\"，则通过C_l= 0来体现（图6.17(a)中C_l输入端处有一个小圈，意味着C_l=  0反相后为1)。尤其要注意的是，ALU为组合逻辑电路，因此实际应用ALU时，其输入端口A和 B必须与锁存器相连，而且在运算的过程中锁存器的内容是不变的。其输出也必须送至寄存器 中保存。现在有的芯片将寄存器和ALU电路集成在一个芯片内，如29C101，如图6.18所示（图 中ALU的控制端I8~I。未画出）。 该芯片的核心部件是一个容量为16字的双端口RAM和一个高速ALU电路。 RAM可视为由16个寄存器组成的寄存器堆。只要给出八口或B口的4位地址，就可以从 人出口或凡出口读出对应于口地址的存储单元内容。写入时，只能写入由Bi口指定的那个单 元内。参与操作的两个数分别由RAM的A。、队出口输出至两个锁存器中。 ALU受I8~I。控制，I2、L、I。控制ALU的数据源；I5、I4、L控制ALU所能完成的3种算术运 算和5种逻辑运算；I8~I6用来控制RAM和Q移位器，决定是否移位以及Y口输出是来自RAM 的A出口还是ALU的F出口。"}
{"doc_id": "co", "page": 289, "text": "第6章计算机的运算方法283  RAM15  地址 A3~A。 移位器 A Bi  16字RAM （寄存器堆） A。 RAM。 C in  F=O  Q15 Q。 Y1s~Y。 图6.1829Cl01框图 ALU的立为低位来的外来进位，cn+16为向高位的进位，可供29C101级联时用。ALU结果 为0时，F=O可直接输出，OVR为溢出标记。而P心与74181的P、G含义相同，它们可供先行进 位方式时使用。ALU的输出可直接通过移位器存入RAM，也可通过选通门在d；有效时从y15~  Y。输出。Q寄存器主要为乘法和除法服务，D15~D。为16位立即数的输入口。 快 位 随着操作数位数的增加，电路中进位的速度对运算时间的影响也越来越大，为了提高运算速 度，本节将通过对进位过程的分析设计快速进位链。"}
{"doc_id": "co", "page": 290, "text": "284 第3篇中央处理器 1.并行加法器 并行加法器由若干个全加器组成，如图6.19所示。n+l个全加器级联就组成了一个n+1位 的并行加法器。 s n  Sl So  C_l  图6.19并行加法器示意图 由千每位全加器的进位输出是高一位全加器的进位输入，因此当全加器有进位时，这种一级 一级传递进位的过程将会大大影响运算速度。 由全加器的逻辑表达式可知： 禾nsl=Ai Btci-l+AlBi cl-l+AI Bl cl一1+A;B;C;一1 进位C=AB,C,－l+A,B,C,-l+A,B, C,-1+AlB,c,-l  =A;B;+(A;+BJ C;_1  可见，Ci进位由两部分组成：本地进位A,B,，可记作d,，与低位无关；传递进位(A,+B)Cl-l, 与低位有关，可称A,＋B为传递条件，记作ti，则 C,=d,+ tlc,-l  由Ci的组成可以将逐级传递进位的结构转换为以进位链的方式实现快速进位。目前进位 链通常采用串行和并行两种。 2.串行进位链 串行进位链是指并行加法器中的进位信号采用串行传递，图6.19所示就是一个典型的串行 进位的并行加法器。 以四位并行加法器为例，每一位的进位表达式可表示为 C。=d。+t。C_l ：：：：三：l (6.22)  由式(6.22)可见，采用与非逻辑电路可方便地实现进位传递，如图6.20所示。 -4 -4 -dl -do  图6.20四位串行进位链"}
{"doc_id": "co", "page": 291, "text": "第6章计算机的运算方法285  若设与非门的级延迟时间为ty，那么当d卢ti形成后，共需8ty便可产生最高位的进位。实际 上每增加一位全加器，进位时间就会增加2ty。n位全加器的最长进位时间为2nt卢 3.并行进位链 并行进位链是指并行加法器中的进位信号是同时产生的，又称先行进位、跳跃进位等。理想 的并行进位链是n位全加器的n位进位同时产生，但实际实现有困难。通常并行进位链有单重 分组和双重分组两种实现方案。 (1)单重分组跳跃进位 单重分组跳跃进位就是将n位全加器分成若干小组，小组内的进位同时产生，小组与小组之 间采用串行进位，这种进位又有组内并行、组间串行之称。 以四位并行加法器为例，对式(6.22)稍做变换，便可获得并行进位表达式： C。=d。+t。C_l C1=d1+t1C。＝小＋t1d。+tlt。C_l :32 :：:：:：：二32:：32::：32t:：t::：d勹呫早。C11  按式(6.23)可得与其对应的逻辑图，如图6.21所示。 (6.23)  c3 c2  C1 C。 C一l d3 2 d t3 t2 d1 t1 d,。 t。 图6.21四位一组并行进位链 设与或非门的级延迟时间为1.5ty，与非门的级延迟时间仍为lty，则d!、t!形成后，只需2.5t)' 就可产生全部进位。 如果将16位的全加器按4位一组分组，便可得单重分组跳跃进位链框图，如图6.22所示。 不难理解在dl、ti形成后，经2.5t)，可产生C3、C2、C尸仇这4个进位信息，经10t)，就可产生全部 进位，而n=16的串行进位链的全部进位时间为32ty，可见单重分组方案进位时间仅为串行进位 链的1/3。但随着n的增大，其优势便很快减弱。例如，当n=64时，按4位分组，共为16组，组 间有16位串行进位，在d,、ti形成后，还需经40t)，才能产生全部进位，显然进位时间太长。如果"}
{"doc_id": "co", "page": 292, "text": "286  C1s C14 C13 C12  第1组 第15~12并行 第3篇中央处理器 c11 c10 c9 c8 c7 c6 c5 c4 C3 C2 C1 ~。 C一1 图6.22单重分组跳跃进位链框图 能使组间进位也同时产生，必然会更大地提高进位速度，这就是组内、组间均为并行进位的方案。 (2)双重分组跳跃进位 双重分组跳跃进位就是将n位全加器分成若干大组，每个大组中又包含若干小组，而每个大 组内所包含的各个小组的最高位进位是同时产生的，大组与大组间采用串行进位。因各小组最 高位进位是同时形成的，小组内的其他进位也是同时形成的（注意：小组内的其他进位与小组的 最高位进位并不是同时产生的），故又有组（小组）内并行、组（小组）间并行之称。图6.23是一 个32位并行加法器双重分组跳跃进位链的框图。 C31 C21 C23 C19 C1s C11 C7 C3  di ti di ti di ti di t1 di ti di ti di ti di t1  图6.2332位并行加法器双重分组跳跃进位链框图 图中共分两大组，每个大组内包含4个小组，第一大组内的4个小组的最高位进位c31、C27、 c23、仁是同时产生的；第二大组内4个小组的最高位进位C15、ell、C7、亿也是同时产生的，而第 二大组向第一大组的进位C15采用串行进位方式。 以第二大组为例，分析各进位的逻辑关系。 按式(6.23)，可写出第八小组的最高位进位表达式"}
{"doc_id": "co", "page": 293, "text": "第6章计算机的运算方法287  亿＝d3+ t3亿＝d3+ t凸＋t3t兄＋t3曰心＋t3t2t1t。C_l ＝几＋TsC-1 式中，D尸d3+ t凸＋t3t兄＋t3t计心，仅与本小组内的心ti有关，不依赖外来进位C_l，故称仄为 第八小组的本地进位；兀＝t3t凸％，是将低位进位C_l传到高位小组的条件，故称兀为第八小组的 传送条件。 同理，可写出第五、六、七小组的最高位进位表达式： 第七小组C7=d7+t7仇＋t占d5+t7t心小＋t1t6tst4C3 ＝几＋T1C3 第六小组ell＝心＋tu小。＋tll片。心＋tlltl。t心＋t11t10t9t8C7 ＝几＋T6C7 第五小组C15 = dl5 +t15儿＋t15t14九＋t15 t 14 t 13 d 12 +t 15 t 14 t 13 t 12 C ll  ＝几＋T5C11 (6.24)  进一步展开又得 匀 7 图 2D 廿 .、女 68, (D 链 为位改进d3 跃 ,、 1 倒 、 2  d且 、 A, 、乡 7d1大 C 、 P T8d0 日 i T7 的链 T6中位T51进 2 跃 +  18 l.  CD6K  剧 重 8T7 图 6  T  二 T7T5 将 T  第 T6 十需 +  C7D8 几口，成 此构 T6 T5  8T7  6  T T7T ＋因可 6 ，便 + 7  + 8DD 以 D7T6T5 盯 T5 T+ ＋木、 +76几为T6DD_ －及 7 l 木 T =  =  l7l  、 ) 3 兀 l3cc  T652  cc  T  +  +  \\0 为 T8T7  65(  ++ 87DD 文 DD_ ＿＿＿式 E 371115 和 t3 == cccc)2  t  、 5 21 .t  6 、 (°  t  式夕寸 。 ,、， 见又示可D5所 4 2  、 6  .  D6  c15 cll C7 C3  图6.24双重分组跳跃进位链的大组进位线路"}
{"doc_id": "co", "page": 294, "text": "288 第3篇中央处理器 由图可见，当D;、T;(i=5 ~ 8)及外来进位C_l形成后，再经过2.5ty便可同时产生C15、C11、C吓 c3。至于D;和T;可由式(6.24)求得，它们都是由小组产生的，按其逻辑表达式可画出相应的电 路。实际上只需对图6.21略做修改便可得双重分组进位链中的小组进位链线路，该线路能产生 D,和T;，如图6.25所示。 D8  T8  c2 C1 C。 d3 t 3  dz t2 d1 t1 d。t。 C一1 图6.25双重分组跳跃进位链的小组进位线路 可见，每小组可产生本小组的本地进位D;和传送条件t以及组内的各低位进位，但不能产 生组内最高位进位，即第五组形成D\"兀、C14、c13、C12，不产生C15；第六组形成D心兀、clO、C心 c8，不产生ell；第七组形成D7、T7、c6、C\"亿，不产生c7；第八组形成D心兀、化、Cl、C。，不产 生c3o  图6.24和图6.25两种类型的线路可构成16位加法器的双重分组跳跃进位链框图，如图 6.26所示。 c15 C11  c7  C3  C 一1 d15~42 t15~{2 d1广砱tl1～仓d,,d4 t,,t4 d3~。t3~t。 图6.2616位并行加法器的双重分组跳跃进位链框图 由图6.24、图6.25和图6.26可计算出从di、ti及C_l（外来进位）形成后开始，经2.5t)，形成 c2、cl、C。和全部D1、T!；再经2.5t)，形成大组内的4个进位C15、Cll、C7、亿；再经过2.5ty形成第"}
{"doc_id": "co", "page": 295, "text": "第6章计算机的运算方法289  五、六、七小组的其余进位c14、c13、c12、clO、C心队、化、C｀亿。可见，按双重分组设计n=16的进 位链，最长进位时间为7.5ty，比单重分组进位链又省了2.Sty o  对应图6.23所示的32位加法器的双重分组进位链，不难理解从d卢ti、C_l形成后算起，经 2. 5t)，产生C2,C1、C。及D1~Ds、Tl~TB；再经2.Sty后产生C15、ell、c7、亿；再经2.5ty后产生C18~ c16、C14~ C12、C10~Ca、C6~亿及c31、仁、c23、c19；最后经2.5t)，产生c30~ c2s、c26~ c24、C22~ C200  由此可见，产生全部进位的最长时间为lOt)'。若采用单重分组进位链，仍以4位一组分组，则产 生全部进位时间为2Oty，比双重分组多一倍。显然，随着n的增大，双重分组的优越性显得格外 突出。 机器究竟采用哪种方案，每个小组内应包含几位，应根据运算速度指标及所选元件等诸方面 因素综合考虑。 由上述分析可知，D1和T1均是由小组进位链产生的，它们与低位进位无关。而D;和Ti又 是大组进位链的输入，因此，引入D;和Tl可采用双重分组进位链，大大提高了运算速度。 6.5.1节介绍的74181芯片是4位ALU电路，其4位进位是同时产生的，多片74181级联就 犹如本节介绍的单重分组跳跃进位，即组内(74181片内）并行，组间(74181片间）串行。74181 芯片的G、P输出就如本节介绍的D、T。当需要进一步提高进位速度时，将74181与74182芯片 配合，就可组成双重分组跳跃进位链，如图6.27所示。 G P C21 C23 C19 GP C11 c7 c3  图6.27由74181和74182组成双重分组跳跃进位链 图中74182为先行进位部件，两片74182和8片74181组成32位ALU电路，该电路采用双 重分组先行进位方案，原理与图6.23类似，不同点是74182还提供了大组的本地进位G和大组 的传送条件P。 6.1 最少用几位二进制数即可表示任一5位长的十进制正整数？ 6.2 已知X=O.a1 a2a3a4a5a6(a;为0或1)，讨论下列几种情况时a1各取何值。 1  (1) X>— 2"}
{"doc_id": "co", "page": 296, "text": "290  (2) x~—-8  (3)—~x>-— 4 16  第3篇中央处理器 6.3 设x为整数，［x］补＝1,x产产贷卢5，若要求x<-16，试间x1~x5应取何值？ 6.4 设机器数字长为8位（含1位符号位在内），写出对应下列各真值的原码、补码和反码。 13 29  -——100, -87 64'128'  6.5 已知[x]补，求[x]原和x。 [x]补＝1.ll00 ; [ x]补＝1.1001j [ X]补＝0.1110;[x]补＝1.0000; [x]补＝1,0101;[x]补＝1,1100; [x]补＝O,Olll;[x]补＝1,0000。 6.6 设机器数字长为8位（含1位符号位在内），分整数和小数两种情况讨论真值x为何值时，［x压＝ [x压成立。 6.7 设x为真值，x＊为绝对值，说明［－矿压＝［－x压能否成立。 6.8 若[x]补＞［y]补，讨论是否有x>y。 6.9 当十六进制数9BH和FFH分别表示为原码、补码、反码、移码和无符号数时，所对应的十进制数各为 多少（设机器数采用1位符号位）？ 6.10 在整数定点机中，设机器数采用1位符号位，写出士0的原码、补码、反码和移码，得出什么结论？ 6.11 已知机器数字长为4位（含1位符号位），写出整数定点机和小数定点机中原码、补码和反码的全部 形式，并注明其对应的十进制真值。 51 27  6.12 设浮点数格式为：阶码5位（含1位阶符），尾数11位（含1位数符）。写出—-－——7.375、-86.5所 128、1024、 对应的机器数。要求如下： (1)阶码和尾数均为原码。 (2)阶码和尾数均为补码。 (3)阶码为移码，尾数为补码。 6.13 浮点数格式同上题，当阶码基值分别取2和16时： (1)说明2和16在浮点数中如何表示。 (2)基值不同对浮点数什么有影响？ (3)当阶码和尾数均用补码表示，且尾数采用规格化形式，给出两种情况下所能表示的最大正数和非零最 小正数真值。 6.14 设浮点数字长为32位，欲表示士6万间的十进制数，在保证数的最大精度条件下，除阶符、数符各取1 位外，阶码和尾数各取几位？按这样分配，该浮点数溢出的条件是什么？ 6.15 什么是机器零？若要求全0表示机器零，浮点数的阶码和尾数应采用什么机器数形式？ 6.16 设机器数字长为16位，写出下列各种情况下它能表示的数的范围。设机器数采用1位符号位，答案 均用十进制数表示。 (1)无符号数。 (2)原码表示的定点小数。 (3)补码表示的定点小数。"}
{"doc_id": "co", "page": 297, "text": "(4)补码表示的定点整数。 (5)原码表示的定点整数。 第6章计算机的运算方法291  (6)浮点数的格式为：阶码6位（含1位阶符），尾数10位（含1位数符）。分别写出正数和负数的表示 范围。 (7)浮点数格式同(6)，机器数采用补码规格化形式，分别写出其对应的正数和负数的真值范围。 6.17 设机器数字长为8位（含1位符号位），对下列各机器数进行算术左移一位、两位，算术右移一位、两 位，讨论结果是否正确。 [x]原＝0.0011010;[x]补＝0.1010100j [ X]反＝1.0101111; [x]原＝1.1101000;[ X]补＝1.1101000 ; [ X]反＝1.1101000; [x]原＝1.0011001;[x]补＝1.0011001 j [ X]反＝1.0011001。 6.18 试比较逻辑移位和算术移位。 6.19 设机器数字长为8位（含1位符号位），用补码运算规则计算下列各题。 9 13 (1) A=—B=－—，求A+B。 64'32  19 17 (2) A=—,B=－—-，求A-B。 32, 128  3 9 (3) A=-77,B=—，求A+B。 16, 32  (4) A=-87,B=53，求A-B。 (5) A = 115, B = -24，求A+B。 6.20 用原码一位乘、两位乘和补码一位乘(Booth算法）、两位乘计算x·y。 (1) x=0.110111,y=-0.101110。 (2) x=-0.010111,y=-0.010101。 (3) x=l9,y=35。 (4) x=0.11011,y=-0.11101。 6.21 用原码加减交替法和补码加减交替法计算x+y。 (1) x=0.100111,y=0.101011。 (2) x=-0.10101,y=0.11011。 (3) X = 0, 10100,y= -0.10001。 13 27 (4) X=—y=－—。 32'32  6.22 设机器数字长为16位（含1位符号位），若一次移位需1µ,s，一次加法需1µ,s，试问原码一位乘、补码 一位乘、原码加减交替除和补码加减交替法最多各需多少时间？ 6.23 画出实现Booth算法的运算器框图。要求如下： (1)寄存器和全加器均用方框表示，指出寄存器和全加器的位数。 (2)说明加和移位的次数。 (3)详细画出最低位全加器的输入电路。 (4)描述Booth算法重复加和移位的过程。 6.24 画出实现补码加减交替法的运算器框图。要求如下："}
{"doc_id": "co", "page": 298, "text": "292 第3篇中央处理器 (1)寄存器和全加器均用方框表示，指出寄存器和全加器的位数。 (2)说明加和移位的次数。 (3)详细画出第5位（设n为最低位）全加器的输入电路。 (4)画出上商的输入电路。 (5)描述商符的形成过程。 6.25 对于尾数为40位的浮点数（不包括符号位在内），若采用不同的机器数表示，试问当尾数左规或右规 时最多移位次数各为多少？ 6.26 按机器补码浮点运算步骤计算［无土y]沪 (1) x=r011X0.101100,y=r010X(-Q.Qlll00)。 (2) x=2-011x(-0.100010),y=2-010x(-0.011111)。 (3) x=2101x(-0.100101),y=2100x(-0.001111)。 6.27 假设阶码取3位，尾数取6位（均不包括符号位），计算下列各题。 1 1 9 (1) [ 25 X—-]+[24x(-—-) ]。 16 16  13 (2) [ 2-3 X—] －［2-4x(-~)]。 16 8  l3 9 (3) [23x—]X [ 24 X (-—) ］。 16 16  11 (4) [26x(-—) ]+[23X(－竺）］。 1 6 16  57 (5) [23x(-1)] x[2-2 X— 64  (6) [ 2 -6 X (-1) ] + [ 2 7 X (-—) ］。 (7) 3. 3125 + 6.125。 (8) 14.75-2.4375。 6.28 如何判断定点和浮点补码加减运算结果是否溢出，如何判断原码和补码定点除法运算结果是否 溢出？ 6.29 设浮点数阶码取3位，尾数取6位（均不包括符号位），要求阶码用移码运算，尾数用补码运算，计算 x•y，且结果保留1倍字长。 (1) X = 2-lOO XQ.101101,y= 2-0ll X (-0.110101)。 (2) x=2-011x(-O.lOOlll),y=2101X(-0.101011)。 6.30 机器数格式同上题，要求阶码用移码运算，尾数用补码运算，计算x+y。 (1) x=2101x0.100111,y=2°11x(-O.lOlOll)。 (2) x=2110x(-0.101101),y=2°11x(-O.llllOO)。 6.31 设机器字长为32位，用与非门和与或非门设计一个并行加法器（假设与非门的延迟时间为30ns，与 或非门的延迟时间为45ns)，要求完成32位加法时间不得超过0.6µ,s。画出进位链及加法器逻辑框图。 6.32 设机器字长为16位，分别按4、4、4、4和5、5、3、3分组后，要求： (1)画出两种分组方案的单重分组并行进位链框图，并比较哪种方案运算速度快。"}
{"doc_id": "co", "page": 299, "text": "第6章计算机的运算方法 (2)画出两种分组方案的双重分组并行进位链，并对这两种方案进行比较。 (3)用74181和74182画出单重和双重分组的并行进位链框图。 附录6A各种进位制 6A.1 各种进位制的对应关系 293  表6.33是十进制数、二进制数、十六进制数对照表。书写时，可在十六进制数后面加上 “H\"，如17DBH或(17DB)十六；若在数的后面加上“B\"，如10101100B,即表示此数为二进制数， 或写成(10101100)二 表6.33十进制数、二进制数、十六进制数对照表 十进制数二进制数十六进制数十进制数二进制数十六进制数 。00000 。16 1 0 0 0 0 10  1 0 0 0 0 1 1 17 1 0 0 0 1 11  2 0 0 0 1 0 2 18 1 0 0 1 0 12  3 0 0 0 1 1 3 19 1 0 0 1 1 13  4 00100 4 20 1 0 1 0 0 14  5 0 0 1 0 1 5 21 1 0 1 0 1 15  6 0 O 1 1 0 6 22 1 0 1 1 0 16  7 0 0 1 1 1 7 23 1 0 1 1 1 17  8 0 1 0 0 0 8 24 1 1 0 0 0 18  9 0 1 0 0 1 9 25 1 1 0 0 1 19  10 0 1 0 1 0 A 26 1 1 0 1 0 lA  11 0 1 0 1 1 B 27 1 1 0 1 1 1B  12 O 1 1 0 0 C 28 1 1 1 0 0 lC  13 0 1 1 0 1 D 29 1 1 1 0 1 lD  14 0 1 1 1 0 E 30 1 1 1 1 0 1E  15 0 1 1 1 1 F 31 1 1 1 1 1 lF  6A.2 各种进位制的转换 任意一个数N可用下式表示： N =(dn_ldn-2\"'d1d。.d_1d-2·\"d_m)r = dn-1 rn-1 +dn-2尸＋..,+d1r1+d。产＋d-l尸＋..,+dmr-m n-1  三肛 l = -m  其中，r为基值；n、m为正整数，分别代表整数位和小数位的位数汛为系数，代表第i位的一个数 码，可以是0~ (r-1)数码中的任意一个矿为第i位的权数。"}
{"doc_id": "co", "page": 300, "text": "294  1.二进制数转换成十进制数 (1)按“权”展开法 第3篇中央处理器 例如(11011.1)二＝1X 2 4 + 1 X 2 3 + 0 X 2 2 + 1 X 2 1 + 1 X 2° + 1 X 2-1  =27.5  (2)按基值重复相乘（除）法 ·整数部分采用基值重复相乘法 | t  1列如(101001)二＝((((1 x2 +O) x2 +1) x2 +O) x2 +O) x2 +1 =41  ·小数部分采用基值重复相除 | t  1列女廿(0.1011)二＝((((1 + 2) + 1) + 2 + 0) + 2 + 1) + 2 + 0 = 0. 6895  2.十进制数转换成二进制数 (1)重复相除（乘）法 这种方法的规则是整数部分除以2取余数，直到商为0止；小数部分乘以2取整数，直到小 数部分为0止（或按精度要求确定位数）。 例将十进制数123.6875转换成二进制数。 解：整数部分 重复除以2 123+2  61+2  30+2  15+2  7+2  3+2  1+2  故整数部分(123)+ = (1111011)三 小数部分 重复乘以2 0.6875x2  0.3750x2  0. 7500X2  0.5000x2  得商 61  30  15  7  3  1  。 得小数部分 0.3750  0.7500  0.5000  0.0000  取余数 1 最低位 1  。 1  1  1  1 最高位 取整数 1 最高位 。 1  1 最低位"}
{"doc_id": "co", "page": 301, "text": "第6章计算机的运算方法295  故小数部分(0.6875)-t= (0.1011)二 所以(123. 6875) -t = (1111011.1011)二 (2)减权定位法 当十进制数较大时，采用减权定位法可减少重复除法（或乘法）的次数。 例将十进制数5148转换成二进制数，可按下列步骤进行。 十进制数位权转换后的结果 5148 212 211 210 29 28 27 26 25 24 i3 22 21 20  -4096 212一1。1 。 。。 。 。1 1 1 。 。 1052  t  I  -1024 2 10  28  -16 24  12  -8 23  4  -4 22  。 民p(5148) + = (1010000011100) ~ 0 十 可见，只要从5148中减去所含的最大的2的方幕4096，根据212= 4096，确定该权值对应的 二进制数的位置（即数位），然后再从减得的1052中减去所含的最大的2的方幕1024，又得该权 值对应的数位，这样依次继续，直到差为0。最后在有权值的对应数位上添l，无权值的对应数位 上添0，便得转换结果。 3.二进制数与八、十六进制数之间的转换 由于23=8,24=16，故3位二进制数正好对应一位八进制数，4位二进制数正好对应一位十 六进制数，因此可按下述方法将二进制数转换成八、十六进制数。 例如： 1111000010.01101  t  分组起点 高位补0，凑足3位 』 低位补0，凑足3位 』 001 111 000 010. 011 010  1 7 0 2. 3 2"}
{"doc_id": "co", "page": 302, "text": "296 第3篇中央处理器 故对应的八进制数为(1702.32)八＝（1111000010.01101)二0 高位补0，凑足4位低位补0，凑足4位 上上 0011 1100 0010. 0110 1000  3 C 2. 6 8  故对应的十六进制数为(3C2.68)十六＝（1111000010.01101)三 反之，将一位八进制数用3位二进制数表示，或一位十六进制数用4位二进制数表示，便可 将八进制或十六进制数转换成二进制数。 例如： (247.63)八＝(10100111. 110011)二 (FSB.48)-t六＝（111101011011.01001)二 附录6B阵列乘法器和阵列除法器 图6.28是一个完成X(X=X1凡凡凡）Xy (y = yl Y2 Y3凡）绝对值相乘的阵列乘法器原理图。 图中方框的排列形式与笔算乘法的位积排列相似。阵列的每一行由乘数Y的每一位数位控制， 而各行错开形成的每一斜列则由被乘数X的每一位数位控制。图中方框内的电路由一个与门 和一个一位全加器组成。由于采用阵列结构，加法器数量很多，不靠“重复加和移位”的步骤运 算，因此可大大提高乘法速度。该方案中虽然加法器数量多，但内部结构规则，标准化程度高，适 部分积入 位t__ __:_ 3 ----4... 5 6 7  Y  乘积P=P4 图6.28绝对值相乘的阵列乘法器 8 丿"}
{"doc_id": "co", "page": 303, "text": "第6章计算机的运算方法297  于用超大规模集成电路实现。 图6.29是一个完成X(X=X1凡凡凡凡凡）+Y(Y=Y1凡凡）绝对值相除的不恢复余数除法 器原理图。图中的每一个方框为一个可控加法／减法(CAS)单元，当输入控制P=O时，CAS 做加法运算；当P=l时，CAS做减法运算。被除数Xl～凡由顶部一行和最右边对角线（斜 列）上各CAS的垂直输入端提供；除数yl～凡则沿对角线方向进入阵列，其作用是使余数固 定（不左移）而除数右移，类似笔算除法；商Q1化化由阵列每一行最左边的CAS的进位输出 Ci+l产生；余数R3～凡在阵列的最下行产生。由于绝对值除和6.3.4节所述的原码除中数值 部分的运算完全相同，故运算过程中需作X+Y和X-Y操作，而减法均用[IXI]补＋［－IYI］补实 现，因此阵列除法器中必有一些CAS单元用于对应符号位的运算，例如图6.29中每行最左边 的小方框（共4个CAS)。 .I  yp  。。y1  10  Ql  X1  y2 y3 X2  X3 ---- -------- 14 －一气 xl  Q2  p  cl  戈 (b)可控加法／减法(CAS)单元 Y 勹 Q3  余数R=R3凡R5  (a) 4位不恢复余数阵列除法器 R6  被除数X=O.X1X2凡凡凡凡 数Y=0. Y1Y2凡 商Q=O.Q从Q3 数R=O.OOR戊尤R6 图6.29 除 余 绝对值相除的阵列除法器"}
{"doc_id": "co", "page": 304, "text": "298 第3篇中央处理器 以绝对值整数除法为例，第一步检查是否溢出，由第一行完成X1凡凡－Y1Y2凡操作，故控制 电位P=l。减法用[X]tr+[ -I y|]补实现，正好用P=l作为第一行末位CAS的进位输入。由于 X<Y，所以相减后符号位的进位输出为0，即商为0，表示未溢出，除法可继续进行。此商接到第 二行的P端，决定第二行做加法。同理每个当前商反馈到下一行，决定下一行是做加法还是减 法，满足”上商l做减法，上商0做加法”的运算规则。 例设x= l O 1001, y = 111，用阵列除法器计算x+y。 解：[X * ]补＝0,101001;［广］补＝0,111 ; [ -y * ]朴＝1,001 被除数x0, 101001 商控制端 减除数y+ 1,001 P=l  余数为负1, 110001 Q。=0未溢出P=O  余数左移1, 10001  加除数+ o, 111  余数为正0,01101 Ql =1 P=l  余数左移0, 1101  减除数+ 1,001  余数为负1, 1111 Q2 =O P=O  余数左移1,111  加除数+ 0, 111  0, 110 Q3,= 1  故商为Q1化化＝101；余数为R4凡凡＝110。 附6C 路 图6.30所示是74181ALU的负逻辑电路，其逻辑关系如表6.32所示。"}
{"doc_id": "co", "page": 305, "text": "第6章计算机的运算方法299  瓦 -P  4 +  cn -G -Fl B = A -F2 -Fo  8382SlSo  -A3  3  -B  困元l  -A  l  -B  瓦A1M C_l  图6.30负逻辑操作数表示的74181ALU电路"}
{"doc_id": "co", "page": 306, "text": "本章主要介绍机器指令系统的分类、常见的寻址方式、指令格式以及设计指令系统时应考虑 的各种因素。此外对RISC技术也进行简要的介绍，希望读者进一步体会指令系统与机器的主 要功能以及与硬件结构之间存在的密切关系。 7.1 机器指令 由第1章可知，计算机能解题是由于机器本身存在一种语言，它既能理解人的意图，又能被 机器自身识别。机器语言是由一条条语旬构成的，每一条语旬又能准确表达某种语义。例如，它 可以命令机器做某种操作，指出参与操作的数或其他信息在什么地方等。计算机就是连续执行 每一条机器语旬而实现全自动工作的。人们习惯把每一条机器语言的语旬称为机器指令，而又 将全部机器指令的集合称为机器的指令系统。因此机器的指令系统集中反映了机器的功能。 计算机设计者主要研究如何确定机器的指令系统，如何用硬件电路、芯片、设备来实现机器 指令系统的功能。计算机的使用者则是依据机器提供的指令系统，使用汇编语言来编制各种程 序。计算机使用者根据机器指令系统所描述的机器功能，能很清楚地了解计算机内部寄存器－ 存储器的结构，以及计算机能直接支持的各种数据类型。 7。1.1指令的一般格 指令是由操作码和地址码两部分组成的，其基本格式如图7.1所示。 1.操作码 操作码用来指明该指令所要完成的操作，如加法、减法、［三三三三］地址码字段 传送、移位、转移等。通常，其位数反映了机器的操作种类， 也即机器允许的指令条数，如操作码占7位，则该机器最多图7.1指令的一般格式 包含27= 128条指令。 操作码的长度可以是固定的，也可以是变化的。前者将操作码集中放在指令字的一个字段 内，如图7.1所示。这种格式便于硬件设计，指令译码时间短，广泛用千字长较长的、大中型计算 机和超级小型计算机以及RISC(Reduced Instruction Set Computer)中。例如，IBM370和VAX-11 系列机，操作码长度均为8位。"}
{"doc_id": "co", "page": 307, "text": "第7章指令系统301  对于操作码长度不固定的指令，其操作码分散在指令字的不同字段中。这种格式可有效地 压缩操作码的平均长度，在字长较短的微型计算机中被广泛采用。例如PDP-11、Intel8086/  80386等操作码的长度是可变的。 操作码长度不固定会增加指令译码和分析的难度，使控制器的设计复杂。通常采用扩展 操作码技术，使操作码的长度随地址数的减少而增加，不同地址数的指令可以具有不同长度 的操作码，从而在满足需要的前提下，有效地缩短指令字长。图7.2是一种扩展操作码的安排 示意图。 OP A1 A2 A3  4位操作码 8位操作码 12位操作码 16位操作码 OlO OOl oo … l  OOl ll1  AA … A  A3  A3  . . .  A3  222 AA … A  l11 l11 l1 … l  l11 OlO  l  0  00 OOl OOl 333 AA … A  222 AA … A  111 111 11 … 1  l11 111 1l1 11 … l  l11 l1l 11l  l  0  l1 lll 011 OOl 00:·1 OOl  15条三地址指令 15条二地址指令 l11 111 11 … 1  111 l11 111 l1 … 1  lll 0000  0001  . . .  1110  333 AA … A  15条一地址指令 16条零地址指令 图7.2一种扩展操作码的安排示意图 图7.2中指令字长为16位，其中4位为基本操作码字段OP，另有3个4位长的地址字段为 Al、A心儿。4位基本操作码若全部用于三地址指令，则有16条。若采用扩展操作码技术，如图 7.2所示，当操作码取4位时，三地址指令最多为15条；操作码取8位时，二地址指令最多为15 条；操作码取12位时，一地址指令最多为15条；操作码取16位时，零地址指令为16条。共61 条。可见操作码的位数随地址数的减少而增加。 除了这种安排以外，还有其他多种扩展方法，例如，形成15条三地址指令、12条二地址指 令、31条一地址指令和16条零地址指令，共74条指令，读者可自行安排。 例7.1假设指令字长为16位，操作数的地址码为6位，指令有零地址、一地址、二地址三种"}
{"doc_id": "co", "page": 308, "text": "302 第3篇中央处理器 格式。 (1)设操作码固定，若零地址指令有P种，一地址指令有Q种，则二地址指令最多有几种？ (2)采用扩展操作码技术，若二地址指令有X种，零地址指令有Y种，则一地址指令最多有 几种？ 解：（1)根据操作数地址码为6位，则二地址指令中操作码的位数为16-6-6= 4。这4位操 作码可有24= 16种操作。由于操作码固定，则除去了零地址指令P种，一地址指令Q种，剩下二 地址指令最多有16-P-Q种。 (2)采用扩展操作码技术，操作码位数可变，则二地址、一地址和零地址的操作码长度分别 为4位、10位和16位。可见二地址指令操作码每减少一种，就可多构成26种一地址指令操作 码；一地址指令操作码每减少一种，就可多构成26种零地址指令操作码。 因二地址指令有X种，则一地址指令最多有(24-X)X26种。设一地址指令有M种，则零地 址指令最多有[(24-X) X26-M] X26种。 根据题中给出零地址指令有Y种，即 Y= [ (24-X) X26-M] x26  则一地址指令 M= (24-X) x26-Yx2-6  在设计操作码不固定的指令系统时，应尽量考虑安排指令使用频度（即指令在程序中出现 的概率）高的指令占用短的操作码，对使用频度低的指令可占用较长的操作码，这样可以缩短经 常使用的指令的译码时间。当然，考虑操作码长度时也应考虑地址码的要求。 2.地址码 地址码用来指出该指令的源操作数的地址（一个或两个）、结果的地址以及下一条指令的地 址。这里的“地址”可以是主存的地址，也可以是寄存器的地址，甚至可以是I/0设备的地址。 下面以主存地址为例，分析指令的地址码字段。 (1)四地址指令 这种指令的地址字段有4个，其格式如下： I OP I Al I凡A3 A4  其中，OP为操作码；Al为第一操作数地址；儿为第二操作数地址；凡为结果地址；儿为下一条 指令的地址。 该指令完成(A1)0P(A2)一凡的操作。这种指令直观易懂，后续指令地址可以任 可直接寻址的地址范围与地址字段的位数有关。如果指令字长为32位，操作码占8位，4个地 址字段各占6位，则指令操作数的直接寻址范围为26= 64。如果地址字段均指示主存的地址，则 完成一条四地址指令，共需访问4次存储器（取指令一次，取两个操作数两次，存放结果一次）。 因为程序中大多数指令是按顺序执行的，而程序计数器PC既能存放当前欲执行指令的地 址，又有计数功能，因此它能自动形成下一条指令的地址。这样，指令字中的第四地址字段儿便"}
{"doc_id": "co", "page": 309, "text": "第7章指令系统303  可省去，即得三地址指令格式。 (2)三地址指令 三地址指令中只有3个地址，其格式如下： I OP I Al I凡A3  它可完成(A1)0P(A2)一凡的操作，后续指令的地址隐含在程序计数器PC之中。如果 指令字长不变，设OP仍为8位，则3个地址字段各占8位，故三地址指令操作数的直接寻址 范围可达28= 256。同理，若地址字段均为主存地址，则完成一条三地址指令也需访问4次存 储器。 机器在运行过程中，没有必要将每次运算结果都存入主存，中间结果可以暂时存放在CPU 的寄存器（如ACC)中，这样又可省去一个地址字段A3，从而得出二地址指令。 (3)二地址指令 二地址指令中只含两个地址字段，其格式如下： I OP I AI I凡 它可完成(A1)0P(A2)---+Al的操作，即A]字段既代表源操作数的地址，又代表存放本次运 算结果的地址。有的机器也可以表示(A1)0P(A2)一凡的操作，此时凡除了代表源操作数的 地址外，还代表中间结果的存放地址。这两种情况完成一条指令仍需访问4次存储器。如果使 其完成(A1)0P(A2)---+ACC，此时，它完成一条指令只需3次访存，它的含义是中间结果暂存 累加器ACC中。在不改变指令字长和操作码的位数前提下，二地址指令操作数的直接寻址范围 为212= 4 K。 如果将一个操作数的地址隐含在运算器的ACC中，则指令字中只需给出一个地址码，构成 一地址指令。 (4)一地址指令 一地址指令的地址码字段只有一个，其格式如下： 厂Al 它可完成(ACC)OP(Al)---+ACC的操作，ACC既存放参与运算的操作数，又存放运算的中间 结果这样，完成一条一地址指令只需两次访存。在指令字长仍为32位、操作码位数仍固定为8 位时，一地址指令操作数的直接寻址范围达2气即16M。 在指令系统中，还有一种指令可以不设地址字段，即所谓零地址指令。 (5)零地址指令 零地址指令在指令字中无地址码，例如，空操作(NOP)、停机(HLT)这类指令只有操作码。 而子程序返回(RET)、中断返回(IRET)这类指令没有地址码，其操作数的地址隐含在堆栈指针 SP中（有关堆栈的概念详见7.3.2节）。 通过上述介绍可见，用一些硬件资源（如PC、ACC)承担指令字中需指明的地址码，可在不改"}
{"doc_id": "co", "page": 310, "text": "304 第3篇中央处理器 变指令字长的前提下，扩大指令操作数的直接寻址范围。此外，用PC、ACC等硬件代替指令字 中的某些地址字段，还可缩短指令字长，并可减少访存次数。因此，究竟采用什么样的地址格式， 必须从机器性能出发综合考虑。 以上讨论的地址格式均以主存地址为例，实际上地址字段也可用来表示寄存器。当CPU中 含有多个通用寄存器时，对每一个寄存器赋予一个编号，便可指明源操作数和结果存放在哪个寄 存器中。地址字段表示寄存器时，也可有三地址、二地址、一地址之分。它们的共同点是，在指令 的执行阶段都不必访问存储器，直接访问寄存器，使机器运行速度得到提高（因为寄存器类型的 指令只需在取指阶段访问一次存储器）。 7.1.2 指令字长 指令字长取决于操作码的长度、操作数地址的长度和操作数地址的个数。不同机器的指令 字长是不相同的。 早期的计算机指令字长、机器字长和存储字长均相等，因此访问某个存储单元，便可取出一 条完整的指令或一个完整的数据。这种机器的指令字长是固定的，控制方式比较简单。 随着计算机的发展，存储容量的增大，要求处理的数据类型增多，计算机的指令字长也发 生了很大的变化。一台机器的指令系统可以采用位数不相同的指令，即指令字长是可变的， 如单字长指令、多字长指令。控制这类指令的电路比较复杂，而且多字长指令要多次访问存 储器才能取出一条完整的指令，因此使CPU速度下降。为了提高指令的运行速度和节省存储 空间，通常尽可能把常用的指令（如数据传送指令、算逻运算指令等）设计成单字长或短字长 格式的指令。 例如，PDP-8指令字长固定取12位；NOVA指令字长固定取16位；IBM370指令字长可变， 可以是16位（半个字）、32位（一个字）、48位（一字半）;Intel 8086的指令字长可以为8、16、24、 32、40和48位六种。通常指令字长取8的整数倍。 7.2 操作数类型和操作类型 7。2。1操作数类型 机器中常见的操作数类型有地址、数字、字符、逻辑数据等。 (1)地址 地址实际上也可看作是一种数据，在许多情况下要计算操作数的地址。这时，地址可被认为 是一个无符号的整数，有关地址的计算问题将在7.3节讨论。"}
{"doc_id": "co", "page": 311, "text": "第7章指令系统305  (2)数字 计算机中常见的数字有定点数、浮点数和十进制数。前两种数字在第6章中已进行了介绍， 十进制数已在第5章附录中说明，读者可自行复习。 (3)字符 在应用计算机时，文本或者字符串也是一种常见的数据类型。由千计算机在处理信息过程 中不能以简单的字符形式存储和传送，因此普遍采用ASCII码（见表5.2)，它是很重要的一种 符编码。当然还有其他一些字符编码，如8位EBCDIC码(ExtendedBinary Coded Decimal Inter­ change Code)，又称扩展BCD交换码，在此不做详述。 (4)逻辑数据 计算机除了做算术运算外，有时还需做逻辑运算，此时n个0和1的组合不是被看作算术数 字，而是被看作逻辑数。例如，在ASCII码中的0110101，它表示十进制数5，若要将它转换为NB­ CD短十进制码，只需通过它与逻辑数0001111完成逻辑与运算，抽取低4位，即可获得0101。此 外，有时希望存储一个布尔类型的数据，它们的每一位都代表着真(1)和假(0)，这时n个0和1 组合的数就都被看作逻辑数。 例如，奔腾处理器的数据类型有逻辑数、有符号数（补码）、无符号数、压缩和未压缩的BCD 码、地址指针、位串、字符串以及浮点数（符合IEEE754标准）等。 数 的存放 通常计算机中的数据存放在存储器或寄存器中，而寄存器的位数便可反映机器字长。一般 机器字长可取字节的1、2、4、8倍，这样便千字符处理。在大、中型机器中字长为32位和64位， 在微型计算机中字长从4位、8位逐渐发展到目前的16位、32位和64位。 由于不同的机器数据字长不同，每台机器处理的数据字长也不统一，例如奔腾处理器可处理 8（字节）、16（字）、32（双字）、64(四字）；PowerPC可处理8（字节）、16（半字）、32（字）、64（双 字）。因此，为了便于硬件实现，通常要求多字节的数据在存储器的存放方式能满足＂边界对准” 的要求，如图7.3所示。 图7.3中所示的存储器存储字长为32位，可按字节、半字、字、双字访问。在对准边界的32 位字长的计算机中（如图7.3(a)所示），半字地址是2的整数倍，字地址是4的整数倍，双字地址 是8的整数倍。当所存数据不能满足此要求时，可填充一个至多个空臼字节。而字节的次序有 两种，如图7.4所示，其中7.4(a)表示低字节为低地址，图7.4(b)表示高字节为低地址。 在数据不对准边界的计算机中，数据（例如一个字）可能在两个存储单元中，此时需要访问 两次存储器，并对高低字节的位置进行调整后才能取得一个字，图7.3(b)的阴影部分即属于这 种情况。"}
{"doc_id": "co", "page": 312, "text": "306  作类型 第3篇中央处理器 存储器地址（十进制） 字（地址0)。 字（地址4)4  字节（地址11)字节（地址10)字节（地址9)字节（地址8)8  字节（地址15)字节（地址14)字节（地址13)字节（地址12)12  半字（地址18)半字（地址16) 半字（地址22)半字（地址20) 双字（地址24) 双字 双字（地址32) 双字 (a)对准边界 存储器 字（地址2)半字（地址O) 字（地址4) 字节（地址7)1字节（地址6) 半字（地址10)1 半字（地址8) (b)不对准边界 图7.3存储器中数据的存放 字地址字地址 16  20  24  28  32  36  地址（十进制） 。 4  8  汇三 (a)低字节为低地址 ：三 (b)高字节为低地址 图7.4两种字节次序 不同的机器，操作类型也是不同的，但几乎所有的机器都有以下几类通用的操作。 1.数据传送 数据传送包括寄存器与寄存器、寄存器与存储单元、存储单元与存储单元之间的传送。如从 源到目的之间的传送、对存储器读(LOAD)和写(STORE)、交换源和目的的内容、置1、清零、进 栈、出栈等。 2.算术逻辑操作 这类操作可实现算术运算（加、减、乘胎汇增l、减1、取负数即求补）和逻辑运算（与、或、非、"}
{"doc_id": "co", "page": 313, "text": "第7章指令系统307  异或）。对于低档机而言，一般算术运算只支持最基本的二进制加减、比较、求补等，高档机还能 支持浮点运算和十进制运算。 有些机器还具有位操作功能，如位测试（测试指定位的值）、位清除（清除指定位）、位求反 （对指定位求反）等。 3.移位 移位可分为算术移位、逻辑移位和循环移位三种。算术移位和逻辑移位分别可实现对有符 号数和无符号数乘以2飞左移）或整除以2飞右移）的运算，并且移位操作所需时间远比乘除操作 执行时间短，因此，移位操作经常被用来代替简单的乘法和除法运算。 4.转移 在多数情况下，计算机是按顺序执行程序的每条指令的，但有时需要改变这种顺序，此刻可 采用转移类指令来完成。转移指令按其转移特征又可分为无条件转移、条件转移、跳转、过程调 用与返回、陷阱(Trap)等几种。 (1)无条件转移 无条件转移不受任何条件约束，可直接把程序转移到下一条需执行指令的地址。例如“JMPX\",  其功能是将指令地址无条件转至X。 (2)条件转移 条件转移是根据当前指令的执行结果来决定是否需要转移。若条件满足，则转移；若条件不 满足，则继续按顺序执行。一般机器都能提供一些条件码，这些条件码是某些操作的结果。例 如：零标志位(Z)，结果为O,Z=1；负标志位(N)，结果为负，N=l；溢出标志位(V)，结果有溢出， V=l；进位标志位(C)，最高位有进位，C=l；奇偶标志位(P)，结果呈偶数，P=l等。 例如，指令“BROX”表示若结果（有符号数）溢出(V=l)，则指令跳转至X。例如，指令 \"BRC Y”表示若最高位有进位(C= 1)，则指令跳转至Y。 还有一种条件转移指令，SKP(Skip)，它暗示其下一条指令将被跳过，从而隐含了转移地址 SKP后的第二条指令。例如： 200  205 SKP DZ  206  207  这里“SKPDZ”表示若设备的完成触发器D为零，则执行完205条指令后，立即跳至第207 条指令，再顺序执行。 (3)调用与返回 在编写程序时，有些具有特定功能的程序段会被反复使用。为避免重复编写，可将这些程序 段设定为独立子程序，当需要执行某子程序时，只需用子程序调用指令即可。此外，计算机系统 还提供了通用子程序，如申请资源、读写文件、控制外设等。需要时均可由用户直接调用，不必重"}
{"doc_id": "co", "page": 314, "text": "308 第3篇中央处理器 新编写。 通常调用指令包括过程调用、系统调用和子程序调用。它可实现从一个程序转移到另一个 程序的操作。 调用指令(CALL)一般与返回指令(RETURN)配合使用。CALL用千从当前的程序位置转 至子程序的入口；RETURN用于子程序执行完后重新返回到原程序的断点。图7.5示意了调用 (CALL)和返回(RETURN)指令在程序执行中的流程。 地址主程序 I  2000  2100 I CALL SUB 1  2101  子程序SUBl 2400  蜇ICALLSUB2  2560 I CALL SUB2  2561  RETURN  子程序SUB2 270。二 (a)主存空间分配(b)程序执行流程 图7.5调用和返回指令示意图 图7.5(a)示意了主程序和子程序在主存所占空间。主程序从2000地址单元开始，并在 2100处有一个调用指令，当执行到2100处指令时，CPU停止下一条顺序号为2101的指令，而转 2400执行SUBl子程序。在SUBl中又有两次(2500和2560处）调用子程序SUB2。每一次 都将SUBl挂起，而执行SUB2。子程序末尾的RETURN指令可使CPU返回调用点。 图7.5(b)示意了主程序---+SUBl一SUB2---+SUB1---+SUB2---+SUB 1---+主程序的执行流程。 需要注意以下几点。 ·子程序可在多处被调用。 ·子程序调用可出现在子程序中，即允许子程序嵌套。 ·每个CALL指令都对应一条RETURN指令。"}
{"doc_id": "co", "page": 315, "text": "第7章指令系统309  由于可以在许多处调用子程序，因此，CPU必须记住返回地址，使子程序能准确返回。返回 地址可存放在以下3处。 ·寄存器内。机器内设有专用寄存器，专门用于存放返回地址。 0子程序的入口地址内。 ·栈顶内。现代计算机都设有堆栈，执行RETURN指令后，便可自动从栈顶内取出应返回 的地址。 (4)陷阱(Trap)与陷阱指令 陷阱其实是一种意外事故的中断。例如，机器在运行中，可能会出现电源电压不稳定、存储 器校验出差错、输入输出设备出现了故障、用户使用未被定义的指令、除数出现为0、运算结果溢 出以及特权指令等种种意外事件，致使计算机不能正常工作。此刻必须及时采取措施，否则将影 响整个系统的正常运行。因此，一旦出现意外故障，计算机就发出陷阱信号，暂停当前程序的执 行，转入故障处理程序进行相应的故障处理。 计算机的陷阱指令一般不提供给用户直接使用，而作为隐指令（即指令系统中不提供的指 令），在出现意外故障时，由CPU自动产生并执行。也有的机器设置供用户使用的陷阱指令或 ＂访管”指令，利用它完成系统调用和程序请求。例如，IBMPC (Intel 8086)的软中断INTTYPE  (TYPE是8位常数，表示中断类型），其实就是直接提供给用户使用的陷阱指令，用来完成系统 调用。 5.输入输出 对于I/0单独编址的计算机而言，通常设有输入输出指令，它完成从外设中的寄存器读入一 个数据到CPU的寄存器内，或将数据从CPU的寄存器输出至某外设的寄存器中。 6.其他 其他包括等待指令、停机指令、空操作指令、开中断指令、关中断指令、置条件码指令等。 为了适应计算机的信息管理、数据处理及办公自动化等领域的应用，有的计算机还设有非数 值处理指令。如字符串传送、字符串比较、字符串查询及字符串转换等。 在多用户、多任务的计算机系统中，还设有特权指令，这类指令只能用于操作系统或其他系 统软件，用户是不能使用的。 在有些大型或巨型机中，还设有向量指令，可对整个向量或矩阵进行求和、求积运算。在多 处理器系统中还配有专门的多处理机指令。 7.3 寻址方式 寻址方式是指确定本条指令的数据地址以及下一条将要执行的指令地址的方法，它与硬件 结构紧密相关，而且直接影响指令格式和指令功能。 寻址方式分为指令寻址和数据寻址两大类。"}
{"doc_id": "co", "page": 316, "text": "310 第3篇中央处理器 7。3.1指址 指令寻址比较简单，它分为顺序寻址和跳跃寻址两种。 顺序寻址可通过程序计数器PC加1，自动形成下一条指令的地址；跳跃寻址则通过转移类 指令实现。图7.6示意了指令寻址过程。 指令指令地址寻址方式 。LDA 1000  1 ADD 1001 顺序寻址 2 DEC 1200 顺序寻址 3 JMP 7 顺序寻址 4 LDA 2000  5 SUB 2001  6 INC  7 STA 2500 跳跃寻址 8 LDA 1100 顺序寻址 9 ..  图7.6指令的寻址方式示意图 如果程序的首地址为0，只要先将0送至程序计数器PC中，启动机器运行后，程序便按0,1,  2,3,7,8,9,…顺序执行。其中第1、2、3号指令地址均由PC自动形成。因第3号地址指令为 \"JMP 7\"，故执行完第3号指令后，便无条件将7送至PC，因此，此刻指令地址跳过4、5、6三条， 直接执行第7条指令，接着又顺序执行第8条、第9条等指令。 关千跳跃寻址的转移地址形成方式，将在7.3.2节的直接寻址和相对寻址中做介绍。 数据寻址 数据寻址方式种类较多，在指令字中必须设一字段来指明属千哪一种寻址方式。指令的地址码 字段通常都不代表操作数的真实地址，故把它称为形式地址，记作A。操作数的真实地址称为有效地 址，记作EA，它是由寻址方式和形式地址共同来确定的。由此可得指令的格式应如图7.7所示。 | 操作码1 寻址特征I 形式地址AI  图7.7一种一地址指令的格式 为了便于分析研究各类寻址方式，假设指令字长、存储字长、机器字长均相同。 1.立即寻址 立即寻址的特点是操作数本身设在指令字内，即形式地址A不是操作数的地址，而是操作 数本身，又称之为立即数。数据是采用补码形式存放的，如图7.8所示，图中“#”表示立即寻址特"}
{"doc_id": "co", "page": 317, "text": "第7章指令系统311  征标记。 立即寻址特征 OP厂厂、1A I  ~_＿＿Y丿 立即数 图7.8立即寻址示意图 可见，它的优点在于只要取出指令，便可立即获得操作数，这种指令在执行阶段不必再访问 存储器。显然A的位数限制了这类指令所能表述的立即数的范围。 2.直接寻址 直接寻址的特点是，指令字中的形式地址A就是操作数的真实地址EA ，即 EA=A  图7.9示意了直接寻址。 寻址特征 二三 图7.9直接寻址示意图 它的优点是寻找操作数比较简单，也不需要专门计算操作数的地址，在指令执行阶段对主存 只访问一次。它的缺点在千A的位数限制了操作数的寻址范围，而且必须修改A的值，才能修 改操作数的地址。 3.隐含寻址 隐含寻址是指指令字中不明显地给出操作数的地址，其操作数的地址隐含在操作码或某个 寄存器中。例如，一地址格式的加法指令只给出一个操作数的地址，另一个操作数隐含在累加器 ACC中，这样累加器ACC成了另一个数的地址。图7.10示意了隐含寻址。 又如IBMPC (Intel 8086)中的乘法指令，被乘数隐含在寄存器AX(16位）或寄存器AL(8 位）中，可见AX（或AL)就是被乘数的地址。又如字符串传送指令MOVS，其源操作数的地址 隐含在SI寄存器中（即操作数在SI指明的存储单元中），目的操作数的地址隐含在DI寄存 器中。 由于隐含寻址在指令字中少了一个地址，因此，这种寻址方式的指令有利于缩短指令字长。 4.间接寻址 倘若指令字中的形式地址不直接指出操作数的地址，而是指出操作数有效地址所在的存储 单元地址，也就是说，有效地址是由形式地址间接提供的，即为间接寻址，即EA=(A)，如图7.11 所示。"}
{"doc_id": "co", "page": 318, "text": "312 第3篇中央处理器 寻址特征 广 三A 主存 另一个操作数 隐含在ACC中 图7.10隐含寻址示意图 间接寻址特征间接寻址特征 广三主存r  I OP I  ~A曰 I OP I  ~All  主存 (a)一次间接寻址(b)两次间接寻址 图7.11间接寻址示意图 图7.ll(a)为一次间接寻址，即A地址单元的内容EA是操作数的有效地址；图7.ll(b)为 两次间接寻址，即A地址单元的内容Al还不是有效地址，而由Al所指单元的内容EA才是有效 地址。 这种寻址方式与直接寻址相比，它扩大了操作数的寻址范围，因为A的位数通常小于指令 字长，而存储字长可与指令字长相等。若设指令字长和存储字长均为16位，A为8位，显然直接 寻址范围为28，一次间接寻址的寻址范围可达216。当多次间接寻址时，可用存储字的首位来标 志间接寻址是否结束。如图7.ll(b)中，当存储字首位为“1”时，标明还需继续访存寻址；当存储 字首位为“0”时，标明该存储字即为EA。由此可见，存储字首位不能作为EA的组成部分，因此， 它的寻址范围为2150  间接寻址的第二个优点在千它便于编制程序。例如，用间接寻址可以很方便地完成子程序 返回，图7.12示意了用于子程序返回的间址过程。 图中表示两次调用子程序，只要在调用前先将返回地址存入子程序最末条指令的形式地址 A的存储单元内，便可准确返回到原程序断点。例如，第一次调用前，使[A] = 81，第二次调用"}
{"doc_id": "co", "page": 319, "text": "80  81  201  202  第7章指令系统 着 图7.12用于子程序返回的间址过程的示意图 313  前，使[A]=202。这样，当第一次子程序执行到最末条指令“JMP@A”(＠为间址特征位），便可 无条件转至81号单元。同理，第二次执行完子程序后，便可返回到202号单元。 间接寻址的缺点在千指令的执行阶段需要访存两次（一次间接寻址）或多次（多次间接寻 址），致使指令执行时间延长。 5.寄存器寻址 在寄存器寻址的指令字中，地址码字段直接指出了寄存器的编号，即EA=R,，如图7.13所 示。其操作数在由R,所指的寄存器内。由于操作数不在主存中，故寄存器寻址在指令执行阶段 无须访存，减少了执行时间。由于地址字段只需指明寄存器编号（计算机中寄存器数有限），故 指令字较短，节省了存储空间，因此寄存器寻址在计算机中得到广泛应用。 6.寄存器间接寻址 图7.14示意了寄存器间接寻址过程。 寻址特征寻址特征 I  主存 ＿＿」 R  民EA-操作娄 R  寄存器 图7.13寄存器寻址示意图图7.14寄存器间接寻址示意图 图中R，中的内容不是操作数，而是操作数所在主存单元的地址号，即有效地址EA=(R;)。 与寄存器寻址相比，指令的执行阶段还需访问主存。与图7.ll(a)相比，因有效地址不是存放在"}
{"doc_id": "co", "page": 320, "text": "314 第3篇中央处理器 存储单元中，而是存放在寄存器中，故称其为寄存器间接寻址，它比间接寻址少访存一次。 7.基址寻址 基址寻址需设有基址寄存器BR，其操作数的有效地址EA等千指令字中的形式地址与基址 寄存器中的内容（称为基地址）相加，即 EA=A+(BR)  图7.15示意了基址寻址过程。 寻址特征寻址特征 OP I I A  (a)专用基址寄存器BR(b)通用寄存器作基址寄存器 图7.15基址寻址示意图 基址寄存器可采用隐式的和显式的两种。所谓隐式，是在计算机内专门设有一个基址寄存 器BR，使用时用户不必明显指出该基址寄存器，只需由指令的寻址特征位反映出基址寻址即可。 显式是在一组通用寄存器里，由用户明确指出哪个寄存器用作基址寄存器，存放基地址。例如， IBM 370计算机中设有16个通用寄存器，用户可任意选中某个寄存器作为基址寄存器。对应图 7.15 (a)为隐式基址寻址，图7.15(h)为显式基址寻址。 基址寻址可以扩大操作数的寻址范围，因基址寄存器的位数可以大于形式地址A的位数。 当主存容量较大时，若采用直接寻址，因受A的位数限制，无法对主存所有单元进行访问，但采 用基址寻址便可实现对主存空间的更大范围寻访。例如，将主存空间分为若干段，每段首地址存 于基址寄存器中，段内的位移量由指令字中形式地址A指出，这样操作数的有效地址就等于基 址寄存器内容与段内位移量之和，只要对基址寄存器的内容做修改，便可访问主存的任一单元。 基址寻址在多道程序中极为有用。用户可不必考虑自己的程序存千主存的哪一空间区域， 完全可由操作系统或管理程序根据主存的使用状况，赋予基址寄存器内一个初始值（即基地 址），便可将用户程序的逻辑地址转化为主存的物理地址（实际地址），把用户程序安置于主存的 某一空间区域。例如，对千一个具有多个寄存器的机器来说，用户只需指出哪一个寄存器作为基 址寄存器即可，至千这个基址寄存器应赋予何值，完全由操作系统或管理程序根据主存空间状况 来确定。在程序执行过程中，用户不知道自己的程序在主存的哪个空间，用户也不可修改基址寄 存器的内容，以确保系统安全可靠地运行。"}
{"doc_id": "co", "page": 321, "text": "第7章指令系统315  8.变址寻址 变址寻址与基址寻址极为相似。其有效地址EA等于指令字中的形式地址A与变址寄存器 IX的内容相加之和，即 EA=A+(IX)  显然只要变址寄存器位数足够，也可扩大操作数的寻址范围，其寻址过程如图7.16所示。 寻址特征寻址特征 (a)专用变址寄存器IX(b)通用寄存器作变址寄存器 图7.16变址寻址示意图 图7.16(a)、（b)与图7.15(a)、（b)相比，显见变址寻址与基址寻址的有效地址形成过程极 为相似。由千两者的应用场合不同，因此从本质来认识，它们还是有较大的区别。基址寻址主要 用千为程序或数据分配存储空间，故基址寄存器的内容通常由操作系统或管理程序确定，在程序 的执行过程中其值是不可变的，而指令字中的A是可变的。在变址寻址中，变址寄存器的内容 是由用户设定的，在程序执行过程中其值可变，而指令字中的A是不可变的。变址寻址主要用 于处理数组问题，在数组处理过程中，可设定A为数组的首地址，不断改变变址寄存器IX的内 容，便可很容易形成数组中任一数据的地址，特别适合编制循环程序。例如，某数组有N个数存 放在以D为首地址的主存一段空间内。如果求N个数的平均值，则用直接寻址方式很容易完成 程序的编制。表7.1列出了用直接寻址求N个数平均值的程序。 程序 LDA D  ADD D+l  ADD D+2  ADD D+(N-1)  DIV #N  STA ANS  表7.1直接寻址求N个数的平均值程序 说明 [ D]--+ACC  [ACC]+[D+l]--+ACC  [ACC]+[D+2]--+ACC  [ACC]+[D+(N-1)]-+ACC  [ACC]钉V-+ACC [ACC]-+ANS单元(ANS为主存某单元地址）"}
{"doc_id": "co", "page": 322, "text": "316 第3篇中央处理器 显然，当N=100时，该程序用了102条指令，除数据外，共占用102个存储单元存放指令。 而且随N的增加，程序所用的指令数也增加（共N+2条）。 若用变址寻址，则只要改变变址寄存器的内容，而保持指令“ADDX,D\" (X为变址寄存器，D 为形式地址）不变，便可依次完成N个数相加。用变址寻址编制的程序如表7.2所示。 程序 LDA#0  LDX#0  [ADDX D  INX  CPX #N  BNE M  DIV #N  STA ANS  表7.2变址寻址求N个数的平均值程序 说明 0-+ACC  0-+X(X为变址寄存器） [ACC] + [D + (X) ]-+ACC(D为形式地址，X为变址寄存器） [X] + 1-+X  [X] -N，并建立Z的状态，结果为“O\",Z= 1；结果非“O\",Z=0  当Z= 1时，按顺序执行；当Z=0时，转至M [ ACC] + N-+ACC  [ ACC]-+ ANS (ANS为主存某单元地址） 该程序仅用了8条指令，而且随N的增加，指令数不变，指令所占的存储单元大大减少。 有的机器（如Intel8086、VAX-11)的变址寻址具有自动变址的功能，即每存取一个数据，根 据数据长度（即所占字节数），变址寄存器能自动增量或减量，以便形成下一个数据的地址。 变址寻址还可以与其他寻址方式结合使用。例如，变址寻址可与基址寻址合用，此时有效地 址EA等千指令字中的形式地址A和变址寄存器IX的内容(IX)及基址寄存器BR中的内容 (BR)相加之和，即 EA=A+(IX) +(BR)  变址寻址还可与间接寻址合用，形成先变址后间址或先间址再变址等寻址方式，读者在使用 各类机器时可注意分析。 9.相对寻址 相对寻址的有效地址是将程序计数器PC的内容（即当前指令的地址）与指令字中的形式地 址A相加而成，即 EA=(PC)+A  图7.17示意了相对寻址的过程，由图中可见，操作数的位置与当前指令的位置有一段距 离A。 相对寻址常被用于转移类指令，转移后的目标地址与当前指令有一段距离，称为相对位移 量，它由指令字的形式地址A给出，故A又称位移量。位移量A可正可负，通常用补码表示。倘 若位移量为8位，则指令的寻址范围在(PC)+127 ~ (PC) -128之间。"}
{"doc_id": "co", "page": 323, "text": "第7章指令系统317  PC  A  ｝相对距离A 操作数 图7.17相对寻址示意图 相对寻址的最大特点是转移地址不固定，它可随PC值的变化而变，因此，无论程序在主存 的哪段区域，都可正确运行，对于编写浮动程序特别有利。例如，表7.2中有一条转移指令“BNE M\"，它存于M+3单元内，也即 l23 +++  MMMM [ ADD X,D  INX  CPX #N  BNE M  显然，随程序首地址改变，M也改变。如果采用相对寻址，将“BNEM”改写为“BNE* -3\"  (＊为相对寻址特征），就可使该程序浮动至任一地址空间都能正常运行。因为从第M+3条指 令转至第M条指令，其相对位移量为－3，故当执行第M+3条指令“BNE* -3”时，其有效地址为 EA= (PC) + (-3) = M + 3-3 = M  直接指向了转移后的目标地址。 相对寻址也可与间接寻址配合使用。 例7.2设相对寻址的转移指令占3个字节，第一字节为操作码，第二、三字节为相对位移量 （补码表示），而且数据在存储器中采用以低字节地址为字地址的存放方式。每当CPU从存储器 取出一个字节时，即自动完成(PC)+l-+PC。 (1)若PC当前值为240（十进制），要求转移到290（十进制），则转移指令的第二、三字节的 机器代码是什么？ (2)若PC当前值为240（十进制），要求转移到200（十进制），则转移指令的第二、三字节的 机器代码是什么？ 解：（1)PC当前值为240，该指令取出后PC值为243，要求转移到290，即相对位移量为 290-243 = 47，转换成补码为2FH。由千数据在存储器中采用以低字节地址为字地址的存放方"}
{"doc_id": "co", "page": 324, "text": "318 第3篇中央处理器 式，故该转移指令的第二字节为2FH，第三字节为OOH。 (2) PC当前值为240，该指令取出后PC值为243，要求转移到200，即相对位移量为200- 243 =-43，转换成补码为D5H，由于数据在存储器中采用以低字节地址为字地址的存放方式，故 该转移指令的第二字节为D5H，第三字节为FFH。 10.堆栈寻址 堆栈寻址要求计算机中设有堆栈。堆栈既可用寄存器组（称为硬堆栈）来实现，也可利用 存的一部分空间作堆栈（称为软堆栈）。堆栈的运行方式为先进后出或先进先出两种，先进后出 型堆栈的操作数只能从一个口进行读或写。以软堆栈为例，可用堆栈指针SP(Stack Point)指出 栈顶地址，也可用CPU中一个或两个寄存器作为SP。操作数只能从栈顶地址指示的存储单元 存或取。可见堆栈寻址也可视为一种隐含寻址，其操作数的地址总被隐含在SP中。堆栈寻址 就其本质也可视为寄存器间接寻址，因SP可视为寄存器，它存放着操作数的有效地址。图7.18 示意了堆栈寻址过程。 主存 ACC| 15|  SP亡气嘉x 栈底 PUSH A前B  ACC  1,忱.J贝 lFF  SP| lFF| 200  栈底 PUSH A后 15 一X (a) PUSH A示意 15x  底 卜 顶 00 栈 2 栈 三 p  」 s  c c A  肆丿 邸lFF200 麟 二 ccsP A  POPA前POPA后 (b) POP A示意 图7.18堆栈寻址示意图 图7.18(a)、（b)分别表示进栈“PUSHA”和出栈“POPA”的过程。 由千SP始终指示着栈顶地址，因此不论是执行进栈(PUSH)，还是出栈(POP),SP的 内容都需要发生变化。若栈底地址大于栈顶地址，则每次进栈(SP)-/1-+ SP；每次出栈 (SP)+ /1-+SP。A取值与主存编址方式有关。若按字编址，则A取1（如图7.18所示）；若 按字节编址，则需根据存储字长是几个字节构成才能确定A，例如字长为16位，则A=2，字"}
{"doc_id": "co", "page": 325, "text": "第7章指令系统319  长为32位，A＝ 4。 例7.3一条双字长直接寻址的子程序调用指令，其第一个字为操作码和寻址特征，第二个 字为地址码5000H。假设PC当前值为2000H,SP的内容为0100H，栈顶内容为2746H，存储器 按字节编址，而且进栈操作是先执行(SP)-Li-+SP，后存入数据。试回答下列几种情况下，PC、 SP及栈顶内容各为多少？ (1) CALL指令被读取前。 (2) CALL指令被执行后。 (3)子程序返回后。 解：（1)CALL指令被读取前，PC=2000H, SP= OlOOH，栈顶内容为2746H。 (2) CALL指令被执行后，由千存储器按字节编址，CALL指令共占4个字节，故程序断点 2004H进栈，此时SP= (SP) -2 = OOFEH，栈顶内容为2004H,PC被更新为子程序入口地 址5000H。 (3)子程序返回后，程序断点出栈，PC=2004H, SP被修改为0100H，栈顶内容为2746H。 由千当前计算机种类繁多，各类机器的寻址方式均有各自的特点，还有些机器的寻址方式可 能本书并未提到，故读者在使用时需自行分析，以利于编程。 从高级语言角度考虑问题，机器指令的寻址方式对用户无关紧要，但一旦采用汇编语言编 程，用户只有了解并掌握机器的寻址方式，才能正确编程，否则程序将无法正常运行。如果读者 参与机器的指令系统设计，则了解寻址方式对确定机器指令格式是不可缺少的。从另一角度来 看，倘若透彻了解了机器指令的寻址方式，将会使读者进一步加深对机器内信息流程及整机工作 概念的理解。 7.4 指令格式举例 指令格式不仅体现了指令系统的各种功能，而且也突出地反映了机器的硬件结构特点。设 计指令格式时必须从诸多方面综合考虑，并经一段模拟运行后，最后确定。 种 指令系统集中反映了机器的性能，又是程序员编程的依据。用户在编程时既希望指令系统 很丰富，便于用户选择，同时还要求机器执行程序时速度快、占用主存空间少，实现高效运行。此 外，为了继承已有的软件，必须考虑新机器的指令系统与同一系列机器指令系统的兼容性，即高 档机必须能兼容低档机的程序运行，称之为“向上兼容”。 指令格式集中体现了指令系统的功能，为此，在确定指令格式时，必须从以下几个方面综合 考虑。"}
{"doc_id": "co", "page": 326, "text": "320 第3篇中央处理器 心操作类型：包括指令数及操作的难易程度。 ＠数据类型：确定哪些数据类型可以参与操作。 ＠指令格式：包括指令字长、操作码位数、地址码位数、地址个数、寻址方式类型，以及指令 字长和操作码位数是否可变等。 ＠寻址方式：包括指令和操作数具体有哪些寻址方式。 ＠寄存器个数：寄存器的多少直接影响指令的执行时间。 举例 不同机器的指令格式可以有很大的差别，本书不可能将各种机器的指令格式都做介绍，只能 列举几种较为典型的格式供读者学习。 1. PDP-8  PDP-8的指令字长统一为12位，CPU内只设一个通用寄存器，即累加器ACC，其主存被划 分为若干个容量相等的存储空间（每个相同的空间 被称为一页）。该机的指令格式可分为三大类，如访存类指令1操作叫叫川地址码1  0 2345 11  图7.19所示。 访存类指令属一地址指令。0~2位为操作码I/0类指令111 01 设备1操作码1 0 2 3 8 9 11  （只定义了000~ 101六种基本操作）；3、4两位为寻 址特征位，其中3位表示是否间接寻址，4位表示是寄存器类指令1ll 11 辅助操作码1  0 2 3 11  当前页面（即PC指示的页面）还是0页面；5~ 11位 为地址码。 为了扩大操作种类，对应操作码”111”又配置 图7.19PDP-8指令格式 了辅助操作码，构成了寄存器类指令，这类指令主要对ACC进行各种操作，如清A、对A取反、对 A移位、对A加1、根据A的结果是否跳转等。辅助操作码的每一位都有一个明确的操作。 第三类指令是I/0类，用0~2位为110作标志，其具体操作内容由9~ 11位反映，3~8位表 示设备号，总共可选64种设备。 PDP-8指令格式支持间接寻址、变址寻址、相对寻址。加上操作码扩展技术，共有35条 指令。 2. PDP-11  PDP-11机器字长为16位，CPU内设8个16位通用寄存器，其中两个通用寄存器有特殊作 用，一个用作堆栈指针SP，一个用作程序计数器PC。 PDP-11指令字长有16位、32位和48位三种，采用操作码扩展技术，使操作码位数不固定， 指令字的地址格式有零地址、一地址、二地址等共有13类指令格式，图7.20列出了其中五种。 图中(a)为零地址格式；（b）为一地址格式，其中6位目的地址码中的3位为寻址特征位，另 外3位表示8个寄存器中的任一个；（c）、（d)、(e)均为二地址格式指令，但操作数来源不同，"}
{"doc_id": "co", "page": 327, "text": "第7章指令系统32l  (a) I OP-CODE  16  (b) | OP-CODE |目的地址1 10 6  (c) | OP 1源地址1目的地址1 4 6 6  (d) I OP I目的地址1存储器地址 10 6 16  (e) I OP I源地址1目的地址I存储器地址1存储器地址2 4 6 6 16 16  图7.20PDP-11五种指令格式 寄存器－寄存器型、寄存器－存储器型和存储器－存储器型。 PDP-11指令系统和寻址方式比较复杂，既增加了硬件的价格，又增加了编程的复杂度，但 好处是能编出非常高效的程序。 3. IBM 360  IBM 360属于系列机。所谓系列机，是指其基本指令系统相同，基本体系结构相同的一系列 计算机。IBM370对IBM360是完全向上兼容的。所以IBM370可看作IBM360的扩展、延伸或 改进。 IBM 360是32位机器，按字节寻址，并可支持多种数据类型，如字节、半字、字、双字（双精度 实数）、压缩十进制数、字符串等。在CPU中有16个32位通用寄存器（用户可选定任一个寄存 器作为基址寄存器BR或变址寄存器IX),4个双精度(64位）浮点寄存器。指令字长有16位、 32位、48位三种，如图7.21所示。 I_ 第一个半字_1-第二个半字_1-第三个半字-  如。P|凡|R21  8 4 4  点 点 SI 归 森 图7.21IBM 360/370指令格式"}
{"doc_id": "co", "page": 328, "text": "322 第3篇中央处理器 图中共画出了五种指令格式，它们的操作码位数均为8位。RR格式是寄存器－寄存器格 式，两个操作数均在寄存器中，完成(Rl)OP (R2)--+凡的操作。RX是二地址格式的寄存器－ 存储器型指令，一个操作数在寄存器中，另一个操作数在存储器中，其有效地址由变址(X)和基 址(B)寻址方式求得，可以完成(R1)OP M [ (X) +(B) +D]--+凡的操作。RS格式是三地址格 式的寄存器－存储器型指令，完成(R3)OP M [ (B) +D]--+凡操作。SI格式中的I为立即数，它 完成立即数-+M[(B)+D]的操作。SS格式是存储器－存储器型指令，两个操作数均在存储器， 这类指令用千十进制运算和字符串处理，数据长度字段L可定义一个长度(1~ 256个字符）或两 个长度（每一个为1~ 16个十进制数），它完成M[ (Bl) + Dl ] OP M [ (B2) + D』 --+M[(B1)+D1]的操作。 4. Intel 8086/80486系列机 Intel 8086/80486系列微型计算机的指令字长为1~6个字节，即不定长。例如，零地址格式 的空操作指令NOP只占一个字节；一地址格式的CALL指令可以是3字节（段内调用）或5字节 （段间调用）；二地址格式指令中的两个操作数既可以是寄存器－寄存器型、寄存器－存储器型，也 可以是寄存器－立即数型或存储器－立即数型，它们所占的字节数分别为2、2~4、2~3、3~6个字 节。有关该系列机的指令格式，读者可以查阅有关资料自行分析。 令格式设计举例 例7.4某机字长16位，存储器直接寻址空间为128字，变址时的位移量为－64~+63, 16个 通用寄存器均可作为变址寄存器。设计一套指令系统格式，满足下列寻址类型的要求。 (1)直接寻址的二地址指令3条。 (2)变址寻址的一地址指令6条。 (3)寄存器寻址的二地址指令8条。 (4)直接寻址的一地址指令12条。 (5)零地址指令32条。 试间还有多少种代码未用？若安排寄存器寻址的一地址指令，还能容纳多少条？ 解：（1)在直接寻址的二地址指令中，根据题目给出直接寻址空间为128字，则每个地址码 为7位，其格式如图7.22(a)所示。3条这种指令的操作码为00、01和10，剩下的11可作为下一 种格式指令的操作码扩展用。 (2)在变址寻址的一地址指令中，根据变址时的位移量为－64~ +63，形式地址A取7位。 根据16个通用寄存器可作为变址寄存器，取4位作为变址寄存器R的编号。剩下的5位可作 操作码，其格式如图7.22(b)所示。6条这种指令的操作码为11000~ 11101，剩下的两个编码 11110和11111可作为扩展用。 (3)在寄存器寻址的二地址指令中，两个寄存器地址R和RJ共8位，剩下的8位可作操作 码，比格式(b)的操作码扩展了3位，其格式如图7.22 (C)所示。8条这种指令的操作码为"}
{"doc_id": "co", "page": 329, "text": "第7章指令系统323  00  (a) I OP I A1 A2 3条 10  5 4 7  11000  (b) I OP Rx A 6条 11101  8 4 4 11110000  cc) I OP Ri RI . 8条 11110111  9 7 111110000  (d) I OP A 12条 111111011  16 1111111000000000  (e) | 32条 1111111000011111  图7.22例7.4五种指令格式 11110000 ~ 11110111。剩下的11111000~ 11111111这8个编码可作为扩展用。 (4)在直接寻址的一地址指令中，除去7位的地址码外，可有9位操作码，比格式(c)的操作 码扩展了1位，与格式(c)剩下的8个编码组合，可构成16个9位编码。以11111作为格式(d) 指令的操作码特征位，12条这种指令的操作码为111110000~ 111111011，如图7.22(d)所示。剩 下的111111100~ 111111111可作为扩展用。 (5)在零地址指令中，指令的16位都作为操作码，比格式(d)的操作码扩展了7位，与上述 剩下的4个操作码组合后，共可构成4X27条指令的操作码。32条这种指令的操作码可取 1111111000000000 ~ 1111111000011111，如图7.22(e)所示。 还有29-32 = 480种代码未用，若安排寄存器寻址的一地址指令，除去末4位为寄存器地址 外，还可容纳30条这类指令。 例7.5设某机配有基址寄存器和变址寄存器，采用一地址格式的指令系统，允许直接和间 接寻址，且指令字长、机器字长和存储字长均为16位。 (1)若采用单字长指令，共能完成105种操作，则指令可直接寻址的范围是多少？一次间接 寻址的寻址范围是多少？画出其指令格式并说明各字段的含义。 (2)若存储字长不变，可采用什么方法直接访问容量为16MB的主存？ 解：（1)在单字长指令中，根据能完成105种操作，取操作码7位。因允许直接和间接寻址，"}
{"doc_id": "co", "page": 330, "text": "324 第3篇中央处理器 且有基址寄存器和变址寄存器，故取2位寻址特征位，其指令格式如下： 7 2 7  I OP I M l m  其中，OP为操作码，可完成105种操作；M为寻址特征，可反映四种寻址方式；AD为形式地址。 这种指令格式可直接寻址27= 128，一次间接寻址的寻址范围是216=65536。 (2)容量为16MB的存储器，正好与存储字长为16位的8M存储器容量相等，即16MB=  8 Mx16位。欲使指令直接访问16MB的主存，可采用双字长指令，其操作码和寻址特征位均不 变，其格式如下： p _o  7 2 7  M l ADl  AD2  其中，形式地址为AD1// AD2，共7+16=23位。223= 8 M，即可直接访问主存的任一位置。 例7.6某模型机共有64种操作，操作码位数固定，且具有以下特点。 (1)采用一地址或二地址格式。 (2)有寄存器寻址、直接寻址和相对寻址（位移量为－128~+127)三种寻址方式。 (3)有16个通用寄存器，算术运算和逻辑运算的操作数均在寄存器中，结果也在寄存器中。 (4)取数／存数指令在通用寄存器和存储器之间传送数据。 (5)存储器容量为1MB，按字节编址。 要求设计算逻指令、取数／存数指令和相对转移指令的格式，并简述理由。 解：（l）算逻指令格式为寄存器－寄存器型，取单字长16位。 6 2 4 4  I OP | M | RI I RJ I  其中，OP为操作码，6位，可实现64种操作；M为寻址模式，2位，可反映寄存器寻址、直接寻址、 相对寻址；R和RJ各取4位，指出源操作数和目的操作数的寄存器（共16个）编号。 (2)取数／存数指令格式为寄存器－存储器型，取双字长32位，格式如下： 6 2 4 4  I OP I M A12 R | Al I  其中，OP为操作码，6位不变；M为寻址模式，2位不变；R为4位，源操作数地址（存数指令）或 目的操作数地址（取数指令）；儿和儿共20位，为存储器地址，可直接访问按字节编址的1MB  存储器。 (3)相对转移指令为一地址格式，取单字长16位，格式如下："}
{"doc_id": "co", "page": 331, "text": "第7章指令系统325  p _o  6 2 8  M [〉—』 其中，OP为操作码，6位不变；M为寻址模式，2位不变；A为位移量8位，对应位移量 为－128~ + 127。 例7.7设某机共能完成110种操作，CPU有8个通用寄存器(16位），主存容量为4M字， 采用寄存器－存储器型指令。 (1)欲使指令可直接访问主存的任一地址，指令字长应取多少位？画出指令格式。 (2)若在上述设计的指令字中设置一寻址特征位X，且X=l表示某个寄存器作基址寄存 器，画出指令格式。试问基址寻址可否访问主存的任一单元？为什么？如果不能，提出一种 案，使其可访问主存的任一位置。 (3)若主存容量扩大到4G字，且存储字长等千指令字长，则在不改变上述硬件结构的前提 ，可采用什么方法使指令可访问存储器的任一位置？ 解：（l）欲使指令可直接访问4M字存储器的任一单元，采用寄存器－存储器型指令，该机 指令应包括22位的地址码、3位寄存器编号和7位操作码，即指令字长取22+3+7=32位，指令 格式如下： p _o  7  l- 3R 22-A  (2)在上述指令格式中增设一寻址特征位，且X=l表示某个寄存器作基址寄存器RB。其 指令格式如下： 7-OP 3 l 3  R厂飞勹凡 18  [  由于通用寄存器仅16位，形式地址18位，不足以覆盖4M地址空间，可将凡寄存器内容左 移6位，低位补0，形成22位基地址，然后与形式地址相加，所得的有效地址即可访问4M字存 储器的任一单元。 (3)若主存容量扩大到4G字，且存储字长等于指令字长，则在不改变上述硬件结构的前提 下，采用一次间接寻址即可访问存储器的任一单元，因为间接寻址后得到的有效地址为32位， 232 = 4 G。 7.5 技术 RISC即精简指令系统计算机(ReducedInstruction Set Computer)，与其对应的是CISC，即复 杂指令系统计算机(ComplexInstruction Set Computer)。"}
{"doc_id": "co", "page": 332, "text": "326 第3篇中央处理器 的产生和发展 计算机发展至今，机器的功能越来越强，硬件结构越来越复杂。尤其是随着集成电路技术的 发展及计算机应用领域的不断扩大，计算机系统的软件价格相对而言在不断提高。为了节省开 销，人们希望已开发的软件能被继承、兼容，这就希望新机种的指令系统和寻址方式一定能包含 旧机种所有的指令和寻址方式。通过向上兼容不仅可降低新机种的开发周期和代价，还可吸引 更多的新、老用户，于是出现了同类型的系列机。在系列机的发展过程中，致使同一系列计算机 指令系统变得越来越复杂，某些机器的指令系统竟可包含几百条指令。例如，DEC公司的VAX- 11/780有16种寻址方式、9种数据格式、303条指令。又如，32位的68020微型计算机指令种数 比6800多两倍，寻址方式多11种，达18种之多，指令长度从一个字(16位）发展到16个字。这 类机器被称为复杂指令系统计算机，简称CISC。 通常对指令系统的改进都是围绕着缩小与高级语言语义的差异和有利千操作系统的优化而 进行的。由千编写编译器的人们的任务是为每一条高级语言的语旬编制一系列的机器指令，如 果机器指令能类似于高级语言的语旬，显然编写编译器的任务就变得十分简单了。千是人们产 生了用增加复杂指令的办法来缩短与语义的差距。后来又发现，倘若编译器过多依赖复杂指令， 同样会出现新的矛盾。例如，对减少机器代码、降低指令执行数以及为提高流水性能而优化生成 代码等都是非常不利的。尤其当指令过于复杂时，机器的设计周期会很长，资金耗费会更大。例 如，Intel80386 32位机器耗资达1.5亿美元，开发时间长达三年多，结果正确性还很难保证，维护 也很困难。最值得一提的例子是，1975年IBM公司投资10亿美元研制的高速机器FS机，最终 以“复杂结构不宜构成高速计算机”的结论宣告研制失败。 为了解决这些问题，20世纪70年代中期，人们开始进一步分析研究CISC，发现一个80-20 规律，即典型程序中80％的语旬仅仅使用处理机中20％的指令，而且这些指令都是属千简单指 令，如取数、加、转移等。这一点告诫人们，付出再大的代价增添复杂指令，也仅有20％的使用概 率，而且当执行频度高的简单指令时，因复杂指令的存在，致使执行速度也无法提高。表7.3是 HP公司对IBM370高级语言中指令使用频度的分析结果。Marathe在1978年对PDP-11机在 五种不同应用领域中的指令进行混合测试，也得出了类似的结论。 表7.3IBM 370机指令的使用频度（％） 指令类型转移逻辑 数据存－存整数浮点十进制 其他 存取传送运算运算运算 COBOL 24.6 14.6 40.2 12.4 6.4 0.0 1.6 0.6  FORTRAN 18.0 8.1 48.7 2.1 11.0 11.9 0.0 0.2  Pascal 18.4 9.9 54.0 4.8 7.0 6.8 0.0 0.1"}
{"doc_id": "co", "page": 333, "text": "第7章指令系统327  另一方面，在20世纪70年代末80年代初，计算机的器件已进入VLSI时代，复杂的指令系 统需要复杂的控制器，这需要占用较多的芯片面积。统计表明，典型的CISC计算机中，控制器约 占60％的芯片面积，而且使设计、验证和实现都更加困难。 人们从80-20规律中得到启示：能否仅仅用最常用的20％的简单指令，重新组合不常用的 80％的指令功能呢？这便引发出RISC技术。 1975年IBM公司JohnCocke提出了精简指令系统的设想，1982年美国加州大学伯克利 分校的研究人员专门研究了如何有效利用VLSIC（超大规模集成电路）的有效空间。RISC由 于设计的指令条数有限，相对而言，它只需用较小的芯片空间便可制作逻辑控制电路，更多的 芯片空间可用来增强处理机的性能或使其功能多样化。他们用大部分芯片空间做成寄存器， 并且用它们作为暂时数据存储的快速存储区，从而有效地降低了RISC机器在调用子程序时 所需付出的时间。他们研制的RISCI（后来又出现RISCIl)，采用VLSICPU芯片上的晶体管 数量达44000个，线宽为3µm，字长为32位，其中有128个寄存器（而用户只能见到32个）， 仅有31条指令和两种寻址方式，访存指令只有两条，即取数(LOAD)和存数(STORE)。显然 其指令系统极为简单，但它们的功能已超过VAX-11/780和M68000，其速度比VAX-11/780 快了1倍。 与此同时，美国斯坦福大学RISC研究的课题是MIPS(Micro Processor without Interlocking  Pipeline Stages)，即消除流水线各段互锁的微处理器。他们把IBM公司对优化编译程序的研究 与加州大学伯克利分校对VLSI有效空间利用的思想结合在一起，最终的研究成果后来转化为 MIPS公司RXOOO的系列产品。IBM公司又继其IBM801型机、IBMRT/PC后，于1990年推出了 著名的IBMRS/6000系列产品。加州大学伯克利分校的研究成果最后发展成Sun微系统公司 的RISC芯片，称为SPARC (Scalable Processor ARChitecture)。 到目前为止，RISC体系结构的芯片可以说已经历了3代：第一代以32位数据通路为代表， 支持Cache，软件支持较少，性能与CISC体系结构的产品相当，如RISCI、MIPS、IBM801等。第 二代产品提高了集成度，增加了对多处理机系统的支持，提高了时钟频率，建立了完善的存储管 理体系，软件支持系统也逐渐完善。它们已具有单指令流水线，可同时执行多条指令，每个时钟 周期发出一条指令（有关流水线的概念详见8.3节）。例如，MIPS公司的R3000处理器，时钟频 率为25MHz和33MHz，集成度达11.5万个晶体管，字长为32位。第三代RISC产品为64位微 处理器，采用了巨型计算机或大型计算机的设计技术超级流水线(Superpipelining)技术和超 标量(Superscalar)技术，提高了指令级的并行处理能力，每个时钟周期发出2条或3条指令，使 RISC处理器的整体性能更好。例如，MIPS公司的R4000处理器采用50MHz和75MHz的外部 时钟频率，内部流水时钟达100MHz和150MHz，芯片集成度高达110万个晶体管，字长64位， 并有16KB的片内Cache。它有R4000PC、R4000SC和R4000MC三种版本，对应不同的时钟频 率，分别提供给台式系统、高性能服务器和多处理器环境下使用。表7.4列出了MIPS公司R系 列RISC处理器的几项指标。"}
{"doc_id": "co", "page": 334, "text": "328 第3篇中央处理器 表7.4MIPS公司R系列RISC处理器比较 机种R2000 R3000 R4000  宣布时间1986 1988 1991  时钟频率16.67 MHz 25/33 MHz 50/75 MHz  芯片规模10万晶体管11.5万晶体管110万晶体管 结构形式流水线流水线超级流水线 寄存器集32X32位32X32位32x64位，16X64位 片上Cache16 KB  片外Cache最大128KB 最大512KB 128 KB~4 MB  工艺2 µ,m CMOS 1.2 µm CMOS 0.8 µ,m CMOS  功耗3W 3.5W  SPEC分11.2 17.6(25 MHz) 63 (50 MHz)  自1983年开始出现商品化的RISC机以来，比较著名的RISC机有IBM公司的IBMRT系 列，HP公司的精密结构计算机(HPPA)、MIPSR3000、MotorolaM88000、Intel80960、INMOS Transputer、AMDAM29000、FairchildClipper等。其中，Clipper兼顾了RISC和CISC两方面的特 点，又称为类RISC机。在计算机工作站方面，SunMicrosystems公司千1987年推出SPARC，速度 达7~ 10 MIPS。1988年Apollo公司推出Series10000个人超级计算机，称为并行精简指令系统多 处理机PRISM(Parallel Reduced Instruction Set Multiprocessor)，单机系统速度达15~ 25 MIPS,四 处理机则可达60~100 MIPS，后来HP合并了Apollo公司，继续发展工作站。 较为著名的第三代RISC机的有关性能指标如表7.5所示。 表7.5第三代RISC处理器的性能比较 Motorola Super  机种R4000 Alpha RS/6000 i860 C400  88110 SPARC  公司名称MIPS DEC Motorola Sun/TI IBM Intel Intergraph  时钟频率 50/75 150/200 50 50/100 33 25/40/50 50  (MHz)  集成度 110 168 130 310 120 255 30  （万晶体管） 结构形式超流水线超标量超标量 超标量超标量超长指令超标量 32x64  32X64 32X64 32x64 32x32 32X32  寄存器集32X64 32X32  16x64 16x64浮32X64浮32x64 16x64  (32X80)"}
{"doc_id": "co", "page": 335, "text": "第7章指令系统329  续表 Motorola Super  机种R4000 Alpha RS/6000 i860 C400  88110 SPARC  片上Cache16 KB 16 KB 16 KB 36 KB 8 KB 32 KB  128 KB 最大可达256 KB  片外Cache2 MB 128 KB  ~ 1 MB 8 MB ~l MB  工艺 0.8 µm 0.75 µ,m 1 µm 0.8 µm  CMOS CMOS CMOS CMOS  功耗23 W 8W 4W 7W  63  SPEC分100（估计）63.7（估计）75（估计）25.9 42 42  (50 MHz)  注：表中空项待查。 的主要特征 由上分析可知，RISC技术是用20％的简单指令的组合来实现不常用的80％的那些指令功 能，但这不意味着RISC技术就是简单地精简其指令集。在提高性能方面，RISC技术还采取了许 多有效措施，最有效的方法就是减少指令的执行周期数。 计算机执行程序所需的时间P可用下式表述： P=JxCxT  其中，I是高级语言程序编译后在机器上运行的机器指令数；C为执行每条机器指令所需的平均 机器周期；T是每个机器周期的执行时间。 表7.6列出了第二代RISC机与CISC机的I、C、T统计，其中I、T为比值，C为实际周期数。 表7.6RISC/CISC的I、C、T统计比较 由千RISC指令比较简单，用这些简单指令编制出的子程序来代替CISC机中比较复杂的指 令，因此RISC中的I比CISC多20%~40%。但RISC的大多数指令仅用一个机器周期完成，C的 值比CISC小得多。而且RISC结构简单，完成一个操作所经过的数据通路较短，使T值也大大 下降。因此总折算结果，RISC的性能仍优千CISC2 ~5倍。 由千计算机的硬件和软件在逻辑上的等效性，使得指令系统的精简成为可能。曾有人在 1956年就证明，只要用一条“把主存中指定地址的内容同累加器中的内容求差，把结果留在累加"}
{"doc_id": "co", "page": 336, "text": "330 第3篇中央处理器 器中并存入主存原来地址中”的指令，就可以编出通用程序。又有人提出，只要用一条”条件传 送(CMOVE)”指令就可以做出一台计算机；并且在1982年某大学做出了一台8位的CMOVE系 统结构样机，称为SIC（单指令计算机）。而且，指令系统所精简的部分可以通过其他部件以及软 件（编译程序）的功能来替代，因此，实现RISC技术是完全可能的。 1. RISC的主要特点 通过对RISC各种产品的分析，可归纳出RISC机应具有如下一些特点。 心选取使用频度较高的一些简单指令以及一些很有用但又不复杂的指令，让复杂指令的功 能由频度高的简单指令的组合来实现。 ＠指令长度固定，指令格式种类少，寻址方式种类少。 ＠只有取数／存数(LOAD/STORE)指令访间存储器，其余指令的操作都在寄存器内完成。 @CPU中有多个通用寄存器。 ＠采用流水线技术，大部分指令在一个时钟周期内完成。采用超标量和超流水线技术，可 使每条指令的平均执行时间小于一个时钟周期。 ＠控制器采用组合逻辑控制，不用微程序控制。 ＠采用优化的编译程序。 值得注意的是，商品化的RISC机通常不会是纯RISC机，故上述这些特点不是所有RISC机 全部具备的。 相比之下，CISC的指令系统复杂庞大，各种指令使用频度相差很大；指令字长不固定，指令 格式多，寻址方式多；可以访存的指令不受限制；CPU中设有专用寄存器；绝大多数指令需要多 个时钟周期方可执行完毕；采用微程序控制器；难以用优化编译生成高效的目标代码。 表7.7列出了一些RISC机指令系统的指令条数。 表7.7一些RISC机的指令条数 机器名指令数机器名 RISC Il 39 ACORN  MIPS 31 INMOS  IBM 801 120 IBM RT  MIRIS 64 HPPA  PYRAMID 128 CLIPPER  RIDGE 128 SPARC  下面以RISCII为例，着重分析其指令种类和指令格式。 2. RISC II指令系统举例 (1)指令种类 RISC II共有39条指令，分为以下4类。 指令数 44  111  118  140  101  89"}
{"doc_id": "co", "page": 337, "text": "第7章指令系统331  心寄存器－寄存器操作：移位、逻辑、算术（整数）运算等12条。 ＠取／存数指令：取存字节、半字、字等16条。 ＠控制转移指令：条件转移、调用／返回等6条。 ＠其他：存取程序状态字PSW和程序计数器等5条。 在RISCII机中，有一些常用指令未被选中，但用上述这些指令并在硬件系统的辅助下，足 以实现其他一些指令的功能。例如，该机约定凡寄存器内容恒为0，这样加法指令可替代寄存 器间的传送指令，即 (RJ +(R。)一凡，替代了Rs--+凡 加法指令还可替代清除寄存器指令，即 (R。)＋（R。)一凡，替代了0一凡 减法指令可替代取负数指令，即 (R。)－（Rs)一凡，替代了凡寄存器内容取负 此外，该机可用立即数作为一个操作数，这样当立即数取1时，再用加法（或减法）指令就可 替代寄存器内容增l（减l）指令，即 (RS) ＋1一凡 当立即数取－1时，异或指令可替代求反码指令，即 Rs EB (-1)一凡替代凡一凡 (2)指令格式 RISC机的指令格式比较简单，寻址方式也比较少，如RISCII的指令格式有两种：短立即数 格式和长立即数格式。指令字长固定为32位，指令字中每个字段都有固定位置，如图7.23 所示。 31 25 2423 19 18 14 13 12  | OP | s | DEST | rs1 | o |  5 4  三 (a)第二源操作数在寄存器中的短立即数格式 31 25 2423 19 18 14 13 12  | OP | s | DEST | rsI I 1 | lmm13  (b)第二源操作数为imm13的短立即数格式 。 (c)长立即数格式 图7.23RISC II的指令格式 短立即数格式指令主要用千算逻运算，其中第31位～25位为操作码；两个操作数一个在rs1 中，另一个操作数的来源由指令的第13位决定。当其为0时（如图7.23(a)所示），第二个操作 数在寄存器rs2中（只用0~4位）；当其为1时（如图7.23(b)所示），第二个操作数为13位的立"}
{"doc_id": "co", "page": 338, "text": "332 第3篇中央处理器 即数imm13。运算结果存放在DEST所指示的寄存器rd中（共32个）。指令字中的第24位S用 来表示是否需要根据运算结果置状态位，S=l表示置状态位。RISCIl机有4个状态位，即零标 志位Z、负标志位N、溢出标志位V、进位标志位C。 指令中的DEST字段在条件转移指令中用第22~19位作为转移条件，第23位无用。对于图 7.23 (b)所示的短立即数指令格式，其imm13即为相对转移位移量。 长立即数指令格式主要用千相对转移指令，此时19位的立即数imm19指出转移指令的相对 位移量，与13位相比，可扩大相对千PC的转移距离。 (3)寻址方式 RISC Il指令系统有两种访存寻址方式。一种是变址寻址，另一种是相对寻址，还可用组合 方式产生其他寻址方式。若令变址寄存器内容为0（因该机约定寄存器R。内容恒为0，所以只要 指定凡作为变址寄存器即可实现），则成为直接寻址方式；若令位移量为0，则成为寄存器间接 寻址方式。 对千LOAD指令，可根据计算所得的有效地址，从存储器中读取数据并送入DEST字段中指 示的目的寄存器中。如短立即数指令有效地址为(rs1)+ (rs2)，或为(rs1)+imm13 0  对于STORE指令，是将DEST字段指示的源寄存器中的数取出并存入存储器中，有效地址 的计算与LOAD指令相同。 3. RISC指令系统的扩充 从实用角度出发，商品化的RISC机，因用途不同还可扩充一些指令，例如： 叩浮点指令，用千科学计算的RISC机。为了提高机器速度而增设浮点指令。 ＠特权指令，为了便千操作系统管理机器，防止用户破坏机器的运行环境而特设特权指令。 ＠读后置数指令，完成读一修改—写，用千寄存器与存储单元交换数据等。 ＠一些简单的专用指令。例如，某些指令用得较多，实现起来又比较复杂，若用子程序来实 现，占用较多的时间，则可考虑设置一条指令来缩短子程序执行时间。有些机器用乘法步指令来 加快乘法运算的执行速度。 和CISC的比较 与CISC机相比，RISC机的主要优点可归纳如下： 1.充分利用VLSI芯片的面积 CISC机的控制器大多采用微程序控制（详见第10章），其控制存储器在CPU芯片内所占的 面积为50％以上（如Motorola公司的MC68020占68%）。而RISC机控制器采用组合逻辑控制 （详见第10章），其硬布线逻辑只占CPU芯片面积的10％左右。可见它可将空出的面积供其他 功能部件用，例如用于增加大量的通用寄存器（如Sun微系统公司的SPARC有100多个通用寄 存器），或将存储管理部件也集成到CPU芯片内（如MIPS公司的R2000/R3000)。以上两种芯 片的集成度分别小千10万个和20万个晶体管。"}
{"doc_id": "co", "page": 339, "text": "第7章指令系统333  随着半导体工艺技术的提高，集成度可达100万至几百万个晶体管，此时无论是CISC还是 RISC都将多个功能部件集成在一个芯片内。但此时RISC已占领了市场，尤其是在工作站领域 占有明显的优势。 2.提高计算机运算速度 RISC机能提高运算速度，主要反映在以下5个方面。 心RISC机的指令数、寻址方式和指令格式种类较少，而且指令的编码很有规律，因此RISC 的指令译码比CISC的指令译码快。 (2) RISC机内通用寄存器多，减少了访存次数，可加快运行速度。 @ RISC机采用寄存器窗口重叠技术，程序嵌套时不必将寄存器内容保存到存储器中，故又 提高了执行速度。 @ RISC机采用组合逻辑控制，比采用微程序控制的CISC机的延迟小，缩短了CPU的周期。 @ RISC机选用精简指令系统，适合于流水线工作，大多数指令在一个时钟周期内完成。 3.便千设计，可降低成本，提高可靠性 RISC机指令系统简单，故机器设计周期短，如美国加州大学伯克利分校的RISCI机从设计 到芯片试制成功只用了十几个月，而Intel80386处理器(CISC)的开发花了三年半时间。 RISC机逻辑简单，设计出错可能性小，有错时也容易发现，可靠性高。 4.有效支持高级语言程序 RISC机靠优化编译来更有效地支持高级语言程序。由千RISC指令少，寻址方式少，使编译 程序容易选择更有效的指令和寻址方式，而且由于RISC机的通用寄存器多，可尽量安排寄存器 的操作，使编译程序的代码优化效率提高。例如，IBM的研究人员发现，IBM801 (RISC机）产生 的代码大小是IBMS/370(CISC机）的90%。 有些RISC机（如Sun公司的SPARC)采用寄存器窗口重叠技术，使过程间的参数传送加快， 且不必保存与恢复现场，能直接支持调用子程序和过程的高级语言程序。表7.8列出了一些 CISC与RISC微处理器的特征。 表7.8一些CISC与RISC微处理器的特征 CISC RISC  特征 IBM 370/168 VAXll/780 Intel 80486 Motorola 88000 MIPS R4000  开发年份1973 1978 1989 1988 1991  指令数208 303 235 51 94  指令字长／B2~6 2~57 1 ~ 11 4 32  寻址方式4 22 11 3 1  通用寄存器数16 16 8 32 32  控制存储器容量／Kb420 480 246  Cache容量／Kb64 64 8 16 128"}
{"doc_id": "co", "page": 340, "text": "334 第3篇中央处理器 此外，从指令系统兼容性看，CISC大多能实现软件兼容，即高档机包含了低档机的全部指 令，并可加以扩充。但RISC机简化了指令系统，指令数量少，格式也不同千老机器，因此大多数 RISC机不能与老机器兼容。 PowerPC是IBM、Apple、Motorola三家公司千1991年联合，用Motorola的芯片制造经验、 Apple的微型计算机软件支持、IBM的体系结构及其世界计算机市场霸主的地位，向长期被Intel 占据的微处理器市场挑战而开发的RISC产品。 PowerPC中的“PC”意为“PowerfulChip\"，其中“Power“基于20世纪80年代后期，IBM在其 801小型机的基础上开发的工作站和服务器中的Power体系，意为“PerformanceOptimization With  Enhanced RISC（性能优化的增强型RISC)”。PowerPC具有超高的性能、价廉、易仿真CISC指令 集、可运行大量的现代CISC计算机应用软件，即集工作站的卓越性能、PC机的低成本及运行众 多的软件等优点于一身。此外，PowerPC扩展性强，可覆盖PDA（个人数字助理）到多处理、超并 行的中大型机，用单芯片提供整个解决方案。 多年来计算机体系结构和组织发展的趋势是增加CPU的复杂性，即使用更多的寻址方式及 更加专门的寄存器等。RISC的出现象征着与这种趋势根本决裂，自然地引起了RISC与CISC的 争端。随着技术不断发展，RISC与CISC还不能说是截然不同的两大体系，很难对它们做出明确 的评价。最近几年，RISC与CISC的争端已减少了很多。原因在于这两种技术已逐渐融合。特 别是芯片集成度和硬件速度的增加，RISC系统也越来越复杂。与此同时，在努力挖掘最大性能 的过程中，CISC的设计已集中到和RISC相关联的主题上来，例如增加通用寄存器数以及更加强 调指令流水线设计，所以更难去评价它们的优越性了。 RISC技术发展很快，有关RISC体系结构、RISC流水、RISC编译系统、RISC、CISC和VLIW (Very Long Instruction Word，超长指令字）技术的融合等方面的资料不少。读者若想深入了解， 可以查阅有关文献。 思考题与习题 7.1 什么叫机器指令？什么叫指令系统？为什么说指令系统与机器的主要功能以及与硬件结构之间存在 着密切的关系？ 7.2 什么叫寻址方式？为什么要学习寻址方式？ 7.3 什么是指令字长、机器字长和存储字长？ 7.4 零地址指令的操作数来自哪里？在一地址指令中，另一个操作数的地址通常可采用什么寻址方式获 得？各举一例说明。 7.5 对于二地址指令而言，操作数的物理地址可安排在什么地方？举例说明。 7.6 某指令系统字长为16位，地址码取4位，试提出一种方案，使该指令系统有8条三地址指令、16心一 地址指令、100条一地址指令。 7.7 设指令字长为16位，采用扩展操作码技术，每个操作数的地址为6位。如果定义了13条二地址指令，"}
{"doc_id": "co", "page": 341, "text": "第7章指令系统335  试问还可安排多少条一地址指令？ 7.8 某机指令字长16位，每个操作数的地址码为6位，设操作码长度固定，指令分为零地址、一地址和二地 址三种格式。若零地址指令有M种，一地址指令有N种，则二地址指令最多有几种？若操作码位数可变，则二 地址指令最多允许有几种？ 7.9 试比较间接寻址和寄存器间接寻址。 7.10 试比较基址寻址和变址寻址。 7.11 画出先变址再间址及先间址再变址的寻址过程示意图。 7.12 画出“SUB@Rl”指令对操作数的寻址及减法过程的流程图。设被减数和结果存于ACC中，＠表示 间接寻址，Rl寄存器的内容为2074H。 7.13 画出执行“ADD* -5”指令（＊为相对寻址特征）的信息流程图。设另一个操作数和结果存于ACC 中，并假设(PC)=4000H。 7.14 设相对寻址的转移指令占两个字节，第一个字节是操作码，第二个字节是相对位移量，用补码表示。 假设当前转移指令第一字节所在的地址为2000H，且CPU每取出一个字节便自动完成(PC)+l-+PC的操作。试 问当执行“JMP* +8”和“JMP* -9”指令时，转移指令第二字节的内容各为多少？ 7.15 一相对寻址的转移指令占3个字节，第一字节是操作码，第二、三字节为相对位移量，而且数据在存 储器中采用以高字节地址为字地址的存放方式。假设PC当前值是4000H。试问当结果为0，执行“JZ* +35\"  和“JZ* -17”指令时，该指令的第二、第三字节的机器代码各为多少？ 7.16 某机主存容量为4Mx16位，且存储字长等于指令字长，若该机指令系统可完成108种操作，操作码 位数固定，且具有直接、间接、变址、基址、相对、立即等六种寻址方式，试回答以下问题。 (1)画出一地址指令格式并指出各字段的作用。 (2)该指令直接寻址的最大范围。 (3)一次间接寻址和多次间接寻址的寻址范围。 (4)立即数的范围（十进制表示）。 (5)相对寻址的位移量（十进制表示）。 (6)上述六种寻址方式的指令中哪一种执行时间最短，哪一种最长，为什么？哪一种便于程序浮动，哪一种 最适合处理数组问题？ (7)如何修改指令格式，使指令的寻址范围可扩大到4M?  (8)为使一条转移指令能转移到主存的任一位置，可采取什么措施？简要说明之。 7.17 举例说明哪几种寻址方式在指令的执行阶段不访问存储器，哪几种寻址方式在指令的执行阶段只需 访问一次存储器？完成什么样的指令，包括取指令在内共访问存储器4次？ 7.18 某机器共能完成78种操作，若指令字长为16位，试问一地址格式的指令地址码可取几位？若想使指 令寻址范围扩大到216，可采用什么方法？举出三种不同例子加以说明。 7.19 CPU内有32个32位的通用寄存器，设计一种能容纳64种操作的指令系统。假设指令字长等于机器 字长，试回答以下问题。"}
{"doc_id": "co", "page": 342, "text": "336 第3篇中央处理器 (1)如果主存可直接或间接寻址，采用寄存器－存储器型指令，能直接寻址的最大存储空间是多少？画出指 令格式并说明各字段的含义。 (2)在满足(1)的前提下，如果采用通用寄存器作基址寄存器，则上述寄存器－存储器型指令的指令格式有 何特点？画出指令格式并指出这类指令可访间多大的存储空间？ 7.20 什么是RISC?简述它的主要特点。 7.21 比较RISC和CISC的异同之处。 7.22 RISC机中指令简单，有些常用的指令未被选用，它用什么方式来实现这些常用指令的功能，试举例 说明。"}
{"doc_id": "co", "page": 343, "text": "本章从分析CPU的功能和内部结构入手，详细讨论机器完成一条指令的全过程，以及为了 进一步提高数据的处理能力、开发系统的并行性所采取的流水技术。此外，本章还进一步概括了 中断技术在提高整机系统效能方面的作用。通过本章的学习，希望读者对CPU在计算机中的地 位和作用以及对中断概念的理解比前面章节更加深入。 8.1 CPU的结构 8上1CPU的功能 由第1章可知，CPU实质包括运算器和控制器两大部分，第6章讨论了计算机内各种运算及 相应的硬件配置，这里重点介绍控制器的功能。 对千冯·诺依曼结构的计算机而言，一旦程序进入存储器后，就可由计算机自动完成取指令 和执行指令的任务，控制器就是专用千完成此项工作的，它负责协调并控制计算机各部件执行程 序的指令序列，其基本功能是取指令、分析指令和执行指令。 1.取指令 控制器必须具备能自动地从存储器中取出指令的功能。为此，要求控制器能自动形成指令 的地址，并能发出取指令的命令，将对应此地址的指令取到控制器中。第一条指令的地址可以人 为指定，也可由系统设定。 2.分析指令 分析指令包括两部分内容：其一，分析此指令要完成什么操作，即控制器需发出什么操作命 令；其二，分析参与这次操作的操作数地址，即操作数的有效地址。 3.执行指令 执行指令就是根据分析指令产生的＂操作命令”和＂操作数地址”的要求，形成操作控制信号 序列（不同的指令有不同的操作控制信号序列），通过对运算器、存储器以及I/0设备的操作，执 行每条指令。 此外，控制器还必须能控制程序的输入和运算结果的输出（即控制主机与I/0设备交换信 息）以及对总线的管理，甚至能处理机器运行过程中出现的异常情况（如掉电）和特殊请求（如打"}
{"doc_id": "co", "page": 344, "text": "338 第3篇中央处理器 印机请求打印一行字符），即处理中断的能力。 总之，CPU必须具有控制程序的顺序执行（称指令控制）、产生完成每条指令所需的控制命 令（称操作控制）、对各种操作加以时间上的控制（称时间控制）、对数据进行算术运算和逻辑运 算（数据加工）以及处理中断等功能。 CPU结构框图 根据CPU的功能不难设想，要取指令，必须有一个寄存器专用于存放当前指令的地址；要分 析指令，必须有存放当前指令的寄存器和对指令操作码进行译码的部件；要执行指令，必须有一 个能发出各种操作命令序列的控制部件CU；要完成算术运算和逻辑运算，必须有存放操作数的 寄存器和实现算逻运算的部件ALU；为了处理异常情况和特殊请求，还必须有中断系统。可见， CPU可由四大部分组成，如图8.1所示。将图8.1细化，又可得图8.2。图中ALU部件实际上只 对CPU内部寄存器的数据进行操作，有关ALU的内容已在第6章中有所介绍。 曰曰 勹困 图8.1 \\  系统总线 使用系统总线的CPU 「 lu -AL i! —·—·|·—·—.」 控制信号 图8.2CPU的内部结构 的寄存器 第4章图4.2示出了存储器速度、容量和位价的关系，最上层的寄存器速度最快，容量最小， 位价最贵，它们通常设在CPU内部。CPU中的寄存器大致可分两类：一类属于用户可见寄存器， 用户可对这类寄存器编程，以及通过优化使CPU因使用这类寄存器而减少对主存的访问次数； 另一类属于控制和状态寄存器，用户不可对这类寄存器编程，它们被控制部件使用，以控制CPU 的操作，也可被带有特权的操作系统程序使用，从而控制程序的执行。 1.用户可见寄存器 通常CPU执行机器语言访问的寄存器为用户可见寄存器，按其特征又可分为以下几类。"}
{"doc_id": "co", "page": 345, "text": "第8章CPU的结构和功能339  (1)通用寄存器 通用寄存器可由程序设计者指定许多功能，可用于存放操作数，也可作为满足某种寻址方式 所需的寄存器。例如，基址寻址所需的基址寄存器、变址寻址所需的变址寄存器和堆栈寻址所需 的栈指针，都可用通用寄存器代替。寄存器间接寻址时还可用通用寄存器存放有效地址的地址。 当然，也有一些机器用专用寄存器作为基址寄存器、变址寄存器或栈指针，这样，在设计指令 格式时只需将这类专用寄存器隐含在操作码中，而不必占用指令字中的位。图7.15(a)所示的 就是用专用寄存器作为基址寄存器，而图7.15(b)是用通用寄存器作为基址寄存器，所以指令字 中必须有R字段指出寄存器编号。又如图7.21所示的IBM360/370指令格式中，由于用通用寄 存器作为变址寄存器和基址寄存器，故在指令字中设有X和B字段，分别指出作为变址寄存器 和基址寄存器的通用寄存器编号。 (2)数据寄存器 数据寄存器用于存放操作数，其位数应满足多数数据类型的数值范围，有些机器允许使用两 个连读的寄存器存放双倍字长的值。还有些机器的数据寄存器只能用于保存数据，不能用于操 作数地址的计算。 (3)地址寄存器 地址寄存器用千存放地址，其本身可以具有通用性，也可用千特殊的寻址方式，如用千基址 寻址的段指针（存放基地址）、用于变址寻址的变址寄存器和用于堆栈寻址的栈指针。地址寄存 器的位数必须足够长，以满足最大的地址范围。 (4)条件码寄存器 这类寄存器中存放条件码，它们对用户来说是部分透明的。条件码是CPU根据运算结果由 硬件设置的位，例如，算术运算会产生正、负、零或溢出等结果。条件码可被测试，作为分支运算 的依据。此外，有些条件码也可被设置，例如，对于最高位进位标志C，可用指令对它置位和复 位。将条件码放到一个或多个寄存器中，就构成了条件码寄存器。 在调用子程序前，必须将所有的用户可见寄存器的内容保存起来，这种保存可由CPU自动 完成，也可由程序员编程保存，视不同机器进行不同处理。 2.控制和状态寄存器 CPU中还有一类寄存器用于控制CPU的操作或运算。在一些机器里，大部分这类寄存器对 用户是透明的。如以下四种寄存器在指令执行过程中起重要作用。 叩MAR：存储器地址寄存器，用千存放将被访问的存储单元的地址。 (2)MDR：存储器数据寄存器，用于存放欲存入存储器中的数据或最近从存储器中读出的 数据。 @PC：程序计数器，存放现行指令的地址，通常具有计数功能。当遇到转移类指令时，PC的 值可被修改。 @IR：指令寄存器，存放当前欲执行的指令。 通过这4个寄存器，CPU和主存可交换信息。例如，将现行指令地址从PC送至MAR，启动"}
{"doc_id": "co", "page": 346, "text": "340 第3篇中央处理器 存储器做读操作，存储器就可将指定地址单元内的指令读至MDR，再由MDR送至IR。 在CPU内部必须给ALU提供数据，因此ALU必须可直接访问MDR和用户可见寄存器， ALU的外围还可以有另一些寄存器，这些寄存器用于ALU的输入输出以及用于和MDR及用户 可见寄存器交换数据（如图9.4中的Y和Z寄存器）。 在CPU的控制和状态寄存器中，还有用来存放程序状态字PSW的寄存器，该寄存器用来存 放条件码和其他状态信息。在具有中断系统的机器中还有中断标记寄存器。 3.举例 不同计算机的CPU中，寄存器组织是不一样的，图8.3画出了Z8000、8086和MC68000三种 计算机的寄存器组织。 通用寄存器 I  。 1  2  3  4  5  6  7  8  9  10  11  12  13  14  15  SP  SP  程序状态 二三 AXBxexDX  二」 SPBPSIDI  CS  DS  ss  ES  IPF  DoDlD2D3 见 D5D6D7 AoAlA2A3 丛 A5&A7凡， 数据寄存器 地址寄存器 用户栈指针 管理栈指针 (a) Z8000  图8.3 (b) 8086  程序状态 二(c) MC 68000  三种微处理器的寄存器组织 Zilog Z8000有16个16位的通用寄存器，这些寄存器可存放地址、数据，也可作为变址寄存 器，其中有两个寄存器被用作栈指针，寄存器可被用作8位和32位的运算。Z8000中有5个与 程序状态有关的寄存器，一个用于存放状态标记，两个用于程序计数器，两个用千存放偏移量。 确定一个地址需要两个寄存器。"}
{"doc_id": "co", "page": 347, "text": "第8章CPU的结构和功能341  Intel 8086采用不同的寄存器组织，尽管某些寄存器可以通用，但它的每个寄存器大多是专 用的。它有4个16位的数据寄存器，即AX（累加器）、BX（基址寄存器）、EX（计数寄存器）和 DX（数据寄存器），也可兼作8个8位的寄存器(AH、AL、BH、BL、CH、CL、DH、DL)。另外，还有 两个16位的指针（栈指针SP和基址指针BP)和两个变址寄存器（源变址寄存器SI和目的变址 寄存器DI)。在一些指令中，寄存器是隐式使用的，如乘法指令总是用累加器。8086还有4个 段地址寄存器（代码段CS、数据段DS、堆栈段SS和附加段ES)以及指令指针IP（相当于PC)和 状态标志寄存器F。 Motorola MC68000的寄存器组织介于Zilog和Intel微处理器之间，它将32位寄存器分为8 个数据寄存器(D。～队）和9个地址寄存器(A。～凡）。数据寄存器主要用于数据运算，当需要变 址时，也可作变址寄存器使用。寄存器允许8位、16位和32位的数据运算，这由操作码确定。 地址寄存器存放32位地址（没有段），其中两个（儿和A;)也可用作堆栈指针，分别供用户和操 作系统使用。针对当前执行的模式，这两个寄存器在某个时刻只能用一个。此外，MC68000还 有一个32位的程序计数器PC和一个16位的状态寄存器。 与Zilog的设计者类似，Motorola设计的寄存器组织也不含专用寄存器。至千到底什么形式 的寄存器组织最好，目前尚无一致的观点，主要由设计者根据需要自行决定。 计算机的设计者们为了给在早期计算机上编写的程序提供向上的兼容性，在新计算机的设 计上经常保留原设计的寄存器组织形式。图8.4就是Zilog80000和Intel80386的用户可见寄存 器组织，它们分别是Z8000和8086的扩展，它们都采用32位寄存器，但又分别保留了原先的 些特点。由于受这种限制，因此32位处理器在寄存器组织的设计上只有有限的灵活性。 趴 RR2  RR4  RR6  RR8  RR10  RR12  RR14  RR16  RR18  RR20  RR22  RR24  RR26  RR28  RR30  通用寄存器 SP  SP  (a) Z80000  EAX  EBX  ECX  EDX  ESP  EBP  ESI  EDI  通用寄存器 程序状态 标志寄存器 指令指针IP (b) 80386  图8.4两种32位微处理器寄存器组织"}
{"doc_id": "co", "page": 348, "text": "342 第3篇中央处理器 8。1.4控制单元和中断系统 控制单元(CU)是提供完成计算机全部指令操作的微操作命令序列部件。现代计算机中微 操作命令序列的形成方法有两种：一种是组合逻辑设计方法，为硬连线逻辑；另一种是微程序设 计方法，为存储逻辑。具体内容详见第4篇。 中断系统主要用千处理计算机的各种中断，详细内容在8.4节介绍。 8.2 指令周期 8。2。1指令周期的基本概念 CPU每取出并执行一条指令所需的全部时间称为指令周期，也即CPU完成一条指令的时 间，如图8.5所示。图中的取指阶段完成取指令和分析指令的操作，又称取指周期；执行阶段完 成执行指令的操作，又称执行周期。在大多数情况下，CPU就是按”取指—执行—再取指—再执 行…＂的顺序自动工作的。 由于各种指令操作功能不同，因此各种指令的指令周期是不相同的。例如，无条件转移指令 \"JMP X\"，在执行阶段不需要访问主存，而且操作简单，完全可以在取指阶段的后期将转移地址 X送至PC，以达到转移的目的。这样，“JMPX”指令的指令周期就是取指周期。又如一地址格 式的加法指令“ADDX\"，在执行阶段首先要从X所指示的存储单元中取出操作数，然后和ACC 的内容相加，结果存千ACC，故这种指令的指令周期在取指和执行阶段各访问一次存储器，其指 令周期就包括两个存取周期。再如乘法指令，其执行阶段所要完成的操作比加法指令多得多，故 它的执行周期超过了加法指令，如图8.6所示。 ：二I:：芦 （取指、分析）（执行指令） 指令周期 图8.5指令周期定义示意图 无条件转移指令 取指周芒已三巴行周期 指令周期 加法指令 取指周期执行周期 ..  指令周期 图8.6各种指令周期的比较 乘法指令"}
{"doc_id": "co", "page": 349, "text": "第8章CPU的结构和功能343  此外，当遇到间接寻址的指令时，由于指令字中只给出操作数有效地址的地址，因此，为了取 出操作数，需先访问一次存储器，取出有效地址，然后再访问存储器，取出操作数，如图7.ll(a) 所示。这样，间接寻址的指令周期就包括取指周期、间 址周期和执行周期3个阶段，其中间址周期用于取操作 数的有效地址，因此间址周期介于取指周期和执行周期 取指周期间址周期 指令周期 执行周期 之间，如图8.7所示。图8.7具有间址周期的指令周期 由第5章可知，当CPU采用中断方式实现主机与 I/0设备交换信息时，CPU在每条指令执行阶段结束前，都要发中断查询信号，以检测是否有某 个I/0设备提出中断请求。如果有请求，CPU则要进入中断响应阶段，又称中断周期。在此阶 段，CPU必须将程序断点保存到存储器中。这样，一个完整的指令周期应包括取指、间址、执行 和中断4个子周期，如图8.8所示。由千间址周期和中断周期不一定包含在每个指令周期内，故 图中用菱形框判断。 总之，上述4个周期都有CPU访存操作，只是访存的目的不同。取指周期是为了取指令，间 址周期是为了取有效地址，执行周期是为了取操作数（当指令为访存指令时），中断周期是为了 保存程序断点。这4个周期又可称为CPU的工作周期，为了区别它们，在CPU内可设置4个标 志触发器，如图8.9所示。 CLK  图8.8指令周期流程 FE I IINDI I EX I IINT  D Al ID /\\I ID /\\I ID  1-FE 1-IND 1-EX 1-INT  图8.9CPU工作周期的标志 图8.9所示的FE、IND、EX和INT分别对应取指、间址、执行和中断4个周期，并以“1”状态 表示有效，它们分别由1一FE、l~IND、l~EX和l~INT这4个信号控制。 设置CPU工作周期标志触发器对设计控制单元十分有利。例如，在取指阶段，只要设置取 指周期标志触发器FE为1，由它控制取指阶段的各个操作，便获得对任何一条指令的取指命令 序列。又如，在间接寻址时，间址次数可由间址周期标志触发器IND确定，当它为“0”状态时，表"}
{"doc_id": "co", "page": 350, "text": "344 第3篇中央处理器 示间接寻址结束。再如，对千一些执行周期不访存的指令（如转移指令、寄存器类型指令），同样 可以用它们的操作码与取指周期标志触发器的状态相”与“，作为相应微操作的控制条件。这些 特点读者在控制单元的设计中可进一步体会。 指令周期的数据流 为了便千分析指令周期中的数据流，假设CPU中有存储器地址寄存器MAR、存储器数据寄 存器MDR、程序计数器PC和指令寄存器IR。 1.取指周期的数据流 图8.10所示的是取指周期的数据流。PC中存放现行指令的地址，该地址送到MAR并送至 地址总线，然后由控制部件CU向存储器发读命令，使对应MAR所指单元的内容（指令）经数据 总线送至MDR，再送至IR，并且CU控制PC内容加1，形成下一条指令的地址。 CPU  控制总线 数据总线 地址总线 图8.10取指周期数据流 2.间址周期的数据流 间址周期的数据流如图8.11所示。一旦取指周期结束，CU便检查IR中的内容，以确定其 CPU  控制总线 数据总线 地址总线 图8.11间址周期数据流"}
{"doc_id": "co", "page": 351, "text": "第8章CPU的结构和功能345  是否有间址操作，如果需要间址操作，则MDR中指示形式地址的右N位（记作Ad(MDR)）将被 送到MAR，又送至地址总线，此后CU向存储器发读命令，以获取有效地址并存至MDR。 3.执行周期的数据流 由千不同的指令在执行周期的操作不同，因此执行周期的数据流是多种多样的，可能涉及 CPU内部寄存器间的数据传送、对存储器（或I/0)进行读写操作或对ALU的操作，因此，无法用 统一的数据流图表示。 4.中断周期的数据流 CPU进入中断周期要完成一系列操作（详见9.1节），其中PC当前的内容必须保存起来，以 待执行完中断服务程序后可以准确返回到该程序的间断处，这一操作的数据流如图8.12所示。 CPU  控制总线 数据总线 地址总线 图8.12中断周期数据流 图中由CU把用千保存程序断点的存储器特殊地址（如栈指针的内容）送往MAR，并送到地 址总线上，然后由CU向存储器发写命令，并将PC的内容（程序断点）送到MDR，最终使程序断 点经数据总线存入存储器。此外，CU还需将中断服务程序的入口地址送至PC，为下一个指令周 期的取指周期做好准备。 8.3 指令流水 由前面各章的介绍可知，为了提高访存速度，一方面要提高存储芯片的性能，另一方面可以 从体系结构上，如采用多体、Cache等分级存储措施来提高存储器的性能／价格比。为了提高 机与I/0交换信息的速度，可以采用DMA方式，也可以采用多总线结构，将速度不一的I/0分别 挂到不同带宽的总线上，以解决总线的瓶颈问题。为了提高运算速度，可以采用高速芯片和快速 进位链，以及改进算法等措施。为了进一步提高处理机速度，通常可从提高器件的性能和改进系 统的结构，开发系统的并行性两方面入手。"}
{"doc_id": "co", "page": 352, "text": "346 第3篇中央处理器 (1)提高器件的性能 提高器件的性能一直是提高整机性能的重要途径，计算机的发展史就是按器件把计算机分 为电子管、晶体管、集成电路和大规模集成电路4代的。器件的每一次更新换代都使计算机的软 硬件技术和计算机性能获得突破性进展。特别是大规模集成电路的发展，由于其集成度高、体积 小、功耗低、可靠性高、价格便宜等特点，使人们可采用更复杂的系统结构造出性能更高、工作更 可靠、价格更低的计算机。但是由于半导体器件的集成度越来越接近物理极限，使器件速度的提 高越来越慢。 (2)改进系统的结构，开发系统的并行性 所谓并行，包含同时性和并发性两个方面。前者是指两个或多个事件在同一时刻发生，后者 是指两个或多个事件在同一时间段发生。也就是说，在同一时刻或同一时间段内完成两种或两 种以上性质相同或不同的功能，只要在时间上互相重叠，就存在并行性。 并行性体现在不同等级上。通常分为4个级别：作业级或程序级、任务级或进程级、指令之 间级和指令内部级。前两级为粗粒度，又称为过程级；后两级为细粒度，又称为指令级。粗粒度 并行性(Coarse-grainedParallelism)一般用算法（软件）实现，细粒度并行性(Fine-grained Parallelism)一般用硬件实现。从计算机体系上看，粗粒度并行性是在多个处理机上分别运行多 个进程，由多台处理机合作完成一个程序；细粒度并行性是指在处理机的操作级和指令级的并行 性，其中指令的流水作业就是一项重要技术。这里只讨论有关指令流水的一些主要问题，其他有 关粗粒度并行和粗粒度并行技术将在”计算机体系结构”课程中讲述。 8。3.1指令流水原理 指令流水类似千工厂的装配线，装配线利用了产品在装配的不同阶段其装配过程不同这一 特点，使不同产品处在不同的装配段上，即每个装配段同时对不同产品进行加工，这样可大大提 高装配效率。将这种装配生产线的思想用到指令的执行上，就引出了指令流水的概念。 从上面的分析可知，完成一条指令实际上也可分为许多阶段。为简单起见，把指令的处理过 程分为取指令和执行指令两个阶段，在不采用流水技术的计算机里，取指令和执行指令是周而复 始地重复出现，各条指令按顺序串行执行的，如图8.13所示。 1取指令11执行指令11取指令21执行指令21取指令31执行指令3I… 图8.13指令的串行执行 图中取指令的操作可由指令部件完成，执行指令的操作可由执行部件完成。进一步分析发 现，这种顺序执行虽然控制简单，但执行中各部件的利用率不高，如指令部件工作时，执行部件基 本空闲，而执行部件工作时，指令部件基本空闲。如果指令执行阶段不访问主存，则完全可以利 用这段时间取下一条指令，这样就使取下一条指令的操作和执行当前指令的操作同时进行，如图"}
{"doc_id": "co", "page": 353, "text": "第8章CPU的结构和功能347  8.14所示，这就是两条指令的重叠，即指令的二级流水。 由指令部件取出一条指令，并将它暂存起来，如取指令1执行指令l 勹芦言：；暂又存；二勹尸::／言：L_＿十可而言门昙勹321执钉指令3 起来，这称为指令预取。显然，这种工作方式能加速图8.14指令的二级流水 指令的执行。如果取指和执行阶段在时间上完全重 叠，相当千将指令周期减半。然而进一步分析流水线，就会发现存在两个原因使得执行效率加倍 是不可能的。 心指令的执行时间一般大于取指时间，因此，取指阶段可能要等待一段时间，也即存放在指 令部件缓冲区的指令还不能立即传给执行部件，缓冲区不能空出。 ＠当遇到条件转移指令时，下一条指令是不可知的，因为必须等到执行阶段结束后，才能获 知条件是否成立，从而决定下条指令的地址，造成时间损失。 通常为了减少时间损失，采用猜测法，即当条件转移指令从取指阶段进入执行阶段时，指令 部件仍按顺序预取下一条指令。这样，如果条件不成立，转移没有发生，则没有时间损失；若条件 成立，转移发生，则所取的指令必须丢掉，并再取新的指令。 尽管这些因素降低了两级流水线的潜在效率，但还是可以获得一定程度的加速。为了进一 步提高处理速度，可将指令的处理过程分解为更细的几个阶段。 0取指(FI)：从存储器取出一条指令并暂时存入指令部件的缓冲区。 0指令译码(DI)：确定操作性质和操作数地址的形成方式。 0计算操作数地址(CO)：计算操作数的有效地址，涉及寄存器间接寻址、间接寻址、变址寻 址、基址寻址、相对寻址等各种地址计算方式。 0取操作数(FO)：从存储器中取操作数（若操作数在寄存器中，则无须此阶段）。 0执行指令（EI)：执行指令所需的操作，并将结果存于目的位置（寄存器中）。 0写操作数(WO)：将结果存入存储器。 为了说明方便起见，假设上述各段的时间都是相等的（即每段都为一个时间单元），千是可 得图8.15所示的指令六级流水时序。在这个流水线中，处理器有6个操作部件，同时对6条指 令进行加工，加快了程序的执行速度。 图中9条指令若不采用流水线技术，最终出结果需要54个时间单元，采用六级流水只需要 14个时间单元就可出最后结果，大大提高了处理器速度。当然，图中假设每条指令都经过流水 线的6个阶段，但事实并不总是这样。例如，取数指令并不需要WO阶段。此外，这里还假设不 存在存储器访问冲突，所有阶段均并行执行。如FI、FO和WO阶段都涉及存储器访问，如果出 现冲突就无法并行执行，图8.15示意了所有这些访问都可以同时进行，但多数存储系统做不到 这点，从而影响了流水线的性能。 还有一些其他因素也会影响流水线性能，例如，6个阶段时间不等或遇到转移指令，都会出 现讨论二级流水时出现的问题。"}
{"doc_id": "co", "page": 354, "text": "348 第3篇中央处理器 时间 雇贯14  指令1 I I I I · I I I I I I I I  I FI I DI I CO I FO I EI I WO I I I I I I  |二工1立工1二江1三-1工亡l工亡II I I I I  指令2! ! FI ! DI ! CO ! FO ! EI ! WO! ! ! ! ! I ~工江l工亡l二FI工rl辽亡II I I I  指令3l | | FIl DI i co! FO l EI lwol l I I  指令4i i  i r-i工工l二-1工工1工亡1＝户1 I I FI I DI I CO I FO I EI I WO I I  l } |  I I I I二工1二工1工工1二工1工工1工--l l l  指令5l l l l l fU P口gHE9压I』W9ll  指令6i l I I I I l I I I I I l I l I I FI I DI,co, FOI EI Iwol  |  指令7i i  iiiii---;----t-亡1飞“I=亡1-:,::,-1  I I I I I FI I DI I CO I FO I EI I WO I I I I I l l I I二＝1 = ＝1＝工l二二1--工1=亡|| }  指令8l l l l l l l l-EI」觅因9匡叫巠lw{9ll  指令9i I I I I I l I I I I I I I I |  i j i j j i i j FI j DI i CO i FO j EI jWO i I I I I I I I I I「二工14工1[)Jn 1二J;n，勹江I'工正， 图8.15指令六级流水时序 8.3。2影响流水线性能的因 要使流水线具有良好的性能，必须设法使流水线能畅通流动，即必须做到充分流水，不发生 断流。但通常由千在流水过程中会出现三种相关，使流水线不断流实现起来很困难，这三种相关 是结构相关、数据相关和控制相关。 结构相关是当多条指令进入流水线后，硬件资源满足不了指令重叠执行的要求时产生的。 数据相关是指令在流水线中重叠执行时，当后继指令需要用到前面指令的执行结果时发生的。 控制相关是当流水线遇到分支指令和其他改变PC值的指令时引起的。 为了讨论方便起见，假设流水线由5段组成，它们分别是取指令(IF)、指令译码／读寄存器 (ID)、执行／访存有效地址计算(EX)、存储器访间(MEM)、结果写回寄存器(WB)。 不同类型指令在各流水段的操作是不同的，表8.1列出了ALU类指令、访存类（取数、存数） 指令和转移类指令在各流水段中所进行的操作。 表8.1不同类型指令在各流水段中所进行的操作 指入女 流水段 ALU 取／存转移 IF 取指取指取指 ID  译码译码译码 读寄存器堆读寄存器堆读寄存器堆 EX 执行计算访存有效地址 计算转移目标地址， 设置条件码"}
{"doc_id": "co", "page": 355, "text": "第8章CPU的结构和功能 指人女 流水段 ALU 取／存 MEM 访存（读／写） WB 结果写回寄存器堆将读出的数据写入寄存器堆 下面分析上述三种相关对流水线工作的影响。 1.结构相关 349  续表 转移 若条件成立，将转移 目标地址送PC 结构相关是当指令在重叠执行过程中，不同指令争用同一功能部件产生资源冲突时产生的， 故又有资源相关之称。 通常，大多数机器都是将指令和数据保存在同一存储器中，且只有一个访问口，如果在某个 时钟周期内，流水线既要完成某条指令对操作数的存储器访问操作，又要完成另一条指令的取指 操作，这就会发生访存冲突。如表8.2中，在第4个时钟周期，第i条指令(LOAD)的MEM段和 第i+3条指令的IF段发生了访存冲突。解决冲突的方法可以让流水线在完成前一条指令对数 据的存储器访问时，暂停（一个时钟周期）取后一条指令的操作，如表8.3所示。当然，如果第i 条指令不是LOAD指令，在MEM段不访存，也就不会发生访存冲突。 表8.2两条指令同时访存造成结构相关冲突 时钟周期 指令 1 2 3 4 5 6 7 8  LOAD指令IF ID EX 三WB  指令i+1 IF ID EX MEM WB  指令i+2IF ID EX MEM WB  指令i+3团ID EX MEM WB  指令i+4IF ID EX MEM  表8.3解决访存冲突的一种方案 时钟周期 指令 1 2 3 4 5 6 7 8 9  LOAD指令IF ID EX MEM WB  指令i+1 IF ID EX MEM WB  指令i+2IF ID EX MEM WB  指令i+3停顿IF ID EX MEM WB  指令i+4IF ID EX MEM"}
{"doc_id": "co", "page": 356, "text": "350 第3篇中央处理器 解决访存冲突的另一种方法是设置两个独立的存储器分别存放操作数和指令，以免取指令 和取操作数同时进行时互相冲突，使取某条指令和取另一条指令的操作数实现时间上的军亘0 还可以采用指令预取技术，例如，在CPU(8086)中设置指令队列，将指令预先取到指令队列中排 队。指令预取技术的实现基于访存周期很短的情况，例如，在执行指令阶段，取数时间很短，因此 在执行指令时，主存会有空闲，此时，只要指令队列空出，就可取下一条指令，并放至空出的指令 队列中，从而保证在执行第K条指令的同时对第K+l条指令进行译码，实现“执行k”与“分析 K+l\"的重叠。 2.数据相关 数据相关是流水线中的各条指令因重叠操作，可能改变对操作数的读写访问顺序，从而导致 了数据相关冲突。例如，流水线要执行以下两条指令： ADD R1,R2,R3 ;(R2)+(R3)-+R1  SUB R4,R1,R5 ;(R1)-(R5)-+R4  这里第二条SUB指令中凡的内容必须是第一条ADD指令的执行结果。可见正常的读写 顺序是先由ADD指令写入凡，再由SUB指令来读R1。在非流水线时，这种先写后读的顺序是 自然维持的。但在流水线时，由于重叠操作，使读写的先后顺序关系发生了变化，如表8.4所示。 表8.4ADD和SUB指令发生先写后读(RAW)的数据相关冲突 指令 5 6  ADD IF ID EX MEM 荨 SUB IF  旦 EX MEM ~ WB  \\  读Rl写Rl 由表8.4可见，在第5个时钟周期，ADD指令方可将运算结果写入凡，但后继SUB指令在第 3个时钟周期就要从凡中读数，使先写后读的顺序改变为先读后写，发生了先写后读(RAW)的 数据相关冲突。如果不采取相应的措施，按表8.4的读写顺序，就会使操作结果出错。解决这种 数据相关的方法可以采用后推法，即遇到数据相关时，就停顿后继指令的运行，直至前面指令的 结果已经生成。例如，流水线要执行下列指令序列： ADD R1,R2,R3 ;(R2)+(R3)-+R1  SUB R4,R1,R5 ;(R1)-(R5)-+R4  AND R6, Rl, R7 ; (Rl) AND (R7)-+R6  OR R8,R1,R9 ;(R1) OR (R9)-+R8  XOR R10,R1,Ru ; (R1) XOR (Ru)-+R10  其中，第一条ADD指令将向凡寄存器写入操作结果，后继的4条指令都要使用凡中的值作为 一个源操作数，显然，这时就出现了前述的RAW数据相关。表8.5列出了未对数据相关进行特"}
{"doc_id": "co", "page": 357, "text": "第8章CPU的结构和功能351  殊处理的流水线，表中ADD指令在WB段才将计算结果写入寄存器凡中，但SUB指令在其ID 段就要从寄存器凡中读取该计算结果。同样，AND指令、OR指令也要受到这种相关关系的影 响。对千XOR指令，由于其ID段（第6个时钟周期）在ADD指令的WB段（第5个时钟周期）之 后，因此可以正常操作。 表8.5未对数据相关进行特殊处理的流水线 时钟周期 指令 1 2 3 4 5 6 7 8 9  ADD IF ID EX MEM 匠 SUB IF 回EX MEM WB  AND IF 回EX MEM WB  OR IF 回EX MEM WB  XOR IF 匝EX MEM WB  如果采用后推法，即将相关指令延迟到所需操作数被写回到寄存器后再执行的方式，就可解 决这种数据相关冲突，其流水线如表8.6所示。显然这将要使流水线停顿3个时钟周期。 表8.6对数据相关进行特殊处理的流水线 时钟周期 指令 1 2 3 4 5 6 7 8 9 10 11 12  ADD IF ID EX MEM WB  SUB IF ID EX MEM WB  AND IF ID EX MEM WB  OR IF ID EX MEM WB  XOR IF ID EX MEM WB  另一种解决方法是采用定向技术，又称为旁路技术或相关专用通路技术。其主要思想是不 必待某条指令的执行结果送回到寄存器后，再从寄存器中取出该结果，作为下一条指令的源操作 数，而是直接将执行结果送到其他指令所需要的地方。上述5条指令序列中，实际上要写入凡 的ADD指令在EX段的末尾处已形成，如果设置专用通路技术，将此时产生的结果直接送往需 要它的SUB、AND和OR指令的EX段，就可以使流水线不发生停顿。显然，此时要对3条指令 进行定向传送操作。图8.16示出了带有旁路技术的ALU执行部件。图中有两个暂存器，当 AND指令将进入EX段时，ADD指令的执行结果已存入暂存器2,SUB指令的执行结果已存入暂 存器l，而暂存器2的内容（存放送往凡的结果）可通过旁路通道，经多路开关送到ALU中。这 里的定向传送仅发生在ALU内部。"}
{"doc_id": "co", "page": 358, "text": "352 第3篇中央处理器 根据指令间对同一寄存器读和写操作的先后次序 关系，数据相关冲突可分为写后读相关(ReadAfter  Write,RAW)、读后写相关(WriteAfter Read, WAR)和写 后写相关(WriteAfter Write, WAW)。例如，有i和j两 条指令，i指令在前，j指令在后，则三种不同类型的数 据相关含义如下。 少写后读相关：指令j试图在指令i写入寄存器前 就读出该寄存器内容，这样，指令j就会错误地读出该寄 存器旧的内容。 ＠读后写相关：指令j试图在指令i读出寄存器之 前就写入该寄存器，这样，指令i就错误地读出该寄存 器新的内容。 图8.16带有旁路技术的ALU部件 ＠写后写相关：指令j试图在指令i写入寄存器之前就写入该寄存器，这样，两次写的先后 次序被颠倒，就会错误地使由指令i写入的值成为该寄存器的内容。 上述三种数据相关在按序流动的流水线中，只可能出现RAW相关。在非按序流动的流水 线中，由千允许后进入流水线的指令超过先进入流水线的指令而先流出流水线，则既可能发生 RAW相关，还可能发生WAR和WAW相关。 3.控制相关 控制相关主要是由转移指令引起的。统计表明，转移指令约占总指令的1/4，比起数据相关 来，它会使流水线丧失更多的性能。当转移发生时，将使流水线的连续流动受到破坏。当执行转 移指令时，根据是否发生转移，它可能将程序计数器PC内容改变成转移目标地址，也可能只是 使PC加上一个增量，指向下一条指令的地址。图8.17示意了条件转移的效果。这里使用了和 时间t  霍I1 | 2 | 3 | 4 | 5 | 6 | 7|8 | 9  指令1 I I I. I I I I I I  I FI I DI I CO I PO I EI I WO I I I  l二工l正LI工工1工工l亡--i------11 1  指令2} I FIl DI ico l FO l EI lwol l  I立rl飞工1工工1工工1工r|立工II  指令31  l l l I l l l l I I FI I DI I COI FOI EI lWO}  I I I I l I I I  指令41 I I I FII DI | COI FOl l I I I t-江1工卫I'辽工1工工II  指令5l l l l lfHPi囚9ll  指令6i l l l l I I l l l l l I I FI I DI l l iiiiii---r---ii  护入日~7 I I I ! ! ! ! FI! I I I I I I I t-工II  指令15ll l l l l l 凸L旦义 指令16i I I I I I I I I  I I I I I I l l FI  I I i I I I I I广 10 ll | 12| 13| 14|  I I I  | | | }  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I  I I I I I  I I I I I  I I I I l l I l }  沪如劂W?｝!  l I l l |  DI j CO j FO j EI jWO j  工工1工r1工江1工亡1工二1 转移损失 _＿_＿＿＿＿＿＿＿＿工 图8.17条件转移对指令流水操作的影响"}
{"doc_id": "co", "page": 359, "text": "第8章CPU的结构和功能353  图8.15相同的程序，并假设指令3是一条条件转移指令，即指令3必须待指令2的结果出现后 （第7个时间单元）才能决定下一条指令是4（条件不满足）还是15（条件满足）。由于结果无法 预测，此流水线继续预取指令4，并向前推进。当最后结果满足条件时，发现对第4、5、6、7条指 令所做的操作全部报废。在第8个时间单元，指令15进入流水线。在时间单元9~12之间没有 指令完成，这就是由于不能预测转移条件而带来的性能损失。而图8.15中因转移条件不成立， 未发生转移，得到了较好的流水线性能。 为了解决控制相关，可以采用尽早判别转移是否发生，尽早生成转移目标地址；预取转移成 功或不成功两个控制流方向上的目标指令；加快和提前形成条件码；提高转移方向的猜准率等方 法。有关的详细内容，读者可查阅相关资料进一步了解。 流水线归启 流水线性能通常用吞吐率、加速比和效率3项指标来衡量。 1.吞吐率(ThroughputRate)  在指令级流水线中，吞吐率是指单位时间内流水线所完成指令或输出结果的数量。吞吐率 又有最大吞吐率和实际吞吐率之分。 最大吞吐率是指流水线在连续流动达到稳定状态（参见图8.15第6~9个时间单元，流水线 中各段都处千工作状态）后所获得的吞吐率。对于m段的指令流水线而言，若各段的时间均为 At，则最大吞吐率为 Tpmax =fi  流水线仅在连续流动时才可达到最大吞吐率。实际上由千流水线在开始时有一段建立时间 （第一条指令输入后到其完成的时间），结束时有一段排空时间（最后一条指令输入后到其完成 的时间），以及由千各种相关因素使流水线无法连续流动，因此，实际吞吐率总是小千最大吞 吐率。 实际吞吐率是指流水线完成n条指令的实际吞吐率。对千m段的指令流水线，若各段的时 间均为At，连续处理n条指令，除第一条指令需m· at外，其余(n-1)条指令，每隔At就有一个 结果输出，即总共需m· Lit+(n-l)Lit时间，故实际吞吐率为 T  T =  pmax  mLit+(n-l)Lit Lit[l+(m-1)/n] l+(m-1)/n  仅当n>m时，才会有Tp= Tpmax o  图8.15所示的六级流水线中，设每段时间为At，其最大吞吐率为一，完成9条指令的实际吞 At  吐率为 9  6At+(9-l)Lit0"}
{"doc_id": "co", "page": 360, "text": "354 第3篇中央处理器 2.加速比(SpeedupRatio)  流水线的加速比是指m段流水线的速度与等功能的非流水线的速度之比。如果流水线各 段时间均为At，则完成n条指令在m段流水线上共需T=m· Lit+(n-l)Lit时间。而在等效的非 流水线上所需时间为T'=nmLit。故加速比Sp为 沪nmAt= nm = m  mLit+(n-l)Lit m+n-1 l+(m-1)/n  可以看出，在n::}>m时，Sp接近于m，即当流水线各段时间相等时，其最大加速比等于流水线 的段数。 3.效率(Efficiency) 效率是指流水线中各功能段的利用率。由于流水线有建立时间和排空时间，因此各功能段 的设备不可能一直处千工作状态，总有一段空闲时间。图8.18是4段(m=4)流水线的时空图， 各段时间相等，均为At。图中mnLit是流水线各段处于工作时间的时空区，而流水线中各段总的 时空区是m(m+n-l)Lit。通常用流水线各段处千工作时间的时空区与流水线中各段总的时空 区之比来衡量流水线的效率。用公式表示为 mnLit s  E= = ＝』-=TAt m(m+n-1) Lit m+n-1 m  S空间 麟） S4  S3  S2 I I 1 I 2 I 3 I 4 I s I•.. I,.. I,.. ln-11 n  s1 | 1 | 2 1 3 | 4,  |-_ mAt二I二(n-1)/),.t  I n  图8.18各段时间相等的流水线时空图 4 T时间 例8.1假设指令流水线分取指(IF)、译码(ID)、执行(EX)、回写(WR)4个过程段，共有10 条指令连续输入此流水线。 (1)画出指令周期流程。 (2)画出非流水线时空图。 (3)画出流水线时空图。 (4)假设时钟周期为100ns，求流水线的实际吞吐率。 (5)求该流水处理器的加速比。 解：（l）指令周期包括IF、ID、EX、WR这4个子过程，图8.19(a)为指令周期流程图。 (2)非流水线时空图如图8.19(b)所示。假设一个时间单位为一个时钟周期，则每隔4个"}
{"doc_id": "co", "page": 361, "text": "第8章CPU的结构和功能355  时钟周期才有一个输出结果。 (3)流水线时空图如图8.19(C)所示。由图中可见，第一条指令出结果需要4个时钟周期。 当流水线满载时，以后每一个时钟周期可以出一个结果，即执行完一条指令。 入 空间S WR  EX  ID  IF  I I ',  (a)指令周期流程 空间s!l1! I2  WR  EX  ID  IF , I I l I I I I I  1 2 3 4 5 6 7 8 时间T (b)非流水线时空图 I1 I2 I3 I4 \\ I5 I6 l I7 I8八I9I10l  1 2 3 4 5 6 7 8 9 10 11 12 13时间T (c)标准流水线时空图 图8.19例8.1答图 (4)由图8.19(C)所示的10条指令进入流水线的时空图可见，在13个时钟周期结束时， CPU执行完10条指令，故实际吞吐率为 10/(100 nsX13) =0.77Xl07条指令／秒 (5)在流水处理器中，当任务饱满时，指令不断输入流水线，不论是几级流水线，每隔一个时 钟周期都输出一个结果。对于本题四级流水线而言，处理10条指令所需的时钟周期数为T产 4+(10-1)= 13，而非流水线处理10条指令需4x10 = 40个时钟周期，故该流水处理器的加速比 为40713= 3. 08。 流水线技术使计算机系统结构产生重大革新，为了进一步发展，除了采用好的指令调度算 法、重新组织指令执行顺序、降低相关带来的千扰以及优化编译外，还可开发流水线中的多发技"}
{"doc_id": "co", "page": 362, "text": "356 第3篇中央处理器 术，设法在一个时钟周期（机器主频的倒数）内产生更多条指令的结果。常见的多发技术有超标 量技术、超流水线技术和超长指令字技术。假设处理一条指令分4个阶段：取指(IF)、译码 (ID)、执行(EX)和回写(WR)。图8.20是三种多发技术与普通四级流水线的比较，其中 图8.20(a)为普通四级流水线，一个时钟周期出一个结果。 指令序列指令序列 声三产 0 1 2 3 4 5 6 7 8 9 10 11 12 13 0 1 2 3 4 5 6 7 8 9 10 11 12 13  时钟周期时钟周期 (a)普通流水(b)超标量流水 指令序列指令序列 严三亏 IF IDEXWR  0 1 2 3 4 5 6 7 8 9 10 11 12 13 0 1 2 3 4 5 6 7 8 9 10 11 12 13  时钟周期时钟周期 (c)超流水线(d)超长指令字 图8.20四种流水技术的比较 1.超标量技术 超标量(Superscalar)技术如图8.20(b)所示。它是指在每个时钟周期内可同时并发多条独 立指令，即以并行操作方式将两条或两条以上（图中所示为3条）指令编译并执行。 要实现超标量技术，要求处理机中配置多个功能部件和指令译码电路，以及多个寄存器端口 和总线，以便能实现同时执行多个操作，此外还要编译程序决定哪几条相邻指令可并行执行。 例如，下面两个程序段： 程序段1 MOV BL,8  ADD AX, 1756H  ADD CL,4EH  程序段2 INC AX  ADD AX,BX  MOV DS,AX"}
{"doc_id": "co", "page": 363, "text": "第8章CPU的结构和功能357  左边程序段中的3条指令是互相独立的，不存在数据相关，可实现指令级并行。右边程序段 中的3条指令存在数据相关，不能并行执行。超标量计算机不能重新安排指令的执行顺序，但可 以通过编译优化技术，在高级语言翻译成机器语言时精心安排，把能并行执行的指令搭配起来， 挖掘更多的指令并行性。 2.超流水线技术 超流水线(Superpipeline)技术是将一些流水线寄存器插入流水线段中，好比将流水线再分 段，如图8.20(C)所示。图中将原来的一个时钟周期又分成3段，使超流水线的处理器周期比普 通流水线的处理器周期（如图8.20(a)所示）短，这样，在原来的时钟周期内，功能部件被使用3 次，使流水线以3倍于原来时钟频率的速度运行。与超标量计算机一样，硬件不能调整指令的执 行顺序，靠编译程序解决优化问题。 3.超长指令字技术 超长指令字(VLIW)技术和超标量技术都是采用多条指令在多个处理部件中并行处理的体 系结构，在一个时钟周期内能流出多条指令。但超标量的指令来自同一标准的指令流，VLIW则 是由编译程序在编译时挖掘出指令间潜在的并行性后，把多条能并行操作的指令组合成一条具 有多个操作码字段的超长指令（指令字长可达几百位），由这条超长指令控制VLIW机中多个独 立工作的功能部件，由每一个操作码字段控制一个功能部件，相当于同时执行多条指令，如图 8.20(d)所示。VLIW较超标量具有更高的并行处理能力，但对优化编译器的要求更高，对Cache 的容量要求更大。 流水线结构 1.指令流水线结构 指令流水线是将指令的整个执行过程用流水线进行分段处理，典型的指令执行过程分为 ”取指令—指令译码—形成地址—取操作数—执行指令—回写结果—修改指令指针”这几个阶 段，与此相对应的指令流水线结构由图8.21所示的几个部件组成。 指令流水线对机器性能的改善程度取决于把处理过程分解成多少个相等的时间段数。如上 述共分7段，若每一段需要一个时钟周期，则当不采用流水技术时，需7个时钟周期出一个结果。 采用流水线后，假设流水线不出现断流（如遇到转移指令），则除第一条指令需7个时钟周期出 结果外，以后所有的指令都是一个时钟周期出一个结果。因此，在理想的情况下（流水线不断 流），该流水线的速度约提高到7倍。 2.运算流水线 上述讨论的指令流水线是指令级的流水技术，实际上流水技术还可用于部件级。例如，浮点 加法运算，可以分成“对阶＂＂尾数加”及“结果规格化”3段，每一段都有一个专门的逻辑电路完 成操作，并将其结果保存在锁存器中，作为下一段的输入。如图8.22所示，当对阶完成后，将结 果存入锁存器，便又可进入下一条指令的对阶运算。"}
{"doc_id": "co", "page": 364, "text": "358 第3篇中央处理器 取指令部件取操作数部件操作执行部件 修改指令指针部件 回写结果部件 地址形成部件指令译码部件 对阶功能部件 锁存器 尾数加部件 锁存器 规格化部件 锁存器 I--＿第一段』第二段』第三段』 图8.21指令流水线结构框图图8.22浮点加运算操作流水线 若执行浮点乘运算也按浮点加运算那样分段，即分成阶码运算、尾数乘和结果规格化三级流 水线，就不够合理。因为尾数乘所需的时间比阶码运算和规格化操作长得多，而且尾数乘可以和 阶码运算同时进行，因此，尾数乘本身就可以用流水线。 由图8.22可见，流水线相邻两段在执行不同的操作，因此在相邻两段之间必须设置锁存器 或寄存器，以保证在一个时钟周期内流水线的输入信号不变。这一指导思想也适用于指令流水。 此外，只有当流水线各段工作饱满时，才能发挥最大作用。上例中如果浮点运算没有足够的数据 来源，那么流水线中的某些段甚至全部段都处于空闲状态，使流水线的作用没有充分发挥。因此 具体是否采用流水线技术以及在计算机的哪一部分采用流水线技术需根据情况而定。 8  断系统 第5章已经介绍了有关中断的一些概念，特别对I/0中断做了较详细的讨论。实际上I/0 中断只是CPU众多中断中的一种，引起中断的因素很多，为了处理各种中断，CPU内通常设有处 理中断的机构——中断系统，以解决各种中断的共性问题。本节进一步分析中断系统的功能，以 便更深入地了解中断系统在CPU中的作用和地位。 概 从前面分析可知，采用中断方式实现主机与I/0交换信息可使CPU和I/0并行工作，提高 CPU的效率。其实，计算机在运行过程中，除了会遇到I/0中断外，还有许多意外事件发生，如 电源突然掉电，机器硬件突然出现故障，人们在机器运行过程中想随机抽查计算的中间结果，实 现人机联系等。此外，在实时处理系统中，必须及时处理某个事件或现象，例如，在过程控制系统 中，当突然出现温度过高、电压过大等情况时，必须及时将这些信息送至计算机，由计算机暂时中 断现行程序，转去执行中断服务程序，以解决这种异常情况。再如，计算机实现多道程序运行时， 可以通过分配给每道程序一个固定时间片，利用时钟定时发中断进行程序切换。在多处理机系"}
{"doc_id": "co", "page": 365, "text": "第8章CPU的结构和功能359  统中，各处理器之间的信息交流和任务切换也可通过中断来实现。总之，为了提高计算机的效 率，为了处理一些异常情况以及实时控制、多道程序和多处理机的需要，提出了中断的概念。 1.引起中断的各种因素 引起中断的因素很多，大致可分为以下几类。1解题程序 (1)人为设置的中断 这种中断一般称为自愿中断，因为它是在程序中人为设置 的，故一旦机器执行这种人为中断，便自愿停止现行程序而转入 中断处理，如图8.23所示。图8.23自愿中断示意 图中的“转管指令”可能是转至从I/0设备调入一批信息到 主存的管理程序，也可能是转至将一批数据送往打印机打印的管理程序。显然，当用户程序执行 了“转管指令”后，便中断现行程序，转入管理程序，这种转移完全是自愿的。 IBM PC (Intel 8086)的INTTYPE指令类似千这种自愿中断，它完成系统调用。TYPE决定 了系统调用的类型。 (2)程序性事故 如定点溢出、浮点溢出、操作码不能识别、除法中出现“非法”等，这些都属千由程序设计不 周而引起的中断。 (3)硬件故障 硬件故障类型很多，如插件接触不良、通风不良、磁表面损坏、电源掉电等，这些都属于硬设 备故障。 (4) I/0设备 I/0设备被启动以后，一旦准备就绪，便向CPU发出中断请求。每个I/0设备都能发中断 请求，因此这种中断与计算机所配置的I/0设备多少有关。 (5)外部事件 用户通过键盘来中断现行程序属于外部事件中断。 上述各种中断因素除自愿中断是人为的以外，大多都是随机的。通常将能引起中断的各个 因素称为中断源。中断源可分两大类：一类为不可屏蔽中断，这类中断CPU不能禁止响应，如电 源掉电；另一类为可屏蔽中断，对可屏蔽中断源的请求，CPU可根据该中断源是否被屏蔽来确定 是否给予响应。若未屏蔽则能响应；若已被屏蔽，则CPU不能响应（有关内容详见8.4.6节中断 屏蔽技术）。 2.中断系统须解决的问题 叩各中断源如何向CPU提出中断请求。 ＠当多个中断源同时提出中断请求时，中断系统如何确定优先响应哪个中断源的请求。 @ CPU在什么条件、什么时候、以什么方式来响应中断。 @CPU响应中断后如何保护现场。 @ CPU响应中断后，如何停止原程序的执行而转入中断服务程序的入口地址。"}
{"doc_id": "co", "page": 366, "text": "360 第3篇中央处理器 ＠中断处理结束后，CPU如何恢复现场，如何返回到原程序的间断处。 ＠在中断处理过程中又出现了新的中断请求，CPU该如何处理。 要解决上述7个问题，只有在中断系统中配置相应的硬件和软件，才能完成中断处理任务。 中断请求标记和中断判优逻辑 1.中断请求标记 为了判断是哪个中断源提出请求，在中断系统中必须设置中断请求标记触发器，简称中断请 求触发器，记作INTR。当其状态为“1”时，表示 中断源有请求。这种触发器可集中设在CPU 内，组成一个中断请求标记寄存器，如图8.24 所示。 图中1,2,3,4,5,…，n分别对应掉电、过 热、主存读写校验错、阶上溢、非法除法……打 印机输出等中断源的中断请求触发器，其中任 | 1 | 2 1 3 1 4 | 5  嚣岱喜厘贞 读溢除 写法 `  图8.24中断请求标记寄存器 亡巨］ 键打 盘印 输机 入输 出 意一个触发器为1，即表明对应的中断源提出了中断请求。显然，中断请求触发器越多，说明计 算机处理中断的能力越强。 有一点需要说明，尽管中断请求标记寄存器是由各中断请求触发器组成的，但这些触发器既 可以集中在CPU的中断系统内，也可以分散到各个中断源中。在图5.41所示的程序中断方式 接口电路中，INTR就是分散在各个接口电路内的中断请求触发器。 2.中断判优逻辑 任何一个中断系统，在任一时刻，只能响应一个中断源的请求。但许多中断源提出请求都是 随机的，当某一时刻有多个中断源提出中断请求时，中断系统必须按其优先顺序予以响应，这称 为中断判优。各中断源的优先顺序是根据该中断源若得不到及时响应，致使机器工作出错的严 重程度而定的。例如，电源掉电对计算机工作影响程度最大，优先等级为最高。又如“定点溢 出“对机器正常工作影响也很大，若不及时响应，将使计算机一切运行均无效，故它的优先等级 也较高。对千I/0设备，则可按其速度高低安排优先等级，速度高的设备优先级比速度低的设 备高。 中断判优可用硬件实现，也可用软件实现。 (1)硬件排队 硬件排队又分两种。一种为链式排队器，对应中断请求触发器分散在各个接口电路中的 情况，如图5.38所示，每一个接口电路中都设有一个非门和一个与非门，它们犹如链条一样串 接起来。另一种排队器设在CPU内，如图8.25所示，图中假设其优先顺序按1、2、趴4由高向 低排列。这样，当最高优先级的中断源有请求时INTR1= 1，就可封住比它级别低的中断源的 请求。"}
{"doc_id": "co", "page": 367, "text": "INTP1  INTR1  最高优先级 请求中断 第8章CPU的结构和功能 INTP2  IN巩 次优先级 请求中断 INTP3 INTP4  INTR3 INTR4  再次优先级 请求中断 图8.25集中在CPU内的排队器 (2)软件排队 361  软件排队是通过编写查询程序实现的，其程序框图如图8.26所示。程序按中断源的优先等 级，从高至低逐级查询各中断源是否有中断请求，这样就可以保证CPU首先响应级别高的中断 源的请求。 转A的服务 程序入口地址 转B的服务 程序入口地址 转C的服务 程序入口地址 图8.26按A>B>C..,优先级别的软件排队 断服务程序入口地址的寻找 由于不同的中断源对应不同的中断服务程序，故准确找到服务程序的入口地址是中断处理 的核心问题。通常有两种方法寻找入口地址：硬件向量法和软件查询法。"}
{"doc_id": "co", "page": 368, "text": "362 第3篇中央处理器 1.硬件向量法 硬件向量法就是利用硬件产生向量地址，再由向量地址找到中断服务程序的入口地址。向 量地址由中断向量地址形成部件产生，这个电路可分散设置在各个接口电路中（如图5.41中的 设备编码器），也可设置在CPU内，如图8.27所示。 由向量地址寻找中断服务程序的入口地址通常采用两种办法。一种如图5.40所示，在向量 地址内存放一条无条件转移指令，CPU响应中断时，只要将向量地址（如12H)送至PC，执行这 条指令，便可无条件转向打印机服务程序的入口地址200。另一种是设置向量地址表，如图8.28 所示。该表设在存储器内，存储单元的地址为向量地址，存储单元的内容为入口地址，例如，图 8.28中的12H、13H、14H为向量地址，200、300、400为入口地址，只要访问向量地址所指示的存 储单元，便可获得入口地址。 硬件向量法寻找入口地址速度快，在现代计算机中被普遍采用。 中断向量 主存 向量地址［］勹言言 来自图8.25的排队器输出 图8.27集中在CPU内的向量地址形成部件图8.28中断向量地址表 2.软件查询法 用软件寻找中断服务程序入口地址的方法称为软件查询法，其框图同图8.26。由图8.26中 可见，当查到某一中断源有中断请求时，接着安排一条转移指令，直接指向此中断源的中断服务 程序入口地址，机器便能自动进入中断处理。至于各中断源对应的入口地址，则由程序员（或系 统）事先确定。这种方法不涉及硬件设备，但查询时间较长。计算机可具备软、硬件两种方法寻 找入口地址，使用户使用更方便、灵活。 断晌 1.响应中断的条件 由第5章已知，CPU响应I/0中断的条件是允许中断触发器必须为“1\"，这一结论同样适合 于其他中断源。在中断系统中有一个允许中断触发器EINT，它可被开中断指令置”1\"，也可被 关中断指令置“0”。当允许中断触发器为“1”时，意味着CPU允许响应中断源的请求；当其为 \"O”时，意味着CPU禁止响应中断。故当EINT=1，且有中断请求（即中断请求标记触发器INTR= l)时，CPU可以响应中断。"}
{"doc_id": "co", "page": 369, "text": "第8章CPU的结构和功能363  2.响应中断的时间 与响应I/0中断一样，CPU总是在指令执行周期结束后，响应任何中断源的请求，如图8.8 所示。在指令执行周期结束后，若有中断，CPU则进入中断周期；若无中断，则进入下一条指令 的取指周期。 之所以CPU在指令的执行周期后进入中断周期，是因为CPU在执行周期的结束时刻统一 向所有中断源发中断查询信号，只有此时，CPU才能获知哪个中断源有请求。如图8.29所示，图 中INTR/i= 1,2,…）是各个中断源的中断请求触发器，触发器的数据端来自各中断源，当它们 有请求时，数据端为“1\"，而且只有当CPU发出的中断查询信号输入触发器的时钟端时，才能将 INTRi置“1”。 CPU  中断查询 至排队器 中断源1中断源2中断源n 图8.29CPU在统一时间发中断查询信号 在某些计算机中，有些指令执行时间很长，若CPU的查询信号一律安排在执行周期结束时 刻，有可能因CPU发现中断请求过迟而出差错。为此，可在指令执行过程中设置若干个查询断 点，CPU在每个“查询断点”时刻均发中断查询信号，以便发现有中断请求便可及时响应。 3.中断隐指令 CPU响应中断后，即进入中断周期。在中断周期内，CPU要自动完成一系列操作，具体 如下： (1)保护程序断点 保护程序断点就是要将当前程序计数器PC的内容（程序断点）保存到存储器中。它可以存 在存储器的特定单元（如0号地址）内，也可以存入堆栈。 (2)寻找中断服务程序的入口地址 由千中断周期结束后进入下条指令（即中断服务程序的第一条指令）的取指周期，因此在中 断周期内必须设法找到中断服务程序的入口地址。由于入口地址有两种方法获得，因此在中断 周期内也有两种方法寻找入口地址。 其一，在中断周期内，将向量地址送至PC（对应硬件向量法），使CPU执行下一条无条件转 移指令，转至中断服务程序的入口地址。 其二，在中断周期内，将如图8.26所示的软件查询入口地址的程序（又称中断识别程序）首 地址送至PC，使CPU执行中断识别程序，找到入口地址（对应软件查询法）。"}
{"doc_id": "co", "page": 370, "text": "364 第3篇中央处理器 (3)关中断 CPU进入中断周期，意味着CPU响应了某个中断源的请求，为了确保CPU响应后所需做的 一系列操作不至千又受到新的中断请求的干扰，在 中断周期内必须自动关中断，以禁止CPU再次响应 新的中断请求。图8.30是CPU自动关中断的示意 图。图中允许中断触发器EINT和中断标记触发器 INT可选用标准的R-S触发器。当进入中断周期 时，INT为“1”状态，触发器原端输出有一个正跳变， 经反相后产生一个负跳变，使EINT置“0\"'即关 中断。 上述保护断点、寻找入口地址和关中断这些操 作都是在中断周期内由一条中断隐指令完成的。所 谓中断隐指令，即在机器指令系统中没有的指令，它 是CPU在中断周期内由硬件自动完成的一条指令。 图8.30硬件关中断示意图 保护现场和恢复现场 保护现场应该包括保护程序断点和保护CPU内部各寄存器内容的现场两个方面。程序断 点的现场由中断隐指令完成，各寄存器内的现场可在中断服务程序中由用户（或系统）用机器指 令编程实现，参见5.5.5节及图5.43。 恢复现场是指在中断返回前，必须将寄存器的内容恢复到中断处理前的状态，这部分工作也 由中断服务程序完成，如图5.43所示。 中断屏蔽技术 中断屏蔽技术主要用千多重中断。 1.多重中断的概念 k1  + k  第一次第一次第＝次 中断中一断中断 图8.31多重中断示意图 当CPU正在执行某个中断服务程序时，另一个中断源又提出了 新的中断请求，而CPU又响应了这个新的请求，暂时停止正在运行 的服务程序，转去执行新的中断服务程序，这称为多重中断，又称中 断嵌套，如图8.31所示。如果CPU对新的请求不予响应，待执行完 当前的服务程序后再响应，即为单重中断。中断系统若要具有处理 多重中断的功能，必须具备各项条件。 2.实现多重中断的条件 少提前设置“开中断”指令。"}
{"doc_id": "co", "page": 371, "text": "第8章CPU的结构和功能365  由上述分析可知，CPU进入中断周期后，由中断隐指令自动将EINT置“0”，即关中断，这就 意味着CPU在执行中断服务程序中禁止响应新的中断请求。CPU若想再次响应中断请求，必须 开中断，这一任务通常由中断服务程序中的开中断指令实现。由于开中断指令设置的位置不同， 决定了CPU能否实现多重中断。由图5.43可见，多重中断“开中断”指令的位置前于单重中断， 从而保证了多重中断允许出现中断嵌套。 ＠优先级别高的中断源有权中断优先级别低的中断源。 在满足心的前提下，只有优先级别更高的中断源请求才可以中断比其级别低的中断服务程 序，反之则不然。例如，有A、B、C、D4个中断源，其优先级按A-+B-+C-+D由高向低次序排列。 在CPU执行主程序期间，同时出现了B和C的中断请求，由于B级别高于C，故首先执行B的服 务程序。当B级中断服务程序执行完返回主程序后，由于C请求未撤销，故CPU又再去执行C 级的中断服务程序。若此时又出现了D请求，因为D级别低于C，故CPU不响应，当C级中断服 务程序执行完返回主程序后再去执行D级的服务程序。若此时又出现了A请求，因A级别高千 D，故CPU暂停对D级中断服务程序的执行，转去执行A级中断服务程序，等A级中断服务程序 执行完后，再去执行D级中断服务程序。上述的中断处理示意图如图8.32所示。 骂黑主程序中断服务程序 r ^ \\  A B C D  B、c- D- A-------- 图8.32多重中断处理示意图 为了保证级别低的中断源不干扰比其级别高的中断源的中断处理过程，保证上述＠的实施， 可采用屏蔽技术。 3.屏蔽技术 (1)屏蔽触发器与屏蔽字 图5.37示出了程序中断接口电路中完成触发器D、中断请求触发器INTR和屏蔽触发器 MASK三者之间的关系。当该中断源被屏蔽时(MASK=1)，此时即使D=l，中断查询信号到来 时刻只能将INTR置“O\",CPU接收不到该中断源的中断请求，即它被屏蔽。若该中断源未被屏 蔽(MASK=O)，当设备工作已完成时(D=l)，中断查询信号则将INTR置”1”，表示该中断源向 CPU发出中断请求，该信号送至排队器进行优先级判断。"}
{"doc_id": "co", "page": 372, "text": "366 第3篇中央处理器 如果排队器集中设在CPU内，加上屏蔽条件，就可组成具有屏蔽功能的排队器，如图8.33 所示。 INTP2 INTP3 INTP4  INTR1 MASK1 I I INTR3酰3 INTR2酰2INTR4 MASK4  图8.33具有屏蔽功能的排队器 显然，对应每个中断请求触发器就有一个屏蔽触发器，将所有屏蔽触发器组合在一起，便构 成一个屏蔽寄存器，屏蔽寄存器的内容称为屏蔽字。屏蔽字与中断源的优先级别是一一对应的， 如表8.7所示。 优先级 表8.7中断优先级与屏蔽字的关系 屏蔽字 23456  1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1  0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1  0 0 1 1 1 1 1 1 1 1 1 1 1 1 1 1  0 0 0 1 1 1 1 1 1 1 1 1 1 1 1 1  0 0 0 0 1 1 1 1 1 1 1 1 1 1 1 1  0 0 0 0 0 1 1 1 1 1 1 1 1 1 1 1  15  16  0000000000000011  0000000000000001  表8.7是对应16个中断源的屏蔽字，每个屏蔽字由左向右排序为第1,2,3…，共16位。不 难发现，每个中断源对应的屏蔽字是不同的。1级中断源的屏蔽字是16个1;2级中断源的屏蔽 字是从第2位开始共15个1;3级中断源的屏蔽字是从第3位开始共14个1……第16级中断源 的屏蔽字只有第16位为1，其余各位为0。 在中断服务程序中设置适当的屏蔽字，能起到对优先级别不同的中断源的屏蔽作用。例如， 1级中断源的请求已被CPU响应，若在其中断服务程序中（通常在开中断指令前）设置一个全 “1\"的屏蔽字，便可保证在执行1级中断服务程序过程中，CPU不再响应任何一个中断源（包括 本级在内）的中断请求，即此刻不能实现多重中断。如果在4级中断源的服务程序中设置一个"}
{"doc_id": "co", "page": 373, "text": "第8章CPU的结构和功能367  屏蔽字0001111111111111，由千第1~3位为0，意味着第1~3级的中断源未被屏蔽，因此在开中 断指令后，比第4级中断源级别更高的1、2、3级中断源可以中断4级中断源的中断服务程序，实 现多重中断。 (2)屏蔽技术可改变优先等级 严格地说，优先级包含响应优先级和处理优先级。响应优先级是指CPU响应各中断源请 求的优先次序，这种次序往往是硬件线路巳设置好的，不便千改动。处理优先级是指CPU实 际对各中断源请求的处理优先次序。如果不采用屏蔽技术，响应的优先次序就是处理的优先 次序。 采用了屏蔽技术后，可以改变CPU处理各中断源的优先等级，从而改变CPU执行程序的 轨迹。例如，A、B、C、D这4个中断源的优先级别按A-+-B-+-C-+-D降序排列，根据这一次序， CPU执行程序的轨迹如图8.34所示。当4个中断源同时提出请求时，处理次序与响应次序 一致。 服务程序 三＼ A处理完 A、B、C、D同时 请求中断 图8.34CPU执行程序的轨迹 D处理完t 在不改变CPU响应中断的次序下，通过改变屏蔽字可以改变CPU处理中断的次序。例如， 将上述4个中断源的处理次序改为A-+D-+C-+B，则每个中断源所对应的屏蔽字发生了变化，如 表8.8所示。表中原屏蔽字对应A-+B-+C-+D的响应顺序，新屏蔽字对应A-+D-+C一B的处理 顺序。 表8。8中断处理次序与屏蔽字的关系 中断源原屏蔽字新屏蔽字 A 1 1 1 1 1 1 1 1  B 0 1 1 1 0 1 0 0  C 0 0 1 1 0 1 1 0  D 0 0 0 1 0 1 1 1"}
{"doc_id": "co", "page": 374, "text": "368 第3篇中央处理器 在同样中断请求的情况下，CPU执行程序的轨迹发生了变化，如图8.35所示。CPU在运行 程序的过程中，若A、B、C、D4个中断源同时提出请求，按照中断级别的高低，CPU首先响应并处 理A中断源的请求，由于A的屏蔽字是1111，屏蔽了所有的中断源，故A程序可以全部执行完， 然后回到主程序。由于B、C、D的中断请求还未响应，而B的响应优先级高于其他，所以CPU响 应B的请求，进入B的中断服务程序。在B的服务程序中，由于设置了新的屏蔽字0100，即A、 C、D可打断B，而A程序已执行完，C的响应优先级又高于D，于是CPU响应C，进入C的服务程 序。在C的服务程序中，由于设置了新的屏蔽字0110，即 A、D可打断C，由于A程序已执行完， 于是CPU响应D，执行D的服务程序。在D的服务程序中，屏蔽字变成0111，即只有A可打断 D，但A已处理结束，所以D可以一直执行完，然后回到C程序。C程序执行完后，回到B程序。 B程序执行完后，回到主程序。至此，A、B、C、D均处理完毕。 采用了屏蔽技术后，在中断服务程序中需设置新的屏蔽字，流程如图8.36所示。与第5章 图5.43(b)所示的中断服务程序相比，增加了置屏蔽字和恢复屏蔽字两部分内容。而且为了防 止在恢复现场过程中又出现新的中断，在恢复现场前又增加了关中断，恢复屏蔽字之后，必须再 次开中断。 服务程序 D程序 竺 B程序 主 主程序 A、B、C、D同时 请求中断 !  D处面口 C处理完 图8.35改变中断处理次序后CPU执行程序的轨迹图8.36采用屏蔽技术的中断服务程序 例8.2设某机有4个中断源1、2、3、4，其硬件排队优先次序按1-+2-+3一4降序排列，各中 断源的服务程序中所对应的屏蔽字如表8.9所示。"}
{"doc_id": "co", "page": 375, "text": "第8章CPU的结构和功能369  表8.9例8.2各中断源对应的屏蔽字 中断源 屏蔽字 1 2 3 4  1 1 1 。1  2 。1 。 3  。 1 1 1 1  4 。1 。1  (1)给出上述4个中断源的中断处理次序。 (2)若4个中断源同时有中断请求，画出CPU执行程序的轨迹。 解：（1)根据表8.9,4个中断源的处理次序是按3-+l-+4-+2降序排列。 (2)当4个中断源同时有中断请求时，由千硬件排队的优先次序是1-?-2-+3-+4，故CPU先 响应l的请求，执行1的服务程序。由千在该服务程序中设置了屏蔽字1101，故开中断指令后 转去执行3的服务程序，且3的服务程序执行结束后又回到1的服务程序。1的服务程序结束 后，CPU还有2、4两个中断源请求未响应。由于2的响应优先级高千4，故CPU先响应2的请 求，执行2的服务程序。在2的服务程序中由千设置了屏蔽字0100，意味着l、3、4可中断2的服 务程序。而1、3的请求已处理结束，因此在开中断指令之后转去执行4的服务程序，4的服务程 序执行结束后又回到2的服务程序的断点处，继续执行2的服务程序，直至该程序执行结束。图 8.37示意了CPU执行程序的轨迹。 服务程序 1234 气言 t  1 、2、3、4同时请求中断 图8.37例8.2CPU执行程序的轨迹 (3)屏蔽技术的其他作用 屏蔽技术还能给程序控制带来更大的灵活性。例如，在浮点运算中，当程序员估计到执行某 段程序时可能出现“阶上溢＂，但又不希望因“阶上溢”而使机器停机，为此可设一屏蔽字，使对应 ＂阶上溢＂的屏蔽位为“1”，这样，即使出现“阶上溢＂，机器也不停机。"}
{"doc_id": "co", "page": 376, "text": "370 第3篇中央处理器 4.多重中断的断点保护 多重中断时，每次中断出现的断点都必须保存起来，如图8.31中共出现了3次中断，有3个 断点k+l、l+1、m+l需保存。中断系统对断点的保存都是在中断周期内由中断隐指令实现的，对 用户是透明的。 断点可以保存在堆栈中，由于堆栈先进后出的特点，因此图8.31中的k+l先进栈，接着是 l+ 1进栈，最后是m+l进栈。出栈时，按相反顺序便可准确返回到程序间断处。 断点也可保存在特定的存储单元内，例如约定一律将程序断点存至主存的0号地址单元内。 由于保存断点是由中断隐指令自动完成的，因此3次中断的断点都将存入0地址单元，这势必造 成前两次存入的断点k+l和l+1被冲掉。为此，在中断服务程序中的开中断指令之前，必须先将 0地址单元的内容转存至其他地址单元中，才能真正保存每一个断点。读者可自行练习，画出将 程序断点保存到0号地址单元的多重中断服务程序流程。 题 8.1 CPU有哪些功能？画出其结构框图并简要说明每个部件的作用。 8.2 什么是指令周期？指令周期是否有一个固定值？为什么？ 8.3 画出指令周期的流程图，分别说明图中每个子周期的作用。 8.4 设CPU内有这些部件：PC、IR、SP、AC、MAR、MDR和CU。 (1)画出完成间接寻址的取数指令“LDA@X\"（将主存某地址单元的内容取至AC中）的数据流（从取指令 开始）。 (2)画出中断周期的数据流。 8.5 中断周期前是什么阶段？中断周期后又是什么阶段？在中断周期CPU应完成什么操作？ 8.6 存储器中有若干数据类型：指令代码、运算数据、堆栈数据、字符代码和BCD码，计算机如何识别这些 代码？ 8.7 什么叫系统的并行性？粗粒度并行和细粒度并行有何区别？ 8.8 什么是指令流水？画出指令二级流水和四级流水的示意图，它们中哪一个更能提高处理器速度，为 什么？ 8.9 当遇到什么情况时流水线将受阻？举例说明。 8.10 举例说明流水线中的几种数据相关。 8.11 今有四级流水线，分别完成取指(IF)、译码并取数(ID)、执行(EX)、写结果(WR)4个步骤。假设完 成各步操作的时间依次为90ns、90ns、60ns、45ns。 (1)流水线的时钟周期应取何值？ (2)若相邻的指令发生数据相关，那么第2条指令安排推迟多少时间才能不发生错误？ (3)若相邻两指令发生数据相关，为了不推迟第2条指令的执行，可采取什么措施？ 8.12 在5个功能段的指令流水线中，假设每段的执行时间分别是10ns、8ns、10ns、10ns和7ns。对于完 成12条指令的流水线而言，其加速比为多少？该流水线的实际吞吐率为多少？ 8.13 为什么说超长指令字比超标量更能提高并行处理能力？"}
{"doc_id": "co", "page": 377, "text": "第8章CPU的结构和功能 8.14 指令流水线和运算流水线在结构上有何共同之处？ 8.15 什么是中断？设计中断系统需考虑哪些主要问题？ 8.16 计算机为了管理中断，在硬件上通常有哪些设置？各有何作用？对指令系统有何考虑？ 8.17 在中断系统中，INTR、INT、EINT这3个触发器各有何作用？ 8.18 什么是中断隐指令，有哪些功能？ 8.19 中断系统中采用屏蔽技术有何作用？ 8.20 为实现多重中断，需有哪些硬件支持？ 8.21 CPU在处理中断过程中，有几种方法找到中断服务程序的入口地址？举例说明。 371  8.22 在中断处理过程中，为什么要进行中断判优？有几种实现方法？若想改变原定的优先顺序，可采取 什么措施？ 8.23 在中断处理过程中，“保护现场”需要完成哪些任务？如何实现？ 8.24 现有A、B、C、D4个中断源，其优先级由高向低按A-+B-+C-+D顺序排列。若中断服务程序的执行时 间为20µ,s，根据下图所示时间轴给出的中断源请求中断的时刻，画出CPU执行程序的轨迹。 A服务 B服务 C服务 D服务 0 10 20 30 40 50 60 70 80 90 100 110 120 130 140 t/µs  t t t t  B与C请求D请求B请求A请求 8.25 设某机有5个中断源L。、 L!、L2、L3、L4，按中断响应的优先次序由高向低排序为L。一L1-+L2-+L3一L4, 现要求中断处理次序改为L1分L4-+L2-+L。一儿，根据下面的格式，写出各中断源的屏蔽字。 屏蔽字 中断源 。1 2 3 4  L。 L I  咖咖 L2  L3  L4  8.26 设某机配有A、B、C3台设备，其优先级按A----+B ----+ C降序排列，为改变中断处理次序，它们的中断屏 蔽字设置如下："}
{"doc_id": "co", "page": 378, "text": "372 第3篇中央处理器 设备屏蔽字 A 1 1 1  B 0 1 0  c 0 1 1  按下图所示时间轴给出的设备请求中断的时刻，画出CPU执行程序的轨迹。设A、B、C中断服务程序的执 行时间均为20µs。 A服务 B服务 C服务 0 10 20 30 40 50 60 70 80.90 t/µs  t f f  A请求B请求C请求 8.27 设某机有3个中断源，其优先级按1-+2-+3降序排列。假设中断处理时间均为T，在下图所示的时间 内共发生5次中断请求，图中心表示1级中断源发出中断请求信号，其余类推，画出CPU执行程序的轨迹。 `  0 T  』； 1 祈 __  @  l l  3T 4T  上』 I  5T  l工 6r t  8.28 设某机有4个中断源1、2、3、4，其响应优先级按1---+ 2---+ 3 ---+ 4降序排列，现要求将中断处理次序改为 4---+l---+3---+2。根据下图给出的4个中断源的请求时刻，画出CPU执行程序的轨迹。设每个中断源的中断服务程 序时间均为20µs。 程序 l ; II 520 1 1 01 1 01 1 0`,01 1 01 1 0I l 0 t/µ;  i i i t  ©@ 0 @"}
{"doc_id": "co", "page": 379, "text": ", l I  计算机之所以能自动协调地工作，是由于控制单元(CU)的统一指挥。本篇 详细分析控制单元的功能及其设计思想。"}
{"doc_id": "co", "page": 381, "text": "本章结合指令周期的4个阶段，着重分析控制单元为完成不同指令所发出的各种操作命 令—~这些命令（又称控制信号）控制计算机的所有部件有次序地完成相应的操作，以达到执 行程序的目的一旨在使读者进一步理解指令周期、机器周期、时钟周期（节拍）和控制信号 的关系，进一步体会控制单元在机器运行中所起到的核心作用，为下一章控制单元的设计打 好基础。 9.1 微操作命令的分析 控制单元具有发出各种微操作命令（即控制信号）序列的功能。 概括地说，计算机的功能就是执行程序。在执行程序的过程中，控制单元要发出各种微 操作命令，而且不同的指令对应不同的命令。进一步分析发现，完成不同指令的过程中，有些 操作是相同或相似的，如取指令、取操作数地址（当间接寻址时）以及进入中断周期由中断隐 指令完成的一系列操作。为更清晰起见，下面按指令周期的4个阶段进一步分析其对应的微 操作命令。 为了便千讨论，假设CPU内有4个寄存器，如图8.10所示。MAR与地址总线相连，存放欲 访问的存储单元地址；MDR与数据总线相连，存放欲写入存储器的信息或最近从存储器中读出 的信息；PC存放现行指令的地址，有计数功能；IR存放现行指令。取指令的过程可归纳为以下 几个操作。 心现行指令地址送至存储器地址寄存器，记作PC--+MAR。 ＠向主存发送读命令，启动主存做读操作，记作1--+R。 ＠将MAR（通过地址总线）所指的主存单元中的内容（指令）经数据总线读至MDR内，记作 M(MAR)--+MDR。 ＠将MDR的内容送至IR，记作MDR--+IR。 ＠指令的操作码送至CU译码，记作OP(IR)--+CU。 ＠形成下一条指令的地址，记作(PC)+l--+PC。"}
{"doc_id": "co", "page": 382, "text": "376 第4篇控制单元 间址周期 间址周期完成取操作数有效地址的任务，具体操作如下。 心将指令的地址码部分（形式地址）送至存储器地址寄存器，记作Ad(IR)--+MAR。 ＠向主存发送读命令，启动主存做读操作，记作l--+R。 ＠将MAR（通过地址总线）所指的主存单元中的内容（有效地址）经数据总线读至MDR 内，记作M(MAR)--+MDR。 ＠将有效地址送至指令寄存器的地址字段，记作MDR--+Ad(IR)。此操作在有些机器中可 省略。 执行周期 不同指令执行周期的微操作是不同的，下面分别讨论非访存指令、访存指令和转移类指令的 微操作。 1.非访存指令 这类指令在执行周期不访问存储器。 (1)清除累加器指令CLA 该指令在执行阶段只完成清除累加器操作，记作0---+ACC。 (2)累加器取反指令COM 该指令在执行阶段只完成累加器内容取反，结果送累加器的操作，记作ACC---+ACC。 (3)算术右移一位指令SHR 该指令在执行阶段只完成累加器内容算术右移一位的操作，记作L(ACC) ---+R (ACC),  ACC。---+ACC。(ACC的符号位不变）。 (4)循环左移一位指令CSL 该指令在执行阶段只完成累加器内容循环左移一位的操作，记作R(ACC)---+L(ACC),  ACC。-+AC立（或p-l(ACC)）。 (5)停机指令STP 计算机中有一个运行标志触发器G，当G=l时，表示机器运行；当G=O时，表示停机。STP 指令在执行阶段只需将运行标志触发器置“0\"，记作0---+G。 2.访存指令 这类指令在执行阶段都需要访问存储器。为简单起见，这里只考虑直接寻址的情况，不考虑 其他寻址方式。 (1)加法指令ADDX  该指令在执行阶段需要完成累加器内容与对应千主存X地址单元的内容相加，结果送累加"}
{"doc_id": "co", "page": 383, "text": "第9章控制单元的功能 器的操作，具体如下： 叩将指令的地址码部分送至存储器地址寄存器，记作Ad(IR) ---+ MAR。 ＠向主存发读命令，启动主存做读操作，记作1---+R。 377  ＠将MAR（通过地址总线）所指的主存单元中的内容（操作数）经数据总线读至MDR内，记 作M(MAR)-+MDR。 ＠给ALU发送加命令，将ACC的内容和MDR的内容相加，结果存千ACC，记作(ACC)+  (MDR)一ACC。 当然，也有的加法指令指定两个寄存器的内容相加，如“ADDAX,BX\"，该指令在执行阶段 无须访存，只需完成(AX)+ (BX)-+AX的操作。 (2)存数指令STAX  该指令在执行阶段需将累加器ACC的内容存于主存的X地址单元中，具体操作如下。 心将指令的地址码部分送至存储器地址寄存器，记作Ad(IR) -+ MAR。 ＠向主存发写命令，启动主存做写操作，记作1---+W。 ＠将累加器内容送至MDR，记作ACC---+MDR。 ＠将MDR的内容（通过数据总线）写入MAR（通过地址总线）所指的主存单元中，记作 MDR---+M(MAR)。 (3)取数指令LDAX  该指令在执行阶段需将主存X地址单元的内容取至累加器ACC中，具体操作如下。 少将指令的地址码部分送至存储器地址寄存器，记作Ad(IR) ---+ MAR。 ＠向主存发读命令，启动主存作读操作，记作1---+R。 ＠将MAR（通过地址总线）所指的主存单元中的内容（操作数）经数据总线读至MDR内，记 作M(MAR)-+MDR。 ＠将MDR的内容送至ACC，记作MDR---+ACC。 3.转移类指令 这类指令在执行阶段也不访问存储器。 (1)无条件转移指令JMPX  该指令在执行阶段完成将指令的地址码部分X送至PC的操作，记作Ad(IR)-+PC。 (2)条件转移（负则转）指令BANX  该指令根据上一条指令运行的结果决定下一条指令的地址，若结果为负（累加器最高位为 l，即 A。＝l)，则指令的地址码送至PC，否则程序按原顺序执行。由于在取指阶段已完成了(PC) + 1---+ PC，所以当累加器结果不为负（即A。=0)时，就按取指阶段形成的PC执行，记作 A。.Ad(IR)＋＼。.（PC)-+PC。 由此可见，不同指令在执行阶段所完成的操作是不同的。如果将访存指令分为直接访存和 间接访存两种，则上述三类指令的指令周期如图9.1所示。"}
{"doc_id": "co", "page": 384, "text": "378  断周期 第4篇控制单元 非访存指令周期1丿仅指周期-1二执行周期』 直接访存指令周期I－丿仅指周期」＿丿执行周期-I 间接访存指令周期I--取指周期」一间址周期」一执行周期-I 转移指令周期1二取指周期＿1-一执行周期』 间接转移指令周期1-＿取指周期＿1-间址周期」二执行周期二I 图9.1三类指令的指令周期 在执行周期结束时刻，CPU要查询是否有请求中断的事件发生，如果有则进入中断周期。 由8.4.4节可知，在中断周期，由中断隐指令自动完成保护断点、寻找中断服务程序入口地址以 及硬件关中断的操作。假设程序断点存至主存的0地址单元，且采用硬件向量法寻找入口地址， 则在中断周期需完成如下操作。 少将特定地址“0“送至存储器地址寄存器，记作0-+MAR。 ＠向主存发写命令，启动存储器作写操作，记作1-+W。 ＠将PC的内容（程序断点）送至MDR，记作PC-+MDR。 ＠将MDR的内容（程序断点）通过数据总线写入MAR（通过地址总线）所指示的主存单元 (0地址单元）中，记作MDR-+M(MAR)。 ＠将向量地址形成部件的输出送至PC，记作向量地址-+PC，为下一条指令的取指周期 做准备。 ＠关中断，将允许中断触发器清零，记作0-+EINT（该操作可直接由硬件线路完成，参见图 8.30)。 如果程序断点存入堆栈，而且进栈操作是先修改栈指针，后存入数据（参见图7.18)，只需将 上述心改为(SP)-1-+SP，且SP-+MAR。 上述所有操作都是在控制单元发出的控制信号（即微操作命令）控制下完成的。"}
{"doc_id": "co", "page": 385, "text": "第9章控制单元的功能379  9.2 控制单元的功能 1 腔制”一 图9.2是反映控制单元外特性的框图。 指令寄存器 CPU内的控制信号 标志 时钟 控制单元到系统总线的控制信号 来自系统总线的控制信号 系统总线 图9.2控制单元外特性 1.输入信号 (1)时钟 上述各种操作有以下两点应特别注意。 叩完成每个操作都需占用一定的时间。 ＠各个操作是有先后顺序的。例如，存储器读操作要用到MAR中的地址，故PC-+MAR应 先于M(MAR)-+MDR。 为了使控制单元按一定的先后顺序、一定的节奏发出各个控制信号，控制单元必须受时 钟控制，即每一个时钟脉冲使控制单元发送一个操作命令，或发送一组需要同时执行的操作 人入 叩了。 (2)指令寄存器 现行指令的操作码决定了不同指令在执行周期所需完成的不同操作，故指令的操作码字段 是控制单元的输入信号，它与时钟配合可产生不同的控制信号。 (3)标志 控制单元有时需依赖CPU当前所处的状态（如ALU操作的结果）产生控制信号，如BAN指 令，控制单元要根据上条指令的结果是否为负而产生不同的控制信号。因此“标志”也是控制单 的输入信号。 (4)来自系统总线（控制总线）的控制信号 例如，中断请求、DMA请求。"}
{"doc_id": "co", "page": 386, "text": "380 第4篇控制单元 2.输出信号 (1) CPU内的控制信号 主要用于CPU内的寄存器之间的传送和控制ALU实现不同的操作。 (2)送至系统总线（控制总线）的信号 例如，命令主存或I/0读／写、中断响应等。 控制信号举例 控制单元的主要功能就是能发出各种不同的控制信号。下面以间接寻址的加法指令 \"ADD @X”为例，进一步理解控制信号在完成一条指令的过程中所起的作用。 1.不采用CPU内部总线的方式 图9.3示意了未采用CPU内部总线方式的数据通路和控制信号的关系。图中未画出每个 寄存器的输入或输出控制门，但标出了控制这些门电路的控制信号C!，考虑到从存储器取出的 指令或有效地址都先送至MDR再送至IR，故这里省去了IR送至MAR的数据通路，凡是需要从 IR送至MAR的操作均可由MDR送至MAR代替。 C2  C11  制号控信 .. }·  图9.3未采用CPU内部总线方式的数据通路和控制信号 (1)取指周期 少控制信号凡有效，打开PC送往MAR的控制门。 ＠控制信号凡有效，打开MAR送往地址总线的输出门。 ＠通过控制总线向主存发读命令。 @ c2有效，打开数据总线送至MDR的输入门。 ＠亿有效，打开MDR和IR之间的控制门，至此指令送至IR。 ＠凡有效，打开指令操作码送至CU的输出门。CU在操作码和时钟的控制下，可产生各种"}
{"doc_id": "co", "page": 387, "text": "第9章控制单元的功能381  控制信号。 ＠使PC内容加1（图中未标出）。 (2)间址周期 CD凡有效，打开MDR和MAR之间的控制门，将指令的形式地址送至MAR。 ® cl有效，打开MAR送往地址总线的输出门。 ＠通过控制总线向主存发读命令。 ＠立有效，打开数据总线送至MDR的输入门，至此，有效地址存入MDR。 ＠凡有效，打开MDR和IR之间的控制门，将有效地址送至IR的地址码字段。 (3)执行周期 CD C5有效，打开MDR和MAR之间的控制门，将有效地址送至MAR。 ＠凡有效，打开MAR送往地址总线的输出门。 ＠通过控制总线向主存发读命令。 @ c2有效，打开数据总线送至MDR的输入门，至此，操作数存入MDR。 @c心凡同时有效，打开AC和MDR通往ALU的控制门。 ＠通过CPU内部控制总线对ALU发“ADD“加控制信 号，完成AC的内容和MDR的内容相加。 ＠们有效，打开ALU通往AC的控制门，至此将求和 结果存入AC。 图中亿和ClO分别是控制PC的输出和输入的控制信 号，Cu和c12分别是控制AC的输出和输入的控制信号。 2.采用CPU内部总线的方式 图9.4示意了采用CPU内部总线方式的数据通路和控 制信号的关系，图中每一个小圈处都有一个控制信号，它控 制寄存器到总线或总线到寄存器之间的传送。例如，IRi表 示控制从内部总线到指令寄存器的输入控制门；PC。表示 控制从程序计数器到内部总线的输出控制门。下标为i表 示输入控制，下标为o表示输出控制，以此类推。与图9.3 相比，图9.4多了两个寄存器Y和Z，这是由于ALU是一个 组合逻辑电路，在其运算过程中必须保持两个输入端不变， 其中一个输入可以从Y寄存器中获得，另一个输入可以从 内部总线上获得。当CPU内有多个通用寄存器时，由于设 置了寄存器Y，可实现任意两个寄存器之间的算逻运算。 此外，ALU的输出不能直接与内部总线相连，因为其输出又 会通过总线反馈到ALU的输入，影响运算的正确性，故用 寄存器Z暂存运算结果，再根据需要送至指定的目标。 控制信号 CPU 内部总线 图9.4采用CPU内部总线方式的 数据通路和控制信号"}
{"doc_id": "co", "page": 388, "text": "382 第4篇控制单元 下面仍以完成间接寻址的加法指令“ADD@X”为例，分析控制单元发出的控制信号。 (1)取指周期 叩PC。和MARi有效，完成PC经内部总线送至MAR的操作，即PC-+MAR。 ＠通过控制总线（图中未画出）向主存发读命令，即1-+R。 ＠存储器通过数据总线将MAR所指单元的内容（指令）送至MDR。 @MD凡和IRi有效，将MDR的内容送至IR，即MDR-+IR，至此，指令送至IR，其操作码字 段开始控制CU。 ＠使PC内容加1（图中未标出）。 (2)间址周期 叩MD凡和MARi有效，将指令的形式地址经内部总线送至MAR，即MDR-+MAR。 ＠通过控制总线向主存发读命令，即1-+R。 ＠存储器通过数据总线将MAR所指单元的内容（有效地址）送至MDR。 @MDR。和IR有效，将MDR中的有效地址送至IR的地址码字段，即MDR一Ad(IR)。 (3)执行周期 叩MD凡和MARi有效，将有效地址经内部总线送至MAR，即MDR-+MAR。 ＠通过控制总线向主存发读命令，即1-+R。 ＠存储器通过数据总线将MAR所指单元的内容（操作数）送至MDR。 @MDR。和Yi有效，将操作数送至Y，即MDR-+Y。 @AC。和ALUi有效，同时CU向ALU发“ADD“加控制信号，使AC的内容和Y的内容相加 (Y的内容送至ALU不必通过总线），结果送寄存器Z，即（AC)+ (Y)-+Z。 @zo和ACi有效，将运算结果存入AC，即Z-+AC。 现代计算机的CPU都集成在一个硅片内，在芯片内采用内部总线的方式可大大节省芯片内 部寄存器之间的连线，使芯片内各部件布局更合理。 例9.1设CPU内部采用非总线结构，如图9.3所示。 (1)写出取指周期的全部微操作。 (2)写出取数指令“LDAM'＼存数指令“STAM'＼加法指令“ADDM\" (M均为主存地址）在 执行阶段所需的全部微操作。 (3)当上述指令均为间接寻址时，写出执行这些指令所需的全部微操作。 (4)写出无条件转移指令“JMPY”和结果为零则转指令“BAZY”在执行阶段所需的全部微 操作。 解：（1）取指周期的全部微操作如下： PC~MAR  l~R  M(MAR)一MDR MDR~IR  现行指令地址-+MAR 命令存储器读 现行指令从存储器中读至MDR 现行指令一IR"}
{"doc_id": "co", "page": 389, "text": "第9章控制单元的功能 OP(IR)-+CU 指令的操作码一CU译码 (PC) +1-+PC 形成下一条指令的地址 (2)心取数指令“LDAM“执行阶段所需的全部微操作如下： Ad (IR)-+ MAR  1-+R  M(MAR)-+MDR  指令的地址码字段-+MAR 命令存储器读 操作数从存储器中读至MDR MDR--+ACC 操作数--+ACC ＠存数指令“STAM“执行阶段所需的全部微操作如下： Ad (IR)-+ MAR  1-+W  指令的地址码字段-+MAR 命令存储器写 ACC-+MDR 欲写入的数据-+MDR MDR-+M(MAR) 数据写至存储器中 ＠加法指令“ADDM“执行阶段所需的全部微操作如下： Ad(IR)------+MAR  1-------+R  指令的地址码字段-+MAR 命令存储器读 M(MAR)-+MDR 操作数从存储器中读至MDR (ACC) + (MDR)-+ACC 两数相加结果送ACC 383  (3)当上述指令为间接寻址时，需增加间址周期的微操作。这3条指令在间址周期的微操 作是相同的，即 Ad (IR)-+ MAR  1-+R  指令的地址码字段---+MAR 命令存储器读 M (MAR)-+MDR 有效地址从存储器中读至MDR 进入执行周期，3条指令的第一个微操作均为MDR-+MAR（有效地址送MAR)，其余微操作 不变。 (4)心无条件转移指令“JMPY“执行阶段的微操作如下： Ad(IR)-+PC 转移（目标）地址Y-+PC ＠结果为零则转指令“BAZY“执行阶段的微操作如下： Z · Ad (IR)-+PC 当Z=l时，转移（目标）地址Y--+PC (Z为标记触发器，结果为0时Z=1)  例9.2巳知单总线计算机结构如图9.5所示，其中M为主存，XR为变址寄存器，EAR 为有效地址寄存器，LATCH为锁存器。图中各寄存器的输入和输出均受控制信号控制，例 如，PCi表示PC的输入控制信号，MD凡表示MDR的输出控制信号。假设指令地址已存 于PC中，画出“ADDX,D\"(X为变址寄存器XR,D为形式地址）和“STA*D\"(＊表示 相对寻址，D为相对位移量）两条指令的指令周期信息流程图，并列出相应的控制信号 序列。"}
{"doc_id": "co", "page": 390, "text": "384 第4篇控制单元 图9.5单总线计算机结构 解：（1)\"ADD X,D”指令取指周期和执行周期的信息流程及相应的控制信号如图9.6所示， 图中Ad(IR)为形式地址。 —勹PC-,..Bus-,..MAR PC。,M础 M(MAR)---,..MDR M战。，RIW=R,MD凡 MDR--Bus-+IR MDR。．，风 (PC)+l-PC +1  (XR)+Ad(IR)-EAR XR。,Ad(IR)。,+,E玑 EAR-Bus-MAR I EAR。,M矶 M(MAR)-MDR M球。'R/W=R,MD氐 MDR-Bus-X I MDR。,x (ACC)+(X)-LATCH I ACC。,X。，民＝＋，LATC凡 LATCH刁Bus二LATCH。,ACCi 图9.6\"ADD X,D”指令周期的信息流程及相应的控制信号 (2) \"STA * D”指令取指周期和执行周期的信息流程及相应的控制信号如图9.7所示，图 中Ad(IR)为相对位移量的机器代码。"}
{"doc_id": "co", "page": 391, "text": "第9章控制单元的功能385  PC-Bus-MAR I PC。,M矶 M(MAR)--+MDR MAR。,“=R,MD凡 MDR刁Bus开IRMDR。，风 (PC)+l-PC +1  (PC)+Ad(IR)-EAR PC。,Ad(IR.)0,+, EA凡 EAR-,.Bus-,.MAR I EAR。,M础 ACC-Bus-MDR I ACC。,MD凡 MDR-M(MAR) MDR。,MAR。，顽＝W 图9.7\"STA * D”指令周期的信息流程及相应的控制信号 级 l．机器周期 机器周期可看作所有指令执行过程中的一个基准时间，机器周期取决于指令的功能及器件 的速度。确定机器周期时，通常要分析机器指令的执行步骤及每一步骤所需的时间。例如，取 数、存数指令能反映存储器的速度及其与CPU的配合情况；加法指令能反映ALU的速度；条件 转移指令因为要根据上一条指令的执行结果，经测试后才能决定是否转移，所需的时间较长。总 之，通过对机器指令执行步骤的分析，会找到一个基准时间，在这个基准时间内，所有指令的操作 都能结束。若以这个基准时间定为机器周期，显然不是最合理的。因为只有以完成复杂指令功 能所需的时间（最长时间）作为基准，才能保证所有指令在此时间内完成全部操作，这对简单指 令来说，显然是一种浪费。 进一步分析发现，机器内的各种操作大致可归属为对CPU内部的操作和对主存的操作两大 类，由于CPU内部的操作速度较快，CPU访存的操作时间较长，因此通常以访问一次存储器的时 间定为基准时间较为合理，这个基准时间就是机器周期。又由于不论执行什么指令，都需要访问 存储器取出指令，因此在存储字长等于指令字长的前提下，取指周期也可看作机器周期。 2.时钟周期（节拍、状态） 在一个机器周期里可完成若干个微操作，每个微操作都需要一定的时间，可用时钟信号来控 制产生每一个微操作命令（如图9.3中的Ci)。时钟就好比计算机的心脏，只要接通电源，计算"}
{"doc_id": "co", "page": 392, "text": "386 第4篇控制单元 机内就会产生时钟信号。时钟信号可由机器主振电路（如晶体振荡器）发出的脉冲信号经整形 （或倍频、分频）后产生，时钟信号的频率即为CPU主频。用时钟信号控制节拍发生器，就可产生 节拍。每个节拍的宽度正好对应一个时钟周期。在每个节拍内机器可完成一个或几个需同时执 行的操作，它是控制计算机操作的最小时间单位。图9.8反映了机器周期、时钟周期和节拍的关 系，图中一个机器周期内有4个节拍T。、九、T2、T30 时钟 时钟周期一­I  h  I  机器周期 二 II 图9.8机器周期、时钟周期和节拍的关系 3.多级时序系统 图9.9反映了指令周期、机器周期、节拍（状态）和时钟周期的关系。可见，一个指令周期包 含若干个机器周期，一个机器周期又包含若干个时钟周期（节拍），每个指令周期内的机器周期 数可以不等，每个机器周期内的节拍数也可以不等。其中，图9.9(a)为定长的机器周期，每个机 时钟 昙） T。T1T2 T3 I'。T1T2 T3 I;。T1T2,T3  机（取器指周令期) （取机有器效周地期址）咖• （机执器行指周令期)  指令周期 (a)定长的机器周期 ｀饥 T。Tl1了2173 T。T1T2  机（取器指周令期) （机执器行周指令期)  指令周期 (b)不定长的机器周期 图9.9指令周期、机器周期、节拍和时钟周期的关系"}
{"doc_id": "co", "page": 393, "text": "第9章控制单元的功能387  器周期包含4个节拍(4个T)；图9.9(b)为不定长的机器周期，每个机器周期包含的节拍数可以 为4个，也可以为3个，后者适合千操作比较简单的指令，它可跳过某些时钟周期（如兀），从而 缩短指令周期。 机器周期、节拍（状态）组成了多级时序系统。 一般来说，CPU的主频越快，机器的运行速度也越快。在机器周期所含时钟周期数相同的 前提下，两机平均指令执行速度之比等于两机主频之比。例如，CPU的主频为8MHz，其平均指 令执行速度为0.8MIPS。若想得到平均指令执行速度为0.4MIPS的机器，则只需要用主频为 (8 MHzx0.4 MIPS) /0.8 MIPS= 4 MHz的CPU即可。 实际上机器的速度不仅与主频有关，还与机器周期中所含的时钟周期数以及指令周期中所 含的机器周期数有关。同样主频的机器，由于机器周期所含时钟周期数不同，运行速度也不同。 机器周期所含时钟周期数少的机器，速度更快。 例9.3设某计算机的CPU主频为8MHz，每个机器周期平均含2个时钟周期，每条指令的 指令周期平均有2.5个机器周期，试间该机的平均指令执行速度为多少MIPS?若CPU主频不 变，但每个机器周期平均含4个时钟周期，每条指令的指令周期平均有5个机器周期，则该机的 平均指令执行速度又是多少MIPS?由此可得出什么结论？ 解：由于主频为8MHz，所以时钟周期为1/8= 0.125 µs，机器周期为0.125x2 = 0.25 µs，指令 周期为0.25x2.5= 0.625 µs。 心平均指令执行速度为1/0.625= 1.6 MIPS。 ＠若CPU主频不变，机器周期含4个时钟周期，每条指令平均含5个机器周期，则指令周期 为0.125x4x5= 2.5 µs，故平均指令执行速度为1/2.5= 0.4 MIPS。 ＠可见机器的运行速度并不完全取决于主频。 此外，机器的运行速度还和其他很多因素有关，如主存的运行速度、机器是否配有Cache、总 线的数据传输率、硬盘的运行速度以及机器是否采用流水技术等。机器速度还可以用MIPS（执 行百万条指令数每秒）和CPI（执行一条指令所需的时钟周期数）来衡量。 控制单元控制一条指令执行的过程实质上是依次执行一个确定的微操作序列的过程。由千 不同指令所对应的微操作数及其复杂程度不同，因此每条指令和每个微操作所需的执行时间也 不同。通常将如何形成控制不同微操作序列所采用的时序控制方式称为CU的控制方式。常见 的控制方式有同步控制、异步控制、联合控制和人工控制四种。 1.同步控制方式 同步控制方式是指，任何一条指令或指令中任何一个微操作的执行都是事先确定的，并且都 是受统一基准时标的时序信号所控制的方式。 图9.9(a)就是一种典型的同步控制方式，每个机器周期都包含4个节拍。如果机器内的存"}
{"doc_id": "co", "page": 394, "text": "388 第4篇控制单元 储器存取周期不统一，那么只有把最长的存取周期作为机器周期，才能采用同步控制，否则取指 令和取数时间不同，无法用统一的基准。又如有些不访存的指令，执行周期的微操作较少，无须 4个节拍。因此，为了提高CPU的效率，在同步控制中又有三种方案。 (1)采用定长的机器周期 这种方案的特点是：不论指令所对应的微操作序列有多长，也不管微操作的简繁，一律以最 长的微操作序列和最繁的微操作作为标准，采取完全统一的、具有相同时间间隔和相同数目的节 拍作为机器周期来运行各种不同的指令，如图9.9(a)所示。显然，这种方案对千微操作序列较 短的指令来说，会造成时间上的浪费。 (2)采用不定长的机器周期 采用这种方案时，每个机器周期内的节拍数可以不等，如图9.9(b)所示。这种控制方式可 解决微操作执行时间不统一的问题。通常把大多数微操作安排在一个较短的机器周期内完成， 而对某些复杂的微操作，采用延长机器周期或增加节拍的办法来解决，如图9.10所示。 T。Tl.1了2T3 T。T1.T2. T3 T T  机器周期（取指令）机器周期（执行 图9.10延长机器周期示意 (3)采用中央控制和局部控制相结合的方法 这种方案将机器的大部分指令安排在统一的、较短的机器周期内完成，称为中央控制，而将 少数操作复杂的指令中的某些操作（如乘除法和浮点运算等）采用局部控制方式来完成，图9.11 所示为中央控制和局部控制的时序关系。 取指周期执行周期 机器周期 指令周期 T。Tl.T2. T3. I; 。T1.T2 I l l l l l l I I I T3 IT。T1 l l l l  中央控制节拍中央控制节拍 T* T* T*  l I I...l l  局部控制节拍 图9.11中央控制和局部控制的时序关系 在设计局部控制线路时需要注意两点：其一，使局部控制的每一个节拍广的宽度与中央控 制的节拍宽度相同；其二，将局部控制节拍作为中央控制中机器节拍的延续，插入中央控制的执 行周期内，使机器以同样的节奏工作，保证局部控制和中央控制的同步。广的多少可根据情况"}
{"doc_id": "co", "page": 395, "text": "第9章控制单元的功能389  而定，对千乘法，当操作数位数固定后，广的个数也就确定了。而对于浮点运算的对阶操作，由 千移位次数不是一个固定值，因此广的个数不能事先确定。 以乘法指令为例，第一个机器周期采用中央控制的节拍控制取指令操作，接着仍用中央控制 的T。、Tl、兀节拍去完成将操作数从存储器中取出并送至寄存器的操作，然后转局部控制，用局 部控制节拍T＊完成重复加和移位的操作。 2.异步控制方式 异步控制方式不存在基准时标信号，没有固定的周期节拍和严格的时钟同步，执行每条指令 和每个操作需要多少时间就占用多少时间。这种方式微操作的时序由专门的应答线路控制，即 当CU发出执行某一微操作的控制信号后，等待执行部件完成该操作后发回“回答＂（或“结束”) 信号，再开始新的微操作，使CPU没有空闲状态，但因需要采用各种应答电路，故其结构比同步 控制方式复杂。 3.联合控制方式 同步控制和异步控制相结合就是联合控制方式。这种方式对各种不同指令的微操作实行大 部分统一、小部分区别对待的办法。例如，对每条指令都有的取指令操作，采用同步方式控制；对 那些时间难以确定的微操作，如I/0操作，则采用异步控制，以执行部件送回的“回答“信号作为 本次微操作的结束。 4.人工控制方式 人工控制是为了调机和软件开发的需要，在机器面板或内部设置一些开关或按键，来达到人 工控制的目的。 (1) Reset（复位）键 按下Reset键，使计算机处于初始状态。当机器出现死锁状态或无法继续运行时，可按此 键。若在机器运行时按此键，将会破坏机器内某些状态而引起错误，因此要慎用。有些微型计算 机未设此键，当机器死锁时，可采用停电后再加电的办法重新启动计算机。 (2)连续或单条执行转换开关 由于调机的需要，有时需要观察执行完一条指令后的机器状态，有时又需要观察连续运行程 序后的结果，设置连续或单条执行转换开关，能为用户提供这两种选择。 (3)符合停机开关 有些计算机还配有符合停机开关，这组开关指示存储器的位置，当程序运行到与开关指示的 地址相符时，机器便停止运行，称为符合停机。 级时序系统实例分析 为了加深对本章内容的理解，下面以Intel8085为例，通过对一条I/0写操作指令运行过程 的分析，使读者进一步认识多级时序系统与控制单元发出的控制信号的关系。"}
{"doc_id": "co", "page": 396, "text": "390 第4篇控制单元 1. Intel 8085的组成 图9.12是Intel8085的组成框图，其内部有3个16位寄存器，即SP、PC和增减地址锁存器 IDAL, 11个8位寄存器，即B、C、D、E、H、LIR、AC、暂存器TR以及地址缓冲寄存器ABR和地址 数据缓冲寄存器ADBR，以及一个5位的状态标志寄存器FR。ALU能实现8位算术运算和逻辑 运算。控制单元的具体组成将在第10章讲述，图中的定时和控制(CU)能对外发出各种控制信 号。8085内还有中断控制和I/0控制，内部数据总线为8位。图中未标出8085片内的控 制信号。 INTA RST6.5 TRAP  画tRST5.5!RST7.5SID SOD  必 Xlx2 5 +  即陨ALES。S1IO/M肌DAIReset out A15~As AD7,.:_,AD。 Ready HOLD Reset1ii 地址总线地址／数据总线 图9.12Intel 8085的组成框图 2. Intel 8085的外部信号 8085芯片引脚图如图9.13所示，共40根引脚。外部信号分以下几类。 (1)地址和数据信号 心Al5～儿（出）：16位地址的高8位。 (2) AD7~AD。（入／出）：16位地址的低8位或8位数据，它们共用相同的引脚。 @ SID（入）：串行输入。 @SOD（出）：串行输出。 (2)定时和控制信号 心CLK（出）：系统时钟，每周期代表一个T状态。 @X尸又（入）：来自外部晶体或其他设备，以驱动内部的时钟发生器。 @ ALE（出）：地址暂存使能信号，在机器周期的第一个时钟周期产生，使外围芯片保"}
{"doc_id": "co", "page": 397, "text": "第9章控制单元的功能391  存地址。X1 -1 40 —Vee  @S。、凡（出）：用于标识读／写操作是否发生。X2-2 39 —HOLD  Reset out-3 38 -HLDA @IO／订（出）：使I/0接口或存储器读／写操作使能。 ＠面（出）：表示被选中的存储器或I/0接口将所读出 SOD-4 37 —CLK(out)  的数据送至数据总线上。 (J) WR（出）：表示数据总线上的数据将写入被选中的 存储器或I/0接口中。 (3)存储器和I/0的初始化信号 CD HOLD（入）：请求CPU放弃系统总线的控制和使用， 总线将用于DMA操作。 ®HLDA（出）：总线响应信号，表示总线可被外部 占用。 ® Ready（入）：用于CPU与较慢的存储器或设备同步。 当某一设备准备就绪后，向CPU发Ready信号，此时CPU 可进行输入或输出。 (4)与中断有关的信号 (D TRAP (出）：重新启动中断(RST7.5、RST6.5、 RST5.5)。 @iNTR（入）：中断请求信号。 @ INTA（出）：中断响应信号。 (5) CPU初始化 叩Resetin（入）：PC清“0”，假设CPU从0地址开始执行。 SID-5 36 —Reset in  TRAP-6 35 —Ready  RST7.5-7 34 —IO爪 RST6.5-8 33 —S1  RST5.5-9 32 —而 画－10 31 —WR  INTA— 11 30 —ALE  AD。—12 29 -S。 AD1— 13 28 -A15  AD2-14 27 —A14  AD3-15 26 -A13  AD4-16 25 —A12  AD5-17 24 —An  AD6— 18 23 -A10  AD7-19 22 —A9  Vss— 20 21 —A8  图9.13Intel 8085外部引脚图 ® Reset out（出）：对CPU的置“0“做出响应，该信号能用于重置系统的剩余部分。 (6)电源和地 心Vee:+5 V电源。 ® Vss：地。 3.机器周期和节拍（状态）与控制信号的关系 8085的一条指令可分成1~5个机器周期，每个机器周期内又包含3~5个节拍，每个节拍待 续一个时钟周期。在每个节拍内，CPU根据控制信号执行一个或一组同步的微操作。下面分析 一条输出指令，其功能是将AC的内容写入所选择的设备中，执行该指令的时序图如图9.14 所示。 由图可见，该指令的指令周期包含3个机器周期Ml、队和M3，每个机器周期内所包含的节 拍数不同(Ml含4拍，M2和队均含3拍）。该指令字长为16位，由于数据线只有8位，所以要"}
{"doc_id": "co", "page": 398, "text": "392 第4篇控制单元 M1 M2 M3  T1 T2  I  T3 T4 T1 T2 笃T1  I  T2  I  T3  3MHzCLK  A15~A8  ADrAD。 ALE  丙 颐 IO爪 PC Out PC+ 1->-PC Instr->-IR X PC Out PC+l--+ PC Byte.......Z,W WZOut A Port  取指令操作码谭I正取设备地址. I. ACC内容写入设备 图9.148085输出指令时序图 分两次将指令取至CPU内。第一个机器周期取指令的操作码，第二个机器周期取被选设备的地 址，第三个机器周期把AC的内容通过数据总线写入被选中的设备中。具体时序如下。 (1)第一个机器周期M!：存储器读，取指令操作码 心兀状态，IO／订低电平，表示存储器操作。CPU将PC的高8位送至地址总线A15~A8,PC 的低8位送至地址／数据总线AD7~AD。，并由ALE的下降沿激活存储器保存地址。 ＠兀状态，m}（低）有效，表示存储器读操作，存储器将指定地址的内容送至数据总线 AD7 ~AD。,CPU等待数据线上的数据稳定。 ＠兀状态，当数据线上的数据稳定后，CPU接收数据，此数据为该指令的第一字节操作码。 ＠兀状态，CPU进入译码阶段，在兀最后时刻ALE（高）失效。 在兀或兀状态可安排(PC)+1-+PC操作，图中未标出此控制信号。 (2)第二个机器周期队：存储器读，取被选设备的地址 叩兀状态，同M的兀状态操作。 ＠兀状态，同M的兀状态操作。 ＠兀状态，当数据线上的数据稳定后，CPU接收数据，此数据为被选设备的地址。 同样可以在兀或兀时刻完成(PC)+1-+PC操作。这个机器周期内设有指令译码，因此T4 省略。在兀最后时刻ALE（高）失效。 (3)第三个机器周期M3:I/O写 叩兀状态，IO/｀高电平，表示I/0操作，CPU将I/0口地址送至A15～儿和AD7~ AD 。，并"}
{"doc_id": "co", "page": 399, "text": "第9章控制单元的功能393  由ALE下降沿激活I/0保存地址。 ＠兀状态，WR（低）有效，表示I/0写操作，AC的内容通过AD7~AD。数据总线送至被选中 的设备中。 可见，控制单元的每一个控制信号都是在指定机器周期内的指定T时刻发出的，反映了多 级时序系统与控制信号间的关系。 题与习题 9.1 设CPU内有这些部件：PC、IR、MAR、MDR、AC、CU。 (1)写出取指周期的全部微操作。 (2)写出减法指令“SUBX'＼取数指令“LDAX\"、存数指令“STAX\"(X均为主存地址）在执行阶段所需的 全部微操作。 (3)当上述指令为间接寻址时，写出执行这些指令所需的全部微操作。 (4)写出无条件转移指令“JMPY”和结果溢出则转指令“BAOY”在执行阶段所需的全部微操作。 9.2 控制单元的功能是什么？其输入受什么控制？ 9.3 什么是指令周期、机器周期和时钟周期？三者有何关系？ 9.4 能不能说CPU的主频越快，计算机的运行速度就越快？为什么？ 9.5 设机器A的CPU主频为8MHz，机器周期含4个时钟周期，且该机的平均指令执行速度是0.4MIPS,  试求该机的平均指令周期和机器周期，每个指令周期中含几个机器周期。如果机器B的CPU主频为12MHz，且 机器周期也含4个时钟周期，试问B机的平均指令执行速度为多少MIPS? 9.6 设某计算机的CPU主频为8MHz，每个机器周期平均含2个时钟周期，每条指令平均有4个机器周期， 试问该计算机的平均指令执行速度为多少MIPS。若CPU主频不变，但每个机器周期平均含4个时钟周期，每条指 令平均有4个机器周期，则该机的平均指令执行速度又是多少MIPS?由此可得出什么结论？ 9.7 某CPU的主频为10MHz，若已知每个机器周期平均包含4个时钟周期，该机的平均指令执行速度为 1 MIPS，试求该机的平均指令周期及每个指令周期含几个机器周期。若改用时钟周期为0.4µs的CPU芯片，则 计算机的平均指令执行速度为多少MIPS?若要得到平均每秒80万次的指令执行速度，则应采用主频为多少的 CPU芯片？ 9.8 某计算机的主频为6MHz，各类指令的平均执行时间和使用频度如下表所示，试计算该机的速度（单 位用MIPS表示）。若上述CPU芯片升级为10MHz，则该机的运行速度又为多少？ 9.9 试比较同步控制、异步控制和联合控制的区别。 9.10 什么是典型的同步控制？为了提高CPU的效率，在同步控制方式中又有哪些方式？以8085的输出 指令为例，说明它属于哪种控制方式？"}
{"doc_id": "co", "page": 400, "text": "394 第4篇控制单元 9.11 设CPU内部结构如图9.4所示，此外还设有B、C、D、E,H、L6个寄存器，它们各自的输入和输出端都 与内部总线相通，并分别受控制信号控制（如B为寄存器B的输入控制；队为寄存器B的输出控制）。要求从 取指令开始，写出完成下列指令所需的全部微操作和控制信号。 (1) ADD B, C ((B) + (C)-+B)  (2)SUBA,H ((AC)-(H)-+AC)  9.12 CPU结构同上题，写出完成下列指令所需的全部微操作和控制信号（包括取指令）。 (1)寄存器间接寻址的无条件转移指令“JMP@B”。 (2)间接寻址的存数指令“STA@X”。 9.13 设CPU内部结构如图9.4所示，此外还设有Rl～凡4个寄存器，它们各自的输入和输出端都与内部 总线相通，并分别受控制信号控制（如见为寄存器凡的输入控制；R20为寄存器凡的输出控制）。要求从取指 令开始，写出完成下列指令所需的全部微操作和控制信号。 (1) ADD R2, @ R4 ; ((R2) + ((R4)）-+R2，寄存器间接寻址） (2) SUB R1, @mem ; ((R1)-((mem)）一凡，存储器间接寻址） 9.14 设单总线计算机结构如图9.5所示，其中M为主存，XR为变址寄存器，EAR为有效地址寄存器， LATCH为锁存器。假设指令地址已存于PC中，画出“LDA* D”和“SUBX,D”指令周期信息流程图，并列出相 应的控制信号序列。 说明： (1) \"LDA * D”指令字中＊表示相对寻址，D为相对位移量。 (2) \"SUB X,D”指令字中X为变址寄存器XR,D为形式地址。 (3)寄存器的输入和输出均受控制信号控制，例如，PC;表示PC的输入控制信号，MD凡表示MDR的输出 控制信号。 (4)凡是需要经过总线实现寄存器之间的传送，需在流程图中注明，如PC-+Bus-+ MAR，相应的控制信号为 PCO和MAR卢"}
{"doc_id": "co", "page": 401, "text": "本章以10条机器指令为例，介绍控制单元的两种设计方法，旨在使读者初步掌握设计控制 单元的思路，为今后设计计算机打下初步基础。 10.1 组合逻辑设计 1 组合逻辑控制单元框 图9.2示出了控制单元的外特性，其中指令的操作码是决定控制单元发出不同控制信号的 关键。为了简化控制单元的逻辑，将存放在IR的n位操作码经过一个译码电路产生2n个输出， 这样，每对应一种操作码便有一个输出送至CU。当然，若指令的操作码长度可变，指令译码线路 将更复杂。 控制单元的时钟输入实际上是一个脉冲序列，其频率即为机器的主频，它使CU能按一定的 节拍(T)发出各种控制信号。节拍的宽度应满足数据信息通过数据总线从源到目的所需的时 间。以时钟为计数脉冲，通过一个计数器，又称节拍发生器，便可产生一个与时钟周期等宽的节 拍序列。如果将指令译码和节拍发生器从CU中分离出来，便可得简化的控制单元框图，如图 10.1所示。 作码 -1  cu  ...  C。C1i:n  发至CPU内部及系统总线的控制信号 图10.1带译码和节拍输入的控制单元框图"}
{"doc_id": "co", "page": 402, "text": "396 第4篇控制单元 10. 微操作的节拍安排 假设机器采用同步控制，每个机器周期包含3个节拍，而且CPU内部结构如图9.3所示，其 中MAR和MDR分别直接和地址总线和数据总线相连，并假设IR的地址码部分与MAR之间有 通路。 安排微操作节拍时应注意以下3点。 心有些微操作的次序是不容改变的，故安排微操作节拍时必须注意微操作的先后顺序。 ＠凡是被控制对象不同的微操作，若能在一个节拍内执行，应尽可能安排在同一个节拍内， 以节省时间。 ＠如果有些微操作所占的时间不长，应该将它们安排在一个节拍内完成，并且允许这些微 操作有先后次序。 按上述3条原则，以9.1节所分析的10条指令为例，其微操作的节拍安排如下： 1.取指周期微操作的节拍安排 ·根据原则＠，兀节拍可安排两个微操作：PC~MAR,l~R。 ·根据原则＠，仇节拍可安排M(MAR)~MDR和(PC)+l~PC两个微操作。 ．兀节拍可安排MDR~IR，考虑到指令译码时间较短，根据原则＠，可将指令译码 OP(IR)~ID也安排在兀节拍内。 实际上(PC)+1 ~pc操作也可安排在兀节拍内，因一旦PC~MAR后，PC的内容就 可修改。 2.间址周期微操作的节拍安排 T。Ad(IR)~MAR, l~R  Tl M(MAR)~MDR  T2 MDR~Ad(IR)  3.执行周期微操作的节拍安排 (1)非访存指令 l)清除累加器指令CLA 该指令在执行周期只有一个微操作，按同步控制的原则，此操作可安排在T。～兀的任一节 拍内，其余节拍空，例如： T。 Tl  兀0一AC 2)累加器取反指令COM 同理，累加器取反操作可安排在T。～兀的任一节拍中，即"}
{"doc_id": "co", "page": 403, "text": "T。 Tl  T2 AC---+AC  3)算术右移一位指令SHR T。 Tl  第10章控制单元的设计 T2 L(AC)---+R(AC),AC。-+AC。 4)循环左移一位指令CSL T。 Tl  T2 R(AC)一L(AC),AC。---+ACn(即矿(AC)) 5)停机指令STP T。 Tl  T2 0一G (2)访存指令 l)加法指令ADDX  T。Ad(IR)-+MAR, 1---+R  Tl M (MAR)---+MDR  兀(AC)+(MDR)-+AC（该操作实际包括(AC)-+ALU,(MDR)-+ALU, ALU---+AC)  2)存数指令STAX  T。Ad(IR) ---+ MAR, 1---+ W  Tl AC---+MDR  T2 MDR---+M(MAR)  3)取数指令LDAX  T。Ad(IR)-+MAR,1---+R  Tl M(MAR)---+MDR  T2 MDR---+AC  (3)转移类指令 l)无条件转移指令JMPX  T。 Tl  T2 Ad (IR)---+ PC  397"}
{"doc_id": "co", "page": 404, "text": "398 第4篇控制单元 2)有条件转移（负则转）指令BANX  T。 Tl  T2 A。.Ad(IR)＋A0· (PC)-+PC  4.中断周期微操作的节拍安排 在执行周期的最后时刻，CPU要向所有中断源发中断查询信号，若检测到某个中断源有请 求，并且未被屏蔽又被排队选中，则在允许中断的条件下，CPU进入中断周期，此时CPU由中断 隐指令完成下列操作（假设程序断点存入主存0号地址单元内）： T。0------+MAR, 1-+ W  TI PC-----+MDR  T2 MDR-----+ M (MAR)，向量地址-+PC 此外，由图8.30可知，CPU进入中断周期，由硬件置“0”允许中断触发器EINT，即关中断。 例10.1设CPU中各部件及其相互连接关系如图10.2所示。图中W是写控制标志，R是 读控制标志，凡和凡是暂存器。 微操作命令形成部件I CPU I  存储器已二二II二Bus I  I  仁·—·—·—一一·—·—·—·—·—·—·—·—·—·—·」 图10.2例10.1CPU内部结构框图 (1)假设要求在取指周期由ALU完成(PC)+l---+PC的操作（即ALU可以对它的一个源操 作数完成加1的运算）。要求以最少的节拍写出取指周期全部微操作命令及节拍安排。 (2)写出指令“ADD#a”(＃为立即寻址特征，隐含的操作数在ACC中）在执行阶段所需的 微操作命令及节拍安排。 解：（1)由于(PC)+1---+PC需由ALU完成，因此PC的值可作为ALU的一个源操作数， 控制ALU做＋1运算得到(PC)+l，结果送至与ALU输出端相连的R2，然后再送至PC。 此题的关键是要考虑总线冲突的问题，故取指周期的微操作命令及节拍安排如下： T。PC-+Bus-+MAR, 1-+R ; PC通过总线送MAR T1 M(MAR)-+MDR,"}
{"doc_id": "co", "page": 405, "text": "第10章控制单元的设计399  (PC)-+Bus-+ALU +1-+凡；PC通过总线送ALU完成(PC)+l-+凡 T2 MDR-+Bus-+IR, ;MDR通过总线送IR OP(IR)一微操作命令形成部件 T3 R2-+Bus-+PC ；凡通过总线送PC (2)立即寻址的加法指令执行周期的微操作命令及节拍安排如下： T。Ad(IR)-+Bus-+凡；立即数一凡 兀(ACC) + (Rl)-+ALU-+凡；ACC通过总线送ALU T2 R2-+Bus-+ACC ；结果通过总线送ACC 例10.2设CPU内部结构如图10.2所示，且PC有自动加1功能。此外还有B、C、D、E.._H、 L6个寄存器（图中未画），它们各自的输入端和输出端都与内部总线Bus相连，并分别受控制信 号控制。要求写出完成下列指令组合逻辑控制单元所发出的微操作命令及节拍安排。 (1) ADD B, C ; (B) + (C) -+ B  (2) SUB E,@ H ; (E) -((H))-+E 寄存器间接寻址 (3) STA@ mem ;ACC-+((mem)) 存储器间接寻址 解：（1)完成“ADDB,C”指令所需的微操作命令及节拍安排如下： 取指周期 T。PC-+Bus-+MAR,1-+R  T1 M(MAR) -+MDR,(PC) + 1-+PC  T2 MDR一Bus-+IR,OP (IR) -+微操作命令形成部件 执行周期 T。C-+Bus-+R1 仇(B)+ (Rl) -+ALU-+R2  T2 R2-+Bus-+B  ;B通过总线送ALU (2)完成“SUBE,@H”指令所需的微操作命令及节拍安排如下： 取指周期 T。PC-+Bus-+MAR,1-+R Tl M(MAR)-+MDR,(PC) + 1-+PC  T2 MDR-+Bus-+IR,OP(IR)习如操作命令形成部件 间址周期 T。H-+Bus-+MAR,1-+R Tl M(MAR)-+MDR  执行周期 T。MDR-+Bus-+凡 Tl (E)-(R1) -+ALU-+R2 ;E通过总线送ALU"}
{"doc_id": "co", "page": 406, "text": "400 第4篇控制单元 T2 R2--+Bus--+E  (3)完成“STA@mem”指令所需的微操作命令及节拍安排如下： 取指周期 T。PC--+Bus--+MAR,1--+R  T1 M(MAR) --+MDR,(PC) + 1--+PC  T2 MDR--+Bus--+IR, OP (IR)习败操作命令形成部件 间址周期 T。Ad(IR)--+Bus--+MAR, 1--+R  TI M(MAR) --+MDR  执行周期 T。MDR--+ Bus-+ MAR, 1--+ W  Tl ACC一Bus--+MDR T2 MDR--+M(MAR)  例10.3设寄存器均为16位，实现补码Booth算法的运算器框图如图6.9所示。其中寄存 器A、X最高2位A。、Al和X。、xl为符号位，寄存器Q最高位Q。为符号位，最末位Ql5为附加位。 假设上条指令的运行结果存于A（即被乘数）中。 (1)若CU为组合逻辑控制，且采用中央和局部控制相结合的方法，写出完成“MDLa\" (a  为主存地址）指令的全部微操作命令及节拍安排。 (2)指出哪些节拍属于中央控制节拍，哪些节拍属千局部控制节拍，局部控制最多需要几拍？ 解：（l）取指阶段 T。PC--+MAR,1--+R  T1 M (MAR)--+MDR, (PC) + 1--+PC  T2 MDR--+IR, OP (IR)--+ID  执行阶段 乘法开始前要将被乘数由A~x，并将乘数从主存a单元取出送至Q寄存器。因Q15（最末 位）为附加位，还必须0一Q15，并将A清零。上述这些操作可安排在中央控制节拍内完成。乘法 过程的重复加操作受Q寄存器末两位Q14、Q15控制，重复移位操作在两个串接的寄存器AIIQ中 完成，这两种操作可安排在局部控制节拍内完成。具体安排如下： T。Ad(IR)~MAR,l~R,A~x T1 M(MAR)~MDR,o~如，o~A T2 MDR~Q。~14(Q寄存器仅取1位符号位） T。*如Q1s· (A+ X) + Q14Q1s · (A+X+l) +Q14 Q1s · A+Q14Q1s • A一A 叮L(A//Q)-+R(A//Q) (A//Q算术右移一位）"}
{"doc_id": "co", "page": 407, "text": "第10章控制单元的设计401  (2)中央控制节拍包括取指阶段所有节拍和执行阶段的T。、T尸兀3个节拍，完成取指令和 取操作数及乘法运算前的准备工作。局部控制节拍是执行阶段的冗和叮节拍，其中叮为重 复加操作，受Q寄存器末两位Q14、Q15控制，最多执行15次；Tt为移位操作，共执行14次。 组合计步骤 采用组合逻辑设计控制单元时，首先根据上述10条指令微操作的节拍安排，列出微操作命 令的操作时间表，然后写出每一个微操作命令（控制信号）的逻辑表达式，最后根据逻辑表达式 画出相应的组合逻辑电路图。 1.列出微操作命令的操作时间表 表10.1列出了上述10条机器指令微操作命令的操作时间表。表中FE、IND和EX为 CPU工作周期标志（参见图8.9),T。～兀为节拍，I为间址标志，在取指周期的兀时刻，若 测得I=1，则IND触发器置”1\"，标志进入间址周期；若I=0，则EX触发器置“1\"，标志进入 执行周期。同理，在间址周期的兀时刻，若测得IND=0（表示一次间接寻址），则EX触发 器置“1\"，进入执行周期；若测得IND=1（表示多次间接寻址），则继续间接寻址。在执行周 期的兀时刻，CPU要向所有中断源发中断查询信号，若检测到有中断请求并且满足响应条 件，则INT触发器置”1\"，标志进入中断周期。表中未列出INT触发器置”1\"的操作和中断 周期的微操作。表中第一行对应10条指令的操作码，代表不同的指令。若某指令有表中 所列的微操作命令，其对应的空格内为1。 2.写出微操作命令的最简逻辑表达式 纵览表10.1便可列出每一个微操作命令的初始逻辑表达式，经化简、整理便可获得能用现 成电路实现的微操作命令逻辑表达式。 例如，根据表可写出M(MAR) --+MDR微操作命令的逻辑表达式： M(MAR)--+MDR  =FE· T1+IND • T1(ADD+STA+LDA+JMP+BAN)+EX · T1(ADD+LDA)  = T1 j FE+IND(ADD+STA+LDA+JMP+BAN) +EX(ADD+LDA) f  式中，ADD、STA、LDA、JMP、BAN均来自操作码译码器的输出。 3.画出微操作命令的逻辑图 对应每一个微操作命令的逻辑表达式都可画出一个逻辑图。例如，M(MAR)--+MDR的逻辑 表达式所对应的逻辑图如图10.3所示，图中未考虑门的扇入系数。"}
{"doc_id": "co", "page": 408, "text": "402 第4篇控制单元 表10.1操作时间表 工作周节拍状态条件微操作命令信号CLA COM SHR CSL STP ADD STA LDA JMP BAN 期标记 PC-+MAR 1 1 1 1 1 1 1 1 1 1  T。 1-+R 1 1 1 1 1 1 1 1 1 1  M(MAR)----+MDR 1 1 1 1 1 1 1 1 1 1  TI  FE (PC)+l-+PC 1 1 1 1 1 1 1 1 1 1  （取指）MDR一IR1 1 1 1 1 1 1 1 1 1  OP(IR)-+ID 1 1 1 1 1 1 1 1 1 1  T2  I I一IND1 1 1 1 l °  I I~EX 1 1 1 1 1 1 1 1 1 1  Ad(IR)~MAR 1 1 1 1 1  T。 IND 1-+R 1 1 1 1 1  （间接Tl M(MAR)--+MDR 1 1 1 1 1  寻址）MDR----+Ad(IR) 1 1 1 1 1  T2  IND l-+EX 1 1 1 1 1  Ad(IR)------+MAR 1 1 1  T。1-+R 1 1  1-W 1  M(MAR)-+MDR 1 1  Tl  AC-+MDR 1  , (AC)+(MDR)--+AC 1  MDR-+M(MAR) 1  EX  （执行） MDR----+AC 1  0---+AC 1  1  T2  AC-+AC  L(AC)-+R(AC),AC。不变1  矿(AC)1  Ad(IR)-+PC 1  A。Ad(IR)------+PC 1  0--+G 1"}
{"doc_id": "co", "page": 409, "text": "第10章控制单元的设计403  M(MAR)-,.MDR  图10.3产生M(MAR)---+ MDR命令的逻辑图 当然，在设计逻辑图时要考虑门的扇入系数和逻辑级数。如果采用现成芯片，还需选择芯 片型号。 采用组合逻辑设计方法设计控制单元，思路清晰，简单明了，但因为每一个微操作命令都对 应一个逻辑电路，因此一旦设计完毕便会发现，这种控制单元的线路结构十分庞杂，也不规范，犹 如一棵大树，到处都是不规整的枝权。而且指令系统功能越全，微操作命令就越多，线路也越复 杂，调试就更困难。为了克服这些缺点，可采用微程序设计方案。但是，正如7.5节所述，随着 RISC的出现，组合逻辑设计仍然是设计计算机的一种重要方法。 10.2 微程序设计 1微 微程序设计思想是英国剑桥大学教授M.V.Wilkes在1951年首先提出的。为了克服组合逻 辑控制单元线路庞杂的缺点，他大胆设想采用与存储程序相类似的方法，来解决微操作命令序列 的形成。Wilkes提出，将一条机器指令编写成一个微程序，每一个微程序包含若干条微指令， 一条微指令对应一个或几个微操作命令。然后把这些微程序存到一个控制存储器中，用寻找用 户程序机器指令的方法来寻找每个微程序中的微指令。由千这些微指令是以二进制代码形式表 示的，每位代表一个控制信号（若该位为1，表示该控制信号有效；若该位为0，表示此控制信号无 效），因此，逐条执行每一条微指令，也就相应地完成了一条机器指令的全部操作。可见，微程序 控制单元的核心部件是一个控制存储器。由于执行一条机器指令必须多次访问控制存储器，以 取出多条微指令来控制执行各个微操作，因此要求控制存储器的速度较高。可惜在Wilkes那个"}
{"doc_id": "co", "page": 410, "text": "404 第4篇控制单元 年代电子器件生产水平有限，因此微程序设计思想并未实现。直到20世纪60年代出现了半导 体存储器，才使这个设计思想成为现实。1964年4月，世界上第一台微程序设计的机器IBM360  研制成功。 微程序设计省去了组合逻辑设计过程中对逻辑表达式的化简步骤，无须考虑逻辑门级数和 门的扇入系数，使设计更简便，而且由于控制信号是以二进制代码的形式出现的，因此只要修改 微指令的代码，就可改变操作内容，便于调试、修改，甚至增删机器指令，有利于计算机仿真。 微程序控制单元框图及工作原理 1.机器指令对应的微程序 采用微程序设计方法设计控制单元的过程就是编写每一条机器指令的微程序，它是按执行 每条机器指令所需的微操作命令的先后顺序而 编写的，因此，一条机器指令对应一个微程序，如M  图10.4所示。图中每一条机器指令都与一个以 操作性质命名的微程序对应。 由于任何一条机器指令的取指令操作是相 同的，因此将取指令操作的命令统一编成一个微 程序，这个微程序只负责将指令从主存单元中取 出送至指令寄存器中，如图10.4所示的取指周期 M+l  M+2  p  P+l  微程序。此外，如果指令是间接寻址，其操作也P+2  Q  是可以预测的，也可先编出对应间址周期的微程Q~l  序。当出现中断时，中断隐指令所需完成的操作Q+2  可由一个对应中断周期的微程序控制完成。这K  样，控制存储器中的微程序个数应为机器指令数K+l  再加上对应取指、间接寻址和中断周期的3个微 程序。 2.微程序控制单元的基本框图 K+2  J  J+l  控制存储器 M+l  M+2  XXX  转执行周期微程序 P+l  P+2  M  Q+l  Q+2  M  勹』J+l  M  取指周期微程序 间址周期微程序 中断周期微程序 对应LDA操作的微程序 对应ADD操作的微程序 对应STA操作的微程序 对应JMP操作的微程序 图10.5示意了微程序控制单元的基本组成。 图中点画线框内为微程序控制单元，与图 9.2相比，它们都有相同的输入，如指令寄存器、 图10.4不同机器指令所对应的微程序 各种标志和时钟，输出也是输至CPU内部或系统总线的控制信号。 点画线框内的控制存储器（简称控存）是微程序控制单元的核心部件，用来存放全部微程序； CMAR是控存地址寄存器，用来存放欲读出的微指令地址；CMDR是控存数据寄存器，用来存放从 控存读出的微指令；顺序逻辑是用来控制微指令序列的，具体就是控制形成下一条微指令（即后续 微指令）的地址，其输入与微地址形成部件（与指令寄存器相连）、微指令的下地址字段以及外来"}
{"doc_id": "co", "page": 411, "text": "第10章控制单元的设计 至CPU内部和系统总线的控制信号OP  令—一—·一—三勹 i  CMDR  L—————————一—I 图10.5微程序控制单元的基本组成 的标志有关。有关微指令序列地址的形成将在10.2.4节中介绍。 微指令的基本格式如图10.6所示，共分两个 标志 CLK  字段，一个为操作控制字段，该字段发出各种控制 信号；另一个为顺序控制字段，它可指出下条微指 令的地址（简称下地址），以控制微指令序列的执 行顺序。 图10.6微指令的基本格式 3.工作原理 假设有一个用户程序如下所示，它存千以2000H为首地址的主存空间内。 LDA X  ADDY  STA Z  STP  面结合图10.4和图10.5，分析运行上述程序时微程序控制单元的工作原理。 首先将用户程序的首地址送至PC，然后进入取指阶段。 (I)取指阶段 心将取指周期微程序首地址M---+CMAR。 ＠取微指令。 405  将对应控存M地址单元中的第一条微指令读到控存数据寄存器中，记作CM(CMAR)一 CMDR。 ＠产生微操作命令。 第一条微指令的操作控制字段中为“1”的各位发出控制信号，如PC---+MAR, 1---+ R，命令主存"}
{"doc_id": "co", "page": 412, "text": "406 第4篇控制单元 接收程序首地址并进行读操作。 ＠形成下一条微指令的地址。 此微指令的顺序控制字段指出了下一条微指令的地址为M+l，将M+1送至CMAR，即 Ad(CMDR)一CMAR。 ＠取下一条微指令。 将对应控存M+l地址单元中的第二条微指令读到CMDR中，即CM(CMAR)-+CMDR。 ＠产生微操作命令。 由第二条微指令的操作控制字段中对应”1”的各位发出控制信号，如M(MAR)--+MDR使对 应主存2000H地址单元中的第一条机器指令从主存中读出送至MDR中。 ＠形成下一条微指令的地址。 将第二条微指令下地址字段指出的地址M+2送至CMAR，即 Ad(CMDR) --+CMAR  以此类推，直到取出取指周期最后一条微指令，并发出微操作命令为止。此时第一条机器指令 \"LDA X”已存至指令寄存器IR中。 (2)执行阶段 叩取数指令微程序首地址的形成。 当取数指令存入IR后，其操作码OP(IR)直接送到微地址形成部件，该部件的输出即为取 数指令微程序的首地址P，且将P送至CMAR，记作OP(IR)一微地址形成部件-+CMAR。 ＠取微指令。 将对应控存P地址单元中的微指令读到CMDR中，即CM(CMAR)一CMDR。 ＠产生微操作命令。 由微指令操作控制字段中对应”l\"的各位发出控制信号，如Ad(IR)-+MAR,1-+R，命令主存 读操作数。 ＠形成下一条微指令的地址。 将此条微指令下地址字段指出的P+l送至CMAR，即Ad(CMDR)-+CMAR。 ＠取微指令，即CM(CMAR)-+CMDR。 ＠产生微操作命令。 以此类推，直到取出取数指令微程序的最后一条微指令P+2，并发出微操作命令。至此即完成了 将主存X地址单元中的操作数取至累加器AC的操作。这条微指令的顺序控制字段为M，即表 明CPU又开始进入下一条机器指令的取指周期，控存又要依次读出取指周期微程序的逐条微指 令，发出微操作命令，完成将第二条机器指令“ADDY“从主存取至指令寄存器IR中……微程序 控制单元就是这样，通过逐条取出微指令，发出各种微操作命令，从而实现从主存逐条取出、分析 并执行机器指令，以达到运行程序的目的。"}
{"doc_id": "co", "page": 413, "text": "第10章控制单元的设计407  由此可见，对微程序控制单元的控存而言，内部信息一旦按所设计的微程序被灌注后， 在机器运行过程中，只需具有读出的性能即可，故可采用ROM。此外，在微程序的执行过 程中，关键问题是如何由微指令的操作控制字段形成微操作命令，以及如何形成下一条微 指令的地址。这是微程序设计必须解决的问题，它们与微指令的编码方式和微地址的形成 方式有关。 10.2。3微指令的编码式 微指令的编码方式又称微指令的控制方式，它是指如何对微指令的控制字段进行编码，以形 成控制信号，主要有以下几种。 1.直接编码（直接控制）方式 在微指令的操作控制字段中，每一位代表一个微操作命令，这种编码方式即为直接编码方 式。上面所述的用控制字段中的某位为“1”表示控制信号有效（如打开某个控制门），以及某位 为“0”表示控制信号无效（如不打开某个控制门）就是直接控制方式，如图10.7所示。这种方式 含义清晰，而且只要微指令从控存读出，即刻可由控制字段发出命令，速度快。但由于机器中微 操作命令甚多，可能使微指令操作控制字段达几百位，造成控存容量极大。 2.字段直接编码方式 这种方式就是将微指令的操作控制字段分成若千段，将一组互斥的微操作命令放在一个字 段内，通过对这个字段译码，便可对应每一个微命令，如图10.8所示。这种方式因靠字段直接译 码发出微命令，故又有显式编码之称。 控制信号 ...  1二操作控制二I 邑 控制信号 凸凸 下地址下地址,  玉I 制 控 作 操 ____ IL  图10.7直接编码方式图10.8字段直接编码方式 采用字段直接编码方法可用较少的二进制信息表示较多的微操作命令信号。例如，3 进制代码译码后可表示7个互斥的微命令，留出一种状态表示不发微命令，与直接编码用7位表 示7个微命令相比，减少了4位，缩短了微指令的长度。但由于增加了译码电路，使微程序的执 行速度稍微减慢。 至千操作控制字段应分几段，与需要并行发出的微命令个数有关，若需要并行发出8个微命 令，就可分8段。每段的长度可以不等，与具体要求互斥的微命令个数有关，若某类操作要求互 斥的微命令仅有6个，则字段只需安排3位即可。"}
{"doc_id": "co", "page": 414, "text": "408 第4篇控制单元 3.字段间接编码方式 这种方式一个字段的某些微命令还需由另一个字段中的某些微命令来解释，如图10.9所 示。图中字段l译码的某些输出受字段2译码 输出的控制，由千不是靠字段直接译码发出微命 令，故称为字段间接编码，又称隐式编码。 这种方法虽然可以进一步缩短微指令字长， 但因削弱了微指令的并行控制能力，因此通常用 作字段直接编码法的一种辅助手段。 控制信号 1字段11字段2| …  4.混合编码匕操作控制 控制信号 广 I字段nI下地址1 - 这种方法是把直接编码和字段编码（直接 或间接）混合使用，以便能综合考虑微指令的字 长、灵活性和执行微程序的速度等方面的要求。 图10.9字段间接编码方式 5.其他 微指令中还可设置常数字段，用来提供常数、计数器初值等。常数字段还可以和某些解释位 配合，如解释位为0，表示该字段提供常数；解释位为1，表示该字段提供某种命令，使微指令 更灵活。 此外，微指令还可用类似机器指令操作码的方式编码，有关内容参见10.2.5节微指令格式。 例10.4某机的微指令格式中，共有8个控制字段，每个字段可分别激活5、8、3、16、1、7、 25、4种控制信号。分别采用直接编码和字段直接编码方式设计微指令的操作控制字段，并说明 两种方式的操作控制字段各取几位。 解：（1)采用直接编码方式，微指令的操作控制字段的总位数等千控制信号数，即 5+8+3+ 16+ 1 +7+25+4 = 69  (2)采用字段直接编码方式，需要的控制位少。根据题目给出的10个控制字段及各段可激 活的控制信号数，再加上每个控制字段至少要留一个码字表示不激活任何一条控制线，即微指令 的8个控制字段分别需给出6、9、4、17、2、8、26、5种状态，对应3、4、2、5、1、3、5、3位，故微指令的 操作控制字段的总位数为 3+4+2+5+ 1 +3+5+3 = 26  微指令序列地址的形成 由图10.5可见，后续微指令的地址大致由两种方式形成。 1.直接由微指令的下地址字段指出 图10.4中大部分微指令的下地址字段直接指出了后续微指令的地址。这种方式又称为断 定方式。"}
{"doc_id": "co", "page": 415, "text": "第10章控制单元的设计409  2.根据机器指令的操作码形成 当机器指令取至指令寄存器后，微指令的地址由操作码经微地址形成部件形成。微地址形 成部件实际是一个编码器，其输入为指令操作码，输出就是对应该机器指令微程序的首地址。它 可采用PROM实现，以指令的操作码作为PROM的地址，而相应的存储单元内容就是对应该指 令微程序的首地址。 实际上微指令序列地址的形成方式还有以下几种。 3.增量计数器法 仔细分析发现，在很多情况下，后续微指令的地址是连续的，因此对于顺序地址，微指令可采 用增量计数法，即(CMAR)+l--+CMAR来形成后续微指令的地址。 4.分支转移 当遇到条件转移指令时，微指令出现了分支，必须根据各种标志来决定下一条微指令的地 址。微指令的格式如下： 操作控制字段1 转移方式1 转移地址I  其中，转移方式指明判别条件，转移地址指明转移成功后的去向，若不成功则顺序执行。也有的 转移微指令中设两个转移地址，条件满足时选择其中一个转移地址；条件不满足时选择另一个转 移地址。 5.通过测试网络形成 微指令的地址还可通过测试网络形成，如图10.10所示。图中微指令的地址分两部分，高段 h为非测试地址，由微指令的H段地址码直接形成；低段l为测试地址，由微指令的L段地址码 通过测试网络形成。 微指令地址1非测试地址h CMDR H  ; ｝测试源 1二操作控制二1二顺序控制 _  图10.10通过测试网络形成微指令地址 6.由硬件产生微程序入口地址 当电源加电后，第一条微指令的地址可由专门的硬件电路产生，也可由外部直接向CMAR 输入微指令的地址，这个地址即为取指周期微程序的入口地址。 当有中断请求时，若条件满足，CPU响应中断进入中断周期，此时需中断现行程序，转至对"}
{"doc_id": "co", "page": 416, "text": "410 第4篇控制单元 应中断周期的微程序。由千设计控制单元时巳安排好中断周期微程序的入口地址（参见图 10.4)，故响应中断时，可由硬件产生中断周期微程序的入口地址。 同理，当出现间接寻址时，也可由硬件产生间址周期微程序的入口地址。 综合上述各种方法，可得出形成后续微指令地址的原理图，如图10.11所示。图中多路选择 器可选择以下4路地址。 叩(CMAR)+l--+CMAR。 ＠微指令的下地址字段。 ＠指令寄存器（通过微地址形成部件）。 ＠微程序入口地址。 微程序入口地址 标 CMDR  OP I IIR  图10.11后续微指令地址形成方式的原理图 微指令格式 微指令格式与微指令的编码方式有关，通常分为水平型微指令和垂直型微指令两种。 1.水平型微指令 水平型微指令的特点是一次能定义并执行多个并行操作的微命令。图10.7就是典型 的水平型微指令。从编码方式看，直接编码、字段直接编码、字段间接编码以及直接和字段 混合编码都属千水平型微指令。其中，直接编码速度最快，字段编码要经过译码，故速度受 影响。 2.垂直型微指令 垂直型微指令的特点是采用类似机器指令操作码的方式，在微指令字中，设置微操作码字 段，由微操作码规定微指令的功能。通常一条微指令有1~2个微命令，控制1~2种操作。这种"}
{"doc_id": "co", "page": 417, "text": "第10章控制单元的设计411  微指令不强调其并行控制功能。 表10.2列出了一种垂直型微指令的格式，其中微操作码3位，共分六类操作；地址码字段共 10位，对不同的操作有不同的含义；其他字段3位，可协助本条微指令完成其他控制功能。 表10.2垂直型微指令示例 微操作码地址码其他 微指令类别及功能 0 1 2 3~7 8~ 12 13 15  000 源寄存器目的寄存器其他控制传送型微指令 ALU ALU 运算控制型微指令 0 0 1 ALU  左输入右输入按ALU字段所规定的功能执行，其结果送暂存器 0 1 0 寄存器移位次数移位方式 移位控制型微指令 按移位方式对寄存器中的数据移位 0 1 1 寄存器存储器读写 其访存微指令 他完成存储器和寄存器之间的传送 1 0 0 D s  无条件转移微指令 D为微指令的目的地址 1 0 1 测试条件 条件转移微指令 D  最低4位为测试条件 1 1 0 可定义I/0或其他操作 1 1 1 第3~15位可根据需要定义各种微命令 3.两种微指令格式的比较 心水平型微指令比垂直型微指令并行操作能力强、效率高、灵活性强。 ＠水平型微指令执行一条机器指令所需的微指令数目少，因此速度比垂直型微指令的 速度快。 ＠水平型微指令用较短的微程序结构换取较长的微指令结构，垂直型微指令正相反，它以 较长的微程序结构换取较短的微指令结构。 ＠水平型微指令与机器指令差别较大，垂直型微指令与机器指令相似。 例10.5某微程序控制器中，采用水平型直接控制（编码）方式的微指令格式，后续微指令 地址由微指令的下地址字段给出。已知机器共有28个微命令、6个互斥的可判定的外部条件， 控制存储器的容量为512X40位。试设计其微指令格式，并说明理由。 解：水平型微指令由操作控制字段、判别测试字段和下地址字段三部分构成。因为微指令采 用直接控制（编码）方式，所以其操作控制字段的位数等于微命令数，为28位。又由于后续微指 令地址由下地址字段给出，故其下地址字段的位数可根据控制存储器的容量(512x40位）定为9"}
{"doc_id": "co", "page": 418, "text": "412 第4篇控制单元 位。当微程序出现分支时，后续微指令地址的形成取决于状态条件，6个互斥的可判定外部条 件，可以编码成3位状态位。非分支时的后续微指令地址由微指令的下地址字段直接给出。微 指令的格式如图10.12所示。 操作控制 28位 勹下地址 3位9位 图10.12例10.5微指令格式 例10.6某机共有52个微操作控制信号，构成5个相斥类的微命令组，各组分别包含5、8、 2、15、22个微命令。已知可判定的外部条件有两个，微指令字长28位。 (1)按水平型微指令格式设计微指令，要求微指令的下地址字段直接给出后续微指令地址。 (2)指出控制存储器的容量。 解：（1)根据5个相斥类的微命令组，各组分别包含5、8、2、15、22个微命令，考虑到每组必 须增加一种不发命令的情况，条件测试字段应包含一种不转移的情况，则5个控制字段分别需给 出6、9、3、16、23种状态，对应3、4、2、4、5位（共18位），条件测试字段取2位。根据微指令字长 为28位，则下地址字段取28-18-2=8位，其微指令格式如图10.13所示。 微5命个令微8命个令微2命个令微1命5个令微22命个令判2定个条件 I I I I I I喜口1下地址 3位4位2位4位5位2位8位 图10.13例10.6微指令格式 (2)根据下地址字段为8位，微指令字长为28位，得控制存储器的容量为256x28位。 静态微程序设计和动态微程序设计 通常指令系统是固定的，对应每一条机器指令的微程序是计算机设计者事先编好的，因此一 般微程序无须改变，这种微程序设计技术即称为静态微程序设计，其控制存储器采用ROM。前 面讲述的内容基本上属于这一类。 如果采用EPROM作为控制存储器，人们可以通过改变微指令和微程序来改变机器的指令 系统，这种微程序设计技术称为动态微程序设计。动态微程序设计由于可以根据需要改变微指 令和微程序，因此可以在一台机器上实现不同类型的指令系统，有利于仿真。但是这种设计对用 户的要求很高，目前难以推广。"}
{"doc_id": "co", "page": 419, "text": "第10章控制单元的设计413  毫微程序设计 微程序可看作是解释机器指令的，毫微程序可看作是解释微程序的，而组成毫微程序的毫微 指令则是用来解释微指令的。采用毫微程序设计计算机的优点是用少量的控制存储器空间来达 到高度的并行。 毫微程序设计采用两级微程序的设计方法。第一级微程序为垂直型微指令，并行功能不强， 但有严格的顺序结构，由它确定后续微指令的地址，当需要时可调用第二级。第二级微程序为水 平型微指令，具有很强的并行操作能力，但不包含后续微指令的地址。第二级微程序执行完毕后 又返回到第一级微程序。两级微程序分别放在两级控制存储器内。图10.14示意了毫微程序控 制存储器的基本组成。 控制信号 +1  图10.14毫微程序控制存储器的基本组成 图中CMARI为第一级控存地址寄存器，CMD凡存放从第一级控制存储器中读出的微指令， 如果该微指令只产生一些简单的控制信号，则可以通过译码，直接形成微操作命令，不必调用第 ＿级。如果需调用第二级控制存储器时，则将毫微程序的地址送至CMAR2，然后由从第二级控 制存储器中读出的微指令去直接控制硬件。值得注意的是，垂直型微指令不是和水平型微指令 一条一条地对应，而是由水平型微指令（称为毫微指令）组成的毫微程序去执行垂直型微指令的 操作。毫微指令与微指令的关系就好比微指令与机器指令的关系一样。 ＿级控制存储器虽然能减少控制存储器的容量，但因有时一条微指令要访问两次控制存储 器，影响了速度。 行微程序控制和并行微制 与机器指令一样，完成一条微指令也分两个阶段：取微指令和执行微指令。如果这两个阶段 按图10.15(a)所示的方式运行，则为串行微程序控制。由千取微指令和执行微指令的操作是在"}
{"doc_id": "co", "page": 420, "text": "414 第4篇控制单元 两个完全不同的部件中完成的，因此可将这两部分操作并行进行，以缩短微指令周期，这就是并 行微程序控制，如图10.15(b)所示，与指令二级流水相似。 第i条微指令周期第i+l条微指令周期 取第i条微指令1执行第i条微指令I取第i+l条微指令I执行第i+l条微指令 (a)串行操作 取第i条微指令1 :：二二1执行第i+1条微指令 取第i+2条微指令1执行第i+2条微指令 (b)并行操作 图10.15串行微程序和并行微程序控制方式 当采用并行微程序控制时，为了不影响本条微指令的正确执行，需增加一个微指令寄存器来 暂存下一条微指令。由于执行本条微指令与取下一条微指令是同时进行的，因此当遇到需要根 据本条微指令的处理结果来决定下条微指令的地址时，就不能并行操作，此时可延迟一个微指令 周期再取微指令。 微程序设计举例 微程序设计控制单元的主要任务是编写对应各条机器指令的微程序，具体步骤是首先写出 对应机器指令的全部微操作及节拍安排，然后确定微指令格式，最后编写出每条微指令的二进制 代码（称为微指令码点）。 1.写出对应机器指令的微操作及节拍安排 为了便千与组合逻辑设计比较，仍以10条机器指令为例，而且CPU结构同组合逻辑设计假 设相同。此外，为了简化起见，不考虑间接寻址和中断的情况。下面分别按取指阶段和执行阶段 列出其微操作序列。 (1)取指阶段的微操作及节拍安排 取指阶段的微操作基本与组合逻辑控制相同，不同的是指令取至IR后，微程序控制需由操 作码形成执行阶段微程序的入口地址，即 T。PC-+MAR,1-+R  T1 M(MAR)-+MDR, (PC) +1-+PC  T2 MDR-+IR, OP (IR)习散地址形成部件（编码器） 如果把一个T内的微操作安排在一条微指令中完成，上述微操作对应3条微指令。"}
{"doc_id": "co", "page": 421, "text": "第10章控制单元的设计415  值得注意的是，由于微程序控制的所有控制信号都来自微指令，而微指令又存千控制 存储器中，因此欲完成上述这些微操作，必须先将微指令从控制存储器中读出，也即必须先 给出这些微指令的地址。由图10.4可见，在取指微程序中，除第一条微指令外，其余微指 令的地址均由上一条微指令的下地址字段直接给出，因此上述每一条微指令都需要增加一 个将微指令下地址字段送至CMAR的微操作，记作Ad(CMDR)---+CMAR，而这一操作只能 由下一个时钟周期T的上升沿将地址打入CMAR内。至于取指微程序的最后一条微指令， 其后续微指令的地址是由微地址形成部件形成的，而且也只能由下一个T的上升沿将该地 址打入CMAR中，即微地址形成部件---+CMAR。为了反映该地址与操作码有关，故记作 OP(IR)一微地址形成部件一CMAR。 综上所述，考虑到需要形成后续微指令的地址，上述分析的取指操作共需6条微指令完 成，即 T。PC---+MAR,1---+R  Tl Ad(CMDR)---+CMAR  T2 M(MAR)---+MDR,(PC)+l---+PC  T3 Ad(CMDR)一CMAR, T4 MDR一IR,OP (IR)一微地址形成部件（编码器） T5 OP (IR)一微地址形成部件---+CMAR 所有微指令均由T的上升沿打入CMDR中。 (2)执行阶段的微操作及节拍安排 执行阶段的微操作由操作码性质而定，同时也需要考虑后续微指令地址的形成问题。 1) CLA指令 与组合逻辑控制一样，该指令在执行阶段只有一个微操作0---+AC，只需一个时钟周期T，故 对应一条微指令。该微指令的下地址字段应直接给出取指微程序的入口地址，而且由下一个T 的上升沿将地址打入CMAR内。这样，对应CLA指令执行阶段的微指令有两条： T。0---+AC Tl Ad(CMDR)---+CMAR 取指微程序入口地址---+CMAR 同理可得其余4条非访存指令对应的微操作。 2) COM指令 Tn AC-江i\\C Tl Ad(CMDR)一CMAR取指微程序入口地址一CMAR 3) SHR指令 T。L(AC)---+R(AC),AC。-+AC。 Tl Ad(CMDR)---+CMAR 取指微程序入口地址---+CMAR"}
{"doc_id": "co", "page": 422, "text": "416 第4篇控制单元 4) CSL指令 T。R(AC)-+L(AC),AC。-+ACn(即p-1(AC)) Tl Ad(CMDR)-+CMAR 取指微程序入口地址-+CMAR 5) STP指令 T。0-+G Tl Ad(CMDR)-+CMAR 取指微程序入口地址-+CMAR 这里由于安排了Ad(CMDR)-+CMAR，使再次启动机器时，可直接用已存入CMAR中的取 指微程序的入口地址。 6) ADD指令 T。Ad(IR)-+MAR,1-+R  Tl Ad(CMDR)-+CMAR  T2 M(MAR)-+MDR  T3 Ad(CMDR)一CMAR 兀(AC)+(MDR)-+AC T5 Ad(CMDR)-+CMAR 取指微程序入口地址-+CMAR 7) STA指令 T。Ad(IR)-+ MAR, 1-+ W  Tl Ad(CMDR)-+CMAR  T2 AC-+MDR  T3 Ad(CMDR)-+CMAR  T4 MDR-+M(MAR)  T5 Ad(CMDR)-+CMAR 取指微程序入口地址-+CMAR 8) LDA指令 T。Ad(IR)-+MAR,1-+R  Tl Ad(CMDR)-+CMAR  T2 M(MAR)-+MDR  T3 Ad(CMDR)-+CMAR  T4 MDR-+AC  T5 Ad(CMDR)-+CMAR 取指微程序入口地址-+CMAR 9) JMP指令 T。Ad(IR)一PC Tl Ad(CMDR)-+CMAR 取指微程序入口地址-+CMAR 10) BAN指令 T。A。.Ad(IR)+A。.(PC)-+PC"}
{"doc_id": "co", "page": 423, "text": "第10章控制单元的设计417  Tl Ad(CMDR)--+CMAR 取指微程序入口地址--+CMAR 上述全部微操作共20个，微指令共38条。在上述指令中，1)~ 5)为非访存指令；6)~ 8)为 访存指令；9）和10)则为转移类指令。 2.确定微指令格式 微指令的格式包括微指令的编码方式、后续微指令的地址形成方式和微指令字长等3 个方面。 (1)微指令的编码方式 上述微操作数不多，可采用直接编码方式，由微指令控制字段的某一位直接控制一个 微操作。 (2)后续微指令地址的形成方式 根据上述分析，可采用由指令的操作码和微指令的下地址字段两种方式形成后续微指令的 地址。 (3)微指令字长 微指令由操作控制字段和下地址字段两部分组成。根据直接编码方式，20个微操作对 应20位操作控制字段；根据38条微指令，对应6位下地址字段。这样，微指令字长至少取 26位。 仔细分析发现，在38条微指令中有19条微指令是为了控制将后续微指令的地址打入 CMAR的操作（其中18条是微指令下地址字段Ad(CMDR)--+CMAR，另一条是指令操作码 OP(IR)一微地址形成部件--+CMAR)，因此实际上是每两个时钟周期才能取出并执行一条 微指令。如果能做到每一个时钟周期取出并执行一条微指令，将大大提高微程序控制的 速度。 事实上如果将CMDR的下地址字段Ad(CMDR)直接接到控制存储器的地址线上，并由 下一个时钟周期的上升沿将该地址单元的内容（微指令）读到CMDR中，便能做到在一个 时钟周期内读出并执行一条微指令。这就好比将Ad(CMDR)当作CMAR使用。同理，也 可将指令寄存器的操作码字段OP(IR)经微地址形成部件形成的后续微指令的地址，直接 送到控制存储器的地址线上。这两路地址可通过一个多路选择器，根据需要任选一路，如 图10.16所示。 综上所述，在省去了19条微指令的同时也省去了两个微操作（微指令下地址字段 Ad(CMDR)----1\"CMAR和指令操作码OP(IR)一微地址形成部件一CMAR)。这样，10条机器指令 共对应20-2= 18个微操作和38-19=19条微指令。为了便千扩充，操作控制字段取24位，下地 址字段取6位，其微指令格式如图10.17所示。 其中，第0位表示控制PC--+MAR微操作 第1位表示控制1--+R微操作 第2位表示控制M (MAR)--+MDR  第3位表示控制(PC)+l一PC"}
{"doc_id": "co", "page": 424, "text": "418  控制信号 CMDR  控制存储器 第4篇控制单元 IR.I OP  地址线芒操作控制 23巨三习 二 图10.16省去了CMAR的控制存储器图10.17对应10条机器指令的微指令格式 第4位表示控制MDR—+IR  第5位表示控制0-+AC  第6位表示控制AC-------+AC  第7位表示控制L(AC)----+R(AC),AC。-+AC。 第8位表示控制R(AC)一L(AC),AC。~Acn 第9位表示控制0-+G  第10位表示控制Ad (IR)----+ MAR  第11位表示控制(MDR)+(AC)~Ac  第12位表示控制1—➔W  第13位表示控制AC-+MDR  第14位表示控制MDR—►M(MAR)  第15位表示控制MDR-+AC  第16位表示控制Ad(IR)一PC 第17位表示控制A。.Ad(IR)+A。.(PC)-+PC  3.编写微指令码点 10.3列出了对应10条机器指令的微指令码点。表中空格中“0“省略。"}
{"doc_id": "co", "page": 425, "text": "第10章控制单元的设计419  表10.3对应10条机器指令的微指令码点 微程序微指令地址微指令（二进制代码） 名称（八进制）操作控制字段顺序控制字段 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29  00 1 1 1  取指0 1 1 1 1  02 1 X X X X X X  CLA 0 3 1  COM 04 1  SHR 0 5 1  CSL 0 6 1  STP 07 1  1 0 1 1 1 1  ADD 1 1 1 1 1  1 2 1  1 3 1 1 1 1  STA 1 4 1 1 1 1  1 5 1  1 6 1 1 1 1 1 1  LDA 1 7 1 1  20 1  JMP 2 1 1  BAN 22 1  在确定微指令格式及其字长的过程中，还可将一些微操作命令合用一位代码来控制，这样可 大大压缩微指令的操作控制字段，缩短微指令字长。 例10.7某机有5条微指令，每条微指令发出的控制信号如表10.4所示。采用直接控制 式设计微指令的控制字段，要求其位数最少，而且保持微指令本身的并行性。"}
{"doc_id": "co", "page": 426, "text": "420 第4篇控制单元 表10.4例10.7表格 激活的控制信号 微指令 a h C d e f g h I . j  I I v' V v' V/ V'  I2 v v' v V V' V'  I3 v v V v'  I4 v  I5 v v v  解：由表10.4可见，控制信号c、g'i仅在微指令L同时出现，可合并用1位控制字段表示。 控制信号b、h仅在微指令L中同时出现，也可合并用1位控制字段表示。这样10个控制信号 a~ j可压缩到7个，其格式如图10.18所示。 | a | bh1中1d I e I f|JI  1 2 3 4 5 6 7  图10.18例10.7压缩后的微指令控制字段 思考题与习题 10.1 假设响应中断时，要求将程序断点存在堆栈内，并且采用软件方法寻找中断服务程序的入口地址，试 写出中断隐指令的微操作及节拍安排。 10.2 写出完成下列指令的微操作及节拍安排（包括取指操作）。 (1)指令“ADDR1, X“完成将凡寄存器的内容和主存X单元的内容相加结果存于凡的操作。 (2)指令“ISZX“完成将主存X单元的内容增l，并根据其结果若为0，则跳过下一条指令执行。 10.3 按序写出下列程序所需的全部微操作命令及节拍安排。 指令地址指令 300 LDA 306  301 ADD 307  302 BAN 304  303 STA 305  304 STP"}
{"doc_id": "co", "page": 427, "text": "第10章控制单元的设计421  10.4 在单总线结构的计算机中，用该总线连接了指令寄存器IR、程序计数器PC、存储器地址寄存器MAR、 存储器数据寄存器MDR、通用寄存器R。～凡的输入和输出端。ALU的两个输入端分别与总线和寄存器Y的输 出端相连，ALU的输出端与寄存器Z的输入端相连。Y的输入端与总线连接，Z的输出端与总线连接。该机有 下列指令： ADD Rl,R2,R3  JMP * K  LOAD R1,mem  STORE mem,R2  ; (R2) + (R3)--+RI  ;(PC)+(K-1)--+PC  ; (mem)--+RI  ;R2--+mem  写出控制器执行上述指令的微操作及节拍安排。 10.5 假设CPU在中断周期用堆栈保存程序断点，而且进栈时指针减1（具体操作是先修改栈指针后存 数），出栈时指针加1。分别写出组合逻辑控制和微程序控制在完成中断返回指令时，取指阶段和执行阶段所需 的全部微操作命令及节拍安排。 10.6 巳知带返转指令的含义如下图所示，写出机器在完成带返转指令时，取指阶段和执行阶段所需的全 部微操作及节拍安排。 主程序子程序 间址特征 10.7 画出组合逻辑控制单元的组成框图，根据指令处理过程，结合有关部件说明其工作原理。 10.8 画出微程序控制单元的组成框图，根据指令处理过程，结合有关部件说明其工作原理。 10.9 试比较组合逻辑设计和微程序设计的设计步骤和硬件组成，说明哪一种控制速度更快，为什么？ 10.10 微指令的操作控制有几种编码方式？各有何特点？哪一种控制速度最快？ 10.11 什么是垂直型微指令？什么是水平型微指令？各有何特点？ 10.12 能否说水平型微指令就是直接编码的微指令，为什么？ 10.13 微指令的地址有儿种形成方式？各有何特点？ 10.14 微指令操作控制字段采用直接编码或显式编码时，其微指令字长如何确定？ 10.15 设控制存储器的容量为512X48位，微程序可在整个控存空间实现转移，而控制微程序转移的条件 共有4个（采用直接控制），微指令格式如下： I I转移条件1下地址1  |}操作控制~~|＿顺序控制~  试问微指令中的3个字段分别为多少位？ 10.16 试比较静态微程序设计和动态微程序设计。"}
{"doc_id": "co", "page": 428, "text": "422 第4篇控制单元 10.17 解释机器指令、微指令、微程序、毫微指令和毫微程序以及它们之间的对应关系。 10.18 毫微程序设计的特点是什么？与微程序设计相比，其硬件组成有何不同？ 10.19 假设机器的主要部件有程序计数器PC，指令寄存器IR，通用寄存器R。、R,、R心凡，暂存器C、D, ALU，移位器，存储器地址寄存器MAR，存储器数据寄存器MDR及存储矩阵M。 (1)要求采用单总线结构画出包含上述部件的硬件框图，并注明数据流动方向。 (2)画出“ADD(R,), (R2)”指令在取指阶段和执行阶段的信息流程图。凡寄存器存放源操作数地址，R2 寄存器存放目的操作数的地址。 (3)写出对应该流程图所需的全部微操作命令。 10.20 假设机器的主要部件同上题，外加一个控制门G。 (1)要求采用双总线结构（每组总线的数据流动方向是单向的）画出包含上述部件的硬件框图，并注明数 据流动方向。 (2)画出“SUBRI, R3”指令完成(R1) －（R3)一凡操作的指令周期信息流程图（假设指令地址己放在PC 中），并列出相应的微操作控制信号序列。 10.21 下表给出8条微指令I1~I8及所包含的微命令控制信号，设计微指令操作控制字段格式，要求所使 用的控制位最少，而且保持微指令本身内在的并行性。 微指令所含的微命令 I 1 a b c d e  I 2 a d f g  I3 b h  I4 C  I5 C e g i  I6 a h j  I 7 C d h  I 8 a b h  10.22 设有一运算器通路如下图所示，假设操作数a和b（均为补码）分别放在通用寄存器凡和凡中， ALU有＋、－、M（传送）三种操作功能，移位器可实现左移、右移和直送功能。 (1)指出相容性微操作和相斥性微操作。 (2)采用字段直接编码方式设计适合于此运算器的微指令格式。 (3)画出计算2(a+ b) -+凡的微程序流程图，试问执行周期需用几条微指令？ (4)按设计的微指令格式，写出满足(3)要求的微代码。"}
{"doc_id": "co", "page": 429, "text": "第10章控制单元的设计423  ututut 102030 RRR  附 整机介绍 PC整机主要由主板、处理器、主存、芯片组，以及通过各个端口和总线插槽接入的外部设备 等组成。 10A.1  主板或系统板是装在PC主机箱中的一块印制电路板，其上安装了组成微型计算机的主要 电路系统，并带有扩展插槽和多种接插件，用于插装各种接口卡和有关部件（如键盘、鼠标等）。 主板性能的好坏直接影响整机的性能。 lOA.1.1 主板的主要组成部件 叩CPU插座(Socket)或插槽(Slot)。 ＠内存条插槽。 ＠连接硬盘、软盘驱动器和光盘驱动器等外部设备接口的插座。 ＠接插各种用途的接口卡所需的扩展插槽。 ＠连接鼠标、键盘、打印机和调制解调器的串并端口。 @ CPU芯片、内存条、系统芯片组、BIOS（基本输入输出系统）芯片和CMOS芯片等。 ＠电源、电池、电阻和电容等。 ＠跳线和开关。"}
{"doc_id": "co", "page": 430, "text": "424 第4篇控制单元 lOA.1.2 CPU芯片及插座（插槽） 主板的性能主要取决于CPU,CPU芯片内部总线的宽度和时钟频率（主频）是决定CPU性 能的主要参数。内部总线越宽，在每个时钟节拍内可以传送的数据越多，有利于进行更大的数据 量运算。主频越高，执行每条指令的时间越短，运算速度越快，整机性能也越好。 CPU芯片可以采用插座或插槽固定在主板上。 lOA.1.3 内存条插槽 内存条插槽的插孔数必须与内存条引脚数一致。72线的单面内存条使用72线内存条插 槽，其数据宽度为32位；168线和184线的双面内存条使用168线和184线的内存条插槽，其数 据宽度为64位。 lOA.1.4 扩展插槽 主板上的扩展插槽（又称总线插槽）是主机通过系统总线与外部设备联系的通道，外设接口 电路的接口卡可插在扩展槽内。常用的插槽有ISA扩展槽、EISA扩展槽、VESA(VL-Bus)扩展槽 和PCI扩展槽。 lOA.1.5 配套芯片和器件 为使CPU正常工作，主板上还必须有配套的芯片和器件，主要有如下几种。 1. BIOS芯片 BIOS (Basic Input Output System)芯片装有基本输入输出系统程序，完成冷启动、热启动、上 电自检、基本输入输出驱动程序、系统硬件配置分析、引导DOS启动或引导ROMBASIC解释程 序以及BIOS中断管理。该程序固化在ROM芯片上，早期采用EPROM作为BIOS芯片，现在大 多数PC采用FlashMemory作为BIOS芯片。 2.芯片组 主板上除了CPU、内存条、BIOS芯片外，还有众多支持芯片和接口芯片，这些芯片按其功能 不同，采用VLSI技术将它们分别集成在几块芯片中，如总线的缓冲和控制芯片，CPU的复位、 Cache控制、存储器控制、协处理器接口芯片，以及CMOS与8042振荡源芯片等。 3. CMOS RAM芯片 CMOS RAM芯片用于提供系统的日期、时间、保存系统的硬件配置参数和软硬盘规格、显示 器接口的类型、键盘和其他硬件的设置。PC系统上电启动到引导完成，必须从CMOSRAM中读 取若于参数数据，设定为开机的初始状态。如果CMOSRAM芯片损坏或内容丢失，会造成软硬 盘无法使用、鼠标工作失效等故障。 lOA.1.6 主板结构的改进 1984年，IBM在推出IBMPC/AT时，以产品定义了内部结构的标准，称为AT结构标准，以 后又发展成为Baby/Mini-AT结构标准。随着计算机技术的进一步发展，特别是“电子计算机、 电器和电信”三电一体化和多媒体技术的发展，使集成到PC中的功能日益增多，对主板的尺寸、 CPU和内存条的位置以及软硬盘控制器及软硬盘机支架位置都有更高要求，先后又推出了ATX 和BTX主板结构规范。后者的散热性能更好，安装与固定方式更科学，并采用了大量的新型总"}
{"doc_id": "co", "page": 431, "text": "第10章控制单元的设计425  线及接口，增加了USB接口的数量，使外设的接插更为简化。 在高性能的PC系统中，主板上还采用了一些提高系统性能的新技术，例如： 心采用集成的数据捕获芯片，构成硬件监控系统，增加系统的监测能力，以提高系统的 稳定性。 ＠支持UltraDMA/33、DMA/66芯片，使硬盘的数据传输率比原来提高了1~2倍。在多任 务环境中执行数据传输，或在单任务环境中进行大批量数据传输时，采用DMA方式，允许数据 直接从硬盘传输到主存，而不占用CPU资源，使CPU从频繁的数据传输中脱离出来去执行其他 任务，从而提高整机系统的性能，这一点对多任务环境特别有用。 ＠除了采用USB接口外，Apple公司和TI(Texas Instrument)公司又开发了一种高速数据传 输的串行接口IEEE1394，有了USB和IEEE1394，使PC的使用简化到同家电一样容易。 ＠为了解决PCI总线无法执行实时3D图形处理，Intel公司又开发了AGP(Accelerated  Graphics Port)加速图形端口，可获得较高的3D图形显示性能，增加了可用的带宽，其最高数据 传输率可达266MBps和533MBps，而采用AGP2.0版本，最大数据传输率可达1GBps。 10A.2 芯片组 lOA.2.1 芯片组的功能 CPU芯片是PC的核心器件，但CPU要完成信息处理功能还必须有一系列的“接口电路”和 “支持电路”。例如，CPU要向外设输入输出信息，必须有并行接口电路和串行接口电路；CPU要 与主存进行数据传送，必须有主存控制电路；CPU要具有中断处理功能，必须有中断控制电路； CPU要支持DMA功能，必须有DMA控制电路；CPU要通过系统总线与其他部件联系，必须有总 线控制电路等；此外要向CPU及系统中其他部件提供时钟信号，必须有”时钟发生器（电路）＂。 所有这些电路在早期的PC中都是由一些中、小规模集成电路和成千上万个电阻、电容组成的。 这不仅占用了主板中的很多位置，而且给维修带来很大困难。 在PC286以上的微型计算机系统中，为了简化硬件部分的设计，减少主板上芯片的数量，增 加硬件的可靠性，大部分厂商采用芯片组(Chipset)技术来设计PC主板。随着超大规模集成电 路的发展，采用VLSI技术，把主板上众多的接口芯片和支持芯片按不同功能分别集成到一块集 成芯片中。这样，用少量几片VLSI芯片的组合，即“控制芯片组＂（简称＂芯片组”)来代替众多 的接口芯片和支持芯片，可以简化主板的设计，降低系统的成本，提高系统的可靠性，有利于测 试、维护和维修。 在PC中，整个系统的有效运行都由芯片组来控制和协调，芯片组决定了系统的如下特征。 叩CPU的类型（是Pentium、PentiumPro、PentiumMMX，还是PentiumII、Pentiumill和Penti­ um 4)和芯片的主频范围。 ＠内存条的类型，是快速页面模式、扩展数据输出、突发式，还是同步DRAM(SDRAM)、带 Cache的DRAM、双数据速率的SDRAM(DDRSRDAM)，是支持一种，还是几种等。 ＠提供USB接口以及IEEE1394接口的数目。 ＠存储器总线的最大频率。"}
{"doc_id": "co", "page": 432, "text": "426 第4篇控制单元 @ PCI总线的类型，是32位还是64位，同存储器总线速度是同步还是异步，是否支持 PCI-Express。 ＠支持几个CPU。 ＠对内置PCI、EIDE控制的支持。 ＠内置PS/2鼠标和键盘控制器、BIOS以及实时时钟电路。 芯片组一旦选定，系统的上述特征就被确定，在使用过程中，芯片组是无法升级的。 lOA.2.2 芯片组的组成 不同时代的PC有不同的芯片组，随着ISA、EISA、PCI总线的出现，所推出的芯片组与总线 标准有关，如82350EISA芯片组、PCI芯片组等。 基于Pentium（包括PentiumPro)处理器系列和PCI总线的芯片组，通常称为PCI芯片组，如 Intel 430系列。 1. Intel 430系列 430系列芯片组适用于Pentium和PCI总线。图10.19是Pentium计算机主板结构示意图。 图中的PCI芯片组包括主存与Cache控制器芯片，CPU总线－PCI总线桥（又称北桥）芯片，PCI 总线－ISA总线桥（又称南桥）芯片。主存与Cache控制芯片用来管理CPU对主存和Cache的存 取操作，并提供在CPU、Cache、主存和PCI局部总线之间传送的总线控制。北桥芯片将CPU总 线和PCI总线相连，实现CPU、主存和PCI之间的通路。南桥芯片将PCI总线和ISA总线相连。 通过两个“桥”芯片将CPU总线、PCI总线和ISA总线连成整体。桥芯片在此起到了速度缓冲、 电平转换和控制协议的转换作用。当CPU芯片需要升级时，只需改变CPU总线和北桥芯片，全 部巳有的外部设备可继续工作。 图10.19中的CPU总线是一个64位数据线和32位地址线的同步总线。总线时钟频率为 66.6 MHz（或60MHz),CPU内部时钟是此时钟频率的倍频。此总线可与4~ 128 MB的主存相 连。需要扩充主存容量时，可以内存条的形式插入主板的内存条插槽内。CPU总线还接有L2 级Cache。CPU对主存和Cache的存取由主存与Cache控制器芯片完成。 PCI总线用于连接高速的I/0设备，它是32位（戒64位）的同步总线，地址线、数据线共用 一组，分时复用。它采用集中式仲裁方式，有专用的PCI总线仲裁器。主板上还有3个PCI总线 扩展插槽，可作为PC扩充外设使用。 ISA总线可与低速I/0设备连接，主板上配有3~ 4个ISA总线扩展插槽，以便使用16位／8 位的接口（适配器）卡。ISA总线控制逻辑还可以通过主板上的板级总线与实时钟／日历、ROM、 键盘和鼠标控制器(8042微处理器）等芯片相连接。 Pentium II处理器推出后，为适应这一高频CPU芯片的需要，又推出了满足AGP加速图形端 口要求的Intel440芯片组。 2. Intel 440 BX芯片组 Intel 440 BX是专用于PentiumII的芯片组，它把系统总线的频率提高到100MHz,同时还支 持66MHz的系统总线，保护了以前的投资。它使100MHz的SDRAM的使用成为可能。它提高"}
{"doc_id": "co", "page": 433, "text": "第10章控制单元的设计427  鼠标 -— 1槽 展 T|| ＿扩 A  —-— EIS  雷雷62 怅 36 顷 主板 键盘 图10.19Pentium主板结构示意图 了Pentium]I CPU、AGP、100MHz SDRAM和PCI总线间的速度和带宽，使在MPEG-2视频解码 及DVD-ROM等应用领域的性能得到提高。 图10.20是采用440BX芯片组的主板结构示意图。 440 BX芯片组由82443BX主桥(HostBridge)芯片和82371AB/EB多功能I/0芯片组成。 它基本保持了430芯片组由北桥芯片和南桥芯片组成的结构。北桥集成了存储器控制器和PCI 控制器，南桥集成了ISA控制器和IDE(Integrated Drive Electronics)控制器（硬盘驱动器接口）。 82443 BX芯片采用了四端口加速技术，它把CPU（支持单／双Pentium处理器）、AGP端口、 主存和PCI总线相互连接起来并控制四者的数据传输。它支持1GB的扩展数据输出EDO(Ex­ tended Data Output) DRAM和SDRAM的主存，但不允许EDO和SDRAM混合使用，它也支持 Ultra DMA/33。 82371 EB (Pentium II x4E)芯片是一个高度集成的多功能I/0芯片，它包括PCI-ISA桥接器， 提供两个硬盘驱动器接口IDE，支持UltraDMA/33接口标准，具有USB控制器，支持两个USB端"}
{"doc_id": "co", "page": 434, "text": "428  TV  第4篇控制单元 -VMI  一视频采集 2XAGP总线 2个IDE端口G芒） (UltraDMA/33)它 2个USB 端口 主PCI总线 (PCI总线＃0) 图10.20440 BX主板结构示意图 PCI插槽 口，还支持I/0高级可编程中断控制器(AdvancedProgrammable Interrupt Controller, APIC)。采 用DMA方式的硬盘数据可通过SM总线直接传输到主存。"}
{"doc_id": "co", "page": 435, "text": "[ 1] STALLINGS W. Computer Organization and Architecture: Designing for Performance [ M].  7th ed. Upper Saddle River: Prentice Hall, 2005.  [ 2] PATTERSON D A, HENNESSY J L. Computer Organization and Design: The Hardware/Soft­ ware Interface [ M].3rd ed. Burlington: Morgan Kaufmann, 2004.  [3] BRYANT R E,O'HALLARON DR. Computer Systems:A Programmer's Perspective[M].  Upper Saddle River: Prentice Hall, 2002.  [ 4] HYDE R. Write Great Code: Volume 1: Understanding the Machine [ M]. San Francisco: No  Starch Press, 2004.  [5]唐朔飞．计算机组成原理[M]. 2版．北京：高等教育出版社，2008. [6]唐朔飞．计算机组成原理：学习指导与习题解答[M]. 2版．北京：高等教育出版 社，2012. [7]孙德文．微型计算机技术[M]．修订版．北京：高等教育出版社，2005. [8]张晨曦，王志荚，张春元，等．计算机体系结构[M]. 2版．北京：高等教育出版社，2005. [9]白中英．计算机组成原理[M]. 3版．北京：科学出版社，2002."}
